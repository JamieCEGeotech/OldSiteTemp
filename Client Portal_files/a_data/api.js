/*
 * GIS Cloud JavaScript API
 *
 * web: https://www.giscloud.com/
 * dev: https://docs.giscloud.com/
 *
 * copyright GIS Cloud Ltd 2025.
 *
 */

if (!self.giscloud_config) {

giscloud_config = {
    restHost : function () {  return "https://api.giscloud.com"; },
    apiHost : function () {
        if (document.location.protocol === "https:")
            return "https://api.giscloud.com";
        else
            return "http://api.giscloud.com";
    },
    authHost : function () {  return "https://auth.giscloud.com"; },
    liveSite : function () {  return "https://assets.giscloud.com/"; },
    leafletScript : function () { return "leaflet.js"; },
    nch : "54f3d4b",
    tileSite : function () {
        var tile_site =  "https://tiles.giscloud.com/";
        if (tile_site) {
            return tile_site;
        }
        var domain = "giscloud.com" || "giscloud.com";
        var subdomain_pattern = new RegExp("\\S+\\." + domain.replace(/\./g, "\\.") + "$", "i");
        if (document && document.location && document.location.host &&
            document.location.host !== "dev.giscloud.com" &&
            document.location.host.match(subdomain_pattern)) {

            return document.location.protocol + "//" + document.location.host + "/";
        }

        return "https://tiles.giscloud.com/";
    },
    assetsSite : function() {
        return  "https://assets.giscloud.com/";
    },
    tileImageProxySite: function() {
        var proxy = "https://proxy.giscloud.com/{url}";
        return proxy ? proxy : this.tileSite() + "tms/image_proxy?url={url}&mid={mid}";
    },
    https : true};

}(function(v,T){function e(e){var i=fe[e]={};return ge.each(e.split(ee),function(e,t){i[t]=!0}),i}function u(e,t,i){if(i===T&&e.nodeType===1){var n="data-"+t.replace(me,"-$1").toLowerCase();i=e.getAttribute(n);if(typeof i=="string"){try{i=i==="true"?!0:i==="false"?!1:i==="null"?null:+i+""===i?+i:pe.test(i)?ge.parseJSON(i):i}catch(e){}ge.data(e,t,i)}else i=T}return i}function c(e){var t;for(t in e){if(t==="data"&&ge.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function o(){return!1}function i(){return!0}function r(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function t(e,t){do{e=e[t]}while(e&&e.nodeType!==1);return e}function n(e,n,r){n=n||0;if(ge.isFunction(n))return ge.grep(e,function(e,t){var i=!!n.call(e,t,e);return i===r});if(n.nodeType)return ge.grep(e,function(e,t){return e===n===r});if(typeof n=="string"){var t=ge.grep(e,function(e){return e.nodeType===1});if(Ne.test(n))return ge.filter(n,t,!r);n=ge.filter(n,t)}return ge.grep(e,function(e,t){return ge.inArray(e,n)>=0===r})}function y(e){var t=ze.split("|"),i=e.createDocumentFragment();if(i.createElement)while(t.length)i.createElement(t.pop());return i}function d(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function l(e,t){if(t.nodeType!==1||!ge.hasData(e))return;var i,n,r,a=ge._data(e),s=ge._data(t,a),o=a.events;if(o){delete s.handle,s.events={};for(i in o)for(n=0,r=o[i].length;n<r;n++)ge.event.add(t,i,o[i][n])}s.data&&(s.data=ge.extend({},s.data))}function h(e,t){var i;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),i=t.nodeName.toLowerCase(),i==="object"?(t.parentNode&&(t.outerHTML=e.outerHTML),ge.support.html5Clone&&e.innerHTML&&!ge.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):i==="input"&&Qe.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):i==="option"?t.selected=e.defaultSelected:i==="input"||i==="textarea"?t.defaultValue=e.defaultValue:i==="script"&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(ge.expando)}function f(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function _(e){Qe.test(e.type)&&(e.defaultChecked=e.checked)}function p(e,t){if(t in e)return t;var i=t.charAt(0).toUpperCase()+t.slice(1),n=t,r=vt.length;while(r--){t=vt[r]+i;if(t in e)return t}return n}function b(e,t){return e=t||e,ge.css(e,"display")==="none"||!ge.contains(e.ownerDocument,e)}function a(e,t){var i,n,r=[],a=0,s=e.length;for(;a<s;a++){i=e[a];if(!i.style)continue;r[a]=ge._data(i,"olddisplay"),t?(!r[a]&&i.style.display==="none"&&(i.style.display=""),i.style.display===""&&b(i)&&(r[a]=ge._data(i,"olddisplay",w(i.nodeName)))):(n=it(i,"display"),!r[a]&&n!=="none"&&ge._data(i,"olddisplay",n))}for(a=0;a<s;a++){i=e[a];if(!i.style)continue;if(!t||i.style.display==="none"||i.style.display==="")i.style.display=t?r[a]||"":"none"}return e}function s(e,t,i){var n=ut.exec(t);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):t}function g(e,t,i,n){var r=i===(n?"border":"content")?4:t==="width"?1:0,a=0;for(;r<4;r+=2)i==="margin"&&(a+=ge.css(e,i+mt[r],!0)),n?(i==="content"&&(a-=parseFloat(it(e,"padding"+mt[r]))||0),i!=="margin"&&(a-=parseFloat(it(e,"border"+mt[r]+"Width"))||0)):(a+=parseFloat(it(e,"padding"+mt[r]))||0,i!=="padding"&&(a+=parseFloat(it(e,"border"+mt[r]+"Width"))||0));return a}function m(e,t,i){var n=t==="width"?e.offsetWidth:e.offsetHeight,r=!0,a=ge.support.boxSizing&&ge.css(e,"boxSizing")==="border-box";if(n<=0||n==null){n=it(e,t);if(n<0||n==null)n=e.style[t];if(dt.test(n))return n;r=a&&(ge.support.boxSizingReliable||n===e.style[t]),n=parseFloat(n)||0}return n+g(e,t,i||(a?"border":"content"),r)+"px"}function w(e){if(ft[e])return ft[e];var t=ge("<"+e+">").appendTo(B.body),i=t.css("display");t.remove();if(i==="none"||i===""){nt=B.body.appendChild(nt||ge.extend(B.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!rt||!nt.createElement)rt=(nt.contentWindow||nt.contentDocument).document,rt.write("<!doctype html><html><body>"),rt.close();t=rt.body.appendChild(rt.createElement(e)),i=it(t,"display"),B.body.removeChild(nt)}return ft[e]=i,i}function x(i,e,n,r){var t;if(ge.isArray(e))ge.each(e,function(e,t){n||bt.test(i)?r(i,t):x(i+"["+(typeof t=="object"?e:"")+"]",t,n,r)});else if(!n&&ge.type(e)==="object")for(t in e)x(i+"["+t+"]",e[t],n,r);else r(i,e)}function C(l){return function(e,t){typeof e!="string"&&(t=e,e="*");var i,n,r,a=e.toLowerCase().split(ee),s=0,o=a.length;if(ge.isFunction(t))for(;s<o;s++)i=a[s],r=/^\+/.test(i),r&&(i=i.substr(1)||"*"),n=l[i]=l[i]||[],n[r?"unshift":"push"](t)}}function k(e,t,i,n,r,a){r=r||t.dataTypes[0],a=a||{},a[r]=!0;var s,o=e[r],l=0,c=o?o.length:0,u=e===Nt;for(;l<c&&(u||!s);l++)s=o[l](t,i,n),typeof s=="string"&&(!u||a[s]?s=T:(t.dataTypes.unshift(s),s=k(e,t,i,n,s,a)));return(u||!s)&&!a["*"]&&(s=k(e,t,i,n,"*",a)),s}function M(e,t){var i,n,r=ge.ajaxSettings.flatOptions||{};for(i in t)t[i]!==T&&((r[i]?e:n||(n={}))[i]=t[i]);n&&ge.extend(!0,e,n)}function S(e,t,i){var n,r,a,s,o=e.contents,l=e.dataTypes,c=e.responseFields;for(r in c)r in i&&(t[c[r]]=i[r]);while(l[0]==="*")l.shift(),n===T&&(n=e.mimeType||t.getResponseHeader("content-type"));if(n)for(r in o)if(o[r]&&o[r].test(n)){l.unshift(r);break}if(l[0]in i)a=l[0];else{for(r in i){if(!l[0]||e.converters[r+" "+l[0]]){a=r;break}s||(s=r)}a=a||s}if(a)return a!==l[0]&&l.unshift(a),i[a]}function L(e,t){var i,n,r,a,s=e.dataTypes.slice(),o=s[0],l={},c=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(s[1])for(i in e.converters)l[i.toLowerCase()]=e.converters[i];for(;r=s[++c];)if(r!=="*"){if(o!=="*"&&o!==r){i=l[o+" "+r]||l["* "+r];if(!i)for(n in l){a=n.split(" ");if(a[1]===r){i=l[o+" "+a[0]]||l["* "+a[0]];if(i){i===!0?i=l[n]:l[n]!==!0&&(r=a[0],s.splice(c--,0,r));break}}}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(e){return{state:"parsererror",error:i?e:"No conversion from "+o+" to "+r}}}o=r}return{state:"success",data:t}}function D(){try{return new v.XMLHttpRequest}catch(e){}}function j(){try{return new v.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function I(){return setTimeout(function(){Ut=T},0),Ut=ge.now()}function E(a,e){ge.each(e,function(e,t){var i=(Zt[e]||[]).concat(Zt["*"]),n=0,r=i.length;for(;n<r;n++)if(i[n].call(a,e,t))return})}function A(s,e,t){var i,n=0,r=0,a=Yt.length,o=ge.Deferred().always(function(){delete l.elem}),l=function(){var e=Ut||I(),t=Math.max(0,c.startTime+c.duration-e),i=t/c.duration||0,n=1-i,r=0,a=c.tweens.length;for(;r<a;r++)c.tweens[r].run(n);return o.notifyWith(s,[c,n,t]),n<1&&a?t:(o.resolveWith(s,[c]),!1)},c=o.promise({elem:s,props:ge.extend({},e),opts:ge.extend(!0,{specialEasing:{}},t),originalProperties:e,originalOptions:t,startTime:Ut||I(),duration:t.duration,tweens:[],createTween:function(e,t,i){var n=ge.Tween(s,c.opts,e,t,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(n),n},stop:function(e){var t=0,i=e?c.tweens.length:0;for(;t<i;t++)c.tweens[t].run(1);return e?o.resolveWith(s,[c,e]):o.rejectWith(s,[c,e]),this}}),u=c.props;P(u,c.opts.specialEasing);for(;n<a;n++){i=Yt[n].call(c,s,u,c.opts);if(i)return i}return E(c,u),ge.isFunction(c.opts.start)&&c.opts.start.call(s,c),ge.fx.timer(ge.extend(l,{anim:c,queue:c.opts.queue,elem:s})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function P(e,t){var i,n,r,a,s;for(i in e){n=ge.camelCase(i),r=t[n],a=e[i],ge.isArray(a)&&(r=a[1],a=e[i]=a[0]),i!==n&&(e[n]=a,delete e[i]),s=ge.cssHooks[n];if(s&&"expand"in s){a=s.expand(a),delete e[n];for(i in a)i in e||(e[i]=a[i],t[i]=r)}else t[n]=r}}function O(t,e,i){var n,r,a,s,o,l,c,u,d,h=this,f=t.style,p={},g=[],m=t.nodeType&&b(t);i.queue||(u=ge._queueHooks(t,"fx"),u.unqueued==null&&(u.unqueued=0,d=u.empty.fire,u.empty.fire=function(){u.unqueued||d()}),u.unqueued++,h.always(function(){h.always(function(){u.unqueued--,ge.queue(t,"fx").length||u.empty.fire()})})),t.nodeType===1&&("height"in e||"width"in e)&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],ge.css(t,"display")==="inline"&&ge.css(t,"float")==="none"&&(!ge.support.inlineBlockNeedsLayout||w(t.nodeName)==="inline"?f.display="inline-block":f.zoom=1)),i.overflow&&(f.overflow="hidden",ge.support.shrinkWrapBlocks||h.done(function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]}));for(n in e){a=e[n];if(Jt.exec(a)){delete e[n],l=l||a==="toggle";if(a===(m?"hide":"show"))continue;g.push(n)}}s=g.length;if(s){o=ge._data(t,"fxshow")||ge._data(t,"fxshow",{}),"hidden"in o&&(m=o.hidden),l&&(o.hidden=!m),m?ge(t).show():h.done(function(){ge(t).hide()}),h.done(function(){var e;ge.removeData(t,"fxshow",!0);for(e in p)ge.style(t,e,p[e])});for(n=0;n<s;n++)r=g[n],c=h.createTween(r,m?o[r]:0),p[r]=o[r]||ge.style(t,r),r in o||(o[r]=c.start,m&&(c.end=c.start,c.start=r==="width"||r==="height"?1:0))}}function N(e,t,i,n,r){return new N.prototype.init(e,t,i,n,r)}function R(e,t){var i,n={height:e},r=0;t=t?1:0;for(;r<4;r+=2-t)i=mt[r],n["margin"+i]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function F(e){return ge.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var z,H,B=v.document,W=v.location,q=v.navigator,G=v.jQuery,V=v.$,U=Array.prototype.push,$=Array.prototype.slice,J=Array.prototype.indexOf,Q=Object.prototype.toString,X=Object.prototype.hasOwnProperty,Y=String.prototype.trim,ge=function(e,t){return new ge.fn.init(e,t,z)},Z=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,K=/\S/,ee=/\s+/,te=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ie=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,ne=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,re=/^[\],:{}\s]*$/,ae=/(?:^|:|,)(?:\s*\[)+/g,se=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,oe=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,le=/^-ms-/,ce=/-([\da-z])/gi,ue=function(e,t){return(t+"").toUpperCase()},de=function(){B.addEventListener?(B.removeEventListener("DOMContentLoaded",de,!1),ge.ready()):B.readyState==="complete"&&(B.detachEvent("onreadystatechange",de),ge.ready())},he={};ge.fn=ge.prototype={constructor:ge,init:function(e,t,i){var n,r,a,s;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?n=[null,e,null]:n=ie.exec(e);if(n&&(n[1]||!t)){if(n[1])return t=t instanceof ge?t[0]:t,s=t&&t.nodeType?t.ownerDocument||t:B,e=ge.parseHTML(n[1],s,!0),ne.test(n[1])&&ge.isPlainObject(t)&&this.attr.call(e,t,!0),ge.merge(this,e);r=B.getElementById(n[2]);if(r&&r.parentNode){if(r.id!==n[2])return i.find(e);this.length=1,this[0]=r}return this.context=B,this.selector=e,this}return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e)}return ge.isFunction(e)?i.ready(e):(e.selector!==T&&(this.selector=e.selector,this.context=e.context),ge.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return $.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,i){var n=ge.merge(this.constructor(),e);return n.prevObject=this,n.context=this.context,t==="find"?n.selector=this.selector+(this.selector?" ":"")+i:t&&(n.selector=this.selector+"."+t+"("+i+")"),n},each:function(e,t){return ge.each(this,e,t)},ready:function(e){return ge.ready.promise().done(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack($.apply(this,arguments),"slice",$.call(arguments).join(","))},map:function(i){return this.pushStack(ge.map(this,function(e,t){return i.call(e,t,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:U,sort:[].sort,splice:[].splice},ge.fn.init.prototype=ge.fn,ge.extend=ge.fn.extend=function(){var e,t,i,n,r,a,s=arguments[0]||{},o=1,l=arguments.length,c=!1;typeof s=="boolean"&&(c=s,s=arguments[1]||{},o=2),typeof s!="object"&&!ge.isFunction(s)&&(s={}),l===o&&(s=this,--o);for(;o<l;o++)if((e=arguments[o])!=null)for(t in e){i=s[t],n=e[t];if(s===n)continue;c&&n&&(ge.isPlainObject(n)||(r=ge.isArray(n)))?(r?(r=!1,a=i&&ge.isArray(i)?i:[]):a=i&&ge.isPlainObject(i)?i:{},s[t]=ge.extend(c,a,n)):n!==T&&(s[t]=n)}return s},ge.extend({noConflict:function(e){return v.$===ge&&(v.$=V),e&&v.jQuery===ge&&(v.jQuery=G),ge},isReady:!1,readyWait:1,holdReady:function(e){e?ge.readyWait++:ge.ready(!0)},ready:function(e){if(e===!0?--ge.readyWait:ge.isReady)return;if(!B.body)return setTimeout(ge.ready,1);ge.isReady=!0;if(e!==!0&&--ge.readyWait>0)return;H.resolveWith(B,[ge]),ge.fn.trigger&&ge(B).trigger("ready").off("ready")},isFunction:function(e){return ge.type(e)==="function"},isArray:Array.isArray||function(e){return ge.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):he[Q.call(e)]||"object"},isPlainObject:function(e){if(!e||ge.type(e)!=="object"||e.nodeType||ge.isWindow(e))return!1;try{if(e.constructor&&!X.call(e,"constructor")&&!X.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var t;for(t in e);return t===T||X.call(e,t)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,i){var n;return!e||typeof e!="string"?null:(typeof t=="boolean"&&(i=t,t=0),t=t||B,(n=ne.exec(e))?[t.createElement(n[1])]:(n=ge.buildFragment([e],t,i?null:[]),ge.merge([],(n.cacheable?ge.clone(n.fragment):n.fragment).childNodes)))},parseJSON:function(e){if(!e||typeof e!="string")return null;e=ge.trim(e);if(v.JSON&&v.JSON.parse)return v.JSON.parse(e);if(re.test(e.replace(se,"@").replace(oe,"]").replace(ae,"")))return new Function("return "+e)();ge.error("Invalid JSON: "+e)},parseXML:function(e){var t,i;if(!e||typeof e!="string")return null;try{v.DOMParser?(i=new DOMParser,t=i.parseFromString(e,"text/xml")):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e))}catch(e){t=T}return(!t||!t.documentElement||t.getElementsByTagName("parsererror").length)&&ge.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(e){e&&K.test(e)&&(v.execScript||function(e){v.eval.call(v,e)})(e)},camelCase:function(e){return e.replace(le,"ms-").replace(ce,ue)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var n,r=0,a=e.length,s=a===T||ge.isFunction(e);if(i){if(s){for(n in e)if(t.apply(e[n],i)===!1)break}else for(;r<a;)if(t.apply(e[r++],i)===!1)break}else if(s){for(n in e)if(t.call(e[n],n,e[n])===!1)break}else for(;r<a;)if(t.call(e[r],r,e[r++])===!1)break;return e},trim:Y&&!Y.call("\ufeff ")?function(e){return e==null?"":Y.call(e)}:function(e){return e==null?"":(e+"").replace(te,"")},makeArray:function(e,t){var i,n=t||[];return e!=null&&(i=ge.type(e),e.length==null||i==="string"||i==="function"||i==="regexp"||ge.isWindow(e)?U.call(n,e):ge.merge(n,e)),n},inArray:function(e,t,i){var n;if(t){if(J)return J.call(t,e,i);n=t.length,i=i?i<0?Math.max(0,n+i):i:0;for(;i<n;i++)if(i in t&&t[i]===e)return i}return-1},merge:function(e,t){var i=t.length,n=e.length,r=0;if(typeof i=="number")for(;r<i;r++)e[n++]=t[r];else while(t[r]!==T)e[n++]=t[r++];return e.length=n,e},grep:function(e,t,i){var n,r=[],a=0,s=e.length;i=!!i;for(;a<s;a++)n=!!t(e[a],a),i!==n&&r.push(e[a]);return r},map:function(e,t,i){var n,r,a=[],s=0,o=e.length,l=e instanceof ge||o!==T&&typeof o=="number"&&(o>0&&e[0]&&e[o-1]||o===0||ge.isArray(e));if(l)for(;s<o;s++)n=t(e[s],s,i),n!=null&&(a[a.length]=n);else for(r in e)n=t(e[r],r,i),n!=null&&(a[a.length]=n);return a.concat.apply([],a)},guid:1,proxy:function(e,t){var i,n,r;return typeof t=="string"&&(i=e[t],t=e,e=i),ge.isFunction(e)?(n=$.call(arguments,2),r=function(){return e.apply(t,n.concat($.call(arguments)))},r.guid=e.guid=e.guid||ge.guid++,r):T},access:function(e,t,i,n,r,a,s){var o,l=i==null,c=0,u=e.length;if(i&&typeof i=="object"){for(c in i)ge.access(e,t,c,i[c],1,a,n);r=1}else if(n!==T){o=s===T&&ge.isFunction(n),l&&(o?(o=t,t=function(e,t,i){return o.call(ge(e),i)}):(t.call(e,n),t=null));if(t)for(;c<u;c++)t(e[c],i,o?n.call(e[c],c,t(e[c],i)):n,s);r=1}return r?e:l?t.call(e):u?t(e[0],i):a},now:function(){return(new Date).getTime()}}),ge.ready.promise=function(e){if(!H){H=ge.Deferred();if(B.readyState==="complete")setTimeout(ge.ready,1);else if(B.addEventListener)B.addEventListener("DOMContentLoaded",de,!1),v.addEventListener("load",ge.ready,!1);else{B.attachEvent("onreadystatechange",de),v.attachEvent("onload",ge.ready);var i=!1;try{i=v.frameElement==null&&B.documentElement}catch(e){}i&&i.doScroll&&function t(){if(!ge.isReady){try{i.doScroll("left")}catch(e){return setTimeout(t,50)}ge.ready()}}()}}return H.promise(e)},ge.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){he["[object "+t+"]"]=t.toLowerCase()}),z=ge(B);var fe={};ge.Callbacks=function(r){r=typeof r=="string"?fe[r]||e(r):ge.extend({},r);var t,i,n,a,s,o,l=[],c=!r.once&&[],u=function(e){t=r.memory&&e,i=!0,o=a||0,a=0,s=l.length,n=!0;for(;l&&o<s;o++)if(l[o].apply(e[0],e[1])===!1&&r.stopOnFalse){t=!1;break}n=!1,l&&(c?c.length&&u(c.shift()):t?l=[]:d.disable())},d={add:function(){if(l){var e=l.length;(function n(e){ge.each(e,function(e,t){var i=ge.type(t);i==="function"?(!r.unique||!d.has(t))&&l.push(t):t&&t.length&&i!=="string"&&n(t)})})(arguments),n?s=l.length:t&&(a=e,u(t))}return this},remove:function(){return l&&ge.each(arguments,function(e,t){var i;while((i=ge.inArray(t,l,i))>-1)l.splice(i,1),n&&(i<=s&&s--,i<=o&&o--)}),this},has:function(e){return ge.inArray(e,l)>-1},empty:function(){return l=[],this},disable:function(){return l=c=t=T,this},disabled:function(){return!l},lock:function(){return c=T,t||d.disable(),this},locked:function(){return!c},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],l&&(!i||c)&&(n?c.push(t):u(t)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!i}};return d},ge.extend({Deferred:function(e){var s=[["resolve","done",ge.Callbacks("once memory"),"resolved"],["reject","fail",ge.Callbacks("once memory"),"rejected"],["notify","progress",ge.Callbacks("memory")]],r="pending",a={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var a=arguments;return ge.Deferred(function(r){ge.each(s,function(e,t){var i=t[0],n=a[e];o[t[1]](ge.isFunction(n)?function(){var e=n.apply(this,arguments);e&&ge.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[i+"With"](this===o?r:this,[e])}:r[i])}),a=null}).promise()},promise:function(e){return e!=null?ge.extend(e,a):a}},o={};return a.pipe=a.then,ge.each(s,function(e,t){var i=t[2],n=t[3];a[t[1]]=i.add,n&&i.add(function(){r=n},s[e^1][2].disable,s[2][2].lock),o[t[0]]=i.fire,o[t[0]+"With"]=i.fireWith}),a.promise(o),e&&e.call(o,o),o},when:function(e){var t=0,i=$.call(arguments),n=i.length,r=n!==1||e&&ge.isFunction(e.promise)?n:0,a=r===1?e:ge.Deferred(),s=function(t,i,n){return function(e){i[t]=this,n[t]=arguments.length>1?$.call(arguments):e,n===o?a.notifyWith(i,n):--r||a.resolveWith(i,n)}},o,l,c;if(n>1){o=new Array(n),l=new Array(n),c=new Array(n);for(;t<n;t++)i[t]&&ge.isFunction(i[t].promise)?i[t].promise().done(s(t,c,i)).fail(a.reject).progress(s(t,l,o)):--r}return r||a.resolveWith(c,i),a.promise()}}),ge.support=function(){var s,e,t,i,n,r,a,o,l,c,u,d=B.createElement("div");d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=d.getElementsByTagName("*"),t=d.getElementsByTagName("a")[0];if(!e||!t||!e.length)return{};i=B.createElement("select"),n=i.appendChild(B.createElement("option")),r=d.getElementsByTagName("input")[0],t.style.cssText="top:1px;float:left;opacity:.5",s={leadingWhitespace:d.firstChild.nodeType===3,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(t.getAttribute("style")),hrefNormalized:t.getAttribute("href")==="/a",opacity:/^0.5/.test(t.style.opacity),cssFloat:!!t.style.cssFloat,checkOn:r.value==="on",optSelected:n.selected,getSetAttribute:d.className!=="t",enctype:!!B.createElement("form").enctype,html5Clone:B.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:B.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},r.checked=!0,s.noCloneChecked=r.cloneNode(!0).checked,i.disabled=!0,s.optDisabled=!n.disabled;try{delete d.test}catch(e){s.deleteExpando=!1}!d.addEventListener&&d.attachEvent&&d.fireEvent&&(d.attachEvent("onclick",u=function(){s.noCloneEvent=!1}),d.cloneNode(!0).fireEvent("onclick"),d.detachEvent("onclick",u)),r=B.createElement("input"),r.value="t",r.setAttribute("type","radio"),s.radioValue=r.value==="t",r.setAttribute("checked","checked"),r.setAttribute("name","t"),d.appendChild(r),a=B.createDocumentFragment(),a.appendChild(d.lastChild),s.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,s.appendChecked=r.checked,a.removeChild(r),a.appendChild(d);if(d.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})o="on"+l,c=o in d,c||(d.setAttribute(o,"return;"),c=typeof d[o]=="function"),s[l+"Bubbles"]=c;return ge(function(){var e,t,i,n,r="padding:0;margin:0;border:0;display:block;overflow:hidden;",a=B.getElementsByTagName("body")[0];if(!a)return;e=B.createElement("div"),e.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",a.insertBefore(e,a.firstChild),t=B.createElement("div"),e.appendChild(t),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=t.getElementsByTagName("td"),i[0].style.cssText="padding:0;margin:0;border:0;display:none",c=i[0].offsetHeight===0,i[0].style.display="",i[1].style.display="none",s.reliableHiddenOffsets=c&&i[0].offsetHeight===0,t.innerHTML="",t.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",s.boxSizing=t.offsetWidth===4,s.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,v.getComputedStyle&&(s.pixelPosition=(v.getComputedStyle(t,null)||{}).top!=="1%",s.boxSizingReliable=(v.getComputedStyle(t,null)||{width:"4px"}).width==="4px",n=B.createElement("div"),n.style.cssText=t.style.cssText=r,n.style.marginRight=n.style.width="0",t.style.width="1px",t.appendChild(n),s.reliableMarginRight=!parseFloat((v.getComputedStyle(n,null)||{}).marginRight)),typeof t.style.zoom!="undefined"&&(t.innerHTML="",t.style.cssText=r+"width:1px;padding:1px;display:inline;zoom:1",s.inlineBlockNeedsLayout=t.offsetWidth===3,t.style.display="block",t.style.overflow="visible",t.innerHTML="<div></div>",t.firstChild.style.width="5px",s.shrinkWrapBlocks=t.offsetWidth!==3,e.style.zoom=1),a.removeChild(e),e=t=i=n=null}),a.removeChild(d),e=t=i=n=r=a=d=null,s}();var pe=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,me=/([A-Z])/g;ge.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(ge.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?ge.cache[e[ge.expando]]:e[ge.expando],!!e&&!c(e)},data:function(e,t,i,n){if(!ge.acceptData(e))return;var r,a,s=ge.expando,o=typeof t=="string",l=e.nodeType,c=l?ge.cache:e,u=l?e[s]:e[s]&&s;if((!u||!c[u]||!n&&!c[u].data)&&o&&i===T)return;u||(l?e[s]=u=ge.deletedIds.pop()||ge.guid++:u=s),c[u]||(c[u]={},l||(c[u].toJSON=ge.noop));if(typeof t=="object"||typeof t=="function")n?c[u]=ge.extend(c[u],t):c[u].data=ge.extend(c[u].data,t);return r=c[u],n||(r.data||(r.data={}),r=r.data),i!==T&&(r[ge.camelCase(t)]=i),o?(a=r[t],a==null&&(a=r[ge.camelCase(t)])):a=r,a},removeData:function(e,t,i){if(!ge.acceptData(e))return;var n,r,a,s=e.nodeType,o=s?ge.cache:e,l=s?e[ge.expando]:ge.expando;if(!o[l])return;if(t){n=i?o[l]:o[l].data;if(n){ge.isArray(t)||(t in n?t=[t]:(t=ge.camelCase(t),t in n?t=[t]:t=t.split(" ")));for(r=0,a=t.length;r<a;r++)delete n[t[r]];if(!(i?c:ge.isEmptyObject)(n))return}}if(!i){delete o[l].data;if(!c(o[l]))return}s?ge.cleanData([e],!0):ge.support.deleteExpando||o!=o.window?delete o[l]:o[l]=null},_data:function(e,t,i){return ge.data(e,t,i,!0)},acceptData:function(e){var t=e.nodeName&&ge.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),ge.fn.extend({data:function(i,e){var n,r,t,a,s,o=this[0],l=0,c=null;if(i===T){if(this.length){c=ge.data(o);if(o.nodeType===1&&!ge._data(o,"parsedAttrs")){t=o.attributes;for(s=t.length;l<s;l++)a=t[l].name,a.indexOf("data-")||(a=ge.camelCase(a.substring(5)),u(o,a,c[a]));ge._data(o,"parsedAttrs",!0)}}return c}return typeof i=="object"?this.each(function(){ge.data(this,i)}):(n=i.split(".",2),n[1]=n[1]?"."+n[1]:"",r=n[1]+"!",ge.access(this,function(t){if(t===T)return c=this.triggerHandler("getData"+r,[n[0]]),c===T&&o&&(c=ge.data(o,i),c=u(o,i,c)),c===T&&n[1]?this.data(n[0]):c;n[1]=t,this.each(function(){var e=ge(this);e.triggerHandler("setData"+r,n),ge.data(this,i,t),e.triggerHandler("changeData"+r,n)})},null,e,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){ge.removeData(this,e)})}}),ge.extend({queue:function(e,t,i){var n;if(e)return t=(t||"fx")+"queue",n=ge._data(e,t),i&&(!n||ge.isArray(i)?n=ge._data(e,t,ge.makeArray(i)):n.push(i)),n||[]},dequeue:function(e,t){t=t||"fx";var i=ge.queue(e,t),n=i.length,r=i.shift(),a=ge._queueHooks(e,t),s=function(){ge.dequeue(e,t)};r==="inprogress"&&(r=i.shift(),n--),r&&(t==="fx"&&i.unshift("inprogress"),delete a.stop,r.call(e,s,a)),!n&&a&&a.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return ge._data(e,i)||ge._data(e,i,{empty:ge.Callbacks("once memory").add(function(){ge.removeData(e,t+"queue",!0),ge.removeData(e,i,!0)})})}}),ge.fn.extend({queue:function(t,i){var e=2;return typeof t!="string"&&(i=t,t="fx",e--),arguments.length<e?ge.queue(this[0],t):i===T?this:this.each(function(){var e=ge.queue(this,t,i);ge._queueHooks(this,t),t==="fx"&&e[0]!=="inprogress"&&ge.dequeue(this,t)})},dequeue:function(e){return this.each(function(){ge.dequeue(this,e)})},delay:function(n,e){return n=ge.fx?ge.fx.speeds[n]||n:n,e=e||"fx",this.queue(e,function(e,t){var i=setTimeout(e,n);t.stop=function(){clearTimeout(i)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,r=ge.Deferred(),a=this,s=this.length,o=function(){--n||r.resolveWith(a,[a])};typeof e!="string"&&(t=e,e=T),e=e||"fx";while(s--)i=ge._data(a[s],e+"queueHooks"),i&&i.empty&&(n++,i.empty.add(o));return o(),r.promise(t)}});var ve,ye,_e,be=/[\t\r\n]/g,we=/\r/g,xe=/^(?:button|input)$/i,Ce=/^(?:button|input|object|select|textarea)$/i,Te=/^a(?:rea|)$/i,ke=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Me=ge.support.getSetAttribute;ge.fn.extend({attr:function(e,t){return ge.access(this,ge.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ge.removeAttr(this,e)})},prop:function(e,t){return ge.access(this,ge.prop,e,t,arguments.length>1)},removeProp:function(e){return e=ge.propFix[e]||e,this.each(function(){try{this[e]=T,delete this[e]}catch(e){}})},addClass:function(t){var e,i,n,r,a,s,o;if(ge.isFunction(t))return this.each(function(e){ge(this).addClass(t.call(this,e,this.className))});if(t&&typeof t=="string"){e=t.split(ee);for(i=0,n=this.length;i<n;i++){r=this[i];if(r.nodeType===1)if(!r.className&&e.length===1)r.className=t;else{a=" "+r.className+" ";for(s=0,o=e.length;s<o;s++)a.indexOf(" "+e[s]+" ")<0&&(a+=e[s]+" ");r.className=ge.trim(a)}}}return this},removeClass:function(t){var e,i,n,r,a,s,o;if(ge.isFunction(t))return this.each(function(e){ge(this).removeClass(t.call(this,e,this.className))});if(t&&typeof t=="string"||t===T){e=(t||"").split(ee);for(s=0,o=this.length;s<o;s++){n=this[s];if(n.nodeType===1&&n.className){i=(" "+n.className+" ").replace(be," ");for(r=0,a=e.length;r<a;r++)while(i.indexOf(" "+e[r]+" ")>=0)i=i.replace(" "+e[r]+" "," ");n.className=t?ge.trim(i):""}}}return this},toggleClass:function(a,s){var o=typeof a,l=typeof s=="boolean";return ge.isFunction(a)?this.each(function(e){ge(this).toggleClass(a.call(this,e,this.className,s),s)}):this.each(function(){if(o==="string"){var e,t=0,i=ge(this),n=s,r=a.split(ee);while(e=r[t++])n=l?n:!i.hasClass(e),i[n?"addClass":"removeClass"](e)}else if(o==="undefined"||o==="boolean")this.className&&ge._data(this,"__className__",this.className),this.className=this.className||a===!1?"":ge._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",i=0,n=this.length;for(;i<n;i++)if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(be," ").indexOf(t)>=0)return!0;return!1},val:function(n){var r,e,a,t=this[0];if(!arguments.length){if(t)return r=ge.valHooks[t.type]||ge.valHooks[t.nodeName.toLowerCase()],r&&"get"in r&&(e=r.get(t,"value"))!==T?e:(e=t.value,typeof e=="string"?e.replace(we,""):e==null?"":e);return}return a=ge.isFunction(n),this.each(function(e){var t,i=ge(this);if(this.nodeType!==1)return;a?t=n.call(this,e,i.val()):t=n,t==null?t="":typeof t=="number"?t+="":ge.isArray(t)&&(t=ge.map(t,function(e){return e==null?"":e+""})),r=ge.valHooks[this.type]||ge.valHooks[this.nodeName.toLowerCase()];if(!r||!("set"in r)||r.set(this,t,"value")===T)this.value=t})}}),ge.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,i,n=e.options,r=e.selectedIndex,a=e.type==="select-one"||r<0,s=a?null:[],o=a?r+1:n.length,l=r<0?o:a?r:0;for(;l<o;l++){i=n[l];if((i.selected||l===r)&&(ge.support.optDisabled?!i.disabled:i.getAttribute("disabled")===null)&&(!i.parentNode.disabled||!ge.nodeName(i.parentNode,"optgroup"))){t=ge(i).val();if(a)return t;s.push(t)}}return s},set:function(e,t){var i=ge.makeArray(t);return ge(e).find("option").each(function(){this.selected=ge.inArray(ge(this).val(),i)>=0}),i.length||(e.selectedIndex=-1),i}}},attrFn:{},attr:function(e,t,i,n){var r,a,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;if(n&&ge.isFunction(ge.fn[t]))return ge(e)[t](i);if(typeof e.getAttribute=="undefined")return ge.prop(e,t,i);s=o!==1||!ge.isXMLDoc(e),s&&(t=t.toLowerCase(),a=ge.attrHooks[t]||(ke.test(t)?ye:ve));if(i!==T){if(i===null){ge.removeAttr(e,t);return}return a&&"set"in a&&s&&(r=a.set(e,i,t))!==T?r:(e.setAttribute(t,i+""),i)}return a&&"get"in a&&s&&(r=a.get(e,t))!==null?r:(r=e.getAttribute(t),r===null?T:r)},removeAttr:function(e,t){var i,n,r,a,s=0;if(t&&e.nodeType===1){n=t.split(ee);for(;s<n.length;s++)r=n[s],r&&(i=ge.propFix[r]||r,a=ke.test(r),a||ge.attr(e,r,""),e.removeAttribute(Me?r:i),a&&i in e&&(e[i]=!1))}},attrHooks:{type:{set:function(e,t){if(xe.test(e.nodeName)&&e.parentNode)ge.error("type property can't be changed");else if(!ge.support.radioValue&&t==="radio"&&ge.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}},value:{get:function(e,t){return ve&&ge.nodeName(e,"button")?ve.get(e,t):t in e?e.value:null},set:function(e,t,i){if(ve&&ge.nodeName(e,"button"))return ve.set(e,t,i);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,t,i){var n,r,a,s=e.nodeType;if(!e||s===3||s===8||s===2)return;return a=s!==1||!ge.isXMLDoc(e),a&&(t=ge.propFix[t]||t,r=ge.propHooks[t]),i!==T?r&&"set"in r&&(n=r.set(e,i,t))!==T?n:e[t]=i:r&&"get"in r&&(n=r.get(e,t))!==null?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=e.getAttributeNode("tabindex");return t&&t.specified?parseInt(t.value,10):Ce.test(e.nodeName)||Te.test(e.nodeName)&&e.href?0:T}}}}),ye={get:function(e,t){var i,n=ge.prop(e,t);return n===!0||typeof n!="boolean"&&(i=e.getAttributeNode(t))&&i.nodeValue!==!1?t.toLowerCase():T},set:function(e,t,i){var n;return t===!1?ge.removeAttr(e,i):(n=ge.propFix[i]||i,n in e&&(e[n]=!0),e.setAttribute(i,i.toLowerCase())),i}},Me||(_e={name:!0,id:!0,coords:!0},ve=ge.valHooks.button={get:function(e,t){var i;return i=e.getAttributeNode(t),i&&(_e[t]?i.value!=="":i.specified)?i.value:T},set:function(e,t,i){var n=e.getAttributeNode(i);return n||(n=B.createAttribute(i),e.setAttributeNode(n)),n.value=t+""}},ge.each(["width","height"],function(e,i){ge.attrHooks[i]=ge.extend(ge.attrHooks[i],{set:function(e,t){if(t==="")return e.setAttribute(i,"auto"),t}})}),ge.attrHooks.contenteditable={get:ve.get,set:function(e,t,i){t===""&&(t="false"),ve.set(e,t,i)}}),ge.support.hrefNormalized||ge.each(["href","src","width","height"],function(e,i){ge.attrHooks[i]=ge.extend(ge.attrHooks[i],{get:function(e){var t=e.getAttribute(i,2);return t===null?T:t}})}),ge.support.style||(ge.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||T},set:function(e,t){return e.style.cssText=t+""}}),ge.support.optSelected||(ge.propHooks.selected=ge.extend(ge.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),ge.support.enctype||(ge.propFix.enctype="encoding"),ge.support.checkOn||ge.each(["radio","checkbox"],function(){ge.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),ge.each(["radio","checkbox"],function(){ge.valHooks[this]=ge.extend(ge.valHooks[this],{set:function(e,t){if(ge.isArray(t))return e.checked=ge.inArray(ge(e).val(),t)>=0}})});var Se=/^(?:textarea|input|select)$/i,Le=/^([^\.]*|)(?:\.(.+)|)$/,De=/(?:^|\s)hover(\.\S+|)\b/,je=/^key/,Ie=/^(?:mouse|contextmenu)|click/,Ee=/^(?:focusinfocus|focusoutblur)$/,Ae=function(e){return ge.event.special.hover?e:e.replace(De,"mouseenter$1 mouseleave$1")};ge.event={add:function(e,t,i,n,r){var a,s,o,l,c,u,d,h,f,p,g;if(e.nodeType===3||e.nodeType===8||!t||!i||!(a=ge._data(e)))return;i.handler&&(f=i,i=f.handler,r=f.selector),i.guid||(i.guid=ge.guid++),o=a.events,o||(a.events=o={}),s=a.handle,s||(a.handle=s=function(e){return typeof ge=="undefined"||!!e&&ge.event.triggered===e.type?T:ge.event.dispatch.apply(s.elem,arguments)},s.elem=e),t=ge.trim(Ae(t)).split(" ");for(l=0;l<t.length;l++){c=Le.exec(t[l])||[],u=c[1],d=(c[2]||"").split(".").sort(),g=ge.event.special[u]||{},u=(r?g.delegateType:g.bindType)||u,g=ge.event.special[u]||{},h=ge.extend({type:u,origType:c[1],data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&ge.expr.match.needsContext.test(r),namespace:d.join(".")},f),p=o[u];if(!p){p=o[u]=[],p.delegateCount=0;if(!g.setup||g.setup.call(e,n,d,s)===!1)e.addEventListener?e.addEventListener(u,s,!1):e.attachEvent&&e.attachEvent("on"+u,s)}g.add&&(g.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),r?p.splice(p.delegateCount++,0,h):p.push(h),ge.event.global[u]=!0}e=null},global:{},remove:function(e,t,i,n,r){var a,s,o,l,c,u,d,h,f,p,g,m=ge.hasData(e)&&ge._data(e);if(!m||!(h=m.events))return;t=ge.trim(Ae(t||"")).split(" ");for(a=0;a<t.length;a++){s=Le.exec(t[a])||[],o=l=s[1],c=s[2];if(!o){for(o in h)ge.event.remove(e,o+t[a],i,n,!0);continue}f=ge.event.special[o]||{},o=(n?f.delegateType:f.bindType)||o,p=h[o]||[],u=p.length,c=c?new RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(d=0;d<p.length;d++)g=p[d],(r||l===g.origType)&&(!i||i.guid===g.guid)&&(!c||c.test(g.namespace))&&(!n||n===g.selector||n==="**"&&g.selector)&&(p.splice(d--,1),g.selector&&p.delegateCount--,f.remove&&f.remove.call(e,g));p.length===0&&u!==p.length&&((!f.teardown||f.teardown.call(e,c,m.handle)===!1)&&ge.removeEvent(e,o,m.handle),delete h[o])}ge.isEmptyObject(h)&&(delete m.handle,ge.removeData(e,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(e,t,i,n){if(!i||i.nodeType!==3&&i.nodeType!==8){var r,a,s,o,l,c,u,d,h,f,p=e.type||e,g=[];if(Ee.test(p+ge.event.triggered))return;p.indexOf("!")>=0&&(p=p.slice(0,-1),a=!0),p.indexOf(".")>=0&&(g=p.split("."),p=g.shift(),g.sort());if((!i||ge.event.customEvent[p])&&!ge.event.global[p])return;e=typeof e=="object"?e[ge.expando]?e:new ge.Event(p,e):new ge.Event(p),e.type=p,e.isTrigger=!0,e.exclusive=a,e.namespace=g.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c=p.indexOf(":")<0?"on"+p:"";if(!i){r=ge.cache;for(s in r)r[s].events&&r[s].events[p]&&ge.event.trigger(e,t,r[s].handle.elem,!0);return}e.result=T,e.target||(e.target=i),t=t!=null?ge.makeArray(t):[],t.unshift(e),u=ge.event.special[p]||{};if(u.trigger&&u.trigger.apply(i,t)===!1)return;h=[[i,u.bindType||p]];if(!n&&!u.noBubble&&!ge.isWindow(i)){f=u.delegateType||p,o=Ee.test(f+p)?i:i.parentNode;for(l=i;o;o=o.parentNode)h.push([o,f]),l=o;l===(i.ownerDocument||B)&&h.push([l.defaultView||l.parentWindow||v,f])}for(s=0;s<h.length&&!e.isPropagationStopped();s++)o=h[s][0],e.type=h[s][1],d=(ge._data(o,"events")||{})[e.type]&&ge._data(o,"handle"),d&&d.apply(o,t),d=c&&o[c],d&&ge.acceptData(o)&&d.apply&&d.apply(o,t)===!1&&e.preventDefault();return e.type=p,!n&&!e.isDefaultPrevented()&&(!u._default||u._default.apply(i.ownerDocument,t)===!1)&&(p!=="click"||!ge.nodeName(i,"a"))&&ge.acceptData(i)&&c&&i[p]&&(p!=="focus"&&p!=="blur"||e.target.offsetWidth!==0)&&!ge.isWindow(i)&&(l=i[c],l&&(i[c]=null),ge.event.triggered=p,i[p](),ge.event.triggered=T,l&&(i[c]=l)),e.result}return},dispatch:function(e){e=ge.event.fix(e||v.event);var t,i,n,r,a,s,o,l,c,u,d=(ge._data(this,"events")||{})[e.type]||[],h=d.delegateCount,f=$.call(arguments),p=!e.exclusive&&!e.namespace,g=ge.event.special[e.type]||{},m=[];f[0]=e,e.delegateTarget=this;if(g.preDispatch&&g.preDispatch.call(this,e)===!1)return;if(h&&(!e.button||e.type!=="click"))for(n=e.target;n!=this;n=n.parentNode||this)if(n.disabled!==!0||e.type!=="click"){a={},o=[];for(t=0;t<h;t++)l=d[t],c=l.selector,a[c]===T&&(a[c]=l.needsContext?ge(c,this).index(n)>=0:ge.find(c,this,null,[n]).length),a[c]&&o.push(l);o.length&&m.push({elem:n,matches:o})}d.length>h&&m.push({elem:this,matches:d.slice(h)});for(t=0;t<m.length&&!e.isPropagationStopped();t++){s=m[t],e.currentTarget=s.elem;for(i=0;i<s.matches.length&&!e.isImmediatePropagationStopped();i++){l=s.matches[i];if(p||!e.namespace&&!l.namespace||e.namespace_re&&e.namespace_re.test(l.namespace))e.data=l.data,e.handleObj=l,r=((ge.event.special[l.origType]||{}).handle||l.handler).apply(s.elem,f),r!==T&&(e.result=r,r===!1&&(e.preventDefault(),e.stopPropagation()))}}return g.postDispatch&&g.postDispatch.call(this,e),e.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,n,r,a=t.button,s=t.fromElement;return e.pageX==null&&t.clientX!=null&&(i=e.target.ownerDocument||B,n=i.documentElement,r=i.body,e.pageX=t.clientX+(n&&n.scrollLeft||r&&r.scrollLeft||0)-(n&&n.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||r&&r.scrollTop||0)-(n&&n.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?t.toElement:s),!e.which&&a!==T&&(e.which=a&1?1:a&2?3:a&4?2:0),e}},fix:function(e){if(e[ge.expando])return e;var t,i,n=e,r=ge.event.fixHooks[e.type]||{},a=r.props?this.props.concat(r.props):this.props;e=ge.Event(n);for(t=a.length;t;)i=a[--t],e[i]=n[i];return e.target||(e.target=n.srcElement||B),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,r.filter?r.filter(e,n):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,i){ge.isWindow(this)&&(this.onbeforeunload=i)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,i,n){var r=ge.extend(new ge.Event,i,{type:e,isSimulated:!0,originalEvent:{}});n?ge.event.trigger(r,null,t):ge.event.dispatch.call(t,r),r.isDefaultPrevented()&&i.preventDefault()}},ge.event.handle=ge.event.dispatch,ge.removeEvent=B.removeEventListener?function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)}:function(e,t,i){var n="on"+t;e.detachEvent&&(typeof e[n]=="undefined"&&(e[n]=null),e.detachEvent(n,i))},ge.Event=function(e,t){if(!(this instanceof ge.Event))return new ge.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?i:o):this.type=e,t&&ge.extend(this,t),this.timeStamp=e&&e.timeStamp||ge.now(),this[ge.expando]=!0},ge.Event.prototype={preventDefault:function(){this.isDefaultPrevented=i;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=i;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=i,this.stopPropagation()},isDefaultPrevented:o,isPropagationStopped:o,isImmediatePropagationStopped:o},ge.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,s){ge.event.special[e]={delegateType:s,bindType:s,handle:function(e){var t,i=this,n=e.relatedTarget,r=e.handleObj,a=r.selector;if(!n||n!==i&&!ge.contains(i,n))e.type=r.origType,t=r.handler.apply(this,arguments),e.type=s;return t}}}),ge.support.submitBubbles||(ge.event.special.submit={setup:function(){if(ge.nodeName(this,"form"))return!1;ge.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,i=ge.nodeName(t,"input")||ge.nodeName(t,"button")?t.form:T;i&&!ge._data(i,"_submit_attached")&&(ge.event.add(i,"submit._submit",function(e){e._submit_bubble=!0}),ge._data(i,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&ge.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(ge.nodeName(this,"form"))return!1;ge.event.remove(this,"._submit")}}),ge.support.changeBubbles||(ge.event.special.change={setup:function(){if(Se.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")ge.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),ge.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),ge.event.simulate("change",this,e,!0)});return!1}ge.event.add(this,"beforeactivate._change",function(e){var t=e.target;Se.test(t.nodeName)&&!ge._data(t,"_change_attached")&&(ge.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&ge.event.simulate("change",this.parentNode,e,!0)}),ge._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return ge.event.remove(this,"._change"),!Se.test(this.nodeName)}}),ge.support.focusinBubbles||ge.each({focus:"focusin",blur:"focusout"},function(e,t){var i=0,n=function(e){ge.event.simulate(t,e.target,ge.event.fix(e),!0)};ge.event.special[t]={setup:function(){i++===0&&B.addEventListener(e,n,!0)},teardown:function(){--i===0&&B.removeEventListener(e,n,!0)}}}),ge.fn.extend({on:function(e,t,i,n,r){var a,s;if(typeof e=="object"){typeof t!="string"&&(i=i||t,t=T);for(s in e)this.on(s,t,i,e[s],r);return this}i==null&&n==null?(n=t,i=t=T):n==null&&(typeof t=="string"?(n=i,i=T):(n=i,i=t,t=T));if(n===!1)n=o;else if(!n)return this;return r===1&&(a=n,n=function(e){return ge().off(e),a.apply(this,arguments)},n.guid=a.guid||(a.guid=ge.guid++)),this.each(function(){ge.event.add(this,e,n,i,t)})},one:function(e,t,i,n){return this.on(e,t,i,n,1)},off:function(e,t,i){var n,r;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,ge(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if(typeof e=="object"){for(r in e)this.off(r,t,e[r]);return this}if(t===!1||typeof t=="function")i=t,t=T;return i===!1&&(i=o),this.each(function(){ge.event.remove(this,e,i,t)})},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,i){return ge(this.context).on(e,this.selector,t,i),this},die:function(e,t){return ge(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",i)},trigger:function(e,t){return this.each(function(){ge.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return ge.event.trigger(e,t,this[0],!0)},toggle:function(i){var n=arguments,e=i.guid||ge.guid++,r=0,t=function(e){var t=(ge._data(this,"lastToggle"+i.guid)||0)%r;return ge._data(this,"lastToggle"+i.guid,t+1),e.preventDefault(),n[t].apply(this,arguments)||!1};t.guid=e;while(r<n.length)n[r++].guid=e;return this.click(t)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),ge.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,i){ge.fn[i]=function(e,t){return t==null&&(t=e,e=null),arguments.length>0?this.on(i,null,e,t):this.trigger(i)},je.test(i)&&(ge.event.fixHooks[i]=ge.event.keyHooks),Ie.test(i)&&(ge.event.fixHooks[i]=ge.event.mouseHooks)}),function(e,r){function w(e,t,i,n){i=i||[],t=t||I;var r,a,s,o,l=t.nodeType;if(!e||typeof e!="string")return i;if(l!==1&&l!==9)return[];s=g(t);if(!s&&!n)if(r=te.exec(e))if(o=r[1]){if(l===9){a=t.getElementById(o);if(!a||!a.parentNode)return i;if(a.id===o)return i.push(a),i}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(o))&&m(t,a)&&a.id===o)return i.push(a),i}else{if(r[2])return N.apply(i,R.call(t.getElementsByTagName(e),0)),i;if((o=r[3])&&fe&&t.getElementsByClassName)return N.apply(i,R.call(t.getElementsByClassName(o),0)),i}return c(e.replace(Y,"$1"),t,i,n,s)}function t(i){return function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type===i}}function i(i){return function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&e.type===i}}function n(s){return z(function(a){return a=+a,z(function(e,t){var i,n=s([],e.length,a),r=n.length;while(r--)e[i=n[r]]&&(e[i]=!(t[i]=e[i]))})})}function u(e,t,i){if(e===t)return i;var n=e.nextSibling;while(n){if(n===t)return-1;n=n.nextSibling}return 1}function p(e,t){var i,n,r,a,s,o,l,c=W[D][e+" "];if(c)return t?0:c.slice(0);s=e,o=[],l=T.preFilter;while(s){if(!i||(n=Z.exec(s)))n&&(s=s.slice(n[0].length)||s),o.push(r=[]);i=!1;if(n=K.exec(s))r.push(i=new j(n.shift())),s=s.slice(i.length),i.type=n[0].replace(Y," ");for(a in T.filter)(n=le[a].exec(s))&&(!l[a]||(n=l[a](n)))&&(r.push(i=new j(n.shift())),s=s.slice(i.length),i.type=a,i.matches=n);if(!i)break}return t?s.length:s?w.error(e):W(e,o).slice(0)}function d(s,e,t){var o=e.dir,l=t&&e.dir==="parentNode",c=P++;return e.first?function(e,t,i){while(e=e[o])if(l||e.nodeType===1)return s(e,t,i)}:function(e,t,i){if(!i){var n,r=A+" "+c+" ",a=r+C;while(e=e[o])if(l||e.nodeType===1){if((n=e[D])===a)return e.sizset;if(typeof n=="string"&&n.indexOf(r)===0){if(e.sizset)return e}else{e[D]=a;if(s(e,t,i))return e.sizset=!0,e;e.sizset=!1}}}else while(e=e[o])if(l||e.nodeType===1)if(s(e,t,i))return e}}function h(r){return r.length>1?function(e,t,i){var n=r.length;while(n--)if(!r[n](e,t,i))return!1;return!0}:r[0]}function x(e,t,i,n,r){var a,s=[],o=0,l=e.length,c=t!=null;for(;o<l;o++)if(a=e[o])if(!i||i(a,n,r))s.push(a),c&&t.push(o);return s}function y(f,p,g,m,v,e){return m&&!m[D]&&(m=y(m)),v&&!v[D]&&(v=y(v,e)),z(function(e,t,i,n){var r,a,s,o=[],l=[],c=t.length,u=e||_(p||"*",i.nodeType?[i]:i,[]),d=f&&(e||!p)?x(u,o,f,i,n):u,h=g?v||(e?f:c||m)?[]:t:d;g&&g(d,h,i,n);if(m){r=x(h,l),m(r,[],i,n),a=r.length;while(a--)if(s=r[a])h[l[a]]=!(d[l[a]]=s)}if(e){if(v||f){if(v){r=[],a=h.length;while(a--)(s=h[a])&&r.push(d[a]=s);v(null,h=[],r,n)}a=h.length;while(a--)(s=h[a])&&(r=v?F.call(e,s):o[a])>-1&&(e[r]=!(t[r]=s))}}else h=x(h===t?h.splice(c,h.length):h),v?v(null,t,h,n):N.apply(t,h)})}function f(e){var n,t,i,r=e.length,a=T.relative[e[0].type],s=a||T.relative[" "],o=a?1:0,l=d(function(e){return e===n},s,!0),c=d(function(e){return F.call(n,e)>-1},s,!0),u=[function(e,t,i){return!a&&(i||t!==M)||((n=t).nodeType?l(e,t,i):c(e,t,i))}];for(;o<r;o++)if(t=T.relative[e[o].type])u=[d(h(u),t)];else{t=T.filter[e[o].type].apply(null,e[o].matches);if(t[D]){i=++o;for(;i<r;i++)if(T.relative[e[i].type])break;return y(o>1&&h(u),o>1&&e.slice(0,o-1).join("").replace(Y,"$1"),t,o<i&&f(e.slice(o,i)),i<r&&f(e=e.slice(i)),i<r&&e.join(""))}u.push(t)}return h(u)}function s(m,v){var y=v.length>0,_=m.length>0,b=function(e,t,i,n,r){var a,s,o,l=[],c=0,u="0",d=e&&[],h=r!=null,f=M,p=e||_&&T.find.TAG("*",r&&t.parentNode||t),g=A+=f==null?1:Math.E;h&&(M=t!==I&&t,C=b.el);for(;(a=p[u])!=null;u++){if(_&&a){for(s=0;o=m[s];s++)if(o(a,t,i)){n.push(a);break}h&&(A=g,C=++b.el)}y&&((a=!o&&a)&&c--,e&&d.push(a))}c+=u;if(y&&u!==c){for(s=0;o=v[s];s++)o(d,l,t,i);if(e){if(c>0)while(u--)!d[u]&&!l[u]&&(l[u]=O.call(n));l=x(l)}N.apply(n,l),h&&!e&&l.length>0&&c+v.length>1&&w.uniqueSort(n)}return h&&(A=g,M=f),d};return b.el=0,y?z(b):b}function _(e,t,i){var n=0,r=t.length;for(;n<r;n++)w(e,t[n],i);return i}function c(e,t,i,n,r){var a,s,o,l,c,u=p(e),d=u.length;if(!n&&u.length===1){s=u[0]=u[0].slice(0);if(s.length>2&&(o=s[0]).type==="ID"&&t.nodeType===9&&!r&&T.relative[s[1].type]){t=T.find.ID(o.matches[0].replace(oe,""),t,r)[0];if(!t)return i;e=e.slice(s.shift().length)}for(a=le.POS.test(e)?-1:s.length-1;a>=0;a--){o=s[a];if(T.relative[l=o.type])break;if(c=T.find[l])if(n=c(o.matches[0].replace(oe,""),ne.test(s[0].type)&&t.parentNode||t,r)){s.splice(a,1),e=n.length&&s.join("");if(!e)return N.apply(i,R.call(n,0)),i;break}}}return v(e,u)(n,t,r,i,ne.test(e)),i}function a(){}var C,o,T,l,g,m,v,b,k,M,S=!0,L="undefined",D=("sizcache"+Math.random()).replace(".",""),j=String,I=e.document,E=I.documentElement,A=0,P=0,O=[].pop,N=[].push,R=[].slice,F=[].indexOf||function(e){var t=0,i=this.length;for(;t<i;t++)if(this[t]===e)return t;return-1},z=function(e,t){return e[D]=t==null||t,e},H=function(){var i={},n=[];return z(function(e,t){return n.push(e)>T.cacheLength&&delete i[n.shift()],i[e+" "]=t},i)},B=H(),W=H(),q=H(),G="[\\x20\\t\\r\\n\\f]",V="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",U=V.replace("w","w#"),$="([*^$|!~]?=)",J="\\["+G+"*("+V+")"+G+"*(?:"+$+G+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+U+")|)|)"+G+"*\\]",Q=":("+V+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+J+")|[^:]|\\\\.)*|.*))\\)|)",X=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+G+"*((?:-\\d)?\\d*)"+G+"*\\)|)(?=[^-]|$)",Y=new RegExp("^"+G+"+|((?:^|[^\\\\])(?:\\\\.)*)"+G+"+$","g"),Z=new RegExp("^"+G+"*,"+G+"*"),K=new RegExp("^"+G+"*([\\x20\\t\\r\\n\\f>+~])"+G+"*"),ee=new RegExp(Q),te=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,ie=/^:not/,ne=/[\x20\t\r\n\f]*[+~]/,re=/:not\($/,ae=/h\d/i,se=/input|select|textarea|button/i,oe=/\\(?!\\)/g,le={ID:new RegExp("^#("+V+")"),CLASS:new RegExp("^\\.("+V+")"),NAME:new RegExp("^\\[name=['\"]?("+V+")['\"]?\\]"),TAG:new RegExp("^("+V.replace("w","w*")+")"),ATTR:new RegExp("^"+J),PSEUDO:new RegExp("^"+Q),POS:new RegExp(X,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+G+"*(even|odd|(([+-]|)(\\d*)n|)"+G+"*(?:([+-]|)"+G+"*(\\d+)|))"+G+"*\\)|)","i"),needsContext:new RegExp("^"+G+"*[>+~]|"+X,"i")},ce=function(e){var t=I.createElement("div");try{return e(t)}catch(e){return!1}finally{t=null}},ue=ce(function(e){return e.appendChild(I.createComment("")),!e.getElementsByTagName("*").length}),de=ce(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==L&&e.firstChild.getAttribute("href")==="#"}),he=ce(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),fe=ce(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),pe=ce(function(e){e.id=D+0,e.innerHTML="<a name='"+D+"'></a><div name='"+D+"'></div>",E.insertBefore(e,E.firstChild);var t=I.getElementsByName&&I.getElementsByName(D).length===2+I.getElementsByName(D+0).length;return o=!I.getElementById(D),E.removeChild(e),t});try{R.call(E.childNodes,0)[0].nodeType}catch(e){R=function(e){var t,i=[];for(;t=this[e];e++)i.push(t);return i}}w.matches=function(e,t){return w(e,null,null,t)},w.matchesSelector=function(e,t){return w(t,null,null,[e]).length>0},l=w.getText=function(e){var t,i="",n=0,r=e.nodeType;if(r){if(r===1||r===9||r===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=l(e)}else if(r===3||r===4)return e.nodeValue}else for(;t=e[n];n++)i+=l(t);return i},g=w.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},m=w.contains=E.contains?function(e,t){var i=e.nodeType===9?e.documentElement:e,n=t&&t.parentNode;return e===n||!!(n&&n.nodeType===1&&i.contains&&i.contains(n))}:E.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},w.attr=function(e,t){var i,n=g(e);return n||(t=t.toLowerCase()),(i=T.attrHandle[t])?i(e):n||he?e.getAttribute(t):(i=e.getAttributeNode(t),i?typeof e[t]=="boolean"?e[t]?t:null:i.specified?i.value:null:null)},T=w.selectors={cacheLength:50,createPseudo:z,match:le,attrHandle:de?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:o?function(e,t,i){if(typeof t.getElementById!==L&&!i){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}}:function(e,t,i){if(typeof t.getElementById!==L&&!i){var n=t.getElementById(e);return n?n.id===e||typeof n.getAttributeNode!==L&&n.getAttributeNode("id").value===e?[n]:r:[]}},TAG:ue?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var i=t.getElementsByTagName(e);if(e==="*"){var n,r=[],a=0;for(;n=i[a];a++)n.nodeType===1&&r.push(n);return r}return i},NAME:pe&&function(e,t){if(typeof t.getElementsByName!==L)return t.getElementsByName(name)},CLASS:fe&&function(e,t,i){if(typeof t.getElementsByClassName!==L&&!i)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(oe,""),e[3]=(e[4]||e[5]||"").replace(oe,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||w.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&w.error(e[0]),e},PSEUDO:function(e){var t,i;if(le.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])ee.test(t)&&(i=p(t,!0))&&(i=t.indexOf(")",t.length-i)-t.length)&&(t=t.slice(0,i),e[0]=e[0].slice(0,i)),e[2]=t;return e.slice(0,3)}},filter:{ID:o?function(t){return t=t.replace(oe,""),function(e){return e.getAttribute("id")===t}}:function(i){return i=i.replace(oe,""),function(e){var t=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return t&&t.value===i}},TAG:function(t){return t==="*"?function(){return!0}:(t=t.replace(oe,"").toLowerCase(),function(e){return e.nodeName&&e.nodeName.toLowerCase()===t})},CLASS:function(e){var t=B[D][e+" "];return t||(t=new RegExp("(^|"+G+")"+e+"("+G+"|$)"))&&B(e,function(e){return t.test(e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(n,r,a){return function(e,t){var i=w.attr(e,n);return i==null?r==="!=":r?(i+="",r==="="?i===a:r==="!="?i!==a:r==="^="?a&&i.indexOf(a)===0:r==="*="?a&&i.indexOf(a)>-1:r==="$="?a&&i.substr(i.length-a.length)===a:r==="~="?(" "+i+" ").indexOf(a)>-1:r==="|="?i===a||i.substr(0,a.length+1)===a+"-":!1):!0}},CHILD:function(i,e,r,a){return i==="nth"?function(e){var t,i,n=e.parentNode;if(r===1&&a===0)return!0;if(n){i=0;for(t=n.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=a,i===r||i%r===0&&i/r>=0}:function(e){var t=e;switch(i){case"only":case"first":while(t=t.previousSibling)if(t.nodeType===1)return!1;if(i==="first")return!0;t=e;case"last":while(t=t.nextSibling)if(t.nodeType===1)return!1;return!0}}},PSEUDO:function(e,a){var t,s=T.pseudos[e]||T.setFilters[e.toLowerCase()]||w.error("unsupported pseudo: "+e);return s[D]?s(a):s.length>1?(t=[e,e,"",a],T.setFilters.hasOwnProperty(e.toLowerCase())?z(function(e,t){var i,n=s(e,a),r=n.length;while(r--)i=F.call(e,n[r]),e[i]=!(t[i]=n[r])}):function(e){return s(e,0,t)}):s}},pseudos:{not:z(function(e){var n=[],r=[],o=v(e.replace(Y,"$1"));return o[D]?z(function(e,t,i,n){var r,a=o(e,null,n,[]),s=e.length;while(s--)if(r=a[s])e[s]=!(t[s]=r)}):function(e,t,i){return n[0]=e,o(n,null,i,r),!r.pop()}}),has:z(function(t){return function(e){return w(t,e).length>0}}),contains:z(function(t){return function(e){return(e.textContent||e.innerText||l(e)).indexOf(t)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!T.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return ae.test(e.nodeName)},text:function(e){var t,i;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((i=e.getAttribute("type"))==null||i.toLowerCase()===t)},radio:t("radio"),checkbox:t("checkbox"),file:t("file"),password:t("password"),image:t("image"),submit:i("submit"),reset:i("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return se.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:n(function(){return[0]}),last:n(function(e,t){return[t-1]}),eq:n(function(e,t,i){return[i<0?i+t:i]}),even:n(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:n(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:n(function(e,t,i){for(var n=i<0?i+t:i;--n>=0;)e.push(n);return e}),gt:n(function(e,t,i){for(var n=i<0?i+t:i;++n<t;)e.push(n);return e})}},b=E.compareDocumentPosition?function(e,t){return e===t?(k=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return k=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var i,n,r=[],a=[],s=e.parentNode,o=t.parentNode,l=s;if(s===o)return u(e,t);if(!s)return-1;if(!o)return 1;while(l)r.unshift(l),l=l.parentNode;l=o;while(l)a.unshift(l),l=l.parentNode;i=r.length,n=a.length;for(var c=0;c<i&&c<n;c++)if(r[c]!==a[c])return u(r[c],a[c]);return c===i?u(e,a[c],-1):u(r[c],t,1)},[0,0].sort(b),S=!k,w.uniqueSort=function(e){var t,i=[],n=1,r=0;k=S,e.sort(b);if(k){for(;t=e[n];n++)t===e[n-1]&&(r=i.push(n));while(r--)e.splice(i[r],1)}return e},w.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},v=w.compile=function(e,t){var i,n=[],r=[],a=q[D][e+" "];if(!a){t||(t=p(e)),i=t.length;while(i--)a=f(t[i]),a[D]?n.push(a):r.push(a);a=q(e,s(r,n))}return a},I.querySelectorAll&&function(){var n,d=c,h=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,f=[":focus"],a=[":active"],s=E.matchesSelector||E.mozMatchesSelector||E.webkitMatchesSelector||E.oMatchesSelector||E.msMatchesSelector;ce(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||f.push("\\["+G+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||f.push(":checked")}),ce(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&f.push("[*^$]="+G+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||f.push(":enabled",":disabled")}),f=new RegExp(f.join("|")),c=function(e,t,i,n,r){if(!n&&!r&&!f.test(e)){var a,s,o=!0,l=D,c=t,u=t.nodeType===9&&e;if(t.nodeType===1&&t.nodeName.toLowerCase()!=="object"){a=p(e),(o=t.getAttribute("id"))?l=o.replace(h,"\\$&"):t.setAttribute("id",l),l="[id='"+l+"'] ",s=a.length;while(s--)a[s]=l+a[s].join("");c=ne.test(e)&&t.parentNode||t,u=a.join(",")}if(u)try{return N.apply(i,R.call(c.querySelectorAll(u),0)),i}catch(e){}finally{o||t.removeAttribute("id")}}return d(e,t,i,n,r)},s&&(ce(function(e){n=s.call(e,"div");try{s.call(e,"[test!='']:sizzle"),a.push("!=",Q)}catch(e){}}),a=new RegExp(a.join("|")),w.matchesSelector=function(e,t){t=t.replace(r,"='$1']");if(!g(e)&&!a.test(t)&&!f.test(t))try{var i=s.call(e,t);if(i||n||e.document&&e.document.nodeType!==11)return i}catch(e){}return w(t,null,null,[e]).length>0})}(),T.pseudos.nth=T.pseudos.eq,T.filters=a.prototype=T.pseudos,T.setFilters=new a,w.attr=ge.attr,ge.find=w,ge.expr=w.selectors,ge.expr[":"]=ge.expr.pseudos,ge.unique=w.uniqueSort,ge.text=w.getText,ge.isXMLDoc=w.isXML,ge.contains=w.contains}(v);var Pe=/Until$/,Oe=/^(?:parents|prev(?:Until|All))/,Ne=/^.[^:#\[\.,]*$/,Re=ge.expr.match.needsContext,Fe={children:!0,contents:!0,next:!0,prev:!0};ge.fn.extend({find:function(e){var t,i,n,r,a,s,o=this;if(typeof e!="string")return ge(e).filter(function(){for(t=0,i=o.length;t<i;t++)if(ge.contains(o[t],this))return!0});s=this.pushStack("","find",e);for(t=0,i=this.length;t<i;t++){n=s.length,ge.find(e,this[t],s);if(t>0)for(r=n;r<s.length;r++)for(a=0;a<n;a++)if(s[a]===s[r]){s.splice(r--,1);break}}return s},has:function(e){var t,i=ge(e,this),n=i.length;return this.filter(function(){for(t=0;t<n;t++)if(ge.contains(this,i[t]))return!0})},not:function(e){return this.pushStack(n(this,e,!1),"not",e)},filter:function(e){return this.pushStack(n(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?Re.test(e)?ge(e,this.context).index(this[0])>=0:ge.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var i,n=0,r=this.length,a=[],s=Re.test(e)||typeof e!="string"?ge(e,t||this.context):0;for(;n<r;n++){i=this[n];while(i&&i.ownerDocument&&i!==t&&i.nodeType!==11){if(s?s.index(i)>-1:ge.find.matchesSelector(i,e)){a.push(i);break}i=i.parentNode}}return a=a.length>1?ge.unique(a):a,this.pushStack(a,"closest",e)},index:function(e){return e?typeof e=="string"?ge.inArray(this[0],ge(e)):ge.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var i=typeof e=="string"?ge(e,t):ge.makeArray(e&&e.nodeType?[e]:e),n=ge.merge(this.get(),i);return this.pushStack(r(i[0])||r(n[0])?n:ge.unique(n))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),ge.fn.andSelf=ge.fn.addBack,ge.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return ge.dir(e,"parentNode")},parentsUntil:function(e,t,i){return ge.dir(e,"parentNode",i)},next:function(e){return t(e,"nextSibling")},prev:function(e){return t(e,"previousSibling")},nextAll:function(e){return ge.dir(e,"nextSibling")},prevAll:function(e){return ge.dir(e,"previousSibling")},nextUntil:function(e,t,i){return ge.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return ge.dir(e,"previousSibling",i)},siblings:function(e){return ge.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ge.sibling(e.firstChild)},contents:function(e){return ge.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:ge.merge([],e.childNodes)}},function(n,r){ge.fn[n]=function(e,t){var i=ge.map(this,r,e);return Pe.test(n)||(t=e),t&&typeof t=="string"&&(i=ge.filter(t,i)),i=this.length>1&&!Fe[n]?ge.unique(i):i,this.length>1&&Oe.test(n)&&(i=i.reverse()),this.pushStack(i,n,$.call(arguments).join(","))}}),ge.extend({filter:function(e,t,i){return i&&(e=":not("+e+")"),t.length===1?ge.find.matchesSelector(t[0],e)?[t[0]]:[]:ge.find.matches(e,t)},dir:function(e,t,i){var n=[],r=e[t];while(r&&r.nodeType!==9&&(i===T||r.nodeType!==1||!ge(r).is(i)))r.nodeType===1&&n.push(r),r=r[t];return n},sibling:function(e,t){var i=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&i.push(e);return i}});var ze="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",He=/ jQuery\d+="(?:null|\d+)"/g,Be=/^\s+/,We=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,qe=/<([\w:]+)/,Ge=/<tbody/i,Ve=/<|&#?\w+;/,Ue=/<(?:script|style|link)/i,$e=/<(?:script|object|embed|option|style)/i,Je=new RegExp("<(?:"+ze+")[\\s/>]","i"),Qe=/^(?:checkbox|radio)$/,Xe=/checked\s*(?:[^=]|=\s*.checked.)/i,Ye=/\/(java|ecma)script/i,Ze=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Ke={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},et=y(B),tt=et.appendChild(B.createElement("div"));Ke.optgroup=Ke.option,Ke.tbody=Ke.tfoot=Ke.colgroup=Ke.caption=Ke.thead,Ke.th=Ke.td,ge.support.htmlSerialize||(Ke._default=[1,"X<div>","</div>"]),ge.fn.extend({text:function(e){return ge.access(this,function(e){return e===T?ge.text(this):this.empty().append((this[0]&&this[0].ownerDocument||B).createTextNode(e))},null,e,arguments.length)},wrapAll:function(t){if(ge.isFunction(t))return this.each(function(e){ge(this).wrapAll(t.call(this,e))});if(this[0]){var e=ge(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(i){return ge.isFunction(i)?this.each(function(e){ge(this).wrapInner(i.call(this,e))}):this.each(function(){var e=ge(this),t=e.contents();t.length?t.wrapAll(i):e.append(i)})},wrap:function(t){var i=ge.isFunction(t);return this.each(function(e){ge(this).wrapAll(i?t.call(this,e):t)})},unwrap:function(){return this.parent().each(function(){ge.nodeName(this,"body")||ge(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!r(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=ge.clean(arguments);return this.pushStack(ge.merge(e,this),"before",this.selector)}},after:function(){if(!r(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=ge.clean(arguments);return this.pushStack(ge.merge(this,e),"after",this.selector)}},remove:function(e,t){var i,n=0;for(;(i=this[n])!=null;n++)if(!e||ge.filter(e,[i]).length)!t&&i.nodeType===1&&(ge.cleanData(i.getElementsByTagName("*")),ge.cleanData([i])),i.parentNode&&i.parentNode.removeChild(i);return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&ge.cleanData(e.getElementsByTagName("*"));while(e.firstChild)e.removeChild(e.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return ge.clone(this,e,t)})},html:function(e){return ge.access(this,function(e){var t=this[0]||{},i=0,n=this.length;if(e===T)return t.nodeType===1?t.innerHTML.replace(He,""):T;if(typeof e=="string"&&!Ue.test(e)&&(ge.support.htmlSerialize||!Je.test(e))&&(ge.support.leadingWhitespace||!Be.test(e))&&!Ke[(qe.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(We,"<$1></$2>");try{for(;i<n;i++)t=this[i]||{},t.nodeType===1&&(ge.cleanData(t.getElementsByTagName("*")),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(n){return r(this[0])?this.length?this.pushStack(ge(ge.isFunction(n)?n():n),"replaceWith",n):this:ge.isFunction(n)?this.each(function(e){var t=ge(this),i=t.html();t.replaceWith(n.call(this,e,i))}):(typeof n!="string"&&(n=ge(n).detach()),this.each(function(){var e=this.nextSibling,t=this.parentNode;ge(this).remove(),e?ge(e).before(n):ge(t).append(n)}))},detach:function(e){return this.remove(e,!0)},domManip:function(i,n,r){i=[].concat.apply([],i);var e,t,a,s,o=0,l=i[0],c=[],u=this.length;if(!ge.support.checkClone&&u>1&&typeof l=="string"&&Xe.test(l))return this.each(function(){ge(this).domManip(i,n,r)});if(ge.isFunction(l))return this.each(function(e){var t=ge(this);i[0]=l.call(this,e,n?t.html():T),t.domManip(i,n,r)});if(this[0]){e=ge.buildFragment(i,this,c),a=e.fragment,t=a.firstChild,a.childNodes.length===1&&(a=t);if(t){n=n&&ge.nodeName(t,"tr");for(s=e.cacheable||u-1;o<u;o++)r.call(n&&ge.nodeName(this[o],"table")?d(this[o],"tbody"):this[o],o===s?a:ge.clone(a,!0,!0))}a=t=null,c.length&&ge.each(c,function(e,t){t.src?ge.ajax?ge.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,throws:!0}):ge.error("no ajax"):ge.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Ze,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),ge.buildFragment=function(e,t,i){var n,r,a,s=e[0];return t=t||B,t=!t.nodeType&&t[0]||t,t=t.ownerDocument||t,e.length===1&&typeof s=="string"&&s.length<512&&t===B&&s.charAt(0)==="<"&&!$e.test(s)&&(ge.support.checkClone||!Xe.test(s))&&(ge.support.html5Clone||!Je.test(s))&&(r=!0,n=ge.fragments[s],a=n!==T),n||(n=t.createDocumentFragment(),ge.clean(e,t,n,i),r&&(ge.fragments[s]=a&&n)),{fragment:n,cacheable:r}},ge.fragments={},ge.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(o,l){ge.fn[o]=function(e){var t,i=0,n=[],r=ge(e),a=r.length,s=this.length===1&&this[0].parentNode;if((s==null||s&&s.nodeType===11&&s.childNodes.length===1)&&a===1)return r[l](this[0]),this;for(;i<a;i++)t=(i>0?this.clone(!0):this).get(),ge(r[i])[l](t),n=n.concat(t);return this.pushStack(n,o,r.selector)}}),ge.extend({clone:function(e,t,i){var n,r,a,s;ge.support.html5Clone||ge.isXMLDoc(e)||!Je.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(tt.innerHTML=e.outerHTML,tt.removeChild(s=tt.firstChild));if((!ge.support.noCloneEvent||!ge.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!ge.isXMLDoc(e)){h(e,s),n=f(e),r=f(s);for(a=0;n[a];++a)r[a]&&h(n[a],r[a])}if(t){l(e,s);if(i){n=f(e),r=f(s);for(a=0;n[a];++a)l(n[a],r[a])}}return n=r=null,s},clean:function(e,t,i,n){var r,a,s,o,l,c,u,d,h,f,p,g,m=t===B&&et,v=[];if(!t||typeof t.createDocumentFragment=="undefined")t=B;for(r=0;(s=e[r])!=null;r++){typeof s=="number"&&(s+="");if(!s)continue;if(typeof s=="string")if(!Ve.test(s))s=t.createTextNode(s);else{m=m||y(t),u=t.createElement("div"),m.appendChild(u),s=s.replace(We,"<$1></$2>"),o=(qe.exec(s)||["",""])[1].toLowerCase(),l=Ke[o]||Ke._default,c=l[0],u.innerHTML=l[1]+s+l[2];while(c--)u=u.lastChild;if(!ge.support.tbody){d=Ge.test(s),h=o==="table"&&!d?u.firstChild&&u.firstChild.childNodes:l[1]==="<table>"&&!d?u.childNodes:[];for(a=h.length-1;a>=0;--a)ge.nodeName(h[a],"tbody")&&!h[a].childNodes.length&&h[a].parentNode.removeChild(h[a])}!ge.support.leadingWhitespace&&Be.test(s)&&u.insertBefore(t.createTextNode(Be.exec(s)[0]),u.firstChild),s=u.childNodes,u.parentNode.removeChild(u)}s.nodeType?v.push(s):ge.merge(v,s)}u&&(s=u=m=null);if(!ge.support.appendChecked)for(r=0;(s=v[r])!=null;r++)ge.nodeName(s,"input")?_(s):typeof s.getElementsByTagName!="undefined"&&ge.grep(s.getElementsByTagName("input"),_);if(i){p=function(e){if(!e.type||Ye.test(e.type))return n?n.push(e.parentNode?e.parentNode.removeChild(e):e):i.appendChild(e)};for(r=0;(s=v[r])!=null;r++)if(!ge.nodeName(s,"script")||!p(s))i.appendChild(s),typeof s.getElementsByTagName!="undefined"&&(g=ge.grep(ge.merge([],s.getElementsByTagName("script")),p),v.splice.apply(v,[r+1,0].concat(g)),r+=g.length)}return v},cleanData:function(e,t){var i,n,r,a,s=0,o=ge.expando,l=ge.cache,c=ge.support.deleteExpando,u=ge.event.special;for(;(r=e[s])!=null;s++)if(t||ge.acceptData(r)){n=r[o],i=n&&l[n];if(i){if(i.events)for(a in i.events)u[a]?ge.event.remove(r,a):ge.removeEvent(r,a,i.handle);l[n]&&(delete l[n],c?delete r[o]:r.removeAttribute?r.removeAttribute(o):r[o]=null,ge.deletedIds.push(n))}}}}),function(){var e,t;ge.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=ge.uaMatch(q.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),ge.browser=t,ge.sub=function(){function i(e,t){return new i.fn.init(e,t)}ge.extend(!0,i,this),i.superclass=this,i.fn=i.prototype=this(),i.fn.constructor=i,i.sub=this.sub,i.fn.init=function(e,t){return t&&t instanceof ge&&!(t instanceof i)&&(t=i(t)),ge.fn.init.call(this,e,t,n)},i.fn.init.prototype=i.fn;var n=i(B);return i}}();var it,nt,rt,at=/alpha\([^)]*\)/i,st=/opacity=([^)]*)/,ot=/^(top|right|bottom|left)$/,lt=/^(none|table(?!-c[ea]).+)/,ct=/^margin/,ut=new RegExp("^("+Z+")(.*)$","i"),dt=new RegExp("^("+Z+")(?!px)[a-z%]+$","i"),ht=new RegExp("^([-+])=("+Z+")","i"),ft={BODY:"block"},pt={position:"absolute",visibility:"hidden",display:"block"},gt={letterSpacing:0,fontWeight:400},mt=["Top","Right","Bottom","Left"],vt=["Webkit","O","Moz","ms"],yt=ge.fn.toggle;ge.fn.extend({css:function(e,t){return ge.access(this,function(e,t,i){return i!==T?ge.style(e,t,i):ge.css(e,t)},e,t,arguments.length>1)},show:function(){return a(this,!0)},hide:function(){return a(this)},toggle:function(e,t){var i=typeof e=="boolean";return ge.isFunction(e)&&ge.isFunction(t)?yt.apply(this,arguments):this.each(function(){(i?e:b(this))?ge(this).show():ge(this).hide()})}}),ge.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=it(e,"opacity");return i===""?"1":i}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:ge.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,i,n){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var r,a,s,o=ge.camelCase(t),l=e.style;t=ge.cssProps[o]||(ge.cssProps[o]=p(l,o)),s=ge.cssHooks[t]||ge.cssHooks[o];if(i===T)return s&&"get"in s&&(r=s.get(e,!1,n))!==T?r:l[t];a=typeof i,a==="string"&&(r=ht.exec(i))&&(i=(r[1]+1)*r[2]+parseFloat(ge.css(e,t)),a="number");if(i==null||a==="number"&&isNaN(i))return;a==="number"&&!ge.cssNumber[o]&&(i+="px");if(!s||!("set"in s)||(i=s.set(e,i,n))!==T)try{l[t]=i}catch(e){}},css:function(e,t,i,n){var r,a,s,o=ge.camelCase(t);return t=ge.cssProps[o]||(ge.cssProps[o]=p(e.style,o)),s=ge.cssHooks[t]||ge.cssHooks[o],s&&"get"in s&&(r=s.get(e,!0,n)),r===T&&(r=it(e,t)),r==="normal"&&t in gt&&(r=gt[t]),i||n!==T?(a=parseFloat(r),i||ge.isNumeric(a)?a||0:r):r},swap:function(e,t,i){var n,r,a={};for(r in t)a[r]=e.style[r],e.style[r]=t[r];n=i.call(e);for(r in t)e.style[r]=a[r];return n}}),v.getComputedStyle?it=function(e,t){var i,n,r,a,s=v.getComputedStyle(e,null),o=e.style;return s&&(i=s.getPropertyValue(t)||s[t],i===""&&!ge.contains(e.ownerDocument,e)&&(i=ge.style(e,t)),dt.test(i)&&ct.test(t)&&(n=o.width,r=o.minWidth,a=o.maxWidth,o.minWidth=o.maxWidth=o.width=i,i=s.width,o.width=n,o.minWidth=r,o.maxWidth=a)),i}:B.documentElement.currentStyle&&(it=function(e,t){var i,n,r=e.currentStyle&&e.currentStyle[t],a=e.style;return r==null&&a&&a[t]&&(r=a[t]),dt.test(r)&&!ot.test(t)&&(i=a.left,n=e.runtimeStyle&&e.runtimeStyle.left,n&&(e.runtimeStyle.left=e.currentStyle.left),a.left=t==="fontSize"?"1em":r,r=a.pixelLeft+"px",a.left=i,n&&(e.runtimeStyle.left=n)),r===""?"auto":r}),ge.each(["height","width"],function(e,n){ge.cssHooks[n]={get:function(e,t,i){if(t)return e.offsetWidth===0&&lt.test(it(e,"display"))?ge.swap(e,pt,function(){return m(e,n,i)}):m(e,n,i)},set:function(e,t,i){return s(e,t,i?g(e,n,i,ge.support.boxSizing&&ge.css(e,"boxSizing")==="border-box"):0)}}}),ge.support.opacity||(ge.cssHooks.opacity={get:function(e,t){return st.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var i=e.style,n=e.currentStyle,r=ge.isNumeric(t)?"alpha(opacity="+t*100+")":"",a=n&&n.filter||i.filter||"";i.zoom=1;if(t>=1&&ge.trim(a.replace(at,""))===""&&i.removeAttribute){i.removeAttribute("filter");if(n&&!n.filter)return}i.filter=at.test(a)?a.replace(at,r):a+" "+r}}),ge(function(){ge.support.reliableMarginRight||(ge.cssHooks.marginRight={get:function(e,t){return ge.swap(e,{display:"inline-block"},function(){if(t)return it(e,"marginRight")})}}),!ge.support.pixelPosition&&ge.fn.position&&ge.each(["top","left"],function(e,n){ge.cssHooks[n]={get:function(e,t){if(t){var i=it(e,n);return dt.test(i)?ge(e).position()[n]+"px":i}}}})}),ge.expr&&ge.expr.filters&&(ge.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!ge.support.reliableHiddenOffsets&&(e.style&&e.style.display||it(e,"display"))==="none"},ge.expr.filters.visible=function(e){return!ge.expr.filters.hidden(e)}),ge.each({margin:"",padding:"",border:"Width"},function(r,a){ge.cssHooks[r+a]={expand:function(e){var t,i=typeof e=="string"?e.split(" "):[e],n={};for(t=0;t<4;t++)n[r+mt[t]+a]=i[t]||i[t-2]||i[0];return n}},ct.test(r)||(ge.cssHooks[r+a].set=s)});var _t=/%20/g,bt=/\[\]$/,wt=/\r?\n/g,xt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ct=/^(?:select|textarea)/i;ge.fn.extend({serialize:function(){return ge.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?ge.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Ct.test(this.nodeName)||xt.test(this.type))}).map(function(e,i){var t=ge(this).val();return t==null?null:ge.isArray(t)?ge.map(t,function(e,t){return{name:i.name,value:e.replace(wt,"\r\n")}}):{name:i.name,value:t.replace(wt,"\r\n")}}).get()}}),ge.param=function(e,t){var i,n=[],r=function(e,t){t=ge.isFunction(t)?t():t==null?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===T&&(t=ge.ajaxSettings&&ge.ajaxSettings.traditional);if(ge.isArray(e)||e.jquery&&!ge.isPlainObject(e))ge.each(e,function(){r(this.name,this.value)});else for(i in e)x(i,e[i],t,r);return n.join("&").replace(_t,"+")};var Tt,kt,Mt=/#.*$/,St=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Lt=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Dt=/^(?:GET|HEAD)$/,jt=/^\/\//,It=/\?/,Et=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,At=/([?&])_=[^&]*/,Pt=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ot=ge.fn.load,Nt={},Rt={},Ft=["*/"]+["*"];try{kt=W.href}catch(e){kt=B.createElement("a"),kt.href="",kt=kt.href}Tt=Pt.exec(kt.toLowerCase())||[],ge.fn.load=function(e,t,i){if(typeof e!="string"&&Ot)return Ot.apply(this,arguments);if(!this.length)return this;var n,r,a,s=this,o=e.indexOf(" ");return o>=0&&(n=e.slice(o,e.length),e=e.slice(0,o)),ge.isFunction(t)?(i=t,t=T):t&&typeof t=="object"&&(r="POST"),ge.ajax({url:e,type:r,dataType:"html",data:t,complete:function(e,t){i&&s.each(i,a||[e.responseText,t,e])}}).done(function(e){a=arguments,s.html(n?ge("<div>").append(e.replace(Et,"")).find(n):e)}),this},ge.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){ge.fn[t]=function(e){return this.on(t,e)}}),ge.each(["get","post"],function(e,r){ge[r]=function(e,t,i,n){return ge.isFunction(t)&&(n=n||i,i=t,t=T),ge.ajax({type:r,url:e,data:t,success:i,dataType:n})}}),ge.extend({getScript:function(e,t){return ge.get(e,T,t,"script")},getJSON:function(e,t,i){return ge.get(e,t,i,"json")},ajaxSetup:function(e,t){return t?M(e,ge.ajaxSettings):(t=e,e=ge.ajaxSettings),M(e,t),e},ajaxSettings:{url:kt,isLocal:Lt.test(Tt[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Ft},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":v.String,"text html":!0,"text json":ge.parseJSON,"text xml":ge.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:C(Nt),ajaxTransport:C(Rt),ajax:function(e,t){function i(e,t,i,n){var r,a,s,o,l,c=t;if(w===2)return;w=2,f&&clearTimeout(f),h=T,d=n||"",x.readyState=e>0?4:0,i&&(o=S(g,x,i));if(e>=200&&e<300||e===304)g.ifModified&&(l=x.getResponseHeader("Last-Modified"),l&&(ge.lastModified[u]=l),l=x.getResponseHeader("Etag"),l&&(ge.etag[u]=l)),e===304?(c="notmodified",r=!0):(r=L(g,o),c=r.state,a=r.data,s=r.error,r=!s);else{s=c;if(!c||e)c="error",e<0&&(e=0)}x.status=e,x.statusText=(t||c)+"",r?y.resolveWith(m,[a,c,x]):y.rejectWith(m,[x,c,s]),x.statusCode(b),b=T,p&&v.trigger("ajax"+(r?"Success":"Error"),[x,g,r?a:s]),_.fireWith(m,[x,c]),p&&(v.trigger("ajaxComplete",[x,g]),--ge.active||ge.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=T),t=t||{};var u,d,n,h,f,r,p,a,g=ge.ajaxSetup({},t),m=g.context||g,v=m!==g&&(m.nodeType||m instanceof ge)?ge(m):ge.event,y=ge.Deferred(),_=ge.Callbacks("once memory"),b=g.statusCode||{},s={},o={},w=0,l="canceled",x={readyState:0,setRequestHeader:function(e,t){if(!w){var i=e.toLowerCase();e=o[i]=o[i]||e,s[e]=t}return this},getAllResponseHeaders:function(){return w===2?d:null},getResponseHeader:function(e){var t;if(w===2){if(!n){n={};while(t=St.exec(d))n[t[1].toLowerCase()]=t[2]}t=n[e.toLowerCase()]}return t===T?null:t},overrideMimeType:function(e){return w||(g.mimeType=e),this},abort:function(e){return e=e||l,h&&h.abort(e),i(0,e),this}};y.promise(x),x.success=x.done,x.error=x.fail,x.complete=_.add,x.statusCode=function(e){if(e){var t;if(w<2)for(t in e)b[t]=[b[t],e[t]];else t=e[x.status],x.always(t)}return this},g.url=((e||g.url)+"").replace(Mt,"").replace(jt,Tt[1]+"//"),g.dataTypes=ge.trim(g.dataType||"*").toLowerCase().split(ee),g.crossDomain==null&&(r=Pt.exec(g.url.toLowerCase()),g.crossDomain=!(!r||r[1]===Tt[1]&&r[2]===Tt[2]&&(r[3]||(r[1]==="http:"?80:443))==(Tt[3]||(Tt[1]==="http:"?80:443)))),g.data&&g.processData&&typeof g.data!="string"&&(g.data=ge.param(g.data,g.traditional)),k(Nt,g,t,x);if(w===2)return x;p=g.global,g.type=g.type.toUpperCase(),g.hasContent=!Dt.test(g.type),p&&ge.active++===0&&ge.event.trigger("ajaxStart");if(!g.hasContent){g.data&&(g.url+=(It.test(g.url)?"&":"?")+g.data,delete g.data),u=g.url;if(g.cache===!1){var c=ge.now(),C=g.url.replace(At,"$1_="+c);g.url=C+(C===g.url?(It.test(g.url)?"&":"?")+"_="+c:"")}}(g.data&&g.hasContent&&g.contentType!==!1||t.contentType)&&x.setRequestHeader("Content-Type",g.contentType),g.ifModified&&(u=u||g.url,ge.lastModified[u]&&x.setRequestHeader("If-Modified-Since",ge.lastModified[u]),ge.etag[u]&&x.setRequestHeader("If-None-Match",ge.etag[u])),x.setRequestHeader("Accept",g.dataTypes[0]&&g.accepts[g.dataTypes[0]]?g.accepts[g.dataTypes[0]]+(g.dataTypes[0]!=="*"?", "+Ft+"; q=0.01":""):g.accepts["*"]);for(a in g.headers)x.setRequestHeader(a,g.headers[a]);if(!g.beforeSend||g.beforeSend.call(m,x,g)!==!1&&w!==2){l="abort";for(a in{success:1,error:1,complete:1})x[a](g[a]);h=k(Rt,g,t,x);if(!h)i(-1,"No Transport");else{x.readyState=1,p&&v.trigger("ajaxSend",[x,g]),g.async&&g.timeout>0&&(f=setTimeout(function(){x.abort("timeout")},g.timeout));try{w=1,h.send(s,i)}catch(e){if(!(w<2))throw e;i(-1,e)}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var zt=[],Ht=/\?/,Bt=/(=)\?(?=&|$)|\?\?/,Wt=ge.now();ge.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||ge.expando+"_"+Wt++;return this[e]=!0,e}}),ge.ajaxPrefilter("json jsonp",function(e,t,i){var n,r,a,s=e.data,o=e.url,l=e.jsonp!==!1,c=l&&Bt.test(o),u=l&&!c&&typeof s=="string"&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bt.test(s);if(e.dataTypes[0]==="jsonp"||c||u)return n=e.jsonpCallback=ge.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,r=v[n],c?e.url=o.replace(Bt,"$1"+n):u?e.data=s.replace(Bt,"$1"+n):l&&(e.url+=(Ht.test(o)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return a||ge.error(n+" was not called"),a[0]},e.dataTypes[0]="json",v[n]=function(){a=arguments},i.always(function(){v[n]=r,e[n]&&(e.jsonpCallback=t.jsonpCallback,zt.push(n)),a&&ge.isFunction(r)&&r(a[0]),a=r=T}),"script"}),ge.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return ge.globalEval(e),e}}}),ge.ajaxPrefilter("script",function(e){e.cache===T&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),ge.ajaxTransport("script",function(t){if(t.crossDomain){var n,r=B.head||B.getElementsByTagName("head")[0]||B.documentElement;return{send:function(e,i){n=B.createElement("script"),n.async="async",t.scriptCharset&&(n.charset=t.scriptCharset),n.src=t.url,n.onload=n.onreadystatechange=function(e,t){if(t||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=T,t||i(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var qt,Gt=v.ActiveXObject?function(){for(var e in qt)qt[e](0,1)}:!1,Vt=0;ge.ajaxSettings.xhr=v.ActiveXObject?function(){return!this.isLocal&&D()||j()}:D,function(e){ge.extend(ge.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(ge.ajaxSettings.xhr()),ge.support.ajax&&ge.ajaxTransport(function(u){if(!u.crossDomain||ge.support.cors){var d;return{send:function(e,o){var l,t,c=u.xhr();u.username?c.open(u.type,u.url,u.async,u.username,u.password):c.open(u.type,u.url,u.async);if(u.xhrFields)for(t in u.xhrFields)c[t]=u.xhrFields[t];u.mimeType&&c.overrideMimeType&&c.overrideMimeType(u.mimeType),!u.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(t in e)c.setRequestHeader(t,e[t])}catch(e){}c.send(u.hasContent&&u.data||null),d=function(e,t){var i,n,r,a,s;try{if(d&&(t||c.readyState===4)){d=T,l&&(c.onreadystatechange=ge.noop,Gt&&delete qt[l]);if(t)c.readyState!==4&&c.abort();else{i=c.status,r=c.getAllResponseHeaders(),a={},s=c.responseXML,s&&s.documentElement&&(a.xml=s);try{a.text=c.responseText}catch(e){}try{n=c.statusText}catch(e){n=""}!i&&u.isLocal&&!u.crossDomain?i=a.text?200:404:i===1223&&(i=204)}}}catch(e){t||o(-1,e)}a&&o(i,n,a,r)},u.async?c.readyState===4?setTimeout(d,0):(l=++Vt,Gt&&(qt||(qt={},ge(v).unload(Gt)),qt[l]=d),c.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var Ut,$t,Jt=/^(?:toggle|show|hide)$/,Qt=new RegExp("^(?:([-+])=|)("+Z+")([a-z%]*)$","i"),Xt=/queueHooks$/,Yt=[O],Zt={"*":[function(e,t){var i,n,r=this.createTween(e,t),a=Qt.exec(t),s=r.cur(),o=+s||0,l=1,c=20;if(a){i=+a[2],n=a[3]||(ge.cssNumber[e]?"":"px");if(n!=="px"&&o){o=ge.css(r.elem,e,!0)||i||1;do{l=l||".5",o/=l,ge.style(r.elem,e,o+n)}while(l!==(l=r.cur()/s)&&l!==1&&--c)}r.unit=n,r.start=o,r.end=a[1]?o+(a[1]+1)*i:i}return r}]};ge.Animation=ge.extend(A,{tweener:function(e,t){ge.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var i,n=0,r=e.length;for(;n<r;n++)i=e[n],Zt[i]=Zt[i]||[],Zt[i].unshift(t)},prefilter:function(e,t){t?Yt.unshift(e):Yt.push(e)}}),ge.Tween=N,N.prototype={constructor:N,init:function(e,t,i,n,r,a){this.elem=e,this.prop=i,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=a||(ge.cssNumber[i]?"":"px")},cur:function(){var e=N.propHooks[this.prop];return e&&e.get?e.get(this):N.propHooks._default.get(this)},run:function(e){var t,i=N.propHooks[this.prop];return this.options.duration?this.pos=t=ge.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):N.propHooks._default.set(this),this}},N.prototype.init.prototype=N.prototype,N.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=ge.css(e.elem,e.prop,!1,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){ge.fx.step[e.prop]?ge.fx.step[e.prop](e):e.elem.style&&(e.elem.style[ge.cssProps[e.prop]]!=null||ge.cssHooks[e.prop])?ge.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},N.propHooks.scrollTop=N.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ge.each(["toggle","show","hide"],function(n,r){var a=ge.fn[r];ge.fn[r]=function(e,t,i){return e==null||typeof e=="boolean"||!n&&ge.isFunction(e)&&ge.isFunction(t)?a.apply(this,arguments):this.animate(R(r,!0),e,t,i)}}),ge.fn.extend({fadeTo:function(e,t,i,n){return this.filter(b).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(t,e,i,n){var r=ge.isEmptyObject(t),a=ge.speed(e,i,n),s=function(){var e=A(this,ge.extend({},t),a);r&&e.stop(!0)};return r||a.queue===!1?this.each(s):this.queue(a.queue,s)},stop:function(r,e,a){var s=function(e){var t=e.stop;delete e.stop,t(a)};return typeof r!="string"&&(a=e,e=r,r=T),e&&r!==!1&&this.queue(r||"fx",[]),this.each(function(){var e=!0,t=r!=null&&r+"queueHooks",i=ge.timers,n=ge._data(this);if(t)n[t]&&n[t].stop&&s(n[t]);else for(t in n)n[t]&&n[t].stop&&Xt.test(t)&&s(n[t]);for(t=i.length;t--;)i[t].elem===this&&(r==null||i[t].queue===r)&&(i[t].anim.stop(a),e=!1,i.splice(t,1));(e||!a)&&ge.dequeue(this,r)})}}),ge.each({slideDown:R("show"),slideUp:R("hide"),slideToggle:R("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,n){ge.fn[e]=function(e,t,i){return this.animate(n,e,t,i)}}),ge.speed=function(e,t,i){var n=e&&typeof e=="object"?ge.extend({},e):{complete:i||!i&&t||ge.isFunction(e)&&e,duration:e,easing:i&&t||t&&!ge.isFunction(t)&&t};n.duration=ge.fx.off?0:typeof n.duration=="number"?n.duration:n.duration in ge.fx.speeds?ge.fx.speeds[n.duration]:ge.fx.speeds._default;if(n.queue==null||n.queue===!0)n.queue="fx";return n.old=n.complete,n.complete=function(){ge.isFunction(n.old)&&n.old.call(this),n.queue&&ge.dequeue(this,n.queue)},n},ge.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},ge.timers=[],ge.fx=N.prototype.init,ge.fx.tick=function(){var e,t=ge.timers,i=0;Ut=ge.now();for(;i<t.length;i++)e=t[i],!e()&&t[i]===e&&t.splice(i--,1);t.length||ge.fx.stop(),Ut=T},ge.fx.timer=function(e){e()&&ge.timers.push(e)&&!$t&&($t=setInterval(ge.fx.tick,ge.fx.interval))},ge.fx.interval=13,ge.fx.stop=function(){clearInterval($t),$t=null},ge.fx.speeds={slow:600,fast:200,_default:400},ge.fx.step={},ge.expr&&ge.expr.filters&&(ge.expr.filters.animated=function(t){return ge.grep(ge.timers,function(e){return t===e.elem}).length});var Kt=/^(?:body|html)$/i;ge.fn.offset=function(t){if(arguments.length)return t===T?this:this.each(function(e){ge.offset.setOffset(this,t,e)});var e,i,n,r,a,s,o,l={top:0,left:0},c=this[0],u=c&&c.ownerDocument;if(!u)return;return(i=u.body)===c?ge.offset.bodyOffset(c):(e=u.documentElement,ge.contains(e,c)?(typeof c.getBoundingClientRect!="undefined"&&(l=c.getBoundingClientRect()),n=F(u),r=e.clientTop||i.clientTop||0,a=e.clientLeft||i.clientLeft||0,s=n.pageYOffset||e.scrollTop,o=n.pageXOffset||e.scrollLeft,{top:l.top+s-r,left:l.left+o-a}):l)},ge.offset={bodyOffset:function(e){var t=e.offsetTop,i=e.offsetLeft;return ge.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(ge.css(e,"marginTop"))||0,i+=parseFloat(ge.css(e,"marginLeft"))||0),{top:t,left:i}},setOffset:function(e,t,i){var n=ge.css(e,"position");n==="static"&&(e.style.position="relative");var r=ge(e),a=r.offset(),s=ge.css(e,"top"),o=ge.css(e,"left"),l=(n==="absolute"||n==="fixed")&&ge.inArray("auto",[s,o])>-1,c={},u={},d,h;l?(u=r.position(),d=u.top,h=u.left):(d=parseFloat(s)||0,h=parseFloat(o)||0),ge.isFunction(t)&&(t=t.call(e,i,a)),t.top!=null&&(c.top=t.top-a.top+d),t.left!=null&&(c.left=t.left-a.left+h),"using"in t?t.using.call(e,c):r.css(c)}},ge.fn.extend({position:function(){if(!this[0])return;var e=this[0],t=this.offsetParent(),i=this.offset(),n=Kt.test(t[0].nodeName)?{top:0,left:0}:t.offset();return i.top-=parseFloat(ge.css(e,"marginTop"))||0,i.left-=parseFloat(ge.css(e,"marginLeft"))||0,n.top+=parseFloat(ge.css(t[0],"borderTopWidth"))||0,n.left+=parseFloat(ge.css(t[0],"borderLeftWidth"))||0,{top:i.top-n.top,left:i.left-n.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||B.body;while(e&&!Kt.test(e.nodeName)&&ge.css(e,"position")==="static")e=e.offsetParent;return e||B.body})}}),ge.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,r){var a=/Y/.test(r);ge.fn[t]=function(e){return ge.access(this,function(e,t,i){var n=F(e);if(i===T)return n?r in n?n[r]:n.document.documentElement[t]:e[t];n?n.scrollTo(a?ge(n).scrollLeft():i,a?i:ge(n).scrollTop()):e[t]=i},t,e,arguments.length,null)}}),ge.each({Height:"height",Width:"width"},function(a,s){ge.each({padding:"inner"+a,content:s,"":"outer"+a},function(n,e){ge.fn[e]=function(e,t){var i=arguments.length&&(n||typeof e!="boolean"),r=n||(e===!0||t===!0?"margin":"border");return ge.access(this,function(e,t,i){var n;return ge.isWindow(e)?e.document.documentElement["client"+a]:e.nodeType===9?(n=e.documentElement,Math.max(e.body["scroll"+a],n["scroll"+a],e.body["offset"+a],n["offset"+a],n["client"+a])):i===T?ge.css(e,t,i,r):ge.style(e,t,i,r)},s,i?e:T,i,null)}})}),v.jQuery=v.$=ge,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return ge})})(window);(function(o,l){function n(e,t){var i,n,r,a=e.nodeName.toLowerCase();return"area"===a?(i=e.parentNode,n=i.name,!e.href||!n||i.nodeName.toLowerCase()!=="map"?!1:(r=o("img[usemap=#"+n+"]")[0],!!r&&s(r))):(/input|select|textarea|button|object/.test(a)?!e.disabled:"a"===a?e.href||t:t)&&s(e)}function s(e){return o.expr.filters.visible(e)&&!o(e).parents().andSelf().filter(function(){return o.css(this,"visibility")==="hidden"}).length}var e=0,t=/^ui-id-\d+$/;o.ui=o.ui||{};if(o.ui.version)return;o.extend(o.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),o.fn.extend({_focus:o.fn.focus,focus:function(t,i){return typeof t=="number"?this.each(function(){var e=this;setTimeout(function(){o(e).focus(),i&&i.call(e)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;return o.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?e=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(o.css(this,"position"))&&/(auto|scroll)/.test(o.css(this,"overflow")+o.css(this,"overflow-y")+o.css(this,"overflow-x"))}).eq(0):e=this.parents().filter(function(){return/(auto|scroll)/.test(o.css(this,"overflow")+o.css(this,"overflow-y")+o.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?o(document):e},zIndex:function(e){if(e!==l)return this.css("zIndex",e);if(this.length){var t=o(this[0]),i,n;while(t.length&&t[0]!==document){i=t.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){n=parseInt(t.css("zIndex"),10);if(!isNaN(n)&&n!==0)return n}t=t.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){t.test(this.id)&&o(this).removeAttr("id")})}}),o.extend(o.expr[":"],{data:o.expr.createPseudo?o.expr.createPseudo(function(t){return function(e){return!!o.data(e,t)}}):function(e,t,i){return!!o.data(e,i[3])},focusable:function(e){return n(e,!isNaN(o.attr(e,"tabindex")))},tabbable:function(e){var t=o.attr(e,"tabindex"),i=isNaN(t);return(i||t>=0)&&n(e,!i)}}),o(function(){var e=document.body,t=e.appendChild(t=document.createElement("div"));t.offsetHeight,o.extend(t.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),o.support.minHeight=t.offsetHeight===100,o.support.selectstart="onselectstart"in t,e.removeChild(t).style.display="none"}),o("<a>").outerWidth(1).jquery||o.each(["Width","Height"],function(e,i){function n(e,t,i,n){return o.each(r,function(){t-=parseFloat(o.css(e,"padding"+this))||0,i&&(t-=parseFloat(o.css(e,"border"+this+"Width"))||0),n&&(t-=parseFloat(o.css(e,"margin"+this))||0)}),t}var r=i==="Width"?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),s={innerWidth:o.fn.innerWidth,innerHeight:o.fn.innerHeight,outerWidth:o.fn.outerWidth,outerHeight:o.fn.outerHeight};o.fn["inner"+i]=function(e){return e===l?s["inner"+i].call(this):this.each(function(){o(this).css(a,n(this,e)+"px")})},o.fn["outer"+i]=function(e,t){return typeof e!="number"?s["outer"+i].call(this,e):this.each(function(){o(this).css(a,n(this,e,!0,t)+"px")})}}),o("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(o.fn.removeData=function(t){return function(e){return arguments.length?t.call(this,o.camelCase(e)):t.call(this)}}(o.fn.removeData)),function(){var e=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];o.ui.ie=e.length?!0:!1,o.ui.ie6=parseFloat(e[1],10)===6}(),o.fn.extend({disableSelection:function(){return this.bind((o.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),o.extend(o.ui,{plugin:{add:function(e,t,i){var n,r=o.ui[e].prototype;for(n in i)r.plugins[n]=r.plugins[n]||[],r.plugins[n].push([t,i[n]])},call:function(e,t,i){var n,r=e.plugins[t];if(!r||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(n=0;n<r.length;n++)e.options[r[n][0]]&&r[n][1].apply(e.element,i)}},contains:o.contains,hasScroll:function(e,t){if(o(e).css("overflow")==="hidden")return!1;var i=t&&t==="left"?"scrollLeft":"scrollTop",n=!1;return e[i]>0?!0:(e[i]=1,n=e[i]>0,e[i]=0,n)},isOverAxis:function(e,t,i){return e>t&&e<t+i},isOver:function(e,t,i,n,r,a){return o.ui.isOverAxis(e,i,r)&&o.ui.isOverAxis(t,n,a)}})})(jQuery);(function(u,o){var i=0,l=Array.prototype.slice,n=u.cleanData;u.cleanData=function(e){for(var t=0,i;(i=e[t])!=null;t++)try{u(i).triggerHandler("remove")}catch(e){}n(e)},u.widget=function(e,i,n){var t,r,a,s,o=e.split(".")[0];e=e.split(".")[1],t=o+"-"+e,n||(n=i,i=u.Widget),u.expr[":"][t.toLowerCase()]=function(e){return!!u.data(e,t)},u[o]=u[o]||{},r=u[o][e],a=u[o][e]=function(e,t){if(!this._createWidget)return new a(e,t);arguments.length&&this._createWidget(e,t)},u.extend(a,r,{version:n.version,_proto:u.extend({},n),_childConstructors:[]}),s=new i,s.options=u.widget.extend({},s.options),u.each(n,function(t,a){u.isFunction(a)&&(n[t]=function(){var n=function(){return i.prototype[t].apply(this,arguments)},r=function(e){return i.prototype[t].apply(this,e)};return function(){var e=this._super,t=this._superApply,i;return this._super=n,this._superApply=r,i=a.apply(this,arguments),this._super=e,this._superApply=t,i}}())}),a.prototype=u.widget.extend(s,{widgetEventPrefix:r?s.widgetEventPrefix:e},n,{constructor:a,namespace:o,widgetName:e,widgetBaseClass:t,widgetFullName:t}),r?(u.each(r._childConstructors,function(e,t){var i=t.prototype;u.widget(i.namespace+"."+i.widgetName,a,t._proto)}),delete r._childConstructors):i._childConstructors.push(a),u.widget.bridge(e,a)},u.widget.extend=function(e){var t=l.call(arguments,1),i=0,n=t.length,r,a;for(;i<n;i++)for(r in t[i])a=t[i][r],t[i].hasOwnProperty(r)&&a!==o&&(u.isPlainObject(a)?e[r]=u.isPlainObject(e[r])?u.widget.extend({},e[r],a):u.widget.extend({},a):e[r]=a);return e},u.widget.bridge=function(a,t){var s=t.prototype.widgetFullName||a;u.fn[a]=function(i){var e=typeof i=="string",n=l.call(arguments,1),r=this;return i=!e&&n.length?u.widget.extend.apply(null,[i].concat(n)):i,e?this.each(function(){var e,t=u.data(this,s);if(!t)return u.error("cannot call methods on "+a+" prior to initialization; "+"attempted to call method '"+i+"'");if(!u.isFunction(t[i])||i.charAt(0)==="_")return u.error("no such method '"+i+"' for "+a+" widget instance");e=t[i].apply(t,n);if(e!==t&&e!==o)return r=e&&e.jquery?r.pushStack(e.get()):e,!1}):this.each(function(){var e=u.data(this,s);e?e.option(i||{})._init():u.data(this,s,new t(i,this))}),r}},u.Widget=function(){},u.Widget._childConstructors=[],u.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,t){t=u(t||this.defaultElement||this)[0],this.element=u(t),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=u.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=u(),this.hoverable=u(),this.focusable=u(),t!==this&&(u.data(t,this.widgetName,this),u.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=u(t.style?t.ownerDocument:t.document||t),this.window=u(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:u.noop,_getCreateEventData:u.noop,_create:u.noop,_init:u.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(u.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:u.noop,widget:function(){return this.element},option:function(e,t){var i=e,n,r,a;if(arguments.length===0)return u.widget.extend({},this.options);if(typeof e=="string"){i={},n=e.split("."),e=n.shift();if(n.length){r=i[e]=u.widget.extend({},this.options[e]);for(a=0;a<n.length-1;a++)r[n[a]]=r[n[a]]||{},r=r[n[a]];e=n.pop();if(t===o)return r[e]===o?null:r[e];r[e]=t}else{if(t===o)return this.options[e]===o?null:this.options[e];i[e]=t}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(s,o,e){var l,c=this;typeof s!="boolean"&&(e=o,o=s,s=!1),e?(o=l=u(o),this.bindings=this.bindings.add(o)):(e=o,o=this.element,l=this.widget()),u.each(e,function(e,t){function i(){if(!s&&(c.options.disabled===!0||u(this).hasClass("ui-state-disabled")))return;return(typeof t=="string"?c[t]:t).apply(c,arguments)}typeof t!="string"&&(i.guid=t.guid=t.guid||i.guid||u.guid++);var n=e.match(/^(\w+)\s*(.*)$/),r=n[1]+c.eventNamespace,a=n[2];a?l.delegate(a,r,i):o.bind(r,i)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return(typeof e=="string"?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){u(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){u(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){u(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){u(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,i){var n,r,a=this.options[e];i=i||{},t=u.Event(t),t.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],r=t.originalEvent;if(r)for(n in r)n in t||(t[n]=r[n]);return this.element.trigger(t,i),!(u.isFunction(a)&&a.apply(this.element[0],[t].concat(i))===!1||t.isDefaultPrevented())}},u.each({show:"fadeIn",hide:"fadeOut"},function(a,s){u.Widget.prototype["_"+a]=function(t,e,i){typeof e=="string"&&(e={effect:e});var n,r=e?e===!0||typeof e=="number"?s:e.effect||s:a;e=e||{},typeof e=="number"&&(e={duration:e}),n=!u.isEmptyObject(e),e.complete=i,e.delay&&t.delay(e.delay),n&&u.effects&&(u.effects.effect[r]||u.uiBackCompat!==!1&&u.effects[r])?t[a](e):r!==a&&t[r]?t[r](e.duration,e.easing,i):t.queue(function(e){u(this)[a](),i&&i.call(t[0]),e()})}}),u.uiBackCompat!==!1&&(u.Widget.prototype._getCreateOptions=function(){return u.metadata&&u.metadata.get(this.element[0])[this.widgetName]})})(jQuery);(function(r,e){var a=!1;r(document).mouseup(function(e){a=!1}),r.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(!0===r.data(e.target,t.widgetName+".preventClickEvent"))return r.removeData(e.target,t.widgetName+".preventClickEvent"),e.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&r(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(a)return;this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var t=this,i=e.which===1,n=typeof this.options.cancel=="string"&&e.target.nodeName?r(e.target).closest(this.options.cancel).length:!1;if(!i||n||!this._mouseCapture(e))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){t.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)){this._mouseStarted=this._mouseStart(e)!==!1;if(!this._mouseStarted)return e.preventDefault(),!0}return!0===r.data(e.target,this.widgetName+".preventClickEvent")&&r.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return t._mouseMove(e)},this._mouseUpDelegate=function(e){return t._mouseUp(e)},r(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),a=!0,!0},_mouseMove:function(e){return!r.ui.ie||document.documentMode>=9||!!e.button?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return r(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&r.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})})(jQuery);(function(x,a){function C(e,t,i){return[parseInt(e[0],10)*(c.test(e[0])?t/100:1),parseInt(e[1],10)*(c.test(e[1])?i/100:1)]}function T(e,t){return parseInt(x.css(e,t),10)||0}x.ui=x.ui||{};var r,k=Math.max,M=Math.abs,S=Math.round,n=/left|center|right/,s=/top|center|bottom/,o=/[\+\-]\d+%?/,l=/^\w+/,c=/%$/,t=x.fn.position;x.position={scrollbarWidth:function(){if(r!==a)return r;var e,t,i=x("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),n=i.children()[0];return x("body").append(i),e=n.offsetWidth,i.css("overflow","scroll"),t=n.offsetWidth,e===t&&(t=i[0].clientWidth),i.remove(),r=e-t},getScrollInfo:function(e){var t=e.isWindow?"":e.element.css("overflow-x"),i=e.isWindow?"":e.element.css("overflow-y"),n=t==="scroll"||t==="auto"&&e.width<e.element[0].scrollWidth,r=i==="scroll"||i==="auto"&&e.height<e.element[0].scrollHeight;return{width:n?x.position.scrollbarWidth():0,height:r?x.position.scrollbarWidth():0}},getWithinInfo:function(e){var t=x(e||window),i=x.isWindow(t[0]);return{element:t,isWindow:i,offset:t.offset()||{left:0,top:0},scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop(),width:i?t.width():t.outerWidth(),height:i?t.height():t.outerHeight()}}},x.fn.position=function(d){if(!d||!d.of)return t.apply(this,arguments);d=x.extend({},d);var h,f,p,g,m,v=x(d.of),y=x.position.getWithinInfo(d.within),_=x.position.getScrollInfo(y),e=v[0],b=(d.collision||"flip").split(" "),w={};return e.nodeType===9?(f=v.width(),p=v.height(),g={top:0,left:0}):x.isWindow(e)?(f=v.width(),p=v.height(),g={top:v.scrollTop(),left:v.scrollLeft()}):e.preventDefault?(d.at="left top",f=p=0,g={top:e.pageY,left:e.pageX}):(f=v.outerWidth(),p=v.outerHeight(),g=v.offset()),m=x.extend({},g),x.each(["my","at"],function(){var e=(d[this]||"").split(" "),t,i;e.length===1&&(e=n.test(e[0])?e.concat(["center"]):s.test(e[0])?["center"].concat(e):["center","center"]),e[0]=n.test(e[0])?e[0]:"center",e[1]=s.test(e[1])?e[1]:"center",t=o.exec(e[0]),i=o.exec(e[1]),w[this]=[t?t[0]:0,i?i[0]:0],d[this]=[l.exec(e[0])[0],l.exec(e[1])[0]]}),b.length===1&&(b[1]=b[0]),d.at[0]==="right"?m.left+=f:d.at[0]==="center"&&(m.left+=f/2),d.at[1]==="bottom"?m.top+=p:d.at[1]==="center"&&(m.top+=p/2),h=C(w.at,f,p),m.left+=h[0],m.top+=h[1],this.each(function(){var i,e,s=x(this),o=s.outerWidth(),l=s.outerHeight(),t=T(this,"marginLeft"),n=T(this,"marginTop"),r=o+t+T(this,"marginRight")+_.width,a=l+n+T(this,"marginBottom")+_.height,c=x.extend({},m),u=C(w.my,s.outerWidth(),s.outerHeight());d.my[0]==="right"?c.left-=o:d.my[0]==="center"&&(c.left-=o/2),d.my[1]==="bottom"?c.top-=l:d.my[1]==="center"&&(c.top-=l/2),c.left+=u[0],c.top+=u[1],x.support.offsetFractions||(c.left=S(c.left),c.top=S(c.top)),i={marginLeft:t,marginTop:n},x.each(["left","top"],function(e,t){x.ui.position[b[e]]&&x.ui.position[b[e]][t](c,{targetWidth:f,targetHeight:p,elemWidth:o,elemHeight:l,collisionPosition:i,collisionWidth:r,collisionHeight:a,offset:[h[0]+u[0],h[1]+u[1]],my:d.my,at:d.at,within:y,elem:s})}),x.fn.bgiframe&&s.bgiframe(),d.using&&(e=function(e){var t=g.left-c.left,i=t+f-o,n=g.top-c.top,r=n+p-l,a={target:{element:v,left:g.left,top:g.top,width:f,height:p},element:{element:s,left:c.left,top:c.top,width:o,height:l},horizontal:i<0?"left":t>0?"right":"center",vertical:r<0?"top":n>0?"bottom":"middle"};f<o&&M(t+i)<f&&(a.horizontal="center"),p<l&&M(n+r)<p&&(a.vertical="middle"),k(M(t),M(i))>k(M(n),M(r))?a.important="horizontal":a.important="vertical",d.using.call(this,e,a)}),s.offset(x.extend(c,{using:e}))})},x.ui.position={fit:{left:function(e,t){var i=t.within,n=i.isWindow?i.scrollLeft:i.offset.left,r=i.width,a=e.left-t.collisionPosition.marginLeft,s=n-a,o=a+t.collisionWidth-r-n,l;t.collisionWidth>r?s>0&&o<=0?(l=e.left+s+t.collisionWidth-r-n,e.left+=s-l):o>0&&s<=0?e.left=n:s>o?e.left=n+r-t.collisionWidth:e.left=n:s>0?e.left+=s:o>0?e.left-=o:e.left=k(e.left-a,e.left)},top:function(e,t){var i=t.within,n=i.isWindow?i.scrollTop:i.offset.top,r=t.within.height,a=e.top-t.collisionPosition.marginTop,s=n-a,o=a+t.collisionHeight-r-n,l;t.collisionHeight>r?s>0&&o<=0?(l=e.top+s+t.collisionHeight-r-n,e.top+=s-l):o>0&&s<=0?e.top=n:s>o?e.top=n+r-t.collisionHeight:e.top=n:s>0?e.top+=s:o>0?e.top-=o:e.top=k(e.top-a,e.top)}},flip:{left:function(e,t){var i=t.within,n=i.offset.left+i.scrollLeft,r=i.width,a=i.isWindow?i.scrollLeft:i.offset.left,s=e.left-t.collisionPosition.marginLeft,o=s-a,l=s+t.collisionWidth-r-a,c=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,u=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,d=-2*t.offset[0],h,f;if(o<0){h=e.left+c+u+d+t.collisionWidth-r-n;if(h<0||h<M(o))e.left+=c+u+d}else if(l>0){f=e.left-t.collisionPosition.marginLeft+c+u+d-a;if(f>0||M(f)<l)e.left+=c+u+d}},top:function(e,t){var i=t.within,n=i.offset.top+i.scrollTop,r=i.height,a=i.isWindow?i.scrollTop:i.offset.top,s=e.top-t.collisionPosition.marginTop,o=s-a,l=s+t.collisionHeight-r-a,c=t.my[1]==="top",u=c?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,d=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,h=-2*t.offset[1],f,p;o<0?(p=e.top+u+d+h+t.collisionHeight-r-n,e.top+u+d+h>o&&(p<0||p<M(o))&&(e.top+=u+d+h)):l>0&&(f=e.top-t.collisionPosition.marginTop+u+d+h-a,e.top+u+d+h>l&&(f>0||M(f)<l)&&(e.top+=u+d+h))}},flipfit:{left:function(){x.ui.position.flip.left.apply(this,arguments),x.ui.position.fit.left.apply(this,arguments)},top:function(){x.ui.position.flip.top.apply(this,arguments),x.ui.position.fit.top.apply(this,arguments)}}},function(){var e,t,i,n,r,a=document.getElementsByTagName("body")[0],s=document.createElement("div");e=document.createElement(a?"div":"body"),i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&x.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in i)e.style[r]=i[r];e.appendChild(s),t=a||document.documentElement,t.insertBefore(e,t.firstChild),s.style.cssText="position: absolute; left: 10.7432222px;",n=x(s).offset().left,x.support.offsetFractions=n>10&&n<11,e.innerHTML="",t.removeChild(e)}(),x.uiBackCompat!==!1&&function(n){var r=n.fn.position;n.fn.position=function(e){if(!e||!e.offset)return r.call(this,e);var t=e.offset.split(" "),i=e.at.split(" ");return t.length===1&&(t[1]=t[0]),/^\d/.test(t[0])&&(t[0]="+"+t[0]),/^\d/.test(t[1])&&(t[1]="+"+t[1]),i.length===1&&(/left|center|right/.test(i[0])?i[1]="center":(i[1]=i[0],i[0]="center")),r.call(this,n.extend(e,{at:i[0]+t[0]+" "+i[1]+t[1],offset:a}))}}(jQuery)})(jQuery);(function(_,e){_.widget("ui.draggable",_.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var t=this.options;return this.helper||t.disabled||_(e.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(e),this.handle?(_(t.iframeFix===!0?"iframe":t.iframeFix).each(function(){_('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(_(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var t=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),_.ui.ddmanager&&(_.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},_.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,t.cursorAt&&this._adjustOffsetFromHelper(t.cursorAt),t.containment&&this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),_.ui.ddmanager&&!t.dropBehaviour&&_.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),_.ui.ddmanager&&_.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,t){this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute");if(!t){var i=this._uiHash();if(this._trigger("drag",e,i)===!1)return this._mouseUp({}),!1;this.position=i.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return _.ui.ddmanager&&_.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var t=!1;_.ui.ddmanager&&!this.options.dropBehaviour&&(t=_.ui.ddmanager.drop(this,e)),this.dropped&&(t=this.dropped,this.dropped=!1);var i=this.element[0],n=!1;while(i&&(i=i.parentNode))i==document&&(n=!0);if(!n&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!t||this.options.revert=="valid"&&t||this.options.revert===!0||_.isFunction(this.options.revert)&&this.options.revert.call(this.element,t)){var r=this;_(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",e)!==!1&&r._clear()})}else this._trigger("stop",e)!==!1&&this._clear();return!1},_mouseUp:function(e){return _("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),_.ui.ddmanager&&_.ui.ddmanager.dragStop(this,e),_.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){var t=!this.options.handle||!_(this.options.handle,this.element).length?!0:!1;return _(this.options.handle,this.element).find("*").andSelf().each(function(){this==e.target&&(t=!0)}),t},_createHelper:function(e){var t=this.options,i=_.isFunction(t.helper)?_(t.helper.apply(this.element[0],[e])):t.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo(t.appendTo=="parent"?this.element[0].parentNode:t.appendTo),i[0]!=this.element[0]&&!/(fixed|absolute)/.test(i.css("position"))&&i.css("position","absolute"),i},_adjustOffsetFromHelper:function(e){typeof e=="string"&&(e=e.split(" ")),_.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&_.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&_.ui.ie)e={top:0,left:0};return{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;e.containment=="parent"&&(e.containment=this.helper[0].parentNode);if(e.containment=="document"||e.containment=="window")this.containment=[e.containment=="document"?0:_(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e.containment=="document"?0:_(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(e.containment=="document"?0:_(window).scrollLeft())+_(e.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e.containment=="document"?0:_(window).scrollTop())+(_(e.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(e.containment)&&e.containment.constructor!=Array){var t=_(e.containment),i=t[0];if(!i)return;var n=t.offset(),r=_(i).css("overflow")!="hidden";this.containment=[(parseInt(_(i).css("borderLeftWidth"),10)||0)+(parseInt(_(i).css("paddingLeft"),10)||0),(parseInt(_(i).css("borderTopWidth"),10)||0)+(parseInt(_(i).css("paddingTop"),10)||0),(r?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(_(i).css("borderLeftWidth"),10)||0)-(parseInt(_(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(r?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(_(i).css("borderTopWidth"),10)||0)-(parseInt(_(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=t}else e.containment.constructor==Array&&(this.containment=e.containment)},_convertPositionTo:function(e,t){t||(t=this.position);var i=e=="absolute"?1:-1,n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!_.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(r[0].tagName);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():a?0:r.scrollTop())*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():a?0:r.scrollLeft())*i}},_generatePosition:function(e){var t=this.options,i=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!_.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(i[0].tagName),r=e.pageX,a=e.pageY;if(this.originalPosition){var s;if(this.containment){if(this.relative_container){var o=this.relative_container.offset();s=[this.containment[0]+o.left,this.containment[1]+o.top,this.containment[2]+o.left,this.containment[3]+o.top]}else s=this.containment;e.pageX-this.offset.click.left<s[0]&&(r=s[0]+this.offset.click.left),e.pageY-this.offset.click.top<s[1]&&(a=s[1]+this.offset.click.top),e.pageX-this.offset.click.left>s[2]&&(r=s[2]+this.offset.click.left),e.pageY-this.offset.click.top>s[3]&&(a=s[3]+this.offset.click.top)}if(t.grid){var l=t.grid[1]?this.originalPageY+Math.round((a-this.originalPageY)/t.grid[1])*t.grid[1]:this.originalPageY;a=s?l-this.offset.click.top<s[1]||l-this.offset.click.top>s[3]?l-this.offset.click.top<s[1]?l+t.grid[1]:l-t.grid[1]:l:l;var c=t.grid[0]?this.originalPageX+Math.round((r-this.originalPageX)/t.grid[0])*t.grid[0]:this.originalPageX;r=s?c-this.offset.click.left<s[0]||c-this.offset.click.left>s[2]?c-this.offset.click.left<s[0]?c+t.grid[0]:c-t.grid[0]:c:c}}return{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():n?0:i.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():n?0:i.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,t,i){return i=i||this._uiHash(),_.ui.plugin.call(this,e,[t,i]),e=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),_.Widget.prototype._trigger.call(this,e,t,i)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),_.ui.plugin.add("draggable","connectToSortable",{start:function(t,e){var i=_(this).data("draggable"),n=i.options,r=_.extend({},e,{item:i.element});i.sortables=[],_(n.connectToSortable).each(function(){var e=_.data(this,"sortable");e&&!e.options.disabled&&(i.sortables.push({instance:e,shouldRevert:e.options.revert}),e.refreshPositions(),e._trigger("activate",t,r))})},stop:function(e,t){var i=_(this).data("draggable"),n=_.extend({},t,{item:i.element});_.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,i.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,n))})},drag:function(n,r){var a=_(this).data("draggable"),s=this,e=function(e){var t=this.offset.click.top,i=this.offset.click.left,n=this.positionAbs.top,r=this.positionAbs.left,a=e.height,s=e.width,o=e.top,l=e.left;return _.ui.isOver(n+t,r+i,o,l,a,s)};_.each(a.sortables,function(e){var t=!1,i=this;this.instance.positionAbs=a.positionAbs,this.instance.helperProportions=a.helperProportions,this.instance.offset.click=a.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(t=!0,_.each(a.sortables,function(){return this.instance.positionAbs=a.positionAbs,this.instance.helperProportions=a.helperProportions,this.instance.offset.click=a.offset.click,this!=i&&this.instance._intersectsWith(this.instance.containerCache)&&_.ui.contains(i.instance.element[0],this.instance.element[0])&&(t=!1),t})),t?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=_(s).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return r.helper[0]},n.target=this.instance.currentItem[0],this.instance._mouseCapture(n,!0),this.instance._mouseStart(n,!0,!0),this.instance.offset.click.top=a.offset.click.top,this.instance.offset.click.left=a.offset.click.left,this.instance.offset.parent.left-=a.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=a.offset.parent.top-this.instance.offset.parent.top,a._trigger("toSortable",n),a.dropped=this.instance.element,a.currentItem=a.element,this.instance.fromOutside=a),this.instance.currentItem&&this.instance._mouseDrag(n)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",n,this.instance._uiHash(this.instance)),this.instance._mouseStop(n,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),a._trigger("fromSortable",n),a.dropped=!1)})}}),_.ui.plugin.add("draggable","cursor",{start:function(e,t){var i=_("body"),n=_(this).data("draggable").options;i.css("cursor")&&(n._cursor=i.css("cursor")),i.css("cursor",n.cursor)},stop:function(e,t){var i=_(this).data("draggable").options;i._cursor&&_("body").css("cursor",i._cursor)}}),_.ui.plugin.add("draggable","opacity",{start:function(e,t){var i=_(t.helper),n=_(this).data("draggable").options;i.css("opacity")&&(n._opacity=i.css("opacity")),i.css("opacity",n.opacity)},stop:function(e,t){var i=_(this).data("draggable").options;i._opacity&&_(t.helper).css("opacity",i._opacity)}}),_.ui.plugin.add("draggable","scroll",{start:function(e,t){var i=_(this).data("draggable");i.scrollParent[0]!=document&&i.scrollParent[0].tagName!="HTML"&&(i.overflowOffset=i.scrollParent.offset())},drag:function(e,t){var i=_(this).data("draggable"),n=i.options,r=!1;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!="HTML"){if(!n.axis||n.axis!="x")i.overflowOffset.top+i.scrollParent[0].offsetHeight-e.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop+n.scrollSpeed:e.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop-n.scrollSpeed);if(!n.axis||n.axis!="y")i.overflowOffset.left+i.scrollParent[0].offsetWidth-e.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft+n.scrollSpeed:e.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft-n.scrollSpeed)}else{if(!n.axis||n.axis!="x")e.pageY-_(document).scrollTop()<n.scrollSensitivity?r=_(document).scrollTop(_(document).scrollTop()-n.scrollSpeed):_(window).height()-(e.pageY-_(document).scrollTop())<n.scrollSensitivity&&(r=_(document).scrollTop(_(document).scrollTop()+n.scrollSpeed));if(!n.axis||n.axis!="y")e.pageX-_(document).scrollLeft()<n.scrollSensitivity?r=_(document).scrollLeft(_(document).scrollLeft()-n.scrollSpeed):_(window).width()-(e.pageX-_(document).scrollLeft())<n.scrollSensitivity&&(r=_(document).scrollLeft(_(document).scrollLeft()+n.scrollSpeed))}r!==!1&&_.ui.ddmanager&&!n.dropBehaviour&&_.ui.ddmanager.prepareOffsets(i,e)}}),_.ui.plugin.add("draggable","snap",{start:function(e,t){var i=_(this).data("draggable"),n=i.options;i.snapElements=[],_(n.snap.constructor!=String?n.snap.items||":data(draggable)":n.snap).each(function(){var e=_(this),t=e.offset();this!=i.element[0]&&i.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:t.top,left:t.left})})},drag:function(e,t){var i=_(this).data("draggable"),n=i.options,r=n.snapTolerance,a=t.offset.left,s=a+i.helperProportions.width,o=t.offset.top,l=o+i.helperProportions.height;for(var c=i.snapElements.length-1;c>=0;c--){var u=i.snapElements[c].left,d=u+i.snapElements[c].width,h=i.snapElements[c].top,f=h+i.snapElements[c].height;if(!(u-r<a&&a<d+r&&h-r<o&&o<f+r||u-r<a&&a<d+r&&h-r<l&&l<f+r||u-r<s&&s<d+r&&h-r<o&&o<f+r||u-r<s&&s<d+r&&h-r<l&&l<f+r)){i.snapElements[c].snapping&&i.options.snap.release&&i.options.snap.release.call(i.element,e,_.extend(i._uiHash(),{snapItem:i.snapElements[c].item})),i.snapElements[c].snapping=!1;continue}if(n.snapMode!="inner"){var p=Math.abs(h-l)<=r,g=Math.abs(f-o)<=r,m=Math.abs(u-s)<=r,v=Math.abs(d-a)<=r;p&&(t.position.top=i._convertPositionTo("relative",{top:h-i.helperProportions.height,left:0}).top-i.margins.top),g&&(t.position.top=i._convertPositionTo("relative",{top:f,left:0}).top-i.margins.top),m&&(t.position.left=i._convertPositionTo("relative",{top:0,left:u-i.helperProportions.width}).left-i.margins.left),v&&(t.position.left=i._convertPositionTo("relative",{top:0,left:d}).left-i.margins.left)}var y=p||g||m||v;if(n.snapMode!="outer"){var p=Math.abs(h-o)<=r,g=Math.abs(f-l)<=r,m=Math.abs(u-a)<=r,v=Math.abs(d-s)<=r;p&&(t.position.top=i._convertPositionTo("relative",{top:h,left:0}).top-i.margins.top),g&&(t.position.top=i._convertPositionTo("relative",{top:f-i.helperProportions.height,left:0}).top-i.margins.top),m&&(t.position.left=i._convertPositionTo("relative",{top:0,left:u}).left-i.margins.left),v&&(t.position.left=i._convertPositionTo("relative",{top:0,left:d-i.helperProportions.width}).left-i.margins.left)}!i.snapElements[c].snapping&&(p||g||m||v||y)&&i.options.snap.snap&&i.options.snap.snap.call(i.element,e,_.extend(i._uiHash(),{snapItem:i.snapElements[c].item})),i.snapElements[c].snapping=p||g||m||v||y}}}),_.ui.plugin.add("draggable","stack",{start:function(e,t){var i=_(this).data("draggable").options,n=_.makeArray(_(i.stack)).sort(function(e,t){return(parseInt(_(e).css("zIndex"),10)||0)-(parseInt(_(t).css("zIndex"),10)||0)});if(!n.length)return;var r=parseInt(n[0].style.zIndex)||0;_(n).each(function(e){this.style.zIndex=r+e}),this[0].style.zIndex=r+n.length}}),_.ui.plugin.add("draggable","zIndex",{start:function(e,t){var i=_(t.helper),n=_(this).data("draggable").options;i.css("zIndex")&&(n._zIndex=i.css("zIndex")),i.css("zIndex",n.zIndex)},stop:function(e,t){var i=_(this).data("draggable").options;i._zIndex&&_(t.helper).css("zIndex",i._zIndex)}})})(jQuery);(function(p,e){p.widget("ui.droppable",{version:"1.9.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var e=this.options,t=e.accept;this.isover=0,this.isout=1,this.accept=p.isFunction(t)?t:function(e){return e.is(t)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},p.ui.ddmanager.droppables[e.scope]=p.ui.ddmanager.droppables[e.scope]||[],p.ui.ddmanager.droppables[e.scope].push(this),e.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){var e=p.ui.ddmanager.droppables[this.options.scope];for(var t=0;t<e.length;t++)e[t]==this&&e.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,t){e=="accept"&&(this.accept=p.isFunction(t)?t:function(e){return e.is(t)}),p.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var t=p.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),t&&this._trigger("activate",e,this.ui(t))},_deactivate:function(e){var t=p.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),t&&this._trigger("deactivate",e,this.ui(t))},_over:function(e){var t=p.ui.ddmanager.current;if(!t||(t.currentItem||t.element)[0]==this.element[0])return;this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(t)))},_out:function(e){var t=p.ui.ddmanager.current;if(!t||(t.currentItem||t.element)[0]==this.element[0])return;this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(t)))},_drop:function(e,t){var i=t||p.ui.ddmanager.current;if(!i||(i.currentItem||i.element)[0]==this.element[0])return!1;var n=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var e=p.data(this,"droppable");if(e.options.greedy&&!e.options.disabled&&e.options.scope==i.options.scope&&e.accept.call(e.element[0],i.currentItem||i.element)&&p.ui.intersect(i,p.extend(e,{offset:e.element.offset()}),e.options.tolerance))return n=!0,!1}),n?!1:this.accept.call(this.element[0],i.currentItem||i.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(i)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),p.ui.intersect=function(e,t,i){if(!t.offset)return!1;var n=(e.positionAbs||e.position.absolute).left,r=n+e.helperProportions.width,a=(e.positionAbs||e.position.absolute).top,s=a+e.helperProportions.height,o=t.offset.left,l=o+t.proportions.width,c=t.offset.top,u=c+t.proportions.height;switch(i){case"fit":return o<=n&&r<=l&&c<=a&&s<=u;case"intersect":return o<n+e.helperProportions.width/2&&r-e.helperProportions.width/2<l&&c<a+e.helperProportions.height/2&&s-e.helperProportions.height/2<u;case"pointer":var d=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,h=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,f=p.ui.isOver(h,d,c,o,t.proportions.height,t.proportions.width);return f;case"touch":return(a>=c&&a<=u||s>=c&&s<=u||a<c&&s>u)&&(n>=o&&n<=l||r>=o&&r<=l||n<o&&r>l);default:return!1}},p.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,t){var i=p.ui.ddmanager.droppables[e.options.scope]||[],n=t?t.type:null,r=(e.currentItem||e.element).find(":data(droppable)").andSelf();e:for(var a=0;a<i.length;a++){if(i[a].options.disabled||e&&!i[a].accept.call(i[a].element[0],e.currentItem||e.element))continue;for(var s=0;s<r.length;s++)if(r[s]==i[a].element[0]){i[a].proportions.height=0;continue e}i[a].visible=i[a].element.css("display")!="none";if(!i[a].visible)continue;n=="mousedown"&&i[a]._activate.call(i[a],t),i[a].offset=i[a].element.offset(),i[a].proportions={width:i[a].element[0].offsetWidth,height:i[a].element[0].offsetHeight}}},drop:function(e,t){var i=!1;return p.each(p.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&p.ui.intersect(e,this,this.options.tolerance)&&(i=this._drop.call(this,t)||i),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,t))}),i},dragStart:function(e,t){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||p.ui.ddmanager.prepareOffsets(e,t)})},drag:function(a,s){a.options.refreshPositions&&p.ui.ddmanager.prepareOffsets(a,s),p.each(p.ui.ddmanager.droppables[a.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var e=p.ui.intersect(a,this,this.options.tolerance),t=!e&&this.isover==1?"isout":e&&this.isover==0?"isover":null;if(!t)return;var i;if(this.options.greedy){var n=this.options.scope,r=this.element.parents(":data(droppable)").filter(function(){return p.data(this,"droppable").options.scope===n});r.length&&(i=p.data(r[0],"droppable"),i.greedyChild=t=="isover"?1:0)}i&&t=="isover"&&(i.isover=0,i.isout=1,i._out.call(i,s)),this[t]=1,this[t=="isout"?"isover":"isout"]=0,this[t=="isover"?"_over":"_out"].call(this,s),i&&t=="isout"&&(i.isout=0,i.isover=1,i._over.call(i,s))})},dragStop:function(e,t){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||p.ui.ddmanager.prepareOffsets(e,t)}}})(jQuery);(function(g,e){g.widget("ui.resizable",g.ui.mouse,{version:"1.9.2",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,e=this.options;this.element.addClass("ui-resizable"),g.extend(this,{_aspectRatio:!!e.aspectRatio,aspectRatio:e.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:e.helper||e.ghost||e.animate?e.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(g('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=e.handles||(g(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor==String){this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw");var i=this.handles.split(",");this.handles={};for(var n=0;n<i.length;n++){var r=g.trim(i[n]),a="ui-resizable-"+r,s=g('<div class="ui-resizable-handle '+a+'"></div>');s.css({zIndex:e.zIndex}),"se"==r&&s.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(s)}}this._renderAxis=function(e){e=e||this.element;for(var t in this.handles){this.handles[t].constructor==String&&(this.handles[t]=g(this.handles[t],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var i=g(this.handles[t],this.element),n=0;n=/sw|ne|nw|se|n|s/.test(t)?i.outerHeight():i.outerWidth();var r=["padding",/ne|nw|n/.test(t)?"Top":/se|sw|s/.test(t)?"Bottom":/^e$/.test(t)?"Right":"Left"].join("");e.css(r,n),this._proportionallyResize()}if(!g(this.handles[t]).length)continue}},this._renderAxis(this.element),this._handles=g(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),e.autoHide&&(this._handles.hide(),g(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(e.disabled)return;g(this).removeClass("ui-resizable-autohide"),t._handles.show()}).mouseleave(function(){if(e.disabled)return;t.resizing||(g(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e=function(e){g(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){e(this.element);var t=this.element;this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()}return this.originalElement.css("resize",this.originalResizeStyle),e(this.originalElement),this},_mouseCapture:function(e){var t=!1;for(var i in this.handles)g(this.handles[i])[0]==e.target&&(t=!0);return!this.options.disabled&&t},_mouseStart:function(e){var t=this.options,i=this.element.position(),n=this.element;this.resizing=!0,this.documentScroll={top:g(document).scrollTop(),left:g(document).scrollLeft()},(n.is(".ui-draggable")||/absolute/.test(n.css("position")))&&n.css({position:"absolute",top:i.top,left:i.left}),this._renderProxy();var r=p(this.helper.css("left")),a=p(this.helper.css("top"));t.containment&&(r+=g(t.containment).scrollLeft()||0,a+=g(t.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:a},this.size=this._helper?{width:n.outerWidth(),height:n.outerHeight()}:{width:n.width(),height:n.height()},this.originalSize=this._helper?{width:n.outerWidth(),height:n.outerHeight()}:{width:n.width(),height:n.height()},this.originalPosition={left:r,top:a},this.sizeDiff={width:n.outerWidth()-n.width(),height:n.outerHeight()-n.height()},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio=typeof t.aspectRatio=="number"?t.aspectRatio:this.originalSize.width/this.originalSize.height||1;var s=g(".ui-resizable-"+this.axis).css("cursor");return g("body").css("cursor",s=="auto"?this.axis+"-resize":s),n.addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var t=this.helper,i=this.options,n={},r=this,a=this.originalMousePosition,s=this.axis,o=e.pageX-a.left||0,l=e.pageY-a.top||0,c=this._change[s];if(!c)return!1;var u=c.apply(this,[e,o,l]);this._updateVirtualBoundaries(e.shiftKey);if(this._aspectRatio||e.shiftKey)u=this._updateRatio(u,e);return u=this._respectSize(u,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(u),this._trigger("resize",e,this.ui()),!1},_mouseStop:function(e){this.resizing=!1;var t=this.options,i=this;if(this._helper){var n=this._proportionallyResizeElements,r=n.length&&/textarea/i.test(n[0].nodeName),a=r&&g.ui.hasScroll(n[0],"left")?0:i.sizeDiff.height,s=r?0:i.sizeDiff.width,o={width:i.helper.width()-s,height:i.helper.height()-a},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;t.animate||this.element.css(g.extend(o,{top:c,left:l})),i.helper.height(i.size.height),i.helper.width(i.size.width),this._helper&&!t.animate&&this._proportionallyResize()}return g("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t=this.options,i,n,r,a,s;s={minWidth:m(t.minWidth)?t.minWidth:0,maxWidth:m(t.maxWidth)?t.maxWidth:Infinity,minHeight:m(t.minHeight)?t.minHeight:0,maxHeight:m(t.maxHeight)?t.maxHeight:Infinity};if(this._aspectRatio||e)i=s.minHeight*this.aspectRatio,r=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,a=s.maxWidth/this.aspectRatio,i>s.minWidth&&(s.minWidth=i),r>s.minHeight&&(s.minHeight=r),n<s.maxWidth&&(s.maxWidth=n),a<s.maxHeight&&(s.maxHeight=a);this._vBoundaries=s},_updateCache:function(e){var t=this.options;this.offset=this.helper.offset(),m(e.left)&&(this.position.left=e.left),m(e.top)&&(this.position.top=e.top),m(e.height)&&(this.size.height=e.height),m(e.width)&&(this.size.width=e.width)},_updateRatio:function(e,t){var i=this.options,n=this.position,r=this.size,a=this.axis;return m(e.height)?e.width=e.height*this.aspectRatio:m(e.width)&&(e.height=e.width/this.aspectRatio),a=="sw"&&(e.left=n.left+(r.width-e.width),e.top=null),a=="nw"&&(e.top=n.top+(r.height-e.height),e.left=n.left+(r.width-e.width)),e},_respectSize:function(e,t){var i=this.helper,n=this._vBoundaries,r=this._aspectRatio||t.shiftKey,a=this.axis,s=m(e.width)&&n.maxWidth&&n.maxWidth<e.width,o=m(e.height)&&n.maxHeight&&n.maxHeight<e.height,l=m(e.width)&&n.minWidth&&n.minWidth>e.width,c=m(e.height)&&n.minHeight&&n.minHeight>e.height;l&&(e.width=n.minWidth),c&&(e.height=n.minHeight),s&&(e.width=n.maxWidth),o&&(e.height=n.maxHeight);var u=this.originalPosition.left+this.originalSize.width,d=this.position.top+this.size.height,h=/sw|nw|w/.test(a),f=/nw|ne|n/.test(a);l&&h&&(e.left=u-n.minWidth),s&&h&&(e.left=u-n.maxWidth),c&&f&&(e.top=d-n.minHeight),o&&f&&(e.top=d-n.maxHeight);var p=!e.width&&!e.height;return p&&!e.left&&e.top?e.top=null:p&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){var e=this.options;if(!this._proportionallyResizeElements.length)return;var t=this.helper||this.element;for(var i=0;i<this._proportionallyResizeElements.length;i++){var n=this._proportionallyResizeElements[i];if(!this.borderDif){var r=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],a=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")];this.borderDif=g.map(r,function(e,t){var i=parseInt(e,10)||0,n=parseInt(a[t],10)||0;return i+n})}n.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var e=this.element,t=this.options;this.elementOffset=e.offset();if(this._helper){this.helper=this.helper||g('<div style="overflow:hidden;"></div>');var i=g.ui.ie6?1:0,n=g.ui.ie6?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+n,height:this.element.outerHeight()+n,position:"absolute",left:this.elementOffset.left-i+"px",top:this.elementOffset.top-i+"px",zIndex:++t.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t,i){return{width:this.originalSize.width+t}},w:function(e,t,i){var n=this.options,r=this.originalSize,a=this.originalPosition;return{left:a.left+t,width:r.width-t}},n:function(e,t,i){var n=this.options,r=this.originalSize,a=this.originalPosition;return{top:a.top+i,height:r.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(e,t,i){return g.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,t,i]))},sw:function(e,t,i){return g.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,t,i]))},ne:function(e,t,i){return g.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,t,i]))},nw:function(e,t,i){return g.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,t,i]))}},_propagate:function(e,t){g.ui.plugin.call(this,e,[t,this.ui()]),e!="resize"&&this._trigger(e,t,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),g.ui.plugin.add("resizable","alsoResize",{start:function(e,t){var i=g(this).data("resizable"),n=i.options,r=function(e){g(e).each(function(){var e=g(this);e.data("resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};typeof n.alsoResize=="object"&&!n.alsoResize.parentNode?n.alsoResize.length?(n.alsoResize=n.alsoResize[0],r(n.alsoResize)):g.each(n.alsoResize,function(e){r(e)}):r(n.alsoResize)},resize:function(e,a){var t=g(this).data("resizable"),i=t.options,n=t.originalSize,r=t.originalPosition,s={height:t.size.height-n.height||0,width:t.size.width-n.width||0,top:t.position.top-r.top||0,left:t.position.left-r.left||0},o=function(e,i){g(e).each(function(){var e=g(this),n=g(this).data("resizable-alsoresize"),r={},t=i&&i.length?i:e.parents(a.originalElement[0]).length?["width","height"]:["width","height","top","left"];g.each(t,function(e,t){var i=(n[t]||0)+(s[t]||0);i&&i>=0&&(r[t]=i||null)}),e.css(r)})};typeof i.alsoResize=="object"&&!i.alsoResize.nodeType?g.each(i.alsoResize,function(e,t){o(e,t)}):o(i.alsoResize)},stop:function(e,t){g(this).removeData("resizable-alsoresize")}}),g.ui.plugin.add("resizable","animate",{stop:function(t,e){var i=g(this).data("resizable"),n=i.options,r=i._proportionallyResizeElements,a=r.length&&/textarea/i.test(r[0].nodeName),s=a&&g.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,o=a?0:i.sizeDiff.width,l={width:i.size.width-o,height:i.size.height-s},c=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(g.extend(l,u&&c?{top:u,left:c}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var e={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&g(r[0]).css({width:e.width,height:e.height}),i._updateCache(e),i._propagate("resize",t)}})}}),g.ui.plugin.add("resizable","containment",{start:function(e,t){var i=g(this).data("resizable"),n=i.options,r=i.element,a=n.containment,s=a instanceof g?a.get(0):/parent/.test(a)?r.parent().get(0):a;if(!s)return;i.containerElement=g(s);if(/document/.test(a)||a==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:g(document),left:0,top:0,width:g(document).width(),height:g(document).height()||document.body.parentNode.scrollHeight};else{var o=g(s),l=[];g(["Top","Right","Left","Bottom"]).each(function(e,t){l[e]=p(o.css("padding"+t))}),i.containerOffset=o.offset(),i.containerPosition=o.position(),i.containerSize={height:o.innerHeight()-l[3],width:o.innerWidth()-l[1]};var c=i.containerOffset,u=i.containerSize.height,d=i.containerSize.width,h=g.ui.hasScroll(s,"left")?s.scrollWidth:d,f=g.ui.hasScroll(s)?s.scrollHeight:u;i.parentData={element:s,left:c.left,top:c.top,width:h,height:f}}},resize:function(e,t){var i=g(this).data("resizable"),n=i.options,r=i.containerSize,a=i.containerOffset,s=i.size,o=i.position,l=i._aspectRatio||e.shiftKey,c={top:0,left:0},u=i.containerElement;u[0]!=document&&/static/.test(u.css("position"))&&(c=a),o.left<(i._helper?a.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-a.left:i.position.left-c.left),l&&(i.size.height=i.size.width/i.aspectRatio),i.position.left=n.helper?a.left:0),o.top<(i._helper?a.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-a.top:i.position.top),l&&(i.size.width=i.size.height*i.aspectRatio),i.position.top=i._helper?a.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top;var d=Math.abs((i._helper?i.offset.left-c.left:i.offset.left-c.left)+i.sizeDiff.width),h=Math.abs((i._helper?i.offset.top-c.top:i.offset.top-a.top)+i.sizeDiff.height),f=i.containerElement.get(0)==i.element.parent().get(0),p=/relative|absolute/.test(i.containerElement.css("position"));f&&p&&(d-=i.parentData.left),d+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-d,l&&(i.size.height=i.size.width/i.aspectRatio)),h+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-h,l&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(e,t){var i=g(this).data("resizable"),n=i.options,r=i.position,a=i.containerOffset,s=i.containerPosition,o=i.containerElement,l=g(i.helper),c=l.offset(),u=l.outerWidth()-i.sizeDiff.width,d=l.outerHeight()-i.sizeDiff.height;i._helper&&!n.animate&&/relative/.test(o.css("position"))&&g(this).css({left:c.left-s.left-a.left,width:u,height:d}),i._helper&&!n.animate&&/static/.test(o.css("position"))&&g(this).css({left:c.left-s.left-a.left,width:u,height:d})}}),g.ui.plugin.add("resizable","ghost",{start:function(e,t){var i=g(this).data("resizable"),n=i.options,r=i.size;i.ghost=i.originalElement.clone(),i.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof n.ghost=="string"?n.ghost:""),i.ghost.appendTo(i.helper)},resize:function(e,t){var i=g(this).data("resizable"),n=i.options;i.ghost&&i.ghost.css({position:"relative",height:i.size.height,width:i.size.width})},stop:function(e,t){var i=g(this).data("resizable"),n=i.options;i.ghost&&i.helper&&i.helper.get(0).removeChild(i.ghost.get(0))}}),g.ui.plugin.add("resizable","grid",{resize:function(e,t){var i=g(this).data("resizable"),n=i.options,r=i.size,a=i.originalSize,s=i.originalPosition,o=i.axis,l=n._aspectRatio||e.shiftKey;n.grid=typeof n.grid=="number"?[n.grid,n.grid]:n.grid;var c=Math.round((r.width-a.width)/(n.grid[0]||1))*(n.grid[0]||1),u=Math.round((r.height-a.height)/(n.grid[1]||1))*(n.grid[1]||1);/^(se|s|e)$/.test(o)?(i.size.width=a.width+c,i.size.height=a.height+u):/^(ne)$/.test(o)?(i.size.width=a.width+c,i.size.height=a.height+u,i.position.top=s.top-u):/^(sw)$/.test(o)?(i.size.width=a.width+c,i.size.height=a.height+u,i.position.left=s.left-c):(i.size.width=a.width+c,i.size.height=a.height+u,i.position.top=s.top-u,i.position.left=s.left-c)}});var p=function(e){return parseInt(e,10)||0},m=function(e){return!isNaN(parseInt(e,10))}})(jQuery);(function(c,e){c.widget("ui.selectable",c.ui.mouse,{version:"1.9.2",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var e=this;this.element.addClass("ui-selectable"),this.dragged=!1;var t;this.refresh=function(){t=c(e.options.filter,e.element[0]),t.addClass("ui-selectee"),t.each(function(){var e=c(this),t=e.offset();c.data(this,"selectable-item",{element:this,$element:e,left:t.left,top:t.top,right:t.left+e.outerWidth(),bottom:t.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=c("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(i){var n=this;this.opos=[i.pageX,i.pageY];if(this.options.disabled)return;var e=this.options;this.selectees=c(e.filter,this.element[0]),this._trigger("start",i),c(e.appendTo).append(this.helper),this.helper.css({left:i.clientX,top:i.clientY,width:0,height:0}),e.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var e=c.data(this,"selectable-item");e.startselected=!0,!i.metaKey&&!i.ctrlKey&&(e.$element.removeClass("ui-selected"),e.selected=!1,e.$element.addClass("ui-unselecting"),e.unselecting=!0,n._trigger("unselecting",i,{unselecting:e.element}))}),c(i.target).parents().andSelf().each(function(){var e=c.data(this,"selectable-item");if(e){var t=!i.metaKey&&!i.ctrlKey||!e.$element.hasClass("ui-selected");return e.$element.removeClass(t?"ui-unselecting":"ui-selected").addClass(t?"ui-selecting":"ui-unselecting"),e.unselecting=!t,e.selecting=t,e.selected=t,t?n._trigger("selecting",i,{selecting:e.element}):n._trigger("unselecting",i,{unselecting:e.element}),!1}})},_mouseDrag:function(i){var n=this;this.dragged=!0;if(this.options.disabled)return;var r=this.options,a=this.opos[0],s=this.opos[1],o=i.pageX,l=i.pageY;if(a>o){var e=o;o=a,a=e}if(s>l){var e=l;l=s,s=e}return this.helper.css({left:a,top:s,width:o-a,height:l-s}),this.selectees.each(function(){var e=c.data(this,"selectable-item");if(!e||e.element==n.element[0])return;var t=!1;r.tolerance=="touch"?t=!(e.left>o||e.right<a||e.top>l||e.bottom<s):r.tolerance=="fit"&&(t=e.left>a&&e.right<o&&e.top>s&&e.bottom<l),t?(e.selected&&(e.$element.removeClass("ui-selected"),e.selected=!1),e.unselecting&&(e.$element.removeClass("ui-unselecting"),e.unselecting=!1),e.selecting||(e.$element.addClass("ui-selecting"),e.selecting=!0,n._trigger("selecting",i,{selecting:e.element}))):(e.selecting&&((i.metaKey||i.ctrlKey)&&e.startselected?(e.$element.removeClass("ui-selecting"),e.selecting=!1,e.$element.addClass("ui-selected"),e.selected=!0):(e.$element.removeClass("ui-selecting"),e.selecting=!1,e.startselected&&(e.$element.addClass("ui-unselecting"),e.unselecting=!0),n._trigger("unselecting",i,{unselecting:e.element}))),e.selected&&!i.metaKey&&!i.ctrlKey&&!e.startselected&&(e.$element.removeClass("ui-selected"),e.selected=!1,e.$element.addClass("ui-unselecting"),e.unselecting=!0,n._trigger("unselecting",i,{unselecting:e.element})))}),!1},_mouseStop:function(t){var i=this;this.dragged=!1;var e=this.options;return c(".ui-unselecting",this.element[0]).each(function(){var e=c.data(this,"selectable-item");e.$element.removeClass("ui-unselecting"),e.unselecting=!1,e.startselected=!1,i._trigger("unselected",t,{unselected:e.element})}),c(".ui-selecting",this.element[0]).each(function(){var e=c.data(this,"selectable-item");e.$element.removeClass("ui-selecting").addClass("ui-selected"),e.selecting=!1,e.selected=!0,e.startselected=!0,i._trigger("selected",t,{selected:e.element})}),this._trigger("stop",t),this.helper.remove(),!1}})})(jQuery);(function(h,e){h.widget("ui.sortable",h.ui.mouse,{version:"1.9.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,t){e==="disabled"?(this.options[e]=t,this.widget().toggleClass("ui-sortable-disabled",!!t)):h.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,t){var i=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(e);var n=null,r=h(e.target).parents().each(function(){if(h.data(this,i.widgetName+"-item")==i)return n=h(this),!1});h.data(e.target,i.widgetName+"-item")==i&&(n=h(e.target));if(!n)return!1;if(this.options.handle&&!t){var a=!1;h(this.options.handle,n).find("*").andSelf().each(function(){this==e.target&&(a=!0)});if(!a)return!1}return this.currentItem=n,this._removeCurrentsFromItems(),!0},_mouseStart:function(e,t,i){var n=this.options;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},h.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),n.containment&&this._setContainment(),n.cursor&&(h("body").css("cursor")&&(this._storedCursor=h("body").css("cursor")),h("body").css("cursor",n.cursor)),n.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",n.opacity)),n.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",n.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!i)for(var r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",e,this._uiHash(this));return h.ui.ddmanager&&(h.ui.ddmanager.current=this),h.ui.ddmanager&&!n.dropBehaviour&&h.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var t=this.options,i=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<t.scrollSensitivity?this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop+t.scrollSpeed:e.pageY-this.overflowOffset.top<t.scrollSensitivity&&(this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop-t.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<t.scrollSensitivity?this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft+t.scrollSpeed:e.pageX-this.overflowOffset.left<t.scrollSensitivity&&(this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft-t.scrollSpeed)):(e.pageY-h(document).scrollTop()<t.scrollSensitivity?i=h(document).scrollTop(h(document).scrollTop()-t.scrollSpeed):h(window).height()-(e.pageY-h(document).scrollTop())<t.scrollSensitivity&&(i=h(document).scrollTop(h(document).scrollTop()+t.scrollSpeed)),e.pageX-h(document).scrollLeft()<t.scrollSensitivity?i=h(document).scrollLeft(h(document).scrollLeft()-t.scrollSpeed):h(window).width()-(e.pageX-h(document).scrollLeft())<t.scrollSensitivity&&(i=h(document).scrollLeft(h(document).scrollLeft()+t.scrollSpeed))),i!==!1&&h.ui.ddmanager&&!t.dropBehaviour&&h.ui.ddmanager.prepareOffsets(this,e)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var n=this.items.length-1;n>=0;n--){var r=this.items[n],a=r.item[0],s=this._intersectsWithPointer(r);if(!s)continue;if(r.instance!==this.currentContainer)continue;if(a!=this.currentItem[0]&&this.placeholder[s==1?"next":"prev"]()[0]!=a&&!h.contains(this.placeholder[0],a)&&(this.options.type=="semi-dynamic"?!h.contains(this.element[0],a):!0)){this.direction=s==1?"down":"up";if(this.options.tolerance!="pointer"&&!this._intersectsWithSides(r))break;this._rearrange(e,r),this._trigger("change",e,this._uiHash());break}}return this._contactContainers(e),h.ui.ddmanager&&h.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,t){if(!e)return;h.ui.ddmanager&&!this.options.dropBehaviour&&h.ui.ddmanager.drop(this,e);if(this.options.revert){var i=this,n=this.placeholder.offset();this.reverting=!0,h(this.helper).animate({left:n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){i._clear(e)})}else this._clear(e,t);return!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),h.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?h(this.domPosition.prev).after(this.currentItem):h(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var e=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},h(e).each(function(){var e=(h(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);e&&i.push((t.key||e[1]+"[]")+"="+(t.key&&t.expression?e[1]:e[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(e){var t=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},t.each(function(){i.push(h(e.item||this).attr(e.attribute||"id")||"")}),i},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,r=n+this.helperProportions.height,a=e.left,s=a+e.width,o=e.top,l=o+e.height,c=this.offset.click.top,u=this.offset.click.left,d=n+c>o&&n+c<l&&t+u>a&&t+u<s;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?d:a<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&o<n+this.helperProportions.height/2&&r-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t=this.options.axis==="x"||h.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i=this.options.axis==="y"||h.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),n=t&&i,r=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return n?this.floating?a&&a=="right"||r=="down"?2:1:r&&(r=="down"?2:1):!1},_intersectsWithSides:function(e){var t=h.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=h.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),n=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?r=="right"&&i||r=="left"&&!i:n&&(n=="down"&&t||n=="up"&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(e){var t=[],i=[],n=this._connectWith();if(n&&e)for(var r=n.length-1;r>=0;r--){var a=h(n[r]);for(var s=a.length-1;s>=0;s--){var o=h.data(a[s],this.widgetName);o&&o!=this&&!o.options.disabled&&i.push([h.isFunction(o.options.items)?o.options.items.call(o.element):h(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o])}}i.push([h.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):h(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var r=i.length-1;r>=0;r--)i[r][0].each(function(){t.push(this)});return h(t)},_removeCurrentsFromItems:function(){var i=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=h.grep(this.items,function(e){for(var t=0;t<i.length;t++)if(i[t]==e.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var t=this.items,i=[[h.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):h(this.options.items,this.element),this]],n=this._connectWith();if(n&&this.ready)for(var r=n.length-1;r>=0;r--){var a=h(n[r]);for(var s=a.length-1;s>=0;s--){var o=h.data(a[s],this.widgetName);o&&o!=this&&!o.options.disabled&&(i.push([h.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):h(o.options.items,o.element),o]),this.containers.push(o))}}for(var r=i.length-1;r>=0;r--){var l=i[r][1],c=i[r][0];for(var s=0,u=c.length;s<u;s++){var d=h(c[s]);d.data(this.widgetName+"-item",l),t.push({item:d,instance:l,width:0,height:0,left:0,top:0})}}},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var t=this.items.length-1;t>=0;t--){var i=this.items[t];if(i.instance!=this.currentContainer&&this.currentContainer&&i.item[0]!=this.currentItem[0])continue;var n=this.options.toleranceElement?h(this.options.toleranceElement,i.item):i.item;e||(i.width=n.outerWidth(),i.height=n.outerHeight());var r=n.offset();i.left=r.left,i.top=r.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var t=this.containers.length-1;t>=0;t--){var r=this.containers[t].element.offset();this.containers[t].containerCache.left=r.left,this.containers[t].containerCache.top=r.top,this.containers[t].containerCache.width=this.containers[t].element.outerWidth(),this.containers[t].containerCache.height=this.containers[t].element.outerHeight()}return this},_createPlaceholder:function(i){i=i||this;var n=i.options;if(!n.placeholder||n.placeholder.constructor==String){var r=n.placeholder;n.placeholder={element:function(){var e=h(document.createElement(i.currentItem[0].nodeName)).addClass(r||i.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(e.style.visibility="hidden"),e},update:function(e,t){if(r&&!n.forcePlaceholderSize)return;t.height()||t.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10)),t.width()||t.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10))}}}i.placeholder=h(n.placeholder.element.call(i.element,i.currentItem)),i.currentItem.after(i.placeholder),n.placeholder.update(i,i.placeholder)},_contactContainers:function(e){var t=null,i=null;for(var n=this.containers.length-1;n>=0;n--){if(h.contains(this.currentItem[0],this.containers[n].element[0]))continue;if(this._intersectsWith(this.containers[n].containerCache)){if(t&&h.contains(this.containers[n].element[0],t.element[0]))continue;t=this.containers[n],i=n}else this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",e,this._uiHash(this)),this.containers[n].containerCache.over=0)}if(!t)return;if(this.containers.length===1)this.containers[i]._trigger("over",e,this._uiHash(this)),this.containers[i].containerCache.over=1;else{var r=1e4,a=null,s=this.containers[i].floating?"left":"top",o=this.containers[i].floating?"width":"height",l=this.positionAbs[s]+this.offset.click[s];for(var c=this.items.length-1;c>=0;c--){if(!h.contains(this.containers[i].element[0],this.items[c].item[0]))continue;if(this.items[c].item[0]==this.currentItem[0])continue;var u=this.items[c].item.offset()[s],d=!1;Math.abs(u-l)>Math.abs(u+this.items[c][o]-l)&&(d=!0,u+=this.items[c][o]),Math.abs(u-l)<r&&(r=Math.abs(u-l),a=this.items[c],this.direction=d?"up":"down")}if(!a&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[i],a?this._rearrange(e,a,null,!0):this._rearrange(e,null,this.containers[i].element,!0),this._trigger("change",e,this._uiHash()),this.containers[i]._trigger("change",e,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[i]._trigger("over",e,this._uiHash(this)),this.containers[i].containerCache.over=1}},_createHelper:function(e){var t=this.options,i=h.isFunction(t.helper)?h(t.helper.apply(this.element[0],[e,this.currentItem])):t.helper=="clone"?this.currentItem.clone():this.currentItem;return i.parents("body").length||h(t.appendTo!="parent"?t.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(i[0].style.width==""||t.forceHelperSize)&&i.width(this.currentItem.width()),(i[0].style.height==""||t.forceHelperSize)&&i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(e){typeof e=="string"&&(e=e.split(" ")),h.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&h.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&h.ui.ie)e={top:0,left:0};return{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;e.containment=="parent"&&(e.containment=this.helper[0].parentNode);if(e.containment=="document"||e.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,h(e.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(h(e.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(e.containment)){var t=h(e.containment)[0],i=h(e.containment).offset(),n=h(t).css("overflow")!="hidden";this.containment=[i.left+(parseInt(h(t).css("borderLeftWidth"),10)||0)+(parseInt(h(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(h(t).css("borderTopWidth"),10)||0)+(parseInt(h(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(h(t).css("borderLeftWidth"),10)||0)-(parseInt(h(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(h(t).css("borderTopWidth"),10)||0)-(parseInt(h(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(e,t){t||(t=this.position);var i=e=="absolute"?1:-1,n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!h.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(r[0].tagName);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():a?0:r.scrollTop())*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():a?0:r.scrollLeft())*i}},_generatePosition:function(e){var t=this.options,i=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!h.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(i[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var r=e.pageX,a=e.pageY;if(this.originalPosition){this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top));if(t.grid){var s=this.originalPageY+Math.round((a-this.originalPageY)/t.grid[1])*t.grid[1];a=this.containment?s-this.offset.click.top<this.containment[1]||s-this.offset.click.top>this.containment[3]?s-this.offset.click.top<this.containment[1]?s+t.grid[1]:s-t.grid[1]:s:s;var o=this.originalPageX+Math.round((r-this.originalPageX)/t.grid[0])*t.grid[0];r=this.containment?o-this.offset.click.left<this.containment[0]||o-this.offset.click.left>this.containment[2]?o-this.offset.click.left<this.containment[0]?o+t.grid[0]:o-t.grid[0]:o:o}}return{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():n?0:i.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():n?0:i.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){r==this.counter&&this.refreshPositions(!n)})},_clear:function(e,t){this.reverting=!1;var i=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var n in this._storedCSS)if(this._storedCSS[n]=="auto"||this._storedCSS[n]=="static")this._storedCSS[n]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!t&&i.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!t&&i.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(i.push(function(e){this._trigger("remove",e,this._uiHash())}),i.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),i.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer))));for(var n=this.containers.length-1;n>=0;n--)t||i.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over&&(i.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over=0);this._storedCursor&&h("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!t){this._trigger("beforeStop",e,this._uiHash());for(var n=0;n<i.length;n++)i[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!t){for(var n=0;n<i.length;n++)i[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){h.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var t=e||this;return{helper:t.helper,placeholder:t.placeholder||h([]),position:t.position,originalPosition:t.originalPosition,offset:t.positionAbs,item:t.currentItem,sender:e?e.element:null}}})})(jQuery);(function(c,e){var t=0,h={},f={};h.height=h.paddingTop=h.paddingBottom=h.borderTopWidth=h.borderBottomWidth="hide",f.height=f.paddingTop=f.paddingBottom=f.borderTopWidth=f.borderBottomWidth="show",c.widget("ui.accordion",{version:"1.9.2",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var a=this.accordionId="ui-accordion-"+(this.element.attr("id")||++t),e=this.options;this.prevShow=this.prevHide=c(),this.element.addClass("ui-accordion ui-widget ui-helper-reset"),this.headers=this.element.find(e.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this._hoverable(this.headers),this._focusable(this.headers),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").hide(),!e.collapsible&&(e.active===!1||e.active==null)&&(e.active=0),e.active<0&&(e.active+=this.headers.length),this.active=this._findActive(e.active).addClass("ui-accordion-header-active ui-state-active").toggleClass("ui-corner-all ui-corner-top"),this.active.next().addClass("ui-accordion-content-active").show(),this._createIcons(),this.refresh(),this.element.attr("role","tablist"),this.headers.attr("role","tab").each(function(e){var t=c(this),i=t.attr("id"),n=t.next(),r=n.attr("id");i||(i=a+"-header-"+e,t.attr("id",i)),r||(r=a+"-panel-"+e,n.attr("id",r)),t.attr("aria-controls",r),n.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._on(this.headers,{keydown:"_keydown"}),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._setupEvents(e.event)},_getCreateEventData:function(){return{header:this.active,content:this.active.length?this.active.next():c()}},_createIcons:function(){var e=this.options.icons;e&&(c("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this.options.heightStyle!=="content"&&e.css("height","")},_setOption:function(e,t){if(e==="active"){this._activate(t);return}e==="event"&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),e==="collapsible"&&!t&&this.options.active===!1&&this._activate(0),e==="icons"&&(this._destroyIcons(),t&&this._createIcons()),e==="disabled"&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)},_keydown:function(e){if(e.altKey||e.ctrlKey)return;var t=c.ui.keyCode,i=this.headers.length,n=this.headers.index(e.target),r=!1;switch(e.keyCode){case t.RIGHT:case t.DOWN:r=this.headers[(n+1)%i];break;case t.LEFT:case t.UP:r=this.headers[(n-1+i)%i];break;case t.SPACE:case t.ENTER:this._eventHandler(e);break;case t.HOME:r=this.headers[0];break;case t.END:r=this.headers[i-1]}r&&(c(e.target).attr("tabIndex",-1),c(r).attr("tabIndex",0),r.focus(),e.preventDefault())},_panelKeyDown:function(e){e.keyCode===c.ui.keyCode.UP&&e.ctrlKey&&c(e.currentTarget).prev().focus()},refresh:function(){var i,e,t=this.options.heightStyle,n=this.element.parent();t==="fill"?(c.support.minHeight||(e=n.css("overflow"),n.css("overflow","hidden")),i=n.height(),this.element.siblings(":visible").each(function(){var e=c(this),t=e.css("position");if(t==="absolute"||t==="fixed")return;i-=e.outerHeight(!0)}),e&&n.css("overflow",e),this.headers.each(function(){i-=c(this).outerHeight(!0)}),this.headers.next().each(function(){c(this).height(Math.max(0,i-c(this).innerHeight()+c(this).height()))}).css("overflow","auto")):t==="auto"&&(i=0,this.headers.next().each(function(){i=Math.max(i,c(this).css("height","").height())}).height(i))},_activate:function(e){var t=this._findActive(e)[0];if(t===this.active[0])return;t=t||this.active[0],this._eventHandler({target:t,currentTarget:t,preventDefault:c.noop})},_findActive:function(e){return typeof e=="number"?this.headers.eq(e):c()},_setupEvents:function(e){var i={};if(!e)return;c.each(e.split(" "),function(e,t){i[t]="_eventHandler"}),this._on(this.headers,i)},_eventHandler:function(e){var t=this.options,i=this.active,n=c(e.currentTarget),r=n[0]===i[0],a=r&&t.collapsible,s=a?c():n.next(),o=i.next(),l={oldHeader:i,oldPanel:o,newHeader:a?c():n,newPanel:s};e.preventDefault();if(r&&!t.collapsible||this._trigger("beforeActivate",e,l)===!1)return;t.active=a?!1:this.headers.index(n),this.active=r?c():n,this._toggle(l),i.removeClass("ui-accordion-header-active ui-state-active"),t.icons&&i.children(".ui-accordion-header-icon").removeClass(t.icons.activeHeader).addClass(t.icons.header),r||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),t.icons&&n.children(".ui-accordion-header-icon").removeClass(t.icons.header).addClass(t.icons.activeHeader),n.next().addClass("ui-accordion-content-active"))},_toggle:function(e){var t=e.newPanel,i=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=t,this.prevHide=i,this.options.animate?this._animate(t,i,e):(i.hide(),t.show(),this._toggleComplete(e)),i.attr({"aria-expanded":"false","aria-hidden":"true"}),i.prev().attr("aria-selected","false"),t.length&&i.length?i.prev().attr("tabIndex",-1):t.length&&this.headers.filter(function(){return c(this).attr("tabIndex")===0}).attr("tabIndex",-1),t.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0})},_animate:function(e,i,t){var n,r,a,s=this,o=0,l=e.length&&(!i.length||e.index()<i.index()),c=this.options.animate||{},u=l&&c.down||c,d=function(){s._toggleComplete(t)};typeof u=="number"&&(a=u),typeof u=="string"&&(r=u),r=r||u.easing||c.easing,a=a||u.duration||c.duration;if(!i.length)return e.animate(f,a,r,d);if(!e.length)return i.animate(h,a,r,d);n=e.show().outerHeight(),i.animate(h,{duration:a,easing:r,step:function(e,t){t.now=Math.round(e)}}),e.hide().animate(f,{duration:a,easing:r,complete:d,step:function(e,t){t.now=Math.round(e),t.prop!=="height"?o+=t.now:s.options.heightStyle!=="content"&&(t.now=Math.round(n-i.outerHeight()-o),o=0)}})},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),c.uiBackCompat!==!1&&(function(r,e){r.extend(e.options,{navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}});var a=e._create;e._create=function(){if(this.options.navigation){var t=this,e=this.element.find(this.options.header),i=e.next(),n=e.add(i).find("a").filter(this.options.navigationFilter)[0];n&&e.add(i).each(function(e){if(r.contains(this,n))return t.options.active=Math.floor(e/2),!1})}a.call(this)}}(jQuery,jQuery.ui.accordion.prototype),function(e,t){e.extend(t.options,{heightStyle:null,autoHeight:!0,clearStyle:!1,fillSpace:!1});var i=t._create,n=t._setOption;e.extend(t,{_create:function(){this.options.heightStyle=this.options.heightStyle||this._mergeHeightStyle(),i.call(this)},_setOption:function(e){if(e==="autoHeight"||e==="clearStyle"||e==="fillSpace")this.options.heightStyle=this._mergeHeightStyle();n.apply(this,arguments)},_mergeHeightStyle:function(){var e=this.options;if(e.fillSpace)return"fill";if(e.clearStyle)return"content";if(e.autoHeight)return"auto"}})}(jQuery,jQuery.ui.accordion.prototype),function(e,t){e.extend(t.options.icons,{activeHeader:null,headerSelected:"ui-icon-triangle-1-s"});var i=t._createIcons;t._createIcons=function(){this.options.icons&&(this.options.icons.activeHeader=this.options.icons.activeHeader||this.options.icons.headerSelected),i.call(this)}}(jQuery,jQuery.ui.accordion.prototype),function(e,t){t.activate=t._activate;var i=t._findActive;t._findActive=function(e){return e===-1&&(e=!1),e&&typeof e!="number"&&(e=this.headers.index(this.headers.filter(e)),e===-1&&(e=!1)),i.call(this,e)}}(jQuery,jQuery.ui.accordion.prototype),jQuery.ui.accordion.prototype.resize=jQuery.ui.accordion.prototype.refresh,function(e,t){e.extend(t.options,{change:null,changestart:null});var r=t._trigger;t._trigger=function(e,t,i){var n=r.apply(this,arguments);return n?(e==="beforeActivate"?n=r.call(this,"changestart",t,{oldHeader:i.oldHeader,oldContent:i.oldPanel,newHeader:i.newHeader,newContent:i.newPanel}):e==="activate"&&(n=r.call(this,"change",t,{oldHeader:i.oldHeader,oldContent:i.oldPanel,newHeader:i.newHeader,newContent:i.newPanel})),n):!1}}(jQuery,jQuery.ui.accordion.prototype),function(e,t){e.extend(t.options,{animate:null,animated:"slide"});var i=t._create;t._create=function(){var e=this.options;e.animate===null&&(e.animated?e.animated==="slide"?e.animate=300:e.animated==="bounceslide"?e.animate={duration:200,down:{easing:"easeOutBounce",duration:1e3}}:e.animate=e.animated:e.animate=!1),i.call(this)}}(jQuery,jQuery.ui.accordion.prototype))})(jQuery);(function(a,e){var n=0;a.widget("ui.autocomplete",{version:"1.9.2",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var i,n,r;this.isMultiLine=this._isMultiLine(),this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(e){if(this.element.prop("readOnly")){i=!0,r=!0,n=!0;return}i=!1,r=!1,n=!1;var t=a.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:i=!0,this._move("previousPage",e);break;case t.PAGE_DOWN:i=!0,this._move("nextPage",e);break;case t.UP:i=!0,this._keyEvent("previous",e);break;case t.DOWN:i=!0,this._keyEvent("next",e);break;case t.ENTER:case t.NUMPAD_ENTER:this.menu.active&&(i=!0,e.preventDefault(),this.menu.select(e));break;case t.TAB:this.menu.active&&this.menu.select(e);break;case t.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(e),e.preventDefault());break;default:n=!0,this._searchTimeout(e)}},keypress:function(e){if(i){i=!1,e.preventDefault();return}if(n)return;var t=a.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:this._move("previousPage",e);break;case t.PAGE_DOWN:this._move("nextPage",e);break;case t.UP:this._keyEvent("previous",e);break;case t.DOWN:this._keyEvent("next",e)}},input:function(e){if(r){r=!1,e.preventDefault();return}this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;return}clearTimeout(this.searching),this.close(e),this._change(e)}}),this._initSource(),this.menu=a("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:a(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];a(e.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(e){e.target!==t.element[0]&&e.target!==i&&!a.contains(i,e.target)&&t.close()})})},menufocus:function(e,t){if(this.isNewMenu){this.isNewMenu=!1;if(e.originalEvent&&/^mouse/.test(e.originalEvent.type)){this.menu.blur(),this.document.one("mousemove",function(){a(e.target).trigger(e.originalEvent)});return}}var i=t.item.data("ui-autocomplete-item")||t.item.data("item.autocomplete");!1!==this._trigger("focus",e,{item:i})?e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(i.value):this.liveRegion.text(i.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item")||t.item.data("item.autocomplete"),n=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=a("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),a.fn.bgiframe&&this.menu.element.bgiframe(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),e==="source"&&this._initSource(),e==="appendTo"&&this.menu.element.appendTo(this.document.find(t||"body")[0]),e==="disabled"&&t&&this.xhr&&this.xhr.abort()},_isMultiLine:function(){return this.element.is("textarea")?!0:this.element.is("input")?!1:this.element.prop("isContentEditable")},_initSource:function(){var i,n,r=this;a.isArray(this.options.source)?(i=this.options.source,this.source=function(e,t){t(a.ui.autocomplete.filter(i,e.term))}):typeof this.options.source=="string"?(n=this.options.source,this.source=function(e,t){r.xhr&&r.xhr.abort(),r.xhr=a.ajax({url:n,data:e,dataType:"json",success:function(e){t(e)},error:function(){t([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){e=e!=null?e:this._value(),this.term=this._value();if(e.length<this.options.minLength)return this.close(t);if(this._trigger("search",t)===!1)return;return this._search(e)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=this,i=++n;return function(e){i===n&&t.__response(e),t.pending--,t.pending||t.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:a.map(e,function(e){return typeof e=="string"?{label:e,value:e}:a.extend({label:e.label||e.value,value:e.value||e.label},e)})},_suggest:function(e){var t=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(t,e),this.menu.refresh(),t.show(),this._resizeMenu(),t.position(a.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(i,e){var n=this;a.each(e,function(e,t){n._renderItemData(i,t)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(e,t){return a("<li>").append(a("<a>").text(t.label)).appendTo(e)},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)){this._value(this.term),this.menu.blur();return}this.menu[e](t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(e,t),t.preventDefault()}}),a.extend(a.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,t){var i=new RegExp(a.ui.autocomplete.escapeRegex(t),"i");return a.grep(e,function(e){return i.test(e.label||e.value||e)})}}),a.widget("ui.autocomplete",a.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments);if(this.options.disabled||this.cancelSearch)return;e&&e.length?t=this.options.messages.results(e.length):t=this.options.messages.noResults,this.liveRegion.text(t)}})})(jQuery);(function(a,e){var s,o,l,c,u="ui-button ui-widget ui-state-default ui-corner-all",t="ui-state-hover ui-state-active ",d="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",h=function(){var e=a(this).find(":ui-button");setTimeout(function(){e.button("refresh")},1)},f=function(e){var t=e.name,i=e.form,n=a([]);return t&&(i?n=a(i).find("[name='"+t+"']"):n=a("[name='"+t+"']",e.ownerDocument).filter(function(){return!this.form})),n};a.widget("ui.button",{version:"1.9.2",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,h),typeof this.options.disabled!="boolean"?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,e=this.type==="checkbox"||this.type==="radio",n=e?"":"ui-state-active",r="ui-state-focus";i.label===null&&(i.label=this.type==="input"?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(u).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){if(i.disabled)return;this===s&&a(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){if(i.disabled)return;a(this).removeClass(n)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this.element.bind("focus"+this.eventNamespace,function(){t.buttonElement.addClass(r)}).bind("blur"+this.eventNamespace,function(){t.buttonElement.removeClass(r)}),e&&(this.element.bind("change"+this.eventNamespace,function(){if(c)return;t.refresh()}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(e){if(i.disabled)return;c=!1,o=e.pageX,l=e.pageY}).bind("mouseup"+this.eventNamespace,function(e){if(i.disabled)return;if(o!==e.pageX||l!==e.pageY)c=!0})),this.type==="checkbox"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled||c)return!1;a(this).toggleClass("ui-state-active"),t.buttonElement.attr("aria-pressed",t.element[0].checked)}):this.type==="radio"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled||c)return!1;a(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var e=t.element[0];f(e).not(e).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(i.disabled)return!1;a(this).addClass("ui-state-active"),s=this,t.document.one("mouseup",function(){s=null})}).bind("mouseup"+this.eventNamespace,function(){if(i.disabled)return!1;a(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(e){if(i.disabled)return!1;(e.keyCode===a.ui.keyCode.SPACE||e.keyCode===a.ui.keyCode.ENTER)&&a(this).addClass("ui-state-active")}).bind("keyup"+this.eventNamespace,function(){a(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(e){e.keyCode===a.ui.keyCode.SPACE&&a(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button",this.type==="checkbox"||this.type==="radio"?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(u+" "+t+" "+d).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){this._super(e,t);if(e==="disabled"){t?this.element.prop("disabled",!0):this.element.prop("disabled",!1);return}this._resetButton()},refresh:function(){var e=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOption("disabled",e),this.type==="radio"?f(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if(this.type==="input"){this.options.label&&this.element.val(this.options.label);return}var e=this.buttonElement.removeClass(d),t=a("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),i=this.options.icons,n=i.primary&&i.secondary,r=[];i.primary||i.secondary?(this.options.text&&r.push("ui-button-text-icon"+(n?"s":i.primary?"-primary":"-secondary")),i.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+i.primary+"'></span>"),i.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+i.secondary+"'></span>"),this.options.text||(r.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",a.trim(t)))):r.push("ui-button-text-only"),e.addClass(r.join(" "))}}),a.widget("ui.buttonset",{version:"1.9.2",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){e==="disabled"&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var e=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(e?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})})(jQuery);(function($,undefined){function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function bindHover(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(t,"mouseout",function(){$(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&$(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&$(this).removeClass("ui-datepicker-next-hover")}).delegate(t,"mouseover",function(){$.datepicker._isDisabledDatepicker(instActive.inline?e.parent()[0]:instActive.input[0])||($(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),$(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&$(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&$(this).addClass("ui-datepicker-next-hover"))})}function extendRemove(e,t){$.extend(e,t);for(var i in t)if(t[i]==null||t[i]==undefined)e[i]=t[i];return e}$.extend($.ui,{datepicker:{version:"1.9.2"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline=nodeName=="div"||nodeName=="span";target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),nodeName=="input"?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(e,t){var i=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:i,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(e,n){var t=$(e);n.append=$([]),n.trigger=$([]);if(t.hasClass(this.markerClassName))return;this._attachments(t,n),t.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,t,i){n.settings[t]=i}).bind("getData.datepicker",function(e,t){return this._get(n,t)}),this._autoSize(n),$.data(e,PROP_NAME,n),n.settings.disabled&&this._disableDatepicker(e)},_attachments:function(e,t){var i=this._get(t,"appendText"),n=this._get(t,"isRTL");t.append&&t.append.remove(),i&&(t.append=$('<span class="'+this._appendClass+'">'+i+"</span>"),e[n?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove();var r=this._get(t,"showOn");(r=="focus"||r=="both")&&e.focus(this._showDatepicker);if(r=="button"||r=="both"){var a=this._get(t,"buttonText"),s=this._get(t,"buttonImage");t.trigger=$(this._get(t,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:s,alt:a,title:a}):$('<button type="button"></button>').addClass(this._triggerClass).html(s==""?a:$("<img/>").attr({src:s,alt:a,title:a}))),e[n?"before":"after"](t.trigger),t.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput==e[0]?$.datepicker._hideDatepicker():$.datepicker._datepickerShowing&&$.datepicker._lastInput!=e[0]?($.datepicker._hideDatepicker(),$.datepicker._showDatepicker(e[0])):$.datepicker._showDatepicker(e[0]),!1})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,11,20),i=this._get(e,"dateFormat");if(i.match(/[DM]/)){var n=function(e){var t=0,i=0;for(var n=0;n<e.length;n++)e[n].length>t&&(t=e[n].length,i=n);return i};t.setMonth(n(this._get(e,i.match(/MM/)?"monthNames":"monthNamesShort"))),t.setDate(n(this._get(e,i.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())}e.input.attr("size",this._formatDate(e,t).length)}},_inlineDatepicker:function(e,n){var t=$(e);if(t.hasClass(this.markerClassName))return;t.addClass(this.markerClassName).append(n.dpDiv).bind("setData.datepicker",function(e,t,i){n.settings[t]=i}).bind("getData.datepicker",function(e,t){return this._get(n,t)}),$.data(e,PROP_NAME,n),this._setDate(n,this._getDefaultDate(n),!0),this._updateDatepicker(n),this._updateAlternate(n),n.settings.disabled&&this._disableDatepicker(e),n.dpDiv.css("display","block")},_dialogDatepicker:function(e,t,i,n,r){var a=this._dialogInst;if(!a){this.uuid+=1;var s="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+s+'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),a=this._dialogInst=this._newInst(this._dialogInput,!1),a.settings={},$.data(this._dialogInput[0],PROP_NAME,a)}extendRemove(a.settings,n||{}),t=t&&t.constructor==Date?this._formatDate(a,t):t,this._dialogInput.val(t),this._pos=r?r.length?r:[r.pageX,r.pageY]:null;if(!this._pos){var o=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[o/2-100+c,l/2-150+u]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),a.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,a),this},_destroyDatepicker:function(e){var t=$(e),i=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName))return;var n=e.nodeName.toLowerCase();$.removeData(e,PROP_NAME),n=="input"?(i.append.remove(),i.trigger.remove(),t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(n=="div"||n=="span")&&t.removeClass(this.markerClassName).empty()},_enableDatepicker:function(t){var e=$(t),i=$.data(t,PROP_NAME);if(!e.hasClass(this.markerClassName))return;var n=t.nodeName.toLowerCase();if(n=="input")t.disabled=!1,i.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if(n=="div"||n=="span"){var r=e.children("."+this._inlineClass);r.children().removeClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)}this._disabledInputs=$.map(this._disabledInputs,function(e){return e==t?null:e})},_disableDatepicker:function(t){var e=$(t),i=$.data(t,PROP_NAME);if(!e.hasClass(this.markerClassName))return;var n=t.nodeName.toLowerCase();if(n=="input")t.disabled=!0,i.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if(n=="div"||n=="span"){var r=e.children("."+this._inlineClass);r.children().addClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)}this._disabledInputs=$.map(this._disabledInputs,function(e){return e==t?null:e}),this._disabledInputs[this._disabledInputs.length]=t},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]==e)return!0;return!1},_getInst:function(e){try{return $.data(e,PROP_NAME)}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,i){var n=this._getInst(e);if(arguments.length==2&&typeof t=="string")return t=="defaults"?$.extend({},$.datepicker._defaults):n?t=="all"?$.extend({},n.settings):this._get(n,t):null;var r=t||{};typeof t=="string"&&(r={},r[t]=i);if(n){this._curInst==n&&this._hideDatepicker();var a=this._getDateDatepicker(e,!0),s=this._getMinMaxDate(n,"min"),o=this._getMinMaxDate(n,"max");extendRemove(n.settings,r),s!==null&&r.dateFormat!==undefined&&r.minDate===undefined&&(n.settings.minDate=this._formatDate(n,s)),o!==null&&r.dateFormat!==undefined&&r.maxDate===undefined&&(n.settings.maxDate=this._formatDate(n,o)),this._attachments($(e),n),this._autoSize(n),this._setDate(n,a),this._updateAlternate(n),this._updateDatepicker(n)}},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(e){var t=$.datepicker._getInst(e.target),i=!0,n=t.dpDiv.is(".ui-datepicker-rtl");t._keyEvent=!0;if($.datepicker._datepickerShowing)switch(e.keyCode){case 9:$.datepicker._hideDatepicker(),i=!1;break;case 13:var r=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",t.dpDiv);r[0]&&$.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,r[0]);var a=$.datepicker._get(t,"onSelect");if(a){var s=$.datepicker._formatDate(t);a.apply(t.input?t.input[0]:null,[s,t])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&$.datepicker._clearDate(e.target),i=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&$.datepicker._gotoToday(e.target),i=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,n?1:-1,"D"),i=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,-7,"D"),i=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,n?-1:1,"D"),i=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,7,"D"),i=e.ctrlKey||e.metaKey;break;default:i=!1}else e.keyCode==36&&e.ctrlKey?$.datepicker._showDatepicker(this):i=!1;i&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t=$.datepicker._getInst(e.target);if($.datepicker._get(t,"constrainInput")){var i=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),n=String.fromCharCode(e.charCode==undefined?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||n<" "||!i||i.indexOf(n)>-1}},_doKeyUp:function(e){var t=$.datepicker._getInst(e.target);if(t.input.val()!=t.lastVal)try{var i=$.datepicker.parseDate($.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,$.datepicker._getFormatConfig(t));i&&($.datepicker._setDateFromField(t),$.datepicker._updateAlternate(t),$.datepicker._updateDatepicker(t))}catch(e){$.datepicker.log(e)}return!0},_showDatepicker:function(e){e=e.target||e,e.nodeName.toLowerCase()!="input"&&(e=$("input",e.parentNode)[0]);if($.datepicker._isDisabledDatepicker(e)||$.datepicker._lastInput==e)return;var i=$.datepicker._getInst(e);$.datepicker._curInst&&$.datepicker._curInst!=i&&($.datepicker._curInst.dpDiv.stop(!0,!0),i&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));var t=$.datepicker._get(i,"beforeShow"),n=t?t.apply(e,[e,i]):{};if(n===!1)return;extendRemove(i.settings,n),i.lastVal=null,$.datepicker._lastInput=e,$.datepicker._setDateFromField(i),$.datepicker._inDialog&&(e.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(e),$.datepicker._pos[1]+=e.offsetHeight);var r=!1;$(e).parents().each(function(){return r|=$(this).css("position")=="fixed",!r});var a={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(i),a=$.datepicker._checkOffset(i,a,r),i.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":r?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px"});if(!i.inline){var s=$.datepicker._get(i,"showAnim"),o=$.datepicker._get(i,"duration"),l=function(){var e=i.dpDiv.find("iframe.ui-datepicker-cover");if(!!e.length){var t=$.datepicker._getBorders(i.dpDiv);e.css({left:-t[0],top:-t[1],width:i.dpDiv.outerWidth(),height:i.dpDiv.outerHeight()})}};i.dpDiv.zIndex($(e).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&($.effects.effect[s]||$.effects[s])?i.dpDiv.show(s,$.datepicker._get(i,"showOptions"),o,l):i.dpDiv[s||"show"](s?o:null,l),(!s||!o)&&l(),i.input.is(":visible")&&!i.input.is(":disabled")&&i.input.focus(),$.datepicker._curInst=i}},_updateDatepicker:function(e){this.maxRows=4;var t=$.datepicker._getBorders(e.dpDiv);instActive=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i=e.dpDiv.find("iframe.ui-datepicker-cover");!i.length||i.css({left:-t[0],top:-t[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()}),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var n=this._getNumberOfMonths(e),r=n[1],a=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),r>1&&e.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",a*r+"em"),e.dpDiv[(n[0]!=1||n[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e==$.datepicker._curInst&&$.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input[0]!=document.activeElement&&e.input.focus();if(e.yearshtml){var s=e.yearshtml;setTimeout(function(){s===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),s=e.yearshtml=null},0)}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(e,t,i){var n=e.dpDiv.outerWidth(),r=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,s=e.input?e.input.outerHeight():0,o=document.documentElement.clientWidth+(i?0:$(document).scrollLeft()),l=document.documentElement.clientHeight+(i?0:$(document).scrollTop());return t.left-=this._get(e,"isRTL")?n-a:0,t.left-=i&&t.left==e.input.offset().left?$(document).scrollLeft():0,t.top-=i&&t.top==e.input.offset().top+s?$(document).scrollTop():0,t.left-=Math.min(t.left,t.left+n>o&&o>n?Math.abs(t.left+n-o):0),t.top-=Math.min(t.top,t.top+r>l&&l>r?Math.abs(r+s):0),t},_findPos:function(e){var t=this._getInst(e),i=this._get(t,"isRTL");while(e&&(e.type=="hidden"||e.nodeType!=1||$.expr.filters.hidden(e)))e=e[i?"previousSibling":"nextSibling"];var n=$(e).offset();return[n.left,n.top]},_hideDatepicker:function(e){var t=this._curInst;if(!t||e&&t!=$.data(e,PROP_NAME))return;if(this._datepickerShowing){var i=this._get(t,"showAnim"),n=this._get(t,"duration"),r=function(){$.datepicker._tidyDialog(t)};$.effects&&($.effects.effect[i]||$.effects[i])?t.dpDiv.hide(i,$.datepicker._get(t,"showOptions"),n,r):t.dpDiv[i=="slideDown"?"slideUp":i=="fadeIn"?"fadeOut":"hide"](i?n:null,r),i||r(),this._datepickerShowing=!1;var a=this._get(t,"onClose");a&&a.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(!$.datepicker._curInst)return;var t=$(e.target),i=$.datepicker._getInst(t[0]);(t[0].id!=$.datepicker._mainDivId&&t.parents("#"+$.datepicker._mainDivId).length==0&&!t.hasClass($.datepicker.markerClassName)&&!t.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||t.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=i)&&$.datepicker._hideDatepicker()},_adjustDate:function(e,t,i){var n=$(e),r=this._getInst(n[0]);if(this._isDisabledDatepicker(n[0]))return;this._adjustInstDate(r,t+(i=="M"?this._get(r,"showCurrentAtPos"):0),i),this._updateDatepicker(r)},_gotoToday:function(e){var t=$(e),i=this._getInst(t[0]);if(this._get(i,"gotoCurrent")&&i.currentDay)i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear;else{var n=new Date;i.selectedDay=n.getDate(),i.drawMonth=i.selectedMonth=n.getMonth(),i.drawYear=i.selectedYear=n.getFullYear()}this._notifyChange(i),this._adjustDate(t)},_selectMonthYear:function(e,t,i){var n=$(e),r=this._getInst(n[0]);r["selected"+(i=="M"?"Month":"Year")]=r["draw"+(i=="M"?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(r),this._adjustDate(n)},_selectDay:function(e,t,i,n){var r=$(e);if($(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(r[0]))return;var a=this._getInst(r[0]);a.selectedDay=a.currentDay=$("a",n).html(),a.selectedMonth=a.currentMonth=t,a.selectedYear=a.currentYear=i,this._selectDate(e,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear))},_clearDate:function(e){var t=$(e),i=this._getInst(t[0]);this._selectDate(t,"")},_selectDate:function(e,t){var i=$(e),n=this._getInst(i[0]);t=t!=null?t:this._formatDate(n),n.input&&n.input.val(t),this._updateAlternate(n);var r=this._get(n,"onSelect");r?r.apply(n.input?n.input[0]:null,[t,n]):n.input&&n.input.trigger("change"),n.inline?this._updateDatepicker(n):(this._hideDatepicker(),this._lastInput=n.input[0],typeof n.input[0]!="object"&&n.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var i=this._get(e,"altFormat")||this._get(e,"dateFormat"),n=this._getDate(e),r=this.formatDate(i,n,this._getFormatConfig(e));$(t).each(function(){$(this).val(r)})}},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t=new Date(e.getTime());t.setDate(t.getDate()+4-(t.getDay()||7));var i=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((i-t)/864e5)/7)+1},parseDate:function(i,a,e){if(i==null||a==null)throw"Invalid arguments";a=typeof a=="object"?a.toString():a+"";if(a=="")return null;var t=(e?e.shortYearCutoff:null)||this._defaults.shortYearCutoff;t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10);var n=(e?e.dayNamesShort:null)||this._defaults.dayNamesShort,r=(e?e.dayNames:null)||this._defaults.dayNames,s=(e?e.monthNamesShort:null)||this._defaults.monthNamesShort,o=(e?e.monthNames:null)||this._defaults.monthNames,l=-1,c=-1,u=-1,d=-1,h=!1,f=function(e){var t=y+1<i.length&&i.charAt(y+1)==e;return t&&y++,t},p=function(e){var t=f(e),i=e=="@"?14:e=="!"?20:e=="y"&&t?4:e=="o"?3:2,n=new RegExp("^\\d{1,"+i+"}"),r=a.substring(v).match(n);if(!r)throw"Missing number at position "+v;return v+=r[0].length,parseInt(r[0],10)},g=function(e,t,i){var n=$.map(f(e)?i:t,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)}),r=-1;$.each(n,function(e,t){var i=t[1];if(a.substr(v,i.length).toLowerCase()==i.toLowerCase())return r=t[0],v+=i.length,!1});if(r!=-1)return r+1;throw"Unknown name at position "+v},m=function(){if(a.charAt(v)!=i.charAt(y))throw"Unexpected literal at position "+v;v++},v=0;for(var y=0;y<i.length;y++)if(h)i.charAt(y)=="'"&&!f("'")?h=!1:m();else switch(i.charAt(y)){case"d":u=p("d");break;case"D":g("D",n,r);break;case"o":d=p("o");break;case"m":c=p("m");break;case"M":c=g("M",s,o);break;case"y":l=p("y");break;case"@":var _=new Date(p("@"));l=_.getFullYear(),c=_.getMonth()+1,u=_.getDate();break;case"!":var _=new Date((p("!")-this._ticksTo1970)/1e4);l=_.getFullYear(),c=_.getMonth()+1,u=_.getDate();break;case"'":f("'")?m():h=!0;break;default:m()}if(v<a.length){var b=a.substr(v);if(!/^\s+/.test(b))throw"Extra/unparsed characters found in date: "+b}l==-1?l=(new Date).getFullYear():l<100&&(l+=(new Date).getFullYear()-(new Date).getFullYear()%100+(l<=t?0:-100));if(d>-1){c=1,u=d;do{var w=this._getDaysInMonth(l,c-1);if(u<=w)break;c++,u-=w}while(!0)}var _=this._daylightSavingAdjust(new Date(l,c-1,u));if(_.getFullYear()!=l||_.getMonth()+1!=c||_.getDate()!=u)throw"Invalid date";return _},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1e7,formatDate:function(i,e,t){if(!e)return"";var n=(t?t.dayNamesShort:null)||this._defaults.dayNamesShort,r=(t?t.dayNames:null)||this._defaults.dayNames,a=(t?t.monthNamesShort:null)||this._defaults.monthNamesShort,s=(t?t.monthNames:null)||this._defaults.monthNames,o=function(e){var t=h+1<i.length&&i.charAt(h+1)==e;return t&&h++,t},l=function(e,t,i){var n=""+t;if(o(e))while(n.length<i)n="0"+n;return n},c=function(e,t,i,n){return o(e)?n[t]:i[t]},u="",d=!1;if(e)for(var h=0;h<i.length;h++)if(d)i.charAt(h)=="'"&&!o("'")?d=!1:u+=i.charAt(h);else switch(i.charAt(h)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,r);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,s);break;case"y":u+=o("y")?e.getFullYear():(e.getYear()%100<10?"0":"")+e.getYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=e.getTime()*1e4+this._ticksTo1970;break;case"'":o("'")?u+="'":d=!0;break;default:u+=i.charAt(h)}return u},_possibleChars:function(i){var e="",t=!1,n=function(e){var t=r+1<i.length&&i.charAt(r+1)==e;return t&&r++,t};for(var r=0;r<i.length;r++)if(t)i.charAt(r)=="'"&&!n("'")?t=!1:e+=i.charAt(r);else switch(i.charAt(r)){case"d":case"m":case"y":case"@":e+="0123456789";break;case"D":case"M":return null;case"'":n("'")?e+="'":t=!0;break;default:e+=i.charAt(r)}return e},_get:function(e,t){return e.settings[t]!==undefined?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()==e.lastVal)return;var i=this._get(e,"dateFormat"),n=e.lastVal=e.input?e.input.val():null,r,a;r=a=this._getDefaultDate(e);var s=this._getFormatConfig(e);try{r=this.parseDate(i,n,s)||a}catch(e){this.log(e),n=t?"":n}e.selectedDay=r.getDate(),e.drawMonth=e.selectedMonth=r.getMonth(),e.drawYear=e.selectedYear=r.getFullYear(),e.currentDay=n?r.getDate():0,e.currentMonth=n?r.getMonth():0,e.currentYear=n?r.getFullYear():0,this._adjustInstDate(e)},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(o,e,t){var i=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},n=function(e){try{return $.datepicker.parseDate($.datepicker._get(o,"dateFormat"),e,$.datepicker._getFormatConfig(o))}catch(e){}var t=(e.toLowerCase().match(/^c/)?$.datepicker._getDate(o):null)||new Date,i=t.getFullYear(),n=t.getMonth(),r=t.getDate(),a=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,s=a.exec(e);while(s){switch(s[2]||"d"){case"d":case"D":r+=parseInt(s[1],10);break;case"w":case"W":r+=parseInt(s[1],10)*7;break;case"m":case"M":n+=parseInt(s[1],10),r=Math.min(r,$.datepicker._getDaysInMonth(i,n));break;case"y":case"Y":i+=parseInt(s[1],10),r=Math.min(r,$.datepicker._getDaysInMonth(i,n))}s=a.exec(e)}return new Date(i,n,r)},r=e==null||e===""?t:typeof e=="string"?n(e):typeof e=="number"?isNaN(e)?t:i(e):new Date(e.getTime());return r=r&&r.toString()=="Invalid Date"?t:r,r&&(r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0)),this._daylightSavingAdjust(r)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var n=!t,r=e.selectedMonth,a=e.selectedYear,s=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=s.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=s.getMonth(),e.drawYear=e.selectedYear=e.currentYear=s.getFullYear(),(r!=e.selectedMonth||a!=e.selectedYear)&&!i&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(n?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&e.input.val()==""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(e){var t=this._get(e,"stepMonths"),i="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(i,-t,"M")},next:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(i,+t,"M")},hide:function(){window["DP_jQuery_"+dpuuid].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+dpuuid].datepicker._gotoToday(i)},selectDay:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(i,this,"Y"),!1}};$(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t=new Date;t=this._daylightSavingAdjust(new Date(t.getFullYear(),t.getMonth(),t.getDate()));var i=this._get(e,"isRTL"),n=this._get(e,"showButtonPanel"),r=this._get(e,"hideIfNoPrevNext"),a=this._get(e,"navigationAsDateFormat"),s=this._getNumberOfMonths(e),o=this._get(e,"showCurrentAtPos"),l=this._get(e,"stepMonths"),c=s[0]!=1||s[1]!=1,u=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),d=this._getMinMaxDate(e,"min"),h=this._getMinMaxDate(e,"max"),f=e.drawMonth-o,p=e.drawYear;f<0&&(f+=12,p--);if(h){var g=this._daylightSavingAdjust(new Date(h.getFullYear(),h.getMonth()-s[0]*s[1]+1,h.getDate()));g=d&&g<d?d:g;while(this._daylightSavingAdjust(new Date(p,f,1))>g)f--,f<0&&(f=11,p--)}e.drawMonth=f,e.drawYear=p;var m=this._get(e,"prevText");m=a?this.formatDate(m,this._daylightSavingAdjust(new Date(p,f-l,1)),this._getFormatConfig(e)):m;var v=this._canAdjustMonth(e,-1,p,f)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+m+"</span></a>":r?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+m+"</span></a>",y=this._get(e,"nextText");y=a?this.formatDate(y,this._daylightSavingAdjust(new Date(p,f+l,1)),this._getFormatConfig(e)):y;var _=this._canAdjustMonth(e,1,p,f)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+y+"</span></a>":r?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+y+"</span></a>",b=this._get(e,"currentText"),w=this._get(e,"gotoCurrent")&&e.currentDay?u:t;b=a?this.formatDate(b,w,this._getFormatConfig(e)):b;var x=e.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(e,"closeText")+"</button>",C=n?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(i?x:"")+(this._isInRange(e,w)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+b+"</button>":"")+(i?"":x)+"</div>":"",T=parseInt(this._get(e,"firstDay"),10);T=isNaN(T)?0:T;var k=this._get(e,"showWeek"),M=this._get(e,"dayNames"),S=this._get(e,"dayNamesShort"),L=this._get(e,"dayNamesMin"),D=this._get(e,"monthNames"),j=this._get(e,"monthNamesShort"),I=this._get(e,"beforeShowDay"),E=this._get(e,"showOtherMonths"),A=this._get(e,"selectOtherMonths"),P=this._get(e,"calculateWeek")||this.iso8601Week,O=this._getDefaultDate(e),N="";for(var R=0;R<s[0];R++){var F="";this.maxRows=4;for(var z=0;z<s[1];z++){var H=this._daylightSavingAdjust(new Date(p,f,e.selectedDay)),B=" ui-corner-all",W="";if(c){W+='<div class="ui-datepicker-group';if(s[1]>1)switch(z){case 0:W+=" ui-datepicker-group-first",B=" ui-corner-"+(i?"right":"left");break;case s[1]-1:W+=" ui-datepicker-group-last",B=" ui-corner-"+(i?"left":"right");break;default:W+=" ui-datepicker-group-middle",B=""}W+='">'}W+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+B+'">'+(/all|left/.test(B)&&R==0?i?_:v:"")+(/all|right/.test(B)&&R==0?i?v:_:"")+this._generateMonthYearHeader(e,f,p,d,h,R>0||z>0,D,j)+'</div><table class="ui-datepicker-calendar"><thead>'+"<tr>";var q=k?'<th class="ui-datepicker-week-col">'+this._get(e,"weekHeader")+"</th>":"";for(var G=0;G<7;G++){var V=(G+T)%7;q+="<th"+((G+T+6)%7>=5?' class="ui-datepicker-week-end"':"")+">"+'<span title="'+M[V]+'">'+L[V]+"</span></th>"}W+=q+"</tr></thead><tbody>";var U=this._getDaysInMonth(p,f);p==e.selectedYear&&f==e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,U));var J=(this._getFirstDayOfMonth(p,f)-T+7)%7,Q=Math.ceil((J+U)/7),X=c?this.maxRows>Q?this.maxRows:Q:Q;this.maxRows=X;var Y=this._daylightSavingAdjust(new Date(p,f,1-J));for(var Z=0;Z<X;Z++){W+="<tr>";var K=k?'<td class="ui-datepicker-week-col">'+this._get(e,"calculateWeek")(Y)+"</td>":"";for(var G=0;G<7;G++){var ee=I?I.apply(e.input?e.input[0]:null,[Y]):[!0,""],te=Y.getMonth()!=f,ie=te&&!A||!ee[0]||d&&Y<d||h&&Y>h;K+='<td class="'+((G+T+6)%7>=5?" ui-datepicker-week-end":"")+(te?" ui-datepicker-other-month":"")+(Y.getTime()==H.getTime()&&f==e.selectedMonth&&e._keyEvent||O.getTime()==Y.getTime()&&O.getTime()==H.getTime()?" "+this._dayOverClass:"")+(ie?" "+this._unselectableClass+" ui-state-disabled":"")+(te&&!E?"":" "+ee[1]+(Y.getTime()==u.getTime()?" "+this._currentClass:"")+(Y.getTime()==t.getTime()?" ui-datepicker-today":""))+'"'+((!te||E)&&ee[2]?' title="'+ee[2]+'"':"")+(ie?"":' data-handler="selectDay" data-event="click" data-month="'+Y.getMonth()+'" data-year="'+Y.getFullYear()+'"')+">"+(te&&!E?"&#xa0;":ie?'<span class="ui-state-default">'+Y.getDate()+"</span>":'<a class="ui-state-default'+(Y.getTime()==t.getTime()?" ui-state-highlight":"")+(Y.getTime()==u.getTime()?" ui-state-active":"")+(te?" ui-priority-secondary":"")+'" href="#">'+Y.getDate()+"</a>")+"</td>",Y.setDate(Y.getDate()+1),Y=this._daylightSavingAdjust(Y)}W+=K+"</tr>"}f++,f>11&&(f=0,p++),W+="</tbody></table>"+(c?"</div>"+(s[0]>0&&z==s[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),F+=W}N+=F}return N+=C+($.ui.ie6&&!e.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),e._keyEvent=!1,N},_generateMonthYearHeader:function(e,t,i,n,r,a,s,o){var l=this._get(e,"changeMonth"),c=this._get(e,"changeYear"),u=this._get(e,"showMonthAfterYear"),d='<div class="ui-datepicker-title">',h="";if(a||!l)h+='<span class="ui-datepicker-month">'+s[t]+"</span>";else{var f=n&&n.getFullYear()==i,p=r&&r.getFullYear()==i;h+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">';for(var g=0;g<12;g++)(!f||g>=n.getMonth())&&(!p||g<=r.getMonth())&&(h+='<option value="'+g+'"'+(g==t?' selected="selected"':"")+">"+o[g]+"</option>");h+="</select>"}u||(d+=h+(a||!l||!c?"&#xa0;":""));if(!e.yearshtml){e.yearshtml="";if(a||!c)d+='<span class="ui-datepicker-year">'+i+"</span>";else{var m=this._get(e,"yearRange").split(":"),v=(new Date).getFullYear(),y=function(e){var t=e.match(/c[+-].*/)?i+parseInt(e.substring(1),10):e.match(/[+-].*/)?v+parseInt(e,10):parseInt(e,10);return isNaN(t)?v:t},_=y(m[0]),b=Math.max(_,y(m[1]||""));_=n?Math.max(_,n.getFullYear()):_,b=r?Math.min(b,r.getFullYear()):b,e.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';for(;_<=b;_++)e.yearshtml+='<option value="'+_+'"'+(_==i?' selected="selected"':"")+">"+_+"</option>";e.yearshtml+="</select>",d+=e.yearshtml,e.yearshtml=null}}return d+=this._get(e,"yearSuffix"),u&&(d+=(a||!l||!c?"&#xa0;":"")+h),d+="</div>",d},_adjustInstDate:function(e,t,i){var n=e.drawYear+(i=="Y"?t:0),r=e.drawMonth+(i=="M"?t:0),a=Math.min(e.selectedDay,this._getDaysInMonth(n,r))+(i=="D"?t:0),s=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(n,r,a)));e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),(i=="M"||i=="Y")&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),r=i&&t<i?i:t;return r=n&&r>n?n:r,r},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return t==null?[1,1]:typeof t=="number"?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,n){var r=this._getNumberOfMonths(e),a=this._daylightSavingAdjust(new Date(i,n+(t<0?t:r[0]*r[1]),1));return t<0&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(e,a)},_isInRange:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max");return(!i||t.getTime()>=i.getTime())&&(!n||t.getTime()<=n.getTime())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,n){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var r=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(n,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),r,this._getFormatConfig(e))}}),$.fn.datepicker=function(e){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find(document.body).append($.datepicker.dpDiv),$.datepicker.initialized=!0);var t=Array.prototype.slice.call(arguments,1);return typeof e!="string"||e!="isDisabled"&&e!="getDate"&&e!="widget"?e=="option"&&arguments.length==2&&typeof arguments[1]=="string"?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t)):this.each(function(){typeof e=="string"?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this].concat(t)):$.datepicker._attachDatepicker(this,e)}):$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.9.2",window["DP_jQuery_"+dpuuid]=$})(jQuery);(function(l,s){var c="ui-dialog ui-widget ui-widget-content ui-corner-all ",a={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},o={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};l.widget("ui.dialog",{version:"1.9.2",options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var t=l(this).css(e).offset().top;t<0&&l(this).css("top",e.top-t)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.options.title=this.options.title||this.originalTitle;var t=this,r=this.options,e=r.title||"&#160;",a,i,n,s,o;a=(this.uiDialog=l("<div>")).addClass(c+r.dialogClass).css({display:"none",outline:0,zIndex:r.zIndex}).attr("tabIndex",-1).keydown(function(e){r.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===l.ui.keyCode.ESCAPE&&(t.close(e),e.preventDefault())}).mousedown(function(e){t.moveToTop(!1,e)}).appendTo("body"),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(a),i=(this.uiDialogTitlebar=l("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix").bind("mousedown",function(){a.focus()}).prependTo(a),n=l("<a href='#'></a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(e){e.preventDefault(),t.close(e)}).appendTo(i),(this.uiDialogTitlebarCloseText=l("<span>")).addClass("ui-icon ui-icon-closethick").text(r.closeText).appendTo(n),s=l("<span>").uniqueId().addClass("ui-dialog-title").html(e).prependTo(i),o=(this.uiDialogButtonPane=l("<div>")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),(this.uiButtonSet=l("<div>")).addClass("ui-dialog-buttonset").appendTo(o),a.attr({role:"dialog","aria-labelledby":s.attr("id")}),i.find("*").add(i).disableSelection(),this._hoverable(n),this._focusable(n),r.draggable&&l.fn.draggable&&this._makeDraggable(),r.resizable&&l.fn.resizable&&this._makeResizable(),this._createButtons(r.buttons),this._isOpen=!1,l.fn.bgiframe&&a.bgiframe(),this._on(a,{keydown:function(e){if(!r.modal||e.keyCode!==l.ui.keyCode.TAB)return;var t=l(":tabbable",a),i=t.filter(":first"),n=t.filter(":last");if(e.target===n[0]&&!e.shiftKey)return i.focus(1),!1;if(e.target===i[0]&&e.shiftKey)return n.focus(1),!1}})},_init:function(){this.options.autoOpen&&this.open()},_destroy:function(){var e,t=this.oldPosition;this.overlay&&this.overlay.destroy(),this.uiDialog.hide(),this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},close:function(e){var t=this,i,n;if(!this._isOpen)return;if(!1===this._trigger("beforeClose",e))return;return this._isOpen=!1,this.overlay&&this.overlay.destroy(),this.options.hide?this._hide(this.uiDialog,this.options.hide,function(){t._trigger("close",e)}):(this.uiDialog.hide(),this._trigger("close",e)),l.ui.dialog.overlay.resize(),this.options.modal&&(i=0,l(".ui-dialog").each(function(){this!==t.uiDialog[0]&&(n=l(this).css("z-index"),isNaN(n)||(i=Math.max(i,n)))}),l.ui.dialog.maxZ=i),this},isOpen:function(){return this._isOpen},moveToTop:function(e,t){var i=this.options,n;return i.modal&&!e||!i.stack&&!i.modal?this._trigger("focus",t):(i.zIndex>l.ui.dialog.maxZ&&(l.ui.dialog.maxZ=i.zIndex),this.overlay&&(l.ui.dialog.maxZ+=1,l.ui.dialog.overlay.maxZ=l.ui.dialog.maxZ,this.overlay.$el.css("z-index",l.ui.dialog.overlay.maxZ)),n={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()},l.ui.dialog.maxZ+=1,this.uiDialog.css("z-index",l.ui.dialog.maxZ),this.element.attr(n),this._trigger("focus",t),this)},open:function(){if(this._isOpen)return;var e,t=this.options,i=this.uiDialog;return this._size(),this._position(t.position),i.show(t.show),this.overlay=t.modal?new l.ui.dialog.overlay(this):null,this.moveToTop(!0),e=this.element.find(":tabbable"),e.length||(e=this.uiDialogButtonPane.find(":tabbable"),e.length||(e=i)),e.eq(0).focus(),this._isOpen=!0,this._trigger("open"),this},_createButtons:function(e){var r=this,t=!1;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),typeof e=="object"&&e!==null&&l.each(e,function(){return!(t=!0)}),t?(l.each(e,function(e,t){var i,n;t=l.isFunction(t)?{click:t,text:e}:t,t=l.extend({type:"button"},t),n=t.click,t.click=function(){n.apply(r.element[0],arguments)},i=l("<button></button>",t).appendTo(r.uiButtonSet),l.fn.button&&i.button()}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)):this.uiDialog.removeClass("ui-dialog-buttons")},_makeDraggable:function(){function i(e){return{position:e.position,offset:e.offset}}var n=this,r=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(e,t){l(this).addClass("ui-dialog-dragging"),n._trigger("dragStart",e,i(t))},drag:function(e,t){n._trigger("drag",e,i(t))},stop:function(e,t){r.position=[t.position.left-n.document.scrollLeft(),t.position.top-n.document.scrollTop()],l(this).removeClass("ui-dialog-dragging"),n._trigger("dragStop",e,i(t)),l.ui.dialog.overlay.resize()}})},_makeResizable:function(e){function i(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}e=e===s?this.options.resizable:e;var n=this,r=this.options,t=this.uiDialog.css("position"),a=typeof e=="string"?e:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:r.maxWidth,maxHeight:r.maxHeight,minWidth:r.minWidth,minHeight:this._minHeight(),handles:a,start:function(e,t){l(this).addClass("ui-dialog-resizing"),n._trigger("resizeStart",e,i(t))},resize:function(e,t){n._trigger("resize",e,i(t))},stop:function(e,t){l(this).removeClass("ui-dialog-resizing"),r.height=l(this).height(),r.width=l(this).width(),n._trigger("resizeStop",e,i(t)),l.ui.dialog.overlay.resize()}}).css("position",t).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(e){var i=[],n=[0,0],t;if(e){if(typeof e=="string"||typeof e=="object"&&"0"in e)i=e.split?e.split(" "):[e[0],e[1]],i.length===1&&(i[1]=i[0]),l.each(["left","top"],function(e,t){+i[e]===i[e]&&(n[e]=i[e],i[e]=t)}),e={my:i[0]+(n[0]<0?n[0]:"+"+n[0])+" "+i[1]+(n[1]<0?n[1]:"+"+n[1]),at:i.join(" ")};e=l.extend({},l.ui.dialog.prototype.options.position,e)}else e=l.ui.dialog.prototype.options.position;t=this.uiDialog.is(":visible"),t||this.uiDialog.show(),this.uiDialog.position(e),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,n={},r=!1;l.each(e,function(e,t){i._setOption(e,t),e in a&&(r=!0),e in o&&(n[e]=t)}),r&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,n,r=this.uiDialog;switch(e){case"buttons":this._createButtons(t);break;case"closeText":this.uiDialogTitlebarCloseText.text(""+t);break;case"dialogClass":r.removeClass(this.options.dialogClass).addClass(c+t);break;case"disabled":t?r.addClass("ui-dialog-disabled"):r.removeClass("ui-dialog-disabled");break;case"draggable":i=r.is(":data(draggable)"),i&&!t&&r.draggable("destroy"),!i&&t&&this._makeDraggable();break;case"position":this._position(t);break;case"resizable":n=r.is(":data(resizable)"),n&&!t&&r.resizable("destroy"),n&&typeof t=="string"&&r.resizable("option","handles",t),!n&&t!==!1&&this._makeResizable(t);break;case"title":l(".ui-dialog-title",this.uiDialogTitlebar).html(""+(t||"&#160;"))}this._super(e,t)},_size:function(){var e,t,i,n=this.options,r=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),n.minWidth>n.width&&(n.width=n.minWidth),e=this.uiDialog.css({height:"auto",width:n.width}).outerHeight(),t=Math.max(0,n.minHeight-e),n.height==="auto"?l.support.minHeight?this.element.css({minHeight:t,height:"auto"}):(this.uiDialog.show(),i=this.element.css("height","auto").height(),r||this.uiDialog.hide(),this.element.height(Math.max(i,t))):this.element.height(Math.max(n.height-e,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),l.extend(l.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr("id");return t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t},overlay:function(e){this.$el=l.ui.dialog.overlay.create(e)}}),l.extend(l.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:l.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),create:function(i){this.instances.length===0&&(setTimeout(function(){l.ui.dialog.overlay.instances.length&&l(document).bind(l.ui.dialog.overlay.events,function(e){if(l(e.target).zIndex()<l.ui.dialog.overlay.maxZ)return!1})},1),l(window).bind("resize.dialog-overlay",l.ui.dialog.overlay.resize));var n=this.oldInstances.pop()||l("<div>").addClass("ui-widget-overlay");return l(document).bind("keydown.dialog-overlay",function(e){var t=l.ui.dialog.overlay.instances;t.length!==0&&t[t.length-1]===n&&i.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===l.ui.keyCode.ESCAPE&&(i.close(e),e.preventDefault())}),n.appendTo(document.body).css({width:this.width(),height:this.height()}),l.fn.bgiframe&&n.bgiframe(),this.instances.push(n),n},destroy:function(e){var t=l.inArray(e,this.instances),i=0;t!==-1&&this.oldInstances.push(this.instances.splice(t,1)[0]),this.instances.length===0&&l([document,window]).unbind(".dialog-overlay"),e.height(0).width(0).remove(),l.each(this.instances,function(){i=Math.max(i,this.css("z-index"))}),this.maxZ=i},height:function(){var e,t;return l.ui.ie?(e=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),t=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),e<t?l(window).height()+"px":e+"px"):l(document).height()+"px"},width:function(){var e,t;return l.ui.ie?(e=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),t=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),e<t?l(window).width()+"px":e+"px"):l(document).width()+"px"},resize:function(){var e=l([]);l.each(l.ui.dialog.overlay.instances,function(){e=e.add(this)}),e.css({width:0,height:0}).css({width:l.ui.dialog.overlay.width(),height:l.ui.dialog.overlay.height()})}}),l.extend(l.ui.dialog.overlay.prototype,{destroy:function(){l.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);(function(l,e){var i=!1;l.widget("ui.menu",{version:"1.9.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,l.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(e){var t=l(e.target).closest(".ui-menu-item");!i&&t.not(".ui-state-disabled").length&&(i=!0,this.select(e),t.has(".ui-menu").length?this.expand(e):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&this.active.parents(".ui-menu").length===1&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var t=l(e.currentTarget);t.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(e,t)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,i)},blur:function(e){this._delay(function(){l.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){l(e.target).closest(".ui-menu").length||this.collapseAll(e),i=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=l(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){function t(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var i,n,r,a,s,o=!0;switch(e.keyCode){case l.ui.keyCode.PAGE_UP:this.previousPage(e);break;case l.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case l.ui.keyCode.HOME:this._move("first","first",e);break;case l.ui.keyCode.END:this._move("last","last",e);break;case l.ui.keyCode.UP:this.previous(e);break;case l.ui.keyCode.DOWN:this.next(e);break;case l.ui.keyCode.LEFT:this.collapse(e);break;case l.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case l.ui.keyCode.ENTER:case l.ui.keyCode.SPACE:this._activate(e);break;case l.ui.keyCode.ESCAPE:this.collapse(e);break;default:o=!1,n=this.previousFilter||"",r=String.fromCharCode(e.keyCode),a=!1,clearTimeout(this.filterTimer),r===n?a=!0:r=n+r,s=new RegExp("^"+t(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(l(this).children("a").text())}),i=a&&i.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):i,i.length||(r=String.fromCharCode(e.keyCode),s=new RegExp("^"+t(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(l(this).children("a").text())})),i.length?(this.focus(e,i),i.length>1?(this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}o&&e.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var e,n=this.options.icons.submenu,t=this.element.find(this.options.menus);t.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=l(this),t=e.prev("a"),i=l("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);t.attr("aria-haspopup","true").prepend(i),e.attr("aria-labelledby",t.attr("id"))}),e=t.add(this.element),e.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),e.children(":not(.ui-menu-item)").each(function(){var e=l(this);/[^\-—–\s]/.test(e.text())||e.addClass("ui-widget-content ui-menu-divider")}),e.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!l.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(e,t){var i,n;this.blur(e,e&&e.type==="focus"),this._scrollIntoView(t),this.active=t.first(),n=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",n.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&e.type==="keydown"?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(e){var t,i,n,r,a,s;this._hasScroll()&&(t=parseFloat(l.css(this.activeMenu[0],"borderTopWidth"))||0,i=parseFloat(l.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-t-i,r=this.activeMenu.scrollTop(),a=this.activeMenu.height(),s=e.height(),n<0?this.activeMenu.scrollTop(r+n):n+s>a&&this.activeMenu.scrollTop(r+n-a+s))},blur:function(e,t){t||clearTimeout(this.timer);if(!this.active)return;this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active})},_startOpening:function(e){clearTimeout(this.timer);if(e.attr("aria-hidden")!=="true")return;this.timer=this._delay(function(){this._close(),this._open(e)},this.delay)},_open:function(e){var t=l.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(t)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var e=i?this.element:l(t&&t.target).closest(this.element.find(".ui-menu"));e.length||(e=this.element),this._close(e),this.blur(t),this.activeMenu=e},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var n;this.active&&(e==="first"||e==="last"?n=this.active[e==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1):n=this.active[e+"All"](".ui-menu-item").eq(0));if(!n||!n.length||!this.active)n=this.activeMenu.children(".ui-menu-item")[t]();this.focus(i,n)},nextPage:function(e){var t,i,n;if(!this.active){this.next(e);return}if(this.isLastItem())return;this._hasScroll()?(i=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return t=l(this),t.offset().top-i-n<0}),this.focus(e,t)):this.focus(e,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())},previousPage:function(e){var t,i,n;if(!this.active){this.next(e);return}if(this.isFirstItem())return;this._hasScroll()?(i=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return t=l(this),t.offset().top-i+n>0}),this.focus(e,t)):this.focus(e,this.activeMenu.children(".ui-menu-item").first())},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||l(e.target).closest(".ui-menu-item");var t={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,t)}})})(jQuery);(function(e,t){e.widget("ui.progressbar",{version:"1.9.2",options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this.oldValue=this._value(),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return e===t?this._value():(this._setOption("value",e),this)},_setOption:function(e,t){e==="value"&&(this.options.value=t,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete")),this._super(e,t)},_value:function(){var e=this.options.value;return typeof e!="number"&&(e=0),Math.min(this.options.max,Math.max(this.min,e))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var e=this.value(),t=this._percentage();this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),this.valueDiv.toggle(e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(t.toFixed(0)+"%"),this.element.attr("aria-valuenow",e)}})})(jQuery);(function(d,e){var s=5;d.widget("ui.slider",d.ui.mouse,{version:"1.9.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var e,t,i=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),r="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",a=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=d([]),i.range&&(i.range===!0&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&i.values.length!==2&&(i.values=[i.values[0],i.values[0]])),this.range=d("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(i.range==="min"||i.range==="max"?" ui-slider-range-"+i.range:""))),t=i.values&&i.values.length||1;for(e=n.length;e<t;e++)a.push(r);this.handles=n.add(d(a.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){i.disabled||d(this).addClass("ui-state-hover")}).mouseleave(function(){d(this).removeClass("ui-state-hover")}).focus(function(){i.disabled?d(this).blur():(d(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),d(this).addClass("ui-state-focus"))}).blur(function(){d(this).removeClass("ui-state-focus")}),this.handles.each(function(e){d(this).data("ui-slider-handle-index",e)}),this._on(this.handles,{keydown:function(e){var t,i,n,r,a=d(e.target).data("ui-slider-handle-index");switch(e.keyCode){case d.ui.keyCode.HOME:case d.ui.keyCode.END:case d.ui.keyCode.PAGE_UP:case d.ui.keyCode.PAGE_DOWN:case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:e.preventDefault();if(!this._keySliding){this._keySliding=!0,d(e.target).addClass("ui-state-active"),t=this._start(e,a);if(t===!1)return}}r=this.options.step,this.options.values&&this.options.values.length?i=n=this.values(a):i=n=this.value();switch(e.keyCode){case d.ui.keyCode.HOME:n=this._valueMin();break;case d.ui.keyCode.END:n=this._valueMax();break;case d.ui.keyCode.PAGE_UP:n=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/s);break;case d.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/s);break;case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:if(i===this._valueMax())return;n=this._trimAlignValue(i+r);break;case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:if(i===this._valueMin())return;n=this._trimAlignValue(i-r)}this._slide(e,a,n)},keyup:function(e){var t=d(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,t),this._change(e,t),d(e.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var t,i,n,r,a,s,o,l,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var t=Math.abs(i-c.values(e));n>t&&(n=t,r=d(this),a=e)}),u.range===!0&&this.values(1)===u.min&&(a+=1,r=d(this.handles[a])),s=this._start(e,a),s===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,r.addClass("ui-state-active").focus(),o=r.offset(),l=!d(e.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-o.left-r.width()/2,top:e.pageY-o.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,i),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,r,a;return this.orientation==="horizontal"?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/t,n>1&&(n=1),n<0&&(n=0),this.orientation==="vertical"&&(n=1-n),r=this._valueMax()-this._valueMin(),a=this._valueMin()+n*r,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var n,r,a;this.options.values&&this.options.values.length?(n=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&i>n||t===1&&i<n)&&(i=n),i!==this.values(t)&&(r=this.values(),r[t]=i,a=this._trigger("slide",e,{handle:this.handles[t],value:i,values:r}),n=this.values(t?0:1),a!==!1&&this.values(t,i,!0))):i!==this.value()&&(a=this._trigger("slide",e,{handle:this.handles[t],value:i}),a!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("change",e,i)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(e,t){var i,n,r;if(arguments.length>1){this.options.values[e]=this._trimAlignValue(t),this._refreshValue(),this._change(null,e);return}if(!arguments.length)return this._values();if(!d.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();i=this.options.values,n=arguments[0];for(r=0;r<i.length;r+=1)i[r]=this._trimAlignValue(n[r]),this._change(null,r);this._refreshValue()},_setOption:function(e,t){var i,n=0;d.isArray(this.options.values)&&(n=this.options.values.length),d.Widget.prototype._setOption.apply(this,arguments);switch(e){case"disabled":t?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(i=0;i<n;i+=1)this._change(null,i);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,i,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;i=this.options.values.slice();for(n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return Math.abs(i)*2>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,e,n,r,a=this.options.range,s=this.options,o=this,l=this._animateOff?!1:s.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(e){i=(o.values(e)-o._valueMin())/(o._valueMax()-o._valueMin())*100,c[o.orientation==="horizontal"?"left":"bottom"]=i+"%",d(this).stop(1,1)[l?"animate":"css"](c,s.animate),o.options.range===!0&&(o.orientation==="horizontal"?(e===0&&o.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},s.animate),e===1&&o.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:s.animate})):(e===0&&o.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},s.animate),e===1&&o.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:s.animate}))),t=i}):(e=this.value(),n=this._valueMin(),r=this._valueMax(),i=r!==n?(e-n)/(r-n)*100:0,c[this.orientation==="horizontal"?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,s.animate),a==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},s.animate),a==="max"&&this.orientation==="horizontal"&&this.range[l?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:s.animate}),a==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},s.animate),a==="max"&&this.orientation==="vertical"&&this.range[l?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:s.animate}))}})})(jQuery);(function(a){function t(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}a.widget("ui.spinner",{version:"1.9.2",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var n={},r=this.element;return a.each(["min","max","step"],function(e,t){var i=r.attr(t);i!==undefined&&i.length&&(n[t]=i)}),n},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;return}this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e)},mousewheel:function(e,t){if(!t)return;if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()},"mousedown .ui-spinner-button":function(e){function t(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i}))}var i;i=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),e.preventDefault(),t.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,t.call(this)});if(this._start(e)===!1)return;this._repeat(null,a(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){if(!a(e.currentTarget).hasClass("ui-state-active"))return;if(this._start(e)===!1)return!1;this._repeat(null,a(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(e.height()*.5)&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(e){var t=this.options,i=a.ui.keyCode;switch(e.keyCode){case i.UP:return this._repeat(null,1,e),!0;case i.DOWN:return this._repeat(null,-1,e),!0;case i.PAGE_UP:return this._repeat(null,t.page,e),!0;case i.PAGE_DOWN:return this._repeat(null,-t.page,e),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>"},_start:function(e){return!this.spinning&&this._trigger("start",e)===!1?!1:(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter));if(!this.spinning||this._trigger("spin",t,{value:i})!==!1)this._value(i),this.counter++},_increment:function(e){var t=this.options.incremental;return t?a.isFunction(t)?t(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return this.options.min!==null&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return i===-1?0:t.length-i-1},_adjustValue:function(e){var t,i,n=this.options;return t=n.min!==null?n.min:0,i=e-t,i=Math.round(i/n.step)*n.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),n.max!==null&&e>n.max?n.max:n.min!==null&&e<n.min?n.min:e},_stop:function(e){if(!this.spinning)return;clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e)},_setOption:function(e,t){if(e==="culture"||e==="numberFormat"){var i=this._parse(this.element.val());this.options[e]=t,this.element.val(this._format(i));return}(e==="max"||e==="min"||e==="step")&&typeof t=="string"&&(t=this._parse(t)),this._super(e,t),e==="disabled"&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t(function(e){this._super(e),this._value(this.element.val())}),_parse:function(e){return typeof e=="string"&&e!==""&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),e===""||isNaN(e)?null:e},_format:function(e){return e===""?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var i;e!==""&&(i=this._parse(e),i!==null&&(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t(function(e){this._stepUp(e)}),_stepUp:function(e){this._spin((e||1)*this.options.step)},stepDown:t(function(e){this._stepDown(e)}),_stepDown:function(e){this._spin((e||1)*-this.options.step)},pageUp:t(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){if(!arguments.length)return this._parse(this.element.val());t(this._value).call(this,e)},widget:function(){return this.uiSpinner}})})(jQuery);(function(u,l){function i(){return++e}function c(e){return e.hash.length>1&&e.href.replace(t,"")===location.href.replace(t,"").replace(/\s/g,"%20")}var e=0,t=/#.*$/;u.widget("ui.tabs",{version:"1.9.2",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,e=this.options,i=e.active,n=location.hash.substring(1);this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",e.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(e){u(this).is(".ui-state-disabled")&&e.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){u(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs();if(i===null){n&&this.tabs.each(function(e,t){if(u(t).attr("aria-controls")===n)return i=e,!1}),i===null&&(i=this.tabs.index(this.tabs.filter(".ui-tabs-active")));if(i===null||i===-1)i=this.tabs.length?0:!1}i!==!1&&(i=this.tabs.index(this.tabs.eq(i)),i===-1&&(i=e.collapsible?!1:0)),e.active=i,!e.collapsible&&e.active===!1&&this.anchors.length&&(e.active=0),u.isArray(e.disabled)&&(e.disabled=u.unique(e.disabled.concat(u.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.options.active!==!1&&this.anchors.length?this.active=this._findActive(this.options.active):this.active=u(),this._refresh(),this.active.length&&this.load(e.active)},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):u()}},_tabKeydown:function(e){var t=u(this.document[0].activeElement).closest("li"),i=this.tabs.index(t),n=!0;if(this._handlePageNav(e))return;switch(e.keyCode){case u.ui.keyCode.RIGHT:case u.ui.keyCode.DOWN:i++;break;case u.ui.keyCode.UP:case u.ui.keyCode.LEFT:n=!1,i--;break;case u.ui.keyCode.END:i=this.anchors.length-1;break;case u.ui.keyCode.HOME:i=0;break;case u.ui.keyCode.SPACE:e.preventDefault(),clearTimeout(this.activating),this._activate(i);return;case u.ui.keyCode.ENTER:e.preventDefault(),clearTimeout(this.activating),this._activate(i===this.options.active?!1:i);return;default:return}e.preventDefault(),clearTimeout(this.activating),i=this._focusNextTab(i,n),e.ctrlKey||(t.attr("aria-selected","false"),this.tabs.eq(i).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",i)},this.delay))},_panelKeydown:function(e){if(this._handlePageNav(e))return;e.ctrlKey&&e.keyCode===u.ui.keyCode.UP&&(e.preventDefault(),this.active.focus())},_handlePageNav:function(e){if(e.altKey&&e.keyCode===u.ui.keyCode.PAGE_UP)return this._activate(this._focusNextTab(this.options.active-1,!1)),!0;if(e.altKey&&e.keyCode===u.ui.keyCode.PAGE_DOWN)return this._activate(this._focusNextTab(this.options.active+1,!0)),!0},_findNextTab:function(e,t){function i(){return e>n&&(e=0),e<0&&(e=n),e}var n=this.tabs.length-1;while(u.inArray(i(),this.options.disabled)!==-1)e=t?e+1:e-1;return e},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){if(e==="active"){this._activate(t);return}if(e==="disabled"){this._setupDisabled(t);return}this._super(e,t),e==="collapsible"&&(this.element.toggleClass("ui-tabs-collapsible",t),!t&&this.options.active===!1&&this._activate(0)),e==="event"&&this._setupEvents(t),e==="heightStyle"&&this._setupHeightStyle(t)},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+i()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,t=this.tablist.children(":has(a[href])");e.disabled=u.map(t.filter(".ui-state-disabled"),function(e){return t.index(e)}),this._processTabs(),e.active===!1||!this.anchors.length?(e.active=!1,this.active=u()):this.active.length&&!u.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=u()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var l=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return u("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=u(),this.anchors.each(function(e,t){var i,n,r,a=u(t).uniqueId().attr("id"),s=u(t).closest("li"),o=s.attr("aria-controls");c(t)?(i=t.hash,n=l.element.find(l._sanitizeSelector(i))):(r=l._tabId(s),i="#"+r,n=l.element.find(i),n.length||(n=l._createPanel(r),n.insertAfter(l.panels[e-1]||l.tablist)),n.attr("aria-live","polite")),n.length&&(l.panels=l.panels.add(n)),o&&s.data("ui-tabs-aria-controls",o),s.attr({"aria-controls":i.substring(1),"aria-labelledby":a}),n.attr("aria-labelledby",a)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(e){return u("<div>").attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(e){u.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1);for(var t=0,i;i=this.tabs[t];t++)e===!0||u.inArray(t,e)!==-1?u(i).addClass("ui-state-disabled").attr("aria-disabled","true"):u(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=e},_setupEvents:function(e){var i={click:function(e){e.preventDefault()}};e&&u.each(e.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,t,n=this.element.parent();e==="fill"?(u.support.minHeight||(t=n.css("overflow"),n.css("overflow","hidden")),i=n.height(),this.element.siblings(":visible").each(function(){var e=u(this),t=e.css("position");if(t==="absolute"||t==="fixed")return;i-=e.outerHeight(!0)}),t&&n.css("overflow",t),this.element.children().not(this.panels).each(function(){i-=u(this).outerHeight(!0)}),this.panels.each(function(){u(this).height(Math.max(0,i-u(this).innerHeight()+u(this).height()))}).css("overflow","auto")):e==="auto"&&(i=0,this.panels.each(function(){i=Math.max(i,u(this).height("").height())}).height(i))},_eventHandler:function(e){var t=this.options,i=this.active,n=u(e.currentTarget),r=n.closest("li"),a=r[0]===i[0],s=a&&t.collapsible,o=s?u():this._getPanelForTab(r),l=i.length?this._getPanelForTab(i):u(),c={oldTab:i,oldPanel:l,newTab:s?u():r,newPanel:o};e.preventDefault();if(r.hasClass("ui-state-disabled")||r.hasClass("ui-tabs-loading")||this.running||a&&!t.collapsible||this._trigger("beforeActivate",e,c)===!1)return;t.active=s?!1:this.tabs.index(r),this.active=a?u():r,this.xhr&&this.xhr.abort(),!l.length&&!o.length&&u.error("jQuery UI Tabs: Mismatching fragment identifier."),o.length&&this.load(this.tabs.index(r),e),this._toggle(e,c)},_toggle:function(e,t){function i(){r.running=!1,r._trigger("activate",e,t)}function n(){t.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),a.length&&r.options.show?r._show(a,r.options.show,i):(a.show(),i())}var r=this,a=t.newPanel,s=t.oldPanel;this.running=!0,s.length&&this.options.hide?this._hide(s,this.options.hide,function(){t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s.hide(),n()),s.attr({"aria-expanded":"false","aria-hidden":"true"}),t.oldTab.attr("aria-selected","false"),a.length&&s.length?t.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return u(this).attr("tabIndex")===0}).attr("tabIndex",-1),a.attr({"aria-expanded":"true","aria-hidden":"false"}),t.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(e){var t,i=this._findActive(e);if(i[0]===this.active[0])return;i.length||(i=this.active),t=i.find(".ui-tabs-anchor")[0],this._eventHandler({target:t,currentTarget:t,preventDefault:u.noop})},_findActive:function(e){return e===!1?u():this.tabs.eq(e)},_getIndex:function(e){return typeof e=="string"&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeData("href.tabs").removeData("load.tabs").removeUniqueId(),this.tabs.add(this.panels).each(function(){u.data(this,"ui-tabs-destroy")?u(this).remove():u(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var e=u(this),t=e.data("ui-tabs-aria-controls");t?e.attr("aria-controls",t):e.removeAttr("aria-controls")}),this.panels.show(),this.options.heightStyle!=="content"&&this.panels.css("height","")},enable:function(i){var e=this.options.disabled;if(e===!1)return;i===l?e=!1:(i=this._getIndex(i),u.isArray(e)?e=u.map(e,function(e){return e!==i?e:null}):e=u.map(this.tabs,function(e,t){return t!==i?t:null})),this._setupDisabled(e)},disable:function(e){var t=this.options.disabled;if(t===!0)return;if(e===l)t=!0;else{e=this._getIndex(e);if(u.inArray(e,t)!==-1)return;u.isArray(t)?t=u.merge([e],t).sort():t=[e]}this._setupDisabled(t)},load:function(e,t){e=this._getIndex(e);var i=this,n=this.tabs.eq(e),r=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),s={tab:n,panel:a};if(c(r[0]))return;this.xhr=u.ajax(this._ajaxSettings(r,t,s)),this.xhr&&this.xhr.statusText!=="canceled"&&(n.addClass("ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){a.html(e),i._trigger("load",t,s)},1)}).complete(function(e,t){setTimeout(function(){t==="abort"&&i.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),a.removeAttr("aria-busy"),e===i.xhr&&delete i.xhr},1)}))},_ajaxSettings:function(e,i,n){var r=this;return{url:e.attr("href"),beforeSend:function(e,t){return r._trigger("beforeLoad",i,u.extend({jqXHR:e,ajaxSettings:t},n))}}},_getPanelForTab:function(e){var t=u(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+t))}}),u.uiBackCompat!==!1&&(u.ui.tabs.prototype._ui=function(e,t){return{tab:e,panel:t,index:this.anchors.index(e)}},u.widget("ui.tabs",u.ui.tabs,{url:function(e,t){this.anchors.eq(e).attr("href",t)}}),u.widget("ui.tabs",u.ui.tabs,{options:{ajaxOptions:null,cache:!1},_create:function(){this._super();var i=this;this._on({tabsbeforeload:function(e,t){if(u.data(t.tab[0],"cache.tabs")){e.preventDefault();return}t.jqXHR.success(function(){i.options.cache&&u.data(t.tab[0],"cache.tabs",!0)})}})},_ajaxSettings:function(e,t,i){var n=this.options.ajaxOptions;return u.extend({},n,{error:function(e,t){try{n.error(e,t,i.tab.closest("li").index(),i.tab[0])}catch(e){}}},this._superApply(arguments))},_setOption:function(e,t){e==="cache"&&t===!1&&this.anchors.removeData("cache.tabs"),this._super(e,t)},_destroy:function(){this.anchors.removeData("cache.tabs"),this._super()},url:function(e){this.anchors.eq(e).removeData("cache.tabs"),this._superApply(arguments)}}),u.widget("ui.tabs",u.ui.tabs,{abort:function(){this.xhr&&this.xhr.abort()}}),u.widget("ui.tabs",u.ui.tabs,{options:{spinner:"<em>Loading&#8230;</em>"},_create:function(){this._super(),this._on({tabsbeforeload:function(e,t){if(e.target!==this.element[0]||!this.options.spinner)return;var i=t.tab.find("span"),n=i.html();i.html(this.options.spinner),t.jqXHR.complete(function(){i.html(n)})}})}}),u.widget("ui.tabs",u.ui.tabs,{options:{enable:null,disable:null},enable:function(e){var t=this.options,i;if(e&&t.disabled===!0||u.isArray(t.disabled)&&u.inArray(e,t.disabled)!==-1)i=!0;this._superApply(arguments),i&&this._trigger("enable",null,this._ui(this.anchors[e],this.panels[e]))},disable:function(e){var t=this.options,i;if(e&&t.disabled===!1||u.isArray(t.disabled)&&u.inArray(e,t.disabled)===-1)i=!0;this._superApply(arguments),i&&this._trigger("disable",null,this._ui(this.anchors[e],this.panels[e]))}}),u.widget("ui.tabs",u.ui.tabs,{options:{add:null,remove:null,tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},add:function(e,t,i){i===l&&(i=this.anchors.length);var n,r,a=this.options,s=u(a.tabTemplate.replace(/#\{href\}/g,e).replace(/#\{label\}/g,t)),o=e.indexOf("#")?this._tabId(s):e.replace("#","");return s.addClass("ui-state-default ui-corner-top").data("ui-tabs-destroy",!0),s.attr("aria-controls",o),n=i>=this.tabs.length,r=this.element.find("#"+o),r.length||(r=this._createPanel(o),n?i>0?r.insertAfter(this.panels.eq(-1)):r.appendTo(this.element):r.insertBefore(this.panels[i])),r.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").hide(),n?s.appendTo(this.tablist):s.insertBefore(this.tabs[i]),a.disabled=u.map(a.disabled,function(e){return e>=i?++e:e}),this.refresh(),this.tabs.length===1&&a.active===!1&&this.option("active",0),this._trigger("add",null,this._ui(this.anchors[i],this.panels[i])),this},remove:function(t){t=this._getIndex(t);var e=this.options,i=this.tabs.eq(t).remove(),n=this._getPanelForTab(i).remove();return i.hasClass("ui-tabs-active")&&this.anchors.length>2&&this._activate(t+(t+1<this.anchors.length?1:-1)),e.disabled=u.map(u.grep(e.disabled,function(e){return e!==t}),function(e){return e>=t?--e:e}),this.refresh(),this._trigger("remove",null,this._ui(i.find("a")[0],n[0])),this}}),u.widget("ui.tabs",u.ui.tabs,{length:function(){return this.anchors.length}}),u.widget("ui.tabs",u.ui.tabs,{options:{idPrefix:"ui-tabs-"},_tabId:function(e){var t=e.is("li")?e.find("a[href]"):e;return t=t[0],u(t).closest("li").attr("aria-controls")||t.title&&t.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF\-]/g,"")||this.options.idPrefix+i()}}),u.widget("ui.tabs",u.ui.tabs,{options:{panelTemplate:"<div></div>"},_createPanel:function(e){return u(this.options.panelTemplate).attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)}}),u.widget("ui.tabs",u.ui.tabs,{_create:function(){var e=this.options;e.active===null&&e.selected!==l&&(e.active=e.selected===-1?!1:e.selected),this._super(),e.selected=e.active,e.selected===!1&&(e.selected=-1)},_setOption:function(e,t){if(e!=="selected")return this._super(e,t);var i=this.options;this._super("active",t===-1?!1:t),i.selected=i.active,i.selected===!1&&(i.selected=-1)},_eventHandler:function(){this._superApply(arguments),this.options.selected=this.options.active,this.options.selected===!1&&(this.options.selected=-1)}}),u.widget("ui.tabs",u.ui.tabs,{options:{show:null,select:null},_create:function(){this._super(),this.options.active!==!1&&this._trigger("show",null,this._ui(this.active.find(".ui-tabs-anchor")[0],this._getPanelForTab(this.active)[0]))},_trigger:function(e,t,i){var n,r,a=this._superApply(arguments);return a?(e==="beforeActivate"?(n=i.newTab.length?i.newTab:i.oldTab,r=i.newPanel.length?i.newPanel:i.oldPanel,a=this._super("select",t,{tab:n.find(".ui-tabs-anchor")[0],panel:r[0],index:n.closest("li").index()})):e==="activate"&&i.newTab.length&&(a=this._super("show",t,{tab:i.newTab.find(".ui-tabs-anchor")[0],panel:i.newPanel[0],index:i.newTab.closest("li").index()})),a):!1}}),u.widget("ui.tabs",u.ui.tabs,{select:function(e){e=this._getIndex(e);if(e===-1){if(!this.options.collapsible||this.options.selected===-1)return;e=this.options.selected}this.anchors.eq(e).trigger(this.options.event+this.eventNamespace)}}),function(){var i=0;u.widget("ui.tabs",u.ui.tabs,{options:{cookie:null},_create:function(){var e=this.options,t;e.active==null&&e.cookie&&(t=parseInt(this._cookie(),10),t===-1&&(t=!1),e.active=t),this._super()},_cookie:function(e){var t=[this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+ ++i)];return arguments.length&&(t.push(e===!1?-1:e),t.push(this.options.cookie)),u.cookie.apply(null,t)},_refresh:function(){this._super(),this.options.cookie&&this._cookie(this.options.active,this.options.cookie)},_eventHandler:function(){this._superApply(arguments),this.options.cookie&&this._cookie(this.options.active,this.options.cookie)},_destroy:function(){this._super(),this.options.cookie&&this._cookie(null,this.options.cookie)}})}(),u.widget("ui.tabs",u.ui.tabs,{_trigger:function(e,t,i){var n=u.extend({},i);return e==="load"&&(n.panel=n.panel[0],n.tab=n.tab.find(".ui-tabs-anchor")[0]),this._super(e,t,n)}}),u.widget("ui.tabs",u.ui.tabs,{options:{fx:null},_getFx:function(){var e,t,i=this.options.fx;return i&&(u.isArray(i)?(e=i[0],t=i[1]):e=t=i),i?{show:t,hide:e}:null},_toggle:function(e,t){function i(){r.running=!1,r._trigger("activate",e,t)}function n(){t.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),a.length&&o.show?a.animate(o.show,o.show.duration,function(){i()}):(a.show(),i())}var r=this,a=t.newPanel,s=t.oldPanel,o=this._getFx();if(!o)return this._super(e,t);r.running=!0,s.length&&o.hide?s.animate(o.hide,o.hide.duration,function(){t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s.hide(),n())}}))})(jQuery);(function(l){function c(e,t){var i=(e.attr("aria-describedby")||"").split(/\s+/);i.push(t),e.data("ui-tooltip-id",t).attr("aria-describedby",l.trim(i.join(" ")))}function r(e){var t=e.data("ui-tooltip-id"),i=(e.attr("aria-describedby")||"").split(/\s+/),n=l.inArray(t,i);n!==-1&&i.splice(n,1),e.removeData("ui-tooltip-id"),i=l.trim(i.join(" ")),i?e.attr("aria-describedby",i):e.removeAttr("aria-describedby")}var n=0;l.widget("ui.tooltip",{version:"1.9.2",options:{content:function(){return l(this).attr("title")},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(e,t){var i=this;if(e==="disabled"){this[t?"_disable":"_enable"](),this.options[e]=t;return}this._super(e,t),e==="content"&&l.each(this.tooltips,function(e,t){i._updateContent(t)})},_disable:function(){var n=this;l.each(this.tooltips,function(e,t){var i=l.Event("blur");i.target=i.currentTarget=t[0],n.close(i,!0)}),this.element.find(this.options.items).andSelf().each(function(){var e=l(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var e=l(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var i=this,t=l(e?e.target:this.element).closest(this.options.items);if(!t.length||t.data("ui-tooltip-id"))return;t.attr("title")&&t.data("ui-tooltip-title",t.attr("title")),t.data("ui-tooltip-open",!0),e&&e.type==="mouseover"&&t.parents().each(function(){var e=l(this),t;e.data("ui-tooltip-open")&&(t=l.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),e.attr("title")&&(e.uniqueId(),i.parents[this.id]={element:this,title:e.attr("title")},e.attr("title",""))}),this._updateContent(t,e)},_updateContent:function(t,i){var e,n=this.options.content,r=this,a=i?i.type:null;if(typeof n=="string")return this._open(i,t,n);e=n.call(t[0],function(e){if(!t.data("ui-tooltip-open"))return;r._delay(function(){i&&(i.type=a),this._open(i,t,e)})}),e&&this._open(i,t,e)},_open:function(e,i,t){function n(e){o.of=e;if(r.is(":hidden"))return;r.position(o)}var r,a,s,o=l.extend({},this.options.position);if(!t)return;r=this._find(i);if(r.length){r.find(".ui-tooltip-content").html(t);return}i.is("[title]")&&(e&&e.type==="mouseover"?i.attr("title",""):i.removeAttr("title")),r=this._tooltip(i),c(i,r.attr("id")),r.find(".ui-tooltip-content").html(t),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):r.position(l.extend({of:i},this.options.position)),r.hide(),this._show(r,this.options.show),this.options.show&&this.options.show.delay&&(s=setInterval(function(){r.is(":visible")&&(n(o.of),clearInterval(s))},l.fx.interval)),this._trigger("open",e,{tooltip:r}),a={keyup:function(e){if(e.keyCode===l.ui.keyCode.ESCAPE){var t=l.Event(e);t.currentTarget=i[0],this.close(t,!0)}},remove:function(){this._removeTooltip(r)}};if(!e||e.type==="mouseover")a.mouseleave="close";if(!e||e.type==="focusin")a.focusout="close";this._on(!0,i,a)},close:function(e){var i=this,t=l(e?e.currentTarget:this.element),n=this._find(t);if(this.closing)return;t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title")),r(t),n.stop(!0),this._hide(n,this.options.hide,function(){i._removeTooltip(l(this))}),t.removeData("ui-tooltip-open"),this._off(t,"mouseleave focusout keyup"),t[0]!==this.element[0]&&this._off(t,"remove"),this._off(this.document,"mousemove"),e&&e.type==="mouseleave"&&l.each(this.parents,function(e,t){l(t.element).attr("title",t.title),delete i.parents[e]}),this.closing=!0,this._trigger("close",e,{tooltip:n}),this.closing=!1},_tooltip:function(e){var t="ui-tooltip-"+n++,i=l("<div>").attr({id:t,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return l("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),l.fn.bgiframe&&i.bgiframe(),this.tooltips[t]=e,i},_find:function(e){var t=e.data("ui-tooltip-id");return t?l("#"+t):l()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var n=this;l.each(this.tooltips,function(e,t){var i=l.Event("blur");i.target=i.currentTarget=t[0],n.close(i,!0),l("#"+e).remove(),t.data("ui-tooltip-title")&&(t.attr("title",t.data("ui-tooltip-title")),t.removeData("ui-tooltip-title"))})}})})(jQuery);jQuery.effects||function(y,c){var o=y.uiBackCompat!==!1,a="ui-effects-";y.effects={effect:{}},function(u,d){function h(e,t,i){var n=m[t.type]||{};return e==null?i||!t.def?null:t.def:(e=n.floor?~~e:parseFloat(e),isNaN(e)?t.def:n.mod?(e+n.mod)%n.mod:0>e?0:n.max<e?n.max:e)}function o(s){var o=p(),l=o._rgba=[];return s=s.toLowerCase(),v(t,function(e,t){var i,n=t.re.exec(s),r=n&&t.parse(n),a=t.space||"rgba";if(r)return i=o[a](r),o[g[a].cache]=i[g[a].cache],l=o._rgba=i._rgba,!1}),l.length?(l.join()==="0,0,0,0"&&u.extend(l,c.transparent),o):c[s]}function l(e,t,i){return i=(i+1)%1,i*6<1?e+(t-e)*i*6:i*2<1?t:i*3<2?e+(t-e)*(2/3-i)*6:e}var e="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor".split(" "),f=/^([\-+])=\s*(\d+\.?\d*)/,t=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1]*2.55,e[2]*2.55,e[3]*2.55,e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],p=u.Color=function(e,t,i,n){return new u.Color.fn.parse(e,t,i,n)},g={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},m={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},s=p.support={},i=u("<p>")[0],c,v=u.each;i.style.cssText="background-color:rgba(1,1,1,.5)",s.rgba=i.style.backgroundColor.indexOf("rgba")>-1,v(g,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),p.fn=u.extend(p.prototype,{parse:function(r,e,t,i){if(r===d)return this._rgba=[null,null,null,null],this;if(r.jquery||r.nodeType)r=u(r).css(e),e=d;var a=this,n=u.type(r),s=this._rgba=[];e!==d&&(r=[r,e,t,i],n="array");if(n==="string")return this.parse(o(r)||c._default);if(n==="array")return v(g.rgba.props,function(e,t){s[t.idx]=h(r[t.idx],t)}),this;if(n==="object")return r instanceof p?v(g,function(e,t){r[t.cache]&&(a[t.cache]=r[t.cache].slice())}):v(g,function(e,i){var n=i.cache;v(i.props,function(e,t){if(!a[n]&&i.to){if(e==="alpha"||r[e]==null)return;a[n]=i.to(a._rgba)}a[n][t.idx]=h(r[e],t,!0)}),a[n]&&y.inArray(null,a[n].slice(0,3))<0&&(a[n][3]=1,i.from&&(a._rgba=i.from(a[n])))}),this},is:function(e){var r=p(e),a=!0,s=this;return v(g,function(e,t){var i,n=r[t.cache];return n&&(i=s[t.cache]||t.to&&t.to(s._rgba)||[],v(t.props,function(e,t){if(n[t.idx]!=null)return a=n[t.idx]===i[t.idx],a})),a}),a},_space:function(){var i=[],n=this;return v(g,function(e,t){n[t.cache]&&i.push(e)}),i.pop()},transition:function(e,s){var o=p(e),t=o._space(),i=g[t],n=this.alpha()===0?p("transparent"):this,l=n[i.cache]||i.to(n._rgba),c=l.slice();return o=o[i.cache],v(i.props,function(e,t){var i=t.idx,n=l[i],r=o[i],a=m[t.type]||{};if(r===null)return;n===null?c[i]=r:(a.mod&&(r-n>a.mod/2?n+=a.mod:n-r>a.mod/2&&(n-=a.mod)),c[i]=h((r-n)*s+n,t))}),this[t](c)},blend:function(e){if(this._rgba[3]===1)return this;var t=this._rgba.slice(),i=t.pop(),n=p(e)._rgba;return p(u.map(t,function(e,t){return(1-i)*n[t]+i*e}))},toRgbaString:function(){var e="rgba(",t=u.map(this._rgba,function(e,t){return e==null?t>2?1:0:e});return t[3]===1&&(t.pop(),e="rgb("),e+t.join()+")"},toHslaString:function(){var e="hsla(",t=u.map(this.hsla(),function(e,t){return e==null&&(e=t>2?1:0),t&&t<3&&(e=Math.round(e*100)+"%"),e});return t[3]===1&&(t.pop(),e="hsl("),e+t.join()+")"},toHexString:function(e){var t=this._rgba.slice(),i=t.pop();return e&&t.push(~~(i*255)),"#"+u.map(t,function(e){return e=(e||0).toString(16),e.length===1?"0"+e:e}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}}),p.fn.parse.prototype=p.fn,g.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/255,i=e[1]/255,n=e[2]/255,r=e[3],a=Math.max(t,i,n),s=Math.min(t,i,n),o=a-s,l=a+s,c=l*.5,u,d;return s===a?u=0:t===a?u=60*(i-n)/o+360:i===a?u=60*(n-t)/o+120:u=60*(t-i)/o+240,c===0||c===1?d=c:c<=.5?d=o/l:d=o/(2-l),[Math.round(u)%360,d,c,r==null?1:r]},g.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/360,i=e[1],n=e[2],r=e[3],a=n<=.5?n*(1+i):n+i-n*i,s=2*n-a;return[Math.round(l(s,a,t+1/3)*255),Math.round(l(s,a,t)*255),Math.round(l(s,a,t-1/3)*255),r]},v(g,function(l,e){var i=e.props,s=e.cache,o=e.to,c=e.from;p.fn[l]=function(e){o&&!this[s]&&(this[s]=o(this._rgba));if(e===d)return this[s].slice();var t,n=u.type(e),r=n==="array"||n==="object"?e:arguments,a=this[s].slice();return v(i,function(e,t){var i=r[n==="object"?e:t.idx];i==null&&(i=a[t.idx]),a[t.idx]=h(i,t)}),c?(t=p(c(a)),t[s]=a,t):p(a)},v(i,function(s,o){if(p.fn[s])return;p.fn[s]=function(e){var t=u.type(e),i=s==="alpha"?this._hsla?"hsla":"rgba":l,n=this[i](),r=n[o.idx],a;return t==="undefined"?r:(t==="function"&&(e=e.call(this,r),t=u.type(e)),e==null&&o.empty?this:(t==="string"&&(a=f.exec(e),a&&(e=r+parseFloat(a[2])*(a[1]==="+"?1:-1))),n[o.idx]=e,this[i](n)))}})}),v(e,function(e,a){u.cssHooks[a]={set:function(e,t){var i,n,r="";if(u.type(t)!=="string"||(i=o(t))){t=p(i||t);if(!s.rgba&&t._rgba[3]!==1){n=a==="backgroundColor"?e.parentNode:e;while((r===""||r==="transparent")&&n&&n.style)try{r=u.css(n,"backgroundColor"),n=n.parentNode}catch(e){}t=t.blend(r&&r!=="transparent"?r:"_default")}t=t.toRgbaString()}try{e.style[a]=t}catch(e){}}},u.fx.step[a]=function(e){e.colorInit||(e.start=p(e.elem,a),e.end=p(e.end),e.colorInit=!0),u.cssHooks[a].set(e.elem,e.start.transition(e.end,e.pos))}}),u.cssHooks.borderColor={expand:function(i){var n={};return v(["Top","Right","Bottom","Left"],function(e,t){n["border"+t+"Color"]=i}),n}},c=u.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function s(){var e=this.ownerDocument.defaultView?this.ownerDocument.defaultView.getComputedStyle(this,null):this.currentStyle,t={},i,n;if(e&&e.length&&e[0]&&e[e[0]]){n=e.length;while(n--)i=e[n],typeof e[i]=="string"&&(t[y.camelCase(i)]=e[i])}else for(i in e)typeof e[i]=="string"&&(t[i]=e[i]);return t}function o(e,t){var i={},n,r;for(n in t)r=t[n],e[n]!==r&&!a[n]&&(y.fx.step[n]||!isNaN(parseFloat(r)))&&(i[n]=r);return i}var l=["add","remove","toggle"],a={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};y.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,t){y.fx.step[t]=function(e){if(e.end!=="none"&&!e.setAttr||e.pos===1&&!e.setAttr)jQuery.style(e.elem,t,e.end),e.setAttr=!0}}),y.effects.animateClass=function(r,e,t,i){var a=y.speed(e,t,i);return this.queue(function(){var i=y(this),e=i.attr("class")||"",t,n=a.children?i.find("*").andSelf():i;n=n.map(function(){var e=y(this);return{el:e,start:s.call(this)}}),t=function(){y.each(l,function(e,t){r[t]&&i[t+"Class"](r[t])})},t(),n=n.map(function(){return this.end=s.call(this.el[0]),this.diff=o(this.start,this.end),this}),i.attr("class",e),n=n.map(function(){var e=this,t=y.Deferred(),i=jQuery.extend({},a,{queue:!1,complete:function(){t.resolve(e)}});return this.el.animate(this.diff,i),t.promise()}),y.when.apply(y,n.get()).done(function(){t(),y.each(arguments,function(){var t=this.el;y.each(this.diff,function(e){t.css(e,"")})}),a.complete.call(i[0])})})},y.fn.extend({_addClass:y.fn.addClass,addClass:function(e,t,i,n){return t?y.effects.animateClass.call(this,{add:e},t,i,n):this._addClass(e)},_removeClass:y.fn.removeClass,removeClass:function(e,t,i,n){return t?y.effects.animateClass.call(this,{remove:e},t,i,n):this._removeClass(e)},_toggleClass:y.fn.toggleClass,toggleClass:function(e,t,i,n,r){return typeof t=="boolean"||t===c?i?y.effects.animateClass.call(this,t?{add:e}:{remove:e},i,n,r):this._toggleClass(e,t):y.effects.animateClass.call(this,{toggle:e},t,i,n)},switchClass:function(e,t,i,n,r){return y.effects.animateClass.call(this,{add:t,remove:e},i,n,r)}})}(),function(){function r(e,t,i,n){y.isPlainObject(e)&&(t=e,e=e.effect),e={effect:e},t==null&&(t={}),y.isFunction(t)&&(n=t,i=null,t={});if(typeof t=="number"||y.fx.speeds[t])n=i,i=t,t={};return y.isFunction(i)&&(n=i,i=null),t&&y.extend(e,t),i=i||t.duration,e.duration=y.fx.off?0:typeof i=="number"?i:i in y.fx.speeds?y.fx.speeds[i]:y.fx.speeds._default,e.complete=n||t.complete,e}function i(e){return!e||typeof e=="number"||y.fx.speeds[e]?!0:typeof e=="string"&&!y.effects.effect[e]?o&&y.effects[e]?!1:!0:!1}y.extend(y.effects,{version:"1.9.2",save:function(e,t){for(var i=0;i<t.length;i++)t[i]!==null&&e.data(a+t[i],e[0].style[t[i]])},restore:function(e,t){var i,n;for(n=0;n<t.length;n++)t[n]!==null&&(i=e.data(a+t[n]),i===c&&(i=""),e.css(t[n],i))},setMode:function(e,t){return t==="toggle"&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,n;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=e[1]/t.width}return{x:n,y:i}},createWrapper:function(i){if(i.parent().is(".ui-effects-wrapper"))return i.parent();var n={width:i.outerWidth(!0),height:i.outerHeight(!0),float:i.css("float")},e=y("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),t={width:i.width(),height:i.height()},r=document.activeElement;try{r.id}catch(e){r=document.body}return i.wrap(e),(i[0]===r||y.contains(i[0],r))&&y(r).focus(),e=i.parent(),i.css("position")==="static"?(e.css({position:"relative"}),i.css({position:"relative"})):(y.extend(n,{position:i.css("position"),zIndex:i.css("z-index")}),y.each(["top","left","bottom","right"],function(e,t){n[t]=i.css(t),isNaN(parseInt(n[t],10))&&(n[t]="auto")}),i.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),i.css(t),e.css(n).show()},removeWrapper:function(e){var t=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===t||y.contains(e[0],t))&&y(t).focus()),e},setTransition:function(n,e,r,a){return a=a||{},y.each(e,function(e,t){var i=n.cssUnit(t);i[0]>0&&(a[t]=i[0]*r+i[1])}),a}}),y.fn.extend({effect:function(){function e(e){function t(){y.isFunction(n)&&n.call(i[0]),y.isFunction(e)&&e()}var i=y(this),n=a.complete,r=a.mode;(i.is(":hidden")?r==="hide":r==="show")?t():s.call(i[0],a,t)}var a=r.apply(this,arguments),t=a.mode,i=a.queue,s=y.effects.effect[a.effect],n=!s&&o&&y.effects[a.effect];return y.fx.off||!s&&!n?t?this[t](a.duration,a.complete):this.each(function(){a.complete&&a.complete.call(this)}):s?i===!1?this.each(e):this.queue(i||"fx",e):n.call(this,{options:a,duration:a.duration,callback:a.complete,mode:a.mode})},_show:y.fn.show,show:function(e){if(i(e))return this._show.apply(this,arguments);var t=r.apply(this,arguments);return t.mode="show",this.effect.call(this,t)},_hide:y.fn.hide,hide:function(e){if(i(e))return this._hide.apply(this,arguments);var t=r.apply(this,arguments);return t.mode="hide",this.effect.call(this,t)},__toggle:y.fn.toggle,toggle:function(e){if(i(e)||typeof e=="boolean"||y.isFunction(e))return this.__toggle.apply(this,arguments);var t=r.apply(this,arguments);return t.mode="toggle",this.effect.call(this,t)},cssUnit:function(e){var i=this.css(e),n=[];return y.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(n=[parseFloat(i),t])}),n}})}(),function(){var i={};y.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,e){i[e]=function(e){return Math.pow(e,t+2)}}),y.extend(i,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return e===0||e===1?e:-Math.pow(2,8*(e-1))*Math.sin(((e-1)*80-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){var t,i=4;while(e<((t=Math.pow(2,--i))-1)/11);return 1/Math.pow(4,3-i)-7.5625*Math.pow((t*3-2)/22-e,2)}}),y.each(i,function(e,t){y.easing["easeIn"+e]=t,y.easing["easeOut"+e]=function(e){return 1-t(1-e)},y.easing["easeInOut"+e]=function(e){return e<.5?t(e*2)/2:1-t(e*-2+2)/2}})}()}(jQuery);(function(g,e){var m=/up|down|vertical/,v=/up|left|vertical|horizontal/;g.effects.effect.blind=function(e,t){var i=g(this),n=["position","top","bottom","left","right","height","width"],r=g.effects.setMode(i,e.mode||"hide"),a=e.direction||"up",s=m.test(a),o=s?"height":"width",l=s?"top":"left",c=v.test(a),u={},d=r==="show",h,f,p;i.parent().is(".ui-effects-wrapper")?g.effects.save(i.parent(),n):g.effects.save(i,n),i.show(),h=g.effects.createWrapper(i).css({overflow:"hidden"}),f=h[o](),p=parseFloat(h.css(l))||0,u[o]=d?f:0,c||(i.css(s?"bottom":"right",0).css(s?"top":"left","auto").css({position:"absolute"}),u[l]=d?p:f+p),d&&(h.css(o,0),c||h.css(l,p+f)),h.animate(u,{duration:e.duration,easing:e.easing,queue:!1,complete:function(){r==="hide"&&i.hide(),g.effects.restore(i,n),g.effects.removeWrapper(i),t()}})}})(jQuery);(function(b,e){b.effects.effect.bounce=function(e,t){var i=b(this),n=["position","top","bottom","left","right","height","width"],r=b.effects.setMode(i,e.mode||"effect"),a=r==="hide",s=r==="show",o=e.direction||"up",l=e.distance,c=e.times||5,u=c*2+(s||a?1:0),d=e.duration/u,h=e.easing,f=o==="up"||o==="down"?"top":"left",p=o==="up"||o==="left",g,m,v,y=i.queue(),_=y.length;(s||a)&&n.push("opacity"),b.effects.save(i,n),i.show(),b.effects.createWrapper(i),l||(l=i[f==="top"?"outerHeight":"outerWidth"]()/3),s&&(v={opacity:1},v[f]=0,i.css("opacity",0).css(f,p?-l*2:l*2).animate(v,d,h)),a&&(l/=Math.pow(2,c-1)),v={},v[f]=0;for(g=0;g<c;g++)m={},m[f]=(p?"-=":"+=")+l,i.animate(m,d,h).animate(v,d,h),l=a?l*2:l/2;a&&(m={opacity:0},m[f]=(p?"-=":"+=")+l,i.animate(m,d,h)),i.queue(function(){a&&i.hide(),b.effects.restore(i,n),b.effects.removeWrapper(i),t()}),_>1&&y.splice.apply(y,[1,0].concat(y.splice(_,u+1))),i.dequeue()}})(jQuery);(function(p,e){p.effects.effect.clip=function(e,t){var i=p(this),n=["position","top","bottom","left","right","height","width"],r=p.effects.setMode(i,e.mode||"hide"),a=r==="show",s=e.direction||"vertical",o=s==="vertical",l=o?"height":"width",c=o?"top":"left",u={},d,h,f;p.effects.save(i,n),i.show(),d=p.effects.createWrapper(i).css({overflow:"hidden"}),h=i[0].tagName==="IMG"?d:i,f=h[l](),a&&(h.css(l,0),h.css(c,f/2)),u[l]=a?f:0,u[c]=a?0:f/2,h.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){a||i.hide(),p.effects.restore(i,n),p.effects.removeWrapper(i),t()}})}})(jQuery);(function(d,e){d.effects.effect.drop=function(e,t){var i=d(this),n=["position","top","bottom","left","right","opacity","height","width"],r=d.effects.setMode(i,e.mode||"hide"),a=r==="show",s=e.direction||"left",o=s==="up"||s==="down"?"top":"left",l=s==="up"||s==="left"?"pos":"neg",c={opacity:a?1:0},u;d.effects.save(i,n),i.show(),d.effects.createWrapper(i),u=e.distance||i[o==="top"?"outerHeight":"outerWidth"](!0)/2,a&&i.css("opacity",0).css(o,l==="pos"?-u:u),c[o]=(a?l==="pos"?"+=":"-=":l==="pos"?"-=":"+=")+u,i.animate(c,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){r==="hide"&&i.hide(),d.effects.restore(i,n),d.effects.removeWrapper(i),t()}})}})(jQuery);(function(_,e){_.effects.effect.explode=function(e,t){function i(){h.push(this),h.length===r*a&&n()}function n(){s.css({visibility:"visible"}),_(h).remove(),l||s.hide(),t()}var r=e.pieces?Math.round(Math.sqrt(e.pieces)):3,a=r,s=_(this),o=_.effects.setMode(s,e.mode||"hide"),l=o==="show",c=s.show().css("visibility","hidden").offset(),u=Math.ceil(s.outerWidth()/a),d=Math.ceil(s.outerHeight()/r),h=[],f,p,g,m,v,y;for(f=0;f<r;f++){m=c.top+f*d,y=f-(r-1)/2;for(p=0;p<a;p++)g=c.left+p*u,v=p-(a-1)/2,s.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-p*u,top:-f*d}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:u,height:d,left:g+(l?v*u:0),top:m+(l?y*d:0),opacity:l?0:1}).animate({left:g+(l?0:v*u),top:m+(l?0:y*d),opacity:l?1:0},e.duration||500,e.easing,i)}}})(jQuery);(function(r,e){r.effects.effect.fade=function(e,t){var i=r(this),n=r.effects.setMode(i,e.mode||"toggle");i.animate({opacity:n},{queue:!1,duration:e.duration,easing:e.easing,complete:t})}})(jQuery);(function(v,e){v.effects.effect.fold=function(e,t){var i=v(this),n=["position","top","bottom","left","right","height","width"],r=v.effects.setMode(i,e.mode||"hide"),a=r==="show",s=r==="hide",o=e.size||15,l=/([0-9]+)%/.exec(o),c=!!e.horizFirst,u=a!==c,d=u?["width","height"]:["height","width"],h=e.duration/2,f,p,g={},m={};v.effects.save(i,n),i.show(),f=v.effects.createWrapper(i).css({overflow:"hidden"}),p=u?[f.width(),f.height()]:[f.height(),f.width()],l&&(o=parseInt(l[1],10)/100*p[s?0:1]),a&&f.css(c?{height:0,width:o}:{height:o,width:0}),g[d[0]]=a?p[0]:o,m[d[1]]=a?p[1]:0,f.animate(g,h,e.easing).animate(m,h,e.easing,function(){s&&i.hide(),v.effects.restore(i,n),v.effects.removeWrapper(i),t()})}})(jQuery);(function(s,e){s.effects.effect.highlight=function(e,t){var i=s(this),n=["backgroundImage","backgroundColor","opacity"],r=s.effects.setMode(i,e.mode||"show"),a={backgroundColor:i.css("backgroundColor")};r==="hide"&&(a.opacity=0),s.effects.save(i,n),i.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(a,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){r==="hide"&&i.hide(),s.effects.restore(i,n),t()}})}})(jQuery);(function(f,e){f.effects.effect.pulsate=function(e,t){var i=f(this),n=f.effects.setMode(i,e.mode||"show"),r=n==="show",a=n==="hide",s=r||n==="hide",o=(e.times||5)*2+(s?1:0),l=e.duration/o,c=0,u=i.queue(),d=u.length,h;if(r||!i.is(":visible"))i.css("opacity",0).show(),c=1;for(h=1;h<o;h++)i.animate({opacity:c},l,e.easing),c=1-c;i.animate({opacity:c},l,e.easing),i.queue(function(){a&&i.hide(),t()}),d>1&&u.splice.apply(u,[1,0].concat(u.splice(d,o+1))),i.dequeue()}})(jQuery);(function(_,e){_.effects.effect.puff=function(e,t){var i=_(this),n=_.effects.setMode(i,e.mode||"hide"),r=n==="hide",a=parseInt(e.percent,10)||150,s=a/100,o={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};_.extend(e,{effect:"scale",queue:!1,fade:!0,mode:n,complete:t,percent:r?a:100,from:r?o:{height:o.height*s,width:o.width*s,outerHeight:o.outerHeight*s,outerWidth:o.outerWidth*s}}),i.effect(e)},_.effects.effect.scale=function(e,t){var i=_(this),n=_.extend(!0,{},e),r=_.effects.setMode(i,e.mode||"effect"),a=parseInt(e.percent,10)||(parseInt(e.percent,10)===0?0:r==="hide"?0:100),s=e.direction||"both",o=e.origin,l={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()},c={y:s!=="horizontal"?a/100:1,x:s!=="vertical"?a/100:1};n.effect="size",n.queue=!1,n.complete=t,r!=="effect"&&(n.origin=o||["middle","center"],n.restore=!0),n.from=e.from||(r==="show"?{height:0,width:0,outerHeight:0,outerWidth:0}:l),n.to={height:l.height*c.y,width:l.width*c.x,outerHeight:l.outerHeight*c.y,outerWidth:l.outerWidth*c.x},n.fade&&(r==="show"&&(n.from.opacity=0,n.to.opacity=1),r==="hide"&&(n.from.opacity=1,n.to.opacity=0)),i.effect(n)},_.effects.effect.size=function(i,e){var t,n,r,a=_(this),s=["position","top","bottom","left","right","width","height","overflow","opacity"],o=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],c=["fontSize"],u=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],h=_.effects.setMode(a,i.mode||"effect"),f=i.restore||h!=="effect",p=i.scale||"both",g=i.origin||["middle","center"],m=a.css("position"),v=f?s:o,y={height:0,width:0,outerHeight:0,outerWidth:0};h==="show"&&a.show(),t={height:a.height(),width:a.width(),outerHeight:a.outerHeight(),outerWidth:a.outerWidth()},i.mode==="toggle"&&h==="show"?(a.from=i.to||y,a.to=i.from||t):(a.from=i.from||(h==="show"?y:t),a.to=i.to||(h==="hide"?y:t)),r={from:{y:a.from.height/t.height,x:a.from.width/t.width},to:{y:a.to.height/t.height,x:a.to.width/t.width}};if(p==="box"||p==="both")r.from.y!==r.to.y&&(v=v.concat(u),a.from=_.effects.setTransition(a,u,r.from.y,a.from),a.to=_.effects.setTransition(a,u,r.to.y,a.to)),r.from.x!==r.to.x&&(v=v.concat(d),a.from=_.effects.setTransition(a,d,r.from.x,a.from),a.to=_.effects.setTransition(a,d,r.to.x,a.to));(p==="content"||p==="both")&&r.from.y!==r.to.y&&(v=v.concat(c).concat(l),a.from=_.effects.setTransition(a,c,r.from.y,a.from),a.to=_.effects.setTransition(a,c,r.to.y,a.to)),_.effects.save(a,v),a.show(),_.effects.createWrapper(a),a.css("overflow","hidden").css(a.from),g&&(n=_.effects.getBaseline(g,t),a.from.top=(t.outerHeight-a.outerHeight())*n.y,a.from.left=(t.outerWidth-a.outerWidth())*n.x,a.to.top=(t.outerHeight-a.to.outerHeight)*n.y,a.to.left=(t.outerWidth-a.to.outerWidth)*n.x),a.css(a.from);if(p==="content"||p==="both")u=u.concat(["marginTop","marginBottom"]).concat(c),d=d.concat(["marginLeft","marginRight"]),l=s.concat(u).concat(d),a.find("*[width]").each(function(){var e=_(this),t={height:e.height(),width:e.width(),outerHeight:e.outerHeight(),outerWidth:e.outerWidth()};f&&_.effects.save(e,l),e.from={height:t.height*r.from.y,width:t.width*r.from.x,outerHeight:t.outerHeight*r.from.y,outerWidth:t.outerWidth*r.from.x},e.to={height:t.height*r.to.y,width:t.width*r.to.x,outerHeight:t.height*r.to.y,outerWidth:t.width*r.to.x},r.from.y!==r.to.y&&(e.from=_.effects.setTransition(e,u,r.from.y,e.from),e.to=_.effects.setTransition(e,u,r.to.y,e.to)),r.from.x!==r.to.x&&(e.from=_.effects.setTransition(e,d,r.from.x,e.from),e.to=_.effects.setTransition(e,d,r.to.x,e.to)),e.css(e.from),e.animate(e.to,i.duration,i.easing,function(){f&&_.effects.restore(e,l)})});a.animate(a.to,{queue:!1,duration:i.duration,easing:i.easing,complete:function(){a.to.opacity===0&&a.css("opacity",a.from.opacity),h==="hide"&&a.hide(),_.effects.restore(a,v),f||(m==="static"?a.css({position:"relative",top:a.to.top,left:a.to.left}):_.each(["top","left"],function(r,e){a.css(e,function(e,t){var i=parseInt(t,10),n=r?a.to.left:a.to.top;return t==="auto"?n+"px":i+n+"px"})})),_.effects.removeWrapper(a),e()}})}})(jQuery);(function(y,e){y.effects.effect.shake=function(e,t){var i=y(this),n=["position","top","bottom","left","right","height","width"],r=y.effects.setMode(i,e.mode||"effect"),a=e.direction||"left",s=e.distance||20,o=e.times||3,l=o*2+1,c=Math.round(e.duration/l),u=a==="up"||a==="down"?"top":"left",d=a==="up"||a==="left",h={},f={},p={},g,m=i.queue(),v=m.length;y.effects.save(i,n),i.show(),y.effects.createWrapper(i),h[u]=(d?"-=":"+=")+s,f[u]=(d?"+=":"-=")+s*2,p[u]=(d?"-=":"+=")+s*2,i.animate(h,c,e.easing);for(g=1;g<o;g++)i.animate(f,c,e.easing).animate(p,c,e.easing);i.animate(f,c,e.easing).animate(h,c/2,e.easing).queue(function(){r==="hide"&&i.hide(),y.effects.restore(i,n),y.effects.removeWrapper(i),t()}),v>1&&m.splice.apply(m,[1,0].concat(m.splice(v,l+1))),i.dequeue()}})(jQuery);(function(d,e){d.effects.effect.slide=function(e,t){var i=d(this),n=["position","top","bottom","left","right","width","height"],r=d.effects.setMode(i,e.mode||"show"),a=r==="show",s=e.direction||"left",o=s==="up"||s==="down"?"top":"left",l=s==="up"||s==="left",c,u={};d.effects.save(i,n),i.show(),c=e.distance||i[o==="top"?"outerHeight":"outerWidth"](!0),d.effects.createWrapper(i).css({overflow:"hidden"}),a&&i.css(o,l?isNaN(c)?"-"+c:-c:c),u[o]=(a?l?"+=":"-=":l?"-=":"+=")+c,i.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){r==="hide"&&i.hide(),d.effects.restore(i,n),d.effects.removeWrapper(i),t()}})}})(jQuery);(function(h,e){h.effects.effect.transfer=function(e,t){var i=h(this),n=h(e.to),r=n.css("position")==="fixed",a=h("body"),s=r?a.scrollTop():0,o=r?a.scrollLeft():0,l=n.offset(),c={top:l.top-s,left:l.left-o,height:n.innerHeight(),width:n.innerWidth()},u=i.offset(),d=h('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(e.className).css({top:u.top-s,left:u.left-o,height:i.innerHeight(),width:i.innerWidth(),position:r?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t()})}})(jQuery);(function(e){if(e&&window.XDomainRequest){e.ajaxTransport(function(i){if(i.crossDomain&&i.async){if(i.timeout){i.xdrTimeout=i.timeout;delete i.timeout}var a;return{send:function(e,r){function t(e,t,i,n){a.onload=a.onerror=a.ontimeout=function(){};a=undefined;r(e,t,i,n)}a=new XDomainRequest;a.open(i.type,i.url);a.onload=function(){t(200,"OK",{text:a.responseText},"Content-Type: "+a.contentType)};a.onerror=function(){t(404,"Not Found")};a.ontimeout=function(){t(0,"timeout")};if(i.xdrTimeout){a.timeout=i.xdrTimeout}else{a.timeout=5e3}a.onprogress=function(){};a.send(i.hasContent&&i.data||null)},abort:function(){if(a){a.onerror=e.noop;a.abort()}}}}})}})(jQuery);(function(n){function r(e){this.options=n.extend({},r.defaults,e)}r.instances=[];r.repositionAll=function(){for(var e=0;e<r.instances.length;e++){if(!r.instances[e])continue;var t=r.instances[e].options;new r(t).positionImg(n(r.instances[e].target),n.data(r.instances[e].target,"busy"),t.position)}};r.prototype.hide=function(e){e.each(function(){var e=n.data(this,"busy");if(e)e.remove();n(this).css("visibility","");n.data(this,"busy",null);for(var t=0;t<r.instances.length;t++)if(r.instances[t]!=null&&r.instances[t].target==this)r.instances[t]=null})};r.prototype.show=function(e){var i=this;e.each(function(){if(n.data(this,"busy"))return;var e=n(this);var t=i.buildImg();t.css("visibility","hidden");t.load(function(){i.positionImg(e,t,i.options.position);t.css("visibility","")});n("body").append(t);if(i.options.hide)e.css("visibility","hidden");n.data(this,"busy",t);r.instances.push({target:this,options:i.options})})};r.prototype.preload=function(){var e=this.buildImg();e.css("visibility","hidden");e.load(function(){n(this).remove()});n("body").append(e)};r.prototype.buildImg=function(){var e="<img src='"+this.options.img+"' alt='"+this.options.alt+"' title='"+this.options.title+"'";if(this.options.width)e+=" width='"+this.options.width+"'";if(this.options.height)e+=" height='"+this.options.height+"'";e+=" />";return n(e)};r.prototype.positionImg=function(e,t,i){var n=e.offset();var r=e.outerWidth();var a=e.outerHeight();var s=t.outerWidth();var o=t.outerHeight();if(i=="left"){var l=n.left-s-this.options.offset}else if(i=="right"){var l=n.left+r+this.options.offset}else{var l=n.left+(r-s)/2}var c=n.top+(a-o)/2;t.css("position","absolute");t.css("left",l+"px");t.css("top",c+"px")};r.defaults={img:"busy.gif",alt:"Please wait...",title:"Please wait...",hide:true,position:"center",zIndex:1001,width:null,height:null,offset:10};n.fn.busy=function(e,t){if(n.inArray(e,["clear","hide","remove"])!=-1){new r(e).hide(n(this))}else if(e=="defaults"){n.extend(r.defaults,t||{})}else if(e=="preload"){new r(e).preload()}else if(e=="reposition"){r.repositionAll()}else{new r(e).show(n(this));return n(this)}}})(jQuery);(function(n){function i(e){this.options=n.extend({},i.defaults,e)}i.prototype.hide=function(e){e.each(function(){var e=n.data(this,"loader");if(e)e.remove();n.data(this,"loader",null)})};i.prototype.show=function(e){var t=this;e.each(function(){if(n.data(this,"loader"))return;var e=e?e:"Loading...";var t=n("<div style='width:100%; text-align:center;' class='loader' ></div> ");t.html('<div style=\'margin:5px auto;\'><div class="loading" style="margin:0 auto;width:16px;height:16px" alt=\''+e+"'></div></div>");var i=n(this);t.appendTo(i);n.data(this,"loader",t)})};n.fn.loader=function(e,t){if(n.inArray(e,["clear","hide","remove"])!=-1){new i(e).hide(n(this));return n(this)}else{new i(e).show(n(this));return n(this)}}})(window.jQuery||giscloud.exposeJQuery());(function(n){"use strict";var r={},a={},s={},o={},l={},c=null;function u(e,t){if(e.height()&&e.width()){clearInterval(a[t]);clearTimeout(s[t]);delete a[t];delete s[t];delete o[t];r[t].resolveWith(e,[e[0]])}}function d(e){console.log("timeout",e);if(a[e]){clearInterval(a[e]);delete a[e];delete s[e];delete l[e];r[e].reject()}}function h(e,t){var i=new n.Deferred;o[t]=function(){u(e,t)};l[t]=function(){d(t)};a[t]=setInterval(o[t],100);s[t]=setTimeout(l[t],5e3);e.load(o[t]);r[t]=i;return r[t]}function f(){return n("<div/>",{id:"a"+Math.floor(Math.random()*1e3),css:{width:"1px",height:"1px",position:"absolute",top:"-5000px",left:"-5000px",overflow:"hidden"}}).appendTo("body")}function t(e){var t,i=e&&e.replace&&e.replace(/[\W]+/g,"_");if(!i){return null}if(r[i]){return r[i].promise()}if(!c){c=f()}t=n("<img/>",{src:e}).appendTo(c);return h(t,i).promise()}n.loadImage=t;n.fn.loadImage=function(e){if(!this.is("img")){return null}return t(this.attr("src")||e)}})(jQuery);(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){e(require("jquery"))}else{e(jQuery)}})(function(T,y){"use strict";if(T.jstree){return}var r=0,a=false,s=false,o=false,n=[],e=T("script:last").attr("src"),t=document,m=t.createElement("LI"),i,l;m.setAttribute("role","treeitem");i=t.createElement("I");i.className="jstree-icon jstree-ocl";m.appendChild(i);i=t.createElement("A");i.className="jstree-anchor";i.setAttribute("href","#");l=t.createElement("I");l.className="jstree-icon jstree-themeicon";i.appendChild(l);m.appendChild(i);i=l=null;T.jstree={version:"3.0.0",defaults:{plugins:[]},plugins:{},path:e&&e.indexOf("/")!==-1?e.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&'".,=\- \/]/g};T.jstree.create=function(e,i){var n=new T.jstree.core(++r),t=i;i=T.extend(true,{},T.jstree.defaults,i);if(t&&t.plugins){i.plugins=t.plugins}T.each(i.plugins,function(e,t){if(e!=="core"){n=n.plugin(t,i[t])}});n.init(e,i);return n};T.jstree.core=function(e){this._id=e;this._cnt=0;this._data={core:{themes:{name:false,dots:false,icons:false},selected:[],last_error:{}}}};T.jstree.reference=function(t){var i=null,e=null;if(t&&t.id){t=t.id}if(!e||!e.length){try{e=T(t)}catch(e){}}if(!e||!e.length){try{e=T("#"+t.replace(T.jstree.idregex,"\\$&"))}catch(e){}}if(e&&e.length&&(e=e.closest(".jstree")).length&&(e=e.data("jstree"))){i=e}else{T(".jstree").each(function(){var e=T(this).data("jstree");if(e&&e._model.data[t]){i=e;return false}})}return i};T.fn.jstree=function(i){var n=typeof i==="string",r=Array.prototype.slice.call(arguments,1),a=null;this.each(function(){var e=T.jstree.reference(this),t=n&&e?e[i]:null;a=n&&t?t.apply(e,r):null;if(!e&&!n&&(i===y||T.isPlainObject(i))){T(this).data("jstree",new T.jstree.create(this,i))}if(e&&!n||i===true){a=e||false}if(a!==null&&a!==y){return false}});return a!==null&&a!==y?a:this};T.expr[":"].jstree=T.expr.createPseudo(function(e){return function(e){return T(e).hasClass("jstree")&&T(e).data("jstree")!==y}});T.jstree.defaults.core={data:false,strings:false,check_callback:false,error:T.noop,animation:200,multiple:true,themes:{name:false,url:false,dir:false,dots:true,icons:true,stripes:false,variant:false,responsive:true},expand_selected_onload:true};T.jstree.core.prototype={plugin:function(e,t){var i=T.jstree.plugins[e];if(i){this._data[e]={};i.prototype=this;return new i(t,this)}return this},init:function(e,t){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:false}}},changed:[],force_full_redraw:false,redraw_timeout:false,default_state:{loaded:true,opened:false,selected:false,disabled:false}};this.element=T(e).addClass("jstree jstree-"+this._id);this.settings=t;this.element.bind("destroyed",T.proxy(this.teardown,this));this._data.core.ready=false;this._data.core.loaded=false;this._data.core.rtl=this.element.css("direction")==="rtl";this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");if(!this.element.attr("tabindex")){this.element.attr("tabindex","0")}this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(true);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<"+"ul class='jstree-container-ul jstree-children'><"+"li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||18;this.trigger("loading");this.load_node("#");this.element.find(".jstree-container-ul").attr("role","group")},destroy:function(){this.element.unbind("destroyed",this.teardown);this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")});this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges();e.collapse()}catch(e){}}}}).on("click.jstree",".jstree-ocl",T.proxy(function(e){this.toggle_node(e.target)},this)).on("click.jstree",".jstree-anchor",T.proxy(function(e){e.preventDefault();T(e.currentTarget).focus();this.activate_node(e.currentTarget,e)},this)).on("keydown.jstree",".jstree-anchor",T.proxy(function(e){if(e.target.tagName==="INPUT"){return true}var t=null;switch(e.which){case 13:case 32:e.type="click";T(e.currentTarget).trigger(e);break;case 37:e.preventDefault();if(this.is_open(e.currentTarget)){this.close_node(e.currentTarget)}else{t=this.get_prev_dom(e.currentTarget);if(t&&t.length){t.children(".jstree-anchor").focus()}}break;case 38:e.preventDefault();t=this.get_prev_dom(e.currentTarget);if(t&&t.length){t.children(".jstree-anchor").focus()}break;case 39:e.preventDefault();if(this.is_closed(e.currentTarget)){this.open_node(e.currentTarget,function(e){this.get_node(e,true).children(".jstree-anchor").focus()})}else{t=this.get_next_dom(e.currentTarget);if(t&&t.length){t.children(".jstree-anchor").focus()}}break;case 40:e.preventDefault();t=this.get_next_dom(e.currentTarget);if(t&&t.length){t.children(".jstree-anchor").focus()}break;case 46:e.preventDefault();t=this.get_node(e.currentTarget);if(t&&t.id&&t.id!=="#"){t=this.is_selected(t)?this.get_selected():t}break;case 113:e.preventDefault();t=this.get_node(e.currentTarget);break;default:break}},this)).on("load_node.jstree",T.proxy(function(e,t){if(t.status){if(t.node.id==="#"&&!this._data.core.loaded){this._data.core.loaded=true;this.trigger("loaded")}if(!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length){this._data.core.ready=true;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var i=[],n,r;for(n=0,r=this._data.core.selected.length;n<r;n++){i=i.concat(this._model.data[this._data.core.selected[n]].parents)}i=T.vakata.array_unique(i);for(n=0,r=i.length;n<r;n++){this.open_node(i[n],false,0)}}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(T.proxy(function(){this.trigger("ready")},this),0)}}},this)).on("init.jstree",T.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots;this._data.core.themes.stripes=e.stripes;this._data.core.themes.icons=e.icons;this.set_theme(e.name||"default",e.url);this.set_theme_variant(e.variant)},this)).on("loading.jstree",T.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("focus.jstree",".jstree-anchor",T.proxy(function(e){this.element.find(".jstree-hovered").not(e.currentTarget).mouseleave();T(e.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",T.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",T.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree");T(document).off(".jstree-"+this._id)},trigger:function(e,t){if(!t){t={}}t.instance=this;this.element&&this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children:eq(0)")},get_string:function(e){var t=this.settings.core.strings;if(T.isFunction(t)){return t.call(this,e)}if(t&&t[e]){return t[e]}return e},_firstChild:function(e){e=e?e.firstChild:null;while(e!==null&&e.nodeType!==1){e=e.nextSibling}return e},_nextSibling:function(e){e=e?e.nextSibling:null;while(e!==null&&e.nodeType!==1){e=e.nextSibling}return e},_previousSibling:function(e){e=e?e.previousSibling:null;while(e!==null&&e.nodeType!==1){e=e.previousSibling}return e},get_node:function(e,t){if(e&&e.id){e=e.id}var i;try{if(this._model.data[e]){e=this._model.data[e]}else if(((i=T(e,this.element)).length||(i=T("#"+e.replace(T.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[i.closest(".jstree-node").attr("id")]){e=this._model.data[i.closest(".jstree-node").attr("id")]}else if((i=T(e,this.element)).length&&i.hasClass("jstree")){e=this._model.data["#"]}else{return false}if(t){e=e.id==="#"?this.element:T("#"+e.id.replace(T.jstree.idregex,"\\$&"),this.element)}return e}catch(e){return false}},get_path:function(e,t,i){e=e.parents?e:this.get_node(e);if(!e||e.id==="#"||!e.parents){return false}var n,r,a=[];a.push(i?e.id:e.text);for(n=0,r=e.parents.length;n<r;n++){a.push(i?e.parents[n]:this.get_text(e.parents[n]))}a=a.reverse().slice(1);return t?a.join(t):a},get_next_dom:function(e,t){var i;e=this.get_node(e,true);if(e[0]===this.element[0]){i=this._firstChild(this.get_container_ul()[0]);return i?T(i):false}if(!e||!e.length){return false}if(t){i=this._nextSibling(e[0]);return i?T(i):false}if(e.hasClass("jstree-open")){i=this._firstChild(e.children(".jstree-children")[0]);return i?T(i):false}if((i=this._nextSibling(e[0]))!==null){return T(i)}return e.parentsUntil(".jstree",".jstree-node").next(".jstree-node").eq(0)},get_prev_dom:function(e,t){var i;e=this.get_node(e,true);if(e[0]===this.element[0]){i=this.get_container_ul()[0].lastChild;return i?T(i):false}if(!e||!e.length){return false}if(t){i=this._previousSibling(e[0]);return i?T(i):false}if((i=this._previousSibling(e[0]))!==null){e=T(i);while(e.hasClass("jstree-open")){e=e.children(".jstree-children:eq(0)").children(".jstree-node:last")}return e}i=e[0].parentNode.parentNode;return i&&i.className&&i.className.indexOf("jstree-node")!==-1?T(i):false},get_parent:function(e){e=this.get_node(e);if(!e||e.id==="#"){return false}return e.parent},get_children_dom:function(e){e=this.get_node(e,true);if(e[0]===this.element[0]){return this.get_container_ul().children(".jstree-node")}if(!e||!e.length){return false}return e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){e=this.get_node(e);return e&&(e.state.loaded===false||e.children.length>0)},is_loaded:function(e){e=this.get_node(e);return e&&e.state.loaded},is_loading:function(e){e=this.get_node(e);return e&&e.state&&e.state.loading},is_open:function(e){e=this.get_node(e);return e&&e.state.opened},is_closed:function(e){e=this.get_node(e);return e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(i,n){var e,t,r,a,s,o,l;if(T.isArray(i)){i=i.slice();for(e=0,t=i.length;e<t;e++){this.load_node(i[e],n)}return true}i=this.get_node(i);if(!i){if(n){n.call(this,i,false)}return false}if(i.state.loaded){i.state.loaded=false;for(r=0,a=i.children_d.length;r<a;r++){for(s=0,o=i.parents.length;s<o;s++){this._model.data[i.parents[s]].children_d=T.vakata.array_remove_item(this._model.data[i.parents[s]].children_d,i.children_d[r])}if(this._model.data[i.children_d[r]].state.selected){l=true;this._data.core.selected=T.vakata.array_remove_item(this._data.core.selected,i.children_d[r])}delete this._model.data[i.children_d[r]]}i.children=[];i.children_d=[];if(l){this.trigger("changed",{action:"load_node",node:i,selected:this._data.core.selected})}}i.state.loading=true;this.get_node(i,true).addClass("jstree-loading");this._load_node(i,T.proxy(function(e){i.state.loading=false;i.state.loaded=e;var t=this.get_node(i,true);if(i.state.loaded&&!i.children.length&&t&&t.length&&!t.hasClass("jstree-leaf")){t.removeClass("jstree-closed jstree-open").addClass("jstree-leaf")}t.removeClass("jstree-loading");this.trigger("load_node",{node:i,status:e});if(n){n.call(this,i,e)}},this));return true},_load_nodes:function(e,t,i){var n=true,r=function(){this._load_nodes(e,t,true)},a=this._model.data,s,o;for(s=0,o=e.length;s<o;s++){if(a[e[s]]&&(!a[e[s]].state.loaded||!i)){if(!this.is_loading(e[s])){this.load_node(e[s],r)}n=false}}if(n){if(!t.done){t.call(this,e);t.done=true}}},_load_node:function(r,a){var e=this.settings.core.data,t;if(!e){return a.call(this,r.id==="#"?this._append_html_data(r,this._data.core.original_container_html.clone(true)):false)}if(T.isFunction(e)){return e.call(this,r,T.proxy(function(e){return e===false?a.call(this,false):a.call(this,this[typeof e==="string"?"_append_html_data":"_append_json_data"](r,typeof e==="string"?T(e):e))},this))}if(typeof e==="object"){if(e.url){e=T.extend(true,{},e);if(T.isFunction(e.url)){e.url=e.url.call(this,r)}if(T.isFunction(e.data)){e.data=e.data.call(this,r)}return T.ajax(e).done(T.proxy(function(e,t,i){var n=i.getResponseHeader("Content-Type");if(n.indexOf("json")!==-1||typeof e==="object"){return a.call(this,this._append_json_data(r,e))}if(n.indexOf("html")!==-1||typeof e==="string"){return a.call(this,this._append_html_data(r,T(e)))}this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:r.id,xhr:i})};return a.call(this,false)},this)).fail(T.proxy(function(e){a.call(this,false);this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:r.id,xhr:e})};this.settings.core.error.call(this,this._data.core.last_error)},this))}t=T.isArray(e)||T.isPlainObject(e)?JSON.parse(JSON.stringify(e)):e;if(r.id!=="#"){this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:r.id})}}return a.call(this,r.id==="#"?this._append_json_data(r,t):false)}if(typeof e==="string"){if(r.id!=="#"){this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:r.id})}}return a.call(this,r.id==="#"?this._append_html_data(r,T(e)):false)}return a.call(this,false)},_node_changed:function(e){e=this.get_node(e);if(e){this._model.changed.push(e.id)}},_append_html_data:function(e,t){e=this.get_node(e);e.children=[];e.children_d=[];var i=t.is("ul")?t.children():t,n=e.id,r=[],a=[],s=this._model.data,o=s[n],l=this._data.core.selected.length,c,u,d;i.each(T.proxy(function(e,t){c=this._parse_model_from_html(T(t),n,o.parents.concat());if(c){r.push(c);a.push(c);if(s[c].children_d.length){a=a.concat(s[c].children_d)}}},this));o.children=r;o.children_d=a;for(u=0,d=o.parents.length;u<d;u++){s[o.parents[u]].children_d=s[o.parents[u]].children_d.concat(a)}this.trigger("model",{nodes:a,parent:n});if(n!=="#"){this._node_changed(n);this.redraw()}else{this.get_container_ul().children(".jstree-initial-node").remove();this.redraw(true)}if(this._data.core.selected.length!==l){this.trigger("changed",{action:"model",selected:this._data.core.selected})}return true},_append_json_data:function(e,t){e=this.get_node(e);e.children=[];e.children_d=[];var i=t,n=e.id,r=[],a=[],s=this._model.data,o=s[n],l=this._data.core.selected.length,c,u,d;if(i.d){i=i.d;if(typeof i==="string"){i=JSON.parse(i)}}if(!T.isArray(i)){i=[i]}if(i.length&&i[0].id!==y&&i[0].parent!==y){for(u=0,d=i.length;u<d;u++){if(!i[u].children){i[u].children=[]}s[i[u].id.toString()]=i[u]}for(u=0,d=i.length;u<d;u++){s[i[u].parent.toString()].children.push(i[u].id.toString());o.children_d.push(i[u].id.toString())}for(u=0,d=o.children.length;u<d;u++){c=this._parse_model_from_flat_json(s[o.children[u]],n,o.parents.concat());a.push(c);if(s[c].children_d.length){a=a.concat(s[c].children_d)}}}else{for(u=0,d=i.length;u<d;u++){c=this._parse_model_from_json(i[u],n,o.parents.concat());if(c){r.push(c);a.push(c);if(s[c].children_d.length){a=a.concat(s[c].children_d)}}}o.children=r;o.children_d=a;for(u=0,d=o.parents.length;u<d;u++){s[o.parents[u]].children_d=s[o.parents[u]].children_d.concat(a)}}this.trigger("model",{nodes:a,parent:n});if(n!=="#"){this._node_changed(n);this.redraw()}else{this.redraw(true)}if(this._data.core.selected.length!==l){this.trigger("changed",{action:"model",selected:this._data.core.selected})}return true},_parse_model_from_html:function(e,t,i){if(!i){i=[]}else{i=[].concat(i)}if(t){i.unshift(t)}var n,r,a=this._model.data,s={id:false,text:false,icon:true,parent:t,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false},o,l,c;for(o in this._model.default_state){if(this._model.default_state.hasOwnProperty(o)){s.state[o]=this._model.default_state[o]}}l=T.vakata.attributes(e,true);T.each(l,function(e,t){t=T.trim(t);if(!t.length){return true}s.li_attr[e]=t;if(e==="id"){s.id=t.toString()}});l=e.children("a").eq(0);if(l.length){l=T.vakata.attributes(l,true);T.each(l,function(e,t){t=T.trim(t);if(t.length){s.a_attr[e]=t}})}l=e.children("a:eq(0)").length?e.children("a:eq(0)").clone():e.clone();l.children("ins, i, ul").remove();l=l.html();l=T("<div />").html(l);s.text=l.html();l=e.data();s.data=l?T.extend(true,{},l):null;s.state.opened=e.hasClass("jstree-open");s.state.selected=e.children("a").hasClass("jstree-clicked");s.state.disabled=e.children("a").hasClass("jstree-disabled");if(s.data&&s.data.jstree){for(o in s.data.jstree){if(s.data.jstree.hasOwnProperty(o)){s.state[o]=s.data.jstree[o]}}}l=e.children("a").children(".jstree-themeicon");if(l.length){s.icon=l.hasClass("jstree-themeicon-hidden")?false:l.attr("rel")}if(s.state.icon){s.icon=s.state.icon}l=e.children("ul").children("li");do{c="j"+this._id+"_"+ ++this._cnt}while(a[c]);s.id=s.li_attr.id?s.li_attr.id.toString():c;if(l.length){l.each(T.proxy(function(e,t){n=this._parse_model_from_html(T(t),s.id,i);r=this._model.data[n];s.children.push(n);if(r.children_d.length){s.children_d=s.children_d.concat(r.children_d)}},this));s.children_d=s.children_d.concat(s.children)}else{if(e.hasClass("jstree-closed")){s.state.loaded=false}}if(s.li_attr["class"]){s.li_attr["class"]=s.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")}if(s.a_attr["class"]){s.a_attr["class"]=s.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")}a[s.id]=s;if(s.state.selected){this._data.core.selected.push(s.id)}return s.id},_parse_model_from_flat_json:function(e,t,i){if(!i){i=[]}else{i=i.concat()}if(t){i.unshift(t)}var n=e.id.toString(),r=this._model.data,a=this._model.default_state,s,o,l,c,u={id:n,text:e.text||"",icon:e.icon!==y?e.icon:true,parent:t,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(s in a){if(a.hasOwnProperty(s)){u.state[s]=a[s]}}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){u.icon=e.data.jstree.icon}if(e&&e.data){u.data=e.data;if(e.data.jstree){for(s in e.data.jstree){if(e.data.jstree.hasOwnProperty(s)){u.state[s]=e.data.jstree[s]}}}}if(e&&typeof e.state==="object"){for(s in e.state){if(e.state.hasOwnProperty(s)){u.state[s]=e.state[s]}}}if(e&&typeof e.li_attr==="object"){for(s in e.li_attr){if(e.li_attr.hasOwnProperty(s)){u.li_attr[s]=e.li_attr[s]}}}if(!u.li_attr.id){u.li_attr.id=n}if(e&&typeof e.a_attr==="object"){for(s in e.a_attr){if(e.a_attr.hasOwnProperty(s)){u.a_attr[s]=e.a_attr[s]}}}if(e&&e.children&&e.children===true){u.state.loaded=false;u.children=[];u.children_d=[]}r[u.id]=u;for(s=0,o=u.children.length;s<o;s++){l=this._parse_model_from_flat_json(r[u.children[s]],u.id,i);c=r[l];u.children_d.push(l);if(c.children_d.length){u.children_d=u.children_d.concat(c.children_d)}}delete e.data;delete e.children;r[u.id].original=e;if(u.state.selected){this._data.core.selected.push(u.id)}return u.id},_parse_model_from_json:function(e,t,i){if(!i){i=[]}else{i=i.concat()}if(t){i.unshift(t)}var n=false,r,a,s,o,l=this._model.data,c=this._model.default_state,u;do{n="j"+this._id+"_"+ ++this._cnt}while(l[n]);u={id:false,text:typeof e==="string"?e:"",icon:typeof e==="object"&&e.icon!==y?e.icon:true,parent:t,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(r in c){if(c.hasOwnProperty(r)){u.state[r]=c[r]}}if(e&&e.id){u.id=e.id.toString()}if(e&&e.text){u.text=e.text}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){u.icon=e.data.jstree.icon}if(e&&e.data){u.data=e.data;if(e.data.jstree){for(r in e.data.jstree){if(e.data.jstree.hasOwnProperty(r)){u.state[r]=e.data.jstree[r]}}}}if(e&&typeof e.state==="object"){for(r in e.state){if(e.state.hasOwnProperty(r)){u.state[r]=e.state[r]}}}if(e&&typeof e.li_attr==="object"){for(r in e.li_attr){if(e.li_attr.hasOwnProperty(r)){u.li_attr[r]=e.li_attr[r]}}}if(u.li_attr.id&&!u.id){u.id=u.li_attr.id.toString()}if(!u.id){u.id=n}if(!u.li_attr.id){u.li_attr.id=u.id}if(e&&typeof e.a_attr==="object"){for(r in e.a_attr){if(e.a_attr.hasOwnProperty(r)){u.a_attr[r]=e.a_attr[r]}}}if(e&&e.children&&e.children.length){for(r=0,a=e.children.length;r<a;r++){s=this._parse_model_from_json(e.children[r],u.id,i);o=l[s];u.children.push(s);if(o.children_d.length){u.children_d=u.children_d.concat(o.children_d)}}u.children_d=u.children_d.concat(u.children)}if(e&&e.children&&e.children===true){u.state.loaded=false;u.children=[];u.children_d=[]}delete e.data;delete e.children;u.original=e;l[u.id]=u;if(u.state.selected){this._data.core.selected.push(u.id)}return u.id},_redraw:function(){var e=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),t=document.createElement("UL"),i,n,r;for(n=0,r=e.length;n<r;n++){i=this.redraw_node(e[n],true,this._model.force_full_redraw);if(i&&this._model.force_full_redraw){t.appendChild(i)}}if(this._model.force_full_redraw){t.className=this.get_container_ul()[0].className;this.element.empty().append(t)}this._model.force_full_redraw=false;this._model.changed=[];this.trigger("redraw",{nodes:e})},redraw:function(e){if(e){this._model.force_full_redraw=true}this._redraw()},redraw_node:function(e,t,i){var n=this.get_node(e),r=false,a=false,s=false,o=false,l=false,c=false,u="",d=document,h=this._model.data,f=false,p=false,g=null;if(!n){return false}if(n.id==="#"){return this.redraw(true)}t=t||n.children.length===0;e=!document.querySelector?document.getElementById(n.id):this.element[0].querySelector("#"+("0123456789".indexOf(n.id[0])!==-1?"\\3"+n.id[0]+" "+n.id.substr(1).replace(T.jstree.idregex,"\\$&"):n.id.replace(T.jstree.idregex,"\\$&")));if(!e){t=true;if(!i){r=n.parent!=="#"?T("#"+n.parent.replace(T.jstree.idregex,"\\$&"),this.element)[0]:null;if(r!==null&&(!r||!h[n.parent].state.opened)){return false}a=T.inArray(n.id,r===null?h["#"].children:h[n.parent].children)}}else{e=T(e);if(!i){r=e.parent().parent()[0];if(r===this.element[0]){r=null}a=e.index()}if(!t&&n.children.length&&!e.children(".jstree-children").length){t=true}if(!t){s=e.children(".jstree-children")[0]}p=e.attr("aria-selected");f=e.children(".jstree-anchor")[0]===document.activeElement;e.remove()}e=m.cloneNode(true);u="jstree-node ";for(o in n.li_attr){if(n.li_attr.hasOwnProperty(o)){if(o==="id"){continue}if(o!=="class"){e.setAttribute(o,n.li_attr[o])}else{u+=n.li_attr[o]}}}if(p&&p!=="false"){e.setAttribute("aria-selected",true)}if(n.state.loaded&&!n.children.length){u+=" jstree-leaf"}else{u+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed";e.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)}if(n.parent!==null&&h[n.parent].children[h[n.parent].children.length-1]===n.id){u+=" jstree-last"}e.id=n.id;e.className=u;u=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(l in n.a_attr){if(n.a_attr.hasOwnProperty(l)){if(l==="href"&&n.a_attr[l]==="#"){continue}if(l!=="class"){e.childNodes[1].setAttribute(l,n.a_attr[l])}else{u+=" "+n.a_attr[l]}}}if(u.length){e.childNodes[1].className="jstree-anchor "+u}if(n.icon&&n.icon!==true||n.icon===false){if(n.icon===false){e.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden"}else if(n.icon.indexOf("/")===-1&&n.icon.indexOf(".")===-1){e.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom"}else{e.childNodes[1].childNodes[0].style.backgroundImage="url("+n.icon+")";e.childNodes[1].childNodes[0].style.backgroundPosition="center center";e.childNodes[1].childNodes[0].style.backgroundSize="auto";e.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom"}}e.childNodes[1].innerHTML+=n.text;if(t&&n.children.length&&n.state.opened&&n.state.loaded){c=d.createElement("UL");c.setAttribute("role","group");c.className="jstree-children";for(o=0,l=n.children.length;o<l;o++){c.appendChild(this.redraw_node(n.children[o],t,true))}e.appendChild(c)}if(s){e.appendChild(s)}if(!i){if(!r){r=this.element[0]}for(o=0,l=r.childNodes.length;o<l;o++){if(r.childNodes[o]&&r.childNodes[o].className&&r.childNodes[o].className.indexOf("jstree-children")!==-1){g=r.childNodes[o];break}}if(!g){g=d.createElement("UL");g.setAttribute("role","group");g.className="jstree-children";r.appendChild(g)}r=g;if(a<r.childNodes.length){r.insertBefore(e,r.childNodes[a])}else{r.appendChild(e)}if(f){e.childNodes[1].focus()}}if(n.state.opened&&!n.state.loaded){n.state.opened=false;setTimeout(T.proxy(function(){this.open_node(n.id,false,0)},this),0)}return e},open_node:function(e,i,n){var t,r,a,s;if(T.isArray(e)){e=e.slice();for(t=0,r=e.length;t<r;t++){this.open_node(e[t],i,n)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}n=n===y?this.settings.core.animation:n;if(!this.is_closed(e)){if(i){i.call(this,e,false)}return false}if(!this.is_loaded(e)){if(this.is_loading(e)){return setTimeout(T.proxy(function(){this.open_node(e,i,n)},this),500)}this.load_node(e,function(e,t){return t?this.open_node(e,i,n):i?i.call(this,e,false):false})}else{a=this.get_node(e,true);s=this;if(a.length){if(e.children.length&&!this._firstChild(a.children(".jstree-children")[0])){e.state.opened=true;this.redraw_node(e,true);a=this.get_node(e,true)}if(!n){this.trigger("before_open",{node:e});a[0].className=a[0].className.replace("jstree-closed","jstree-open");a[0].setAttribute("aria-expanded",true)}else{this.trigger("before_open",{node:e});a.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",true).children(".jstree-children").stop(true,true).slideDown(n,function(){this.style.display="";s.trigger("after_open",{node:e})})}}e.state.opened=true;if(i){i.call(this,e,true)}if(!a.length){this.trigger("before_open",{node:e})}this.trigger("open_node",{node:e});if(!n||!a.length){this.trigger("after_open",{node:e})}}},_open_to:function(e){e=this.get_node(e);if(!e||e.id==="#"){return false}var t,i,n=e.parents;for(t=0,i=n.length;t<i;t+=1){if(t!=="#"){this.open_node(n[t],false,0)}}return T("#"+e.id.replace(T.jstree.idregex,"\\$&"),this.element)},close_node:function(e,t){var i,n,r,a;if(T.isArray(e)){e=e.slice();for(i=0,n=e.length;i<n;i++){this.close_node(e[i],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}if(this.is_closed(e)){return false}t=t===y?this.settings.core.animation:t;r=this;a=this.get_node(e,true);if(a.length){if(!t){a[0].className=a[0].className.replace("jstree-open","jstree-closed");a.attr("aria-expanded",false).children(".jstree-children").remove()}else{a.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",false).children(".jstree-children").stop(true,true).slideUp(t,function(){this.style.display="";a.children(".jstree-children").remove();r.trigger("after_close",{node:e})})}}e.state.opened=false;this.trigger("close_node",{node:e});if(!t||!a.length){this.trigger("after_close",{node:e})}},toggle_node:function(e){var t,i;if(T.isArray(e)){e=e.slice();for(t=0,i=e.length;t<i;t++){this.toggle_node(e[t])}return true}if(this.is_closed(e)){return this.open_node(e)}if(this.is_open(e)){return this.close_node(e)}},open_all:function(e,i,n){if(!e){e="#"}e=this.get_node(e);if(!e){return false}var t=e.id==="#"?this.get_container_ul():this.get_node(e,true),r,a,s;if(!t.length){for(r=0,a=e.children_d.length;r<a;r++){if(this.is_closed(this._model.data[e.children_d[r]])){this._model.data[e.children_d[r]].state.opened=true}}return this.trigger("open_all",{node:e})}n=n||t;s=this;t=this.is_closed(e)?t.find(".jstree-closed").addBack():t.find(".jstree-closed");t.each(function(){s.open_node(this,function(e,t){if(t&&this.is_parent(e)){this.open_all(e,i,n)}},i||0)});if(n.find(".jstree-closed").length===0){this.trigger("open_all",{node:this.get_node(n)})}},close_all:function(e,t){if(!e){e="#"}e=this.get_node(e);if(!e){return false}var i=e.id==="#"?this.get_container_ul():this.get_node(e,true),n=this,r,a;if(!i.length){for(r=0,a=e.children_d.length;r<a;r++){this._model.data[e.children_d[r]].state.opened=false}return this.trigger("close_all",{node:e})}i=this.is_open(e)?i.find(".jstree-open").addBack():i.find(".jstree-open");T(i.get().reverse()).each(function(){n.close_node(this,t||0)});this.trigger("close_all",{node:e})},is_disabled:function(e){e=this.get_node(e);return e&&e.state&&e.state.disabled},enable_node:function(e){var t,i;if(T.isArray(e)){e=e.slice();for(t=0,i=e.length;t<i;t++){this.enable_node(e[t])}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}e.state.disabled=false;this.get_node(e,true).children(".jstree-anchor").removeClass("jstree-disabled");this.trigger("enable_node",{node:e})},disable_node:function(e){var t,i;if(T.isArray(e)){e=e.slice();for(t=0,i=e.length;t<i;t++){this.disable_node(e[t])}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}e.state.disabled=true;this.get_node(e,true).children(".jstree-anchor").addClass("jstree-disabled");this.trigger("disable_node",{node:e})},activate_node:function(e,t){if(this.is_disabled(e)){return false}this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==y?this.get_node(this._data.core.last_clicked.id):null;if(this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected){this._data.core.last_clicked=null}if(!this._data.core.last_clicked&&this._data.core.selected.length){this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])}if(!this.settings.core.multiple||!t.metaKey&&!t.ctrlKey&&!t.shiftKey||t.shiftKey&&(!this._data.core.last_clicked||!this.get_parent(e)||this.get_parent(e)!==this._data.core.last_clicked.parent)){if(!this.settings.core.multiple&&(t.metaKey||t.ctrlKey||t.shiftKey)&&this.is_selected(e)){this.deselect_node(e,false,false,t)}else{this.deselect_all(true);this.select_node(e,false,false,t);this._data.core.last_clicked=this.get_node(e)}}else{if(t.shiftKey){var i=this.get_node(e).id,n=this._data.core.last_clicked.id,r=this.get_node(this._data.core.last_clicked.parent).children,a=false,s,o;for(s=0,o=r.length;s<o;s+=1){if(r[s]===i){a=!a}if(r[s]===n){a=!a}if(a||r[s]===i||r[s]===n){this.select_node(r[s],false,false,t)}else{this.deselect_node(r[s],false,false,t)}}}else{if(!this.is_selected(e)){this.select_node(e,false,false,t)}else{this.deselect_node(e,false,false,t)}}}this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){e=this.get_node(e,true);if(!e||!e.length||e.children(".jstree-hovered").length){return false}var t=this.element.find(".jstree-hovered"),i=this.element;if(t&&t.length){this.dehover_node(t)}e.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(e)});setTimeout(function(){i.attr("aria-activedescendant",e[0].id);e.attr("aria-selected",true)},0)},dehover_node:function(e){e=this.get_node(e,true);if(!e||!e.length||!e.children(".jstree-hovered").length){return false}e.attr("aria-selected",false).children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(e,t,i,n){var r,a,s,o;if(T.isArray(e)){e=e.slice();for(a=0,s=e.length;a<s;a++){this.select_node(e[a],t,i,n)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}r=this.get_node(e,true);if(!e.state.selected){e.state.selected=true;this._data.core.selected.push(e.id);if(!i){r=this._open_to(e)}if(r&&r.length){r.children(".jstree-anchor").addClass("jstree-clicked")}this.trigger("select_node",{node:e,selected:this._data.core.selected,event:n});if(!t){this.trigger("changed",{action:"select_node",node:e,selected:this._data.core.selected,event:n})}}},deselect_node:function(e,t,i){var n,r,a;if(T.isArray(e)){e=e.slice();for(n=0,r=e.length;n<r;n++){this.deselect_node(e[n],t,i)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}a=this.get_node(e,true);if(e.state.selected){e.state.selected=false;this._data.core.selected=T.vakata.array_remove_item(this._data.core.selected,e.id);if(a.length){a.children(".jstree-anchor").removeClass("jstree-clicked")}this.trigger("deselect_node",{node:e,selected:this._data.core.selected,event:i});if(!t){this.trigger("changed",{action:"deselect_node",node:e,selected:this._data.core.selected,event:i})}}},select_all:function(e){var t=this._data.core.selected.concat([]),i,n;this._data.core.selected=this._model.data["#"].children_d.concat();for(i=0,n=this._data.core.selected.length;i<n;i++){if(this._model.data[this._data.core.selected[i]]){this._model.data[this._data.core.selected[i]].state.selected=true}}this.redraw(true);this.trigger("select_all",{selected:this._data.core.selected});if(!e){this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:t})}},deselect_all:function(e){var t=this._data.core.selected.concat([]),i,n;for(i=0,n=this._data.core.selected.length;i<n;i++){if(this._model.data[this._data.core.selected[i]]){this._model.data[this._data.core.selected[i]].state.selected=false}}this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked");this.trigger("deselect_all",{selected:this._data.core.selected,node:t});if(!e){this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:t})}},is_selected:function(e){e=this.get_node(e);if(!e||e.id==="#"){return false}return e.state.selected},get_selected:function(e){return e?T.map(this._data.core.selected,T.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected},get_top_selected:function(e){var t=this.get_selected(true),i={},n,r,a,s;for(n=0,r=t.length;n<r;n++){i[t[n].id]=t[n]}for(n=0,r=t.length;n<r;n++){for(a=0,s=t[n].children_d.length;a<s;a++){if(i[t[n].children_d[a]]){delete i[t[n].children_d[a]]}}}t=[];for(n in i){if(i.hasOwnProperty(n)){t.push(n)}}return e?T.map(t,T.proxy(function(e){return this.get_node(e)},this)):t},get_bottom_selected:function(e){var t=this.get_selected(true),i=[],n,r;for(n=0,r=t.length;n<r;n++){if(!t[n].children.length){i.push(t[n].id)}}return e?T.map(i,T.proxy(function(e){return this.get_node(e)},this)):i},get_state:function(){var e={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},t;for(t in this._model.data){if(this._model.data.hasOwnProperty(t)){if(t!=="#"){if(this._model.data[t].state.opened){e.core.open.push(t)}if(this._model.data[t].state.selected){e.core.selected.push(t)}}}}return e},set_state:function(i,n){if(i){if(i.core){var r,a,s,o;if(i.core.open){if(!T.isArray(i.core.open)){delete i.core.open;this.set_state(i,n);return false}r=true;a=false;s=this;T.each(i.core.open.concat([]),function(e,t){a=s.get_node(t);if(a){if(s.is_loaded(t)){if(s.is_closed(t)){s.open_node(t,false,0)}if(i&&i.core&&i.core.open){T.vakata.array_remove_item(i.core.open,t)}}else{if(!s.is_loading(t)){s.open_node(t,T.proxy(function(e,t){if(!t&&i&&i.core&&i.core.open){T.vakata.array_remove_item(i.core.open,e.id)}this.set_state(i,n)},s),0)}r=false}}});if(r){delete i.core.open;this.set_state(i,n)}return false}if(i.core.scroll){if(i.core.scroll&&i.core.scroll.left!==y){this.element.scrollLeft(i.core.scroll.left)}if(i.core.scroll&&i.core.scroll.top!==y){this.element.scrollTop(i.core.scroll.top)}delete i.core.scroll;this.set_state(i,n);return false}if(i.core.selected){o=this;this.deselect_all();T.each(i.core.selected,function(e,t){o.select_node(t)});delete i.core.selected;this.set_state(i,n);return false}if(T.isEmptyObject(i.core)){delete i.core;this.set_state(i,n);return false}}if(T.isEmptyObject(i)){i=null;if(n){n.call(this)}this.trigger("set_state");return false}return true}return false},refresh:function(e){this._data.core.state=this.get_state();this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:false}}};var i=this.get_container_ul()[0].className;if(!e){this.element.html("<"+"ul class='jstree-container-ul jstree-children'><"+"li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>")}this.load_node("#",function(e,t){if(t){this.get_container_ul()[0].className=i;this.set_state(T.extend(true,{},this._data.core.state),function(){this.trigger("refresh")})}this._data.core.state=null});if(!e){this.element.find(".jstree-container-ul").attr("role","group")}},refresh_node:function(t){t=this.get_node(t);if(!t||t.id==="#"){return false}var e=[],i=this._data.core.selected.concat([]);if(t.state.opened===true){e.push(t.id)}this.get_node(t,true).find(".jstree-open").each(function(){e.push(this.id)});this._load_nodes(e,T.proxy(function(e){this.open_node(e,false,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(e,t){e=this.get_node(e);if(!e||e.id==="#"){return false}var i,n,r=this._model.data;t=t.toString();r[e.parent].children[T.inArray(e.id,r[e.parent].children)]=t;for(i=0,n=e.parents.length;i<n;i++){r[e.parents[i]].children_d[T.inArray(e.id,r[e.parents[i]].children_d)]=t}for(i=0,n=e.children.length;i<n;i++){r[e.children[i]].parent=t}for(i=0,n=e.children_d.length;i<n;i++){r[e.children_d[i]].parents[T.inArray(e.id,r[e.children_d[i]].parents)]=t}i=T.inArray(e.id,this._data.core.selected);if(i!==-1){this._data.core.selected[i]=t}i=this.get_node(e.id,true);if(i){i.attr("id",t)}delete r[e.id];e.id=t;r[t]=e;return true},get_text:function(e){e=this.get_node(e);return!e||e.id==="#"?false:e.text},set_text:function(e,t){var i,n,r,a;if(T.isArray(e)){e=e.slice();for(i=0,n=e.length;i<n;i++){this.set_text(e[i],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}e.text=t;r=this.get_node(e,true);if(r.length){r=r.children(".jstree-anchor:eq(0)");a=r.children("I").clone();r.html(t).prepend(a);this.trigger("set_text",{obj:e,text:t})}return true},get_json:function(e,t,i){e=this.get_node(e||"#");if(!e){return false}if(t&&t.flat&&!i){i=[]}var n={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:e.li_attr,a_attr:e.a_attr,state:{},data:t&&t.no_data?false:e.data},r,a;if(t&&t.flat){n.parent=e.parent}else{n.children=[]}if(!t||!t.no_state){for(r in e.state){if(e.state.hasOwnProperty(r)){n.state[r]=e.state[r]}}}if(t&&t.no_id){delete n.id;if(n.li_attr&&n.li_attr.id){delete n.li_attr.id}}if(t&&t.flat&&e.id!=="#"){i.push(n)}if(!t||!t.no_children){for(r=0,a=e.children.length;r<a;r++){if(t&&t.flat){this.get_json(e.children[r],t,i)}else{n.children.push(this.get_json(e.children[r],t))}}}return t&&t.flat?i:e.id==="#"?n.children:n},create_node:function(e,t,i,n,r){if(e===null){e="#"}e=this.get_node(e);if(!e){return false}i=i===y?"last":i;if(!i.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(e)){return this.load_node(e,function(){this.create_node(e,t,i,n,true)})}if(!t){t={text:this.get_string("New node")}}if(t.text===y){t.text=this.get_string("New node")}var a,s,o,l;if(e.id==="#"){if(i==="before"){i="first"}if(i==="after"){i="last"}}switch(i){case"before":a=this.get_node(e.parent);i=T.inArray(e.id,a.children);e=a;break;case"after":a=this.get_node(e.parent);i=T.inArray(e.id,a.children)+1;e=a;break;case"inside":case"first":i=0;break;case"last":i=e.children.length;break;default:if(!i){i=0}break}if(i>e.children.length){i=e.children.length}if(!t.id){t.id=true}if(!this.check("create_node",t,e,i)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(t.id===true){delete t.id}t=this._parse_model_from_json(t,e.id,e.parents.concat());if(!t){return false}a=this.get_node(t);s=[];s.push(t);s=s.concat(a.children_d);this.trigger("model",{nodes:s,parent:e.id});e.children_d=e.children_d.concat(s);for(o=0,l=e.parents.length;o<l;o++){this._model.data[e.parents[o]].children_d=this._model.data[e.parents[o]].children_d.concat(s)}t=a;a=[];for(o=0,l=e.children.length;o<l;o++){a[o>=i?o+1:o]=e.children[o]}a[i]=t.id;e.children=a;this.redraw_node(e,true);if(n){n.call(this,this.get_node(t))}this.trigger("create_node",{node:this.get_node(t),parent:e.id,position:i});return t.id},rename_node:function(e,t){var i,n,r;if(T.isArray(e)){e=e.slice();for(i=0,n=e.length;i<n;i++){this.rename_node(e[i],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}r=e.text;if(!this.check("rename_node",e,this.get_parent(e),t)){this.settings.core.error.call(this,this._data.core.last_error);return false}this.set_text(e,t);this.trigger("rename_node",{node:e,text:t,old:r});return true},delete_node:function(e){var t,i,n,r,a,s,o,l,c,u;if(T.isArray(e)){e=e.slice();for(t=0,i=e.length;t<i;t++){this.delete_node(e[t])}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}n=this.get_node(e.parent);r=T.inArray(e.id,n.children);u=false;if(!this.check("delete_node",e,n,r)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(r!==-1){n.children=T.vakata.array_remove(n.children,r)}a=e.children_d.concat([]);a.push(e.id);for(l=0,c=a.length;l<c;l++){for(s=0,o=e.parents.length;s<o;s++){r=T.inArray(a[l],this._model.data[e.parents[s]].children_d);if(r!==-1){this._model.data[e.parents[s]].children_d=T.vakata.array_remove(this._model.data[e.parents[s]].children_d,r)}}if(this._model.data[a[l]].state.selected){u=true;r=T.inArray(a[l],this._data.core.selected);if(r!==-1){this._data.core.selected=T.vakata.array_remove(this._data.core.selected,r)}}}this.trigger("delete_node",{node:e,parent:n.id});if(u){this.trigger("changed",{action:"delete_node",node:e,selected:this._data.core.selected,parent:n.id})}for(l=0,c=a.length;l<c;l++){delete this._model.data[a[l]]}this.redraw_node(n,true);return true},check:function(e,t,i,n,r){t=t&&t.id?t:this.get_node(t);i=i&&i.id?i:this.get_node(i);var a=e.match(/^move_node|copy_node|create_node$/i)?i:t,s=this.settings.core.check_callback;if(e==="move_node"||e==="copy_node"){if((!r||!r.is_multi)&&(t.id===i.id||T.inArray(t.id,i.children)===n||T.inArray(i.id,t.children_d)!==-1)){this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:e,pos:n,obj:t&&t.id?t.id:false,par:i&&i.id?i.id:false})};return false}}if(a&&a.data){a=a.data}if(a&&a.functions&&(a.functions[e]===false||a.functions[e]===true)){if(a.functions[e]===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+e,data:JSON.stringify({chk:e,pos:n,obj:t&&t.id?t.id:false,par:i&&i.id?i.id:false})}}return a.functions[e]}if(s===false||T.isFunction(s)&&s.call(this,e,t,i,n,r)===false||s&&s[e]===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+e,data:JSON.stringify({chk:e,pos:n,obj:t&&t.id?t.id:false,par:i&&i.id?i.id:false})};return false}return true},last_error:function(){return this._data.core.last_error},move_node:function(e,t,i,n,r){var a,s,o,l,c,u,d,h,f,p,g,m,v;if(T.isArray(e)){e=e.reverse().slice();for(a=0,s=e.length;a<s;a++){this.move_node(e[a],t,i,n,r)}return true}e=e&&e.id?e:this.get_node(e);t=this.get_node(t);i=i===y?0:i;if(!t||!e||e.id==="#"){return false}if(!i.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(t)){return this.load_node(t,function(){this.move_node(e,t,i,n,true)})}o=(e.parent||"#").toString();l=!i.toString().match(/^(before|after)$/)||t.id==="#"?t:this.get_node(t.parent);c=e.instance?e.instance:this._model.data[e.id]?this:T.jstree.reference(e.id);u=!c||!c._id||this._id!==c._id;if(u){if(this.copy_node(e,t,i,n,r)){if(c){c.delete_node(e)}return true}return false}if(l.id==="#"){if(i==="before"){i="first"}if(i==="after"){i="last"}}switch(i){case"before":i=T.inArray(t.id,l.children);break;case"after":i=T.inArray(t.id,l.children)+1;break;case"inside":case"first":i=0;break;case"last":i=l.children.length;break;default:if(!i){i=0}break}if(i>l.children.length){i=l.children.length}if(!this.check("move_node",e,l,i,{core:true,is_multi:c&&c._id&&c._id!==this._id,is_foreign:!c||!c._id})){this.settings.core.error.call(this,this._data.core.last_error);return false}if(e.parent===l.id){d=l.children.concat();h=T.inArray(e.id,d);if(h!==-1){d=T.vakata.array_remove(d,h);if(i>h){i--}}h=[];for(f=0,p=d.length;f<p;f++){h[f>=i?f+1:f]=d[f]}h[i]=e.id;l.children=h;this._node_changed(l.id);this.redraw(l.id==="#")}else{h=e.children_d.concat();h.push(e.id);for(f=0,p=e.parents.length;f<p;f++){d=[];v=c._model.data[e.parents[f]].children_d;for(g=0,m=v.length;g<m;g++){if(T.inArray(v[g],h)===-1){d.push(v[g])}}c._model.data[e.parents[f]].children_d=d}c._model.data[o].children=T.vakata.array_remove_item(c._model.data[o].children,e.id);for(f=0,p=l.parents.length;f<p;f++){this._model.data[l.parents[f]].children_d=this._model.data[l.parents[f]].children_d.concat(h)}d=[];for(f=0,p=l.children.length;f<p;f++){d[f>=i?f+1:f]=l.children[f]}d[i]=e.id;l.children=d;l.children_d.push(e.id);l.children_d=l.children_d.concat(e.children_d);e.parent=l.id;h=l.parents.concat();h.unshift(l.id);v=e.parents.length;e.parents=h;h=h.concat();for(f=0,p=e.children_d.length;f<p;f++){this._model.data[e.children_d[f]].parents=this._model.data[e.children_d[f]].parents.slice(0,v*-1);Array.prototype.push.apply(this._model.data[e.children_d[f]].parents,h)}this._node_changed(o);this._node_changed(l.id);this.redraw(o==="#"||l.id==="#")}if(n){n.call(this,e,l,i)}this.trigger("move_node",{node:e,parent:l.id,position:i,old_parent:o,is_multi:c&&c._id&&c._id!==this._id,is_foreign:!c||!c._id,old_instance:c,new_instance:this});return true},copy_node:function(e,t,i,n,r){var a,s,o,l,c,u,d,h,f,p,g;if(T.isArray(e)){e=e.reverse().slice();for(a=0,s=e.length;a<s;a++){this.copy_node(e[a],t,i,n,r)}return true}e=e&&e.id?e:this.get_node(e);t=this.get_node(t);i=i===y?0:i;if(!t||!e||e.id==="#"){return false}if(!i.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(t)){return this.load_node(t,function(){this.copy_node(e,t,i,n,true)})}h=(e.parent||"#").toString();f=!i.toString().match(/^(before|after)$/)||t.id==="#"?t:this.get_node(t.parent);p=e.instance?e.instance:this._model.data[e.id]?this:T.jstree.reference(e.id);g=!p||!p._id||this._id!==p._id;if(f.id==="#"){if(i==="before"){i="first"}if(i==="after"){i="last"}}switch(i){case"before":i=T.inArray(t.id,f.children);break;case"after":i=T.inArray(t.id,f.children)+1;break;case"inside":case"first":i=0;break;case"last":i=f.children.length;break;default:if(!i){i=0}break}if(i>f.children.length){i=f.children.length}if(!this.check("copy_node",e,f,i,{core:true,is_multi:p&&p._id&&p._id!==this._id,is_foreign:!p||!p._id})){this.settings.core.error.call(this,this._data.core.last_error);return false}d=p?p.get_json(e,{no_id:true,no_data:true,no_state:true}):e;if(!d){return false}if(d.id===true){delete d.id}d=this._parse_model_from_json(d,f.id,f.parents.concat());if(!d){return false}l=this.get_node(d);if(e&&e.state&&e.state.loaded===false){l.state.loaded=false}o=[];o.push(d);o=o.concat(l.children_d);this.trigger("model",{nodes:o,parent:f.id});for(c=0,u=f.parents.length;c<u;c++){this._model.data[f.parents[c]].children_d=this._model.data[f.parents[c]].children_d.concat(o)}o=[];for(c=0,u=f.children.length;c<u;c++){o[c>=i?c+1:c]=f.children[c]}o[i]=l.id;f.children=o;f.children_d.push(l.id);f.children_d=f.children_d.concat(l.children_d);this._node_changed(f.id);this.redraw(f.id==="#");if(n){n.call(this,l,f,i)}this.trigger("copy_node",{node:l,original:e,parent:f.id,position:i,old_parent:h,is_multi:p&&p._id&&p._id!==this._id,is_foreign:!p||!p._id,old_instance:p,new_instance:this});return l.id},cut:function(e){if(!e){e=this._data.core.selected.concat()}if(!T.isArray(e)){e=[e]}if(!e.length){return false}var t=[],i,n,r;for(n=0,r=e.length;n<r;n++){i=this.get_node(e[n]);if(i&&i.id&&i.id!=="#"){t.push(i)}}if(!t.length){return false}a=t;o=this;s="move_node";this.trigger("cut",{node:e})},copy:function(e){if(!e){e=this._data.core.selected.concat()}if(!T.isArray(e)){e=[e]}if(!e.length){return false}var t=[],i,n,r;for(n=0,r=e.length;n<r;n++){i=this.get_node(e[n]);if(i&&i.id&&i.id!=="#"){t.push(i)}}if(!t.length){return false}a=t;o=this;s="copy_node";this.trigger("copy",{node:e})},get_buffer:function(){return{mode:s,node:a,inst:o}},can_paste:function(){return s!==false&&a!==false},paste:function(e,t){e=this.get_node(e);if(!e||!s||!s.match(/^(copy_node|move_node)$/)||!a){return false}if(this[s](a,e,t)){this.trigger("paste",{parent:e.id,node:a,mode:s})}a=false;s=false;o=false},edit:function(i,e){i=this._open_to(i);if(!i||!i.length){return false}var t=this._data.core.rtl,n=this.element.width(),r=i.children(".jstree-anchor"),a=T("<span>"),s=typeof e==="string"?e:this.get_text(i),o=T("<"+"div />",{css:{position:"absolute",top:"-200px",left:t?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=T("<"+"input />",{value:s,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:T.proxy(function(){var e=a.children(".jstree-rename-input"),t=e.val();if(t===""){t=s}o.remove();a.replaceWith(r);a.remove();this.set_text(i,s);if(this.rename_node(i,t)===false){this.set_text(i,s)}},this),keydown:function(e){var t=e.which;if(t===27){this.value=s}if(t===27||t===13||t===37||t===38||t===39||t===40||t===32){e.stopImmediatePropagation()}if(t===27||t===13){e.preventDefault();this.blur()}},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){l.width(Math.min(o.text("pW"+this.value).width(),n))},keypress:function(e){if(e.which===13){return false}}}),c={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};this.set_text(i,"");a.attr("class",r.attr("class")).append(r.contents().clone()).append(l);r.replaceWith(a);o.css(c);l.css(c).width(Math.min(o.text("pW"+l[0].value).width(),n))[0].select()},set_theme:function(e,t){if(!e){return false}if(t===true){var i=this.settings.core.themes.dir;if(!i){i=T.jstree.path+"/themes"}t=i+"/"+e+"/style.css"}if(t&&T.inArray(t,n)===-1){T("head").append("<"+'link rel="stylesheet" href="'+t+'" type="text/css" />');n.push(t)}if(this._data.core.themes.name){this.element.removeClass("jstree-"+this._data.core.themes.name)}this._data.core.themes.name=e;this.element.addClass("jstree-"+e);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+e+"-responsive");this.trigger("set_theme",{theme:e})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){if(this._data.core.themes.variant){this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}this._data.core.themes.variant=e;if(e){this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=true;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=false;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){if(this._data.core.themes.stripes){this.hide_stripes()}else{this.show_stripes()}},show_dots:function(){this._data.core.themes.dots=true;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=false;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){if(this._data.core.themes.dots){this.hide_dots()}else{this.show_dots()}},show_icons:function(){this._data.core.themes.icons=true;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=false;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){if(this._data.core.themes.icons){this.hide_icons()}else{this.show_icons()}},set_icon:function(e,t){var i,n,r,a;if(T.isArray(e)){e=e.slice();for(i=0,n=e.length;i<n;i++){this.set_icon(e[i],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}a=e.icon;e.icon=t;r=this.get_node(e,true).children(".jstree-anchor").children(".jstree-themeicon");if(t===false){this.hide_icon(e)}else if(t===true){r.removeClass("jstree-themeicon-custom "+a).css("background","").removeAttr("rel")}else if(t.indexOf("/")===-1&&t.indexOf(".")===-1){r.removeClass(a).css("background","");r.addClass(t+" jstree-themeicon-custom").attr("rel",t)}else{r.removeClass(a).css("background","");r.addClass("jstree-themeicon-custom").css("background","url('"+t+"') center center no-repeat").attr("rel",t)}return true},get_icon:function(e){e=this.get_node(e);return!e||e.id==="#"?false:e.icon},hide_icon:function(e){var t,i;if(T.isArray(e)){e=e.slice();for(t=0,i=e.length;t<i;t++){this.hide_icon(e[t])}return true}e=this.get_node(e);if(!e||e==="#"){return false}e.icon=false;this.get_node(e,true).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return true},show_icon:function(e){var t,i,n;if(T.isArray(e)){e=e.slice();for(t=0,i=e.length;t<i;t++){this.show_icon(e[t])}return true}e=this.get_node(e);if(!e||e==="#"){return false}n=this.get_node(e,true);e.icon=n.length?n.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):true;if(!e.icon){e.icon=true}n.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return true}};T.vakata={};T.vakata.attributes=function(e,i){e=T(e)[0];var n=i?{}:[];if(e&&e.attributes){T.each(e.attributes,function(e,t){if(T.inArray(t.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])!==-1){return}if(t.nodeValue!==null&&T.trim(t.nodeValue)!==""){if(i){n[t.nodeName]=t.nodeValue}else{n.push(t.nodeName)}}})}return n};T.vakata.array_unique=function(e){var t=[],i,n,r;for(i=0,r=e.length;i<r;i++){for(n=0;n<=i;n++){if(e[i]===e[n]){break}}if(n===i){t.push(e[i])}}return t};T.vakata.array_remove=function(e,t,i){var n=e.slice((i||t)+1||e.length);e.length=t<0?e.length+t:t;e.push.apply(e,n);return e};T.vakata.array_remove_item=function(e,t){var i=T.inArray(t,e);return i!==-1?T.vakata.array_remove(e,i):e};(function(){var e={},t=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},i=t(window.navigator.userAgent);if(i.browser){e[i.browser]=true;e.version=i.version}if(e.chrome){e.webkit=true}else if(e.webkit){e.safari=true}T.vakata.browser=e})();if(T.vakata.browser.msie&&T.vakata.browser.version<8){T.jstree.defaults.core.animation=0}var c=document.createElement("I");c.className="jstree-icon jstree-checkbox";T.jstree.defaults.checkbox={visible:true,three_state:true,whole_node:true,keep_selected_style:true};T.jstree.plugins.checkbox=function(e,s){this.bind=function(){s.bind.call(this);this._data.checkbox.uto=false;this.element.on("init.jstree",T.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;if(!this.settings.checkbox.keep_selected_style){this.element.addClass("jstree-checkbox-no-clicked")}},this)).on("loading.jstree",T.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.three_state){this.element.on("changed.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",T.proxy(function(){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(T.proxy(this._undetermined,this),50)},this)).on("model.jstree",T.proxy(function(e,t){var i=this._model.data,n=i[t.parent],r=t.nodes,a=[],s,o,l,c,u,d;if(n.state.selected){for(o=0,l=r.length;o<l;o++){i[r[o]].state.selected=true}this._data.core.selected=this._data.core.selected.concat(r)}else{for(o=0,l=r.length;o<l;o++){if(i[r[o]].state.selected){for(c=0,u=i[r[o]].children_d.length;c<u;c++){i[i[r[o]].children_d[c]].state.selected=true}this._data.core.selected=this._data.core.selected.concat(i[r[o]].children_d)}}}for(o=0,l=n.children_d.length;o<l;o++){if(!i[n.children_d[o]].children.length){a.push(i[n.children_d[o]].parent)}}a=T.vakata.array_unique(a);for(c=0,u=a.length;c<u;c++){n=i[a[c]];while(n&&n.id!=="#"){s=0;for(o=0,l=n.children.length;o<l;o++){s+=i[n.children[o]].state.selected}if(s===l){n.state.selected=true;this._data.core.selected.push(n.id);d=this.get_node(n,true);if(d&&d.length){d.children(".jstree-anchor").addClass("jstree-clicked")}}else{break}n=this.get_node(n.parent)}}this._data.core.selected=T.vakata.array_unique(this._data.core.selected)},this)).on("select_node.jstree",T.proxy(function(e,t){var i=t.node,n=this._model.data,r=this.get_node(i.parent),a=this.get_node(i,true),s,o,l,c;this._data.core.selected=T.vakata.array_unique(this._data.core.selected.concat(i.children_d));for(s=0,o=i.children_d.length;s<o;s++){c=n[i.children_d[s]];c.state.selected=true;if(c&&c.original&&c.original.state&&c.original.state.undetermined){c.original.state.undetermined=false}}while(r&&r.id!=="#"){l=0;for(s=0,o=r.children.length;s<o;s++){l+=n[r.children[s]].state.selected}if(l===o){r.state.selected=true;this._data.core.selected.push(r.id);c=this.get_node(r,true);if(c&&c.length){c.children(".jstree-anchor").addClass("jstree-clicked")}}else{break}r=this.get_node(r.parent)}if(a.length){a.find(".jstree-anchor").addClass("jstree-clicked")}},this)).on("deselect_all.jstree",T.proxy(function(e,t){var i=this.get_node("#"),n=this._model.data,r,a,s;for(r=0,a=i.children_d.length;r<a;r++){s=n[i.children_d[r]];if(s&&s.original&&s.original.state&&s.original.state.undetermined){s.original.state.undetermined=false}}},this)).on("deselect_node.jstree",T.proxy(function(e,t){var i=t.node,n=this.get_node(i,true),r,a,s;if(i&&i.original&&i.original.state&&i.original.state.undetermined){i.original.state.undetermined=false}for(r=0,a=i.children_d.length;r<a;r++){s=this._model.data[i.children_d[r]];s.state.selected=false;if(s&&s.original&&s.original.state&&s.original.state.undetermined){s.original.state.undetermined=false}}for(r=0,a=i.parents.length;r<a;r++){s=this._model.data[i.parents[r]];s.state.selected=false;if(s&&s.original&&s.original.state&&s.original.state.undetermined){s.original.state.undetermined=false}s=this.get_node(i.parents[r],true);if(s&&s.length){s.children(".jstree-anchor").removeClass("jstree-clicked")}}s=[];for(r=0,a=this._data.core.selected.length;r<a;r++){if(T.inArray(this._data.core.selected[r],i.children_d)===-1&&T.inArray(this._data.core.selected[r],i.parents)===-1){s.push(this._data.core.selected[r])}}this._data.core.selected=T.vakata.array_unique(s);if(n.length){n.find(".jstree-anchor").removeClass("jstree-clicked")}},this)).on("delete_node.jstree",T.proxy(function(e,t){var i=this.get_node(t.parent),n=this._model.data,r,a,s,o;while(i&&i.id!=="#"){s=0;for(r=0,a=i.children.length;r<a;r++){s+=n[i.children[r]].state.selected}if(s===a){i.state.selected=true;this._data.core.selected.push(i.id);o=this.get_node(i,true);if(o&&o.length){o.children(".jstree-anchor").addClass("jstree-clicked")}}else{break}i=this.get_node(i.parent)}},this)).on("move_node.jstree",T.proxy(function(e,t){var i=t.is_multi,n=t.old_parent,r=this.get_node(t.parent),a=this._model.data,s,o,l,c,u;if(!i){s=this.get_node(n);while(s&&s.id!=="#"){o=0;for(l=0,c=s.children.length;l<c;l++){o+=a[s.children[l]].state.selected}if(o===c){s.state.selected=true;this._data.core.selected.push(s.id);u=this.get_node(s,true);if(u&&u.length){u.children(".jstree-anchor").addClass("jstree-clicked")}}else{break}s=this.get_node(s.parent)}}s=r;while(s&&s.id!=="#"){o=0;for(l=0,c=s.children.length;l<c;l++){o+=a[s.children[l]].state.selected}if(o===c){if(!s.state.selected){s.state.selected=true;this._data.core.selected.push(s.id);u=this.get_node(s,true);if(u&&u.length){u.children(".jstree-anchor").addClass("jstree-clicked")}}}else{if(s.state.selected){s.state.selected=false;this._data.core.selected=T.vakata.array_remove_item(this._data.core.selected,s.id);u=this.get_node(s,true);if(u&&u.length){u.children(".jstree-anchor").removeClass("jstree-clicked")}}else{break}}s=this.get_node(s.parent)}},this))}};this._undetermined=function(){var i,n,r=this._model.data,e=this._data.core.selected,a=[],s=this;for(i=0,n=e.length;i<n;i++){if(r[e[i]]&&r[e[i]].parents){a=a.concat(r[e[i]].parents)}}this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e=s.get_node(this),t;if(!e.state.loaded){if(e.original&&e.original.state&&e.original.state.undetermined&&e.original.state.undetermined===true){a.push(e.id);a=a.concat(e.parents)}}else{for(i=0,n=e.children_d.length;i<n;i++){t=r[e.children_d[i]];if(!t.state.loaded&&t.original&&t.original.state&&t.original.state.undetermined&&t.original.state.undetermined===true){a.push(t.id);a=a.concat(t.parents)}}}});a=T.vakata.array_unique(a);a=T.vakata.array_remove_item(a,"#");this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");for(i=0,n=a.length;i<n;i++){if(!r[a[i]].state.selected){e=this.get_node(a[i],true);if(e&&e.length){e.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}}}};this.redraw_node=function(e,t,i){e=s.redraw_node.call(this,e,t,i);if(e){var n,r,a=null;for(n=0,r=e.childNodes.length;n<r;n++){if(e.childNodes[n]&&e.childNodes[n].className&&e.childNodes[n].className.indexOf("jstree-anchor")!==-1){a=e.childNodes[n];break}}if(a){a.insertBefore(c.cloneNode(false),a.childNodes[0])}}if(!i&&this.settings.checkbox.three_state){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(T.proxy(this._undetermined,this),50)}return e};this.activate_node=function(e,t){if(this.settings.checkbox.whole_node||T(t.target).hasClass("jstree-checkbox")){t.ctrlKey=true}return s.activate_node.call(this,e,t)};this.show_checkboxes=function(){this._data.core.themes.checkboxes=true;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=false;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){if(this._data.core.themes.checkboxes){this.hide_checkboxes()}else{this.show_checkboxes()}}};T.jstree.defaults.contextmenu={select_node:true,show_at_node:true,items:function(e,t){return{create:{separator_before:false,separator_after:true,_disabled:false,label:"Create",action:function(e){var t=T.jstree.reference(e.reference),i=t.get_node(e.reference);t.create_node(i,{},"last",function(e){setTimeout(function(){t.edit(e)},0)})}},rename:{separator_before:false,separator_after:false,_disabled:false,label:"Rename",action:function(e){var t=T.jstree.reference(e.reference),i=t.get_node(e.reference);t.edit(i)}},remove:{separator_before:false,icon:false,separator_after:false,_disabled:false,label:"Delete",action:function(e){var t=T.jstree.reference(e.reference),i=t.get_node(e.reference);if(t.is_selected(i)){t.delete_node(t.get_selected())}else{t.delete_node(i)}}},ccp:{separator_before:true,icon:false,separator_after:false,label:"Edit",action:false,submenu:{cut:{separator_before:false,separator_after:false,label:"Cut",action:function(e){var t=T.jstree.reference(e.reference),i=t.get_node(e.reference);if(t.is_selected(i)){t.cut(t.get_selected())}else{t.cut(i)}}},copy:{separator_before:false,icon:false,separator_after:false,label:"Copy",action:function(e){var t=T.jstree.reference(e.reference),i=t.get_node(e.reference);if(t.is_selected(i)){t.copy(t.get_selected())}else{t.copy(i)}}},paste:{separator_before:false,icon:false,_disabled:function(e){return!T.jstree.reference(e.reference).can_paste()},separator_after:false,label:"Paste",action:function(e){var t=T.jstree.reference(e.reference),i=t.get_node(e.reference);t.paste(i)}}}}}}};T.jstree.plugins.contextmenu=function(e,i){this.bind=function(){i.bind.call(this);var t=0;this.element.on("contextmenu.jstree",".jstree-anchor",T.proxy(function(e){e.preventDefault();t=e.ctrlKey?e.timeStamp:0;if(!this.is_loading(e.currentTarget)){this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)}},this)).on("click.jstree",".jstree-anchor",T.proxy(function(e){if(this._data.contextmenu.visible&&(!t||e.timeStamp-t>250)){T.vakata.context.hide()}},this));T(document).on("context_hide.vakata",T.proxy(function(){this._data.contextmenu.visible=false},this))};this.teardown=function(){if(this._data.contextmenu.visible){T.vakata.context.hide()}i.teardown.call(this)};this.show_contextmenu=function(t,i,n,e){t=this.get_node(t);if(!t||t.id==="#"){return false}var r=this.settings.contextmenu,a=this.get_node(t,true),s=a.children(".jstree-anchor"),o=false,l=false;if(r.show_at_node||i===y||n===y){o=s.offset();i=o.left;n=o.top+this._data.core.li_height}if(this.settings.contextmenu.select_node&&!this.is_selected(t)){this.deselect_all();this.select_node(t,false,false,e)}l=r.items;if(T.isFunction(l)){l=l.call(this,t,T.proxy(function(e){this._show_contextmenu(t,i,n,e)},this))}if(T.isPlainObject(l)){this._show_contextmenu(t,i,n,l)}};this._show_contextmenu=function(e,t,i,n){var r=this.get_node(e,true),a=r.children(".jstree-anchor");T(document).one("context_show.vakata",T.proxy(function(e,t){var i="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";T(t.element).addClass(i)},this));this._data.contextmenu.visible=true;T.vakata.context.show(a,{x:t,y:i},n);this.trigger("show_contextmenu",{node:e,x:t,y:i})}};(function(h){var f=false,p={element:false,reference:false,position_x:0,position_y:0,items:[],html:"",is_visible:false};h.vakata.context={settings:{hide_onmouseleave:0,icons:true},_trigger:function(e){h(document).triggerHandler("context_"+e+".vakata",{reference:p.reference,element:p.element,position:{x:p.position_x,y:p.position_y}})},_execute:function(e){e=p.items[e];return e&&(!e._disabled||h.isFunction(e._disabled)&&!e._disabled({item:e,reference:p.reference,element:p.element}))&&e.action?e.action.call(null,{item:e,reference:p.reference,element:p.element,position:{x:p.position_x,y:p.position_y}}):false},_parse:function(e,t){if(!e){return false}if(!t){p.html="";p.items=[]}var i="",n=false,r;if(t){i+="<"+"ul>"}h.each(e,function(e,t){if(!t){return true}p.items.push(t);if(!n&&t.separator_before){i+="<"+"li class='vakata-context-separator'><"+"a href='#' "+(h.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<"+"/a><"+"/li>"}n=false;i+="<"+"li class='"+(t._class||"")+(t._disabled===true||h.isFunction(t._disabled)&&t._disabled({item:t,reference:p.reference,element:p.element})?" vakata-contextmenu-disabled ":"")+"' "+(t.shortcut?" data-shortcut='"+t.shortcut+"' ":"")+">";i+="<"+"a href='#' rel='"+(p.items.length-1)+"'>";if(h.vakata.context.settings.icons){i+="<"+"i ";if(t.icon){if(t.icon.indexOf("/")!==-1||t.icon.indexOf(".")!==-1){i+=" style='background:url(\""+t.icon+"\") center center no-repeat' "}else{i+=" class='"+t.icon+"' "}}i+="><"+"/i><"+"span class='vakata-contextmenu-sep'>&#160;<"+"/span>"}i+=(h.isFunction(t.label)?t.label({item:e,reference:p.reference,element:p.element}):t.label)+(t.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+t.shortcut+'">'+(t.shortcut_label||"")+"</span>":"")+"<"+"/a>";if(t.submenu){r=h.vakata.context._parse(t.submenu,true);if(r){i+=r}}i+="<"+"/li>";if(t.separator_after){i+="<"+"li class='vakata-context-separator'><"+"a href='#' "+(h.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<"+"/a><"+"/li>";n=true}});i=i.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");if(t){i+="</ul>"}if(!t){p.html=i;h.vakata.context._trigger("parse")}return i.length>10?i:false},_show_submenu:function(e){e=h(e);if(!e.length||!e.children("ul").length){return}var t=e.children("ul"),i=e.offset().left+e.outerWidth(),n=e.offset().top,r=t.width(),a=t.height(),s=h(window).width()+h(window).scrollLeft(),o=h(window).height()+h(window).scrollTop();if(f){e[i-(r+10+e.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left")}else{e[i+r+10>s?"addClass":"removeClass"]("vakata-context-right")}if(n+a+10>o){t.css("bottom","-1px")}t.show()},show:function(e,t,i){var n,r,a,s,o,l,c,u,d=true;if(p.element&&p.element.length){p.element.width("")}switch(d){case!t&&!e:return false;case!!t&&!!e:p.reference=e;p.position_x=t.x;p.position_y=t.y;break;case!t&&!!e:p.reference=e;n=e.offset();p.position_x=n.left+e.outerHeight();p.position_y=n.top;break;case!!t&&!e:p.position_x=t.x;p.position_y=t.y;break}if(!!e&&!i&&h(e).data("vakata_contextmenu")){i=h(e).data("vakata_contextmenu")}if(h.vakata.context._parse(i)){p.element.html(p.html)}if(p.items.length){r=p.element;a=p.position_x;s=p.position_y;o=r.width();l=r.height();c=h(window).width()+h(window).scrollLeft();u=h(window).height()+h(window).scrollTop();if(f){a-=r.outerWidth();if(a<h(window).scrollLeft()+20){a=h(window).scrollLeft()+20}}if(a+o+20>c){a=c-(o+20)}if(s+l+20>u){s=u-(l+20)}p.element.css({left:a,top:s}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover");p.is_visible=true;h.vakata.context._trigger("show")}},hide:function(){if(p.is_visible){p.element.hide().find("ul").hide().end().find(":focus").blur();p.is_visible=false;h.vakata.context._trigger("hide")}}};h(function(){f=h("body").css("direction")==="rtl";var t=false;p.element=h("<ul class='vakata-context'></ul>");p.element.on("mouseenter","li",function(e){e.stopImmediatePropagation();if(h.contains(this,e.relatedTarget)){return}if(t){clearTimeout(t)}p.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end();h(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover");h.vakata.context._show_submenu(this)}).on("mouseleave","li",function(e){if(h.contains(this,e.relatedTarget)){return}h(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(e){h(this).find(".vakata-context-hover").removeClass("vakata-context-hover");if(h.vakata.context.settings.hide_onmouseleave){t=setTimeout(function(e){return function(){h.vakata.context.hide()}}(this),h.vakata.context.settings.hide_onmouseleave)}}).on("click","a",function(e){e.preventDefault()}).on("mouseup","a",function(e){if(!h(this).blur().parent().hasClass("vakata-context-disabled")&&h.vakata.context._execute(h(this).attr("rel"))!==false){h.vakata.context.hide()}}).on("keydown","a",function(e){var t=null;switch(e.which){case 13:case 32:e.type="mouseup";e.preventDefault();h(e.currentTarget).trigger(e);break;case 37:if(p.is_visible){p.element.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus();e.stopImmediatePropagation();e.preventDefault()}break;case 38:if(p.is_visible){t=p.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first();if(!t.length){t=p.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()}t.addClass("vakata-context-hover").children("a").focus();e.stopImmediatePropagation();e.preventDefault()}break;case 39:if(p.is_visible){p.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus();e.stopImmediatePropagation();e.preventDefault()}break;case 40:if(p.is_visible){t=p.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first();if(!t.length){t=p.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()}t.addClass("vakata-context-hover").children("a").focus();e.stopImmediatePropagation();e.preventDefault()}break;case 27:h.vakata.context.hide();e.preventDefault();break;default:break}}).on("keydown",function(e){e.preventDefault();var t=p.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();if(t.parent().not(".vakata-context-disabled")){t.mouseup()}}).appendTo("body");h(document).on("mousedown",function(e){if(p.is_visible&&!h.contains(p.element[0],e.target)){h.vakata.context.hide()}}).on("context_show.vakata",function(e,t){p.element.find("li:has(ul)").children("a").addClass("vakata-context-parent");if(f){p.element.addClass("vakata-context-rtl").css("direction","rtl")}p.element.find("ul").hide().end()})})})(T);T.jstree.defaults.dnd={copy:true,open_timeout:500,is_draggable:true,check_while_dragging:true,always_copy:false};T.jstree.plugins.dnd=function(e,t){this.bind=function(){t.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",T.proxy(function(e){var t=this.get_node(e.target),i=this.is_selected(t)?this.get_selected().length:1;if(t&&t.id&&t.id!=="#"&&(e.which===1||e.type==="touchstart")&&(this.settings.dnd.is_draggable===true||T.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,i>1?this.get_selected(true):[t]))){this.element.trigger("mousedown.jstree");return T.vakata.dnd.start(e,{jstree:true,origin:this,obj:this.get_node(t,true),nodes:i>1?this.get_selected():[t.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+'"><i class="jstree-icon jstree-er"></i>'+(i>1?i+" "+this.get_string("nodes"):this.get_text(e.currentTarget,true))+'<ins class="jstree-copy" style="display:none;">+</ins></div>')}},this))}};T(function(){var b=false,w=false,x=false,C=T('<div id="jstree-marker">&#160;</div>').hide().appendTo("body");T(document).bind("dnd_start.vakata",function(e,t){b=false}).bind("dnd_move.vakata",function(e,i){if(x){clearTimeout(x)}if(!i.data.jstree){return}T(".jstree-container-ul li.jstree-node").removeClass("highlight-li top-border bottom-border");if(i.event.target.id&&i.event.target.id==="jstree-marker"){return}var n=T.jstree.reference(i.event.target),r=false,a=false,t=false,s,o,l,c,u,d,h,f,p,g,m,v,y,_;if(n&&n._data&&n._data.dnd){C.attr("class","jstree-"+n.get_theme());i.helper.children().attr("class","jstree-"+n.get_theme()).find(".jstree-copy:eq(0)")[i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?"show":"hide"]();if((i.event.target===n.element[0]||i.event.target===n.get_container_ul()[0])&&n.get_container_ul().children().length===0){p=true;for(g=0,m=i.data.nodes.length;g<m;g++){p=p&&n.check(i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?"copy_node":"move_node",i.data.origin&&i.data.origin!==n?i.data.origin.get_node(i.data.nodes[g]):i.data.nodes[g],"#","last",{dnd:true,ref:n.get_node("#"),pos:"i",is_multi:i.data.origin&&i.data.origin!==n,is_foreign:!i.data.origin});if(!p){break}}if(p){b={ins:n,par:"#",pos:"last"};C.hide();i.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok");return}}else{r=T(i.event.target).closest(".jstree-anchor");if(r&&r.length&&r.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")){a=r.offset();t=i.event.pageY-a.top;u=r.height(),o=r.closest("li.jstree-node"),s=o.attr("rel");if(t<u/3){o.addClass("top-border");f=["b","i","a"]}else if(t>u-u/3){o.addClass("bottom-border");f=["a","i","b"]}else{if(s==="folder")o.addClass("highlight-li");f=t>u/2?["i","a","b"]:["i","b","a"]}T.each(f,function(e,t){switch(t){case"b":l=a.left-6;c=a.top-5;d=n.get_parent(r);h=r.parent().index();break;case"i":l=a.left-2;c=a.top-5+u/2+1;d=n.get_node(r.parent()).id;h=0;break;case"a":l=a.left-6;c=a.top-5+u;d=n.get_parent(r);h=r.parent().index()+1;break}p=true;for(g=0,m=i.data.nodes.length;g<m;g++){v=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?"copy_node":"move_node";y=h;if(v==="move_node"&&t==="a"&&(i.data.origin&&i.data.origin===n)&&d===n.get_parent(i.data.nodes[g])){_=n.get_node(d);if(y>T.inArray(i.data.nodes[g],_.children)){y-=1}}p=p&&(n&&n.settings&&n.settings.dnd&&n.settings.dnd.check_while_dragging===false||n.check(v,i.data.origin&&i.data.origin!==n?i.data.origin.get_node(i.data.nodes[g]):i.data.nodes[g],d,y,{dnd:true,ref:n.get_node(r.parent()),pos:t,is_multi:i.data.origin&&i.data.origin!==n,is_foreign:!i.data.origin}));if(!p){if(n&&n.last_error){w=n.last_error()}break}}if(p){if(t==="i"&&r.parent().is(".jstree-closed")&&n.settings.dnd.open_timeout){x=setTimeout(function(e,t){return function(){e.open_node(t)}}(n,r),n.settings.dnd.open_timeout)}b={ins:n,par:d,pos:h};C.css({left:l+"px",top:c+"px"}).show();i.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok");w={};f=true;return false}});if(f===true){return}}}}b=false;i.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");C.hide()}).bind("dnd_scroll.vakata",function(e,t){if(!t.data.jstree){return}C.hide();b=false;t.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er")}).bind("dnd_stop.vakata",function(e,t){if(x){clearTimeout(x)}if(!t.data.jstree){return}C.hide();var i,n,r=[];if(b){for(i=0,n=t.data.nodes.length;i<n;i++){r[i]=t.data.origin?t.data.origin.get_node(t.data.nodes[i]):t.data.nodes[i];if(t.data.origin){r[i].instance=t.data.origin}}b.ins[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(t.event.metaKey||t.event.ctrlKey))?"copy_node":"move_node"](r,b.par,b.pos)}else{i=T(t.event.target).closest(".jstree");if(i.length&&w&&w.error&&w.error==="check"){i=i.jstree(true);if(i){i.settings.core.error.call(this,w)}}}}).bind("keyup keydown",function(e,t){t=T.vakata.dnd._get();if(t.data&&t.data.jstree){t.helper.find(".jstree-copy:eq(0)")[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(e.metaKey||e.ctrlKey))?"show":"hide"]()}})});(function(d){var h={element:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false};d.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5},_trigger:function(e,t){var i=d.vakata.dnd._get();i.event=t;d(document).triggerHandler("dnd_"+e+".vakata",i)},_get:function(){return{data:h.data,element:h.element,helper:h.helper}},_clean:function(){if(h.helper){h.helper.remove()}if(h.scroll_i){clearInterval(h.scroll_i);h.scroll_i=false}h={element:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false};d(document).off("mousemove touchmove",d.vakata.dnd.drag);d(document).off("mouseup touchend",d.vakata.dnd.stop)},_scroll:function(e){if(!h.scroll_e||!h.scroll_l&&!h.scroll_t){if(h.scroll_i){clearInterval(h.scroll_i);h.scroll_i=false}return false}if(!h.scroll_i){h.scroll_i=setInterval(d.vakata.dnd._scroll,100);return false}if(e===true){return false}var t=h.scroll_e.scrollTop(),i=h.scroll_e.scrollLeft();h.scroll_e.scrollTop(t+h.scroll_t*d.vakata.dnd.settings.scroll_speed);h.scroll_e.scrollLeft(i+h.scroll_l*d.vakata.dnd.settings.scroll_speed);if(t!==h.scroll_e.scrollTop()||i!==h.scroll_e.scrollLeft()){d.vakata.dnd._trigger("scroll",h.scroll_e)}},start:function(e,t,i){if(e.type==="touchstart"&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]){e.pageX=e.originalEvent.changedTouches[0].pageX;e.pageY=e.originalEvent.changedTouches[0].pageY;e.target=document.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(h.is_drag){d.vakata.dnd.stop({})}try{e.currentTarget.unselectable="on";e.currentTarget.onselectstart=function(){return false};if(e.currentTarget.style){e.currentTarget.style.MozUserSelect="none"}}catch(e){}h.init_x=e.pageX;h.init_y=e.pageY;h.data=t;h.is_down=true;h.element=e.currentTarget;if(i!==false){h.helper=d("<div id='vakata-dnd'></div>").html(i).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})}d(document).bind("mousemove touchmove",d.vakata.dnd.drag);d(document).bind("mouseup touchend",d.vakata.dnd.stop);return false},drag:function(i){if(i.type==="touchmove"&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]){i.pageX=i.originalEvent.changedTouches[0].pageX;i.pageY=i.originalEvent.changedTouches[0].pageY;i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(!h.is_down){return}if(!h.is_drag){if(Math.abs(i.pageX-h.init_x)>d.vakata.dnd.settings.threshold||Math.abs(i.pageY-h.init_y)>d.vakata.dnd.settings.threshold){if(h.helper){h.helper.appendTo("body");h.helper_w=h.helper.outerWidth()}h.is_drag=true;d.vakata.dnd._trigger("start",i)}else{return}}var e=false,t=false,n=false,r=false,a=false,s=false,o=false,l=false,c=false,u=false;h.scroll_t=0;h.scroll_l=0;h.scroll_e=false;d(d(i.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(d(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var e=d(this),t=e.offset();if(this.scrollHeight>this.offsetHeight){if(t.top+e.height()-i.pageY<d.vakata.dnd.settings.scroll_proximity){h.scroll_t=1}if(i.pageY-t.top<d.vakata.dnd.settings.scroll_proximity){h.scroll_t=-1}}if(this.scrollWidth>this.offsetWidth){if(t.left+e.width()-i.pageX<d.vakata.dnd.settings.scroll_proximity){h.scroll_l=1}if(i.pageX-t.left<d.vakata.dnd.settings.scroll_proximity){h.scroll_l=-1}}if(h.scroll_t||h.scroll_l){h.scroll_e=d(this);return false}});if(!h.scroll_e){e=d(document);t=d(window);n=e.height();r=t.height();a=e.width();s=t.width();o=e.scrollTop();l=e.scrollLeft();if(n>r&&i.pageY-o<d.vakata.dnd.settings.scroll_proximity){h.scroll_t=-1}if(n>r&&r-(i.pageY-o)<d.vakata.dnd.settings.scroll_proximity){h.scroll_t=1}if(a>s&&i.pageX-l<d.vakata.dnd.settings.scroll_proximity){h.scroll_l=-1}if(a>s&&s-(i.pageX-l)<d.vakata.dnd.settings.scroll_proximity){h.scroll_l=1}if(h.scroll_t||h.scroll_l){h.scroll_e=e}}if(h.scroll_e){d.vakata.dnd._scroll(true)}if(h.helper){c=parseInt(i.pageY+d.vakata.dnd.settings.helper_top,10);u=parseInt(i.pageX+d.vakata.dnd.settings.helper_left,10);if(n&&c+25>n){c=n-50}if(a&&u+h.helper_w>a){u=a-(h.helper_w+2)}h.helper.css({left:u+"px",top:c+"px"})}d.vakata.dnd._trigger("move",i)},stop:function(e){if(e.type==="touchend"&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]){e.pageX=e.originalEvent.changedTouches[0].pageX;e.pageY=e.originalEvent.changedTouches[0].pageY;e.target=document.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(h.is_drag){d.vakata.dnd._trigger("stop",e)}d.vakata.dnd._clean()}}})(jQuery);T.jstree.defaults.search={ajax:false,fuzzy:true,case_sensitive:false,show_only_matches:false,close_opened_onclear:true,search_leaves_only:false};T.jstree.plugins.search=function(e,t){this.bind=function(){t.bind.call(this);this._data.search.str="";this._data.search.dom=T();this._data.search.res=[];this._data.search.opn=[];this.element.on("before_open.jstree",T.proxy(function(e,t){var i,n,r,a=this._data.search.res,s=[],o=T();if(a&&a.length){this._data.search.dom=T();for(i=0,n=a.length;i<n;i++){s=s.concat(this.get_node(a[i]).parents);r=this.get_node(a[i],true);if(r){this._data.search.dom=this._data.search.dom.add(r)}}s=T.vakata.array_unique(s);for(i=0,n=s.length;i<n;i++){if(s[i]==="#"){continue}r=this.get_node(s[i],true);if(r){o=o.add(r)}}this._data.search.dom.children(".jstree-anchor").addClass("jstree-search");if(this.settings.search.show_only_matches&&this._data.search.res.length){this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");o=o.add(this._data.search.dom);o.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){T(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}}},this));if(this.settings.search.show_only_matches){this.element.on("search.jstree",function(e,t){if(t.nodes.length){T(this).find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");t.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){T(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}}).on("clear_search.jstree",function(e,t){if(t.nodes.length){T(this).find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")}})}};this.search=function(t,e){if(t===false||T.trim(t)===""){return this.clear_search()}var i=this.settings.search,n=i.ajax?i.ajax:false,r=null,a=[],s=[],o,l;if(this._data.search.res.length){this.clear_search()}if(!e&&n!==false){if(T.isFunction(n)){return n.call(this,t,T.proxy(function(e){if(e&&e.d){e=e.d}this._load_nodes(!T.isArray(e)?[]:e,function(){this.search(t,true)})},this))}else{n=T.extend({},n);if(!n.data){n.data={}}n.data.str=t;return T.ajax(n).fail(T.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(n)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(T.proxy(function(e){if(e&&e.d){e=e.d}this._load_nodes(!T.isArray(e)?[]:e,function(){this.search(t,true)})},this))}}this._data.search.str=t;this._data.search.dom=T();this._data.search.res=[];this._data.search.opn=[];r=new T.vakata.search(t,true,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy});T.each(this._model.data,function(e,t){if(t.text&&r.search(t.text).isMatch&&(!i.search_leaves_only||t.state.loaded&&t.children.length===0)){a.push(e);s=s.concat(t.parents)}});if(a.length){s=T.vakata.array_unique(s);this._search_open(s);for(o=0,l=a.length;o<l;o++){r=this.get_node(a[o],true);if(r){this._data.search.dom=this._data.search.dom.add(r)}}this._data.search.res=a;this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:t,res:this._data.search.res})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");if(this.settings.search.close_opened_onclear){this.close_node(this._data.search.opn,0)}this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=T()};this._search_open=function(i){var n=this;T.each(i.concat([]),function(e,t){if(t==="#"){return true}try{t=T("#"+t.replace(T.jstree.idregex,"\\$&"),n.element)}catch(e){}if(t&&t.length){if(n.is_closed(t)){n._data.search.opn.push(t[0].id);n.open_node(t,function(){n._search_open(i)},0)}}})}};(function(e){e.vakata.search=function(m,e,v){v=v||{};if(v.fuzzy!==false){v.fuzzy=true}m=v.caseSensitive?m:m.toLowerCase();var y=v.location||0,r=v.distance||100,_=v.threshold||.6,b=m.length,w,x,C,t;if(b>32){v.fuzzy=false}if(v.fuzzy){w=1<<b-1;x=function(){var e={},t=0;for(t=0;t<b;t++){e[m.charAt(t)]=0}for(t=0;t<b;t++){e[m.charAt(t)]|=1<<b-t-1}return e}();C=function(e,t){var i=e/b,n=Math.abs(y-t);if(!r){return n?1:i}return i+n/r}}t=function(e){e=v.caseSensitive?e:e.toLowerCase();if(m===e||e.indexOf(m)!==-1){return{isMatch:true,score:0}}if(!v.fuzzy){return{isMatch:false,score:1}}var t,i,n=e.length,r=_,a=e.indexOf(m,y),s,o,l=b+n,c,u,d,h,f,p=1,g=[];if(a!==-1){r=Math.min(C(0,a),r);a=e.lastIndexOf(m,y+b);if(a!==-1){r=Math.min(C(0,a),r)}}a=-1;for(t=0;t<b;t++){s=0;o=l;while(s<o){if(C(t,y+o)<=r){s=o}else{l=o}o=Math.floor((l-s)/2+s)}l=o;u=Math.max(1,y-o+1);d=Math.min(y+o,n)+b;h=new Array(d+2);h[d+1]=(1<<t)-1;for(i=d;i>=u;i--){f=x[e.charAt(i-1)];if(t===0){h[i]=(h[i+1]<<1|1)&f}else{h[i]=(h[i+1]<<1|1)&f|((c[i+1]|c[i])<<1|1)|c[i+1]}if(h[i]&w){p=C(t,i-1);if(p<=r){r=p;a=i-1;g.push(a);if(a>y){u=Math.max(1,2*y-a)}else{break}}}}if(C(t+1,y)>r){break}c=h}return{isMatch:a>=0,score:p}};return e===true?{search:t}:t(e)}})(jQuery);T.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1};T.jstree.plugins.sort=function(e,t){this.bind=function(){t.bind.call(this);this.element.on("model.jstree",T.proxy(function(e,t){this.sort(t.parent,true)},this)).on("rename_node.jstree create_node.jstree",T.proxy(function(e,t){this.sort(t.parent||t.node.parent,false);this.redraw_node(t.parent||t.node.parent,true)},this)).on("move_node.jstree copy_node.jstree",T.proxy(function(e,t){this.sort(t.parent,false);this.redraw_node(t.parent,true)},this))};this.sort=function(e,t){var i,n;e=this.get_node(e);if(e&&e.children&&e.children.length){e.children.sort(T.proxy(this.settings.sort,this));if(t){for(i=0,n=e.children_d.length;i<n;i++){this.sort(e.children_d[i],false)}}}}};var u=false;T.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:false,filter:false};T.jstree.plugins.state=function(e,t){this.bind=function(){t.bind.call(this);var i=T.proxy(function(){this.element.on(this.settings.state.events,T.proxy(function(){if(u){clearTimeout(u)}u=setTimeout(T.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",T.proxy(function(e,t){this.element.one("restore_state.jstree",i);if(!this.restore_state()){i()}},this))};this.save_state=function(){var e={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};T.vakata.storage.set(this.settings.state.key,JSON.stringify(e))};this.restore_state=function(){var i=T.vakata.storage.get(this.settings.state.key);if(!!i){try{i=JSON.parse(i)}catch(e){return false}}if(!!i&&i.ttl&&i.sec&&+new Date-i.sec>i.ttl){return false}if(!!i&&i.state){i=i.state}if(!!i&&T.isFunction(this.settings.state.filter)){i=this.settings.state.filter.call(this,i)}if(!!i){this.element.one("set_state.jstree",function(e,t){t.instance.trigger("restore_state",{state:T.extend(true,{},i)})});this.set_state(i);return true}return false};this.clear_state=function(){return T.vakata.storage.del(this.settings.state.key)}};(function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}})(jQuery);T.jstree.defaults.types={"#":{},default:{}};T.jstree.plugins.types=function(e,u){this.init=function(e,t){var i,n;if(t&&t.types&&t.types["default"]){for(i in t.types){if(i!=="default"&&i!=="#"&&t.types.hasOwnProperty(i)){for(n in t.types["default"]){if(t.types["default"].hasOwnProperty(n)&&t.types[i][n]===y){t.types[i][n]=t.types["default"][n]}}}}}u.init.call(this,e,t);this._model.data["#"].type="#"};this.refresh=function(e){u.refresh.call(this,e);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",T.proxy(function(e,t){var i=this._model.data,n=t.nodes,r=this.settings.types,a,s,o="default";for(a=0,s=n.length;a<s;a++){o="default";if(i[n[a]].original&&i[n[a]].original.type&&r[i[n[a]].original.type]){o=i[n[a]].original.type}if(i[n[a]].data&&i[n[a]].data.jstree&&i[n[a]].data.jstree.type&&r[i[n[a]].data.jstree.type]){o=i[n[a]].data.jstree.type}i[n[a]].type=o;if(i[n[a]].icon===true&&r[o].icon!==y){i[n[a]].icon=r[o].icon}}},this));u.bind.call(this)};this.get_json=function(e,t,i){var n,r,a=this._model.data,s=t?T.extend(true,{},t,{no_id:false}):{},o=u.get_json.call(this,e,s,i);if(o===false){return false}if(T.isArray(o)){for(n=0,r=o.length;n<r;n++){o[n].type=o[n].id&&a[o[n].id]&&a[o[n].id].type?a[o[n].id].type:"default";if(t&&t.no_id){delete o[n].id;if(o[n].li_attr&&o[n].li_attr.id){delete o[n].li_attr.id}}}}else{o.type=o.id&&a[o.id]&&a[o.id].type?a[o.id].type:"default";if(t&&t.no_id){o=this._delete_ids(o)}}return o};this._delete_ids=function(e){if(T.isArray(e)){for(var t=0,i=e.length;t<i;t++){e[t]=this._delete_ids(e[t])}return e}delete e.id;if(e.li_attr&&e.li_attr.id){delete e.li_attr.id}if(e.children&&T.isArray(e.children)){e.children=this._delete_ids(e.children)}return e};this.check=function(e,t,i,n,r){if(u.check.call(this,e,t,i,n,r)===false){return false}t=t&&t.id?t:this.get_node(t);i=i&&i.id?i:this.get_node(i);var a=t&&t.id?T.jstree.reference(t.id):null,s,o,l,c;a=a&&a._model&&a._model.data?a._model.data:null;switch(e){case"create_node":case"move_node":case"copy_node":if(e!=="move_node"||T.inArray(t.id,i.children)===-1){s=this.get_rules(i);if(s.max_children!==y&&s.max_children!==-1&&s.max_children===i.children.length){this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+e,data:JSON.stringify({chk:e,pos:n,obj:t&&t.id?t.id:false,par:i&&i.id?i.id:false})};return false}if(s.valid_children!==y&&s.valid_children!==-1&&T.inArray(t.type,s.valid_children)===-1){this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+e,data:JSON.stringify({chk:e,pos:n,obj:t&&t.id?t.id:false,par:i&&i.id?i.id:false})};return false}if(a&&t.children_d&&t.parents){o=0;for(l=0,c=t.children_d.length;l<c;l++){o=Math.max(o,a[t.children_d[l]].parents.length)}o=o-t.parents.length+1}if(o<=0||o===y){o=1}do{if(s.max_depth!==y&&s.max_depth!==-1&&s.max_depth<o){this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+e,data:JSON.stringify({chk:e,pos:n,obj:t&&t.id?t.id:false,par:i&&i.id?i.id:false})};return false}i=this.get_node(i.parent);s=this.get_rules(i);o++}while(i)}break}return true};this.get_rules=function(e){e=this.get_node(e);if(!e){return false}var t=this.get_type(e,true);if(t.max_depth===y){t.max_depth=-1}if(t.max_children===y){t.max_children=-1}if(t.valid_children===y){t.valid_children=-1}return t};this.get_type=function(e,t){e=this.get_node(e);return!e?false:t?T.extend({type:e.type},this.settings.types[e.type]):e.type};this.set_type=function(e,t){var i,n,r,a,s;if(T.isArray(e)){e=e.slice();for(n=0,r=e.length;n<r;n++){this.set_type(e[n],t)}return true}i=this.settings.types;e=this.get_node(e);if(!i[t]||!e){return false}a=e.type;s=this.get_icon(e);e.type=t;if(s===true||i[a]&&i[a].icon&&s===i[a].icon){this.set_icon(e,i[t].icon!==y?i[t].icon:true)}return true}};T.jstree.plugins.unique=function(e,u){this.check=function(e,t,i,n,r){if(u.check.call(this,e,t,i,n,r)===false){return false}t=t&&t.id?t:this.get_node(t);i=i&&i.id?i:this.get_node(i);if(!i||!i.children){return true}var a=e==="rename_node"?n:t.text,s=[],o=this._model.data,l,c;for(l=0,c=i.children.length;l<c;l++){s.push(o[i.children[l]].text)}switch(e){case"delete_node":return true;case"rename_node":case"copy_node":l=T.inArray(a,s)===-1;if(!l){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+a+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:n,obj:t&&t.id?t.id:false,par:i&&i.id?i.id:false})}}return l;case"move_node":l=t.parent===i.id||T.inArray(a,s)===-1;if(!l){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+a+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:n,obj:t&&t.id?t.id:false,par:i&&i.id?i.id:false})}}return l}return true}};var d=document.createElement("DIV");d.setAttribute("unselectable","on");d.className="jstree-wholerow";d.innerHTML="&#160;";T.jstree.plugins.wholerow=function(e,r){this.bind=function(){r.bind.call(this);this.element.on("loading",T.proxy(function(){d.style.height=this._data.core.li_height+"px"},this)).on("ready.jstree set_state.jstree",T.proxy(function(){this.hide_dots()},this)).on("ready.jstree",T.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",T.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",T.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i=false,n,r;for(n=0,r=t.selected.length;n<r;n++){i=this.get_node(t.selected[n],true);if(i&&i.length){i.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}}},this)).on("open_node.jstree",T.proxy(function(e,t){this.get_node(t.node,true).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",T.proxy(function(e,t){this.get_node(t.node,true).children(".jstree-wholerow")[e.type==="hover_node"?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",T.proxy(function(e){e.preventDefault();var t=T.Event("contextmenu",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY});T(e.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(t)},this)).on("click.jstree",".jstree-wholerow",function(e){e.stopImmediatePropagation();var t=T.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});T(e.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(t).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",T.proxy(function(e){e.stopImmediatePropagation();var t=T.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});T(e.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(t).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",T.proxy(function(e){e.stopImmediatePropagation();this.hover_node(e.currentTarget);return false},this)).on("mouseleave.jstree",".jstree-node",T.proxy(function(e){this.dehover_node(e.currentTarget)},this))};this.teardown=function(){if(this.settings.wholerow){this.element.find(".jstree-wholerow").remove()}r.teardown.call(this)};this.redraw_node=function(e,t,i){e=r.redraw_node.call(this,e,t,i);if(e){var n=d.cloneNode(true);if(T.inArray(e.id,this._data.core.selected)!==-1){n.className+=" jstree-wholerow-clicked"}e.insertBefore(n,e.childNodes[0])}return e}}});(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else{e.Dragdealer=t()}})(this,function(){var e=function(e,t){this.bindMethods();this.options=this.applyDefaults(t||{});this.wrapper=this.getWrapperElement(e);if(!this.wrapper){return}this.handle=this.getHandleElement(this.wrapper,this.options.handleClass);if(!this.handle){return}this.init();this.bindEventListeners()};e.prototype={defaults:{disabled:false,horizontal:true,vertical:false,slide:true,steps:0,snap:false,loose:false,speed:.1,xPrecision:0,yPrecision:0,handleClass:"handle",css3:true,requestAnimationFrame:false,activeClass:"active",tapping:true},init:function(){if(this.options.css3){u(this.handle)}this.value={prev:[-1,-1],current:[this.options.x||0,this.options.y||0],target:[this.options.x||0,this.options.y||0]};this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]};this.change=[0,0];this.stepRatios=this.calculateStepRatios();this.activity=false;this.dragging=false;this.tapping=false;this.reflow();if(this.options.disabled){this.disable()}},applyDefaults:function(e){for(var t in this.defaults){if(!e.hasOwnProperty(t)){e[t]=this.defaults[t]}}return e},getWrapperElement:function(e){if(typeof e=="string"){return document.getElementById(e)}else{return e}},getHandleElement:function(e,t){var i,n,r;if(e.getElementsByClassName){i=e.getElementsByClassName(t);if(i.length>0){return i[0]}}else{n=new RegExp("(^|\\s)"+t+"(\\s|$)");i=e.getElementsByTagName("*");for(r=0;r<i.length;r++){if(n.test(i[r].className)){return i[r]}}}},calculateStepRatios:function(){var e=[];if(this.options.steps>1){for(var t=0;t<=this.options.steps-1;t++){e[t]=t/(this.options.steps-1)}}return e},setWrapperOffset:function(){this.offset.wrapper=o.get(this.wrapper)},calculateBounds:function(){var e={top:this.options.top||0,bottom:-(this.options.bottom||0)+this.wrapper.offsetHeight,left:this.options.left||0,right:-(this.options.right||0)+this.wrapper.offsetWidth};e.availWidth=e.right-e.left-this.handle.offsetWidth;e.availHeight=e.bottom-e.top-this.handle.offsetHeight;return e},calculateValuePrecision:function(){var e=this.options.xPrecision||Math.abs(this.bounds.availWidth),t=this.options.yPrecision||Math.abs(this.bounds.availHeight);return[e?1/e:0,t?1/t:0]},bindMethods:function(){this.animateWithRequestAnimationFrame=t(this.animateWithRequestAnimationFrame,this);this.animate=t(this.animate,this);this.onHandleMouseDown=t(this.onHandleMouseDown,this);this.onHandleTouchStart=t(this.onHandleTouchStart,this);this.onDocumentMouseMove=t(this.onDocumentMouseMove,this);this.onWrapperTouchMove=t(this.onWrapperTouchMove,this);this.onWrapperMouseDown=t(this.onWrapperMouseDown,this);this.onWrapperTouchStart=t(this.onWrapperTouchStart,this);this.onDocumentMouseUp=t(this.onDocumentMouseUp,this);this.onDocumentTouchEnd=t(this.onDocumentTouchEnd,this);this.onHandleClick=t(this.onHandleClick,this);this.onWindowResize=t(this.onWindowResize,this)},bindEventListeners:function(){i(this.handle,"mousedown",this.onHandleMouseDown);i(this.handle,"touchstart",this.onHandleTouchStart);i(document,"mousemove",this.onDocumentMouseMove);i(this.wrapper,"touchmove",this.onWrapperTouchMove);i(this.wrapper,"mousedown",this.onWrapperMouseDown);i(this.wrapper,"touchstart",this.onWrapperTouchStart);i(document,"mouseup",this.onDocumentMouseUp);i(document,"touchend",this.onDocumentTouchEnd);i(this.handle,"click",this.onHandleClick);i(window,"resize",this.onWindowResize);this.animate(false,true);if(this.options.requestAnimationFrame){this.interval=h(this.animateWithRequestAnimationFrame)}else{this.timeOffset=25;this.interval=setInterval(this.animate,this.timeOffset)}},unbindEventListeners:function(){n(this.handle,"mousedown",this.onHandleMouseDown);n(this.handle,"touchstart",this.onHandleTouchStart);n(document,"mousemove",this.onDocumentMouseMove);n(this.wrapper,"touchmove",this.onWrapperTouchMove);n(this.wrapper,"mousedown",this.onWrapperMouseDown);n(this.wrapper,"touchstart",this.onWrapperTouchStart);n(document,"mouseup",this.onDocumentMouseUp);n(document,"touchend",this.onDocumentTouchEnd);n(this.handle,"click",this.onHandleClick);n(window,"resize",this.onWindowResize);if(this.options.requestAnimationFrame){f(this.interval)}else{clearInterval(this.interval)}},onHandleMouseDown:function(e){s.refresh(e);r(e);a(e);this.activity=false;this.startDrag()},onHandleTouchStart:function(e){s.refresh(e);a(e);this.activity=false;this.startDrag()},onDocumentMouseMove:function(e){s.refresh(e);if(this.dragging){this.activity=true}},onWrapperTouchMove:function(e){s.refresh(e);if(!this.activity&&this.draggingOnDisabledAxis()){if(this.dragging){this.stopDrag()}return}r(e);this.activity=true},onWrapperMouseDown:function(e){s.refresh(e);r(e);this.startTap()},onWrapperTouchStart:function(e){s.refresh(e);r(e);this.startTap()},onDocumentMouseUp:function(e){this.stopDrag();this.stopTap()},onDocumentTouchEnd:function(e){this.stopDrag();this.stopTap()},onHandleClick:function(e){if(this.activity){r(e);a(e)}},onWindowResize:function(e){this.reflow()},enable:function(){this.disabled=false;this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=true;this.handle.className+=" disabled"},reflow:function(){this.setWrapperOffset();this.bounds=this.calculateBounds();this.valuePrecision=this.calculateValuePrecision();this.updateOffsetFromValue()},getStep:function(){return[this.getStepNumber(this.value.target[0]),this.getStepNumber(this.value.target[1])]},getValue:function(){return this.value.target},setStep:function(e,t,i){this.setValue(this.options.steps&&e>1?(e-1)/(this.options.steps-1):0,this.options.steps&&t>1?(t-1)/(this.options.steps-1):0,i)},setValue:function(e,t,i){this.setTargetValue([e,t||0]);if(i){this.groupCopy(this.value.current,this.value.target);this.updateOffsetFromValue();this.callAnimationCallback()}},startTap:function(){if(this.disabled||!this.options.tapping){return}this.tapping=true;this.setWrapperOffset();this.setTargetValueByOffset([s.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,s.y-this.offset.wrapper[1]-this.handle.offsetHeight/2])},stopTap:function(){if(this.disabled||!this.tapping){return}this.tapping=false;this.setTargetValue(this.value.current)},startDrag:function(){if(this.disabled){return}this.dragging=true;this.setWrapperOffset();this.offset.mouse=[s.x-o.get(this.handle)[0],s.y-o.get(this.handle)[1]];if(!this.wrapper.className.match(this.options.activeClass)){this.wrapper.className+=" "+this.options.activeClass}},stopDrag:function(){if(this.disabled||!this.dragging){return}this.dragging=false;var e=this.groupClone(this.value.current);if(this.options.slide){var t=this.change;e[0]+=t[0]*4;e[1]+=t[1]*4}this.setTargetValue(e);this.wrapper.className=this.wrapper.className.replace(" "+this.options.activeClass,"")},callAnimationCallback:function(){var e=this.value.current;if(this.options.snap&&this.options.steps>1){e=this.getClosestSteps(e)}if(!this.groupCompare(e,this.value.prev)){if(typeof this.options.animationCallback=="function"){this.options.animationCallback.call(this,e[0],e[1])}this.groupCopy(this.value.prev,e)}},callTargetCallback:function(){if(typeof this.options.callback=="function"){this.options.callback.call(this,this.value.target[0],this.value.target[1])}},animateWithRequestAnimationFrame:function(e){if(e){this.timeOffset=this.timeStamp?e-this.timeStamp:0;this.timeStamp=e}else{this.timeOffset=25}this.animate();this.interval=h(this.animateWithRequestAnimationFrame)},animate:function(e,t){if(e&&!this.dragging){return}if(this.dragging){var i=this.groupClone(this.value.target);var n=[s.x-this.offset.wrapper[0]-this.offset.mouse[0],s.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetValueByOffset(n,this.options.loose);this.change=[this.value.target[0]-i[0],this.value.target[1]-i[1]]}if(this.dragging||t){this.groupCopy(this.value.current,this.value.target)}if(this.dragging||this.glide()||t){this.updateOffsetFromValue();this.callAnimationCallback()}},glide:function(){var e=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];if(!e[0]&&!e[1]){return false}if(Math.abs(e[0])>this.valuePrecision[0]||Math.abs(e[1])>this.valuePrecision[1]){this.value.current[0]+=e[0]*this.options.speed*this.timeOffset/25;this.value.current[1]+=e[1]*this.options.speed*this.timeOffset/25}else{this.groupCopy(this.value.current,this.value.target)}return true},updateOffsetFromValue:function(){if(!this.options.snap){this.offset.current=this.getOffsetsByRatios(this.value.current)}else{this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current))}if(!this.groupCompare(this.offset.current,this.offset.prev)){this.renderHandlePosition();this.groupCopy(this.offset.prev,this.offset.current)}},renderHandlePosition:function(){var e="";if(this.options.css3&&l.transform){if(this.options.horizontal){e+="translateX("+this.offset.current[0]+"px)"}if(this.options.vertical){e+=" translateY("+this.offset.current[1]+"px)"}this.handle.style[l.transform]=e;return}if(this.options.horizontal){this.handle.style.left=this.offset.current[0]+"px"}if(this.options.vertical){this.handle.style.top=this.offset.current[1]+"px"}},setTargetValue:function(e,t){var i=t?this.getLooseValue(e):this.getProperValue(e);this.groupCopy(this.value.target,i);this.offset.target=this.getOffsetsByRatios(i);this.callTargetCallback()},setTargetValueByOffset:function(e,t){var i=this.getRatiosByOffsets(e);var n=t?this.getLooseValue(i):this.getProperValue(i);this.groupCopy(this.value.target,n);this.offset.target=this.getOffsetsByRatios(n)},getLooseValue:function(e){var t=this.getProperValue(e);return[t[0]+(e[0]-t[0])/4,t[1]+(e[1]-t[1])/4]},getProperValue:function(e){var t=this.groupClone(e);t[0]=Math.max(t[0],0);t[1]=Math.max(t[1],0);t[0]=Math.min(t[0],1);t[1]=Math.min(t[1],1);if(!this.dragging&&!this.tapping||this.options.snap){if(this.options.steps>1){t=this.getClosestSteps(t)}}return t},getRatiosByOffsets:function(e){return[this.getRatioByOffset(e[0],this.bounds.availWidth,this.bounds.left),this.getRatioByOffset(e[1],this.bounds.availHeight,this.bounds.top)]},getRatioByOffset:function(e,t,i){return t?(e-i)/t:0},getOffsetsByRatios:function(e){return[this.getOffsetByRatio(e[0],this.bounds.availWidth,this.bounds.left),this.getOffsetByRatio(e[1],this.bounds.availHeight,this.bounds.top)]},getOffsetByRatio:function(e,t,i){return Math.round(e*t)+i},getStepNumber:function(e){return this.getClosestStep(e)*(this.options.steps-1)+1},getClosestSteps:function(e){return[this.getClosestStep(e[0]),this.getClosestStep(e[1])]},getClosestStep:function(e){var t=0;var i=1;for(var n=0;n<=this.options.steps-1;n++){if(Math.abs(this.stepRatios[n]-e)<i){i=Math.abs(this.stepRatios[n]-e);t=n}}return this.stepRatios[t]},groupCompare:function(e,t){return e[0]==t[0]&&e[1]==t[1]},groupCopy:function(e,t){e[0]=t[0];e[1]=t[1]},groupClone:function(e){return[e[0],e[1]]},draggingOnDisabledAxis:function(){return!this.options.horizontal&&s.xDiff>s.yDiff||!this.options.vertical&&s.yDiff>s.xDiff}};var t=function(e,t){return function(){return e.apply(t,arguments)}};var i=function(e,t,i){if(e.addEventListener){e.addEventListener(t,i,false)}else if(e.attachEvent){e.attachEvent("on"+t,i)}};var n=function(e,t,i){if(e.removeEventListener){e.removeEventListener(t,i,false)}else if(e.detachEvent){e.detachEvent("on"+t,i)}};var r=function(e){if(!e){e=window.event}if(e.preventDefault){e.preventDefault()}e.returnValue=false};var a=function(e){if(!e){e=window.event}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true};var s={x:0,y:0,xDiff:0,yDiff:0,refresh:function(e){if(!e){e=window.event}if(e.type=="mousemove"){this.set(e)}else if(e.touches){this.set(e.touches[0])}},set:function(e){var t=this.x,i=this.y;if(e.clientX||e.clientY){this.x=e.clientX;this.y=e.clientY}else if(e.pageX||e.pageY){this.x=e.pageX-document.body.scrollLeft-document.documentElement.scrollLeft;this.y=e.pageY-document.body.scrollTop-document.documentElement.scrollTop}this.xDiff=Math.abs(this.x-t);this.yDiff=Math.abs(this.y-i)}};var o={get:function(e){var t={left:0,top:0};if(e.getBoundingClientRect!==undefined){t=e.getBoundingClientRect()}return[t.left,t.top]}};var l={transform:c("transform"),perspective:c("perspective"),backfaceVisibility:c("backfaceVisibility")};function c(e){var t="Webkit Moz ms O".split(" "),i=document.documentElement.style;if(i[e]!==undefined)return e;e=e.charAt(0).toUpperCase()+e.substr(1);for(var n=0;n<t.length;n++){if(i[t[n]+e]!==undefined){return t[n]+e}}}function u(e){if(l.backfaceVisibility&&l.perspective){e.style[l.perspective]="1000px";e.style[l.backfaceVisibility]="hidden"}}var d=["webkit","moz"];var h=window.requestAnimationFrame;var f=window.cancelAnimationFrame;for(var p=0;p<d.length&&!h;++p){h=window[d[p]+"RequestAnimationFrame"];f=window[d[p]+"CancelAnimationFrame"]||window[d[p]+"CancelRequestAnimationFrame"]}if(!h){h=function(e){return setTimeout(e,25)};f=clearTimeout}return e});window.giscloudNamespace="giscloud";(function(e){var t,i,n;t=["assert","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","time","timeEnd","trace","warn"];i=function(){};do{n=t.pop();if(!e[n]){e[n]=i}}while(t.length>0);window.console=e})(window.console||{});(function(window){var namespace=window.giscloudNamespace,giscloud=window[namespace]={};delete window.giscloudNamespace;(function(){var I,r,c,E,o,s,v,g,u,d,h,l,re,A,f,n,e,i,t,ae,y,a,P,p,m,_,b,se,w,x,C,T,k,M,S,L,D,j,O,N,R,F,z,H,B,W,q,oe,G,V,le,U,$,J,Q,ce,X,Y,Z,K,ee,te,ie,ne,ue,de,he,fe,pe,ge,me,ve,ye,_e,be,we,xe,Ce,Te,ke,Me,Se,Le=[].slice;Ce=function(){var i,e,t,n,r;for(i={},r="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),n=0,e=r.length;n<e;n++)t=r[n],i["[object "+t+"]"]=t.toLowerCase();return function(e){var t;return t=Object.prototype.toString.call(e),i[t]||"object"}}(),q=function(e,t,i){return null==t&&(t=0),null==i&&(i=1),e<t&&(e=t),e>i&&(e=i),e},Te=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},y=function(e){var t,i;for(e._clipped=!1,e._unclipped=e.slice(0),t=i=0;i<3;t=++i)t<3?((e[t]<0||e[t]>255)&&(e._clipped=!0),e[t]<0&&(e[t]=0),e[t]>255&&(e[t]=255)):3===t&&(e[t]<0&&(e[t]=0),e[t]>1&&(e[t]=1));return e._clipped||delete e._unclipped,e},E=Math.PI,ye=Math.round,P=Math.cos,se=Math.floor,ce=Math.pow,oe=Math.log,be=Math.sin,we=Math.sqrt,A=Math.atan2,le=Math.max,re=Math.abs,v=2*E,o=E/3,r=E/180,s=180/E,ae=function(){return arguments[0]instanceof I?arguments[0]:function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,arguments,function(){})},ae.default=ae,l=[],"undefined"!=typeof module&&null!==module&&null!=module.exports&&(module.exports=ae),"function"==typeof define&&define.amd?define([],function(){return ae}):(ve="undefined"!=typeof exports&&null!==exports?exports:this,ve.chroma=ae),ae.version="1.4.1",h={},u=[],d=!1,I=function(){function e(){var e,t,i,n,r,a,s,o,l;for(a=this,t=[],o=0,n=arguments.length;o<n;o++)null!=(e=arguments[o])&&t.push(e);if(t.length>1&&(s=t[t.length-1]),null!=h[s])a._rgb=y(h[s](Te(t.slice(0,-1))));else{for(d||(u=u.sort(function(e,t){return t.p-e.p}),d=!0),l=0,r=u.length;l<r&&(i=u[l],!(s=i.test.apply(i,t)));l++);s&&(a._rgb=y(h[s].apply(h,t)))}null==a._rgb&&console.warn("unknown format: "+t),null==a._rgb&&(a._rgb=[0,0,0]),3===a._rgb.length&&a._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),ae._input=h,ae.brewer=i={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,t;t=[];for(e in i)t.push(i[e.toLowerCase()]=i[e])}(),ke={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ae.colors=ke,F=function(){var e,t,i,n,r,a,s,o,l;return t=Te(arguments),r=t[0],e=t[1],i=t[2],o=(r+16)/116,s=isNaN(e)?o:o+e/500,l=isNaN(i)?o:o-i/200,o=c.Yn*z(o),s=c.Xn*z(s),l=c.Zn*z(l),a=Se(3.2404542*s-1.5371385*o-.4985314*l),n=Se(-.969266*s+1.8760108*o+.041556*l),i=Se(.0556434*s-.2040259*o+1.0572252*l),[a,n,i,t.length>3?t[3]:1]},Se=function(e){return 255*(e<=.00304?12.92*e:1.055*ce(e,1/2.4)-.055)},z=function(e){return e>c.t1?e*e*e:c.t2*(e-c.t0)},c={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},ne=function(){var e,t,i,n,r,a,s,o;return n=Te(arguments),i=n[0],t=n[1],e=n[2],r=pe(i,t,e),a=r[0],s=r[1],o=r[2],[116*s-16,500*(a-s),200*(s-o)]},ge=function(e){return(e/=255)<=.04045?e/12.92:ce((e+.055)/1.055,2.4)},Me=function(e){return e>c.t3?ce(e,1/3):e/c.t2+c.t0},pe=function(){var e,t,i,n,r,a,s;return n=Te(arguments),i=n[0],t=n[1],e=n[2],i=ge(i),t=ge(t),e=ge(e),r=Me((.4124564*i+.3575761*t+.1804375*e)/c.Xn),a=Me((.2126729*i+.7151522*t+.072175*e)/c.Yn),s=Me((.0193339*i+.119192*t+.9503041*e)/c.Zn),[r,a,s]},ae.lab=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["lab"]),function(){})},h.lab=F,I.prototype.lab=function(){return ne(this._rgb)},f=function(n){var e,t,i,r,a,s,o,l,c,u,d;return n=function(){var e,t,i;for(i=[],t=0,e=n.length;t<e;t++)r=n[t],i.push(ae(r));return i}(),2===n.length?(c=function(){var e,t,i;for(i=[],t=0,e=n.length;t<e;t++)r=n[t],i.push(r.lab());return i}(),a=c[0],s=c[1],e=function(i){var n,e;return e=function(){var e,t;for(t=[],n=e=0;e<=2;n=++e)t.push(a[n]+i*(s[n]-a[n]));return t}(),ae.lab.apply(ae,e)}):3===n.length?(u=function(){var e,t,i;for(i=[],t=0,e=n.length;t<e;t++)r=n[t],i.push(r.lab());return i}(),a=u[0],s=u[1],o=u[2],e=function(i){var n,e;return e=function(){var e,t;for(t=[],n=e=0;e<=2;n=++e)t.push((1-i)*(1-i)*a[n]+2*(1-i)*i*s[n]+i*i*o[n]);return t}(),ae.lab.apply(ae,e)}):4===n.length?(d=function(){var e,t,i;for(i=[],t=0,e=n.length;t<e;t++)r=n[t],i.push(r.lab());return i}(),a=d[0],s=d[1],o=d[2],l=d[3],e=function(i){var n,e;return e=function(){var e,t;for(t=[],n=e=0;e<=2;n=++e)t.push((1-i)*(1-i)*(1-i)*a[n]+3*(1-i)*(1-i)*i*s[n]+3*(1-i)*i*i*o[n]+i*i*i*l[n]);return t}(),ae.lab.apply(ae,e)}):5===n.length&&(t=f(n.slice(0,3)),i=f(n.slice(2,5)),e=function(e){return e<.5?t(2*e):i(2*(e-.5))}),e},ae.bezier=function(e){var t;return t=f(e),t.scale=function(){return ae.scale(t)},t},ae.cubehelix=function(u,d,h,f,p){var g,m,t;return null==u&&(u=300),null==d&&(d=-1.5),null==h&&(h=1),null==f&&(f=1),null==p&&(p=[0,1]),g=0,"array"===Ce(p)?m=p[1]-p[0]:(m=0,p=[p,p]),t=function(e){var t,i,n,r,a,s,o,l,c;return t=v*((u+120)/360+d*e),o=ce(p[0]+m*e,f),s=0!==g?h[0]+e*g:h,i=s*o*(1-o)/2,r=P(t),c=be(t),l=o+i*(-.14861*r+1.78277*c),a=o+i*(-.29227*r-.90649*c),n=o+i*(1.97294*r),ae(y([255*l,255*a,255*n,1]))},t.start=function(e){return null==e?u:(u=e,t)},t.rotations=function(e){return null==e?d:(d=e,t)},t.gamma=function(e){return null==e?f:(f=e,t)},t.hue=function(e){return null==e?h:(h=e,"array"===Ce(h)?0===(g=h[1]-h[0])&&(h=h[1]):g=0,t)},t.lightness=function(e){return null==e?p:("array"===Ce(e)?(p=e,m=e[1]-e[0]):(p=[e,e],m=0),t)},t.scale=function(){return ae.scale(t)},t.hue(h),t},ae.random=function(){var e,t,i;for(t="0123456789abcdef",e="#",i=0;i<6;++i)e+=t.charAt(se(16*Math.random()));return new I(e)},l=[],S=function(e,t,i,n){var r,a,s,o;for(null==i&&(i=.5),null==n&&(n="rgb"),"object"!==Ce(e)&&(e=ae(e)),"object"!==Ce(t)&&(t=ae(t)),s=0,a=l.length;s<a;s++)if(r=l[s],n===r[0]){o=r[1](e,t,i,n);break}if(null==o)throw"color mode "+n+" is not supported";return o.alpha(e.alpha()+i*(t.alpha()-e.alpha()))},ae.interpolate=S,I.prototype.interpolate=function(e,t,i){return S(this,e,t,i)},ae.mix=S,I.prototype.mix=I.prototype.interpolate,h.rgb=function(){var e,t,i,n;t=Te(arguments),i=[];for(e in t)n=t[e],i.push(n);return i},ae.rgb=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["rgb"]),function(){})},I.prototype.rgb=function(e){return null==e&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},I.prototype.rgba=function(e){return null==e&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},u.push({p:3,test:function(e){var t;return t=Te(arguments),"array"===Ce(t)&&3===t.length?"rgb":4===t.length&&"number"===Ce(t[3])&&t[3]>=0&&t[3]<=1?"rgb":void 0}}),h.lrgb=h.rgb,j=function(e,t,i,n){var r,a;return r=e._rgb,a=t._rgb,new I(we(ce(r[0],2)*(1-i)+ce(a[0],2)*i),we(ce(r[1],2)*(1-i)+ce(a[1],2)*i),we(ce(r[2],2)*(1-i)+ce(a[2],2)*i),n)},g=function(e){var t,i,n,r,a,s;for(i=1/e.length,s=[0,0,0,0],r=0,n=e.length;r<n;r++)t=e[r],a=t._rgb,s[0]+=ce(a[0],2)*i,s[1]+=ce(a[1],2)*i,s[2]+=ce(a[2],2)*i,s[3]+=a[3]*i;return s[0]=we(s[0]),s[1]=we(s[1]),s[2]=we(s[2]),s[3]>1&&(s[3]=1),new I(y(s))},l.push(["lrgb",j]),ae.average=function(e,t){var i,n,r,a,s,o,l,c,u,d,h,f,p;if(null==t&&(t="rgb"),u=e.length,e=e.map(function(e){return ae(e)}),l=e.splice(0,1)[0],"lrgb"===t)return g(e);f=l.get(t),a=[],s=0,o=0;for(c in f)f[c]=f[c]||0,a.push(isNaN(f[c])?0:1),"h"!==t.charAt(c)||isNaN(f[c])||(i=f[c]/180*E,s+=P(i),o+=be(i));for(n=l.alpha(),h=0,d=e.length;h<d;h++){r=e[h],p=r.get(t),n+=r.alpha();for(c in f)isNaN(p[c])||(a[c]+=1,"h"===t.charAt(c)?(i=p[c]/180*E,s+=P(i),o+=be(i)):f[c]+=p[c])}for(c in f)if("h"===t.charAt(c)){for(i=A(o/a[c],s/a[c])/E*180;i<0;)i+=360;for(;i>=360;)i-=360;f[c]=i}else f[c]=f[c]/a[c];return ae(f,t).alpha(n/u)},x=function(e){var t,i,n,r,a,s;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return 4!==e.length&&7!==e.length||(e=e.substr(1)),3===e.length&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),s=parseInt(e,16),r=s>>16,n=s>>8&255,i=255&s,[r,n,i,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return 9===e.length&&(e=e.substr(1)),s=parseInt(e,16),r=s>>24&255,n=s>>16&255,i=s>>8&255,t=ye((255&s)/255*100)/100,[r,n,i,t];if(null!=h.css&&(a=h.css(e)))return a;throw"unknown color: "+e},K=function(e,t){var i,n,r,a,s,o,l;return null==t&&(t="auto"),s=e[0],r=e[1],n=e[2],i=e[3],"auto"===t&&(t=i<1?"rgba":"rgb"),s=Math.round(s),r=Math.round(r),n=Math.round(n),l=s<<16|r<<8|n,o="000000"+l.toString(16),o=o.substr(o.length-6),a="0"+ye(255*i).toString(16),a=a.substr(a.length-2),"#"+function(){switch(t.toLowerCase()){case"rgba":return o+a;case"argb":return a+o;default:return o}}()},h.hex=function(e){return x(e)},ae.hex=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["hex"]),function(){})},I.prototype.hex=function(e){return null==e&&(e="auto"),K(this._rgb,e)},u.push({p:4,test:function(e){if(1===arguments.length&&"string"===Ce(e))return"hex"}}),k=function(){var e,t,i,n,r,a,s,o,l,c,u,d,h,f;if(e=Te(arguments),r=e[0],u=e[1],s=e[2],0===u)l=n=t=255*s;else{for(f=[0,0,0],i=[0,0,0],h=s<.5?s*(1+u):s+u-s*u,d=2*s-h,r/=360,f[0]=r+1/3,f[1]=r,f[2]=r-1/3,a=o=0;o<=2;a=++o)f[a]<0&&(f[a]+=1),f[a]>1&&(f[a]-=1),6*f[a]<1?i[a]=d+6*(h-d)*f[a]:2*f[a]<1?i[a]=h:3*f[a]<2?i[a]=d+(h-d)*(2/3-f[a])*6:i[a]=d;c=[ye(255*i[0]),ye(255*i[1]),ye(255*i[2])],l=c[0],n=c[1],t=c[2]}return e.length>3?[l,n,t,e[3]]:[l,n,t]},te=function(e,t,i){var n,r,a,s,o;return void 0!==e&&e.length>=3&&(s=e,e=s[0],t=s[1],i=s[2]),e/=255,t/=255,i/=255,a=Math.min(e,t,i),le=Math.max(e,t,i),r=(le+a)/2,le===a?(o=0,n=Number.NaN):o=r<.5?(le-a)/(le+a):(le-a)/(2-le-a),e===le?n=(t-i)/(le-a):t===le?n=2+(i-e)/(le-a):i===le&&(n=4+(e-t)/(le-a)),n*=60,n<0&&(n+=360),[n,o,r]},ae.hsl=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["hsl"]),function(){})},h.hsl=k,I.prototype.hsl=function(){return te(this._rgb)},M=function(){var e,t,i,n,r,a,s,o,l,c,u,d,h,f,p,g,m,v;if(e=Te(arguments),r=e[0],g=e[1],v=e[2],v*=255,0===g)l=n=t=v;else switch(360===r&&(r=0),r>360&&(r-=360),r<0&&(r+=360),r/=60,a=se(r),i=r-a,s=v*(1-g),o=v*(1-g*i),m=v*(1-g*(1-i)),a){case 0:c=[v,m,s],l=c[0],n=c[1],t=c[2];break;case 1:u=[o,v,s],l=u[0],n=u[1],t=u[2];break;case 2:d=[s,v,m],l=d[0],n=d[1],t=d[2];break;case 3:h=[s,o,v],l=h[0],n=h[1],t=h[2];break;case 4:f=[m,s,v],l=f[0],n=f[1],t=f[2];break;case 5:p=[v,s,o],l=p[0],n=p[1],t=p[2]}return[l,n,t,e.length>3?e[3]:1]},ie=function(){var e,t,i,n,r,a,s,o,l;return s=Te(arguments),a=s[0],i=s[1],e=s[2],r=Math.min(a,i,e),le=Math.max(a,i,e),t=le-r,l=le/255,0===le?(n=Number.NaN,o=0):(o=t/le,a===le&&(n=(i-e)/t),i===le&&(n=2+(e-a)/t),e===le&&(n=4+(a-i)/t),(n*=60)<0&&(n+=360)),[n,o,l]},ae.hsv=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["hsv"]),function(){})},h.hsv=M,I.prototype.hsv=function(){return ie(this._rgb)},J=function(e){var t,i,n;return"number"===Ce(e)&&e>=0&&e<=16777215?(n=e>>16,i=e>>8&255,t=255&e,[n,i,t,1]):(console.warn("unknown num color: "+e),[0,0,0,1])},he=function(){var e,t,i,n;return n=Te(arguments),i=n[0],t=n[1],e=n[2],(i<<16)+(t<<8)+e},ae.num=function(e){return new I(e,"num")},I.prototype.num=function(e){return null==e&&(e="rgb"),he(this._rgb,e)},h.num=J,u.push({p:1,test:function(e){if(1===arguments.length&&"number"===Ce(e)&&e>=0&&e<=16777215)return"num"}}),w=function(){var e,t,i,n,r,a,s,o,l,c,u,d,h,f,p,g,m,v,y,_;if(i=Te(arguments),o=i[0],r=i[1],t=i[2],r/=100,s=s/100*255,e=255*r,0===r)d=s=n=t;else switch(360===o&&(o=0),o>360&&(o-=360),o<0&&(o+=360),o/=60,l=se(o),a=o-l,c=t*(1-r),u=c+e*(1-a),y=c+e*a,_=c+e,l){case 0:h=[_,y,c],d=h[0],s=h[1],n=h[2];break;case 1:f=[u,_,c],d=f[0],s=f[1],n=f[2];break;case 2:p=[c,_,y],d=p[0],s=p[1],n=p[2];break;case 3:g=[c,u,_],d=g[0],s=g[1],n=g[2];break;case 4:m=[y,c,_],d=m[0],s=m[1],n=m[2];break;case 5:v=[_,c,u],d=v[0],s=v[1],n=v[2]}return[d,s,n,i.length>3?i[3]:1]},Z=function(){var e,t,i,n,r,a,s,o,l;return l=Te(arguments),o=l[0],r=l[1],t=l[2],s=Math.min(o,r,t),le=Math.max(o,r,t),n=le-s,i=100*n/255,e=s/(255-n)*100,0===n?a=Number.NaN:(o===le&&(a=(r-t)/n),r===le&&(a=2+(t-o)/n),t===le&&(a=4+(o-r)/n),(a*=60)<0&&(a+=360)),[a,i,e]},ae.hcg=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["hcg"]),function(){})},h.hcg=w,I.prototype.hcg=function(){return Z(this._rgb)},p=function(e){var t,i,n,r,a,s,o,l;if(e=e.toLowerCase(),null!=ae.colors&&ae.colors[e])return x(ae.colors[e]);if(a=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(o=a.slice(1,4),r=s=0;s<=2;r=++s)o[r]=+o[r];o[3]=1}else if(a=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(o=a.slice(1,5),r=l=0;l<=3;r=++l)o[r]=+o[r];else if(a=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(o=a.slice(1,4),r=t=0;t<=2;r=++t)o[r]=ye(2.55*o[r]);o[3]=1}else if(a=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(o=a.slice(1,5),r=i=0;i<=2;r=++i)o[r]=ye(2.55*o[r]);o[3]=+o[3]}else(a=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(n=a.slice(1,4),n[1]*=.01,n[2]*=.01,o=k(n),o[3]=1):(a=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(n=a.slice(1,4),n[1]*=.01,n[2]*=.01,o=k(n),o[3]=+a[4]);return o},Y=function(e){var t;return t=e[3]<1?"rgba":"rgb","rgb"===t?t+"("+e.slice(0,3).map(ye).join(",")+")":"rgba"===t?t+"("+e.slice(0,3).map(ye).join(",")+","+e[3]+")":void 0},me=function(e){return ye(100*e)/100},T=function(e,t){var i;return i=t<1?"hsla":"hsl",e[0]=me(e[0]||0),e[1]=me(100*e[1])+"%",e[2]=me(100*e[2])+"%","hsla"===i&&(e[3]=t),i+"("+e.join(",")+")"},h.css=function(e){return p(e)},ae.css=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["css"]),function(){})},I.prototype.css=function(e){return null==e&&(e="rgb"),"rgb"===e.slice(0,3)?Y(this._rgb):"hsl"===e.slice(0,3)?T(this.hsl(),this.alpha()):void 0},h.named=function(e){return x(ke[e])},u.push({p:5,test:function(e){if(1===arguments.length&&null!=ke[e])return"named"}}),I.prototype.name=function(e){var t,i;arguments.length&&(ke[e]&&(this._rgb=x(ke[e])),this._rgb[3]=1),t=this.hex("rgb");for(i in ke)if(t===ke[i])return i;return t},H=function(){var e,t,i,n;return n=Te(arguments),i=n[0],e=n[1],t=n[2],t*=r,[i,P(t)*e,be(t)*e]},B=function(){var e,t,i,n,r,a,s,o,l,c,u;return i=Te(arguments),o=i[0],r=i[1],s=i[2],c=H(o,r,s),e=c[0],t=c[1],n=c[2],u=F(e,t,n),l=u[0],a=u[1],n=u[2],[l,a,n,i.length>3?i[3]:1]},R=function(){var e,t,i,n,r,a;return a=Te(arguments),r=a[0],e=a[1],t=a[2],i=we(e*e+t*t),n=(A(t,e)*s+360)%360,0===ye(1e4*i)&&(n=Number.NaN),[r,i,n]},ue=function(){var e,t,i,n,r,a,s;return a=Te(arguments),r=a[0],i=a[1],t=a[2],s=ne(r,i,t),n=s[0],e=s[1],t=s[2],R(n,e,t)},ae.lch=function(){var e;return e=Te(arguments),new I(e,"lch")},ae.hcl=function(){var e;return e=Te(arguments),new I(e,"hcl")},h.lch=B,h.hcl=function(){var e,t,i,n;return n=Te(arguments),t=n[0],e=n[1],i=n[2],B([i,e,t])},I.prototype.lch=function(){return ue(this._rgb)},I.prototype.hcl=function(){return ue(this._rgb).reverse()},X=function(e){var t,i,n,r,a,s,o,l,c;return null==e&&(e="rgb"),l=Te(arguments),o=l[0],r=l[1],t=l[2],o/=255,r/=255,t/=255,a=1-Math.max(o,Math.max(r,t)),n=a<1?1/(1-a):0,i=(1-o-a)*n,s=(1-r-a)*n,c=(1-t-a)*n,[i,s,c,a]},a=function(){var e,t,i,n,r,a,s,o,l;return t=Te(arguments),n=t[0],s=t[1],l=t[2],a=t[3],e=t.length>4?t[4]:1,1===a?[0,0,0,e]:(o=n>=1?0:255*(1-n)*(1-a),r=s>=1?0:255*(1-s)*(1-a),i=l>=1?0:255*(1-l)*(1-a),[o,r,i,e])},h.cmyk=function(){return a(Te(arguments))},ae.cmyk=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["cmyk"]),function(){})},I.prototype.cmyk=function(){return X(this._rgb)},h.gl=function(){var e,i,t,n,r;for(n=function(){var e,t;e=Te(arguments),t=[];for(i in e)r=e[i],t.push(r);return t}.apply(this,arguments),e=t=0;t<=2;e=++t)n[e]*=255;return n},ae.gl=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["gl"]),function(){})},I.prototype.gl=function(){var e;return e=this._rgb,[e[0]/255,e[1]/255,e[2]/255,e[3]]},de=function(e,t,i){var n;return n=Te(arguments),e=n[0],t=n[1],i=n[2],e=G(e),t=G(t),i=G(i),.2126*e+.7152*t+.0722*i},G=function(e){return e/=255,e<=.03928?e/12.92:ce((e+.055)/1.055,2.4)},N=function(e,t,i,n){var r,a;return r=e._rgb,a=t._rgb,new I(r[0]+i*(a[0]-r[0]),r[1]+i*(a[1]-r[1]),r[2]+i*(a[2]-r[2]),n)},l.push(["rgb",N]),I.prototype.luminance=function(r,a){var e,s,o,t,l;return null==a&&(a="rgb"),arguments.length?(t=this._rgb,0===r?t=[0,0,0,this._rgb[3]]:1===r?t=[255,255,255,this[3]]:(e=de(this._rgb),s=1e-7,o=20,l=function(e,t){var i,n;return n=e.interpolate(t,.5,a),i=n.luminance(),Math.abs(r-i)<s||!o--?n:i>r?l(e,n):l(n,t)},t=e>r?l(ae("black"),this).rgba():l(this,ae("white")).rgba()),ae(t).alpha(this.alpha())):de(this._rgb)},xe=function(e){var t,i,n,r;return r=e/100,r<66?(n=255,i=-155.25485562709179-.44596950469579133*(i=r-2)+104.49216199393888*oe(i),t=r<20?0:.8274096064007395*(t=r-10)-254.76935184120902+115.67994401066147*oe(t)):(n=351.97690566805693+.114206453784165*(n=r-55)-40.25366309332127*oe(n),i=325.4494125711974+.07943456536662342*(i=r-50)-28.0852963507957*oe(i),t=255),[n,i,t]},fe=function(){var e,t,i,n,r,a,s,o;for(a=Te(arguments),r=a[0],a[1],e=a[2],n=1e3,i=4e4,t=.4;i-n>t;)o=.5*(i+n),s=xe(o),s[2]/s[0]>=e/r?i=o:n=o;return ye(o)},ae.temperature=ae.kelvin=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["temperature"]),function(){})},h.temperature=h.kelvin=h.K=xe,I.prototype.temperature=function(){return fe(this._rgb)},I.prototype.kelvin=I.prototype.temperature,ae.contrast=function(e,t){var i,n,r,a;return"string"!==(r=Ce(e))&&"number"!==r||(e=new I(e)),"string"!==(a=Ce(t))&&"number"!==a||(t=new I(t)),i=e.luminance(),n=t.luminance(),i>n?(i+.05)/(n+.05):(n+.05)/(i+.05)},ae.distance=function(e,t,i){var n,r,a,s,o,l,c;null==i&&(i="lab"),"string"!==(o=Ce(e))&&"number"!==o||(e=new I(e)),"string"!==(l=Ce(t))&&"number"!==l||(t=new I(t)),a=e.get(i),s=t.get(i),c=0;for(r in a)n=(a[r]||0)-(s[r]||0),c+=n*n;return Math.sqrt(c)},ae.deltaE=function(e,t,i,n){var r,a,s,o,l,c,u,d,h,f,p,g,m,v,y,_,b,w,x,C,T,k,M,S,L,D,j;for(null==i&&(i=1),null==n&&(n=1),"string"!==(b=Ce(e))&&"number"!==b||(e=new I(e)),"string"!==(w=Ce(t))&&"number"!==w||(t=new I(t)),x=e.lab(),r=x[0],s=x[1],l=x[2],C=t.lab(),a=C[0],o=C[1],c=C[2],u=we(s*s+l*l),d=we(o*o+c*c),M=r<16?.511:.040975*r/(1+.01765*r),T=.0638*u/(1+.0131*u)+.638,_=u<1e-6?0:180*A(l,s)/E;_<0;)_+=360;for(;_>=360;)_-=360;return S=_>=164&&_<=345?.56+re(.2*P(E*(_+168)/180)):.36+re(.4*P(E*(_+35)/180)),h=u*u*u*u,y=we(h/(h+1900)),k=T*(y*S+1-y),v=r-a,m=u-d,p=s-o,g=l-c,f=p*p+g*g-m*m,L=v/(i*M),D=m/(n*T),j=k,we(L*L+D*D+f/(j*j))},I.prototype.get=function(e){var t,i,n,r,a,s;return n=this,a=e.split("."),r=a[0],t=a[1],s=n[r](),t?(i=r.indexOf(t),i>-1?s[i]:console.warn("unknown channel "+t+" in mode "+r)):s},I.prototype.set=function(e,t){var i,n,r,a,s,o;if(r=this,s=e.split("."),a=s[0],i=s[1],i)if(o=r[a](),(n=a.indexOf(i))>-1)if("string"===Ce(t))switch(t.charAt(0)){case"+":case"-":o[n]+=+t;break;case"*":o[n]*=+t.substr(1);break;case"/":o[n]/=+t.substr(1);break;default:o[n]=+t}else o[n]=t;else console.warn("unknown channel "+i+" in mode "+a);else o=t;return ae(o,a).alpha(r.alpha())},I.prototype.clipped=function(){return this._rgb._clipped||!1},I.prototype.alpha=function(e){return arguments.length?ae.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},I.prototype.darken=function(e){var t,i;return null==e&&(e=1),i=this,t=i.lab(),t[0]-=c.Kn*e,ae.lab(t).alpha(i.alpha())},I.prototype.brighten=function(e){return null==e&&(e=1),this.darken(-e)},I.prototype.darker=I.prototype.darken,I.prototype.brighter=I.prototype.brighten,I.prototype.saturate=function(e){var t,i;return null==e&&(e=1),i=this,t=i.lch(),t[1]+=e*c.Kn,t[1]<0&&(t[1]=0),ae.lch(t).alpha(i.alpha())},I.prototype.desaturate=function(e){return null==e&&(e=1),this.saturate(-e)},I.prototype.premultiply=function(){var e,t;return t=this.rgb(),e=this.alpha(),ae(t[0]*e,t[1]*e,t[2]*e,e)},n=function(e,t,i){if(!n[i])throw"unknown blend mode "+i;return n[i](e,t)},e=function(r){return function(e,t){var i,n;return i=ae(t).rgb(),n=ae(e).rgb(),ae(r(i,n),"rgb")}},b=function(a){return function(e,t){var i,n,r;for(r=[],i=n=0;n<=3;i=++n)r[i]=a(e[i],t[i]);return r}},$=function(e,t){return e},U=function(e,t){return e*t/255},m=function(e,t){return e>t?t:e},W=function(e,t){return e>t?e:t},_e=function(e,t){return 255*(1-(1-e/255)*(1-t/255))},Q=function(e,t){return t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255))},t=function(e,t){return 255*(1-(1-t/255)/(e/255))},_=function(e,t){return 255===e?255:(e=t/255*255/(1-e/255),e>255?255:e)},n.normal=e(b($)),n.multiply=e(b(U)),n.screen=e(b(_e)),n.overlay=e(b(Q)),n.darken=e(b(m)),n.lighten=e(b(W)),n.dodge=e(b(_)),n.burn=e(b(t)),ae.blend=n,ae.analyze=function(e){var t,i,n,r;for(n={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},i=0,t=e.length;i<t;i++)null==(r=e[i])||isNaN(r)||(n.values.push(r),n.sum+=r,r<n.min&&(n.min=r),r>n.max&&(n.max=r),n.count+=1);return n.domain=[n.min,n.max],n.limits=function(e,t){return ae.limits(n,e,t)},n},ae.scale=function(u,e){var d,h,f,t,p,g,m,v,y,_,i,b,w,s,x,C,T,k,o,n,M;return y="rgb",_=ae("#ccc"),s=0,!1,p=[0,1],w=[],b=[0,0],d=!1,f=[],i=!1,v=0,m=1,t=!1,h={},x=!0,g=1,n=function(e){var t,i,n,r,a,s;if(null==e&&(e=["#fff","#000"]),null!=e&&"string"===Ce(e)&&null!=ae.brewer&&(e=ae.brewer[e]||ae.brewer[e.toLowerCase()]||e),"array"===Ce(e)){for(1===e.length&&(e=[e[0],e[0]]),e=e.slice(0),t=n=0,r=e.length-1;0<=r?n<=r:n>=r;t=0<=r?++n:--n)i=e[t],"string"===Ce(i)&&(e[t]=ae(i));for(w.length=0,t=s=0,a=e.length-1;0<=a?s<=a:s>=a;t=0<=a?++s:--s)w.push(t/(e.length-1))}return o(),f=e},T=function(e){var t,i;if(null!=d){for(i=d.length-1,t=0;t<i&&e>=d[t];)t++;return t-1}return 0},M=function(e){return e},function(e){var t,i,n,r,a;return a=e,d.length>2&&(r=d.length-1,t=T(e),n=d[0]+(d[1]-d[0])*(0+.5*s),i=d[r-1]+(d[r]-d[r-1])*(1-.5*s),a=v+(d[t]+.5*(d[t+1]-d[t])-n)/(i-n)*(m-v)),a},k=function(e,t){var i,n,r,a,s,o,l,c;if(null==t&&(t=!1),isNaN(e)||null===e)return _;if(t?c=e:d&&d.length>2?(i=T(e),c=i/(d.length-2)):c=m!==v?(e-v)/(m-v):1,t||(c=M(c)),1!==g&&(c=ce(c,g)),c=b[0]+c*(1-b[0]-b[1]),c=Math.min(1,Math.max(0,c)),a=Math.floor(1e4*c),x&&h[a])n=h[a];else{if("array"===Ce(f))for(r=s=0,l=w.length-1;0<=l?s<=l:s>=l;r=0<=l?++s:--s){if(o=w[r],c<=o){n=f[r];break}if(c>=o&&r===w.length-1){n=f[r];break}if(c>o&&c<w[r+1]){c=(c-o)/(w[r+1]-o),n=ae.interpolate(f[r],f[r+1],c,y);break}}else"function"===Ce(f)&&(n=f(c));x&&(h[a]=n)}return n},o=function(){return h={}},n(u),C=function(e){var t;return t=ae(k(e)),i&&t[i]?t[i]():t},C.classes=function(e){var t;return null!=e?("array"===Ce(e)?(d=e,p=[e[0],e[e.length-1]]):(t=ae.analyze(p),d=0===e?[t.min,t.max]:ae.limits(t,"e",e)),C):d},C.domain=function(e){var t,i,n,r,a,s,o;if(!arguments.length)return p;if(v=e[0],m=e[e.length-1],w=[],n=f.length,e.length===n&&v!==m)for(a=0,r=e.length;a<r;a++)i=e[a],w.push((i-v)/(m-v));else for(t=o=0,s=n-1;0<=s?o<=s:o>=s;t=0<=s?++o:--o)w.push(t/(n-1));return p=[v,m],C},C.mode=function(e){return arguments.length?(y=e,o(),C):y},C.range=function(e,t){return n(e,t),C},C.out=function(e){return i=e,C},C.spread=function(e){return arguments.length?(s=e,C):s},C.correctLightness=function(e){return null==e&&(e=!0),t=e,o(),M=t?function(e){var t,i,n,r,a,s,o,l,c;for(t=k(0,!0).lab()[0],i=k(1,!0).lab()[0],o=t>i,n=k(e,!0).lab()[0],a=t+(i-t)*e,r=n-a,l=0,c=1,s=20;Math.abs(r)>.01&&s-- >0;)!function(){o&&(r*=-1),r<0?(l=e,e+=.5*(c-e)):(c=e,e+=.5*(l-e)),n=k(e,!0).lab()[0],r=n-a}();return e}:function(e){return e},C},C.padding=function(e){return null!=e?("number"===Ce(e)&&(e=[e,e]),b=e,C):b},C.colors=function(t,i){var n,r,e,a,s,o,l,c;if(arguments.length<2&&(i="hex"),s=[],0===arguments.length)s=f.slice(0);else if(1===t)s=[C(.5)];else if(t>1)r=p[0],n=p[1]-r,s=function(){o=[];for(var e=0;0<=t?e<t:e>t;0<=t?e++:e--)o.push(e);return o}.apply(this).map(function(e){return C(r+e/(t-1)*n)});else{if(u=[],l=[],d&&d.length>2)for(e=c=1,a=d.length;1<=a?c<a:c>a;e=1<=a?++c:--c)l.push(.5*(d[e-1]+d[e]));else l=p;s=l.map(function(e){return C(e)})}return ae[i]&&(s=s.map(function(e){return e[i]()})),s},C.cache=function(e){return null!=e?(x=e,C):x},C.gamma=function(e){return null!=e?(g=e,C):g},C.nodata=function(e){return null!=e?(_=ae(e),C):_},C},null==ae.scales&&(ae.scales={}),ae.scales.cool=function(){return ae.scale([ae.hsl(180,1,.9),ae.hsl(250,.7,.4)])},ae.scales.hot=function(){return ae.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},ae.analyze=function(e,i,n){var r,t,a,s,o,l,c;if(o={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},null==n&&(n=function(){return!0}),r=function(e){null==e||isNaN(e)||(o.values.push(e),o.sum+=e,e<o.min&&(o.min=e),e>o.max&&(o.max=e),o.count+=1)},c=function(e,t){if(n(e,t))return r(null!=i&&"function"===Ce(i)?i(e):null!=i&&"string"===Ce(i)||"number"===Ce(i)?e[i]:e)},"array"===Ce(e))for(s=0,a=e.length;s<a;s++)l=e[s],c(l);else for(t in e)l=e[t],c(l,t);return o.domain=[o.min,o.max],o.limits=function(e,t){return ae.limits(o,e,t)},o},ae.limits=function(e,t,i){var n,r,a,s,o,l,c,u,d,h,f,p,g,m,v,y,_,b,w,x,C,T,k,M,S,L,D,j,I,E,A,P,O,N,R,F,z,H,B,W,q,G,V,U,$,J,Q,X,Y,Z,K,ee,te,ie,ne;if(null==t&&(t="equal"),null==i&&(i=7),"array"===Ce(e)&&(e=ae.analyze(e)),S=e.min,le=e.max,e.sum,ie=e.values.sort(function(e,t){return e-t}),1===i)return[S,le];if(k=[],"c"===t.substr(0,1)&&(k.push(S),k.push(le)),"e"===t.substr(0,1)){for(k.push(S),x=A=1,R=i-1;1<=R?A<=R:A>=R;x=1<=R?++A:--A)k.push(S+x/i*(le-S));k.push(le)}else if("l"===t.substr(0,1)){if(S<=0)throw"Logarithmic scales are only possible for values > 0";for(L=Math.LOG10E*oe(S),M=Math.LOG10E*oe(le),k.push(S),x=ne=1,F=i-1;1<=F?ne<=F:ne>=F;x=1<=F?++ne:--ne)k.push(ce(10,L+x/i*(M-L)));k.push(le)}else if("q"===t.substr(0,1)){for(k.push(S),x=n=1,G=i-1;1<=G?n<=G:n>=G;x=1<=G?++n:--n)P=(ie.length-1)*x/i,O=se(P),O===P?k.push(ie[O]):(N=P-O,k.push(ie[O]*(1-N)+ie[O+1]*N));k.push(le)}else if("k"===t.substr(0,1)){for(j=ie.length,m=new Array(j),b=new Array(i),Z=!0,I=0,y=null,y=[],y.push(S),x=r=1,V=i-1;1<=V?r<=V:r>=V;x=1<=V?++r:--r)y.push(S+x/i*(le-S));for(y.push(le);Z;){for(C=a=0,U=i-1;0<=U?a<=U:a>=U;C=0<=U?++a:--a)b[C]=0;for(x=s=0,$=j-1;0<=$?s<=$:s>=$;x=0<=$?++s:--s){for(te=ie[x],D=Number.MAX_VALUE,C=o=0,J=i-1;0<=J?o<=J:o>=J;C=0<=J?++o:--o)(w=re(y[C]-te))<D&&(D=w,v=C);b[v]++,m[x]=v}for(E=new Array(i),C=l=0,Q=i-1;0<=Q?l<=Q:l>=Q;C=0<=Q?++l:--l)E[C]=null;for(x=c=0,X=j-1;0<=X?c<=X:c>=X;x=0<=X?++c:--c)_=m[x],null===E[_]?E[_]=ie[x]:E[_]+=ie[x];for(C=u=0,Y=i-1;0<=Y?u<=Y:u>=Y;C=0<=Y?++u:--u)E[C]*=1/b[C];for(Z=!1,C=d=0,z=i-1;0<=z?d<=z:d>=z;C=0<=z?++d:--d)if(E[C]!==y[x]){Z=!0;break}y=E,I++,I>200&&(Z=!1)}for(T={},C=h=0,H=i-1;0<=H?h<=H:h>=H;C=0<=H?++h:--h)T[C]=[];for(x=f=0,B=j-1;0<=B?f<=B:f>=B;x=0<=B?++f:--f)_=m[x],T[_].push(ie[x]);for(K=[],C=p=0,W=i-1;0<=W?p<=W:p>=W;C=0<=W?++p:--p)K.push(T[C][0]),K.push(T[C][T[C].length-1]);for(K=K.sort(function(e,t){return e-t}),k.push(K[0]),x=g=1,q=K.length-1;g<=q;x=g+=2)ee=K[x],isNaN(ee)||-1!==k.indexOf(ee)||k.push(ee)}return k},C=function(e,t,i){var n,r,a,s;return n=Te(arguments),e=n[0],t=n[1],i=n[2],isNaN(e)&&(e=0),e/=360,e<1/3?(r=(1-t)/3,s=(1+t*P(v*e)/P(o-v*e))/3,a=1-(r+s)):e<2/3?(e-=1/3,s=(1-t)/3,a=(1+t*P(v*e)/P(o-v*e))/3,r=1-(s+a)):(e-=2/3,a=(1-t)/3,r=(1+t*P(v*e)/P(o-v*e))/3,s=1-(a+r)),s=q(i*s*3),a=q(i*a*3),r=q(i*r*3),[255*s,255*a,255*r,n.length>3?n[3]:1]},ee=function(){var e,t,i,n,r,a,s,o;return s=Te(arguments),a=s[0],t=s[1],e=s[2],v=2*Math.PI,a/=255,t/=255,e/=255,r=Math.min(a,t,e),n=(a+t+e)/3,o=1-r/n,0===o?i=0:(i=(a-t+(a-e))/2,i/=Math.sqrt((a-t)*(a-t)+(a-e)*(t-e)),i=Math.acos(i),e>t&&(i=v-i),i/=v),[360*i,o,n]},ae.hsi=function(){return function(e,t,i){i.prototype=e.prototype;var n=new i,r=e.apply(n,t);return Object(r)===r?r:n}(I,Le.call(arguments).concat(["hsi"]),function(){})},h.hsi=C,I.prototype.hsi=function(){return ee(this._rgb)},L=function(e,t,i,n){var r,a,s,o,l,c,u,d,h,f,p,g;return"hsl"===n?(p=e.hsl(),g=t.hsl()):"hsv"===n?(p=e.hsv(),g=t.hsv()):"hcg"===n?(p=e.hcg(),g=t.hcg()):"hsi"===n?(p=e.hsi(),g=t.hsi()):"lch"!==n&&"hcl"!==n||(n="hcl",p=e.hcl(),g=t.hcl()),"h"===n.substr(0,1)&&(s=p[0],h=p[1],c=p[2],o=g[0],f=g[1],u=g[2]),isNaN(s)||isNaN(o)?isNaN(s)?isNaN(o)?a=Number.NaN:(a=o,1!==c&&0!==c||"hsv"===n||(d=f)):(a=s,1!==u&&0!==u||"hsv"===n||(d=h)):(r=o>s&&o-s>180?o-(s+360):o<s&&s-o>180?o+360-s:o-s,a=s+i*r),null==d&&(d=h+i*(f-h)),l=c+i*(u-c),ae[n](a,d,l)},l=l.concat(function(){var e,t,i,n;for(i=["hsv","hsl","hsi","hcl","lch","hcg"],n=[],t=0,e=i.length;t<e;t++)V=i[t],n.push([V,L]);return n}()),O=function(e,t,i,n){var r,a;return r=e.num(),a=t.num(),ae.num(r+(a-r)*i,"num")},l.push(["num",O]),D=function(e,t,i,n){var r,a;return r=e.lab(),a=t.lab(),new I(r[0]+i*(a[0]-r[0]),r[1]+i*(a[1]-r[1]),r[2]+i*(a[2]-r[2]),n)},l.push(["lab",D])}).call(this);(function(p,h,g,l){var t=new p.Deferred,i=false,n=/([!"#$%&'()*+,.\/:;<=>?@\[\\\]^`{|}~])/g,e=new p.Deferred,f,r,a,s;p(function(){if(g.oauth2&&!g.oauth2.thisIsOauthFrame()){t.resolveWith(g,[g])}});g=p.extend(g,{exposeJQuery:function(){return p},ready:function(e){if(arguments.length===0){return t.promise()}if(typeof e==="function"){t.done(e)}return this},includeCss:function(e,t){var i=new p.Deferred,n=h.document.getElementsByTagName("head")[0],r=document.createElement("link"),a=function(){if(typeof t==="function"&&i.state()==="pending"){t()}i.resolve()};e+=(e.indexOf("?")>-1?"&":"?")+"_nch="+giscloud_config.nch;r.setAttribute("rel","stylesheet");r.setAttribute("type","text/css");r.setAttribute("href",e);r.onreadystatechange=function(){if(r.readyState==="complete"||r.readyState==="loaded"){a()}};if(r.addEventListener){r.addEventListener("load",function(){a()},false)}r.onload=function(){a()};n.appendChild(r);return i.promise()},includeJs:function(e,t,i){var n=new p.Deferred,r=document.getElementsByTagName("head")[0],a=document.createElement("script"),s=function(){if(typeof t==="function"&&n.state()==="pending"){t()}n.resolve()};if(!i){e+=(e.indexOf("?")>-1?"&":"?")+"_nch="+giscloud_config.nch}a.setAttribute("type","text/javascript");a.setAttribute("src",e);a.onreadystatechange=function(){if(a.readyState==="complete"||a.readyState==="loaded"){s()}};if(a.addEventListener){a.addEventListener("load",function(){s()},false)}a.onload=function(){s()};r.appendChild(a);return n.promise()},prefetchAsset:function(e,t){var i=document.createElement("link");i.href=t+(t.indexOf("?")>-1?"&":"?")+"_nch="+giscloud_config.nch;i.rel="prefetch";i.as=e;document.head.appendChild(i)},formats:{IFRAME:"iframe",HTML:"iframe",PNG:"png",JPEG:"jpg",SHAPEFILE:"shp",GPX:"gpx",MIF:"mif",GML:"gml",exportFormats:{SHAPEFILE:"shp",GPX:"gpx",MIF:"mif",GML:"gml"},renderFormats:{IFRAME:"iframe",PNG:"png",JPEG:"jpg"}},toMeterRatios:{km:1e3,m:1,meter:1,dm:1/10,cm:1/100,mm:1/1e3,kmi:1852,in:.0254,inch:.0254,ft:.3048,foot:.3048,feet:.3048,yd:.9144,yard:.9144,mi:1609.344,mile:1609.344,fath:1.8288,fathom:1.8288,ch:20.1168,link:.201168,"us-in":1/39.37,"inch us":1/39.37,"us-ft":.304800609601219,foot_us:.304800609601219,"us-yd":.914401828803658,"us-ch":20.11684023368047,"us-mi":1609.347218694437,"ind-yd":.91439523,"ind-ft":.30479841,"ind-ch":20.11669506},toSqMeterRatio:{acre:24711e-8,ha:1e-4,hectare:1e-4},fromSquareMeter:function(e,t){var i=g.toSqMeterRatio[e];var n=e&&i;var r;if(!n){console.log("Unknown unit.");return null}return t*i},toMeters:function(e,t,i){var n=g.toMeterRatios[e];var r=e&&n;var a;if(!r){console.log("Unknown unit.");return null}return t*(i?Math.pow(n,2):n)},fromMeters:function(e,t,i){var n=g.toMeters(e,1/t,i);return n&&1/n||null},apiKey:function(e){if(typeof e=="string"){a=e;return this}else{return a}},appInstanceId:function(e){if(typeof e=="number"){s=e;return this}else{return s}},logDeferredResults:function(t,i,n,r){var e,a=function(){console.log("DONE",arguments)},s=function(){console.log("FAIL",arguments)},o=function(){console.log("PROGRESS",arguments)};try{if(p.isFunction(t.done)&&p.isFunction(t.fail)){if(i!=null&&n==null&&r==null){r=i;i=null}e=t}else{if(n===l){n=h}if(i==null){i=[]}else if(!p.isArray(i)){i=[i]}e=t.apply(n,i)}if(p.isFunction(e.done)&&p.isFunction(e.fail)){e.done(a);e.fail(s);e.progress(o);if(r){e.done(function(e){if(typeof r=="string"){h[r]=e}else{r=e}})}}else{console.log("NOT DEFERRED",e)}}catch(e){console.log("ERROR",e,t,i,n)}},browserSupportsGL:function(){return f.supportedMapbox()},common:function(){return f}});g.sessid=function(){var e=document.cookie,t=e&&e.match&&e.match(/PHPSESSID=([^ ;]+)/);return t&&t[1]||null};g.construct=function(e,t){var i={};if(t){if(p.isArray(t)){p.each(t,function(e,t){p.extend(i,t)})}else{p.extend(i,t)}}i.higher=i;e.prototype=i;return e};f={restHost:function(){return giscloud_config.restHost()},apiHost:function(){return giscloud_config.apiHost()},authHost:function(){return giscloud_config.authHost()},liveSite:function(){return giscloud_config.liveSite()},assetsSite:function(){return giscloud_config.assetsSite()},tileSite:function(){return giscloud_config.tileSite()},https:function(){return giscloud_config.https},isMobileBrowser:/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)),clone:function(e){var t=function(){};p.extend(true,t.prototype,e);return new t},bindFirst:function(e,t,i){var n,r;e.on(t,i);e.each(function(){n=p._data(this,"events")[t.split(".")[0]];r=n.pop();n.splice(0,0,r)});return e},oid:function(){var e=Math.random,t=Math.ceil,i=(p.now().toString()+t(e()*1e5)).substr(3),n=t(e()*15);return i.substr(n)+i.substr(0,n)},setError:function(e,t,i){if(e.errors===l){e.errors=[]}e.errors.push({time:new Date,src:t,msg:i})},__:function(e){var t;if(!h.gclang)return e;t=e.replace(/[ ,.?!;:'\\+\-()]/g,"_");t=t.replace(/\&/g,"and");return t in gclang?gclang[t]:e},getMapHighlightColor:function(e){var t=e.parent&&e.parent.options,i=t&&t["HIGHLIGHT_COLOR"];return i?parseInt(i,16):null},getLayerHighlightColor:function(e,t){var i=e.parent&&e.parent.layerById(t),n=i&&i.options||[],r,a,s,o;for(s=0,o=n.length;s<o;s++){a=n[s];if(a.option_name==="HIGHLIGHT_COLOR"){r=parseInt(a.option_value,16);break}}return isNaN(r)?null:r},highlight:function(e,t,i,n){var r=i&&this.getLayerHighlightColor(e,i)||this.getMapHighlightColor(e)||"selectcolor";e.modifyObject(t.toString(),{color:r,alpha:100,from_color:13421772,glow:{color:65280,strength:2,blurX:10,blurY:10}},i===null?"":"layer"+i+"||",n)},highlightMultiple:function(e,t,i,n){var r=i&&this.getLayerHighlightColor(e,i)||this.getMapHighlightColor(e)||"selectcolor";e.modifyObject(t.join(),{color:r,alpha:100,from_color:13421772,glow:{color:65280,strength:2,blurX:10,blurY:10}},i===null?"":"layer"+i+"||",n)},getHighlightAndSelectColors:function(e){var t;if(e&&e.length){t=g.Color.fromString(e);return[t.brighter(15).hex(),"#C9FFE5"]}return null},deferreds:{},refs:{},toXml:function(e,t){var i="",n,r,a;if(t===null||t===l||t===""){return"<"+e+"/>"}else if(typeof t==="object"){i+="<"+e+">";if(p.isArray(t)){if(e[e.length-1]==="s"){a=e.substr(0,e.length-1)}else{a=e}for(n=0,r=t.length;n<r;n++){i+=this.toXml(a,t[n])}}else{for(n in t){if(t.hasOwnProperty(n)){i+=this.toXml(n,t[n])}}}i+="</"+e+">"}else{i+="<"+e+">"+t.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;")+"</"+e+">"}return i},debounce:function e(i,n,r,a){var s,t;r=r||h;a=p.isArray(a)?a:a==null?[]:[a];t=function(){var e,t;if(s){clearTimeout(s)}if(p.isFunction(Function.prototype.bind)){e=[r].concat(Array.prototype.slice.apply(arguments),a);s=setTimeout(i.bind.apply(i,e),n)}else{t=function(){i.apply(r,Array.prototype.slice.apply(arguments).concat(a))};t.name=(i.name||"")+"wrapped";s=setTimeout(t,n)}};t.name=(i.name||"")+"debounced";return t},haversine:function(e,t,i,n,r){var a=Math.PI/180,s=(i-e)*a,o=(n-t)*a,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e*a)*Math.cos(i*a)*Math.sin(o/2)*Math.sin(o/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));r=r||6371e3;return r*c},zoomToBounds:function(e,t){var i=1300,n,r,a;r=e.instance.getLayer(0);if(r){a=r.getCurrentLevel()}if(t.isPoint()){if(a>10){e.center(t.center())}else{n=e.bounds().clone().center(t.center()).width(i,true)}}else{n=t}e.bounds(n,true)},viewerShowFeatureInfo:function(){function h(n){var r,e=n.meta&&n.meta.columns;if(!e){return n.data}r={};p.each(e,function(e,t){var i=t.alias||t.field;if(t.field==="FID"){r[i]=n.id}else if(t.field==="OWNER"){r[i]=n.owner||""}else if(t.field==="CREATED"){r[i]=n.created.toLocaleString()}else if(t.field==="MODIFIED"){r[i]=n.created.toLocaleString()}else{r[i]=n.data[i]}});return r}function f(e,t){var i=/^(((\S+)?)(@|mailto\:|(news|(ht|f)tp(s?))\:\/\/)\S+)$/i,n=/^<a href=['"]javascript:;['"] onclick=['"]fn\.showMedia\(\{url:\[['"][\w:\/.]+['"]\][\w, :]+\}\);return false;["']\s+>[\w<> ='"-\/]+<\/a>$/;e=e==null?"null":e;if(g.ui.map&&n.test(e)){return p("<tr/>").append(p("<td/>",{class:"gc-info-key-cell",title:t}).text(t),p("<td/>",{class:"gc-info-value-cell"}).append(p(e)))}if(i.test(e)){return p("<tr/>").append(p("<td/>",{class:"gc-info-key-cell",title:t}).text(t),p("<td/>",{class:"gc-info-value-cell"}).append(p("<a/>",{href:e,target:"_blank"}).html(e)))}return p("<tr/>").append(p("<td/>",{class:"gc-info-key-cell",title:t}).text(t),p("<td/>",{class:"gc-info-value-cell",title:e}).html(e))}return function e(l,c,t,i,u){var d=this,n;if(!(l instanceof g.Viewer))throw"Invalid viewer param";if(!c)throw"No layerId param.";if(!t)throw"No feature param.";if(typeof t==="object")n=p.Deferred().resolve(t);else n=g.features.byId(c,t,{format:true});n.done(function(e){var t,i,n,r,a=p(d).data("marker"),s=p(d).data("lastLonLat"),o=s||e.bounds.center();if(a){l.removeMarker(a)}t=p("<div/>");r=l.layerById(c);p("<table/>",{class:"gc-info-popup-content-table"}).append(p('<thead class="gc-visually-hidden"><tr><th scope="col">Attribute</th><th scope="col">Value</th></tr></thead>')).append(e.meta&&e.meta.columns?p.map(h(e),f):p.map(e.data,f)).appendTo(t);i=r&&r.name||"";n=t.html();if(p.isFunction(u)){n=u.call(t,{feature:e,layer:r,content:n,position:o})}a=new g.FlagMarker(o,i,n);l.addMarker(a);p(d).data("marker",a)})}}(),rest:function(){var d=function(e){var t=e||{};if(t.sort){if(typeof t.sort==="string"||t.sort.length===l){t.order_by=t.sort}else{t.order_by=t.sort.join()}delete t.sort}if(t.page||t.perPage){t.page=t.page||1;t.perpage=t.perPage||10;delete t.perPage}if(t.field&&t.field.length&&t.value&&t.value.length){t.where=t.field+"='"+t.value+"'";delete t.field;delete t.value}if(t.expand&&p.isArray(t.expand)){t.expand=t.expand.join(",")}return t};this.url=function(e){var t=document.location,i=t.protocol+"//"+t.host,n=f.liveSite().indexOf(i)===0,r=f.liveSite().indexOf(f.apiHost())===0,a=f.liveSite().indexOf(f.restHost())===0,s;if(n&&!r&&!a){s=f.liveSite()+"rest/1/"}else if(r){s=f.apiHost()+"/1/"}else{s=f.restHost()+"/1/"}if(g.offlineMode()){s=s.replace(/http.?:\/\//,"giscloud://")}if(typeof e==="string"){return s+e}else{return s}};this.local=function(e,t,i,n,r,a,s){var o,l,c={};l=this.url(i);o=new p.Deferred;if(s&&f.https()){if(l.indexOf("https:")!==0){l=l.replace("http:","https:")}if(n.api_key||a){c["API-key"]=n.api_key||a;delete n.api_key}else if(!n.oauth_token&&r){n.oauth_token=r}else{c["API-sessid"]=g.sessid()}}if(e==="get"||e==="GET"){if(g.offlineMode()){var u=l.split(",");giscloudOffline.getRest([l],function(){var t=Array.prototype.slice.apply(arguments);if(t[0]===""){o.reject.apply(o,["Response is empty."])}else{try{t[0]=h.JSON.parse(t[0]);o.resolve.apply(o,t)}catch(e){o.reject.apply(o,[e].concat(t))}}},function(){var e=Array.prototype.slice.apply(arguments);o.reject.apply(o,e)})}else{p.ajax({url:l,type:"GET",cache:false,dataType:"json",data:n,headers:c}).done(function(){var e=Array.prototype.slice.apply(arguments);o.resolve.apply(o,e)}).fail(function(){var e=Array.prototype.slice.apply(arguments);o.reject.apply(o,e)})}}else{if(t==="application/json"&&p.isPlainObject(n)){n=JSON.stringify(n)}p.ajax({url:l,type:e,cache:false,dataType:"json",accept:"application/json",contentType:t||"application/x-www-form-urlencoded",data:n,headers:c}).success(function(e,t,i){o.resolve(e,i.getResponseHeader("Location"))}).error(function(e,t,i){var n,r,a,s;if(e.responseText===""&&(e.status===201||e.status===204)){o.resolve(null,e.getResponseHeader("Location"));return}if(e.getResponseHeader("Content-Type")==="application/json"){n=JSON.parse(e.responseText);r=n.code;a=n.msg;s=n.nested}else if(/\/xml$/i.test(e.getResponseHeader("Content-Type"))){n=p(e.responseText);r=n.find("code").text();a=n.find("msg").text();s=n.find("nested").text()}o.reject(e.status,t,i,r,a,s)})}return o.promise()};this.call=function(e,t,i,n,r){var a,s,o,l,c,u;i=d(i);u=g.appInstanceId();if(u){i.app_instance_id=u}o=g.oauth2.token();if(o){i.oauth_token=o}l=g.apiKey();if(l){i.api_key=l}r=!!(r||o||l);return this.local(e,n,t,i,o,l,r)};this.get=function(e,t){var i,n,r,a,s,o=false;t=d(t);r=g.oauth2.token();if(r){t.oauth_token=r}a=g.appInstanceId();if(a){t.app_instance_id=a}s=g.apiKey();if(s){t.api_key=s}if(t&&(t.forceSecure||t.api_key||t.oauth_token)){o=true}return this.local("GET",null,e,t,null,null,o)};return this}.apply({})};if(p.fn.busy){p().busy("defaults",{img:f.apiHost()+"/assets/api/1/images/busy.gif"})}g.Promise=function(e){e=e||new p.Deferred;return e.promise()};g.xssSafe=function(e){if(!e){return e}return p("<div/>",{text:e}).html()};g.escapeSelector=function(e){if(!e||!e.replace){return e}return e.replace(n,"\\$1")};g.offlineMode=function(e){if(e==null){return i&&!!h.giscloudOffline}i=e};g=g;h.out=function e(){console.log(arguments)};h.out.id=function(t){return function e(){console.log(t,arguments)}}})(jQuery.noConflict(true),window,giscloud||{});(function(r,e){"use strict";e.addEventsInterface=function e(t,i){var n;if(i==null){n=r({})}else{n=i}function a(e,t){if(typeof e==="string"){return new r.Event(e,{instance:t})}if(e instanceof r.Event){if(!e.instance){e.instance=t}return e}return null}function s(e){if(r.isFunction(n)){return r(n.call(e,e))}return r(n)}r.extend(t,{trigger:function e(t){var i=a(t,this),n=s(this),r;if(!i){throw"No event defined."}r=[i].concat(Array.prototype.slice.call(arguments,1));n.trigger.apply(n,r);return this},triggerHandler:function e(t){var i=a(t,this),n=s(this),r;if(!i){throw"No event defined."}r=[i].concat(Array.prototype.slice.call(arguments,1));n.triggerHandler.apply(n,r);return this},on:function e(){var t=s(this);t.on.apply(t,Array.prototype.slice.call(arguments));return this},off:function e(){var t=s(this);t.off.apply(t,Array.prototype.slice.call(arguments));return this},one:function e(){var t=s(this);t.one.apply(t,Array.prototype.slice.call(arguments));return this},bind:function e(){return this.on.apply(this,Array.prototype.slice.call(arguments))},unbind:function e(){return this.on.apply(this,Array.prototype.slice.call(arguments))}})}})(giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){function s(e){var t=Array.prototype.slice.call(arguments,1),i,n,r,a;for(n=0,r=t.length;n<r;n++){a=t[n]||{};for(i in a){if(a.hasOwnProperty(i)){e[i]=a[i]}}}return e}i.LayerClassSetOptions=function(e,t){e.options=s({},e.options,t);return e.options};i.LayerClass=function(){};i.LayerClass.extend=function(e){var t=function(){if(this.initialize){this.initialize.apply(this,arguments)}if(this._initHooks){this.callInitHooks()}};var i=function(){};i.prototype=this.prototype;var n=new i;n.constructor=t;t.prototype=n;for(var r in this){if(this.hasOwnProperty(r)&&r!=="prototype"){t[r]=this[r]}}if(e.statics){s(t,e.statics);delete e.statics}if(e.includes){s.apply(null,[n].concat(e.includes));delete e.includes}if(e.options&&n.options){e.options=s({},n.options,e.options)}s(n,e);n._initHooks=[];var a=this;n.callInitHooks=function(){if(this._initHooksCalled){return}if(a.prototype.callInitHooks){a.prototype.callInitHooks.call(this)}this._initHooksCalled=true;for(var e=0,t=n._initHooks.length;e<t;e++){n._initHooks[e].call(this)}};return t}})(window,giscloud.exposeJQuery(),giscloud.common());(function(window,giscloud,gcCommon){window.createFlashnavigator=function createFlashnavigator(){var flashnavigator,flashnavigator2;var fnCanvas2=function(u){"use strict";var l=giscloud.exposeJQuery(),o=[],s=0,c={handlers:[]},n=false,a=false,d=false,h=false,r=1.1.toLocaleString().match(/\D/)[0],f=null,p="",g=6371e3,m=true,v={},y={},_={},b=[],e,w;function x(e){return typeof e=="string"&&parseInt(e.replace(/s(\d+)/,"$1"),10)}function C(e){return"s"+e}function i(e){if(e!=null){return giscloud.Color.fromHex(e).hex()}return null}function T(e){this.id=e;this.attributes={};this.removed=false;this.clear=function(){this.removed=true};this.wkt=function(){var e=w.currentShapeGeometry();if(!e)return null;return j(e.currentlyDrawing,e.points,true)};this.edit=function(){}}function t(){var e=o.length;o.push(new T(C(e)));s++;return e}function k(e){var t=o[e],i;if(t instanceof T){o.splice(e,1);s--}i=t.attributes;return i}function M(e,t){var i,n,r;n=e.geometries||e.polygons||e.rings||e.lines||e.points||null;if(n===null){return u.toInternalCoords(e.x,e.y,e.z,t,true)}r=[];for(i in n){if(n.hasOwnProperty(i)){r.push(M(n[i],t))}}return r}function S(e,t,i,n){var r=M(e,i);return u.getViewerGeometry(e,t,r,n)}function L(e,t){var i=t&&t.points&&t.points.length;if(e!=null&&i){e.points=t.points.map(function(e){return u.toInternalCoords(e.x,e.y,e.z,undefined,true)});e.draw()}}function D(e){if(e._snapPoint){if(e._snapPoint.z!=null){return new giscloud.geometry.Point(e._snapPoint.x,e._snapPoint.y,e._snapPoint.z)}return new giscloud.geometry.Point(e._snapPoint.x,e._snapPoint.y)}return u.fromInternalCoords(e,true)}function j(e,t,i){var n,r;if(t.length){switch(e){case"point":r=D(t[0]);n=new giscloud.geometry.Point(r.x,r.y);break;case"line":r=l.map(t,function(e){var t=D(e);return new giscloud.geometry.Point(t.x,t.y)});n=new giscloud.geometry.Line(r);break;case"polygon":r=l.map(t,function(e){var t=D(e);return new giscloud.geometry.Point(t.x,t.y)});n=new giscloud.geometry.Polygon([new giscloud.geometry.Line(r)]);break}}if(!n){return null}return i?n.toOGC():n}function I(e){l(c).triggerHandler(e.type+".fnCanvas2",[{id:this.id,type:e.type}])}function E(e,t){if(!e.on)return;e.on("click dblclick mousedown mouseover mouseout",I,t)}function A(e,t){this.id=e;this.color=i(t.color)||"#000000";this.fill=i(t.fill)||"#ffffff";this.alpha=t.alpha!=null?t.alpha:1;this.width=t.width!=null?t.width:8;this.border=t.border!=null?t.border:1;this.borderRadius=t.shape==="circle"?this.width+this.border:0;this.cursor=null;this.point=null;if(this.alpha>1){this.alpha=this.alpha/100}}A.prototype={draw:function(){this.point=u.newViewerGeometry("Point",this.cursor,{color:this.color,opacity:this.alpha,weight:this.width,width:this.width,fill:this.fill,border:this.border,borderRadius:this.borderRadius,parentShape:this},this.visibility!==false);E(this.point,this)},clear:function(){u.removeGeom(this.point);this.point=null;this.cursor=null},edit:function(e){u.enableGeometryEdit(this,e)},geom:function(){var e=this.point.isMarker?this.cursor:this.point;if(e){var t=u.fromViewerGeometry(e,this.hasZ);return t}return null},wkt:function(){var e=this.point.isMarker?this.cursor:this.point,t;if(e){t=u.fromViewerGeometry(e,this.hasZ);return t?t.toOGC():""}return null},redraw:function(){var e=this.cursor;this.clear();this.cursor=e;this.draw()}};function P(e,t){this.id=e;this.color=i(t.color)||"#ff0088";this.alpha=t.alpha!=null?t.alpha:1;this.width=t.width!=null?t.width:1;this.cursor=null;this.lines=[];this.points=[];if(this.alpha>1){this.alpha=this.alpha/100}}P.prototype={currentLine:function(){return this.lines[this.lines.length-1]},draw:function(){var e=u.newViewerGeometry("LineString",this.points,{color:this.color,opacity:this.alpha,weight:this.width},this.visibility!==false);this.lines.push(e)},addLine:function(){var e=u.newViewerGeometry("LineString",[this.cursor],{color:this.color,opacity:this.alpha,weight:this.width},this.visibility!==false);this.lines.push(e);E(e,this)},extendLine:function(){var e=this.currentLine();if(e){u.extendLineGeometry(e,this.cursor)}},edit:function(e){var t=this.currentLine();u.enableGeometryEdit(t,e)},geom:function(){var e=this.currentLine();if(e){return u.fromViewerGeometry(e,this.hasZ)}return null},wkt:function(){var e=this.currentLine(),t;if(e){t=u.fromViewerGeometry(e,this.hasZ);return t?t.toOGC():""}return null},redraw:function(){var e=this.points;this.clear();this.points=e;this.draw()},clear:function(){var e,t;for(e=0,t=this.lines.length;e<t;e++){u.removeGeom(this.lines[e]);this.lines[e]=null}this.lines=[];this.cursor=null;this.points=null}};function O(e,t){this.id=e;this.color=i(t.color)||"#ff0088";this.alpha=t.alpha!=null?t.alpha:1;this.width=t.width!=null?t.width:1;this.ring=null;this.polygon=null;if(this.alpha>1){this.alpha=this.alpha/100}}O.prototype={draw:function(){this.polygon=u.newViewerGeometry("Polygon",this.ring,{color:this.color,opacity:this.alpha,weight:this.width},this.visibility!==false);E(this.polygon,this)},clear:function(){u.removeGeom(this.polygon);this.polygon=null;this.ring=null},edit:function(e){u.enableGeometryEdit(this,e)},geom:function(){var e=this.ring,t;if(e){t=u.fromViewerGeometry(this.polygon,this.hasZ);return t}return null},wkt:function(){var e=this.ring,t;if(e){t=u.fromViewerGeometry(this.polygon,this.hasZ);return t?t.toOGC():""}return null},redraw:function(){var e=this.ring;this.clear();this.ring=e;this.draw()}};function N(e,t){this.id=e;this.color=i(t.color)||"#ff0088";this.alpha=t.alpha!=null?t.alpha:1;this.width=t.width!=null?t.width:1;this.shapes=null;this.featureGroup=null;this.type="multi";this.multiType="";if(t.geom){if(t.geom instanceof giscloud.geometry.Multipoint){this.multiType="MultiPoint"}if(t.geom instanceof giscloud.geometry.Multiline){this.multiType="MultiLineString"}if(t.geom instanceof giscloud.geometry.Multipolygon){this.multiType="MultiPolygon"}}if(this.alpha>1){this.alpha=this.alpha/100}}N.prototype={draw:function(){this.featureGroup=u.newViewerGeometry(this.multiType,this.shapes,{color:this.color,opacity:this.alpha,weight:this.width,isMulti:true},this.visibility!==false);E(this.featureGroup,this)},clear:function(){u.removeGeom(this.featureGroup);this.shapes=null;this.featureGroup=null},edit:function(e){u.enableGeometryEdit(this,e)},redraw:function(){var e=this.shapes;this.clear();this.shapes=e;this.draw()},geom:function(){var e=this.featureGroup.hasGeom?this.featureGroup:this.shapes;var t=u.fromViewerGeometry(e,this.hasZ);if(!t){return null}else if(t instanceof giscloud.geometry.Multipoint||t instanceof giscloud.geometry.Multiline||t instanceof giscloud.geometry.Multipolygon){return t}else if(t.length===1&&t[0]instanceof giscloud.geometry.Multipoint||t[0]instanceof giscloud.geometry.Multiline||t[0]instanceof giscloud.geometry.Multipolygon){return t[0]}switch(this.type){case"point":if(!Array.isArray(t)){t=[t]}return new giscloud.geometry.Multipoint(t);case"line":return new giscloud.geometry.Multiline(t);case"polygon":return new giscloud.geometry.Multipolygon(t);default:return new giscloud.geometry.GeometryCollection(t)}},wkt:function(){var e=this.featureGroup.hasGeom?this.featureGroup:this.shapes;var t=u.fromViewerGeometry(e,this.hasZ);if(!t){return null}else if(t instanceof giscloud.geometry.Multipoint||t instanceof giscloud.geometry.Multiline||t instanceof giscloud.geometry.Multipolygon){return t.toOGC()}else if(t.length===1&&t[0]instanceof giscloud.geometry.Multipoint||t[0]instanceof giscloud.geometry.Multiline||t[0]instanceof giscloud.geometry.Multipolygon){return t[0].toOGC()}switch(this.type){case"point":return new giscloud.geometry.Multipoint(t).toOGC();case"line":return new giscloud.geometry.Multiline(t).toOGC();case"polygon":return new giscloud.geometry.Multipolygon(t).toOGC();default:return new giscloud.geometry.GeometryCollection(t).toOGC()}}};this.fn=u;function R(e){var t=w.currentlyDrawing();if((e.shiftKey||e.metaKey)&&t==="polygon"){w.rectangleMode(true);l(document).one("keyup",function e(t){if(!t.ctrlKey&&!t.metaKey){w.rectangleMode(false);l(document).one("keydown",R)}else{l(document).one("keyup",e)}});e.preventDefault()}else if(h&&e.which===8){e.preventDefault();F(e);l(document).one("keydown",R)}else{l(document).one("keydown",R)}}function F(e){var t,i;var n=w.currentlyDrawing();if(!n||n==="point"||n==="rectangle"||!(e.which===8||e.which===46||e.which===190||e.which===44||e.which===188||e.which===110||e.which===r.charCodeAt(0)||e.which>=48&&e.which<=57))return;if(!w.getPoint(-2)){return}h=true;if(e.which===8){if(p.length){p=p.slice(0,-1)}}else if(e.which===46||e.which===44||e.which===r.charCodeAt(0)){t=p+r}else{i=String.fromCharCode(e.which);t=p+i}if(!isNaN(parseFloat(t))){p=t}w.handleNumericKeypress();if(!p){H()}else{z(p)}}function z(e){var t,i,n,r;if(!h)return;if(!f){f=u.newMarker(null,{icon:{className:"gc-map-tip gc-input-label",type:"div"},clickable:false}),u.addComponentToMap(f)}t=l(f._icon).find(".gc-map-tip-mock-input");i=w.getPoint(-2);n=w.getPoint(-1);r={lat:(n.lat+i.lat)/2,lng:(n.lng+i.lng)/2};if(e==null){e=p}if(!t.length){t=l("<span/>",{class:"gc-map-tip-mock-input",text:e});f.html(t[0])}else{t.text(e)}f.setLatLng(r)}function H(){if(!f)return;f.remove();f=null;h=false;p=""}function B(e){if(e.which===27){if(h){H();h=false}else{w.cancel()}}else if(e.which===13){if(h){w.addPoint(true);h=false;H()}else{w.end()}}else{return true}e.preventDefault();e.stopPropagation()}var W=this;function q(){var e=w.currentShapeGeometry();if(h){z();W.hideMeasureMarker()}else if(a&&(e&&e.points.length>=1)){H()}else{H();W.hideMeasureMarker(1)}if(!a){return}if(!e){return}if(e.currentlyDrawing==="rectangle"){var t=w.getPoint(0);var i=w.getPoint(1);var n=w.getPoint(3);var r=w.getPoint(4);if(!t||!i||!n||!r){return}W.showMeasureMarker(1,t,i);W.showMeasureMarker(2,n,r)}else{var t=w.getPoint(-2);var i=w.getPoint(-1);if(t&&i){W.showMeasureMarker(1,t,i)}}}this.getInputValue=function(){if(h){var e=parseFloat(p.replace(r,"."));if(!isNaN(e)){return e}}return null};this.getOverridenPoint=function(e){var t;if(this.snapping()){t=this.checkForSnapping(e)}else{t=e}var i=w.getPoint(-3);var n=w.getPoint(-2);if(i&&n&&d){t=closestPerpendicular(i,n,t)}var r=this.getInputValue();if(r!==null){if(u.epsg==="900913"||u.epsg==="3857"){t=V(n,t,r,u.measureUnit)}else{t=G(n,t,r)}}return t};function G(e,t,i){var n,r,a,s,o,l;n=u.fromInternalCoords(e);r=u.fromInternalCoords(t);a=new giscloud.geometry.Point(r.x-n.x,r.y-n.y);s=Math.sqrt(a.x*a.x+a.y*a.y);o=new giscloud.geometry.Point(i*a.x/s,i*a.y/s);l=new giscloud.geometry.Point(n.x+o.x,n.y+o.y);return u.toInternalCoords(l.x,l.y)}function V(e,t,i,n){var r=giscloud.fromMeters(n,g),a=Math.PI/180,s=e.lat*a,o=t.lat*a,l=e.lng*a,c=t.lng*a,u=Math.sin(c-l)*Math.cos(o),d=Math.cos(s)*Math.sin(o)-Math.sin(s)*Math.cos(o)*Math.cos(c-l),h=Math.atan2(u,d),f,p;f=Math.asin(Math.sin(s)*Math.cos(i/g)+Math.cos(s)*Math.sin(i/g)*Math.cos(h));p=l+Math.atan2(Math.sin(h)*Math.sin(i/g)*Math.cos(s),Math.cos(i/g)-Math.sin(s)*Math.sin(f));return{lat:f/a,lng:p/a}}this.add=function(n){var r=t(),a=C(r),s=this;$();Y();this.init();l(document).one("keydown",R);l(document).keypress(F);l(document).keyup(B);u.on("mousemove",q);w.start(n).always(function(){s.hideMeasureMarker()}).progress(function(e,t,i){if(!i){H()}l(c).triggerHandler("draw.fnCanvas2",[j(e,t),i])}).done(l.proxy(function(e,t){s.hideMeasureMarker();var i=j(n,e,true);if(i){this.deserializeGeometryOpenGISSimple({geom:i},a);if(!t){l(c).triggerHandler("add.fnCanvas2",[{id:a,geom:i,gtype:n}])}}else{if(o[r]instanceof T){k(r)}}},this)).fail(l.proxy(function(e){s.hideMeasureMarker();k(r);if(!e){l(c).triggerHandler("add.fnCanvas2",[{id:null,geom:null,gtype:n}])}},this));return a};this.endDraw=function(e){if(e&&e.cancel){w.cancel()}else if(e&&e.noEvent){w.end(true)}else{w.end()}ne()};this.addEventListener=function(e,t){var i=function(){var e=Array.prototype.slice.call(arguments,1);return t.apply(this,e)};l(c).on(e+".fnCanvas2",i);c.handlers.push({original:t,wrapped:i})};this.removeEventListener=function(e,i){var n,r;l.each(c.handlers,function(e,t){if(t.original===i){r=e;n=t.wrapped}});if(r==null||c.handlers[r]==null){return}l(c).off(e+".fnCanvas2",n);delete c.handlers[r].wrapped;c.handlers.splice(r,1)};this.setAttributeGeometry=function(e,t,i,n){var r=o[x(e)];if(r){if(r instanceof T){r.attributes[t]=i}else{r[t]=i;if(!n){r.redraw()}}}return e};this.getAttributeGeometry=function(e,t){var i=o[x(e)];if(!i){return null}return i[t]};this.getGeometry=function(e){var t=o[x(e)];if(!t){return null}return t.geom()};this.setGeometryVisible=function(e,t){var i=o[x(e)],n;if(i){if(i instanceof T){i.attributes[attribute]=value}else{i.visibility=t;i.redraw()}}return e};this.newShape=function(e,t){var i,n,r,a;this.init();if(t!=null){n=x(t);r=o[n];if(r instanceof T){a={};l.extend(a,r.attributes,e);i=t;o[n]=new P(t,a);if(r.removed){this.remove(t)}}else{throw"Invalid ID for a reserved shape slot."}}else{i=C(s);o.push(new P(t,e));s++}return i};this.newLineShape=this.newShape;this.newPointShape=function(e,t){var i,n,r,a;if(t!=null){n=x(t);r=o[n];if(r instanceof T){a={};l.extend(a,r.attributes,e);i=t;o[n]=new A(t,e);if(r.removed){this.remove(t)}}else{throw"Invalid ID for a reserved shape slot."}}else{i=C(s);o.push(new A(t,e));s++}return i};this.newPolygonShape=function(e,t){var i,n,r,a;if(t!=null){n=x(t);r=o[n];if(r instanceof T){a={};l.extend(a,r.attributes,e);i=t;o[n]=new O(t,e);if(r.removed){this.remove(t)}}else{throw"Invalid ID for a reserved shape slot."}}else{i=C(s);o.push(new O(t,e));s++}return i};this.newMultiShape=function(e,t){var i,n,r,a;if(t!=null){n=x(t);r=o[n];if(r instanceof T){a={};l.extend(a,r.attributes,e);i=t;o[n]=new N(t,e);if(r.removed){this.remove(t)}}else{throw"Invalid ID for a reserved shape slot."}}else{i=C(s);o.push(new N(t,e));s++}return i};this.moveTo=function(e,t,i,n){var r=o[x(e)];if(r){n=n!=null?n:r.hasZ?0:null;r.cursor=this.fn.toInternalCoords(t,i,n,undefined,true);r.addLine();return e}};this.lineTo=function(e,t,i,n){var r=o[x(e)];if(r){n=n!=null?n:r.hasZ?0:null;r.cursor=this.fn.toInternalCoords(t,i,n,undefined,true);r.extendLine();return e}};this.remove=function(e){var t=x(e),i=o[t];if(i){i.clear();o[t]=null;return e}};this.removeAll=function(){var e,t;for(e=0,t=o.length;e<t;e++){this.remove(C(e))}};this.clear=this.removeAll;this.editGeometry=function(e){var t=o[x(e)];var i=this;if(t){this.init();$();Y();w.initEdit();if(t instanceof A&&t.point.isMarker){t.point.on("drag",function(){if(n)t.point.setLatLng(i.checkForSnapping(t.point._latlng))}).on("dragend",function(){if(n)u.parent.hideTip()})}t.edit();return e}return null};this.editGeometryEnd=function(e){var t=o[x(e)];if(t){if(this.snapping())w.endSnapping();t.edit(false);this.measureDisplay(false);return e}return null};this.redrawGeometry=function(e){var t=o[x(e)];if(t){t.redraw()}};this.addShape=function(e,t,i){var n=e.geom,r,a,s;this.init();if(n instanceof giscloud.geometry.Point){r=this.newPointShape(e,t);s=x(r);a=o[s];a.cursor=this.fn.toInternalCoords(n.x,n.y,n.z,i,true);a.hasZ=n.hasZ();a.draw()}else if(n instanceof giscloud.geometry.Multipoint){r=this.newMultiShape(e,t);s=x(r);a=o[s];a.shapes=S(n,{color:a.color,opacity:a.alpha>1?a.alpha/100:a.alpha,weight:a.width},i,true);a.type="point";a.hasZ=n.hasZ();a.draw()}else if(n instanceof giscloud.geometry.Line){r=this.newLineShape(e,t);s=x(r);a=o[s];a.hasZ=n.hasZ();L(a,n)}else if(n instanceof giscloud.geometry.Multiline){r=this.newMultiShape(e,t);s=x(r);a=o[s];a.shapes=S(n,{color:a.color,opacity:a.alpha>1?a.alpha/100:a.alpha,weight:a.width},i,true);a.type="line";a.hasZ=n.hasZ();a.draw()}else if(n instanceof giscloud.geometry.Polygon){r=this.newPolygonShape(e,t);s=x(r);a=o[s];a.ring=n.rings[0].points.map(function(e){return u.toInternalCoords(e.x,e.y,e.z,i,true)});a.hasZ=n.hasZ();a.draw()}else if(n instanceof giscloud.geometry.Multipolygon){r=this.newMultiShape(e,t);s=x(r);a=o[s];a.shapes=S(n,{color:a.color,opacity:a.alpha>1?a.alpha/100:a.alpha,weight:a.width},i,true);a.type="polygon";a.hasZ=n.hasZ();a.draw()}else if(n instanceof giscloud.geometry.Multipoint){r=this.newMultiShape(e,t);s=x(r);a=o[s];a.shapes=S(n,{color:a.color,opacity:a.alpha>1?a.alpha/100:a.alpha,weight:a.width},i,true);a.type="point";a.hasZ=n.hasZ();a.draw()}else if(n instanceof giscloud.geometry.GeometryCollection){r=this.newMultiShape(e,t);s=x(r);a=o[s];a.shapes=l.map(n.geometries,function(e){return S(e,{color:a.color,opacity:a.alpha>1?a.alpha/100:a.alpha,weight:a.width},i)});a.hasZ=n.hasZ();a.draw()}else{throw{error:"Unknown giscloud geometry type.",data:e}}if(t==null&&a&&a.id==null&&r!=null){o[s].id=r}return r};this.serializeGeometryOpenGIS=function(e){var t=o[x(e)];if(t){return t.wkt()}return null};this.deserializeGeometryOpenGISSimple=function(e,t,i){var n=e&&e.geom,r=n&&giscloud.geometry.fromOGC(n);if(!r){throw"Cannot deserialize from OGC, unknown giscloud geometry type."}e.geom=r;return this.addShape(e,t,i)};this.measureDisplay=function(e){if(e==null){return a}a=!!e;if(!a)this.hideMeasureMarker();return this};var U={};this.showMeasureMarker=function(e,t,i){if(!this.measureDisplay())return;if(!e){e=1}var n=U[e],r,a;if(!n){U[e]=this.fn.newMarker(null,{icon:{className:"gc-map-tip",type:"div"},clickable:false});n=U[e];this.fn.addComponentToMap(n)}r={lat:(i.lat+t.lat)/2,lng:(i.lng+t.lng)/2};a=this.fn.calculateDistance(t.lat,t.lng,i.lat,i.lng);n.setLatLng(r);n.text(this.fn.measureLabelFunction(a))};this.hideMeasureMarker=function(e){if(!e){this.hideMeasureMarker(1);this.hideMeasureMarker(2);return}var t=U[e];if(!t)return;t.remove();U[e]=null};this.cleanUp=function(){h=false;p="";l(document).off("keyup",B);l(document).off("keypress",F);u.off("mousemove",q);H()};this.init=function(){u.initDrawing(w)};this.initDrawingController=function(e){w=u.getDrawingController(this)};this.initDrawingController();this.deserializeGeometryOpenGIS=this.deserializeGeometryOpenGISSimple;this.snapping=function(e){if(e==null){return n}n=!!e;if(n){Y()}else{this.fn.parent.hideTip()}return this};this.snappingLayers=function(e){if(e==null){return v}for(var t in e){if(!e[t])_[t]=null}v=e;return this};this.canSnap=function(e){if(e==null){return m}m=e};this.setSnappingLayerFids=function(e,t){y[e]=t};function $(){w.initSnapping();u.parent.scaleChange(Z);u.parent.dragEnd(Z);var e=u.parent.layers;for(var t in e){if(e[t].instance&&!e[t].instance.isGroupLayer){e[t].instance.on("tileload",Q)}}}var J;function Q(){clearTimeout(J);J=window.setTimeout(X,50)}function X(){if(giscloud.ui&&giscloud.ui.edit)giscloud.ui.edit.enableDisableSnapping();Z()}function Y(){var e=u.parent.layers,t=u,i=u&&u.epsg,n,r,a=u.parent.bounds().toString();if(!t)return;b=[];if(!m)return;for(var s,o=0;o<e.length;o++){s=e[o];if(!v[s.id.toString()]||!s.visible()){continue}if(s.type&&l.inArray(s.type,["tile","wms","wfs","wmts","raster","folder"])>-1){continue}n={geometry:"wkt",epsg:i,requestByPost:true,noattrib:true,layerName:s.name};if(y[s.id]){r=te(s.id);if(r.length===0)continue;n.fids=r.join(",")}giscloud.features.byBounds(s.id,a,n).done(ee)}}function Z(){window.clearTimeout(e);e=window.setTimeout(Y,500)}function K(e,t,i){var n,r;r=e.geometries||e.polygons||e.rings||e.lines||e.points||null;if(r===null){t.push({x:e.x,y:e.y,z:e.z,layerName:i})}for(n in r){if(r.hasOwnProperty(n)){K(r[n],t,i)}}}function ee(e,t,i,n){if(!_[i]){_[i]={layerName:n.layerName,geom:{}}}var r,a=_[i].geom;l.map(e,function(e){r=giscloud.geometry.fromOGC(e.geometry);K(r,b,n.layerName);a[e.id]=r})}function te(e){var t=_[e],i=y[e];if(!t)return i;var n,r=i.length,a=[],s=t.layerName,o=t.geom;for(n=0;n<r;n++){if(o[i[n]]){K(o[i[n]],b,s)}else{a.push(i[n])}}return a}function ie(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}this.hideSnappingTooltip=function(){u.parent.hideTip()};this.checkForSnapping=function(e){var t=u.fromInternalCoords(e);var i=u.parent.scale();var n=7/u.calculateScaleZoom(i);var r=null;var a=null;var s;var o=t.hasZ();for(var l=0,c=b.length;l<c;l++){s=ie(t,b[l]);if(s<n){n=s;a=b[l];r=u.toInternalCoords(a.x,a.y,o?a.z:null,true);r._snapPoint=a}}if(r){e=r;u.parent.showTip(["<span class='gc-map-tip-snap-icon'>",a.layerName.replace(/ /g,"&nbsp;"),"</span>"].join(""),true)}else{u.parent.hideTip()}return e};function ne(){w.endSnapping();u.parent.unbind("scaleChange",Z);u.parent.unbind("dragEnd",Z);u.parent.hideTip();var e=u.parent.layers;for(var t in e){if(e[t].instance&&!e[t].instance.isGroupLayer){e[t].instance.off("tileload",Q)}}_={};y={}}};var fnMarker2=function(f){"use strict";var b=giscloud.exposeJQuery(),o={},w={},x={},s={bottom:{x:1,y:0},top:{x:1,y:2},left:{x:2,y:1},right:{x:0,y:1},center:{x:1,y:1}},C=0;this.fn=f;this.markers={};function l(e,t,i){var n,r={x:e/2,y:t/2},a;if(i){a=i.split("-");while(i=a.pop()){n=s[i]?s[i]:s["center"];r.x*=n.x;r.y*=n.y}}return r}function p(n,e,t,r){var a=giscloud.md5(n+"_"+r);if(!o[a]){o[a]={loading:new b.Deferred,icon:null};if(e!=null&&t!=null){o[a].icon={iconUrl:n,shadowUrl:null,iconSize:{x:e,y:t},iconAnchor:l(e,t,r),labelAnchor:{x:Math.max(e,t)*1.5+5,y:0},wrapperAnchor:{x:e,y:t}};o[a].loading.resolve(o[a])}else if(!n&&0){o[a].loading.resolve(o[a])}else{var s=new Image;s.onload=function(){var e,t=s.width,i=s.height;if(t===1&&i===1){if(s.naturalWidth!=null){t=s.naturalWidth;i=s.naturalHeight}else{e=new Image;e.src=s.src;t=e.width||0;i=e.height||0}}o[a].icon={iconUrl:n,shadowUrl:null,iconSize:{x:t,y:i},iconAnchor:l(t,i,r),labelAnchor:{x:Math.max(t,i)*1.5+5,y:0},wrapperAnchor:{x:t,y:i}};o[a].loading.resolve(o[a])};s.src=n}}return o[a]}function T(e){var t=e.title,i=e.color,n=e.content,r=e.newPopupTable,a=e.open,s=new giscloud.Color.fromHex(i),o="";if(t!=null){o+='<p class="gc-info-popup-title" style="background-color: '+i+"; color: "+(s.hsl()[2]>85?"black":"white")+';">'+t+"</p>"}if(a&&n!=null){o+=r?'<div class="gc-info-popup-content"></div>':'<div class="gc-info-popup-content">'+n+"</div>"}return o}this.add=function(e,t,i,n,r,a,s,o,l,c,u,d){var h,f,p,g,m,v,y,_=this;if(e.x&&e.y){a=e.icon;n=e.title;r=e.content;o=e.featureId;c=e.data;u=e.selectedLayer;l=e.layer;i=e.color;s=e.open;t=e.y;e=e.x;d=e.newPopupTable}s=!!s;if(i==null){i="#006BFF"}else{if(i instanceof giscloud.Color){i=i.hex()}else{i=giscloud.Color.fromHex(i).hex()}}h=this.fn.toInternalCoords(e,t);f=this.fn.newPopup({className:"gc-info-popup"+(d?" new-popup-table":""),minWidth:180,loseButton:true});f._fnMarker={x:e,y:t,color:i,title:n,content:r,icon:a,open:s,featureId:o,layer:l,newPopupTable:d,selectedLayer:u};p=T(f._fnMarker);f.move(h);f.setContent(p);g="m"+C;C++;this.fn.addComponentToMap(f);if(d){f.move(h)}if(d){giscloud.ui.featureInfoTable(document.getElementsByClassName("gc-info-popup-content")[0],r,o,l,c,u,f)}f.on("click",function(){b(_).triggerHandler("click",{id:g,data:x[g]})});this.markers[g]=f;w[g]=new b.Deferred;w[g].resolve(f);f.on("mousemove mouseup",function(e){e.stopPropagation()}).on("click",".gc-info-popup-title",function(){_.toggle(g)}).on("click",".gc-info-edit-link",function(e){e.stopPropagation();if(window.checkIfUserExceedsStorageLimits&&window.checkIfUserExceedsStorageLimits()){return window.showStorageForbiddenMsg()}var t=b(this).parent(),i=t.find("[name=edit-layer-id]").val(),n=t.find("[name=edit-feature-id]").val();if((!i||!n)&&(b(this).attr("featureId")&&b(this).attr("layerId"))){i=b(this).attr("layerId");n=b(this).attr("featureId");gcapp.selo.clearSelection();gcapp.selo.selectOnMap({lid:i,fids:[n]});giscloud.features.byId(i,n).done(function(e){gcapp.selo.showRecordInfo(e)}).fail(function(e){console.log(e)});return}b(_).triggerHandler("gc-info-popup-edit-click",{layerId:i,featureId:n})});return g};this.setTitle=function(e,t){var i=this.markers[e],n;if(i){i._fnMarker.title=t;n=T(i._fnMarker);i.setContent(n)}return this};this.setContent=function(e,t){var i=this.markers[e],n;if(i){i._fnMarker.content=t;n=T(i._fnMarker);i.setContent(n)}return this};this.toggle=function(e){var t=this.markers[e],i;if(t){t._fnMarker.open=!t._fnMarker.open;i=T(t._fnMarker);t.setContent(i);t.fire("toggle",[e,t._fnMarker.open]);if(t._fnMarker.newPopupTable&&t._fnMarker.open){giscloud.ui.featureInfoTable(document.getElementsByClassName("gc-info-popup-content")[0],t._fnMarker.content,t._fnMarker.featureId,t._fnMarker.layer,t._fnMarker.data,t._fnMarker.selectedLayer,t)}}return this};this.remove=function(e){var t=this.markers[e];if(t){t.remove();delete this.markers[e];delete w[e]}};this.removeAll=function(){var e;for(e in this.markers){this.remove(e)}};this.closeAll=function(){var e;for(e in this.markers){if(this.markers[e]._type==="popup"){this.remove(e)}}};this.clear=this.closeAll;this.loadPoi=function(o,l,e,c,u,t,i,n,r){var a,d,h,s;d=this;a=new b.Deferred;h="m"+C;w[h]=new b.Deferred;x[h]=c;C++;s=p(e,t,i,r);s.loading.done(function(e){var t,i,n,r,a;var s={clickable:u};if(e.icon){s.icon=e.icon}if(c.hoverText){s.title=c.hoverText}t=d.fn.toInternalCoords(o,l);i=f.newMarker(t,s);f.addComponentToMap(i);if(c.popupContent){i.bindPopup(c.popupContent,{className:"gc-info-popup",autoPan:false})}i.on("click",function(){b(d).triggerHandler("click",{id:h,data:x[h]})});d.markers[h]=i;if(c.popupContent&&c.popupVisible){i.openPopup()}w[h].resolve(i)});return h};this.move=function(e,i,n,r){var a,t;t=w[e];if(t){a=this;t.done(function(e){var t;if(e&&e.setLatLng){t=a.fn.toInternalCoords(i,n);e.setLatLng(t);if(e.setRotation&&r){e.setRotation(r)}}})}};this.attachLabel=function(t){var e=w[t.marker];if(e){e.done(function(e){e.setLabel(t.data)})}};this.getObject=function(e){return this.markers[e]};this.ready=function(e){return w[e]}};var fnTooltip2=function(r){"use strict";var s=giscloud.exposeJQuery(),o=true,i=false,l=false,t={className:"gc-map-tip",type:"div"},c={},n,u;function e(e){if(e){r=e}n=r.newMarker(null,{icon:t,clickable:false});r.addEventListener("load",p);r.addEventListener("reload",p);r.addEventListener("object_over",d);r.addEventListener("object_out",h);r.off("mousemove",v).on("mousemove",v)}function a(){r.removeEventListener("load",p);r.removeEventListener("reload",p);r.removeEventListener("object_over",d);r.removeEventListener("object_out",h);r.off("mousemove",v);f()}function d(e){var t,i,n,r,a;if(!o||l){return}t=e.id.split("||");i=t[0].substr(5);n=c[i];r=e.object.attributes||e.object.data;if(!n||!r){return f()}a=n.split(",");u=s.map(a,function(e){return giscloud.xssSafe(r[e])});return m(u.join("<br/>"),true)}function h(){if(l){return}u=null;f()}function f(){if(i){n.remove();i=false}}function p(){var e,t,i,n;c={};for(e=0,t=r.getLayerCount();e<t;e++){i=r.getLayer(e);n=parseInt(i.id.substr(5),10);if(i&&i.options){c[n]=i.options.tooltip}}}function g(e,t){if(!e){f()}if(n){if(t){n.html(e)}else{n.text(e)}}}function m(e,t){if(!o){return}if(!i){r.addComponentToMap(n);i=true}g(e,t)}function v(e){if(i){n.move(e)}}this.show=function e(t,i){m(t,i);l=true};this.hide=function e(){f();l=false};this.enable=function e(){o=true};this.disable=function e(){o=false;f()};e();this.init=e;this.deinit=a};var fnAgent2=function(e){this.setData=function(e){};this.setZoom=function(e){}};(function(window,$,common,undefined){var lv,initialized,bounds,unitFactor,unit,units,unit_label,sources_map,enabled_dragging,loaded,tileLayerCount,internalViewers={},viewerContainer,labelLayer,LabelLayer,fnLayerBasic,fnLayer2,fnTileLayer,fnTileLayerGroup,fnBasemapLayer,fnRasterLayer,fnQuadLayer,fnWmsLayer;tileLayerCount=0;initialized=0;loaded=false;enabled_dragging=1;var giscloud_tile_url=common.tileSite();function init(){if(initialized)return;initialized=1;fnLayerBasic={options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1},initialize:function(e,t){t=common.LayerClassSetOptions(this,t);if(typeof e==="string"){this._url=[e]}else{this._url=e}this._tiles={};var i=this.options.subdomains;if(typeof i==="string"){this.options.subdomains=i.split("")}},addToMap:function(){this.viewerLayer.addToMap()},removeFromMap:function(){this.viewerLayer.removeFromMap()},getId:function(){return this.id},loaded:function(){return this.viewerLayer&&this.viewerLayer.loaded()},disable:function(){this.visible=false;this.options.visible=false;if(this.viewerLayer){this.viewerLayer.setVisible(false)}},enable:function(){this.visible=true;this.options.visible=true;if(this.viewerLayer){this.viewerLayer.setVisible(true)}},getAlpha:function(){return Math.round(this.options.opacity*100)},setAlpha:function(e){if(flashnavigator.hasCanvas){this.setOpacity(e/100)}},update:function(){if(this.viewerLayer){this.viewerLayer.update()}},setZIndex:function(e){if(this.viewerLayer){this.viewerLayer.setZIndex(e)}},setOpacity:function(e){this.options.opacity=e;if(this.viewerLayer){this.viewerLayer.setOpacity(e)}},getCurrentLevel:function(){return lv.map._zoom},setSelectable:function(e){this._selectable=e;return 0},getSelectable:function(){return this._selectable},getVisibility:function(){return this.visible},getBound:function(e){return{xMin:this.source.xmin,xMax:this.source.xmax,yMin:this.source.ymin,yMax:this.source.ymax}},getData:function(e){return this.source},_loadTile:function(e,t){this._processTile(e,t,t.z)},_processTile:function(e,t){e.src=this.getTileUrl(t)},redraw:function(e){if(this.gcmap){this.gcmap.redraw(0,e)}},getRules:function(){return this.features},setRule:function(e,t){this.features[e]=t},resetRules:function(){this.features=[];for(var e=0;e<this.features_original.length;e++){var t={};for(var i in this.features_original[e]){t[i]=this.features_original[e][i]}this.features[e]=t}},setDynamicMode:function(e){if(this.gcmap)this.gcmap.url=this.gcmap.url_prefix+"/dyn,"+e+"/"},reload:function(){if(this.gcmap)this.gcmap.reload()},getFeatureIds:function(e){if(this.gcmap){return this.gcmap.getFeatureIds(e)}else{e(this.id,[])}},calculateFeatureVisibility:function(){if(this.features){this.featuresVisibility=this.features.map(function(e){return e.visible?"1":"0"}).join()}},_tileShouldBeVisible:function(e){return this.viewerLayer&&this.viewerLayer.tileShouldBeVisible(e)},_tileShouldBeLoaded:function(e,t,i,n){var r=t||this;if(r.layer_info&&(r.layer_info.fromlevel&&r.layer_info.fromlevel>e.z||r.layer_info.tolevel&&r.layer_info.tolevel<e.z)){return false}if(!r.options.visible||r.useForDEM||!i&&!t&&!n&&!this.viewerLayer.tileShouldBeLoaded(e)){return false}if(r.group){for(var a=0;a<r.group.length;a++){if(this._tileShouldBeLoaded(e,r.group[a],true)){return true}}return false}this._calculateLayerBounds(r,e.z);if(e.x>=r.tileIndexXMin&&e.x<=r.tileIndexXMax&&e.y>=r.tileIndexYMin&&e.y<=r.tileIndexYMax){return true}return false},_calculateLayerBounds:function(e,t){e=e||this;if(e.calculatedLayersBoundsAtZoom===t){return}e.calculatedLayersBoundsAtZoom=t;var i=1<<t;e.tileIndexXMinFloat=(e.source.xmin-bounds.xmin)/bounds.max*i;e.tileIndexXMaxFloat=(e.source.xmax-bounds.xmin)/bounds.max*i;e.tileIndexYMinFloat=(bounds.ymax-e.source.ymax)/bounds.max*i;e.tileIndexYMaxFloat=(bounds.ymax-e.source.ymin)/bounds.max*i;if(!e.isImage){e.tileIndexXMinFloat--;e.tileIndexXMaxFloat++;e.tileIndexYMinFloat--;e.tileIndexYMaxFloat++}e.tileIndexXMin=Math.floor(e.tileIndexXMinFloat);e.tileIndexXMax=Math.floor(e.tileIndexXMaxFloat);e.tileIndexYMin=Math.floor(e.tileIndexYMinFloat);e.tileIndexYMax=Math.floor(e.tileIndexYMaxFloat)},clipTile:function(e,t){var i=false;var n,r,a,s;n=s="0px";a=r="256px";if(t.x==this.tileIndexXMin){n=Math.round((this.tileIndexXMinFloat-this.tileIndexXMin)*256)+"px";i=true}if(t.y==this.tileIndexYMin){s=Math.round((this.tileIndexYMinFloat-this.tileIndexYMin)*256)+"px";i=true}if(t.x==this.tileIndexXMax){r=Math.round((this.tileIndexXMaxFloat-this.tileIndexXMax)*256)+"px";i=true}if(t.y==this.tileIndexYMax){a=Math.round((this.tileIndexYMaxFloat-this.tileIndexYMax)*256)+"px";i=true}if(i)e.style.clip="rect("+s+","+r+","+a+","+n+")"}};fnLayer2=common.LayerClass.extend(fnLayerBasic);var n=0;fnTileLayerGroup=function(e,i){this.options=e;this.id=e.id;this.visible=e.visible;this.id=e.id;this.source=e.source;this.isGroupLayer=true;this.feature_filter=null;this.legacyHtml5Map=i;var t=e.group;this.groupId=t;this.groupIdIndex=0;fnTileLayerGroup.theTileLayer=fnTileLayerGroup.theTileLayer||{};this.setUniqueId=function(){this.uniqueId=n++};this.setFeatureFilter=function(e){var t,i,n={},r=[],a=this.tileLayer.group;this.feature_filter=e&&e.filter?e:null;for(t=0;t<a.length;t++){i=a[t].feature_filter;if(i&&i.filter&&i.attributes){n[a[t].feature_filter.attributes]=1}for(t in n){r.push(t)}}if(r.length==0){this.tileLayer.feature_filter=null}else{this.tileLayer.feature_filter={filter:true,attributes:r.join(",")}}this.tileLayer.gcmap.setupAttributes();if(flashnavigator.offscreenRendering){this.tileLayer.gcmap.workerLayerSetFilter(this.id,this.feature_filter)}};this.newTileLayer=function(){var e;var t=this.options;e=fnTileLayerGroup.theTileLayer[this.groupId]=this.tileLayer=new fnTileLayer(t,i);e.source={};e.options.visible=true;e.visible=true;e.options.opacity=1;e.id=e.options.id=this.groupId;e.isTileLayer=true;this.isRootLayer=true;e.gcmap.tileLayer=e;e.group=[];return e};this.unloadFromTiles=function(){for(var e in this.tileLayer._tiles){var t=this.tileLayer._tiles[e];if(t.gc_state.by_layer[this.id]){t.gc_state.by_layer[this.id]=null}}};this.cleanUpOnRemove=function(e,t){var i=[],n;if(!t){this.disable(true)}if(!flashnavigator.offscreenRendering){for(n in this.tileLayer._tiles){this.tileLayer.gcmap.unloadTile(this.tileLayer._tiles[n],[this.id])}}for(var r=0;r<this.tileLayer.group.length;r++){if(this.tileLayer.group[r]!==this){i.push(this.tileLayer.group[r])}}this.tileLayer.group=i;this.tileLayer._resetGroup();if(i.length==0){delete fnTileLayerGroup.theTileLayer[this.tileLayer.id];this.tileLayer.cleanUpOnRemove();this.viewer.internalViewer.removeLayer(this.tileLayer)}};this.setSelectable=function(e){this._selectable=e;if(flashnavigator.offscreenRendering){this.tileLayer.gcmap.workerLayerUpdate(this.id,{_selectable:e})}return 0};this.getSelectable=function(e){return this._selectable};this.disable=function(e){if(this.visible){var t=this;this.visible=false;this.options.visible=false;if(this.useForDEM){t.tileLayer.viewer.reloadTerrain();return}this.tileLayer.neighbour_tile_data={};var i=this.tileLayer._tiles;for(var n in i){var r=i[n];if(!flashnavigator.offscreenRendering){this.tileLayer.gcmap.unloadTile(r,[this.id])}if(r.gc_state.by_layer[this.id]){r.gc_state.by_layer[this.id]=null}}if(flashnavigator.offscreenRendering){this.tileLayer.gcmap.workerLayerUpdate(this.id,{visible:false})}if(!this.tileLayer.loaded()){this.tileLayer._resetGroup();return}this.tileLayer.resetCache();if(flashnavigator.offscreenRendering){this.tileLayer.gcmap.workerUnloadTiles(this.id);this.tileLayer._resetGroup();if(!e)this.redraw(false,-1);return}if(e)return;if(this.tileLayer._delayedGroupUpdate){clearTimeout(this.tileLayer._delayedGroupUpdate)}this.tileLayer._delayedGroupUpdate=window.setTimeout(function(){t.tileLayer._delayedGroupUpdate=null;t.tileLayer._resetGroup();t.redraw()},0)}};this.enable=function(){if(!this.visible){var e=this;this.visible=true;this.options.visible=true;if(this.useForDEM){e.tileLayer.viewer.reloadTerrain();return}if(flashnavigator.offscreenRendering){this.tileLayer.gcmap.workerLayerUpdate(this.id,{visible:true})}this.setUniqueId();this.tileLayer.gcmap.activeLayer=null;if(!this.tileLayer.loaded()){this.tileLayer._resetGroup();return}this.tileLayer.resetCache();if(!this.tileLayer._partialGroup){this.tileLayer._partialGroup=[]}this.tileLayer._partialGroup.push(this);if(this.tileLayer._delayedGroupUpdate){clearTimeout(this.tileLayer._delayedGroupUpdate)}this.tileLayer._delayedGroupUpdate=window.setTimeout(function(){e.tileLayer._delayedGroupUpdate=null;e.tileLayer._reloadGroupPartialy()},0)}};this.getAlpha=function(e){return Math.round(this.options.opacity*100)};this.setAlpha=function(e){if(e/100==this.options.opacity){return}this.options.opacity=e/100;this.tileLayer.resetCache();if(flashnavigator.offscreenRendering){this.tileLayer.gcmap.workerLayerUpdate(this.id,{opacity:this.options.opacity});this.redraw(false,-1)}else{this.redraw(false,100)}};this.redraw=function(e,t){var i=this;if(!e)e=false;if(!t)t=0;this.tileLayer.gcmap.activeLayer=this;if(t>=0){if(this.tileLayer._redrawDelay){clearTimeout(this.tileLayer._redrawDelay)}this.tileLayer._redrawDelay=window.setTimeout(function(){i.tileLayer._redrawDelay=null;i.tileLayer.redraw(e)},t)}else{i.tileLayer.redraw(e)}};this.setZIndex=function(e){if(this.tileLayer._zIndexOffset==null){this.tileLayer.setZIndex(e);this.tileLayer._zIndexOffset=e-this.tileLayer.group.length}var t=e-1-this.tileLayer._zIndexOffset;this.tileLayer._shouldRedrawDueSort=this.tileLayer.group[t]!=this;this.tileLayer.group[t]=this};this.getFeatureIds=function(e){return this.tileLayer.gcmap.getFeatureIds(e,this.id)},this.setUniqueId()};for(var e in fnLayerBasic){fnTileLayerGroup.prototype[e]=fnLayerBasic[e]}fnTileLayer=fnLayer2.extend({initialize:function(e,t){e=common.LayerClassSetOptions(this,e);this._tiles={};this.visible=e.visible;this.id=e.id;this.source=e.source;this.dontLoad=e.dontLoad;this.legacyHtml5Map=t;this.gcmap=new t.Html5Map(e,this);this.gcmap.setBounds(bounds);this.gcmap.selectablePoly(0);this.canvases_for_release=[];if(e.modifier){this.gcmap.modifier=e.modifier;if(!this.gcmap.modifier_layers){this.gcmap.modifier_layers={}}this.gcmap.modifier_layers[this.id]=1;this.gcmap.has_modifier=true}this.feature_filter=null;this.neighbour_tile_data={};var i=this;this.gcmap.reinitCanvases=function(){var t,e=Object.keys(i._tiles);e.forEach(function(e){t=i._tiles[e];i._initTile(t)})};this.abortTileRequest=function(e){this.viewer.decreaseTileCounter(e);this.gcmap.abortRequest(e)};this.onStopLoadingTiles=function(){i.gcmap.resetLoaders()};this._unloadTile=function(e){var t=e.tile;if(!t||!t.gc_state){return}if(t.transferToAnotherViewer){return}delete this._tiles[t.gc_state._tileIndex];if(flashnavigator.offscreenRendering){this.gcmap.workerUnloadTile(this.id,t.gc_state._tileIndex,t.gc_state._cacheId)}this.gcmap.unloadTile(t);if(e.imidiateRelease){if(t.getContext){this.gcmap.releaseCanvasToPool(t)}}else{this.canvases_for_release.push(t)}};this.cleanUpCanvasPool=function(){var e;while(e=i.canvases_for_release.pop()){i.viewerLayer.cleanTileCss(e);i.gcmap.releaseCanvasToPool(e)}if(flashnavigator.offscreenRendering){i.gcmap.workerCanvasPoolCleanUp()}i.gcmap.canvasPoolCleanUp()};this.onTileError=function(e){this.viewer.decreaseTileCounter(e)};this.resetCache=function(){if(this.viewerLayer){this.viewerLayer.resetCache()}};this.onZoomChange=function(){i.gcmap.resetCache();i.neighbour_tile_data={};if(i.group){i.group.forEach(function(e){if(e._img_tiles){e._img_tiles={}}})}if(flashnavigator.offscreenRendering){i.gcmap.workerLayerUpdate(i.id,{_tiles:{},neighbour_tile_data:{}})}};if(this.dontLoad){this._addTile=function(){}}e.noWrap=true},_initTile:function(e){var t=this.options.tileSize*flashnavigator.scaleRatio;e.width=t;e.height=t;e.style.width=this.options.tileSize+"px";e.style.height=this.options.tileSize+"px"},_createTile:function(e){var t=this.options.tileSize*flashnavigator.scaleRatio,i=e?{style:{}}:this.gcmap.getCanvasFromPool(t,t,true);this._initTile(i);i.gc_state={by_layer:{},_tiles_to_redraw:{}};i.ontileload=function(e){if(!this.gc_state){return}var t=this.gc_state.gc_layer;this.complete=true;if(e===undefined)e=this.gc_state.number_of_image_requests;if(e>0){return}t.viewerLayer.tileOnLoad(this);t.viewer.decreaseTileCounter(this)};return i},_loadTile:function(e,t,i){var n=e.gc_state;if(i===undefined){i=0}n.gc_layer=this;n._tileIndexX=t.x;n._tileIndexY=t.y;n._tileIndexZ=t.z;n._tileIndexWrap=i;n._tileIndex=this.gcmap.getTileKey(n._tileIndexX,n._tileIndexY,n._tileIndexZ,n._tileIndexWrap);n._xmin=0;n._ymin=0;n._tileSize=256*flashnavigator.scaleRatio;n._xmax=n._tileSize;n._ymax=n._tileSize;n._width=n._tileSize;n._height=n._tileSize;n.number_of_image_requests=0;this._tiles[n._tileIndex]=e;return this._processTile(e,t,t.z)},_processTile:function(e,t,i){e.gc_state.gc_layer=this;e.gc_state._tiles_to_redraw={};if(e.transferToAnotherViewer){delete e.transferToAnotherViewer;e.coord=t;e.zoom=i;e.complete=true}else{if(this.visible){return this.gcmap.loadTile(e,t,i)}}},redraw:function(e){this.gcmap.redraw(0,e)},render:function(e,t,i,n,r){return this.viewerLayer.render(e,t,i,n,r)},setFeatureFilter:function(e){this.feature_filter=e;this.gcmap.setupAttributes();if(flashnavigator.offscreenRendering){this.gcmap.workerLayerSetFilter(this.id,e)}},getFeature:function(e){return this.gcmap.getFeature(e)},setSelectable:function(e){this._selectable=e;if(flashnavigator.offscreenRendering){this.gcmap.workerLayerUpdate(this.id,{_selectable:e})}return 0},cleanUpOnRemove:function(){var e;for(e in this._tiles){if(this._tiles[e].getContext){this.gcmap.releaseCanvasToPool(this._tiles[e])}}},_resetGroup:function(){if(!this.group){return}var e=this.group,t=[],i=[],n={},r,a,s,o,l,c,u,d,h,f,p=false;if(e.length>0){for(h=0;h<e.length;h++){if(!p){r=e[h].source.xmin;a=e[h].source.ymin;s=e[h].source.xmax;o=e[h].source.ymax;l=e[h].tileIndexXMin;c=e[h].tileIndexYMin;u=e[h].tileIndexXMax;d=e[h].tileIndexYMax;p=true}f=e[h].source;if(!(f.xmin==0&&f.xmax==0&&f.ymin==0&&f.ymax==0)){r=f.xmin<r?f.xmin:r;a=f.ymin<a?f.ymin:a;s=f.xmax>s?f.xmax:s;o=f.ymax>o?f.ymax:o;if(e[h].visible){t.push(e[h].options.modified);i.push(e[h].options.id)}n[e[h].options.id]=1}if(e[h].tileIndexXMin<l)l=e[h].tileIndexXMin;if(e[h].tileIndexYMin<c)c=e[h].tileIndexYMin;if(e[h].tileIndexXMax>u)u=e[h].tileIndexXMax;if(e[h].tileIndexYMax>d)d=e[h].tileIndexYMax}this.source.xmin=r;this.source.ymin=a;this.source.xmax=s;this.source.ymax=o;this.tileIndexXMin=l;this.tileIndexXMax=u;this.tileIndexYMin=c;this.tileIndexYMax=d}this.gcmap.modified=t.join(",");this.gcmap.lid=i.join(",");this.gcmap.lid_map=n;this.gcmap.activeLayer=null;if(flashnavigator.offscreenRendering){var e=this.group.map(function(e){return e.id});this.gcmap.workerResetGroup(this.id,e)}},_reloadGroupPartialy:function(){if(this._toBeLoaded){this._partialGroup=null;this._toBeLoaded=false;return}var e=this.group;this.group=this._partialGroup;this._partialGroup=null;this._resetGroup();this.reload();this.viewerLayer.repaint();this.group=e;this._resetGroup()},tileXYToQuadKey:function(e,t,i){return a(e,t,i)},tilesToLoad:function(){return this.viewerLayer.tilesToLoad()}});fnTileLayerGroup.theTileLayer=null;function t(e,t){if(e.xmax<t.xmin||e.xmin>t.xmax||e.ymax<t.ymin||e.ymin>t.ymax){return false}return true}function i(e,t){if(e>t)return e;return t}function r(e,t){if(e<t)return e;return t}fnBasemapLayer=fnLayer2.extend({initialize:function(e,t){this.zoomThreshold=t.maxZoom;this.isBaseMapLayer=true;t.maxZoom=Infinity;this.options.tileScaleFactor=1;this.originallUrl=e.replace("{s}","a");this.initialize2(e,t)},_getBasemapTileUrl:function(e,t){return this.viewerLayer.getTileUrl(e,t)},_processTile:function(t,e,i,n,r){var a,s,o,l=0,c=0,u=tileSize=256*this.options.tileScaleFactor,d=e.x,h=e.y;if(!r){r=this;n=i}if(i>r.zoomThreshold){do{e.x=Math.floor(e.x/2);e.y=Math.floor(e.y/2);u/=2}while(--i>r.zoomThreshold);l=d*u-e.x*tileSize;c=h*u-e.y*tileSize}a=r._getBasemapTileUrl(e,i);s=new Image;s.onload=function(){var e=t.getContext("2d",flashnavigator.canvasOptions);e.drawImage(this,l,c,u,u,0,0,tileSize,tileSize);r.viewerLayer.onTileLoad(t,this.src)};s.onerror=function(){var e;if(i>0){e=r.zoomThreshold;r.zoomThreshold=i-1;r._processTile(t,{x:d,y:h},n,n,r);r.zoomThreshold=e;return}r.viewerLayer.onTileError(t,this.src)};if(giscloud.offlineMode()){o=r.options.src+"/"+a.split("/").slice(3).join("/");o=o.replace(/\?.+$/i,"").replace(/(mapbox.+?)(?:@2x)?\.(png|jpg)/,"$1@2x.$2").replace(/(tilejson)(.+?)(?:@2x)?\.(png|jpg)/,"$1/maps/streets/256$2@2x.$3");a="file://"+giscloudOffline.documentDirectory+"basemaps/"+o}s.src=a}});fnBasemapLayer.prototype.initialize2=fnLayer2.prototype.initialize;fnRasterLayer=fnLayer2.extend({_processTile:function(e,t,i){this.clipTile(e,t);e.src=this.viewerLayer.getTileUrl(t,i)},isImage:true});function a(e,t,i){var n="";for(var r=i;r>0;r--){var a="0";var s=1<<r-1;if((e&s)!=0){a++}if((t&s)!=0){a++;a++}n+=a}return n}fnQuadLayer=fnBasemapLayer.extend({_getBasemapTileUrl:function(e,t){var i=this.options.subdomains,n=this.options.subdomains[(e.x+e.y)%i.length];return this._url[(e.x+e.y)%this._url.length].replace("{s}",n).replace("{q}",a(e.x,e.y,t))}});fnWmsLayer=fnLayer2.extend({_processTile:function(t,e,i,n,r){var a,s,o,l,c,u,d=0,h=0,f=tileSize=256*(this.options.tileScaleFactor?this.options.tileScaleFactor:1),p=e.x,g=e.y;if(!r){r=this;n=i}if(r.zoomThreshold===undefined){r.zoomThreshold=r.options.maxZoom}t._layer=r;if(i>r.zoomThreshold){do{e.x=Math.floor(e.x/2);e.y=Math.floor(e.y/2);f/=2}while(--i>r.zoomThreshold);d=p*f-e.x*tileSize;h=g*f-e.y*tileSize}if(this.options.gctms){e.y=this._getWrapTileNum()-e.y-1}if(bounds.zoomOffset){i+=bounds.zoomOffset}a=bounds.max/(1<<i);s=bounds.xmin+a*e.x;o=bounds.ymax-a*e.y;l=this._url[(e.x+e.y)%this._url.length].replace("$x1",s).replace("$y1",o-a).replace("$x2",s+a).replace("$y2",o).replace("{z}",i).replace("{x}",e.x).replace("{y}",e.y).replace("$id",i).replace("$nx",e.x).replace("$ny",e.y);c=giscloud_config.tileSite().indexOf("https:")===0&&l.indexOf("https:")!==0||!!l.match(/:\/\/(.*):(.*)@/);if(c){l=giscloud_config.tileImageProxySite().replace("{url}",encodeURIComponent(l)).replace("{mid}",this.viewer._mid.replace("map",""))}t.onload=function(){var e=tileSize/f;Object.assign(t.style,{backgroundImage:"url("+t.src+")",backgroundSize:tileSize*e+"px",backgroundRepeat:"no-repeat",objectPosition:tileSize+"px",backgroundPosition:"left "+-d*e+"px "+" top "+-h*e+"px"});r.viewerLayer.onTileLoad(t,this.src)};t.onerror=function(){var e;if(i>0){e=r.zoomThreshold;r.zoomThreshold=i-1;r._processTile(t,{x:p,y:g},n,n,r);r.zoomThreshold=e;return}r.viewerLayer.onTileError(t,this.src)};if(giscloud.offlineMode()){u=r.options.srcName+"/"+l.split("/").slice(3).join("/");u=u.replace(/\?.+$/i,"").replace(/(mapbox.+?)(?:@2x)?\.(png|jpg)/,"$1@2x.$2").replace(/(tilejson)(.+?)(?:@2x)?\.(png|jpg)/,"$1/maps/streets/256$2@2x.$3");l="file://"+giscloudOffline.documentDirectory+"basemaps/"+u}this.clipTile(t,e);t.src=l}});common.giscloudToolbar={options:{viewer:null,position:"topleft",title:"Toolbar",mobile:window.fno&&fno.mobilebrowser},initControl:function(){var e=$("<div>",{class:"leaflet-control-toolbar"});this.ul=$("<ul>",{class:"gc-toolbar-menu"});e.append(this.ul);this.container=e[0]},empty:function(){this.ul.empty()},_createMenu:function(){var e=[{tool:"Layer list",className:"fa-list-ul"},{tool:"Info",className:"fa-info"},{tool:"more"},{tool:"Zoom in",className:"fa-plus",position:"extended"},{tool:"Zoom out",className:"fa-minus",position:"extended"},{tool:"Zoom area",className:"fa-search-plus",position:"extended"},{tool:"Show all",className:"fa-globe",position:"extended"},{tool:"Current location",className:"fa-crosshairs",position:"extended"},{tool:"Select",className:"fa-hand-o-up",position:"extended"},{tool:"Print",className:"fa-print",position:"extended"},{tool:"Coordinates reprojection",className:"fa-bullseye",position:"extended"},{tool:"Area Measure",className:"fa-crop",position:"extended"},{tool:"Measure",className:"fa-expand",position:"extended"},{tool:"Refresh",className:"fa-refresh",position:"extended"},{tool:"Azimuth",className:"fa-compass",position:"extended"},{tool:"scale",position:"extended"},{tool:"coordinates",position:"extended"},{tool:"Setting",className:"fa-cog",position:"extended"}];for(var t=0;t<e.length;t++){this.add(e[t])}},add:function(e){var t=$("<li>",{class:"gc-toolbar-item"}),i,n;if(e.position=="first")this.ul.prepend(t);else this.ul.append(t);if(e.tool=="Info"){t.addClass("gc-tool-active")}if(e.tool=="viewerswitch"){t.addClass("gc-location-toolbar-viewerswitch")}if(e.id){t.attr("id",e.id)}if(e.tool=="scale"){t.addClass("gc-toolbar-scale");t.append($("<div>"))}else if(e.tool=="numofselected"){t.addClass("gc-toolbar-numofselected");t.append($("<div>",{class:"numselfeatures"}))}else if(e.tool=="more"){i=$("<i>",{class:"fa fa-angle-double-left"});t.append(i);t.attr("title",e.title)}else if(e.tool=="coordinates"){t.addClass("gc-toolbar-coordinates");i=$("<i>",{class:"fa fa-ellipsis-v"});t.append(i);t.append($("<div>"))}else{e.className+=e.className.indexOf("fa-")>=0?" fa":"";i=$("<i>",{class:e.className});t.append(i);t.attr("title",e.title)}if(e.position=="extended"){t.addClass("gc-tool-extended")}if(e.text){if(e.textOnlyResponsive&&!this.options.mobile)return t;n=$("<span>");t.append(n);n.text(e.text);t.addClass("gc-toolbar-text")}t.click(function(e){e.stopPropagation()}).dblclick(function(e){e.stopPropagation()}).mousedown(function(e){e.stopPropagation()});return t},_createButton:function(e){var t=$("<a>").html("&nbsp;").attr("href","#").attr("title",this.options.title).click(function(e){e.stopPropagation()}).dblclick(function(e){e.stopPropagation()}).mousedown(function(e){e.stopPropagation()});$(e).append(t);return t}};common.LocationToolbar={options:{viewer:null,position:"verticalcenterright",title:"Location toolbar",mobile:window.fno&&fno.mobilebrowser},initControl:function(){var e=$("<div>",{class:"leaflet-control-location-toolbar"});this.ul=$("<ul>",{class:"gc-toolbar-menu -vertical"});e.append(this.ul);this.container=e[0]},empty:function(){$(this.ul).empty()},add:function(i){var n=$("<li>",{class:"gc-toolbar-item"}),e,t;if(i.position=="first")this.ul.prepend(n);else this.ul.append(n);if(i.id){n.attr("id",i.id)}n.addClass("gc-location-toolbar-"+i.tool);i.className+=i.className.indexOf("fa-")>=0?" fa":"";e=$("<i>",{class:i.className});n.append(e);n.attr("title",i.title);if(i.text){if(i.textOnlyResponsive&&!this.options.mobile)return n;t=$("<span>");t.text(i.text);n.append(t);n.addClass("gc-toolbar-text");if($(window).width()>800){t.parent().css("display","inline-flex").css("whiteSpace","nowrap").css("width","auto");t.css("marginTop","6px")}}if(i.tool=="viewerrotate"){var r,a,s;i.compassDirection=function(e){if(!r){return}r.css({"-webkit-transform":"rotate("+e+"deg)","-moz-transform":"rotate("+e+"deg)","-ms-transform":"rotate("+e+"deg)",transform:"rotate("+e+"deg)"})};n.load(common.assetsSite()+"assets/images/toolbar/compass.svg?_nch="+giscloud_config.nch,function(){r=n.find(".compass-direction");giscloud.ui.map.instance.on("rotate",function(){i.compassDirection(-giscloud.ui.map.instance.getBearing())});function e(e){var t=t=giscloud.ui.map.instance.getBearing();if(a){clearInterval(a);a=null}if(s>20){t=giscloud.ui.map.instance.getBearing();s=0}else{t+=e;t=Math.round(t/e)*e}giscloud.ui.map.instance.setLocation(undefined,undefined,undefined,t,undefined)}function t(t){if(a){clearInterval(a);a=null}s=0;a=setInterval(function(){var e=giscloud.ui.map.instance.getBearing()+t;giscloud.ui.map.instance.setLocation(undefined,undefined,undefined,e);s++},10)}n.find(".compass-arrow-left").on("mousedown",function(){t(75);$(document).one("mouseup",function(){e(90)})});n.find(".compass-arrow-right").on("mousedown",function(){t(-75);$(document).one("mouseup",function(){e(-90)})});r.on("click",function(){giscloud.ui.map.instance.setLocation(undefined,undefined,undefined,0,0)})});if(giscloud.ui.map.getMode()==="3D"){n.show()}else{n.hide()}}n.click(function(e){e.stopPropagation()}).dblclick(function(e){e.stopPropagation()}).mousedown(function(e){e.stopPropagation()});return n}};if(flashnavigator.ready)flashnavigator.ready()}var fnViewer2=function(e,t,i){var P,a,s,c={},n=0,r={},v;P=[];layers_feature_filter=[];v=true;this.internalViewer=lv;this.disableAnimation=function(){};this.setQuality=function(){};this.demodifyObjectsColor=function(){};this.modifyObject=function(e,t,i,n,r,a){var s,o;var l={};for(o in P){s=P[o].tileLayer||P[o];if(s&&s.gcmap&&!l[s.id]){s.gcmap.modifyObject(e,t,i,n,r,a);l[s.id]=1}}};var C=this;this.disablePanWithMiddleButton=function(){};this.enablePanWithMiddleButton=function(){};this.enableSelection=function(){C.parent.html5Map.Html5MapSetSelection(true);this.selectionEnabled=v=true};this.disableSelection=function(){C.parent.html5Map.Html5MapSetSelection(false);this.selectionEnabled=v=false};this.fireSelectAreaEvent=function(e,t,i){lv.fireSelectAreaEvent(e,t,i,y)};this.fireSelectAreaToolEvent=function(e,t,i){lv.fireSelectAreaToolEvent(e,t,i)};this.setCursor=function(e){lv.setCursor(e)};this.reloadTerrain=function(){lv.reloadTerrain()};this.setTool=function(e){var t;this.setCursor("");if(e=="SelectAreaTool"){t=this.fireSelectAreaToolEvent}if(e=="AreaSelection"){t=this.fireSelectAreaEvent}if(e=="MeasureTool"){if(this._currentTool!=e){this.parent.distanceMeasure.activate()}}else{if(this._currentTool=="MeasureTool"){this.parent.distanceMeasure.deactivate()}}e=lv.setTool(e,this._currentTool,y,t);this._currentTool=e;if(e=="SelectAreaTool"||e=="AreaSelection"||e=="MeasureTool"||e=="streetview"){this.setCursor("crosshair")}};this.src=function(){};this.enableAnimation=function(){};this.convertScale=function(e){return unitFactor/e};this.unload=function(){var e=[],t;this._reloadBound=null;while(l=P.pop()){if(l._updateLayerCount)l._updateLayerCount(true);if(l.cleanUpOnRemove)l.cleanUpOnRemove(lv.map,true);if(!l.isGroupLayer)lv.removeLayer(l);if(flashnavigator.offscreenRendering){if(l.isRootLayer)e.push(l.tileLayer);t=l.tileLayer?l.tileLayer.gcmap:l.gcmap;t.workerLayerRemove(l.id)}}e.forEach(function(e){e.gcmap.workerLayerRemove(e.id)});if(this.cleanUpLabelRendering)this.cleanUpLabelRendering();tileLayerCount=0;n=0;r={};loaded=false;lv.unload()};this.reload=function(e,t,i){if(P.length>0){this._reloadBound=this.getViewBound()}this.load(e||a,true,t,i)};this.setLayerFeatureFilter=function(e,t){layers_feature_filter[e]=t;var i=this.getLayerByName(e);if(i&&i.setFeatureFilter){i.setFeatureFilter(t)}};this.getLayerByName=function(e){for(var t=0;t<P.length;t++){if(P[t].id===e)return P[t]}return 0};this.getLayerById=this.getLayerByName;this.getLayerCount=function(){return P.length};this.getLayer=function(e){return P[e]};this.setLayersOrder=function(e){f(e,this);p();C.parent.html5Map.Html5SendRequests()};this.removeLayer=function(t){var i=[],e;P=P.filter(function(e){if(e.id.indexOf(t)!==-1){i.push(e);return false}return true});i.forEach(function(e){if(e.isTileLayer){tileLayerCount--}if(e._updateLayerCount){e._updateLayerCount(true)}if(e.cleanUpOnRemove)e.cleanUpOnRemove(lv.map);if(!e.isGroupLayer){lv.removeLayer(e)}if(flashnavigator.offscreenRendering&&e.isTileLayer){var t=e.tileLayer?e.tileLayer.gcmap:e.gcmap;t.workerLayerRemove(e.id)}});e=i.reduce(function(e,t){if(e){return e}if(t.id.indexOf("llayer")===-1){e=t}return e},null);y("layerRemoved",e)};this.getViewBound=function(){return lv.getViewBound()};this.setViewUsingInternalCoords=function(e,t){lv.setViewUsingInternalCoords(e,t)};this.setViewBound=function(e,t,i,n,r,a,s){if(!P[0])return;e*=1;i*=1;t*=1;n*=1;if(!r)r=1;if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(n)){if(this._startBound&&!isNaN(this._startBound.xMin)&&!isNaN(this._startBound.xMax)&&!isNaN(this._startBound.yMin)&&!isNaN(this._startBound.yMax)){e=this._startBound.xMin;t=this._startBound.yMin;i=this._startBound.xMax;n=this._startBound.yMax}else{e=bounds.xmin;t=bounds.ymin;i=bounds.xmax;n=bounds.ymax}}lv.setViewBound(e,t,i,n,r,a,s)};this.setViewBoundAnim=this.setViewBound;this.setScale=function(e){lv.setScale(e)};this.getScale=function(){return lv.getScale()};this.setBearing=function(e){lv.setBearing(e)};this.getBearing=function(){return lv.getBearing()};this.setPitch=function(e){lv.setPitch(e)};this.getPitch=function(){return lv.getPitch()};this.toInternalCoords=function(e,t,i,n,r){return lv.toInternalCoords(e,t,i,n,r)};this.fromInternalCoords=function(e,t){return lv.fromInternalCoords(e,t)};this.toLeafletCoords=this.toInternalCoords;this.fromLeafletCoords=this.fromInternalCoords;this.setLocation=function(e,t,i,n,r){if(e-1===e||t-1===e){console.warn("setLocation: these seem like invalid coordinates.",[e,t]);try{window.dispatchEvent(new CustomEvent("invalidCoordinatesError",{detail:[e,t]}))}catch(e){}return false}lv.setLocation(e,t,i,n,r)};this.getCenter=function(){return lv.getCenter()};this.on=function(e,t){if(!c[e]){c[e]=[]}else{var i=c[e].indexOf(t);if(i>-1){return}}c[e].push(t);lv.on(e,t);return this};this.off=function(e,t,i){if(c[e]&&!i){var n=c[e].indexOf(t);if(n>-1){c[e].splice(n,1)}}lv.off(e,t);return this};this.increaseTileCounter=function(e){var t=e&&e.gc_state?e.gc_state._tileIndex:null;if(!t||r[t]){return}r[t]=1;n++};this.decreaseTileCounter=function(e){var t=e&&e.gc_state?e.gc_state._tileIndex:null;if(!t||!r[t]){return}delete r[t];n--;if(n==0){y("mapTilesReady")}};this.addControl=function(e){var t=this._controls[e.options.position],i={},n;for(n in e){i[n]=e[n]}i.initControl();$(i.container).addClass("gc-viewer-control-container");$(i.container).appendTo(t);return i};this.addControlPlaceholders=function(){this._controls={};this._controls["topleft"]=$("<div/>",{class:"gc-viewer-control gc-top gc-left"}).appendTo(viewerContainer);this._controls["bottomright"]=$("<div/>",{class:"gc-viewer-control gc-bottom gc-right"}).appendTo(viewerContainer);this._controls["verticalcenterright"]=$("<div/>",{class:"gc-viewer-control gc-top gc-right gc-verticalcenter"}).appendTo(viewerContainer);this._controls["verticalcenterleft"]=$("<div/>",{class:"gc-viewer-control gc-top gc-left gc-verticalcenter"}).appendTo(viewerContainer)};this.addAttributionControl=function(){var e=this._controls["bottomright"];this.attributionControl=$("<div/>",{class:"gc-viewer-attribution"}).appendTo(e)};this.addAttribution=function(e){if(!e)return;this.currentAtrribution+=" — "+e;this.attributionControl.html(this.currentAtrribution)};this.resetAttribution=function(){this.currentAtrribution=lv.attribution||"";this.attributionControl.html(this.currentAtrribution)};this.addScaleControl=function(){lv.addScaleControl()};this.addComponentToMap=function(e){lv.addComponentToMap(e)};this.newPopup=function(e){var t=lv.newPopup(e);t._type="popup";return t};this.newMarker=function(e,t,i){var n=lv.newMarker(e,t,i);n._type="marker";return n};this.removeGeom=function(e){return lv.removeGeom(e)};this.fromViewerGeometry=function(e,t){return lv.fromViewerGeometry(e,t)};this.getViewerGeometry=function(e,t,i,n){return lv.getViewerGeometry(e,t,i,n)};this.newViewerGeometry=function(e,t,i,n){return lv.newViewerGeometry(e,t,i,n)};this.enableGeometryEdit=function(e,t){e=e.point||e.polygon||e;return lv.enableGeometryEdit(e,t)};this.extendLineGeometry=function(e,t){lv.extendLineGeometry(e,t)};this.initDrawing=function(e){lv.initDrawing(e)};this.setUpMeasureTool=function(e,i){this.calculateDistance=function(e,t,i,n){var r,a=giscloud.proj4.defs("GC_MAP_CURRENT");if(a&&a.a){if(a.b){r=(a.a+a.b)/2}else{r=a.a}}return common.haversine(e,t,i,n,r)};if(!i||i.indexOf("degree")===0){i="meter"}if(i==="meter"){this.measureLabelFunction=function(e){var t=e/1e3;if(t>1e3){return Math.round(t)+" km"}else if(t>100){return(Math.round(t*10)/10).toFixed(1)+" km"}else if(t>10){return(Math.round(t*100)/100).toFixed(2)+" km"}else if(t>1){return(Math.round(t*2e3)/2).toFixed(1)+" m"}else if(t>.1){return(Math.round(t*2e4)/20).toFixed(2)+" m"}else{return(Math.round(t*1e5)/100).toFixed(2)+" m"}}}else{this.measureLabelFunction=function(e){var t;t=giscloud.fromMeters(i,e);if(t===null)t=0;if(t>1e3){t=Math.round(t)}else if(t>100){t=(Math.round(t*10)/10).toFixed(1)}else if(t>10){t=(Math.round(t*100)/100).toFixed(2)}else{t=(Math.round(t*1e3)/1e3).toFixed(3)}switch(i){case"foot":case"us survey foot":case"foot_us":return t+" ft";case"mile":return t+" mi";case"inch":return t+" in";case"yard":return t+" yd";default:return t+" "+i}}}};this.dragging={enable:function(){lv.dragging.enable()},disable:function(){lv.dragging.disable()},enabled:function(){return lv.dragging.enabled()}};this.doubleClickZoom={enable:function(){lv.doubleClickZoom.enable()},disable:function(){lv.doubleClickZoom.disable()},enabled:function(){return lv.doubleClickZoom.enabled()}};this.selectExtentTool=function(e){return lv._control.selectExtent(e)};this.exposeLeaflet=function(){console.warn("warning: exposeLeaflet() method will be deprecated");return lv.map};this.getDrawingController=function(e){return lv.getDrawingController(this,e)};this.invalidateSize=function(){lv.invalidateSize()};this.getMode=function(){return lv.modeId};this.changeMode=function(e,t){var i={previousViewer:lv,layersToRemove:[],zoom:lv.getScale(),minZoom:lv.getMinZoom(),callback:t,mode:e},n=lv,r=this,a=i.zoom,s=n.getBackgroundColor(),o;if(e===this.viewerMode){return}this.viewerMode=e;n.toggleInteractions(false);if(r.plugins.tooltip){r.plugins.tooltip.deinit()}for(o in c){c[o].forEach(function(e){n.off(o,e,true)})}this.parent.graphic.cancelDraw();if(r.plugins.canvas){r.plugins.canvas.clear()}flashnavigator.initViewer(e,this.parent,this.parent.containerId,function(){r.internalViewer=lv;lv.initialize();lv.setMinZoom(i.minZoom);lv.exaggeration=n.exaggeration;lv.demMaxZoom=n.demMaxZoom;if(lv.initOnLayerAdd)lv.initOnLayerAdd();if(s){lv.setBackgroundColor(s)}if(r.plugins.canvas){r.plugins.canvas.initDrawingController(true)}if(r.plugins.tooltip){r.plugins.tooltip.init(r)}n.resetZoomBearingPitch(a,function(){r.deactivateOldMode(i,function(){r.activateNewMode(i)})})})};this.deactivateOldMode=function(e,t){var i=e.previousViewer,n,r=e.zoom,a,s,o;i.uninitialize();o=i.getCenter();for(var a in c){c[a].forEach(function(e){lv.on(a,e)})}lv.map.gc_bounds=i.map.gc_bounds;lv.map.layersMaxLevel=i.map.layersMaxLevel;lv.map.unitFactor=i.map.unitFactor;lv.setZIndex(1);lv.show();lv.invalidateSize();lv.setLocation(o.x,o.y,r,0,0,0,null,"jumpTo");s=i.extractLayer();if(s){lv.whenIdle(t);do{n=s.viewerLayer;n.fnLayer=s;n.switching=true;e.layersToRemove.push(n);lv.addLayer(s,true)}while(s=i.extractLayer())}else{t()}};this.activateNewMode=function(e){var t=e.previousViewer,i,n,r,a,s;t.hide();t.setZIndex(1);lv.setZIndex(2);lv.toggleInteractions(true);while(i=e.layersToRemove.pop()){r=i.fnLayer._tiles;for(s in r){if(r[s].transferToAnotherViewer){delete r[s].transferToAnotherViewer;i.fnLayer._unloadTile({tile:r[s],imidiateRelease:true});delete r[s]}}while(n=i.fnLayer._tilesToRemove.pop()){i.fnLayer.gcmap.releaseCanvasToPool(n)}i.removeFromMap()}a=e.zoom*5;if(a>60){a=60}lv.setLocation(undefined,undefined,e.zoom,0,a,undefined,e.callback,"easeTo")};this.isSrcBasemap=function(e){return e=="osm"||e=="croatianq"||e=="gmaps"||e=="gmaps_traffic"||e=="mapbox.streets"||e=="mapbox.light"||e=="mapbox.dark"||e=="mapbox.satellite"||e=="mapbox.satellite-streets"||e=="gmaps_sat"||e=="gmaps_terr"||e=="gmaps_hybrid"||e=="bing"||e=="bing_sat"||e=="bing_hyb"||e=="grajs"||e=="maps_for_free_relief"||e=="mapquest-osm"||e=="mapquest-oarial"||e=="cloudmade_gray"||e=="cloudmade_night"||e=="tilejson"||e=="here.satellite"||e=="here.streets"};this.setMinZoom=function(e){lv.setMinZoom(e)};this.getMinZoom=function(){return lv.getMinZoom()};function o(){C._layersForUpdateCount=tileLayerCount}this.on("move",o);this.on("moveend",o);this.on("viewreset",o);this.on("mousedown",function(e){if(e.originalEvent.ctrlKey){giscloud.log.push("mouse_down_with_ctrl")}});this.on("zoomstart",function(e){giscloud.util.mediator.publish("zoomstart",e)});this.on("zoomend",function(e){giscloud.util.mediator.publish("zoomend",e)});function O(e){var t,i;if(typeof e==="string"){e=$.parseXML(e).childNodes||[]}else{e=e.childNodes}for(t=0,i=e.length;t<i;t++){if(e[t].nodeType==1)return e[t]}return null}var N=[];var u=0;function d(e,t){if(giscloud.offlineMode()&&giscloudOffline.documentDirectory){return"file://"+giscloudOffline.documentDirectory+"assets/"+t}return t}function R(t){u=N.length;if(u==0){g(t);return}var e,i,n;while(e=N.pop()){e.img.onerror=e.img.onload=function(e){if(e.type==="error"){this.feature.icon_image=null}else{if(!this.generated){this.width=this.width*flashnavigator.scaleRatio;this.height=this.height*flashnavigator.scaleRatio}this.img_width=this.width;this.img_height=this.height;this.feature.iready=true}this.feature.predominantColor=this.feature.fillcolor;u--;if(u==0)g(t)};if(window.cordova){n=e.url&&e.url.match(/https?:\/\/(?:[^\.]+\.)*giscloud\.com\/.*[&?]p=(https?:[^&]+)/);if(n&&n[1]){i=unescape(n[1]).replace("http:","https:").replace("#","%23");if(i==="/icons/defaulticon.png"){i=e.url}}else{i=e.url}e.img.src=d(t,i)}else{loadSymbol(e.img,d(t,e.url))}}}this.load=function(e,t,i,n){if(!t&&this.cleanUpLabelRendering)this.cleanUpLabelRendering();var r,A=this;a=e;this._is_reload=t;this.reloadCallback=i;this.overrideStartBound=n;if(giscloud.offlineMode()){r=function(t){giscloudOffline.getMapXml([t.url],function(e){t.success.bind(t.context)(e)})}}else{r=$.ajax}r({url:e+(e.indexOf("?")>-1?"&":"?")+"t="+(new Date).getTime()+(t?"&reload=1":""),context:this,error:function e(t,i,n){console.error("Error loading map XML",t,i,n);y(this._is_reload?"reload":"load",{id:this._mid});y("error")},success:function(e){var t="";var i="";var n="";var r=null;var a=O(e);var s=a.childNodes.length;var o=100;var l;if(a.attributes){for(l=0;l<a.attributes.length;l++){if(a.attributes[l].name=="id"){t=a.attributes[l].value}else if(a.attributes[l].name=="unit"){this.unit=i=a.attributes[l].value;unitFactor=units[i]}else if(a.attributes[l].name=="measure_unit"){this.measureUnit=n=a.attributes[l].value}else if(a.attributes[l].name=="maxzoom"){o=parseInt(a.attributes[l].value,10)}}}this._mid=t;flashnavigator.map_id=t;var c=[];var u={};var d=this.parent.options={};var h=false;var f=null;this.copyright="";this.backgroundcolor=null;var p="";for(var g=0;g<s;g++){if(a.childNodes[g].tagName=="copyright"){this.copyright=giscloud.xssSafe(a.childNodes[g].text||a.childNodes[g].childNodes[1].textContent);p="&copy; "+this.copyright}else if(a.childNodes[g].tagName=="sources"){H(a.childNodes[g].childNodes,u,c)}else if(a.childNodes[g].tagName=="options"){W(a.childNodes[g].childNodes,d)}else if(a.childNodes[g].tagName=="bound"){var m=a.childNodes[g].attributes;r={};for(l=0;l<m.length;l++){if(m[l].name=="xmin")r.xMin=parseFloat(m[l].value);else if(m[l].name=="ymin")r.yMin=parseFloat(m[l].value);else if(m[l].name=="xmax")r.xMax=parseFloat(m[l].value);else if(m[l].name=="ymax")r.yMax=parseFloat(m[l].value)}h=true}else if(a.childNodes[g].tagName=="tile0"){f={};var v=a.childNodes[g].attributes;for(l=0;l<v.length;l++){if(v[l].name=="originx")f.originx=parseFloat(v[l].value);else if(v[l].name=="originy")f.originy=parseFloat(v[l].value);else if(v[l].name=="resolution")f.resolution=parseFloat(v[l].value);else if(v[l].name=="wmts")f.wmts=v[l].value=="true"}}else if(a.childNodes[g].tagName=="projection"){this.projection=a.childNodes[g].getAttribute("value")}else if(a.childNodes[g].tagName=="epsg"){this.epsg=a.childNodes[g].getAttribute("value")}else if(a.childNodes[g].tagName=="background"){this.backgroundcolor=a.childNodes[g].getAttribute("value")+"";if(this.backgroundcolor)this.backgroundcolor=this.backgroundcolor.replace("0x","#")}else if(a.childNodes[g].tagName=="token"){giscloud.tile_token=a.childNodes[g].getAttribute("value")}}lv.initialize();this.resetAttribution();if(p){this.addAttribution(p)}flashnavigator.newLabelingMode=giscloud.offlineMode()||this.parent&&this.parent.options&&this.parent.options.LABEL_ENGINE_MODE=="2";F.call(this,i,n);z.call(this,i,n);lv.setBackgroundColor(this.backgroundcolor);if(!h)r={};var y={};var _;if(f&&!isNaN(f.originx)&&!isNaN(f.originy)&&!isNaN(f.resolution)){_=f.resolution*256*(unitFactor/3779.527559055);if(f.wmts){if(f.originx==-180&&f.originy==90){_=180*2;y.zoomOffset=-1}else _*=1.14687998/4096;y.ymin=f.originy-_;y.ymax=f.originy}else{y.ymin=f.originy;y.ymax=f.originy+_}y.xmin=f.originx;y.xmax=f.originx+_;y.max=_}else{if(Math.abs(unitFactor-420735083.313146)<1e-5){_=180}else{_=20037508.3427892*(unitFactor/3779.527559055)}y.xmin=-_;y.ymin=-_;y.xmax=_;y.ymax=_;var b=y.xmax-y.xmin;var w=y.ymax-y.ymin;if(w>b)b=w;y.max=b}var x=false;var C=["osm","bing","bing_sat","bing_hyb","gmaps","gmaps_traffic","gmaps_sat","gmaps_terr","gmaps_hybrid","mapquest-osm","mapquest-oarial","cloudmade_gray","maps_for_free_relief","mapbox.streets","mapbox.light","mapbox.dark","mapbox.satellite","mapbox.satellite-streets","cloudmade_night","tilejson","croatianq","mapbox.streets"];for(var g=0;g<c.length;g++){if($.inArray(c[g].src,C)==-1)x=true}var T=Math.floor(Math.log(unitFactor/(256/y.max)/o)/Math.log(2));if(!this._is_reload||!bounds||bounds.xmin!=y.xmin||bounds.ymin!=y.ymin||bounds.xmax!=y.xmax||bounds.ymax!=y.ymax){this._reloadBound=null}bounds=y;for(var g=0;g<s;g++){if(a.childNodes[g].tagName=="layers"){V(a.childNodes[g].childNodes,u,t,P,T)}}for(var g=0;g<q.length;g++){if(q[g].features){var k=q[g].features;for(var M=0;M<k.length;M++){var S=k[M];if(S.icon){S.icon_image=new Image;S.icon_image.feature=S;N.push({img:S.icon_image,url:S.icon})}if(S.type=="polygon"){if(!S.linewidth){S.linewidth=1}if(S.fillcolor){S.predominantColor=S.fillcolor}else{S.predominantColor=S.strokecolor}}else{if(S.innerstrokecolor&&S.innerlinewidth>0){q[g].has_inner_line=true}}if(!S.predominantColor){if(S.strokecolor){S.predominantColor=S.strokecolor}else if(S.color){S.predominantColor=S.color}else{S.predominantColor="#000000"}}var L=common.getHighlightAndSelectColors(S.predominantColor);S.highlightcolor=L[0];S.selectcolor=L[1];if(S.linewidth)S.linewidth*=flashnavigator.scaleRatio;if(S.innerlinewidth)S.innerlinewidth*=flashnavigator.scaleRatio;if(S.dashed)S.dashed=S.dashed.map(function(e){return e*flashnavigator.scaleRatio})}}}J(A,t,P,T,u);for(var g=0;g<c.length;g++){B(c[g]);if(!c[g].visible||$.inArray(c[g].src,C)>-1&&x||h){continue}var D=parseFloat(c[g].xmin);var j=parseFloat(c[g].ymin);var I=parseFloat(c[g].xmax);var E=parseFloat(c[g].ymax);if(D==0&&j==0&&I==0&&E==0){continue}if(r.xMin==undefined||D<r.xMin){r.xMin=D}if(r.yMin==undefined||j<r.yMin){r.yMin=j}if(r.xMax==undefined||I>r.xMax){r.xMax=I}if(r.yMax==undefined||E>r.yMax){r.yMax=E}}this._startBound=r;R(this);giscloud.util.mediator.publish("labels/rerender")}})};function h(e){if(typeof e!=="string"){return null}if(!giscloud.toMeterRatios[e]){return null}return e}this.MeasureUnit=function(e){if(e!==undefined&&h(e)){this.measureUnit=e;F.call(this,e,this.measureUnit)}return this.measureUnit};function f(e,t){var i=[],n,r=null,a=0,s,o,l;if(flashnavigator.newLabelingMode){e=e.filter(function(e){return e});s=[labelLayer]}else{s=e.map(function(i){return P.reduce(function(e,t){if(e){return e}else{if(t.id==="llayer"+i){return[i,t]}}},null)}).reduce(function(e,t){if(t){e[t[0]]=t[1]}return e},{})}o=e.map(function(n){return P.reduce(function(e,t){var i;if(e){return e}else{i=window.parseInt(t.id.replace("layer","").replace("_group_",""),10);if(i===n){return[n,t]}}return e},null)}).reduce(function(e,t){if(t){e[t[0]]=t[1]}return e},{});s=Object.keys(s).reduce(function(e,t){e.push(s[t]);return e},[]);o=e.reduce(function(e,t){e.push(o[t]);return e},[]);l=Array.prototype.concat.apply(s,o);if(flashnavigator.isUsingMapEngineGroupedLayers){var c=false,u=null,d=null,n=null,h,f,p=0,g=0,m,v,y,_,b,w=1,x=3;if(labelLayer){l.shift()}fnTileLayerGroup.theTileLayer=fnTileLayerGroup.theTileLayer||[];for(b=0;b<l.length;b++){y=l[b];_=y.layer_info.type&&y.layer_info.type==="raster"?0:y.options.minZoom;if(y.isGroupLayer)continue;if(!y.options.modified){y.options.modified=1}h=new fnTileLayerGroup({id:y.id,visible:y.options.visible,opacity:y.options.opacity,minZoom:_,maxZoom:y.options.maxZoom,subdomains:y.options.subdomains,gctms:y.options.gctms,mid:flashnavigator.map_id,modified:y.options.modified,attribution:y.options.attribution?y.options.attribution:""},t.parent.html5Map);h.mid=flashnavigator.map_id;h.source=y.source;h.isImage=true;h.isRasterLayer=y instanceof fnRasterLayer;h.shouldBeLoaded=true;h.layer_info=y.layer_info;h.layer_info.fnLayer=h;h.viewer=t;h.features=[];h._url=y._url;h.zoomThreshold=y.zoomThreshold;h.useForDEM=y.useForDEM;if((y instanceof fnWmsLayer||y instanceof fnBasemapLayer)&&y._url){h.proxyServerAvailable=giscloud_config.tileImageProxySite();y._url.forEach(function(e){var t=giscloud_config.tileSite().indexOf("https:")===0&&e.indexOf("https:")!==0||!!e.match(/:\/\/(.*):(.*)@/);if(t){h.proxyServer=h.proxyServerAvailable;return}})}l[b]=h}Object.keys(fnTileLayerGroup.theTileLayer).forEach(function(e){fnTileLayerGroup.theTileLayer[e]._zIndexOffset=null});tileLayerCount=0;f=l.map(function(e){m=x;if(!v){v=m}if(e.isGroupLayer){if(v!==m){p++}v=m;if(e.groupId!=="g"+p&&!e.shouldBeLoaded&&e.tileLayer){e.unloadFromTiles();if(e.tileLayer.gcmap.modifier){e.copy_modifier={};for(var t in e.tileLayer.gcmap.modifier){var i=t.split("_");if(i.length===2&&i[0]==e.id){e.copy_modifier[t]=e.tileLayer.gcmap.modifier[t];delete e.tileLayer.gcmap.modifier[t]}}}e.shouldBeLoaded=true}return{group:"g"+p,layer:e,type:m}}else{if(v!==w){g++}v=m;return{group:"break"+g,layer:e,type:m}}}).filter(function(e){return e.group.indexOf("break")===-1}).reduce(function(e,t){if(!e.some(function(e){return e[0]===t.group})){e.push([t.group,[]])}e[e.length-1][1].push(t.layer);return e},[]).map(function(i){var n=null,r={id:i[0],group:null,layers:i[1]};r.layers.map(function(e){if(e.tileLayer){e.isRootLayer=false;if(n&&n!==e.tileLayer&&e.tileLayer._map){e.tileLayer._map.removeLayer(e.tileLayer);return}n=e.tileLayer}});r.group=i[1].reduce(function(e,t){t.groupId=i[0];t.options.group=i[0];if(e){return e}if(n){t.tileLayer=n;t.isRootLayer=true}else{t.newTileLayer()}t.tileLayer.options.tooltip=[];t.tileLayer._partialGroup=r.layers;t.tileLayer.options.maxZoom=undefined;t.tileLayer.group=r.layers.map(function(e){e.tileLayer=t.tileLayer;if(e.options.tooltip){t.tileLayer.options.tooltip.push(e.options.tooltip)}if(t.tileLayer.options.maxZoom===undefined||e.options.maxZoom>t.tileLayer.options.maxZoom){t.tileLayer.options.maxZoom=e.options.maxZoom}return e});t.tileLayer.options.tooltip=t.tileLayer.options.tooltip.join(",");t.visible=t.options.visible;t.setUniqueId();e=t;return e},null);tileLayerCount++;return r});if(labelLayer){l.unshift(labelLayer)}}else{tileLayerCount=P.filter(function(e){return e instanceof fnTileLayer}).length}l.forEach(function(e,t){e.orderIndex=P.length-t;if(e.isGroupLayer){e.setZIndex(e.orderIndex)}});P=l;flashnavigator.layers=P;if(flashnavigator.offscreenRendering){C.parent.html5Map.workerSyncLayers()}if(f){f.forEach(function(e){e.group.tileLayer._resetGroup()})}}function p(){P.forEach(function(e){e.setZIndex(e.orderIndex)});if(fnTileLayerGroup.theTileLayer){Object.keys(fnTileLayerGroup.theTileLayer).forEach(function(e){var i;i=fnTileLayerGroup.theTileLayer[e];var t=i.group.filter(function(e){if(e.options.modifier){i.gcmap.has_modifier=true;if(!i.gcmap.modifier){i.gcmap.modifier={}}if(!i.gcmap.modifier_layers){i.gcmap.modifier_layers={}}i.gcmap.modifier_layers[e.id]=1;for(var t in e.options.modifier){i.gcmap.modifier[t]=e.options.modifier[t]}}if(e.copy_modifier){if(!i.gcmap.modifier){i.gcmap.modifier={}}for(var t in e.copy_modifier){i.gcmap.modifier[t]=e.copy_modifier[t]}delete e.copy_modifier}if(e.shouldBeLoaded){e.shouldBeLoaded=false;return true}return false});i.gcmap.setupAttributes();if(!i.viewer){i.viewer=i.group[0].viewer;i._toBeLoaded=true;lv.addLayer(i);i._reloadGroupPartialy()}else{if(t.length>0){i._partialGroup=t;i._reloadGroupPartialy()}else{window.setTimeout(function(){i.redraw()},0)}}})}if(flashnavigator.newLabelingMode){order.unshift(0)}giscloud.util.mediator.publish("labels/rerender")}function g(e){var t=[],i=[],n=false;if(e.parent&&e.parent.options&&e.parent.options.MAP_ENGINE_MODE=="3"){flashnavigator.hasCanvas=false}else{flashnavigator.hasCanvas=flashnavigator.hasCanvasInitialValue}if(e.parent&&e.parent.options&&e.parent.options.DEM_EXAGGERATION!==undefined){var r=+e.parent.options.DEM_EXAGGERATION;if(lv.exaggeration!==r){lv.exaggeration=r;n=true}}else{lv.exaggeration=1.5}if(e.parent&&e.parent.options&&e.parent.options.DEM_MAX_ZOOM!==undefined){var a=+e.parent.options.DEM_MAX_ZOOM;if(lv.demMaxZoom!==a){lv.demMaxZoom=a;n=true}}else{lv.demMaxZoom=14}if(n){lv.reloadTerrain()}e._layersForUpdateCount=0;lv.invalidateSize();if(!e._reloadBound){var s=e.overrideStartBound||e._startBound,o=window.fno&&fno.view&&JSON.parse(fno.view.params);if(o){e.setLocation(o.center.split(",")[0],o.center.split(",")[1],o.scale)}else{e.setViewBound(s.xMin,s.yMin,s.xMax,s.yMax,null,true)}}t=P.reduce(function(e,t){if(t.id.indexOf("llayer")===-1){e.push(window.parseInt(t.id.replace("layer","").replace("_group_",""),10))}return e},[]).reverse();if(lv.isLoaded()){f(t,e)}if(e._is_reload){y("reload",{id:e._mid})}else{y("load",{id:e._mid})}for(var l=0;l<P.length;l++){if(P[l].filterToInitOnLoad){P[l].setFeatureFilter(P[l].filterToInitOnLoad);P[l].filterToInitOnLoad=null}if(P[l].gcmap){P[l].gcmap.setupAttributes()}if(P[l].should_add){P[l].should_add=false;if(!P[l].isGroupLayer){lv.addLayer(P[l])}if(P[l].features){P[l].features_original=[];for(var c=0;c<P[l].features.length;c++){var u={};for(var d in P[l].features[c]){u[d]=P[l].features[c][d]}P[l].features_original[c]=u}P[l].calculateFeatureVisibility()}}else{if(P[l].gcmap){P[l].gcmap.checkAttributesAndReload()}if(P[l].options||P[l].options.attribution){if(P[l].options.attribution&&e.currentAtrribution&&e.currentAtrribution.match(P[l].options.attribution)){continue}e.addAttribution(P[l].options.attribution)}}}loaded=true;if(lv.isLoaded()){p()}if(e.reloadCallback){e.reloadCallback();e.reloadCallback=null}e.parent.html5Map.Html5SendRequests()}function F(e,t){C.setUpMeasureTool(e,t)}function z(r,a){return;var l=lv.map,c=l.measure.options.calculateDistance,e=l.scaleControl,t=this,s;if(!e)return;e.setPosition("bottomleft");if(r==="degree"){e._update=e.original_update;e._updateScales=e.original_updateScales;e.options.metric=a==="meter";e.options.imperial=a!=="meter"}else{e.options.metric=true;e.options.imperial=false;e._update=function(){var e=l.getPixelBounds(),t=e.max.x-e.min.x||1,i=l.getBounds(),n=i._southWest.lat,r=i._northEast.lng,a=i._southWest.lng,s=c(n,r,n,a),o=s/t*this.options.maxWidth;this._updateScales(o)};if(!a||a.indexOf("degree")===0){a="meter"}if(a===r){if(a==="meter"){e._updateScales=function(e){var t=this._getRoundNum(e);this._mScale.style.width=this._getScaleWidth(t/e)+"px";this._mScale.innerHTML=t<1e3?t+" m":t/1e3+" km"}}else{switch(a){case"foot":case"us survey foot":case"foot_us":s=" ft";break;case"mile":s=" mi";break;case"inch":s=" in";break;case"yard":s=" yd";break;default:s=" "+a}e._updateScales=function(e){var t=this._getRoundNum(e);this._mScale.style.width=this._getScaleWidth(t/e)+"px";this._mScale.innerHTML=t+s}}}else{if(a==="meter"){e._updateScales=function(e){var t=giscloud.toMeters(r,e),i=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(i/t)+"px";this._mScale.innerHTML=i<1e3?i+" m":i/1e3+" km"}}else{switch(a){case"foot":case"us survey foot":case"foot_us":s=" ft";break;case"mile":s=" mi";break;case"inch":s=" in";break;case"yard":s=" yd";break;default:s=" "+a}e._updateScales=function(e){var t=giscloud.toMeters(r,e),i=giscloud.fromMeters(a,t),n=this._getRoundNum(i);this._mScale.style.width=this._getScaleWidth(n/i)+"px";this._mScale.innerHTML=n+s}}}}t.parent.loading.done(function(){try{l.removeControl(e)}catch(e){}})}function H(e,t,i){for(var n=e.length-1;n>=0;n--){var r=e[n];if(r.tagName=="source"){var a="";var s={};for(var o=0;o<r.attributes.length;o++){var l=r.attributes[o].name;if(l=="id")a=r.attributes[o].value;if(l=="xmin"||l=="xmax"||l=="ymin"||l=="ymax")s[l]=parseFloat(r.attributes[o].value);else s[l]=r.attributes[o].value}t[a]=s;t[a].tileservers=[];for(var c=r.childNodes.length-1;c>=0;c--){if(r.childNodes[c].tagName=="tileservers"){var u=r.childNodes[c];if(u.attributes){for(var o=0;o<u.attributes.length;o++){if(u.attributes[o].name=="maxzoom"){t[a].maxzoom=parseInt(u.attributes[o].value)}if(u.attributes[o].name=="minzoom"){t[a].minzoom=parseInt(u.attributes[o].value)}if(u.attributes[o].name=="attribution"){t[a].attribution=u.attributes[o].value}}}for(var d=r.childNodes[c].childNodes.length-1;d>=0;d--){var u=r.childNodes[c].childNodes[d];if(u.attributes){for(var o=0;o<u.attributes.length;o++){if(u.attributes[o].name=="value"){t[a].tileservers.push(u.attributes[o].value)}if(u.attributes[o].name=="zoomoffset"){t[a].zoomOffset=parseInt(u.attributes[o].value)}}}}}if(r.childNodes[c].tagName=="tilepath"){var u=r.childNodes[c];if(u.attributes){for(var o=0;o<u.attributes.length;o++){if(u.attributes[o].name=="value"){t[a].tilepath=u.attributes[o].value}}}}}i.push(t[a])}}}function B(t){var i,n=1e-6;["xmin","ymin","xmax","ymax"].forEach(function(e){i=(t[e]-bounds[e])/bounds[e];if(i>=0&&i<n||i===Infinity){t[e]=(1-n)*bounds[e]}})}function W(e,t){for(var i=e.length-1;i>=0;i--){var n=e[i];if(n.tagName=="option"){var r="";for(var a=0;a<n.attributes.length;a++){var s=n.attributes[a].name;if(s=="name")r=n.attributes[a].value;if(s=="value")t[r]=n.attributes[a].value}}}}var q;var G=1;function V(e,t,i,n,r){var a,s,o,l,c;q=[];for(s=e.length-1;s>=0;s--){l=e[s];if(l.tagName=="layer"){c={id:"",alpha:1,visible:true};if(l.attributes){for(o=0;o<l.attributes.length;o++){if(l.attributes[o].name==="id"){c.id=l.attributes[o].value}else if(l.attributes[o].name==="src"){c.src=l.attributes[o].value}else if(l.attributes[o].name==="timestamp"){c.timestamp=l.attributes[o].value}else if(l.attributes[o].name==="offset"){c.offset=l.attributes[o].value}else if(l.attributes[o].name==="precision"){c.precision=l.attributes[o].value*1}else if(l.attributes[o].name==="dynamic"){c.dynamic=l.attributes[o].value*1}else if(l.attributes[o].name==="visible"){c.visible=l.attributes[o].value==="true"}else if(l.attributes[o].name==="alpha"){c.alpha=parseInt(l.attributes[o].value)/100}else if(l.attributes[o].name==="type"){c.type=l.attributes[o].value}else if(l.attributes[o].name==="format"){c.format=l.attributes[o].value}else if(l.attributes[o].name==="level"){c.level=parseInt(l.attributes[o].value)}else if(l.attributes[o].name==="fromlevel"){c.fromlevel=parseInt(l.attributes[o].value)}else if(l.attributes[o].name==="tolevel"){c.tolevel=parseInt(l.attributes[o].value)}else if(l.attributes[o].name==="tooltip"){c.tooltip=l.attributes[o].value}else if(l.attributes[o].name==="hidegeometry"){c.hiddenGeometry=true}else if(l.attributes[o].name==="isDem"){c.useForDEM=l.attributes[o].value=="true"}}}c.features=[];for(o=0;o<l.childNodes.length;o++){if(l.childNodes[o].tagName=="features"){m(l.childNodes[o].childNodes,c)}}if(!t[c.src]){continue}c.xmin=t[c.src].xmin;c.ymin=t[c.src].ymin;c.xmax=t[c.src].xmax;c.ymax=t[c.src].ymax;q.push(c)}}if(flashnavigator.newLabelingMode){a={};q=q.filter(function(e){if(e.id.indexOf("ll")!==-1){a[e.id.replace("ll","l")]=e;return false}return true})}if(a){labelLayerKeys=Object.keys(a);for(s=0;s<labelLayerKeys.length;++s){for(o=0;o<q.length;++o){if(labelLayerKeys[s]!==q[o].id){continue}else{q[o].labelLayerData=a[labelLayerKeys[s]];q[o].styles=a[labelLayerKeys[s]].features;q[o].attribute=a[labelLayerKeys[s]].labels;q[o].timestamp=a[labelLayerKeys[s]].timestamp;break}}}}}function U(e,t){if(t.id==="layer0"&&e.id===t.id){return true}if(t.id===e.id){if(t.timestamp!==e.timestamp||t.xmin!==e.xmin||t.xmax!==e.xmax||t.ymin!==e.ymin||t.ymax!==e.ymax||t.hiddenGeometry!==e.hiddenGeometry||t.features.length!==e.features.length){giscloud.util.mediator.publish("renderer/dropCache");giscloud.util.mediator.publish("labels/clear",t.id)}}if(t.id!==e.id||t.timestamp!==e.timestamp||t.xmin!==e.xmin||t.xmax!==e.xmax||t.ymin!==e.ymin||t.ymax!==e.ymax||t.hiddenGeometry!==e.hiddenGeometry||t.features.length!==e.features.length){return false}return true}function J(e,t,i,n,r){var a,s,o,l,c,u,d,h={},f,p,g,m,v,y,_,b,w=0,x;if(!i.length){labelLayer=null}for(a=0;a<q.length;a++){q[a].oldLayer=null}if(flashnavigator.newLabelingMode&&labelLayer&&i.length){q.push(labelLayer)}b=flashnavigator.hasCanvas&&!(e&&e.parent&&e.parent.options&&e.parent.options.MAP_ENGINE_MODE=="1");flashnavigator.isUsingMapEngineGroupedLayers=b;for(a=0;a<i.length;a++){u=i[a];d=true;for(s=0;s<q.length;s++){o=q[s];if(U(o,u.layer_info)){d=false;o.oldLayer=u;o.fnLayer=u;u.options.tooltip=o.tooltip;break}}if(d){if(u.isTileLayer){tileLayerCount--}if(u._updateLayerCount){u._updateLayerCount(true)}var C=u.tileLayer?u.tileLayer.gcmap:u.gcmap;if(C&&C.has_modifier){var T={};for(var a in C.modifier){var k=a.split("_");if(k.length===2&&k[0]==u.id&&C.modifier[a].color==="selectcolor"){T[a]=C.modifier[a]}}if(Object.keys(T).length>0){h[u.id]=T}}if(u.cleanUpOnRemove)u.cleanUpOnRemove(lv.map);if(!u.isGroupLayer)lv.removeLayer(u);if(flashnavigator.offscreenRenderings&&C){C.workerLayerRemove(u.id)}}}i.length=0;f=0;if(e.layersDEM){delete e.layersDEM}for(a=0;a<q.length;a++){o=q[a];if(o.useForDEM){if(!e.layersDEM){e.layersDEM=[]}e.layersDEM.push(o)}if(!o.dontLoad){if(o.oldLayer){i[f]=o.oldLayer;f++}else{i[f++]=null}}}f=0;if(flashnavigator.newLabelingMode){if(!labelLayer){labelLayer=new LabelLayer({id:"layer0"});labelLayer.viewer=e;giscloud.util.mediator.deleteChannel("tile/loaded");giscloud.util.mediator.makeChannel("tile/loaded",true);giscloud.util.mediator.subscribe("tile/loaded",labelLayer.onTileLoaded.bind(labelLayer));giscloud.util.mediator.deleteChannel("labels/hide");giscloud.util.mediator.makeChannel("labels/hide",true);giscloud.util.mediator.subscribe("labels/hide",labelLayer.hideLabels.bind(labelLayer));giscloud.util.mediator.deleteChannel("labels/show");giscloud.util.mediator.makeChannel("labels/show",true);giscloud.util.mediator.subscribe("labels/show",labelLayer.showLabels.bind(labelLayer));giscloud.util.mediator.deleteChannel("labels/rerender");giscloud.util.mediator.makeChannel("labels/rerender",true);giscloud.util.mediator.subscribe("labels/rerender",labelLayer.rerender.bind(labelLayer));giscloud.util.mediator.deleteChannel("labels/clear");giscloud.util.mediator.makeChannel("labels/clear",true);giscloud.util.mediator.subscribe("labels/clear",labelLayer.clear.bind(labelLayer));i.push(labelLayer)}}p=false;g=false;m=0;v={};f=0;var M=window.location.protocol==="https:"?"https:":"http:";for(a=0;a<q.length;a++){l=q[a];if(l.id==="layer0"){continue}if(l.visible){r[l.src].visible=true}if(!flashnavigator.hasCanvas){l.alpha=100}c=r[l.src].src;if(e.isSrcBasemap(c)){p=true}var S=r[l.src].src_name;if(c==="wmts"&&S&&S.indexOf("mapbox.")===0){p=true}if(i[f]){g=i[f].isGroupLayer;f++;continue}var L="bMXIdiBbYTCR4O14WSlN";var D="PRnjzWuHGMCagCLGWURjAQ";var j="pk.eyJ1IjoiZ2lzLWNsb3VkIiwiYSI6ImNpcWF4enZwdjAwOHZpNm0yZGwzNDl2eTkifQ.2nnP_6MoDn0Ig-H4Ovrgug";var I="pk.eyJ1IjoiZ2lzLWNsb3VkIiwiYSI6ImNpcWF4emwxeDAwODNoeG5zcXV6MmRudXUifQ.HVmcXtwpFADw_8GV9vRdhA";var E="pk.eyJ1IjoiZ2lzLWNsb3VkIiwiYSI6ImNpcjJtZm1ycTAwMDRpNG05M2EzNHlkNHYifQ.F2Ewzr375JuR0qKVtgTXYQ";var A="pk.eyJ1IjoiZ2lzLWNsb3VkIiwiYSI6ImNpcWNhcmxhZjAwNXdpMm5odjN2Y2xjd3oifQ.Xkm-8IqET75Nbv6pJdcCyg";var P="pk.eyJ1IjoiZ2lzLWNsb3VkIiwiYSI6ImNpcWNhczBhNDAwNXhpMm5oYW9sNWNkM2sifQ.PgE89DHu-8GqOvQyOMg3oQ";if(l.type=="raster"){y={noWrap:true,visible:l.visible,opacity:l.alpha,maxZoom:n,modified:l.timestamp};if(!l.format){l.format="jpg"}if(l.level){y.minZoom=y.maxZoom=l.level}if(l.fromlevel){y.minZoom=l.fromlevel}if(l.tolevel&&l.tolevel<n){y.maxZoom=l.tolevel}var O=giscloud.tile_token+":";O="";_=new fnRasterLayer(giscloud_tile_url+"r/"+O+l.timestamp+"/"+t+"/"+l.id+"/{z}/{x}/{y}."+l.format,y);_.id=l.id;_.source=r[l.src];_.useForDEM=l.useForDEM}else if(c=="osm"){_=new fnBasemapLayer((window.location.protocol==="https:"?"https:":"http:")+"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,src:c,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?"<a href='http://www.openstreetmap.org/' target='_blank' rel='noopener noreferrer'>OpenStreetMap</a>":""});_.id=l.id;_.source=r[l.src]}else if(c=="cloudmade_night"){_=new fnBasemapLayer("http://{s}.tile.cloudmade.com/{key}/65053/256/{z}/{x}/{y}.png",{maxZoom:18,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?"Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade":"",key:"d962ac9332ae40b29b77f41aa3b67ca9"});_.id=l.id;_.source=r[l.src]}else if(c=="mapbox.streets"||c=="mapquest-osm"){_=new fnBasemapLayer(M+"//api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}[scale].png?access_token="+j,{maxZoom:20,src:c,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?"&copy; <a href='https://www.mapbox.com/about/maps/' target='_blank' rel='noopener noreferrer'>Mapbox</a> "+"&copy; <a href='http://www.openstreetmap.org/copyright' target='_blank' rel='noopener noreferrer'>OpenStreetMap</a>":""});_.id=l.id;if(window.devicePixelRatio===1){_._url[0]=_._url[0].replace("[scale]","");if(giscloud.offlineMode()){_.options.tileScaleFactor=2}}else{_._url[0]=_._url[0].replace("[scale]","@2x");_.options.tileScaleFactor=2}_.source=r[l.src]}else if(c=="tilejson"&&giscloud.offlineMode()&&r[l.src].attribution.indexOf("MapTiler")>-1){_=new fnBasemapLayer((window.location.protocol==="https:"?"https:":"http:")+"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18,src:c,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:r[l.src].attribution});_.id=l.id;_.source=r[l.src];if(window.devicePixelRatio===1){_._url[0]=_._url[0].replace("[scale]","");if(giscloud.offlineMode()){_.options.tileScaleFactor=2}}else{_._url[0]=_._url[0].replace("[scale]","@2x");_.options.tileScaleFactor=2}_.source=r[l.src]}else if(c=="mapbox.light"){_=new fnBasemapLayer(M+"//api.mapbox.com/v4/mapbox.light/{z}/{x}/{y}[scale].png?access_token="+I,{maxZoom:20,src:c,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?"&copy; <a href='https://www.mapbox.com/about/maps/' target='_blank' rel='noopener noreferrer'>Mapbox</a> "+"&copy; <a href='http://www.openstreetmap.org/copyright' target='_blank' rel='noopener noreferrer'>OpenStreetMap</a>":""});_.id=l.id;if(window.devicePixelRatio===1){_._url[0]=_._url[0].replace("[scale]","");if(giscloud.offlineMode()){_.options.tileScaleFactor=2}}else{_._url[0]=_._url[0].replace("[scale]","@2x");_.options.tileScaleFactor=2}_.source=r[l.src]}else if(c=="mapbox.dark"){_=new fnBasemapLayer(M+"//api.mapbox.com/v4/mapbox.dark/{z}/{x}/{y}[scale].png?access_token="+E,{maxZoom:20,src:c,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?"&copy; <a href='https://www.mapbox.com/about/maps/' target='_blank' rel='noopener noreferrer'>Mapbox</a> "+"&copy; <a href='http://www.openstreetmap.org/copyright' target='_blank' rel='noopener noreferrer'>OpenStreetMap</a>":""});_.id=l.id;if(window.devicePixelRatio===1){_._url[0]=_._url[0].replace("[scale]","");if(giscloud.offlineMode()){_.options.tileScaleFactor=2}}else{_._url[0]=_._url[0].replace("[scale]","@2x");_.options.tileScaleFactor=2}_.source=r[l.src]}else if(c=="mapbox.satellite"||c=="mapquest-oarial"){_=new fnBasemapLayer(M+"//api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}[scale].jpg?access_token="+A,{maxZoom:20,src:c,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?"&copy; <a href='https://www.mapbox.com/about/maps/' target='_blank' rel='noopener noreferrer'>Mapbox</a> "+"&copy; <a href='http://www.openstreetmap.org/copyright' target='_blank' rel='noopener noreferrer'>OpenStreetMap</a>":""});_.id=l.id;if(window.devicePixelRatio===1){_._url[0]=_._url[0].replace("[scale]","");if(giscloud.offlineMode()){_.options.tileScaleFactor=2}}else{_._url[0]=_._url[0].replace("[scale]","@2x");_.options.tileScaleFactor=2}_.source=r[l.src]}else if(c=="mapbox.satellite-streets"){_=new fnBasemapLayer(M+"//api.mapbox.com/v4/mapbox.streets-satellite/{z}/{x}/{y}[scale].jpg?access_token="+P,{maxZoom:20,src:c,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?"&copy; <a href='https://www.mapbox.com/about/maps/' target='_blank' rel='noopener noreferrer'>Mapbox</a> "+"&copy; <a href='http://www.openstreetmap.org/copyright' target='_blank' rel='noopener noreferrer'>OpenStreetMap</a>":""});_.id=l.id;if(window.devicePixelRatio===1){_._url[0]=_._url[0].replace("[scale]","");if(giscloud.offlineMode()){_.options.tileScaleFactor=2}}else{_._url[0]=_._url[0].replace("[scale]","@2x");_.options.tileScaleFactor=2}_.source=r[l.src]}else if(c=="here.satellite"){_=new fnBasemapLayer(M+"//2.aerial.maps.cit.api.here.com/maptile/2.1/maptile/newest/satellite.day/{z}/{x}/{y}/256/png8?app_id="+L+"&app_code="+D,{maxZoom:20,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?"&copy; <a href='https://developer.here.com/' target='_blank' rel='noopener noreferrer'>HERE</a> ":""});_.id=l.id;_.source=r[l.src]}else if(c=="here.streets"){_=new fnBasemapLayer(M+"//1.base.maps.cit.api.here.com/maptile/2.1/maptile/newest/normal.day/{z}/{x}/{y}/256/png8?app_id="+L+"&app_code="+D,{maxZoom:20,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?"&copy; <a href='https://developer.here.com/' target='_blank' rel='noopener noreferrer'>HERE</a> ":""});_.id=l.id;_.source=r[l.src]}else if(c=="croatianq"){_=new fnBasemapLayer("http://dhwov6czq254q.cloudfront.net/gettile.php?t=tilestache88/{z}/{x}/{y}.png?v=1",{maxZoom:18,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?" &copy; <a href='http://www.navteq.com' target='_blank' rel='noopener noreferrer'>NAVTEQ</a>":""});_.id=l.id;_.source=r[l.src]}else if(c=="italia"){_=new fnBasemapLayer("http://webgis.regione.sardegna.it/tms/ortofoto2006_EPSG3003/{z}/{x}/{y}.jpg",{maxZoom:18,noWrap:true,visible:l.visible,opacity:l.alpha,continuousWorld:true,attribution:l.visible?" &copy; <a href='http://www.italia' target='_blank' rel='noopener noreferrer'>NAVTEQ</a>":""});_.id=l.id;_.source=r[l.src]}else if(c=="grajs"){_=new fnBasemapLayer("http://dhwov6czq254q.cloudfront.net/gettile.php?t=tilestache17403/{z}/{x}/{y}.png",{maxZoom:18,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?" &copy; <a href='http://www.grajsmape.com' target='_blank' rel='noopener noreferrer'>Grajs Mape</a>":""});_.id=l.id;_.source=r[l.src]}else if(c=="maps_for_free_relief"){_=new fnBasemapLayer("https://maps-for-free.com/layer/relief/z{z}/row{y}/{z}_{x}-{y}.jpg",{maxZoom:11,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:l.visible?" <a href='https://www.maps-for-free.com/html/about.html' target='_blank' rel='noopener noreferrer'>Maps-For-Free Relief</a>":""});_.id=l.id;_.source=r[l.src]}else if(c=="bing"){_=new fnQuadLayer(window.location.protocol=="https:"?"https://t{s}.ssl.ak.dynamic.tiles.virtualearth.net/comp/ch/{q}?mkt=en-us&it=G,VE,BX,L,LA&shading=hill&n=z":"http://ecn.t{s}.tiles.virtualearth.net/tiles/r{q}?g=811&mkt=en-us&lbl=l1&stl=h&shading=hill&n=z",{minZoom:1,maxZoom:19,noWrap:true,visible:l.visible,subdomains:"0123",opacity:l.alpha,attribution:l.visible?"<a href='http://maps.bing.com/' target='_blank' rel='noopener noreferrer'>Bing Maps</a>"+"&nbsp;&copy; NAVTEQ, &copy; Microsoft Corporation":""});_.id=l.id;_.source=r[l.src]}else if(c=="bing_sat"){_=new fnQuadLayer(window.location.protocol=="https:"?"https://t{s}.ssl.ak.dynamic.tiles.virtualearth.net/comp/ch/{q}?mkt=en-us&it=A&shading=hill&n=z":"http://ak.t{s}.tiles.virtualearth.net/tiles/a{q}?g=1457&n=z",{minZoom:1,maxZoom:19,noWrap:true,visible:l.visible,subdomains:"0123",opacity:l.alpha,attribution:l.visible?"<a href='http://maps.bing.com/' target='_blank' rel='noopener noreferrer'>Bing Maps Satellite</a>"+"&nbsp;&copy; Microsoft Corporation":""});_.id=l.id;_.source=r[l.src]}else if(c=="bing_hyb"){_=new fnQuadLayer(window.location.protocol=="https:"?"https://ecn.t{s}.tiles.virtualearth.net/tiles/h{q}?g=1457&n=z":"http://ak.t{s}.tiles.virtualearth.net/tiles/h{q}?g=1457&n=z",{minZoom:1,maxZoom:19,noWrap:true,visible:l.visible,subdomains:"0123",opacity:l.alpha,attribution:l.visible?"<a href='http://maps.bing.com/' target='_blank' rel='noopener noreferrer'>Bing Maps Hybrid</a>"+"&nbsp;&copy; Microsoft Corporation":""});_.id=l.id;_.source=r[l.src]}else if(c=="wms"||(r[l.src].tilepath||r[l.src].tilepath=="")){_=new fnWmsLayer(r[l.src].tilepath==""?r[l.src].tileservers:r[l.src].tileservers[0]+r[l.src].tilepath,{maxZoom:n,noWrap:true,visible:l.visible,subdomains:"0123",opacity:l.alpha,gctms:r[l.src].src==="tms",attribution:r[l.src].attribution,srcName:r[l.src].src_name});_.id=l.id;_.source=r[l.src];if(_.options.srcName&&(_.options.srcName==="mapbox.streets"||_.options.srcName==="mapbox.light"||_.options.srcName==="mapbox.dark"||_.options.srcName==="mapbox.satellite"||_.options.srcName==="mapbox.satellite-streets")){_.options.attribution="&copy; <a href='https://www.mapbox.com/about/maps/' target='_blank' rel='noopener noreferrer'>Mapbox</a> "+"&copy; <a href='http://www.openstreetmap.org/copyright' target='_blank' rel='noopener noreferrer'>OpenStreetMap</a>"}if(_._url&&_._url.length>0&&(_._url[0].match("api.maptiler.com/maps/streets")||_._url[0].match("api.maptiler.com/maps/darkmatter")||_._url[0].match("api.maptiler.com/maps/bright"))){_.options.attribution="&copy; <a href='http://www.openstreetmap.org/copyright' target='_blank' rel='noopener noreferrer'>OpenStreetMap</a>"}}else if(c=="tilejson"){var N=r[l.src];_=new fnLayer(N.tileservers,{maxZoom:N.maxzoom,noWrap:true,visible:l.visible,opacity:l.alpha,attribution:N.attribution});_.id=l.id;_.source=N}else{var R;e.isUsingMapEngineGroupedLayers=b;if(flashnavigator.newLabelingMode&&l.labels&&l.dontLoad&&l.id.substr(0,2)=="ll"){v[l.id.substr(1)]={attribute:l.labels,type:l.labelsType,features:l.features};continue}R={mid:t,id:l.id,modified:l.timestamp,lmap:lv.map,maxZoom:n,offset:l.offset,visible:l.visible,precision:l.precision,cluster:l.cluster,dynamic:l.dynamic,opacity:l.alpha,tooltip:l.tooltip,dontLoad:l.dontLoad,source:r[l.src],modifier:h[l.id]};if(b){_=new fnTileLayerGroup(R,e.parent.html5Map);_.shouldBeLoaded=true}else{_=new fnTileLayer(R,e.parent.html5Map)}_.labelData=l;_.has_inner_line=l.has_inner_line;if(labelLayer){labelLayer.updateLayerDescriptor(_.id,l)}if(layers_feature_filter[l.id]&&_.setFeatureFilter){_.filterToInitOnLoad=layers_feature_filter[l.id]}if(!_.tileLayer){_.isTileLayer=true}}l.fnLayer=_;_.features=l.features;_.has_icon=l.has_icon;_.layer_info=l;_.should_add=true;_.viewer=e;i[f++]=_;g=_.isRootLayer}if(p){lv.setProjection(3857)}else{lv.setProjection(4326)}lv.map.gc_bounds=bounds;lv.map.layersMaxLevel=n;lv.map.unitFactor=unitFactor;for(a=0;a<i.length;a++){if(v[i[a].id]){i[a].labels=v[i[a].id]}if(i[a].options.maxZoom>n){i[a].options.maxZoom=n}if(i[a].options.minZoom>w&&i[a].layer_info.type!=="raster"){w=i[a].options.minZoom}}e.setMinZoom(w);if(labelLayer){labelLayer.layers=i.filter(function(e){return e.id!=="layer0"}).reduce(function(e,t){e[t.id]=t;return e},{});giscloud.util.mediator.publish("labelRenderer/dropCache");giscloud.util.mediator.publish("labels/rerender")}G=n}function m(e,t){t.features=[];for(var i=0;i<e.length;i++){var n=e[i];if(n.tagName!="feature")continue;var r={};if(n.attributes){for(var a=0;a<n.attributes.length;a++){if(n.attributes[a].name=="icon"||n.attributes[a].name=="hatchurl"||n.attributes[a].name=="hatchgalleryurl"){r.icon=n.attributes[a].value;t.has_icon=true}else if(n.attributes[a].name=="outline"){r.outline=n.attributes[a].value}else if(n.attributes[a].name=="color"){r.color=n.attributes[a].value}else if(n.attributes[a].name=="strokecolor"){r.strokecolor=n.attributes[a].value;r.strokecolorRGB=giscloud.Color.hexToRgb(r.strokecolor)}else if(n.attributes[a].name=="innerstrokecolor"){r.innerstrokecolor=n.attributes[a].value}else if(n.attributes[a].name=="fillcolor"){r.fillcolor=n.attributes[a].value;r.fillcolorRGB=giscloud.Color.hexToRgb(r.fillcolor)}else if(n.attributes[a].name=="linewidth"){r.linewidth=n.attributes[a].value*1}else if(n.attributes[a].name=="innerlinewidth"){r.innerlinewidth=n.attributes[a].value*1}else if(n.attributes[a].name=="width"){r.width=n.attributes[a].value*1}else if(n.attributes[a].name=="anchor"){r.anchor=n.attributes[a].value}else if(n.attributes[a].name=="dx"){r.dx=n.attributes[a].value*1}else if(n.attributes[a].name=="dy"){r.dy=n.attributes[a].value*1}else if(n.attributes[a].name=="type"){r.type=n.attributes[a].value}else if(n.attributes[a].name=="visible"){r.visible=n.attributes[a].value==="1"}else if(n.attributes[a].name=="text"||n.attributes[a].name=="label"){if(flashnavigator.newLabelingMode){r.label=n.attributes[a].value.toLowerCase();t.labels=t.labels||{};t.labels[r.label]=1;t.labelsType=n.attributes[a].name;t.dontLoad=true}}else if(n.attributes[a].name=="clustering"){r.clustering=parseInt(n.attributes[a].value)}else if(n.attributes[a].name=="fontname"){r.fontname=n.attributes[a].value}else if(n.attributes[a].name=="query"){r.expression=n.attributes[a].value}else if(n.attributes[a].name=="querylabel"){r.expressionLabel=n.attributes[a].value}else if(n.attributes[a].name=="fontsize"){r.fontsize=parseInt(n.attributes[a].value)}else if(n.attributes[a].name=="dashed"){r.dashed=n.attributes[a].value;if(r.dashed){r.dashed=r.dashed.split(",");for(var s=0;s<r.dashed.length;s++){r.dashed[s]*=1}}}else if(n.attributes[a].name==="style"){r.styleName=n.attributes[a].value}}}if(r.label)t.labelsType=r.type;t.features.unshift(r)}if(t.labels){var o=[];for(var s in t.labels){o.push(s)}t.labels=o.join(",")}}s=[];function y(e,t){if(!s[e])return;for(var i=0;i<s[e].length;i++){s[e][i](t)}}var _=0;this.on("dragstart",function(){_=1});this.on("dragend",function(){_=0});function b(t,i,n,r){if(!loaded||!P||P.length==0)return 0;var e,a,s,o,l,c,u,d,h,f,p=t.z,g;e=Math.floor(t.mapX);a=Math.floor(t.mapY);t.offsetX=256*(t.mapX-e);t.offsetY=256*(t.mapY-a);t.showMousePointer=0;s=false;for(u=0;u<P.length;++u){c=P[u].tileLayer||P[u];if(c.tilesToLoad&&c.tilesToLoad()){s=true;break}}g=C.parent.html5Map.getTileKey(e,a,p);if(flashnavigator.offscreenRendering){C.parent.html5Map.workerProcessMousePosition(t,g,x,v,i);return}t.hoveredObject=null;var m=function(e){f=e?g+"W"+e:g;if(!c._tiles[f]||!c._tiles[f].gc_state){return false}o=c._tiles[f];l=o.gc_state.obj;t.currentTile=o;d=l.parent;o.gc_state.layer=P[u].id;o.gc_state.curLayerObj=P[u];h=l.onMouseMove(t,n,r,P[u]);l.parent=d;t.currentTile=null;if(h){h.coord=o.coord;t.hoveredObject=h;t.showMousePointer=1;if(!(x&&h.c===x.c)){i(t)}return true}return false};for(u=0;u<P.length;++u){c=P[u].tileLayer||P[u];if(c._tiles&&P[u].options.visible&&c.isTileLayer){if(m()){return}if(m(1)){return}if(m(-1)){return}}}if(!s){i(t)}}function w(e,t){var i=x;if(i&&s[t]){var n=1<<lv.getScale();var r={id:i.c?i.c.replace("_","||"):"",object:i};if(e){r.x=e.x;r.y=e.y;if(i.coord){r.bounds={xmin:bounds.xmin+(r.object.b.xmin/flashnavigator.tileSize+i.coord.x)*bounds.max/n,xmax:bounds.xmin+(r.object.b.xmax/flashnavigator.tileSize+i.coord.x)*bounds.max/n,ymin:bounds.ymax-(r.object.b.ymax/flashnavigator.tileSize+i.coord.y)*bounds.max/n,ymax:bounds.ymax-(r.object.b.ymin/flashnavigator.tileSize+i.coord.y)*bounds.max/n}}}if(e&&(e.ctrlKey||e.originalEvent&&e.originalEvent.ctrlKey||e.originalEvent&&e.originalEvent.metaKey)){r.key=17}y(t,r);return}}var x=null;var T;var k;var M;var S=null;function L(){b(M,function(e){if(e.hoveredObject){x={};x.c=e.hoveredObject.c;x.attributes=e.hoveredObject.attributes;x.data=e.hoveredObject.data;x.cl=e.hoveredObject.cl;x.coord=e.hoveredObject.coord;x.b=e.hoveredObject.b}else{x=null}S=e;w(e,"object_click")},true,10*flashnavigator.scaleRatio)}this.on("touchstart",function(e){if(e.originalEvent.targetTouches.length!=1)return;var t=e.originalEvent.targetTouches[0];M=e;k={x:t.pageX,y:t.pageY};window.clearTimeout(T);T=window.setTimeout(L,200);y("mousemove",{x:e.x,y:e.y})});this.on("touchend",function(e){window.clearTimeout(T);if(M)L()});this.on("touchmove",function(e){if(!k)return;var t=e.originalEvent.targetTouches[0];var i=Math.abs(t.pageX-k.x);var n=Math.abs(t.pageY-k.y);if(i>2||n>2){M=null;window.clearTimeout(T)}});if(!common.isMobileBrowser){this.on("mousemove",function(e){var t={x:e.x,y:e.y,z:e.z,mapX:e.mapX,mapY:e.mapY,ctrlKey:e.ctrlKey};if(e.originalEvent){t.originalEvent={ctrlKey:e.originalEvent.ctrlKey,metaKey:e.originalEvent.metaKey}}if(!v){if(S){b(t,function(){});w(S,"object_out");S=null;x=null}return 0}if(!bounds||_)return 0;b(t,function(e){if(e.showMousePointer){lv.setCursor("pointer");if(e.hoveredObject){x={};x.c=e.hoveredObject.c;x.attributes=e.hoveredObject.attributes;x.data=e.hoveredObject.data;x.cl=e.hoveredObject.cl;x.coord=e.hoveredObject.coord;x.b=e.hoveredObject.b}else{x=null}S=e;w(e,"object_over")}else{if(!flashnavigator.hasCanvas&&(C._currentTool=="InfoTool"||C._currentTool=="SelectTool")){lv.setCursor("default")}else{lv.setCursor("")}if(S){w(S,"object_out");S=null;x=null}}});if(s["mousemove"]){y("mousemove",{x:e.x,y:e.y})}});this.on("dblclick",function(e){w(e,"object_dblclick")});this.on("click",function(e){w(e,"object_click")})}this.on("mousedown",function(e){b(e,function(e){if(s["mousedown"]){y("mousedown",{x:e.x,y:e.y})}})});this.on("dblclick",function(e){b(e,function(e){if(s["doubleClick"]){y("doubleClick",{x:e.x,y:e.y})}})});this.on("mouseup",function(e){b(e,function(e){if(s["mouseup"]){y("mouseup",{x:e.x,y:e.y})}})});this.on("dragend",function(e){if(s["dragend"]){y("dragend",{})}});this.calculateScaleZoom=function(e){if(bounds&&bounds.max)return Math.pow(2,e)*256/bounds.max;else return 0};this.addEventListener=function(e,t){if(e=="scalechange"){if(!s["scalechange"]){s["scalechange"]=new Array;this.on("zoomend",function(e){var t=new Object;if(bounds&&bounds.max)t.zoom=C.calculateScaleZoom(lv.getScale());y("scalechange",t)})}}else if(e=="boundschange"){if(!s["boundschange"]){s["boundschange"]=new Array;this.on("move",function(e){var t={bounds:C.getViewBound()};y("boundschange",t)})}}else{if(!s[e])s[e]=new Array}s[e].push(t)};this.removeEventListener=function(e,t){var i,n,r=s[e];if(r){for(i=0,n=r.length;i<n;i++){if(r[i]===t){r.splice(i,1);i--;n--}}}}};giscloud.Html5MapRefreshUrls=function(){giscloud_tile_url=giscloud_config.tileSite()};var is_edge_android=window.navigator.userAgent.indexOf("EdgA/")>-1;common.LegacyHtml5Map=function LegacyHtml5Map(flashnavigator){var isWebKit=navigator.userAgent.indexOf("WebKit")>0;var isMouseDown;var fields;var _selectablePoly;var bounds;var selectionEnabled=false;var laycount=0;var loader_id=0;var active_loaders={};var tile_request={};var tile_req=[];var tile_req_seq=0;var text_data={};var outerSendRequests;flashnavigator.scaleRatio=window.devicePixelRatio?Math.ceil(window.devicePixelRatio):1;flashnavigator.tileSize=256*flashnavigator.scaleRatio;flashnavigator.canvasOptions={};var Html5SendRequests=this.Html5SendRequests=function(){if(outerSendRequests&&outerSendRequests.call){outerSendRequests()}else{console.warn("no sendRequests()")}};this.Html5MapSetSelection=function(e){selectionEnabled=e};this.workerSyncLayers=function(){workerSyncLayers()};this.workerProcessMousePosition=function(e,t,i,n,r){workerProcessMousePosition(e,t,i,n,r)};this.getTileKey=function(e,t,i,n,r){return getTileKey(e,t,i,n,r)};this.Html5Map=function(e,t){_init(e,this);this.parent=t;this._layer=e;laycount++;var i=this;var n=flashnavigator.scaleRatio;window.addEventListener("resize",function(){flashnavigator.scaleRatio=window.devicePixelRatio?Math.ceil(window.devicePixelRatio):1;flashnavigator.tileSize=256*flashnavigator.scaleRatio;if(n!=flashnavigator.scaleRatio){if(flashnavigator.offscreenRendering){workerHandlerUpdateScaleRatio()}else{initTileCache()}i.redraw(false,true);n=flashnavigator.scaleRatio}},true);outerSendRequests=sendRequests;this.Html5SendRequests=Html5SendRequests;this.getCanvasFromPool=function(e,t,i){return getCanvasFromPool(e,t,i)};this.releaseCanvasToPool=function(e){releaseCanvasToPool(e)};this.canvasPoolCleanUp=function(){canvasPoolCleanUp()};this.resetCache=function(){resetTileCache()};this._loadTile=_loadTile;this.setFields=function(e){fields=e};this.getTile=function(e,t,i){return _getTile(e,t,i,this)};this.loadTile=function(e,t,i){return _loadTile(e,t,i,this)};this.unloadTile=function(e,t){unloadTile(e,t)};this.selectablePoly=function(e){_selectablePoly=e};this.setBounds=function(e){bounds=e};this.onMouseMove=function(e,t,i,n){if(n._selectable)return checkForEvent(e,t,i);else return false};this.onMouseUp=function(e){};this.onMouseDown=function(e){};this.modifyObject=function(e,t,i,n,r,a){if(flashnavigator.offscreenRendering){workerModifyObject(this.parent.id,e,t,i,n,r,a);return}modifyObject(this,e,t,i,n,r,a)};this.redraw=function(e,t,i){redraw(this.parent,e,t,i)};this.redrawSingleTile=function(e){redrawSingleTile(this.parent,e,null,true)};this.redrawNeighbourTiles=function(e){redrawNeighbourTiles(e)};this.restoreTileFromCache=function(e){if(flashnavigator.offscreenRendering){workerRestoreTileFromCache(this.parent.id,e.gc_state._tileIndex,e.gc_state._cacheId,e.gc_state._tileIndexWrap)}else{this.redrawSingleTile(e)}};this.storeTileToCache=function(e){if(flashnavigator.offscreenRendering){workerStoreTileToCache(this.parent.id,e.gc_state._tileIndex,e.gc_state._cacheId)}};this.getTileKey=function(e,t,i,n,r){return getTileKey(e,t,i,n,r)};this.reload=function(e){var t=this,i={},n=this.parent._tiles,r;if(e)this.reinitCanvases();this.parent.resetCache();if(Object.keys(n).length===0){this.parent.update();return}for(r in n){if(n[r].coord||n[r].gc_state){n[r].styles=null;if(!_loadTile(n[r],n[r].coord,n[r].zoom,this)){i[r]=true}}}setTimeout(function(){t.parent.update();if(Object.keys(i).length>0){t.redraw(undefined,undefined,i)}},0)};this.resetLoaders=function(){resetLoaders()};this.abortRequest=function(e){if(!e||!e.gc_state){return}if(flashnavigator.offscreenRendering){workerAbortRequest(e);return}for(var t=0,i=tile_req.length;t<i;t++){if(tile_req[t].gc_state===e.gc_state){tile_req[t].tile=null}}abortRequest(e)};this.getFeature=function(e){var t=e.replace("||","_");var i=this.parent._tiles;for(var n in i){if(i[n].fields&&i[n].fields[t]){return i[n].fields[t]}}};this.getFeatureIds=function(e,t){var i=this.parent._tiles,n=[],r;if(!e)return;if(!t){t=this.parent.id}for(r in i){if(this.parent._tileShouldBeVisible(i[r].coord)){n.push(r)}}if(flashnavigator.offscreenRendering){workerGetFeatureIds(t,this.parent.id,n,e)}else{e(t,getFeatureIdsInTiles(t,n,this.parent._tiles))}};this.renderLabels=function(e,t){renderLabelTile(e,t)};this.checkAttributesAndReload=function(){checkAttributesAndReload(this.parent)};this.setupAttributes=function(){var e="";if(this.parent.feature_filter){e=i.parent.feature_filter.attributes}if(this.parent.labels){if(e){e+=","}e+=this.parent.labels.attribute}if(this.parent.labelData&&this.parent.labelData.attribute){if(e){e+=","}e+=this.parent.labelData.attribute}if(this.parent.options.tooltip){if(e){e+=","}e+=this.parent.options.tooltip}this.feature_attributes=unique_array(e.split(",")).join(",")};this.removeTileFromCache=function(e){removeTileFromCache(e)};this.workerLayerUpdate=function(e,t){workerLayerUpdate(e,t)};this.workerUnloadTiles=function(e){workerUnloadTiles(e)};this.workerUnloadTile=function(e,t,i){workerUnloadTile(e,t,i)};this.workerLayerRemove=function(e){workerLayerRemove(e)};this.workerResetGroup=function(e,t){workerResetGroup(e,t)};this.workerLayerSetFilter=function(e,t){workerLayerSetFilter(e,t)};this.workerCanvasPoolCleanUp=function(){workerCanvasPoolCleanUp()};this.workerWrapTiles=function(e,t){workerWrapTiles(e,t)};return this};(function e(){if(!self.performance){var t=Date.now();self.performance={now:function e(){return Date.now()-t}}}})();(function(){"use strict";if(!giscloud){giscloud={math:{}}}else if(!giscloud.math){giscloud.math={}}(function(){"use strict";var e=giscloud.math;function t(){function s(e,t){if(!this){throw new Error("[giscloud.math.Vector2] is a constructor and must be invoked with `new`")}if(Array.isArray(e)){this.x=e[0]||0;this.y=e[1]||0}else if(e instanceof s){this.x=e.x;this.y=e.y}else if(typeof e==="number"){if(typeof t==="number"){this.x=e;this.y=t}else{this.x=e;this.y=e}}else{this.x=0;this.y=0}}s.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};s.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y};s.prototype.angle=function(){return Math.atan2(this.y,this.x)};s.prototype.add=function(e,t){var i=new s(e,t);i.x+=this.x;i.y+=this.y;return i};s.prototype.subtract=function(e,t){var i=new s(e,t);i.x=this.x-i.x;i.y=this.y-i.y;return i};s.prototype.dot=function(e,t){var i=new s(e,t);return this.x*i.x+this.y*i.y};s.prototype.scale=function(e){return new s(this.x*e,this.y*e)};s.prototype.cross=function(){return new s(this.y,-this.x)};s.prototype.distanceTo=function(e,t){var i=new s(e,t);i.x-=this.x;i.y-=this.y;return i.length()};s.prototype.distanceToSquared=function(e,t){var i=new s(e,t);i.x-=this.x;i.y-=this.y;return i.lengthSquared()};s.lerp=function(e,t,i){i=Math.min(Math.max(i,0),1);var n=1-i,r=new s(e),a=new s(t);return new s(r.x*n+a.x*i,r.y*n+a.y*i)};e.Vector2=s}t();e.Vector2.define=t})();(function(){"use strict";var s=giscloud.math;function e(){function n(e,t,i,n){if(!this){throw new Error("[giscloud.math.Matrix2] is a constructor and must be invoked with `new`")}if(typeof e==="number"&&typeof t==="number"&&typeof i==="number"&&typeof n==="number"){this.x=new s.Vector2(e,t);this.y=new s.Vector2(i,n)}else if(e instanceof s.Vector2&&t instanceof s.Vector2){this.x=new s.Vector2(e);this.y=new s.Vector2(t)}else if(Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[1])){this.x=new s.Vector2(e[0][0],e[0][1]);this.x=new s.Vector2(e[1][0],e[1][1])}else{this.x=new s.Vector2(1,0);this.y=new s.Vector2(0,1)}}n.prototype.transform=function(e){if(e instanceof s.Vector2){return new s.Vector2(this.x.x*e.x+this.x.y*e.y,this.y.x*e.x+this.y.y*e.y)}else if(e instanceof giscloud.math.Rect){var t=e.center(),i=e.min.subtract(t),n=new s.Vector2(e.max.x,e.min.y).subtract(t),r=e.max.subtract(t),a=new s.Vector2(e.max.x,e.max.y).subtract(t);i=this.transform(i).add(t);n=this.transform(n).add(t);r=this.transform(r).add(t);a=this.transform(a).add(t);return new giscloud.math.Rect(t,t).extend(i).extend(n).extend(r).extend(a)}};n.prototype.mul=function(e){return new n(this.x.x*e.x.x+this.x.y*vec2.y.x,this.x.x*e.x.y+this.x.y*vec2.y.y,this.y.x*e.x.x+this.y.y*vec2.y.x,this.y.x*e.x.y+this.y.y*vec2.y.y)};n.prototype.scale=function(e,t){return new n(this.x.scale(e),this.y.scale(e))};n.prototype.rotate=function(e){return this.mul(n.Rotation(e))};n.Scale=function(e,t){return new n(e,0,0,t)};n.Identity=function(){return new n};n.Rotation=function(e){var t=Math.sin(e),i=Math.cos(e);return new n(i,-t,t,i)};s.Matrix2=n}e();s.Matrix2.define=e})();(function(){"use strict";var g=giscloud.math;function e(){function a(e,t,i,n){if(!this){throw new Error("[giscloud.math.Rect] is a constructor and must be invoked with `new`")}if(e instanceof a){this.min=new g.Vector2(e.min);this.max=new g.Vector2(e.max)}else if(Array.isArray(e)&&Array.isArray(t)){this.min=new g.Vector2(e);this.max=new g.Vector2(t)}else if(e instanceof g.Vector2&&t instanceof g.Vector2){this.min=new g.Vector2(e);this.max=new g.Vector2(t)}else if(typeof e==="number"&&typeof t==="number"&&typeof i==="number"&&typeof n==="number"){this.min=new g.Vector2(e,t);this.max=new g.Vector2(i,n)}else{this.min=new g.Vector2(0,0);this.max=new g.Vector2(0,0)}}a.prototype.position=function(){return this.min};a.prototype.size=function(){return this.max.subtract(this.min)};a.prototype.left=function(){return this.min.x};a.prototype.top=function(){return this.min.y};a.prototype.right=function(){return this.max.x};a.prototype.bottom=function(){return this.max.y};a.prototype.area=function(){var e=this.size();return e.x*e.y};a.prototype.equals=function(e){if(!(e instanceof a)){throw new Error("[giscloud.math.Rect#equals] rect argument must be an instance of giscloud.math.Rect")}else{return this.min.x===e.min.x&&this.min.y===e.min.y&&this.max.x===e.max.x&&this.max.y===e.max.y}return false};a.prototype.center=function(){return new g.Vector2(.5*(this.min.x+this.max.x),.5*(this.min.y+this.max.y))};a.prototype.translate=function(e,t){var i=new g.Vector2(e,t);return new a(this.min.add(i),this.max.add(i))};a.prototype.contains=function(e){if(e instanceof g.Vector2){return e.x>=this.min.x&&e.x<=this.max.x&&(e.y>=this.min.y&&e.y<=this.max.y)}else if(e instanceof a){return this.contains(e.min)&&this.contains(e.max)}else{throw new Error("[giscloud.math.Rect#contains] Invalid argument supplied, "+"must be instance of giscloud.math.self.Vector2 or giscloud.math.Rect")}};a.prototype.intersects=function(e,t,i,n){var r=new a(e,t,i,n);return!(r.min.x>this.max.x)&&!(r.max.x<this.min.x)&&!(r.min.y>this.max.y)&&!(r.max.y<this.min.y)};a.prototype.intersection=function(e,t,i,n){var r=new a(e,t,i,n);if(this.intersects(r)){r.min.x=Math.max(this.min.x,r.min.x);r.min.y=Math.max(this.min.y,r.min.y);r.max.x=Math.min(this.max.x,r.max.x);r.max.y=Math.min(this.max.y,r.max.y);return r}else{return null}};a.prototype.extend=function(e,t){var i=new g.Vector2(e,t);return new a(Math.min(i.x,this.min.x),Math.min(i.y,this.min.y),Math.max(i.x,this.max.x),Math.max(i.y,this.max.y))};a.fromArrayPolygon=function(e){var t=new g.Vector2,i=new g.Vector2,n;for(n=0;n<e.length;n+=2){t.x=Math.min(t.x,e[0]);t.y=Math.min(t.x,e[1]);i.x=Math.max(i.x,e[0]);i.y=Math.max(i.x,e[1])}return new a(t,i)};a.nearestNonIntersectingOffset=function(e,t){var i,n=.5;i=intersectBounds(e,t);if(!i){return null}if(e.contains(t.min)&&!e.contains([t.max.x,t.min.y])&&!e.contains(t.max)&&!e.contains([t.min.x,t.max.y])||!t.contains(e.min)&&!t.contains([e.max.x,e.min.y])&&t.contains(e.max)&&!t.contains([e.min.x,e.max.y])){offset=i.min.subtract(i.max).scale(n);if(Math.abs(offset.x)<Math.abs(offset.y)){offset.y=0}else{offset.x=0}}else if(!e.contains(t.min)&&!e.contains([t.max.x,t.min.y])&&e.contains(t.max)&&!e.contains([t.min.x,t.max.y])||t.contains(e.min)&&!t.contains([e.max.x,e.min.y])&&!t.contains(e.max)&&!t.contains([e.min.x,e.max.y])){offset=i.max.subtract(i.min).scale(n);if(Math.abs(offset.x)<Math.abs(offset.y)){offset.y=0}else{offset.x=0}}else if(!e.contains(t.min)&&e.contains([t.max.x,t.min.y])&&!e.contains(t.max)&&!e.contains([t.min.x,t.max.y])||!t.contains(e.min)&&!t.contains([e.max.x,e.min.y])&&!t.contains(e.max)&&t.contains([e.min.x,e.max.y])){offset=i.max.subtract(i.min).scale(n);if(Math.abs(offset.x)<Math.abs(offset.y)){offset.y=0}else{offset.x=0}}else if(!e.contains(t.min)&&!e.contains([t.max.x,t.min.y])&&!e.contains(t.max)&&e.contains([t.min.x,t.max.y])||!t.contains(e.min)&&t.contains([e.max.x,e.min.y])&&!t.contains(e.max)&&!t.contains([e.min.x,e.max.y])){offset=i.min.subtract(i.max).scale(n);if(Math.abs(offset.x)<Math.abs(offset.y)){offset.y=0}else{offset.x=0}}else if(e.contains(t.min)&&e.contains([t.max.x,t.min.y])&&!e.contains(t.max)&&!e.contains([t.min.x,t.max.y])||!t.contains(e.min)&&!t.contains([e.max.x,e.min.y])&&t.contains(e.max)&&t.contains([e.min.x,e.max.y])){offset=new g.Vector2(0,-(i.max.y-i.min.y)*n)}else if(!e.contains(t.min)&&!e.contains([t.max.x,t.min.y])&&e.contains(t.max)&&e.contains([t.min.x,t.max.y])||t.contains(e.min)&&t.contains([e.max.x,e.min.y])&&!t.contains(e.max)&&!t.contains([e.min.x,e.max.y])){offset=new g.Vector2(0,(i.max.y-i.min.y)*n)}else if(e.contains(t.min)&&!e.contains([t.max.x,t.min.y])&&!e.contains(t.max)&&e.contains([t.min.x,t.max.y])||!t.contains(e.min)&&t.contains([e.max.x,e.min.y])&&t.contains(e.max)&&!t.contains([e.min.x,e.max.y])){offset=new g.Vector2(-(i.max.x-i.min.x)*n,0)}else if(!e.contains(t.min)&&e.contains([t.max.x,t.min.y])&&e.contains(t.max)&&!e.contains([t.min.x,t.max.y])||t.contains(e.min)&&!t.contains([e.max.x,e.min.y])&&!t.contains(e.max)&&t.contains([e.min.x,e.max.y])){offset=new g.Vector2((i.max.x-i.min.x)*n,0)}else if(e.contains(t)||t.contains(e)){offset=new g.Vector2(0,(i.max.y-i.min.y)*n)}else{offset=new g.Vector2(0,-(i.max.y-i.min.y)*n)}return offset};var n=0,u=1,d=2,h=4,f=8;function p(e,t){var i=n;if(e.x<t.min.x){i|=u}else if(e.x>t.max.x){i|=d}if(e.y>t.max.y){i|=h}else if(e.y<t.min.y){i|=f}return i}a.prototype.clipLine=function(e,t){var i=new g.Vector2(e),n=new g.Vector2(t),r,a,s,o=p(i,this),l=p(n,this),c=false;while(true){if(!(o|l)){c=true;break}else if(o&l){break}else{s=o?o:l;if(s&f){r=i.x+(n.x-i.x)*(this.min.y-i.y)/(n.y-i.y);a=this.min.y}else if(s&h){r=i.x+(n.x-i.x)*(this.max.y-i.y)/(n.y-i.y);a=this.max.y}else if(s&d){a=i.y+(n.y-i.y)*(this.max.x-i.x)/(n.x-i.x);r=this.max.x}else if(s&u){a=i.y+(n.y-i.y)*(this.min.x-i.x)/(n.x-i.x);r=this.min.x}if(s===o){i.x=r;i.y=a;o=p(i,this)}else{n.x=r;n.y=a;l=p(n,this)}}}if(c&&i.distanceTo(n)>0){return[i,n]}return null};g.Rect=a}e();g.Rect.define=e})();(function(){"use strict";var o=giscloud.math;function e(){function n(e,t,i,n){this.bounds=t;this.center=this.bounds.center();this.maxObjects=i;this.children=[];this.objects=[];if(!e){this.level=n}else{this.parent=e;this.level=e.level-1}}n.prototype.split=function(){this.children[0]=new n(this,new o.Rect(this.center.x,this.bounds.min.y,this.bounds.max.x,this.center.y),this.maxObjects);this.children[1]=new n(this,new o.Rect(this.bounds.min.x,this.bounds.min.y,this.center.x,this.center.y),this.maxObjects);this.children[2]=new n(this,new o.Rect(this.bounds.min.x,this.center.y,this.center.x,this.bounds.max.y),this.maxObjects);this.children[3]=new n(this,new o.Rect(this.center.x,this.center.y,this.bounds.max.x,this.bounds.max.y),this.maxObjects)};function r(e,i){return e.children.reduce(function(e,t){if(!e&&t.bounds.contains(i)){return t}return e},null)}n.prototype.insert=function(e){var t;if(this.children.length){t=r(this,e.bounds);if(t){t.insert(e);return}}this.objects.push(e);if(this.objects.length>this.maxObjects&&this.level){if(!this.children.length){this.split()}this.objects=this.objects.filter(function(e){t=r(this,e.bounds);if(t){t.insert(e);return false}return true}.bind(this))}};n.prototype.remove=function(e){var t,i=[];for(t=0;t<this.children.length;++t){i=this.children[t].remove(e)}for(t=0;t<this.objects.length;++t){if(e(this.objects[t])){i.push(this.objects[t]);this.objects=this.objects.slice(0,t).concat(this.objects.slice(t+1))}}if(this.children.every(function(e){return!e.children.length})){if(this.children.reduce(function(e,t){return e+t.objects.length},this.objects.length)<=this.maxObjects){this.objects=this.objects.concat(this.children.reduce(function(e,t){return e.concat(t.objects)},[]));this.children=[]}}return i};n.prototype.test=function(t){var e,i;e=r(this,t);i=this.objects;if(this.children.length){if(e){i=i.concat(e.test(t))}else{this.children.forEach(function(e){i=i.concat(e.test(t))})}}return i};function e(e,t,i){if(!this){throw new Error("[giscloud.math.QuadTree] is a constructor and must be invoked with `new`")}this.bounds=new o.Rect(e);this.maxDepth=t||8;this.maxObjects=i||8;this.top=new n(null,this.bounds,this.maxObjects,this.maxDepth)}e.prototype.test=function(e){return this.top.test(e)};e.prototype.insert=function(e,t){if(!e||!t){throw new Error("[giscloud.math.QuadTree#insert] must have `bounds` and `object` arguments present")}this.top.insert({obj:t,bounds:e})};e.prototype.remove=function(e){this.top.remove(e)};function a(e,t){var i,n=[];for(i=0;i<e.objects.length;++i){n.push(t(e.objects[i]))}for(i=0;i<e.children.length;++i){Array.prototype.concat.apply(n,a(e.children[i],t))}return n}e.prototype.walk=function(e){return a(this.top,e)};function s(e,t){var i,n,r,a;t.strokeStyle="rgba(128, 255, 128, 1.0)";e.objects.forEach(function(e){i=e.bounds.min.x;n=e.bounds.min.y;r=e.bounds.max.x-i;a=e.bounds.max.y-n;t.strokeRect(i,n,r,a)});i=e.bounds.min.x;n=e.bounds.min.y;r=e.bounds.max.x-i;a=e.bounds.max.y-n;t.strokeStyle="rgba(0, 0, 0, 0.5)";t.strokeRect(i,n,r,a);e.children.forEach(function(e){s(e,t)})}e.prototype.draw=function(e){s(this.top,e)};e.prototype.clear=function(){this.top=new n(null,this.bounds,this.maxObjects,this.maxDepth)};o.QuadTree=e}e();o.QuadTree.define=e})();(function(){"use strict";var s=giscloud.math;function e(){function e(e,t){this.width=e;this.height=t;this.grid=new Array(e*t);this.stored=0}e.prototype.insert=function(e,t){var i=new s.Vector2(e),n,r,a;i.x=Math.floor(i.x);i.y=Math.floor(i.y);if(i.x%2){n=i.add(.5,.75).distanceToSquared(e)}else{n=i.add(.5,.25).distanceToSquared(e)}if(i.x>=this.width||i.y>=this.height||i.x<0||i.y<0){return null}i=this.width*i.y+i.x;if(!this.grid[i]){this.grid[i]={score:n,object:t};this.stored++;return null}else{if(this.grid[i].object.score()<t.score()||t.score()===this.grid[i].object.score()&&(this.grid[i].score&&this.grid[i].score>n)){a=this.grid[i];this.grid[i]={score:n,object:t};return a}}return null};e.prototype.walk=function(e){var t,i,n=[];for(t=0;t<this.grid.length;++t){i=this.grid[t];if(i!==undefined){n.push(e(i.object,i.score))}}return n};e.prototype.remove=function(e){var t,i;for(t=0;t<this.grid.length;++t){i=this.grid[t];if(i!==undefined&&e(i.object)){this.grid[t]=undefined;this.stored--}}};e.prototype.clear=function(){this.grid=new Array(this.width*this.height)};e.prototype.full=function(e){return Math.min(Math.max(e,0),1)*this.width*this.height<this.stored};s.Grid=e}e();s.Grid.define=e})();(function(){"use strict";function d(e,t,i){return Math.min(Math.max(e,t),i)}function e(e,t,i){return e>=t&&e<=i}function t(e,t){var i=e.length/2,n=false,r,a;for(r=0,a=i-1;r<i;a=r++){if(e[r*2+1]>=t.y!==e[a*2+1]>=t.y&&t.x<=(e[a*2]-e[r*2])*(t.y-e[r*2+1])/(e[a*2+1]-e[r*2+1])+e[r*2]){n=!n}}return n}function f(e,t,i){var n,r,a,s;a=[t[0]-e[0],t[1]-e[1]];s=[i[0]-e[0],i[1]-e[1]];r=a[0]*a[0]+a[1]*a[1];n=a[0]*s[0]+a[1]*s[1];return n>0&&n<r}function n(e,t,i){var n,r,a,s,o,l,c,u,d,h;r=t.x;a=t.y;for(n=0;n<(e.length>>1)-1;n++){s=e[(n+0<<1)+0];o=e[(n+0<<1)+1];l=e[(n+1<<1)+0];c=e[(n+1<<1)+1];if(f([s,o],[l,c],[r,a])){u=l-s;d=c-o;h=Math.abs(d*r-u*a+l*o-c*s)/Math.sqrt(d*d+u*u);if(h<i){return true}}}return false}function r(e,t,i){var n,r,a=0,s=e.length-2,o={x:null,y:null,area:null},l={x:d(t.x+e[0],i.xmin,i.xmax),y:d(t.y+e[1],i.ymin,i.ymax)},c={x:null,y:null},u={x:null,y:null};for(n=2;n<s;n+=2){c.x=d(t.x+e[n],i.xmin,i.xmax);c.y=d(t.y+e[n+1],i.ymin,i.ymax);u.x=d(t.x+e[n+2],i.xmin,i.xmax);u.y=d(t.y+e[n+3],i.ymin,i.ymax);r=(c.x-l.x)*(u.y-l.y)-(u.x-l.x)*(c.y-l.y);o.x+=r*(l.x+c.x+u.x);o.x+=r*(l.y+c.y+u.y);a+=r}o.area=a;return o}function a(e,t){var i,n,r=0,a=e.length-2,s={x:null,y:null,area:null},o={x:t.x+e[0],y:t.y+e[1]},l={x:null,y:null},c={x:null,y:null};for(i=2;i<a;i+=2){l.x=t.x+e[i];l.y=t.y+e[i+1];c.x=t.x+e[i+2];c.y=t.y+e[i+3];n=(l.x-o.x)*(c.y-o.y)-(c.x-o.x)*(l.y-o.y);s.x+=n*(o.x+l.x+c.x);s.x+=n*(o.y+l.y+c.y);r+=n}s.area=r;return s}function s(e,t,i){t=t||{x:0,y:0};return i?r(e,t,i):a(e,t)}function o(e,t){var n=0,r=0,a=0,s,o;for(i=0;i<e.length;++i){s=e[j].p[0].b;o=e[j].p[0];if(!s.c||s.xmin<t.xmin||s.xmax>t.xmax||s.ymin<t.ymin||s.ymax>t.ymax){s.c=findCG(o.p,o.cx,o.cy,t)}n+=s.c[0];r+=s.c[1];a+=b.c[2]}n/=3*a;r/=3*a;return{x:n,y:r}}function l(e){var t=0,i,n,r={x:0,y:0},a,s,o=e.length,l=o-1;for(n=0;n<o;n++){a=e[l];s=e[n];i=a.x*s.y-s.x*a.y;r.x+=(a.x+s.x)*i;r.y+=(a.y+s.y)*i;t+=i;l=n}r.x/=t*3;r.y/=t*3;return{area:Math.abs(t/2),centroid:r}}giscloud.math.util={clamp:d,between:e,calculatePolygonAreaAndCentroid:l,isPointInsidePolygon:t,isPointTouchingPath:n,findCentroidOfPolygon:o,findCenterOfGravity:s}})()})();(function(){"use strict";if(!giscloud){giscloud={util:{}}}else if(!giscloud.util){giscloud.util={}}(function(){"use strict";var t=false,n={},r=[];function e(e,t,i){if(i){r.push({timeRemaining:i,key:e})}window.localStorage.setItem(e,JSON.stringify(t))}function i(e,t){var i;i=window.localStorage.getItem(e);if(i===undefined){return t}return JSON.parse(i)}function a(t){r.filter(function(e){return e.key!==t});window.localStorage.removeItem(t)}function s(){r=[];window.localStorage.clear()}function o(e,t,i){if(i){r.push({timeRemaining:i,key:e})}n[e]=t}function l(e,t){var i;i=n[e];if(i===undefined){return t}return i}function c(t){r.filter(function(e){return e.key!==t});if(n[t]){delete n[t]}}function u(){r=[];n={}}giscloud.util.storage={};try{t=!window.localStorage}catch(e){t=true}if(t){giscloud.util.storage.store=o;giscloud.util.storage.fetch=l;giscloud.util.storage.clear=c;giscloud.util.storage.drop=u}else{giscloud.util.storage.store=e;giscloud.util.storage.fetch=i;giscloud.util.storage.clear=a;giscloud.util.storage.drop=s}window.setInterval(function(){var e;for(e=0;e<r.length;++e){r[e].timeRemaining--;if(r[e].timeRemaining<0){giscloud.util.storage.clear(r[e].key)}}r=r.filter(function(e){return!(e.timeRemaining<0)})},1e3)})();(function(){var e=giscloud.util;function t(){function i(t){if(typeof t==="function"||typeof t==="boolean"||typeof t==="number"){return t.toString()}if(typeof t==="string"){return'"'+t+'"'}if(t instanceof Date){return'"'+t.toISOString()+'"'}if(Array.isArray(t)){return"["+t.map(function(e){return i(e)}).join(",")+"]"}return"{"+Object.keys(t).map(function(e){return t.hasOwnProperty(e)?e+":"+i(t[e]):""})+"}"}e.encode={string:{marshal:i}}}t();e.encode.define=t})();(function(a){"use strict";var s={};function e(e,t){if(typeof e!=="string"){throw new TypeError("[giscloud.util.mediator.makeChannel] `channel` argument must be of type `string`")}if(t!==undefined){if(typeof t!=="boolean"){throw new TypeError("[giscloud.util.mediator.makeChannel] `hasHistory` argument must be of type `boolean` if present")}}if(!s[e]){s[e]=[];if(t){s[e].hasHistory=t;s[e].history=[]}}else{console.warn("[gislcoud.mediator.makeChannel] chanel with name '"+e+"' already exists")}}function r(e){if(typeof e!=="string"){throw new TypeError("[giscloud.util.mediator.deleteChannel] `channel` argument must be of type `string`")}var t=s[e],i;if(t){if(t.hasHistory){for(i=0;i<t.length;++i){delete t[i].lastMessageIndex}}delete s[e]}}function t(e,t){if(typeof e!=="string"){throw new TypeError("[giscloud.util.mediator.subscribe] `channel` argument must be of type `string`")}if(typeof t!=="function"){throw new TypeError("[giscloud.util.mediator.subscribe] `handler` argument must be of type `function`")}var i=s[e],n;if(!i){s[e]=[t]}else{for(n=0;n<i.length;++n){if(i[n]===t){console.warn("[giscloud.util.mediator.subscribe] trying to subscribe to a channel '"+e+"' with a handler that is already registered");return}}i.push(t);if(i.hasHistory){if(!t.lastMessageIndex){t.lastMessageIndex=0}for(n=t.lastMessageIndex;n<i.history.length;++n){t.apply(null,i.history[n]);++t.lastMessageIndex}}}}function i(e){if(typeof e!=="string"){throw new TypeError("[giscloud.util.mediator.publish] `channel` argument must be of type `string`")}var t=s[e],i=arguments.length,n=new Array(i),r;if(t){if(a.debug){console.debug("[giscloud.util.mediator.publish] publishing to channel '"+e+"'")}for(r=1;r<i;++r){n[r-1]=arguments[r]}if(t.hasHistory){t.history.push(n)}for(r=0;r<t.length;++r){t[r].apply(null,n);if(t.hasHistory){++t[r].lastMessageIndex}}}else if(a.debug){console.debug("[giscloud.util.mediator.publish] publishing to channel '"+e+"' with no handlers")}}function n(e,t){if(typeof e!=="string"){throw new TypeError("[giscloud.util.mediator.subscribe] `channel` argument must be of type `string`")}if(typeof t!=="function"){throw new TypeError("[giscloud.util.mediator.subscribe] `handler` argument must be of type `function`")}var i,n;n=s[e];if(n){for(i=0;i<n.length;++i){if(n[i]===t){n.splice(i,1);break}}}if(!n.length){r(e)}}giscloud.util.mediator={};giscloud.util.mediator.makeChannel=e;giscloud.util.mediator.deleteChannel=r;giscloud.util.mediator.publish=i;giscloud.util.mediator.subscribe=t;giscloud.util.mediator.unsubscribe=n})({debug:false});(function(){"use strict";var a=giscloud.exposeJQuery(),s;function e(){self.onmessage=function(e){self.postMessage(self.op(e.data))}}s=e.toString();function t(e){this.data=e;this.globals=[];this.scope={}}t.prototype.run=function(e){var t,i,n,r=new a.Deferred;t=["("+s+")();\n\n","op = "+e.toString()+";\n\n"].concat(this.globals.map(function(e){return e+";\n\n"}.bind(this)),Object.keys(this.scope).map(function(e){return e+" = "+this.scope[e]+";\n\n"}.bind(this)));i=new window.Blob(t);n=window.URL.createObjectURL(i);this.job=new window.Worker(n);window.URL.revokeObjectURL(n);this.job.onmessage=function(e){this.terminate();r.resolve(e.data)};this.job.onerror=function(e){r.reject(e.data);this.terminate()};this.job.postMessage(this.data);this.deferred=r;return this.deferred.promise()};t.prototype.terminate=function(){this.job.terminate();this.deferred.reject("Job terminated")};t.prototype.require=function(t,e){var i,n,r;if(typeof t==="function"){i=t.toString();n=i.match("");if(!n||e){this.globals.push("("+i+")()")}else{this.globals.push(i)}}else{Object.keys(t).forEach(function(e){if(this.scope[e]){throw new Error("[giscloud.util.ThreadPool#require] Scope value `"+e+"` already defined")}else{this.scope[e]=giscloud.util.encode.string.marshal(t[e])}}.bind(this))}return this};giscloud.util.Job=t})();(function(){var a=0,r=giscloud.exposeJQuery(),s,o=giscloud.util;function e(){o.onerror=function(e){o.postMessage({status:"ERROR",message:"Ane error occured",error:e.toString()})};o.onmessage=function(e){var t=e.data.data,i,n;try{i=o.eval("op = "+e.data.op)}catch(e){i=null;o.postMessage({status:"ERROR",message:"Unable to deserialize operation function",error:e.toString()});return}try{t=i(t)}catch(e){t=null;o.postMessage({status:"ERROR",message:"Error while processing data",error:e.toString()});return}n={status:"OK",data:t};o.postMessage(n)}}s=e.toString();function t(e){if(!this){throw new Error("[giscloud.util.ThreadPool] is a constructor and must be invoked with `new`")}this.size=e||8;this.scope={};this.globals=[];this.usedPool=[];this.freePool=[];this.queue=[]}t.prototype.require=function(t,e){var i,n,r;if(typeof t==="function"){i=t.toString();n=i.match("");if(!n||e){this.globals.push("("+i+")()")}else{this.globals.push(i)}}else{Object.keys(t).forEach(function(e){if(this.scope[e]){throw new Error("[giscloud.util.ThreadPool#require] Scope value `"+e+"` already defined")}else{this.scope[e]=o.encode.string.marshal(t[e])}}.bind(this))}return this};function l(t){var i,e;i=this.freePool.pop();i.onmessage=function(e){i.onmessage=undefined;this.usedPool=this.usedPool.filter(function(e){return e.id!==i.id});this.freePool.push(i);if(e.data.status==="ERROR"){t.deferred.reject({message:e.data.message,error:e.data.error})}else{t.deferred.resolve(e.data.data)}if(this.queue.length){l.call(this,this.queue.pop())}}.bind(this);this.usedPool.push(i);e={data:t.data,op:t.op};i.postMessage(e)}t.prototype.enqueue=function(e,t){var i=new r.Deferred,n={data:e,op:t.toString(),deferred:i};this.queue.push(n);while(this.freePool.length&&this.queue.length){n=this.queue.pop();l.call(this,n)}return i.promise()};t.prototype.terminate=function(){this.usedPool.forEach(function(e){e.terminate()});this.freePool.forEach(function(e){e.terminate()});this.usedPool=[];this.freePool=[]};t.prototype.start=function(){var e,t,i,n,r;n=["("+s+")();\n\n"].concat(this.globals.map(function(e){return e+";\n\n"}.bind(this)),Object.keys(this.scope).map(function(e){return e+" = "+this.scope[e]+";\n\n"}.bind(this)));t=new window.Blob(n);i=window.URL.createObjectURL(t);for(e=0;e<this.size;++e){r=new window.Worker(i);r.id=a++;this.freePool.push(r)}while(this.freePool.length&&this.queue.length){l.call(this,this.queue.pop())}window.URL.revokeObjectURL(i)};giscloud.util.ThreadPool=t})()})();function _init(e,t){if(e.map){t.gmap=1;t.tileSize=new google.maps.Size(256,256)}t.modifier={};t.hoverStyle={fill:"rgba(255,0,0,0.8)",stroke:"rgba(255,0,0,0.8)"};t.mid=e.mid;t.timestamp=e.timestamp;t.lid=e.id;t.lid_map={};t.lid_map[e.id]=1;t.lmap=e.lmap;fields="";t.map=e.map;if(e.tooltip){t.tooltip=document.createElement("div");t.tooltip.style.position="absolute";t.tooltip.style.top="-5px";t.tooltip.style.left="-5px";t.tooltip.className="gc-map-tooltip";t.tooltip.style.padding="1px";t.tooltip.style.border="1px solid #CCC";t.tooltip.style.backgroundColor="#FAF3A9";t.tooltip.style.zIndex=1e3;document.body.appendChild(t.tooltip);giscloud.Html5MapTooltip=t.tooltip}_selectablePoly=0;$(document).mousedown(function(e){isMouseDown=true});$(document).mouseup(function(e){isMouseDown=false});getTimestamp(t,e)}function checkForEvent(e,t,i){if(!t&&isMouseDown)return;var n=e.currentTile;var r,a;if(e.offsetX>=0){r=e.offsetX;a=e.offsetY}else{r=e.layerX;a=e.layerY}r*=flashnavigator.scaleRatio;a*=flashnavigator.scaleRatio;if(flashnavigator.offscreenRendering){workerCheckEvents(n,r,a,e,i);return}if(!n.gc_state.by_layer[n.gc_state.layer])return;return handleEvent(n,r,a,e,i)}var hoverModifier={};function handleEvent(e,t,i,n,r){var a=e.gc_state.by_layer[e.gc_state.layer];if(!a.type=="text"){return false}var s=0;var o=e.gc_state.layer;var l=e.gc_state.curLayerObj;s=a.features;if(!s){return false}if(selectionEnabled){var c=r?r:a.type!=="point"?4*flashnavigator.scaleRatio:0;var u=t+c;var d=t-c;var h=i-c;var f=i+c;var p=1e5;var g=-1;var m=null;var v=null;var y;var _;var b=e.gc_state.obj;for(_=s.length-1;_>=0;_--){if(s[_].visible&&u>=s[_].b.xmin&&d<=s[_].b.xmax&&f>=s[_].b.ymin&&h<=s[_].b.ymax&&(s[_].ispoint||s[_].ispoly&&!s[_].ispoint&&giscloud.math.util.isPointInsidePolygon(s[_].p,{x:t,y:i})||!s[_].ispoly&&!s[_].ispoint&&giscloud.math.util.isPointTouchingPath(s[_].p,{x:t,y:i},c))){if(s[_].ispoint){var w=pointDistance(s[_].x,s[_].y,t,i);if(w<p){g=_;p=w}}else{if(v!==s[_].s){m=null}y=s[_].c;if(s[_].curs&&s[_].curs.type==="line"){if(m)break}else{if(y==m){g=-1;m=null;continue}else{if(m)break}}g=_;m=y;v=s[_].s}}}if(g>=0){var x=null;var C=g;x=s[g];var T=s[C];if(flashnavigator.hasCanvas){if(hoverModifier.isset){if(b._hoveredElement===T.c&&o===hoverModifier.layer){if(e.gc_state.fields&&e.gc_state.fields[x.c])x.attributes=e.gc_state.fields[x.c];return x}clearHover()}if(!b.modifier[T.c]){var k=0;if(T.ispoint)k=T.i;else k=T.s;if(l.features){hoverModifier.isset=true;hoverModifier.color=l.features[k].highlightcolor;hoverModifier.hover=true;hoverModifier.orig=b.modifier[T.c];hoverModifier.orig_obj=b;hoverModifier.orig_key=T.c;hoverModifier.layer=o;hoverModifier.layerObj=l;b.modifier[T.c]=hoverModifier;b._hoveredElement=T.c;drawAcrossTiles(b,true)}}else{b._hoverModifier=null}}if(e.fields&&e.fields[x.c])x.attributes=e.fields[x.c];return x}}if(flashnavigator.hasCanvas&&hoverModifier.isset&&e.gc_state.layer===hoverModifier.layer){clearHover()}return false}var tile_cache={tiles:{}};function initTileCache(){tile_cache.max=common.isMobileBrowser?0:Math.round(800/Math.pow(flashnavigator.scaleRatio,2));resetTileCache()}function resetTileCache(){for(var e in tile_cache.tiles){tile_cache.tiles[e].inCache=false;releaseCanvasToPool(tile_cache.tiles[e])}tile_cache.tiles={};tile_cache.count=0;tile_cache.min=Infinity;tile_cache.min_index=null}function removeTileFromCache(e,t){var i=e.gc_state,n,r=false,a,s;if(tile_cache.max===0)return;if(t){a={};a[t]=1}else{a=i.by_layer}for(s in a){n=e.gc_state._tileIndex+":"+s;if(tile_cache.tiles[n]){tile_cache.tiles[n].inCache=false;releaseCanvasToPool(tile_cache.tiles[n]);delete tile_cache.tiles[n];tile_cache.count--;if(tile_cache.min_index===n){r=true}}}if(r){calculateCanvasCacheMin()}}function setupTile(e,t){if(!e.dyndata)return;var i=e.gc_state.curLayerObj;var n=t.geom;var r=0;var a;var s;var o=null;var l=0;if(t.tile){o=t.tile.l;l=o.length-1}var c=0;var u;for(var d=0,h=n.length;d<h;d++){var r=n[d].c.split("_")[1];if(e.dyndata[r])n[d].dyn=e.dyndata[r]}for(var d=0;d<l;d+=5){if(o[d]<0){u=-o[d];c=o[d+1];d++}else{u=o[d]}var f=o[d+1];var p=o[d+2];var g=o[d+3];var m=o[d+4];var v={p:[f,p,f+g,p+m],id:u,s:c,c:i.id+"_"+u,px:true};if(e.dyndata[v.id]>=0)v.dyn=e.dyndata[v.id];n.push(v)}t.geom.sort(function(e,t){return t.dyn-e.dyn});e.pixels2=null;if(t.tile)t.tile.pixels=null}function drawTile(e,t,i,n,r){var a=e.gc_state;a.layer=a.layer||a.obj.parent.id;a.curLayerObj=i;a.by_layer[a.layer]=a.by_layer[a.layer]||{};current_layer_tile_state=a.by_layer[a.layer];if(loader_id===a._loader_id||r){if(flashnavigator.hasCanvas&&!n){var s=e.getContext("2d",flashnavigator.canvasOptions);if(a._drawn){s.clearRect(0,0,e.width,e.height)}}a._drawn=true;if(a.curLayerObj.options.dynamic&&t[1]){e.dyndata=t[1];t=t[0]}if(flashnavigator.newLabelingMode){giscloud.util.mediator.publish("tile/loaded",e,t,i,renderLabelTile)}if(i.layer_info.hiddenGeometry){return}if(t.tile){if(t.tile.type=="text"){current_layer_tile_state.features=t.tile.data;a.fields=t.fields;var o={},l=current_layer_tile_state.features.length,c=current_layer_tile_state.features,u,d,h;for(u=0;u<l;u++){c[u].text=c[u].text.split("\n");for(d=0,h=c[u].p.length;d<h;d++){o[c[u].p[d][4]]=1}}current_layer_tile_state.feature_ids=o;var f=a.gc_layer.neighbour_tile_data;if(f[a._tileIndex]){var p=f[a._tileIndex][a.layer];if(p){p.forEach(function(e){if(e.item.id!==undefined&&o[e.item.id])return;current_layer_tile_state.features.push(e.item);if(e.field){if(!a.fields)a.fields={};a.fields[e.field.key]=e.field.value}});delete f[a._tileIndex][a.layer];if(Object.keys(f[a._tileIndex]).length==0){delete f[a._tileIndex]}}}drawText(e,n);t.geom=null}else if(t.tile.type=="point"){var g=t.tile.data;current_layer_tile_state.features=g;a.fields=t.fields;parsePoint(e,current_layer_tile_state,t);var f=a.gc_layer.neighbour_tile_data;if(f[a._tileIndex]){var p=f[a._tileIndex][a.layer];if(p){var m=current_layer_tile_state.features_by_id;p.forEach(function(e){if(m[e.c]){var t=false;var i=m[e.c];for(var n=0;n<i.length;n++){var r=g[i[n]];if(r.i==e.i&&r.x==e.x&&r.y==e.y){t=true;break}}if(t)return}if(!m[e.c])m[e.c]=[];m[e.c].push(g.length);g.push(e)});delete f[a._tileIndex][a.layer];if(Object.keys(f[a._tileIndex]).length==0){delete f[a._tileIndex]}}}g.sort(function(e,t){if(e.i<t.i)return 1;if(e.i>t.i)return-1;return e.fid>t.fid?1:-1});var m={};for(var u=0;u<g.length;u++){if(!m[g[u].c]){m[g[u].c]=[]}m[g[u].c].push(u)}current_layer_tile_state.features_by_id=m;drawPoint(e,n);t.geom=null}}if(t.geom){setupTile(e,t);drawGeom(e,t,n)}}t.tile=null;t.fields=null;t=null}function redrawSingleTileRect(e,t){rectCropWithTile(t,e.gc_state);if(t.width>0&&t.height>0){if(flashnavigator.inOffscreenRenderingWorker){e=setTileData(e,t)}redrawSingleTile(e.gc_state.obj.parent,e,t,true);if(flashnavigator.inOffscreenRenderingWorker){releaseCanvasToPool(e)}}}function redrawNeighbourTiles(e){var t,i,n,r=e.gc_state;for(t in r._tiles_to_redraw){i=r._tiles_to_redraw[t];n=i.gc_state._invalidateRectForCopy;i.gc_state._invalidateRectForCopy=null;redrawSingleTileRect(i,n)}r._tiles_to_redraw={}}function checkIfModifierInTile(e,t){if(!e.gc_state.by_layer[e.gc_state.layer])return;var a=e.gc_state;var i=a.by_layer[a.layer];var s=a.obj;var n=i.features_by_id;var o=a.curLayerObj.features;var l=i.features;var c=false;var u,d;for(u in s.modifier){if(!s.modifier[u]||!n||!n[u]||n[u].length==0)continue;n[u].forEach(function(e){var t=l[e];if(!t||!t.b)return;d=0;if(!t.ispoint){var i=overrideStyle(o[t.s],s.modifier[u]);d=0;if(giscloud.mapFeatureRenderer!=null&&giscloud.mapFeatureRendererHighlight){var n={};for(var r in i)n[r]=i[r];i=n;giscloud.mapFeatureRendererHighlight(t,i)}i.linewidth&&(d=i.linewidth);i.width&&(d+=i.width);d=Math.ceil(d)}if(!a._invalidateRect){a._invalidateRect={};rectAssign(a._invalidateRect,t.b,d)}else{rectUnion(a._invalidateRect,t.b,d)}c=true})}if(a._invalidateRect){if(a._rect)rectCropWithRect(a._invalidateRect,a._rect);else rectCropWithTile(a._invalidateRect,a)}return c}function checkIfImageCanBeDraw(e,t){var i=t.gc_state,n=e.tileLayer.group,r;for(r=n.length-1;r>=0;r--){if(n[r]===e)return true;if(n[r].visible&&n[r].isImage&&(!i.by_layer[n[r].id]||!i.by_layer[n[r].id].image)){return false}}return true}function redrawSingleTile(e,t,i,n){var r,a,s,o=!t.getContext,l,c;a=t.gc_state;s=a.layer;c=a.curLayerObj;if(!o&&!i&&!flashnavigator.inOffscreenRenderingWorker){r=t.getContext("2d",flashnavigator.canvasOptions);r.clearRect(0,0,t.width,t.height)}if(o){l=t;t=getCanvasFromPool(a._width,a._height);t.gc_state=a;t._layer=l._layer;t.isTileDirty=l.isTileDirty}a._entire_tile_draw=!i;a._rect=i?i:rectCreate(t.gc_state);a._isRedraw=n;a._invalidateRect=null;if(e.group){if(!a.obj.activeLayer||a.activeLayerId!=a.obj.activeLayer.uniqueId||!a.canvasCachePre||!a.canvasCachePost){if(a.obj.activeLayer){a.activeLayerId=a.obj.activeLayer.uniqueId}else{a.activeLayerId=null}e.group.forEach(function(e){if(e.visible&&!e.isImage){a.layer=e.id;a.curLayerObj=e;checkIfModifierInTile(t)}});e.group.forEach(function(e){if(e.visible){a.layer=e.id;a.curLayerObj=e;redrawTile(t)}})}}else{redrawTile(t)}renderTile(t);if(o){releaseCanvasToPool(t)}a.layer=s;a.curLayerObj=c;a._isRedraw=false;a._rect=null;return false}function redraw(i,e,n,r){var t,a,s,o;if(!flashnavigator.inOffscreenRenderingWorker){if(checkAttributesAndReload(i)){return}}if(flashnavigator.offscreenRendering){if(n){workerSyncLayers()}workerRedrawLayer(i,n,r);return}if(flashnavigator.inOffscreenRenderingWorker){a={};s=i._tiles;for(var l in s){if(r&&!r[l])continue;a[l]=setTileData(s[l],null)}}else{a=i._tiles}o=Object.keys(a);if(e){o.forEach(function(e){if(r&&!r[e])return;var t=a[e];count++;window.setTimeout(function(){count--;t.isTileDirty=n;redrawSingleTile(i,t,null,true);t.isTileDirty=false},0)})}else{o.forEach(function(e){if(r&&!r[e])return;t=a[e];t.isTileDirty=n;redrawSingleTile(i,t,null,true);t.isTileDirty=false})}if(flashnavigator.inOffscreenRenderingWorker){workerRenderTiles(i);for(var l in a){if(r&&!r[l])continue;releaseCanvasToPool(a[l])}}else{if(i.viewer.onRender){i.viewer.onRender()}}}function redrawTile(e){var t=e.gc_state;if(!t._drawn||!t.by_layer[t.layer])return;var i=t.by_layer[t.layer];var n=i.type;if(i.pixelsData&&t.curLayerObj.featuresVisibility!==i.pixelsVisibility){drawPixels(t,i,i.pixelsData)}if(n=="image"){drawImageInternal(e)}else if(n=="text"){drawText(e)}else if(n=="point"){drawPoint(e)}else{drawGeomInternal(e)}}function drawAcrossTiles(e,t){var i,n,r;var a=e.parent._tiles;if(e.parent.group){e.activeLayer=hoverModifier.isset?hoverModifier.layerObj:null;for(i in a){n=a[i];if(!n.gc_state)continue;if(t){clearTile(n)}r=n.gc_state;r._invalidateRect=null;if(r.obj.modifier&&Object.keys(r.obj.modifier).length>=0){var s=0;e.parent.group.forEach(function(e){if(e.visible){r.layer=e.id;r.curLayerObj=e;if(checkIfModifierInTile(n))s=1}});rect=n.gc_state._invalidateRect;if(s){redrawSingleTileRect(n,rect)}}}if(flashnavigator.inOffscreenRenderingWorker){workerRenderTiles(e.parent)}return true}for(i in a){n=a[i];if(!n.gc_state)continue;t&&clearTile(n);n.gc_state._invalidateRect=null;if(checkIfModifierInTile(n)){redrawSingleTileRect(n,n.gc_state._invalidateRect)}}if(flashnavigator.inOffscreenRenderingWorker){workerRenderTiles(e.parent)}return false}function clearTile(e){var t=e.gc_state;if(t._modified&&t._originalCanvasParts){restoreOriginalParts(t._originalCanvasParts,e);t._originalCanvasParts=null;t._modified=false}if(t._modified&&e.img&&t.by_layer[t.layer].type!="point"){if(e.img.src!=e.img_url)e.img.src=e.img_url;t._modified=false}}function drawTileUsingModifier(s,o){if(!s.gc_state.by_layer[s.gc_state.layer])return;var l,c,e,t,u,d,h,f;l=null;u=giscloud.mapFeatureRenderer!=null;var p=s.gc_state;var i=p.by_layer[p.layer].features_by_id;var n=null;var g=p._rect;p._path=null;if(!p._invalidateRect){checkIfModifierInTile(s);if(g&&p._invalidateRect){rectCropWithRect(p._invalidateRect,g)}}if(!p._invalidateRect||(p._invalidateRect.width<=0||p._invalidateRect.height<=0)){p._invalidateRect=null;return}for(c in o.modifier){if(!o.modifier[c]||!i||!i[c]||i[c].length==0)continue;t=i[c];d=c.split("_")[0];if(!p.by_layer[d])continue;f=p.curLayerObj.features;if(!l){rectCropWithRect(p._invalidateRect,g);p.current_canvas_state.overlay=createCanvas(s,false,p._invalidateRect);l=p.forceCtx||s.getContext("2d",flashnavigator.canvasOptions)}h=null;t.forEach(function(e){var t=p.by_layer[d].features[e];if(t&&t.b){if(g&&t.b&&(g.xmax<t.b.xmin||g.ymax<t.b.ymin||g.xmin>t.b.xmax||g.ymin>t.b.ymax)){return}p._modified=true;var i=0;if(t.ispoint)drawImage(s,o,l,t,null,null,o.modifier[c]);else{if(h!=t.c){finishPoly(s.gc_state,l);h=t.c}var n=overrideStyle(f[t.s],o.modifier[c]);i=0;if(u&&giscloud.mapFeatureRendererHighlight){var r={};for(var a in n)r[a]=n[a];n=r;giscloud.mapFeatureRendererHighlight(t,n)}n.linewidth&&(i=n.linewidth);n.width&&(i+=n.width);i=Math.ceil(i);drawCanvasPolygon(p,l,t.p,n,t.s,c,null,1,u)}}})}if(l){finishPoly(p,l)}}function clearHover(){var e=hoverModifier.orig_obj;if(e.modifier[hoverModifier.orig_key]&&e.modifier[hoverModifier.orig_key].hover){if(hoverModifier.orig){e.modifier[hoverModifier.orig_key]=hoverModifier.orig}else{delete e.modifier[hoverModifier.orig_key]}drawAcrossTiles(e,true)}hoverModifier.isset=false}function setupFiltersObject(e,t){if(!t.data){t.data={}}if(e.gc_state.feature_attributes_array){var i,n=e.gc_state.feature_attributes_array;for(i=0;i<n.length;i++){if(t.data[n[i]]===undefined){t.data[n[i]]=null}}}}function modifyObject(e,t,i,n,r,a,s){n=n?(n+"").split("||")[0]:"";if(n&&!e.lid_map[n])return;t=t?t+"":"";if(r&&!e.has_modifier&&!t)return;var o=null,l=null,c=false,u=intColor2hexColor(i.color),d,h;if(e.parent.group){h=t+u+n+r+a+s;if(this.modify_sign==h)return;e.modify_sign=h}if(r){o=e.modifier;l=e.modifier_layers;c=e.has_modifier;e.modifier={};e.has_modifier=false}if(e._hoveredElement){o=true;if(e.modifier[e._hoveredElement]){delete e.modifier[e._hoveredElement]}e._hoveredElement=null}e.modifier_layers={};if(t){t=t.split(",");i={color:u,linewidth:1};for(d=0;d<t.length;d++){if(t[d]==="")continue;e.modifier[n+"_"+t[d]]=i;e.modifier_layers[n]=1;e.has_modifier=true}}if(!e.parent.group){if(l){for(n in l){drawAcrossTiles(e,o,n)}}for(n in e.modifier_layers){drawAcrossTiles(e,o,n)}}else if(c||e.has_modifier){e.activeLayer=null;drawAcrossTiles(e,o)}o=null}function overrideStyle(e,t){var i={};if(t.color){var n;if(t.color==="selectcolor"){n=e.selectcolor}else{n=t.color}i.color=n;if(e.strokecolor){if(e.type!="polygon")i.strokecolor=n;else i.strokecolor=e.strokecolor}if(e.fillcolor)i.fillcolor=n}else{if(e.strokecolor&&t.strokecolor){i.strokecolor=t.strokecolor}else{i.strokecolor=e.strokecolor}if(e.fillcolor&&t.fillcolor){i.fillcolor=t.fillcolor}else{i.fillcolor=e.fillcolor}i.innerlinewidth=e.innerlinewidth}if(t.dashed)i.dashed=t.dashed;else i.dashed=e.dashed;i.linewidth=e.linewidth;i.type=e.type;i.visible=e.visible;return i}function drawGeom(e,t,i){var n=t.geom;var r=e.gc_state;var a=r.by_layer[r.layer];a.features=n;if(!a.features_by_id)a.features_by_id=[];a.type="geom";r.fields=t.fields;var s=a.features_by_id;var o=r.obj;var l=n.length;var c=-1;var u=null;var d,h;var f,p,g,m;var v=0;var y=0;var _=r.curLayerObj.features;var b=null;var w=0;if(r.curLayerObj.options.offset)v=r.curLayerObj.options.offset;if(r.curLayerObj.options.precision)y=r.curLayerObj.options.precision;if(t.tile&&t.tile.pixels){b=t.tile.pixels;t.tile.pixels=null}var x=0;if(t.fields){x=1}for(f=l-1;f>=0;f--){d=n[f];if(d.s>=0){c=d.s}else{d.s=c}m={};if(!s[d.c])s[d.c]=[];s[d.c].push(f);if(c!=-1){u=_[c];w=u.linewidth>0?u.linewidth/2+1:0}if(u.type=="polygon"){d.ispoly=1}if(!d.initialized){h=d.p;g=h.length;if(y>0){for(p=0;p<g;p++){h[p]/=y}}if(flashnavigator.scaleRatio>1){for(p=0;p<g;p++){h[p]*=flashnavigator.scaleRatio}}if(v>0)doOffset(d,v);h=d.p;m={};m.xmin=m.xmax=h[0];m.ymin=m.ymax=h[1];d.fid=+d.c.split("_")[1];for(p=2;p<g;p+=2){if(h[p]<m.xmin)m.xmin=h[p];else if(h[p]>m.xmax)m.xmax=h[p];if(h[p+1]<m.ymin)m.ymin=h[p+1];else if(h[p+1]>m.ymax)m.ymax=h[p+1]}m.xmin=Math.floor(m.xmin-w);m.ymin=Math.floor(m.ymin-w);m.xmax=Math.ceil(m.xmax+w);m.ymax=Math.ceil(m.ymax+w);d.initialized=true;d.b=m;d.visible=true;if(x){d.data=r.fields[d.c];setupFiltersObject(e,d)}else{d.data={}}}}n=null;t.geom=null;t.style=null;if(b){drawPixels(r,a,b)}if(!i)drawGeomInternal(e)}function drawGeomInternal(e){var t,n,r,a,o,l,c,u,d,h;h=e.gc_state;if(!h.by_layer[h.layer])return;t=h.by_layer[h.layer].features;d=h.curLayerObj.features;u=h.by_layer[h.layer].pixels;if(!t)return;var f=null;var p=null;if(h.curLayerObj.feature_filter&&h.curLayerObj.feature_filter.filter){f=h.curLayerObj.feature_filter.filter;p=h.curLayerObj.feature_filter.context}var g=h._rect;var m=h._tileIndex+":"+h.layer;if(e.getContext||h.forceCtx){if(!f){c=getCanvasFromCache(e,m,g,!h._entire_tile_draw);if(c){if(h.obj.modifier){drawTileUsingModifier(e,h.obj,g)}return}}n=h.forceCtx||e.getContext("2d",flashnavigator.canvasOptions);if(g){c=createCanvas(e,true);n=c.getContext("2d",flashnavigator.canvasOptions)}r=t.length;var v=performance.now();if(!f&&u){if(g){n.drawImage(u,g.xmin/flashnavigator.scaleRatio,g.ymin/flashnavigator.scaleRatio,g.width/flashnavigator.scaleRatio,g.height/flashnavigator.scaleRatio,g.xmin,g.ymin,g.width,g.height)}else{n.drawImage(u,0,0,256,256,0,0,256*flashnavigator.scaleRatio,256*flashnavigator.scaleRatio)}}a=giscloud.mapFeatureRenderer!=null;for(i=r-1;i>=0;i--){object=t[i];sindex=object.s;if(sindex!=-1){s=d[sindex]}if(g&&object.b&&(g.xmax<object.b.xmin||g.ymax<object.b.ymin||g.xmin>object.b.xmax||g.ymin>object.b.ymax)){object.curs=null;continue}if(a){var y={};for(var _ in s)y[_]=s[_];s=y;l=object.c.split("_");o={featureId:l[1]*1,layerId:parseInt(l[0].replace("layer","").replace("l","")),geometry:object.p,bounds:object.b,visible:object.visible};if(object.data)o.attributes=object.data;giscloud.mapFeatureRenderer(o,s);object.visible=o.visible}object.curs=s;if(!f||f(object.data,p)){object.visible=object.curs?object.curs.visible:true;drawCanvasPolygon(h,n,object.p,object.curs,object.s,h.lastP,null,1,a)}else{object.visible=false}}finishPoly(h,n);if(h.curLayerObj.has_inner_line){for(i=r-1;i>=0;i--){object=t[i];if(object.visible&&object.curs){drawCanvasPolygon(h,n,object.p,object.curs,object.s,h.lastP,null,2,a)}}finishPoly2(h,n)}if(c&&!f&&h._entire_tile_draw){c.timeToGenerate=performance.now()-v;storeCanvasToCache(c,m)}}if(h.obj.modifier){drawTileUsingModifier(e,h.obj,g)}}function drawCanvasPolygon(e,t,i,n,r,a,s,o,l){if(n.visible===false)return;var c,u;if(e.last_c&&e.last_c_index!=r||l){if(o!=2)finishPoly(e,t);else finishPoly2(e,t)}if(!e._path){if(s){t.globalCompositeOperation="destination-out"}t.lineCap="round";t.lineJoin="round";t.beginPath();e._path=1;e.last_c=n;e.last_c_index=r}c=i.length;t.moveTo(i[0],i[1]);for(u=2;u<c;u+=2){t.lineTo(i[u],i[u+1])}if(s){finishPoly(e,t);t.globalCompositeOperation="source-over"}e.lastP=a}function finishPoly(e,t){if(!e.last_c)return;var i=e.last_c;if(i.icon&&i.icon_image){if(!i.pattern)i.pattern=t.createPattern(i.icon_image,"repeat");t.fillStyle=i.pattern;t.fill()}else if(i.fillcolor){t.fillStyle=i.fillcolor;t.fill()}if(i.strokecolor&&i.linewidth>0){if(i.dashed){if(t.setLineDash)t.setLineDash(i.dashed);else{t.mozDash=i.dashed;t.webkitLineDash=i.dashed}}t.lineWidth=i.linewidth;if(!i.fillcolor&&i.color)t.strokeStyle=i.color;else t.strokeStyle=i.strokecolor;t.stroke();if(i.dashed){if(t.setLineDash)t.setLineDash([]);else{t.mozDash=[];t.webkitLineDash=[]}}}e.last_c=null;e.last_c_index=null;e._path=0}function finishPoly2(e,t){if(!e.last_c)return;var i=e.last_c;if(i.innerstrokecolor){if(i.dashed){if(t.setLineDash)t.setLineDash(i.dashed);else{t.mozDash=i.dashed;t.webkitLineDash=i.dashed}}t.strokeStyle=i.innerstrokecolor;t.lineWidth=i.innerlinewidth;t.stroke();if(i.dashed){if(t.setLineDash)t.setLineDash([]);else{t.mozDash=[];t.webkitLineDash=[]}}}e.last_c=null;e.last_c_index=null;e._path=0}function parsePoint(e,t,i){var n,r;var a=0;t.type="point";var s=t.features;if(!t.features_by_id)t.features_by_id=[];var o=t.features_by_id;var l=e.gc_state;if(i.fields){a=1}var c=bounds.max/Math.pow(2,l._tileIndexZ);var u=l._tileIndexX;var d=l._tileIndexY;for(n=0;n<s.length;n++){r=s[n];r.x=Math.round(((r.x-bounds.xmin)/c-u)*l._tileSize);r.y=Math.round(((bounds.ymax-r.y)/c-d)*l._tileSize);r.id=r.id.replace("||","_");r.c=r.id;r.fid=+r.id.split("_")[1];r.ispoint=true;if(a){r.data=i.fields[r.id];setupFiltersObject(e,r)}else{r.data={}}if(!o[r.c])o[r.c]=[];o[r.c].push(n)}}function drawPoint(e,t,i){var n,r,a,s,o,l,c;var u=0;var d=null;var h=null;var f=e.gc_state;var p=f._rect;var g=f.by_layer[f.layer];var m=f._tileIndex+":"+f.layer;if(f.curLayerObj.feature_filter&&f.curLayerObj.feature_filter.filter){d=f.curLayerObj.feature_filter.filter;h=f.curLayerObj.feature_filter.context}if(!t)u=f.forceCtx||e.getContext("2d",flashnavigator.canvasOptions);if(!t&&!d&&!g.isDirty){c=getCanvasFromCache(e,m,p,!f._entire_tile_draw);if(c){if(f.obj.modifier){drawTileUsingModifier(e,f.obj,p)}return}}l=g.features;if(!l){return}if(p&&!t){c=createCanvas(e,true);u=c.getContext("2d",flashnavigator.canvasOptions)}f.neighbour_tiles={};var v=performance.now();if(p){for(r=0;r<l.length;r++){n=l[r].b;if(n&&(p.xmax<n.xmin||p.ymax<n.ymin||p.xmin>n.xmax||p.ymin>n.ymax))continue;drawImage(e,f.obj,u,l[r],d,h)}}else{for(r=0;r<l.length;r++){drawImage(e,f.obj,u,l[r],d,h)}}if(c&&!d&&f._entire_tile_draw){g.isDirty=false;c.timeToGenerate=performance.now()-v;storeCanvasToCache(c,m)}if(f.obj.modifier){drawTileUsingModifier(e,f.obj,p)}for(r in f.neighbour_tiles){s=f.neighbour_tiles[r];o={};var y=s.gc_state.by_layer[f.layer];y.features.sort(function(e,t){if(e.i<t.i)return 1;if(e.i>t.i)return-1;return e.fid>t.fid?1:-1});l=y.features;for(a=0;a<l.length;a++){if(!o[l[a].c]){o[l[a].c]=[]}o[l[a].c].push(a)}y.features_by_id=o;y.isDirty=true;f._tiles_to_redraw[s.gc_state._tileIndex]=s}f.neighbour_tiles=null}function getImageOverlay(e,t,i){var n;var r=t.color;if(i.cl>0)r+="_cluster";if(e.icon_image_overlay&&e.icon_image_overlay[r]){n=e.icon_image_overlay[r]}else{if(flashnavigator.inOffscreenRenderingWorker){n=new OffscreenCanvas(i.b.xmax-i.b.xmin,i.b.ymax-i.b.ymin)}else{n=document.createElement("canvas");n.width=i.b.xmax-i.b.xmin;n.height=i.b.ymax-i.b.ymin}var a=n.getContext("2d",flashnavigator.canvasOptions);drawPointCanvas(null,a,i,e,0,0,true);a.globalAlpha=.7;var s=overrideStyle(e,t);a.fillStyle=s.color;a.beginPath();a.rect(0,0,n.width,n.height);a.globalCompositeOperation="source-in";a.fill();if(!e.icon_image_overlay)e.icon_image_overlay=[];e.icon_image_overlay[r]=n}return n}function drawImage(e,t,i,n,r,a,s){if(e.styles&&e.styles[n.i]&&e.styles[n.i].visible===false){n.visible=false;return 0}var o=e.gc_state.curLayerObj;if(!r){if(o.feature_filter&&o.feature_filter.filter){r=o.feature_filter.filter;a=o.feature_filter.context}}var l=o.features[n.i];var c;if(l.icon_image&&l.iready&&l.visible&&(!r||r(n.data,a))){c=l.icon_image;n.b={xmin:Math.floor(n.x-c.width/2),ymin:Math.floor(n.y-c.height/2),xmax:Math.ceil(n.x+c.width/2),ymax:Math.ceil(n.y+c.height/2)};if(s&&i){drawPointCanvas(e,i,n,l,undefined,undefined,false,true);var u=getImageOverlay(l,s,n);i.drawImage(u,n.b.xmin,n.b.ymin,n.b.xmax-n.b.xmin,n.b.ymax-n.b.ymin)}else{drawPointCanvas(e,i,n,l)}n.visible=true}else n.visible=false;return 1}function copyToNextTile(e,t,i,n,r,a,s,o){var l={xmin:i.b.xmin+s,ymin:i.b.ymin+o,xmax:i.b.xmax+s,ymax:i.b.ymax+o};var c={x:i.x+s,y:i.y+o,id:i.id,c:i.c,i:i.i,fid:i.fid,cl:i.cl,copied:true,b:l,ispoint:true,data:i.data};var u=e.gc_state.layer;var d=e.gc_state.gc_layer;var h=d._tiles[t];var f=h?h.gc_state:null;var p=f?f.by_layer[u]:null;if(p&&p._isEmpty){p._isEmpty=false;f.layer=u;h._layer=e._layer;f.gc_layer=d;drawTile(h,{tile:{type:"point",data:[]}},e.gc_state.curLayerObj,true,true)}if(p&&p.features){if(p.features_by_id){var g=p.features_by_id[c.c];if(g){var m=false;var v=p.features;for(var y=0;y<g.length;y++){var _=v[g[y]];if(_.i==c.i&&_.x==c.x&&_.y==c.y){m=true;break}}if(m)return}}if(!f._invalidateRectForCopy)f._invalidateRectForCopy={xmin:l.xmin,ymin:l.ymin,xmax:l.xmax,ymax:l.ymax};else{if(l.xmin<f._invalidateRectForCopy.xmin)f._invalidateRectForCopy.xmin=l.xmin;if(l.ymin<f._invalidateRectForCopy.ymin)f._invalidateRectForCopy.ymin=l.ymin;if(l.xmax>f._invalidateRectForCopy.xmax)f._invalidateRectForCopy.xmax=l.xmax;if(l.ymax>f._invalidateRectForCopy.ymax)f._invalidateRectForCopy.ymax=l.ymax}e.gc_state.neighbour_tiles[t]=h;if(!p.features_by_id[c.c])p.features_by_id[c.c]=[];p.features_by_id[c.c].push(p.features.length);p.features.push(c)}else{var b=d.neighbour_tile_data[t];if(!b){b=d.neighbour_tile_data[t]={}}var w=b[u];if(!w){w=b[u]=[]}w.push(c)}}function drawPointCanvas(e,t,i,n,r,a,s,o){if(!i.b)return;if(r==undefined)r=i.b.xmin;if(a==undefined)a=i.b.ymin;var l=n.icon_image,c,u,d,h=true;var f=giscloud.mapFeatureRenderer!=null;var p=i.b;var g=0;var m,v;if(i.cl&&n.clustering>0&&t){g=n.clustering*flashnavigator.scaleRatio;m=r+(p.xmax-p.xmin)/2;v=a+(p.ymax-p.ymin)/2;if(!s){if(l.width/2<g){p.xmin=Math.floor(m-g);p.xmax=Math.ceil(m+g)}if(l.height/2<g){p.ymin=Math.floor(v-g);p.ymax=Math.ceil(v+g)}}}if(!s||!i.cl||!n.clustering){if(f){u=i.c.split("_");d={featureId:u[1]*1,layerId:parseInt(u[0].replace("layer","").replace("l","")),geometry:[i.x,i.y],bounds:p,visible:h};if(i.data)d.attributes=i.data;c={icon:n.icon_image};giscloud.mapFeatureRenderer(d,c);l=c.icon;h=d.visible}if(h){if(e&&!e.gc_state._isRedraw&&!i.copied&&!o){var y=e.gc_state;var _=y._tileIndexX;var b=y._tileIndexY;var w=y._tileIndexZ;var x,C,T;if(p.xmin<0){_--}else if(p.xmax>y._tileSize){_++}if(p.ymin<0){b--}else if(p.ymax>y._tileSize){b++}C=y._tileIndexX-_;T=y._tileIndexY-b;var k=1<<w;if(_<0){_=k-1}else if(_===k){_=0}var M=y._tileIndexWrap;var S=[M];if(M){S.push(-M)}while((M=S.pop())!==undefined){if(C!=0&&T!=0){x=getTileKey(_,b,w,M);copyToNextTile(e,x,i,l,r,a,C*y._tileSize,T*y._tileSize)}if(C!=0){x=getTileKey(_,y._tileIndexY,w,M);copyToNextTile(e,x,i,l,r,a,C*y._tileSize,0)}if(T!=0){x=getTileKey(y._tileIndexX,b,w,M);copyToNextTile(e,x,i,l,r,a,0,T*y._tileSize)}}}if(t){t.drawImage(l,r,a,l.width,l.height)}}}if(i.cl&&n.clustering>0&&t){var L=i.cl+1;var D=2*flashnavigator.scaleRatio;t.save();t.textAlign="center";t.textBaseline="middle";t.beginPath();t.arc(m,v,g-D,0,2*Math.PI,false);t.fillStyle=n.predominantColor;t.fill();t.lineWidth=D;t.strokeStyle="#003300";t.stroke();if(!s){t.lineWidth=1*flashnavigator.scaleRatio;t.fillStyle="#fff";t.strokeStyle="#000";t.font=10*flashnavigator.scaleRatio+"px sans-serif";t.strokeText(L,m,v);t.fillText(L,m,v)}t.restore()}}var labelCache={},LEFT=1,RIGHT=2,BOTTOM=4,TOP=8,options={benchmark:true},bench={counter:{},perf:{}};bench.start=function(e){if(!options.benchmark){return}bench.perf[e]=performance.now()};bench.end=function(e){if(!options.benchmark){return}if(!bench.counter[e]){bench.counter[e]=0}bench.counter[e]+=performance.now()-bench.perf[e];delete bench.perf[e]};bench.collect=function(e){if(!options.benchmark){return}if(bench.perf[e]){bench.end(e)}console.debug("["+e+"] took "+bench.counter[e].toFixed(3)+"ms");delete bench.counter[e]};function dropCache(){labelCache={}}giscloud.util.mediator.deleteChannel("labelRenderer/dropCache");giscloud.util.mediator.makeChannel("labelRenderer/dropCache",true);giscloud.util.mediator.subscribe("labelRenderer/dropCache",dropCache);function prerenderLabel(e,t,i){bench.start("prerender label");var n,r,a,s,o,l,c,u,d,h,f,p,g,m,v,y,_,b,w;m=t.styleName;if(i!==undefined){m+="_"+i.toFixed(2)}if(!labelCache[m]){labelCache[m]={}}s=labelCache[m];n=s[e];if(n){return n}else{r=document.createElement("canvas");a=r.getContext("2d");b=4;w=4;u=t.fontsize||12;d=t.fontname||"Arial Black";h=t.outline?"#"+t.outline.substr(2):null;f=t.color?"#"+t.color.substr(2):null;c=""+u+"px '"+d+"'";a.font=c;o=w+Math.SQRT2*u;l=b+a.measureText(e).width;p=b>>1;g=Math.floor(o-(o-u)/2);if(i!==undefined){y=giscloud.math.Matrix2.Rotation(i);v=new giscloud.math.Rect(-(l>>1),-(o>>1),l>>1,o>>1);v=y.transform(v);r.width=Math.floor(v.max.x-v.min.x+8);r.height=Math.floor(v.max.y-v.min.y+8);a.font=c;p=Math.floor(-(l>>1)+p);g=Math.floor(-(o>>1)+g-4);a.save();a.translate(r.width>>1,r.height>>1);a.rotate(i)}else{r.width=l;r.height=o;a.font=c}if(h){a.fillStyle=h;a.fillText(e,p-1,g);a.fillText(e,p+1,g);a.fillText(e,p,g-1);a.fillText(e,p,g+1);a.fillText(e,p-1,g-1);a.fillText(e,p-1,g+1);a.fillText(e,p+1,g-1);a.fillText(e,p+1,g+1)}if(h&&!f){a.globalCompositeOperation="xor";a.fillStyle="#ffffff";a.fillText(e,p,g)}else{a.fillStyle=f;a.fillText(e,p,g)}if(i!==undefined){a.restore()}s[e]=r;return r}}function prepareFragments(t){var n,r;t.grid.walk(function(e){if(e.label.style){n=e.text();if(!n){return}r=prerenderLabel(n,e.label.style,e.angle);if(e.label.image!==r){e.label.image=r;i=e.label.image.width>>1;j=e.label.image.height>>1;e.label.rect=new giscloud.math.Rect(e.position[0]-i,e.position[1]-j,e.position[0]+i,e.position[1]+j)}if(!collides(t,e,e.label.rect)){if(t.qtree.top.bounds.contains(e.label.rect)){t.qtree.insert(e.label.rect,e);e.tile=t}else{neighbours=canInsertIntoNeighbours(t,e.label.rect,e);if(neighbours.length){e.originalTile=t;e.neighbours=neighbours;insertIntoNeighbours(neighbours,e);t.qtree.insert(e.label.rect,e);e.tile=t}}}}})}function drawTileLabels(e){var t=e.getContext("2d"),i;t.clearRect(0,0,256,256);e.qtree.walk(function(e){i=e.obj;t.drawImage(i.label.image,e.bounds.min.x,e.bounds.min.y)})}function drawGridCellCenters(e){var t,i,n,r,a=e.getContext("2d");a.strokeStyle="rgba(64, 64, 192, 0.8)";a.lineWidth=2;for(t=0;t<e.grid.width;++t){for(i=0;i<e.grid.height;++i){a.beginPath();if(t%2){n=(t+.5)*(256/e.grid.width);r=(i+.75)*(256/e.grid.height)}else{n=(t+.5)*(256/e.grid.width);r=(i+.25)*(256/e.grid.height)}a.arc(n,r,4,0,2*Math.PI);a.stroke()}}}function renderLabelTile(e,t){t.getContext("2d").clearRect(0,0,256,256);renderPointLabels(e,t);renderLineLabels(e,t);renderPolygonLabels(e,t);prepareFragments(t);drawTileLabels(t)}giscloud.util.mediator.deleteChannel("renderer/drawTile");giscloud.util.mediator.makeChannel("renderer/drawTile");giscloud.util.mediator.subscribe("renderer/drawTile",renderLabelTile);function clearLabelTile(e,t){t.grid.clear();t.qtree.clear()}giscloud.util.mediator.deleteChannel("renderer/clearTile");giscloud.util.mediator.makeChannel("renderer/clearTile");giscloud.util.mediator.subscribe("renderer/clearTile",clearLabelTile);function collides(e,t,i){var n,r,a,s,o=[],l,c,u,d;r=e.qtree.test(i);a=false;for(n=0;n<r.length;++n){if(r[n].bounds.intersects(i)){if(r[n].obj.score()<t.score()){o.push(r[n])}else{a=true;break}}}if(!a&&o.length){s=e.getContext("2d");s.clearRect(0,0,256,256);o.forEach(function(i){e.qtree.remove(function(e){return e.obj.id===i.obj.id});if(i.obj.tile){i.obj.tile.getContext("2d").clearRect(i.obj.label.rect.min.x-1,i.obj.label.rect.min.y-1,i.obj.label.image.width+2,i.obj.label.image.height+2)}if(i.obj.neighbours){i.obj.neighbours.forEach(function(t){t.tile.qtree.remove(function(e){if(e.obj===i.obj){s=t.tile.getContext("2d");u=t.rect.min.x-1;d=t.rect.min.y-1;l=t.rect.max.x-u+2;c=t.rect.max.y-d+2;s.clearRect(u,d,l,c);return true}return false})})}})}return a}function insertIntoNeighbours(e,t){for(i=0;i<e.length;++i){e[i].tile.qtree.insert(e[i].rect,t);drawTileLabels(e[i].tile)}}function canInsertIntoNeighbours(e,t,i){var n=[],r=[],a,s=0,o,l;a=e.qtree.top.bounds;if(t.min.x<a.min.x){s|=LEFT}if(t.max.x>a.max.x){s|=RIGHT}if(t.min.y<a.min.y){s|=TOP}if(t.max.y>a.max.y){s|=BOTTOM}if(s&LEFT){o=e._layer.getTile(new L.Point(e.coord.x-1,e.coord.y));l=t.translate(256,0);if(!collides(o,i,l)){n.push({tile:o,rect:l})}else{return[]}}if(s&TOP){o=e._layer.getTile(new L.Point(e.coord.x,e.coord.y-1));l=t.translate(0,256);if(!collides(o,i,l)){n.push({tile:o,rect:l})}else{return[]}}if(s&RIGHT){o=e._layer.getTile(new L.Point(e.coord.x+1,e.coord.y));l=t.translate(-256,0);if(!collides(o,i,l)){n.push({tile:o,rect:l})}else{return[]}}if(s&BOTTOM){o=e._layer.getTile(new L.Point(e.coord.x,e.coord.y+1));l=t.translate(0,-256);if(!collides(o,i,l)){n.push({tile:o,rect:l})}else{return[]}}if(!(s^(TOP|LEFT))){o=e._layer.getTile(new L.Point(e.coord.x-1,e.coord.y-1));l=t.translate(256,256);if(!collides(o,i,l)){n.push({tile:o,rect:l})}else{return[]}}if(!(s^(TOP|RIGHT))){o=e._layer.getTile(new L.Point(e.coord.x+1,e.coord.y-1));l=t.translate(-256,256);if(!collides(o,i,l)){n.push({tile:o,rect:l})}else{return[]}}if(!(s^(BOTTOM|LEFT))){o=e._layer.getTile(new L.Point(e.coord.x-1,e.coord.y+1));l=t.translate(256,-256);if(!collides(o,i,l)){n.push({tile:o,rect:l})}else{return[]}}if(!(s^(BOTTOM|RIGHT))){o=e._layer.getTile(new L.Point(e.coord.x+1,e.coord.y+1));l=t.translate(-256,-256);if(!collides(o,i,l)){n.push({tile:o,rect:l})}else{return[]}}return n}function renderPointLabels(o,e,t){var i,n,r,a,s,l,c,u,d,t,h,f,p;t=e.labelData.point;r=Object.keys(t);r=r.filter(function(e){return!t[e].hidden});for(i=0;i<r.length;++i){a=t[r[i]];s=Object.keys(a.geometry);for(n=0;n<s.length;++n){l=a.geometry[s[n]];u=l.position[0]*(e.grid.width/256);d=l.position[1]*(e.grid.height/256);f={id:l.id,position:[l.position[0],l.position[1]],label:{rect:null},score:function(e){return o.layers[e].orderIndex}.bind(null,l.layerId)};if(l.label.style!==null&&o.layers[l.layerId]&&o.layers[l.layerId].labelData&&o.layers[l.layerId].labelData.styles){p=o.layers[l.layerId].labelData.features[l.label.style]?o.layers[l.layerId].labelData.features[l.label.style].expression:"";if(p){f.label.style=o.layers[l.layerId].labelData.styles.reduce(function(e,t){if(e){return e}if(t.expression===p){e=t}return e},null)}else{f.label.style=o.layers[l.layerId].labelData.styles[l.label.style]}f.text=function(e,t,i,n){var r,a,s;r=n.label;if(!r){return""}a=o.getTile(i);if(!a){return""}s=a.labelData.point[e];if(!s){return""}if(s.attribute&&s.features[t]&&s.features[t][r]){return s.features[t][r]}else{return""}}.bind(null,l.layerId,l.id,e.coord,f.label.style);e.grid.insert([u,d],f)}}}}function renderPolygonLabels(o,e,t){var i,n,r,a,s,l,c,u,d,t,h,f;t=e.labelData.polygon;r=Object.keys(t);r=r.filter(function(e){return!t[e].hidden});for(i=0;i<r.length;++i){a=t[r[i]];s=Object.keys(a.geometry);for(n=0;n<s.length;++n){l=a.geometry[s[n]];u=l.position[0]*(e.grid.width/256);d=l.position[1]*(e.grid.height/256);f={id:l.id,position:[l.position[0],l.position[1]],label:{rect:null},score:function(e){return o.layers[e].orderIndex}.bind(null,l.layerId)};if(l.label.style!==null&&o.layers[l.layerId]&&o.layers[l.layerId].labelData&&o.layers[l.layerId].labelData.styles){expression=o.layers[l.layerId].labelData.features[l.label.style]?o.layers[l.layerId].labelData.features[l.label.style].expression:"";if(expression){f.label.style=o.layers[l.layerId].labelData.styles.reduce(function(e,t){if(e){return e}if(t.expression===expression){e=t}return e},null)}else{f.label.style=o.layers[l.layerId].labelData.styles[l.label.style]}f.text=function(e,t,i,n){var r,a,s;r=n.label;if(!r){return""}a=o.getTile(i);if(!a){return""}s=a.labelData.polygon[e];if(!s){return""}if(s.attribute&&s.features[t]&&s.features[t][r]){return s.features[t][r]}else{return""}}.bind(null,l.layerId,l.id,e.coord,f.label.style);e.grid.insert([u,d],f)}}}}function renderLineLabels(o,e){var t,i,n,r,a,s,l,c,u,d,h,f,p,g;f=e.labelData.line;r=Object.keys(f);r=r.filter(function(e){return!f[e].hidden});for(t=0;t<r.length;++t){a=f[r[t]];s=Object.keys(a.geometry);for(i=0;i<s.length;++i){l=a.geometry[s[i]];for(n=0;n<l.positions.length;++n){c={id:l.id,score:function(e){return o.layers[e].orderIndex}.bind(null,l.layerId)};d=l.positions[n].x;h=l.positions[n].y;c.angle=l.positions[n].angle;c.position=[d,h];c.label={rect:null};if(l.label.style!==null&&o.layers[l.layerId]&&o.layers[l.layerId].labelData&&o.layers[l.layerId].labelData.styles){g=o.layers[l.layerId].labelData.features[l.label.style]?o.layers[l.layerId].labelData.features[l.label.style].expression:"";if(g){c.label.style=o.layers[l.layerId].labelData.styles.reduce(function(e,t){if(e){return e}if(t.expression===g){e=t}return e},null)}else{c.label.style=o.layers[l.layerId].labelData.styles[l.label.style]}c.text=function(e,t,i,n){var r,a,s;r=n.label;if(!r){return""}a=o.getTile(i);if(!a){return""}s=a.labelData.line[e];if(!s){return""}if(s.attribute&&s.features[t]&&s.features[t][r]){return s.features[t][r]}else{return""}}.bind(null,l.layerId,l.id,e.coord,c.label.style);e.grid.insert([d*(e.grid.width/256),h*(e.grid.height/256)],c)}}}}}function drawText(e,t){var i=e.gc_state;var n=i.by_layer[i.layer];n.type="text";if(t){return}var r=null;var a=null;if(i.curLayerObj.feature_filter&&i.curLayerObj.feature_filter.filter){r=i.curLayerObj.feature_filter.filter;a=i.curLayerObj.feature_filter.context}var s=i.fields;var o=n.features;if(!o){return}var l=o.length;if(l<1){return}var c;var u=i._rect;var d=i._tileIndex+":"+i.layer;if(!r&&!n.isDirty){c=getCanvasFromCache(e,d,u,!i._entire_tile_draw);if(c){return}}var h=i.forceCtx||e.getContext("2d",flashnavigator.canvasOptions);h.lineWidth=3;h.lineCap="round";h.lineJoin="round";if(u){c=createCanvas(e,true);h=c.getContext("2d",flashnavigator.canvasOptions);h.lineWidth=3*flashnavigator.scaleRatio;h.lineCap="round";h.lineJoin="round"}var f=performance.now();var p=-1;var g,m,v,y,_;var b=0,w=0;for(var x=0;x<l;x++){if(p!=o[x].i&&o[x].i>=0){p=o[x].i;_=i.curLayerObj.features[o[x].i];if(_.outline)h.strokeStyle="#"+_.outline.substr(2);if(_.color)h.fillStyle="#"+_.color.substr(2);else h.fillStyle="rgba(255, 255, 255, 0)";g=0;m=0;_.dx&&(g=_.dx*flashnavigator.scaleRatio);_.dy&&(m=_.dy*flashnavigator.scaleRatio);h.textAlign="center";h.textBaseline="middle";b=.5;w=.5;var C=_.anchor;if(C){if(C=="TL"){h.textBaseline="top";h.textAlign="left";b=0;w=0}else if(C=="T"){h.textBaseline="top";w=0}else if(C=="TR"){h.textBaseline="top";h.textAlign="right";b=1;w=0}else if(C=="R"){h.textAlign="right";b=1}else if(C=="BR"){h.textBaseline="bottom";h.textAlign="right";b=1;w=1}else if(C=="B"){h.textBaseline="bottom";w=1}else if(C=="BL"){h.textBaseline="bottom";h.textAlign="left";b=0;w=1}else if(C=="L"){h.textAlign="left";b=0}}h.font=_.fontsize*flashnavigator.scaleRatio+"px "+(_.fontname?_.fontname:"arial");y=(_.fontsize*1+2)*flashnavigator.scaleRatio}if(_.visible===false){continue}var T=o[x].text;var k=T.length;var M=o[x].p;var S=M.length;var L,D,j;for(D=0;D<S;D++){if(r){var I={};if(s&&M[D][4]){I.data=s[M[D][4].replace("||","_")];setupFiltersObject(e,I)}else{I.data={}}if(!r(I.data,a))continue}if(!M[D][5]){M[D][5]=[]}for(L=0;L<k;L++){j=M[D][5][L];if(j){if(u&&(u.xmax<j.bounds.xmin||u.ymax<j.bounds.ymin||u.xmin>j.bounds.xmax||u.ymin>j.bounds.ymax))continue}else{var E,A,P,O;var N=M[D][2];var v=N/180*Math.PI;var R=h.measureText(T[L]);var F=R.width/256;if(F>1){wrapText(T,L,F);k=T.length;R=h.measureText(T[L])}var z=R.width*flashnavigator.scaleRatio;var H=y;var B=M[D][0]*flashnavigator.scaleRatio+g-Math.sin(v)*y*L;var W=M[D][1]*flashnavigator.scaleRatio+m+Math.cos(v)*y*L;if(N==0){E=Math.floor(B-z*b);A=Math.floor(W-H*w);P=Math.ceil(E+z);O=Math.ceil(A+H)}else{var q=Math.cos(v);var G=Math.sin(v);var V=H*q;var U=z*q;var $=H*G;var J=z*G;var Q=B-U*b+$*w;var X=W-J*b-V*w;if(N>0){if(N<90){A=Math.floor(X);O=Math.ceil(X+V+J);E=Math.floor(Q-$);P=Math.ceil(Q+U)}else{A=Math.floor(X+V);O=Math.ceil(X+J);E=Math.floor(Q-$+U);P=Math.ceil(Q)}}else{if(N>-90){A=Math.floor(X+J);O=Math.ceil(X+V);E=Math.floor(Q);P=Math.ceil(Q+U-$)}else{A=Math.floor(X+J+V);O=Math.ceil(X);E=Math.floor(Q+U);P=Math.ceil(Q-$)}}}j={x:B,y:W,angle:v,bounds:{xmin:E-1,ymin:A-1,xmax:P+1,ymax:O+1}};M[D][5][L]=j}if(e&&!i._isRedraw&&!o[x].copied){var Y=i._tileIndexX;var Z=i._tileIndexY;var K=i._tileIndexZ;var ee;if(j.bounds.xmin<0){Y--}else if(j.bounds.xmax>i._tileSize){Y++}if(j.bounds.ymin<0){Z--}else if(j.bounds.ymax>i._tileSize){Z++}var te=i._tileIndexX-Y;var ie=i._tileIndexY-Z;var ne=1<<K;if(Y<0){Y=ne-1}else if(Y===ne){Y=0}var re=i._tileIndexWrap;var ae=[re];if(re){ae.push(-re)}while((re=ae.pop())!==undefined){if(te!=0&&ie!=0){ee=getTileKey(Y,Z,K,re);copyTextToNextTile(e,ee,M[D],T[L],p,j,te*i._tileSize,ie*i._tileSize)}if(te!=0){ee=getTileKey(Y,i._tileIndexY,K,re);copyTextToNextTile(e,ee,M[D],T[L],p,j,te*i._tileSize,0)}if(ie!=0){ee=getTileKey(i._tileIndexX,Z,K,re);copyTextToNextTile(e,ee,M[D],T[L],p,j,0,ie*i._tileSize)}}}h.save();h.translate(j.x,j.y);h.rotate(j.angle);if(_.outline)h.strokeText(T[L],0,0);h.fillText(T[L],0,0);h.restore()}}}if(c&&!r&&i._entire_tile_draw){n.isDirty=false;c.timeToGenerate=performance.now()-f;storeCanvasToCache(c,d)}}function copyTextToNextTile(e,t,i,n,r,a,s,o){var l=[];l[0]=i[0]+s;l[1]=i[1]+o;l[2]=i[2];l[3]=i[3];l[4]=i[4];l[5]=[];var c={xmin:a.bounds.xmin+s,ymin:a.bounds.ymin+o,xmax:a.bounds.xmax+s,ymax:a.bounds.ymax+o};l[5][0]={x:a.x+s,y:a.y+o,bounds:c,angle:a.angle};var u={p:[l],text:[n],i:r,id:i[4],copied:true};var d,h;if(e.gc_state.fields&&i[4]){d=i[4].replace("||","_");h=e.gc_state.fields[d]}var f=e.gc_state.layer;var p=e.gc_state.gc_layer;var g=p._tiles[t];var m=g?g.gc_state:null;var v=m?m.by_layer[f]:null;if(v&&v._isEmpty){v._isEmpty=false;m.layer=f;g._layer=e._layer;g.gc_state.gc_layer=p;drawTile(g,{tile:{type:"text",data:[]}},e.gc_state.curLayerObj,true,true)}if(v&&v.features){if(u.id!==undefined&&v.feature_ids[u.id])return;if(!m._invalidateRectForCopy)m._invalidateRectForCopy={xmin:c.xmin,ymin:c.ymin,xmax:c.xmax,ymax:c.ymax};else{if(c.xmin<m._invalidateRectForCopy.xmin)m._invalidateRectForCopy.xmin=c.xmin;if(c.ymin<m._invalidateRectForCopy.ymin)m._invalidateRectForCopy.ymin=c.ymin;if(c.xmax>m._invalidateRectForCopy.xmax)m._invalidateRectForCopy.xmax=c.xmax;if(c.ymax>m._invalidateRectForCopy.ymax)m._invalidateRectForCopy.ymax=c.ymax}e.gc_state._tiles_to_redraw[t]=g;v.isDirty=true;v.features.push(u);if(d){if(!m.fields)m.fields={};m.fields[d]=h}}else{var y=p.neighbour_tile_data[t];if(!y){y=p.neighbour_tile_data[t]={}}var _=y[f];if(!_){_=y[f]=[]}var b={item:u};if(d){b.field={key:d,value:h}}_.push(b)}}function wrapText(e,t,i){var n=e[t].split(" "),r=Math.ceil(n.length/i),a=[],s,o=0,l=[];while(s=n.shift()){a.push(s);o++;if(o>r){l.push(a.join(" "));a=[];o=0}}if(o>0){l.push(a.join(" "))}e.splice.apply(e,[t,1].concat(l))}function drawPixels(e,t,i){var n,r,a,s=i.length,o,l,c,u,d,h,f=0,p=e.curLayerObj.features,g,m,v=0,y=0,_=0;if(t.pixels){releaseCanvasToPool(t.pixels)}n=getCanvasFromPool(256,256,true);r=n.getContext("2d",flashnavigator.canvasOptions);r.scale(flashnavigator.scaleRatio,flashnavigator.scaleRatio);a=r.createImageData(256,256);o=a.data;if(i[0]!==0){for(c=s-1;c>=0;c--){d=i[c];g=p[d[0]];if(!g||!g.visible){continue}m=g.strokecolorRGB?g.strokecolorRGB:g.fillcolorRGB;if(!m){continue}v=m[0];y=m[1];_=m[2];f=0;h=d.length;for(u=1;u<h;u+=2){f+=d[u]*4;l=d[u+1];while(l--){o[f++]=v;o[f++]=y;o[f++]=_;o[f++]=255}}}t.pixelsVisibility=e.curLayerObj.featuresVisibility;t.pixelsData=i}else{for(c=1;c<s;c++){if(i[c]<0){l=i[c];if(i[c+1]==0){c++;v=i[++c];y=i[++c];_=i[++c]}while(l++){o[f*4]=v;o[f*4+1]=y;o[f*4+2]=_;o[f*4+3]=255;f++}}else{f+=i[c]}}}r.putImageData(a,0,0);t.pixels=n}function drawTileImage(e,t,i,n){var r=e.gc_state,a,s,o=false;r.by_layer[t.id]=r.by_layer[t.id]||{};a=r.by_layer[t.id];r.layer=t.id;r.curLayerObj=t;if(!r.will_load_vectors){r._drawn=true}if(i){s=getCanvasFromPool(flashnavigator.tileSize,flashnavigator.tileSize,true);if(!n){n={x:0,y:0,width:i.width,height:i.height}}s.getContext("2d").drawImage(i,n.x,n.y,n.width,n.height,0,0,flashnavigator.tileSize,flashnavigator.tileSize);if(a.image){releaseCanvasToPool(a.image)}a.image=s;a.can_draw=checkIfImageCanBeDraw(t,e)}if(r._drawn&&(r.number_of_image_requests===0||a.can_draw)){redrawSingleTile(t.tileLayer,e,null,true);o=true}return o}function drawImageInternal(e){var t=e.gc_state,i,n,r,a;t.by_layer[t.layer]=t.by_layer[t.layer]||{};i=t.by_layer[t.layer];if(t.number_of_image_requests>0&&!i.can_draw||!i.image||!e.getContext&&!t.forceCtx){return}a=t._rect;n=t.forceCtx||e.getContext("2d",flashnavigator.canvasOptions);if(t.curLayerObj.isRasterLayer){a=getImageClipRect(a,i.clip)}if(a){if(a.width>0&&a.height>0){r=createCanvas(e,true);n=r.getContext("2d",flashnavigator.canvasOptions);n.drawImage(i.image,a.xmin,a.ymin,a.width,a.height,a.xmin,a.ymin,a.width,a.height)}}else{n.drawImage(i.image,0,0)}}function getImageClipRect(e,t){var i={},n;if(e){i.xmin=e.xmin;i.ymin=e.ymin;i.xmax=e.xmax;i.ymax=e.ymax}else{i.xmin=0;i.ymin=0;i.xmax=256*flashnavigator.scaleRatio;i.ymax=256*flashnavigator.scaleRatio}if(t.left>i.xmin){i.xmin=t.left}if(t.right<i.xmax){i.xmax=t.right}if(t.top>i.ymin){i.ymin=t.top}if(t.bottom<i.ymax){i.ymax=t.bottom}i.width=i.xmax-i.xmin;i.height=i.ymax-i.ymin;return i}function rectUnion(e,t,i){if(t.xmin-i<e.xmin)e.xmin=t.xmin-i;if(t.ymin-i<e.ymin)e.ymin=t.ymin-i;if(t.xmax+i>e.xmax)e.xmax=t.xmax+i;if(t.ymax+i>e.ymax)e.ymax=t.ymax+i;rectCalculateSizeAndId(e)}function rectCropWithTile(e,t){if(e.xmin<t._xmin)e.xmin=t._xmin;if(e.ymin<t._xmin)e.ymin=t._ymin;if(e.xmax>t._xmax)e.xmax=t._xmax;if(e.ymax>t._ymax)e.ymax=t._ymax;rectCalculateSizeAndId(e)}function rectCropWithRect(e,t){if(e.xmin<t.xmin)e.xmin=t.xmin;if(e.ymin<t.ymin)e.ymin=t.ymin;if(e.xmax>t.xmax)e.xmax=t.xmax;if(e.ymax>t.ymax)e.ymax=t.ymax;rectCalculateSizeAndId(e)}function rectAssign(e,t,i){e.xmin=t.xmin-i;e.ymin=t.ymin-i;e.xmax=t.xmax+i;e.ymax=t.ymax+i;rectCalculateSizeAndId(e)}function rectCreate(e){var t={xmin:e._xmin,ymin:e._ymin,xmax:e._xmax,ymax:e._ymax};rectCalculateSizeAndId(t);return t}function rectCalculateSizeAndId(e){e.width=e.xmax-e.xmin;e.height=e.ymax-e.ymin;e.id=e.xmin+"_"+e.xmax+"_"+e.ymin+"_"+e.ymax}function pointDistance(e,t,i,n){var r=e-i;var a=t-n;return Math.sqrt(r*r+a*a)}function vector(e,t){return{x:e,y:t}}function vectorAdd(e,t){return vector(e.x+t.x,e.y+t.y)}function scalarMul(e,t){return vector(e*t.x,e*t.y)}function length(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function normalize(e){return scalarMul(1/length(e),e)}function offset(e,t,i){var n,r,a;n=scalarMul(e,normalize(vector(t.y-i.y,i.x-t.x)));r=vectorAdd(n,t);a=vectorAdd(n,i);return[r,a]}function intersectLines(e,t,i,n,r){var a=t.x-e.x;var s=n.x-i.x;var o=t.y-e.y;var l=n.y-i.y;var c=a*l-o*s;if(c<1e-4){return i}var u=(a*(e.y-i.y)-o*(e.x-i.x))/c;if(u*Math.sqrt(s*s+l*l)>r){return i}else{return{x:i.x+u*s,y:i.y+u*l}}}function doOffset(e,t){if(!e.px){var i=e.p;var n=i.length;var r=vector(i[0],i[1]);var a;var s=null;for(var o=2;o<n;o+=2){var l=r;var c=vector(i[o],i[o+1]);r=c;var u=offset(t/10,l,c);if(s){a=intersectLines(a,s,u[0],u[1],t)}else{a=u[0]}s=u[1];i[o-2]=Math.round(a.x*10)/10;i[o-1]=Math.round(a.y*10)/10;a=u[0]}i[n-2]=Math.round(s.x*10)/10;i[n-1]=Math.round(s.y*10)/10}}function removeDOM(e){if(!e.remove){e=$(e)}e.remove()}function initCanvas(e,t,i,n){var r=e.gc_state;r.forceCtx=t.getContext("2d",flashnavigator.canvasOptions);if(n&&(n.xmin!==0||n.ymin!==0)){r.forceCtx.translate(-n.xmin,-n.ymin)}if(i){if(!r.canvases_to_draw){r.canvases_to_draw=[]}r.current_canvas_state={canvas:t,layer:r.curLayerObj,rect:n};r.canvases_to_draw.push(r.current_canvas_state)}}function createCanvas(e,t,i){var n=e.gc_state,i=i?i:n._rect,r;var a=i?i.width:e.width;var s=i?i.height:e.height;r=getCanvasFromPool(a,s,n._width===a&&n._height===s);initCanvas(e,r,t,i);return r}function storeCanvasToCache(e,t){var i=tile_cache.tiles;if(tile_cache.max===0)return;if(i[t]||tile_cache.count<tile_cache.max){if(tile_cache.min_index==t){tile_cache.min=e.timeToGenerate;calculateCanvasCacheMin()}else if(e.timeToGenerate<tile_cache.min){tile_cache.min=e.timeToGenerate;tile_cache.min_index=t}if(i[t]){i[t].inCache=false;releaseCanvasToPool(i[t])}else{tile_cache.count++}e.inCache=true;e.activeCache=true;i[t]=e}else{if(e.timeToGenerate>tile_cache.min){var n=tile_cache.min_index;if(i[n].activeCache){n=null;for(var r in i){if(!i[r].activeCache&&e.timeToGenerate>i[r].timeToGenerate){n=r;break}}}if(n){i[n].inCache=false;releaseCanvasToPool(i[n]);delete i[n];e.inCache=true;e.activeCache=true;i[t]=e;if(n===tile_cache.min_index){calculateCanvasCacheMin()}}}}}function calculateCanvasCacheMin(){var e=tile_cache.tiles;tile_cache.min=Infinity;for(var t in e){if(e[t].timeToGenerate<tile_cache.min){tile_cache.min=e[t].timeToGenerate;tile_cache.min_index=t}}}function getCanvasFromCache(e,t,i,n){var r=tile_cache.tiles[t];if(tile_cache.max===0||!r||e.isTileDirty)return null;if(i&&n){var a=createCanvas(e,true);a.getContext("2d",flashnavigator.canvasOptions).drawImage(r,i.xmin,i.ymin,i.width,i.height,i.xmin,i.ymin,i.width,i.height);return a}initCanvas(e,r,true,i,n);r.activeCache=true;return r}function intColor2hexColor(e){if(isNaN(e))return e;var t=e.toString(16);return"#"+[0,0,0,0,0,0].slice(t.length).join("")+t}function getFeatureIdsInTiles(e,t,i){var n=[],r={},a,s,o,l,c;for(a=0,o=t.length;a<o;a++){var u=t[a];if(i[u].gc_state&&i[u].gc_state.by_layer&&i[u].gc_state.by_layer[e]&&i[u].gc_state.by_layer[e].features){l=i[u].gc_state.by_layer[e].features;c=l.length;for(s=0;s<c;s++){if(l[s].visible){r[l[s].fid]=l[s].fid}}}}for(a in r){n.push(r[a])}return n}function restoreOriginalParts(e,t){var i=null,n,r,a=t.gc_state,s=a.obj.parent,o,l;if(!a)return;if(!flashnavigator.inOffscreenRenderingWorker){o=!t.getContext;if(o){t=getCanvasFromPool(a._width,a._height);t.gc_state=a}i=t.getContext("2d",flashnavigator.canvasOptions)}for(l in e){n=e[l];if(!n){if(self.Muscula){Muscula.log.info("debug restoreOriginalParts "+Date.now(),{i:l,parts:JSON.stringify(e),canvas_pool:getCanvasPoolStats()})}continue}e[l]=null;r=n.rect;if(r.width>0&&r.height>0){if(flashnavigator.inOffscreenRenderingWorker){canvases_for_redraw.push({bitmap:n.canvas.transferToImageBitmap(),x:r.xmin,y:r.ymin,width:r.width,height:r.height,tileIndex:a._tileIndex,layer:a.obj.parent.id})}else{i.clearRect(r.xmin,r.ymin,r.width,r.height);i.drawImage(n.canvas,0,0,r.width,r.height,r.xmin,r.ymin,r.width,r.height);if(!flashnavigator.inOffscreenRenderingWorker){s.render(t,n.canvas,r)}}}releaseCanvasToPool(n.canvas);n.canvas=null}if(o){releaseCanvasToPool(t)}}function drawCanvasParts(e,t,i,n,r,a){e.forEach(function(e){a.globalAlpha=e.layer.isGroupLayer?e.layer.options.opacity:1;a.drawImage(e.canvas,t,i,n,r,0,0,n,r);a.globalAlpha=1})}function renderTile(t){var e=t.gc_state,i=e.obj.parent,n,r=e.canvases_to_draw||[],a,s,o,l;s=e._rect;if(e._rect&&e._invalidateRect){rectCropWithRect(e._invalidateRect,e._rect)}if(e._invalidateRect&&(e._invalidateRect.width<=0||e._invalidateRect.height<=0)){e._invalidateRect=null}a=e._invalidateRect;e._invalidateRect=null;if(a){var c,u=a.width,d=a.height;c=getCanvasFromPool(u,d);if(!e._originalCanvasParts){e._originalCanvasParts={}}if(e._originalCanvasParts[a.id]){if(e._originalCanvasParts[a.id].canvas){releaseCanvasToPool(e._originalCanvasParts[a.id].canvas)}}e._originalCanvasParts[a.id]={canvas:c,rect:a};o=c.getContext("2d",flashnavigator.canvasOptions);drawCanvasParts(r,a.xmin-s.xmin,a.ymin-s.ymin,u,d,o)}o=t.getContext("2d",flashnavigator.canvasOptions);if(!flashnavigator.inOffscreenRenderingWorker&&s){o.clearRect(s.xmin,s.ymin,s.width,s.height)}r.forEach(function(e){if(e.overlay){n=e.canvas;e.canvas=createCanvas(t,false,s);l=e.canvas.getContext("2d",flashnavigator.canvasOptions);l.drawImage(n,s.xmin,s.ymin);l.drawImage(e.overlay,0,0,a.width,a.height,a.xmin,a.ymin,a.width,a.height);releaseCanvasToPool(n);releaseCanvasToPool(e.overlay);n=null;e.overlay=null}o.globalAlpha=e.layer.isGroupLayer?e.layer.options.opacity:1;o.drawImage(e.canvas,0,0,s.width,s.height,s.xmin,s.ymin,s.width,s.height);releaseCanvasToPool(e.canvas);e.canvas=null});o.globalAlpha=1;if(flashnavigator.inOffscreenRenderingWorker){canvases_for_redraw.push({bitmap:t.transferToImageBitmap(),x:s.xmin,y:s.ymin,width:s.width,height:s.height,layer:e.obj.parent.id,tileIndex:e._tileIndex})}else{i.render(t,t,s,true)}e.canvases_to_draw=[];e._calculateInvalidateRect=false;e._rect=null;e._canvasRect=null;e.forceCtx=null}function unloadTileParts(e){var t,i;if(e.gc_state._originalCanvasParts){t=e.gc_state._originalCanvasParts;for(i in t){releaseCanvasToPool(t[i].canvas)}e.gc_state._originalCanvasParts=null}}function unloadTile(t,e){var i,n,r,a;if(!t)return;i=t.gc_state;for(a in active_loaders){if(active_loaders[a].tile===t){active_loaders[a].tile=null;r=active_loaders[a];if(r.abort){r.abort()}if(r.src){r.src=null}if(active_loaders[a]){delete active_loaders[a]}break}}if(!i)return;unloadTileParts(t);n=t.gc_state.by_layer;if(e){e.forEach(function(e){removeTileFromCache(t,e);if(n[e]&&n[e].pixels){releaseCanvasToPool(n[e].pixels);n[e].pixels=null;n[e].pixelsData=null;n[e].pixelsVisibility=null}if(n[e]&&n[e].image){releaseCanvasToPool(n[e].image);n[e].image=null}});return}removeTileFromCache(t);for(a in n){if(n[a]&&n[a].pixels){releaseCanvasToPool(n[a].pixels);n[a].pixels=null;n[a].pixelsData=null;n[a].pixelsVisibility=null}if(n[a]&&n[a].image){releaseCanvasToPool(n[a].image);n[a].image=null}}t.gc_state.reset=true;t.gc_state=null}function getTileKey(e,t,i,n,r){var a=e+":"+t+":"+i;if(r!==undefined&&r!==i){a+="O"+r}if(n){a+="W"+n}return a}function getTimestamp(e,t){if(e.lid){if(t.dynamic){e.url_prefix=giscloud_tile_url+"d/"+t.modified+"/"+e.mid+"/"+e.lid;var i=(new Date).getTime();e.url=giscloud_tile_url+"d/"+t.modified+"/"+e.mid+"/"+e.lid+"/dyn,"+i+"/";e.url3=giscloud_tile_url+"d/";e.t=i;e.modified=t.modified;e.dynamic=true}else{var n;if(giscloud.app&&giscloud.app.option("DISABLE_CORS"))n="dt/";else n="t2/";var r=","+giscloud.tile_token;r="";e.url=giscloud_tile_url+n+t.modified+"/"+e.mid+r+"/"+e.lid+"/";e.url2=giscloud_tile_url+n;e.modified=t.modified}}else{if(fields)e.url=giscloud_tile_url+"vt3/"+t.modified+"/"+e.mid+"/"+fields+"/";else e.url=giscloud_tile_url+"vt2/"+t.modified+"/"+e.mid+"/"}if(e.map)e.map.getDiv().firstChild.firstChild.firstChild.firstChild.style.zIndex=150}function jsonCanvas(e,t){var i=e.createElement("div");var n=e.createElement("canvas");i.appendChild(n);i.c=n;n.od=e;n.setAttribute("width",256);n.setAttribute("height",256);n.setAttribute("style","position:relative");n.style.position="relative";n.obj=t;if(window.G_vmlCanvasManager)G_vmlCanvasManager.initElement(n);google.maps.event.addDomListener(n,"mousemove",function(e){checkForEvent(e)});return i}function intersects(e,t){if(e.xmax<t.xmin||e.xmin>t.xmax||e.ymax<t.ymin||e.ymin>t.ymax){return false}return true}function findCG(e,t,i,n){var r,a,s=0,o=[],l=e.length-2,c=[],u=Math.min(Math.max(t+e[0],n.xmin),n.xmax),d=Math.min(Math.max(i+e[1],n.ymin),n.ymax),h,f,p,g;c[0]=0;c[1]=0;for(r=2;r<l;r+=2){h=Math.min(Math.max(t+e[r],n.xmin),n.xmax);f=Math.min(Math.max(i+e[r+1],n.ymin),n.ymax);p=Math.min(Math.max(t+e[r+2],n.xmin),n.xmax);g=Math.min(Math.max(i+e[r+3],n.ymin),n.ymax);a=(h-u)*(g-d)-(p-u)*(f-d);c[0]+=a*(u+h+p);c[1]+=a*(d+f+g);s+=a}c[2]=s;return c}function unique_array(e){return e.filter(function(e,t,i){return t==i.indexOf(e)}).sort()}var emptyImageUrl="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function vectorTileLoader(request,dontUseWorker){var x,uri=request.uri,tile=request.tile,url=request.url;if(flashnavigator.offscreenRendering&&!dontUseWorker){if(tile_request[uri]){workerLoader({tile:tile,url:url,uri:uri,seq:tile_request[uri].seq});delete tile_request[uri]}return}if(!tile.gc_state){return}if(giscloud.offlineMode()){return offlineMapTileLoader(url,tile,uri)}x=self.XDomainRequest?new XDomainRequest:new XMLHttpRequest;if(self.XDomainRequest)x.xdomain=1;if(x){x.tile_request=tile_request[uri];delete tile_request[uri];x.tile=tile;assignLoader(tile.gc_state,uri,x);tile.gc_state.number_of_requests++;x.onreadystatechange=function(){if(this.xdomain||this.readyState==4){if(this.ignore){if(this.tile.gc_state){this.tile.gc_state.number_of_requests--}return}if(!checkTileReady(this.tile,this.uri))return;var d=0;if(this.xdomain||this.status==200){if(this.responseText&&this.responseText[0]!="<"&&this.responseText!="[0]"){if(self.JSON){d=self.JSON.parse(this.responseText)}else{d=eval("("+this.responseText+")")}}}else if(this.status===0&&this.responseText){try{d=self.JSON.parse(this.responseText)}catch(err){}}handleMapTileResponse(this,this.tile,d)}};if(x.xdomain){x.onerror=function(){if(this.ignore){if(this.tile.gc_state){this.tile.gc_state.number_of_requests--}return}if(active_loaders[this.uri]){delete active_loaders[this.uri]}};x.ontimeout=function(){if(active_loaders[this.uri]){delete active_loaders[this.uri]}};x.onprogress=function(){};x.onload=x.onreadystatechange}x.open("GET",url);x._url=url;x.send()}}function checkTileReady(e,t){if(!e){return false}if(active_loaders[t]){delete active_loaders[t]}else{if(flashnavigator.inOffscreenRenderingWorker&&e.gc_state){unloadTile(e);releaseCanvasToPool(e)}return false}if(!e.gc_state){return false}if(!e.gc_state.current_loading_uri[t]){return false}else{delete e.gc_state.current_loading_uri[t]}if(!e.gc_state.gc_layer._tiles[e.gc_state._tileIndex]||e.gc_state.gc_layer._tiles[e.gc_state._tileIndex].gc_state!==e.gc_state){unloadTile(e);releaseCanvasToPool(e);return false}if(e.gc_state.reset){unloadTile(e);releaseCanvasToPool(e);return false}return true}function calculateImageRect(e,t){var i={},n=Math.pow(2,e.zoom-e.original.zoom);i.width=t.width*n;i.height=t.height*n;i.x=i.width*e.original.x-t.width*Math.floor(e.original.x*n);i.y=i.height*e.original.y-t.height*Math.floor(e.original.y*n);e.rect=i}function renderImageTile(e,t,i,n,r){drawTileImage(e,t,n,r);if(!e||!e.gc_state){return}if(flashnavigator.inOffscreenRenderingWorker){workerRenderTiles(e.gc_state.gc_layer)}if(e.ontileload&&e.gc_state.number_of_requests===0){e.ontileload()}}function handleImageLoad(e,t,i,n,r,a){if(!checkTileReady(e,r.uri))return;e.gc_state.number_of_image_requests--;e.gc_state.number_of_requests--;if(a.original){if(t.zoomThreshold===undefined&&t.source.src!=="wms"&&!a.incompleteTileCoverage){t.zoomThreshold=a.zoom}calculateImageRect(a,n)}renderImageTile(e,t,a,n,a.rect)}function handleImageLoadError(e,t,i,n,r,a){if(n.ignore){e.gc_state.number_of_image_requests--;e.gc_state.number_of_requests--;return}if(!checkTileReady(e,n.uri))return;e.gc_state.number_of_image_requests--;e.gc_state.number_of_requests--;if(a){if(!r.original){r.original={zoom:r.zoom,x:r.coord.x,y:r.coord.y}}r.zoom--;if(r.zoom>=0){r.coord.x=Math.floor(r.coord.x/2);r.coord.y=Math.floor(r.coord.y/2);r.tile=e;generateTileImageUrl(r);imageTileLoader(r);return}}i.noImage=true;renderImageTile(e,t,r)}function imageTileLoader(n){var r,a,s=n.tile,e=n.uri,t=n.coord,o=n.layer,i=s.gc_state,l,c;if(!i){return}if(o.incompleteTileCoverage){n.incompleteTileCoverage=o.incompleteTileCoverage}l=i.by_layer[o.id];if(flashnavigator.offscreenRendering){n.isImage=true;n.layer=o.id;n.that=undefined;if(tile_request[e]){workerLoader(n);tile_request[e]=null}return}if(o.zoomThreshold&&n.zoom>o.zoomThreshold){n.original={x:t.x,y:t.y,zoom:n.zoom};t.x=Math.floor(t.x*Math.pow(2,o.zoomThreshold-n.zoom));t.y=Math.floor(t.y*Math.pow(2,o.zoomThreshold-n.zoom));n.zoom=o.zoomThreshold}n.hadPreviousSuccessfullRequest=o.hadPreviousSuccessfullRequest;generateTileImageUrl(n);if(!l){i.by_layer[o.id]={};l=i.by_layer[o.id]}l.lid=o.id;l.type="image";l.clip=n.clip;i.number_of_image_requests++;i.number_of_requests++;if(self.fetch&&self.AbortController){a=new AbortController;c={signal:a.signal,referrer:self.location.origin,referrerPolicy:"origin"};r=fetch(n.url,c).then(function(e){if(Math.round(e.status/100)===4){handleImageLoadError(s,o,l,a,n,true);return}o.hadPreviousSuccessfullRequest=true;e.blob().then(function(e){if(e.size==0){handleImageLoadError(s,o,l,a,n);return}if(self.createImageBitmap){createImageBitmap(e).then(function(e){handleImageLoad(s,o,l,e,a,n)}).catch(function(e){handleImageLoadError(s,o,l,a,n)})}else{if(!active_loaders[seq])return;var t=self.URL||self.webkitURL;var i=t.createObjectURL(e);r=new Image;r.tile=s;a=r;active_loaders[seq]=a;r.onload=function(){var e=this;t.revokeObjectURL(i);handleImageLoad(s,o,l,e,this,n)};r.onerror=function(){t.revokeObjectURL(i);handleImageLoadError(s,o,l,a,n)};r.src=i}}).catch(function(e){handleImageLoadError(s,o,l,a,n)})}).catch(function(e){var t=e instanceof TypeError;if(t&&!n.hadPreviousSuccessfullRequest&&!n.usingProxy&&o.proxyServerAvailable){o.proxyServer=o.proxyServerAvailable;if(s.gc_state){s.gc_state.number_of_image_requests--;s.gc_state.number_of_requests--}n.tile=s;imageTileLoader(n);return}handleImageLoadError(s,o,l,a,n,t)})}else{r=new Image;a=r;r.onload=function(){var e=r;handleImageLoad(s,o,l,e,a,n)};r.onerror=function(){handleImageLoadError(s,o,l,a,n)};r.src=n.url}if(tile_request[e]){a.tile_request=tile_request[e];delete tile_request[e]}a.tile=s;assignLoader(i,e,a)}function assignLoader(e,t,i){var n=e._tileIndex+":"+t;if(!e.current_loading_uri){e.current_loading_uri={}}e.current_loading_uri[n]=1;i.uri=n;if(active_loaders[n]){if(active_loaders[n].abort){active_loaders[n].ignore=true;active_loaders[n].abort()}}active_loaders[n]=i}function resetLoaders(){var e;for(e in active_loaders){resetLoader(e)}loader_id++;tile_req=[];tile_request={};if(flashnavigator.offscreenRendering){workerResetLoaders()}}function resetLoader(e){if(!active_loaders[e])return;if(active_loaders[e].tile){tile=active_loaders[e].tile;if(tile._layer._tileOnError){tile._layer._tileOnError.call(tile)}if(flashnavigator.inOffscreenRenderingWorker){if(tile.gc_state){workerHandleTileOnError(tile._layer.id,tile.gc_state._tileIndex);unloadTile(tile)}releaseCanvasToPool(tile);tile.gc_state=null;tile=null}}if(!active_loaders[e])return;active_loaders[e].tile=null;if(active_loaders[e].src){active_loaders[e].src=emptyImageUrl}if(active_loaders[e].abort){active_loaders[e].abort()}delete active_loaders[e]}function abortRequest(e){var t;if(!e.gc_state){return}var i=e.gc_state.current_loading_uri;e.gc_state.current_loading_uri=null;if(i){for(t in i){resetLoader(t)}}}function handleEmptyTile(e){var t=e.gc_state.obj;var i=t.parent;if(i.neighbour_tile_data&&i.neighbour_tile_data[e.gc_state._tileIndex]&&i.neighbour_tile_data[e.gc_state._tileIndex][i.id]){var n=i.features[0].type;if(n=="point"){drawTile(e,{tile:{type:"point",data:[]}},i)}if(n=="label"||n=="text"){drawTile(e,{tile:{type:"text",data:[]}},i)}}else{if(!e.gc_state.by_layer[i.id]){e.gc_state.by_layer[i.id]={}}e.gc_state.by_layer[i.id]._isEmpty=true}}function handleMapTileResponse(e,t,i){var n;if(i&&i.length&&!t.gc_state.obj.dynamic){var r,a,s=0,o,l,c=e.tile_request.tiles;for(a=0;a<c.length;a++){r=c[a];n=r.gc_state.obj;if(n){if(n.parent.group){s+=processGroupTiles(e.tile_request,i,a,s)}else{o=!r.getContext;if(o){l=r;r=getCanvasFromPool(state._width,state._height);r.gc_state=state;r._layer=l._layer}r.gc_state._rect=rectCreate(r.gc_state);if(i[a]){drawTile(r,i[a],n.parent)}else{handleEmptyTile(r)}renderTile(r);if(o){releaseCanvasToPool(r);r=l;o=false}redrawNeighbourTiles(r);if(flashnavigator.inOffscreenRenderingWorker){workerRenderTiles(n.parent)}}}r.gc_state.number_of_requests--;if(r&&r.ontileload&&r.gc_state.number_of_requests===0){r.ontileload()}}}else if(t){if(t.gc_state){n=t.gc_state.obj}if(n){if(n.parent.group){processGroupTiles(e.tile_request,i,0,0,true)}else{o=!r.getContext;if(o){l=t;t=getCanvasFromPool(state._width,state._height);t.gc_state=state;t._layer=l._layer}t.gc_state._rect=rectCreate(t.gc_state);if(i){drawTile(t,i,n.parent)}else{handleEmptyTile(t)}renderTile(t);if(o){releaseCanvasToPool(t);t=l}redrawNeighbourTiles(t);if(flashnavigator.inOffscreenRenderingWorker){workerRenderTiles(n.parent)}}}t.gc_state.number_of_requests--;if(t.ontileload&&t.gc_state.number_of_requests===0){t.ontileload()}}}function offlineMapTileLoader(url,tile,uri){var params,params_offset=0,fields=null,request;url=url.split("/");if(url.length==11){params_offset+=1;fields="&fields="+url[7]}params=[url[4],url[5],url[6],url[7+params_offset],url[8+params_offset],url[9+params_offset].replace(".json","")];if(fields)params.push(fields);request={tile_request:tile_request[uri]};delete tile_request[uri];giscloudOffline.getMapTile(params,function(tile_data){if(window.JSON){tile_data=window.JSON.parse(tile_data)}else{tile_data=eval("("+tile_data+")")}handleMapTileResponse(request,tile,tile_data)},function(){console.log("Error loading tile")})}function tileXYToQuadKey(e,t,i){var n="";for(var r=i;r>0;r--){var a="0";var s=1<<r-1;if((e&s)!=0){a++}if((t&s)!=0){a++;a++}n+=a}return n}function generateTileImageUrl(e){var t=e.original_url,i=e.coord,n=e.zoom,r=e.layer,a=e.subdomains,s=e.gctms,o=i.x,l=i.y,c,u,d=bounds.max/(1<<n);if(s){l=Math.pow(2,n)-l-1}if(bounds.zoomOffset){n+=bounds.zoomOffset}c=bounds.xmin+d*o,u=bounds.ymax-d*l;if(a){t=t[0].replace("{s}",a[(o+l)%a.length])}else{t=t[(i.x+i.y)%t.length]}t=t.replace(/{x}/g,o).replace(/{y}/g,l).replace(/{z}/g,n).replace(/\$x1/g,c).replace(/\$y1/g,u-d).replace(/\$x2/g,c+d).replace(/\$y2/g,u).replace(/\$id/g,n).replace(/\$nx/g,o).replace(/\$ny/g,l).replace(/{q}/g,tileXYToQuadKey(o,l,n));if(r.proxyServer){t=r.proxyServer.replace("{url}",encodeURIComponent(t)).replace("{mid}",e.map_id);e.usingProxy=true}e.url=t}function sendRequests(){var e,t;while(e=tile_req.shift()){if(!e.tile||!e.tile.gc_state||!tile_request[e.uri]){e.tile=null;if(tile_request[e.uri]){delete tile_request[e.uri]}continue}e.that.parent.viewer.increaseTileCounter(e.tile);if(e.isImage){imageTileLoader(e);e.tile=null;continue}t="";var i=giscloud.tile_token+":";i="";if(tile_request[e.uri].attribs.length>0){t=tile_request[e.uri].attribs.filter(function(e,t,i){return i.indexOf(e)==t});t=t.join(",")+"/"}if(e.that.url2){e.url=e.that.url2+i+tile_request[e.uri].timestamps.join(",")+"/"+e.that.mid+"/"+tile_request[e.uri].layers.join(",")+"/"+t+e.uri_for_request+".json";vectorTileLoader(e)}else if(e.that.url3){e.url=e.that.url3+i+tile_request[e.uri].timestamps.join(",")+"/"+e.that.mid+"/"+tile_request[e.uri].layers.join(",")+"/dyn,"+e.that.t+"/"+t+e.uri_for_request+".json";vectorTileLoader(e)}e.tile=null}}function _loadTile(e,t,i,n){var r="";var a=null;var s=e.gc_state;var o=n.parent;var l=false;s.feature_attributes="";if(n.feature_attributes||n.parent.labels||n.parent.labelData&&n.parent.labelData.attribute){s.feature_attributes=n.feature_attributes;a=n.feature_attributes.split(",")}else{if(flashnavigator.newLabelingMode){s.feature_attributes_array=null;if(n.parent.group){s.feature_attributes=n.parent.group.map(function(e){return e.labelData.attribute}).filter(function(e,t,i){return i.indexOf(e)===t}).filter(function(e){return!!e}).join(",")||""}if(s.feature_attributes&&s.feature_attributes.length>0){a=s.feature_attributes.split(",");s.feature_attributes_array=a}}else{s.feature_attributes=""}}s.uri_for_request=r+i+"/"+t.x+"/"+t.y;r+=s._tileIndex+"/"+n.mid;s.obj=n;e.zoom=i;e.coord=t;s._loader_id=loader_id;e.uri=r;s.number_of_requests=0;if(o.group){var c=[];var u=[];var d,h;for(var f=0;f<o.group.length;f++){d=o.group[f];if(o._tileShouldBeLoaded(t,d)){l=true;if(e.gc_state.by_layer[d.id])delete e.gc_state.by_layer[d.id];if(d.isImage){var p="image_layer/"+r+"/"+d.id;if((d.viewer.epsg==="3857"||d.viewer.epsg==="900913")&&d.source.zoomOffset){i-=d.source.zoomOffset}tile_req_seq++;tile_request[p]={seq:tile_req_seq,tiles:[e]};h={isImage:true,coord:{x:t.x,y:t.y},zoom:i,gctms:d.options.gctms,subdomains:d.options.subdomains,tile:e,gc_state:e.gc_state,that:n,original_url:d._url,uri:p,map_id:n.mid.replace("map",""),layer:d,clip:{}};if(t.x==d.tileIndexXMin){h.clip.left=Math.round((d.tileIndexXMinFloat-d.tileIndexXMin)*256*flashnavigator.scaleRatio)}if(t.y==d.tileIndexYMin){h.clip.top=Math.round((d.tileIndexYMinFloat-d.tileIndexYMin)*256*flashnavigator.scaleRatio)}if(t.x==d.tileIndexXMax){h.clip.right=Math.round((d.tileIndexXMaxFloat-d.tileIndexXMax)*256*flashnavigator.scaleRatio)}if(t.y==d.tileIndexYMax){h.clip.bottom=Math.round((d.tileIndexYMaxFloat-d.tileIndexYMax)*256*flashnavigator.scaleRatio)}tile_req.push(h)}else{c.push(d.options.id);u.push(d.options.modified)}}}if(c.length==0){s.will_load_vectors=false;return l}s.will_load_vectors=true;n.lid=c.join(",");n.modified=u.join(",")}else{l=true;e.gc_state.by_layer[n.lid]=null}if(!tile_request[r]){var g={coord:t,tile:e,gc_state:e.gc_state,that:n,uri:r,uri_for_request:e.gc_state.uri_for_request};tile_req_seq++;tile_request[r]={tiles:[],layers:[],timestamps:[],attribs:[],seq:tile_req_seq,present:{}};tile_req.push(g)}if(!tile_request[r].present[n.lid]){tile_request[r].tiles.push(e);tile_request[r].layers.push(n.lid);tile_request[r].timestamps.push(n.modified);tile_request[r].present[n.lid]=true;if(a){tile_request[r].attribs=a.concat(tile_request[r].attribs)}}return l}function checkAttributesAndReload(t){var i=false;var n;var r=t._tiles;var e=Object.keys(r);var a=t.gcmap.feature_attributes;e.forEach(function(e){n=r[e];if(a!==n.gc_state.feature_attributes){_loadTile(n,n.coord,n.zoom,t.gcmap);i=true}});if(i){t.gcmap.Html5SendRequests()}return i}function processGroupTiles(e,t,i,n,r){var a=e.tiles[i],s,o;if(!a){return 0}var l,c=a.gc_state.obj.parent,u,d,h,f=a.gc_state,p=r?[t]:t,g=[],m=e.layers[i].split(",");for(h=0;h<m.length;h++){g[m[h]]=p[n+h]}d=f._drawn;f._drawn=false;f._entire_tile_draw=true;f._rect=rectCreate(a.gc_state);if(!d){f._invalidateRect=null;f._calculateInvalidateRect=true;o=!a.getContext;if(o){s=a;a=getCanvasFromPool(f._width,f._height);a.gc_state=f;a._layer=s._layer}}for(h=0;h<c.group.length;h++){var v=c.group[h];if(v.isImage&&!d){f.layer=v.id;f.curLayerObj=v;drawImageInternal(a);f._drawn=false;continue}u=g[v.id];if(u===0){if(a._layer.neighbour_tile_data&&a._layer.neighbour_tile_data[f._tileIndex]&&a._layer.neighbour_tile_data[f._tileIndex][v.id]){var y=v.features[0].type;if(y=="point"){u={tile:{type:"point",data:[]}}}if(y=="label"||y=="text"){u={tile:{type:"text",data:[]}}}}else{if(!f.by_layer[v.id])f.by_layer[v.id]={};f.by_layer[v.id]._isEmpty=true}}if(u){f.layer=v.id;f.curLayerObj=v;drawTile(a,u,v,d);f._drawn=false}}f._drawn=true;if(d){redrawSingleTile(f.obj.parent,a,null,false)}else{renderTile(a)}if(o){releaseCanvasToPool(a);a=s}redrawNeighbourTiles(a);if(flashnavigator.inOffscreenRenderingWorker){workerRenderTiles(c)}return m.length}var worker=null;var layers_by_id={};function workerResetLoaders(e){worker.postMessage({msg:"tile_load_reset"})}function workerAbortRequest(e){worker.postMessage({msg:"tile_abort_request",tile_layer_id:e.gc_state.obj.tileLayer.id,tile_index:e.gc_state._tileIndex,loading_uri:e.gc_state.current_loading_uri})}function workerHandlerUpdateScaleRatio(){worker.postMessage({msg:"update_scale_ratio",scaleRatio:flashnavigator.scaleRatio})}function workerHandler(e){e.data.msg==="mouse_position_done"&&workerProcessMousePositionHandler(e);e.data.msg==="tile_load_done"&&workerHandlerTileLoad(e);e.data.msg==="tile_render"&&workerHandlerTileRender(e);e.data.msg==="tile_on_error"&&workerHandlerTileOnError(e);e.data.msg==="return_feature_ids"&&workerHandlerFeatureIds(e)}if(flashnavigator.offscreenRendering){var workerUrl=common.assetsSite()+"assets/api/1/offscreen_rendering_worker.js?nch="+giscloud_config.nch;var workerUrlObj=URL.createObjectURL(new Blob(["importScripts('"+workerUrl+"');"],{type:"text/javascript"}));worker=new Worker(workerUrlObj);URL.revokeObjectURL(workerUrlObj);worker.addEventListener("message",workerHandler)}function workerLoader(e){var t=tile_request[e.uri],i=t.tiles,n={},r=[],a=e.tile,s;i.forEach(function(e){prepareTileForTransfer(e,a,r)});for(s in t){n[s]=t[s]}n.tiles=[];var o=a.gc_state;if(!o.current_loading_uri){o.current_loading_uri={}}o.current_loading_uri[e.uri]=1;e.msg="tile_load";e.tile_request=n;e.tile_data=r;e.loading_uri=e.uri;e.gc_state=null;e.tile=null;worker.postMessage(e);tile_request[e.uri]=null}function workerImageLoader(e,t,i,n,r){var a;for(a in tile_request_for_uri){tile_request_transfer[a]=tile_request_for_uri[a]}tile_request_transfer.tiles=[];worker.postMessage({msg:"tile_image_load",url:t,tile_request:tile_request_transfer,uri:r});tile_request[r]=null}function prepareTileForTransfer(e,t,i){var n={},r=e.gc_state,a;for(a in r){n[a]=r[a]}n.obj=r.obj.parent.id;if(r.viewerTile){delete n.viewerTile;r.viewerTile.isLoaded=false}if(n._canvas){delete n._canvas}if(n.gc_layer){delete n.gc_layer}if(e===t)n.isDest=1;i.push(n)}function workerHandlerTileRender(e){var s=e.data.bitmaps,t=layers_by_id[e.data.layer_id],o=t.viewer;requestAnimationFrame(function(){var e,t,i,n,r,a=s.length;for(n=0;n<a;n++){t=s[n];r=layers_by_id[t.layer];e=r._tiles[t.tileIndex];if(!e||e.transferToAnotherViewer)continue;if(!r.render(e,t.bitmap,{xmin:t.x,ymin:t.y})){i=e.getContext("2d",flashnavigator.canvasOptions);i.clearRect(t.x,t.y,t.width,t.height);i.drawImage(t.bitmap,0,0,t.width,t.height,t.x,t.y,t.width,t.height)}}if(o&&o.onRender){o.onRender()}})}function workerHandlerTileLoad(e){var t=layers_by_id[e.data.layer]._tiles[e.data.tileIndex];if(t&&t.ontileload){requestAnimationFrame(function(){t.ontileload(e.data.number_of_image_requests)})}}function workerUnloadTile(e,t,i){worker.postMessage({msg:"remove_tiles",layer:e,tileIndex:t,cache_id:i})}function workerHandlerTileOnError(e){var t,i=layers_by_id[e.data.layer_id];if(!i)return;t=i._tiles[e.data.tile_index];if(t&&i.viewerLayer._layer._tileOnError){i.viewerLayer._layer._tileOnError.call(t)}}function workerModifyObject(e,t,i,n,r,a,s){worker.postMessage({msg:"modify_object",invoked_layer:e,feature_list:t,style:i,layer_id:n,clear:r,e:a,f:s})}var get_feature_ids_handlers={};var get_feature_ids_handlers_index=0;function workerGetFeatureIds(e,t,i,n){get_feature_ids_handlers[get_feature_ids_handlers_index]=n;worker.postMessage({msg:"get_feature_ids",layer_id:e,tile_layer_id:t,tile_indexes:i,handler_index:get_feature_ids_handlers_index});get_feature_ids_handlers_index++}function workerHandlerFeatureIds(e){if(get_feature_ids_handlers[e.data.handler_index]){get_feature_ids_handlers[e.data.handler_index](e.data.layer_id,e.data.fids);delete get_feature_ids_handlers[e.data.handler_index]}}function workerStoreTileToCache(e,t,i){worker.postMessage({msg:"store_tile_cache",layer_id:e,tile_index:t,cache_id:i})}function workerRestoreTileFromCache(e,t,i,n){worker.postMessage({msg:"restore_tile_cache",layer_id:e,tile_index:t,cache_id:i,wrap:n})}function workerWrapTiles(e,t){worker.postMessage({msg:"wrap_tiles",layer_id:e,wrapDelta:t})}function workerSyncLayers(){var e=[],t=prepareLayerDataForWorkers(flashnavigator.layers,e);worker.postMessage({msg:"init",layer_data:t,map_id:flashnavigator.map_id,bounds:bounds,offline_mode:giscloud.offlineMode(),isMobileBrowser:common.isMobileBrowser,canvasOptions:flashnavigator.canvasOptions,scaleRatio:flashnavigator.scaleRatio},e)}function prepareLayerDataForWorkers(e,t){var i={},n,r,a,s,o,l,c,u;layers_by_id={};e.forEach(function(e){if(!(e instanceof fnTileLayerGroup||e instanceof fnTileLayer))return;layers_by_id[e.id]=e;a=[];if(e.features){e.features.forEach(function(e){s={};for(u in e){s[u]=e[u]}if(s.icon_image){o=s.icon_image;l=new OffscreenCanvas(o.width,o.height);c=l.getContext("2d",flashnavigator.canvasOptions);c.drawImage(o,0,0,o.width,o.height);try{s.icon_image=l.transferToImageBitmap();t.push(s.icon_image)}catch(e){s.icon_image=null}}a.push(s)})}if(e.isRootLayer){n=e.tileLayer;r=n.group.map(function(e){return e.id});layers_by_id[n.id]=n;i[n.id]={id:n.id,gcmap:{activeLayer:null,lid_map:{},modifier:n.gcmap.modifier},group:r,neighbour_tile_data:{},options:{},layer_info:{}}}i[e.id]={id:e.id,isGroupLayer:e.isGroupLayer,isRasterLayer:e.isRasterLayer,isImage:e.isImage,source:{src:e.source.src},zoomThreshold:e.zoomThreshold,visible:e.visible,groupId:e.groupId,features:a,featuresVisibility:e.featuresVisibility,has_inner_line:e.has_inner_line,_selectable:e._selectable,neighbour_tile_data:{},proxyServer:e.proxyServer,proxyServerAvailable:e.proxyServerAvailable,options:{opacity:e.options.opacity,visible:e.options.visible},layer_info:{hiddenGeometry:e.layer_info&&e.layer_info.hiddenGeometry}};if(e.gcmap){i[e.id].gcmap={activeLayer:null,lid_map:{},modifier:e.gcmap.modifier}}});return i}function workerLayerSetFilter(e,t){var i={},n,r=null,a=null,s;for(s in t){i[s]=t[s]}if(i.filter){n=i.filter.toString();r=n.slice(n.indexOf("{")+1,n.lastIndexOf("}"));a=n.slice(n.indexOf("(")+1,n.indexOf(")")).split(",");i.filter=null}worker.postMessage({msg:"layer_set_filter",id:e,filter:i,func_body:r,func_args:a})}function workerRedrawLayer(e,t,i){worker.postMessage({msg:"layer_redraw",layer_id:e.id,reload_styles:t,tiles_filter:i})}function workerLayerUpdate(e,t){worker.postMessage({msg:"layer_update",id:e,params:t})}function workerResetGroup(e,t){worker.postMessage({msg:"reset_group",group:t,layer:e})}function workerUnloadTiles(e){worker.postMessage({msg:"layer_unload_tiles",layer:e})}function workerLayerRemove(e){worker.postMessage({msg:"layer_remove",layer_id:e})}function workerCanvasPoolCleanUp(){worker.postMessage({msg:"canvas_pool_cleanup"})}var mouse_events_handlers=[];function workerProcessMousePositionHandler(e){var t;while(t=mouse_events_handlers.shift()){t.event.showMousePointer=e.data.showMousePointer;t.event.hoveredObject=e.data.hoveredObject;t.callback(t.event)}}function workerProcessMousePosition(e,t,i,n,r){var a={showMousePointer:e.showMousePointer,offsetX:e.offsetX,offsetY:e.offsetY,layerX:e.layerX,layerY:e.layerY};mouse_events_handlers.push({event:e,callback:r});worker.postMessage({msg:"process_mouse_position",evt:a,tileIndex:t,selectionEnabled:n})}function workerCheckEvents(e,t,i,n,r){worker.postMessage({msg:"tile_check_events",x:t,y:i,delta:r,layer:e.layer,selectionEnabled:selectionEnabled,tileIndex:e._tileIndex})}initTileCache();this.html5ResetLoaders=resetLoaders};var canvas_pool=[];var canvas_create=0;var canvas_delete=0;var canvas_pool_size=0;var active_canvas=0;var same_size=0;var diff_size=0;function getCanvasPoolStats(){return"canvas_pool"+"\nactive\t\t\t"+active_canvas+"\nfree pool\t\t"+canvas_pool.length+"\ntotal pool\t\t"+canvas_pool_size+"\n% free\t\t\t"+Math.round(canvas_pool.length/canvas_pool_size*100)+"%"+"\ncreated\t\t\t"+canvas_create+"\ndeleted\t\t\t"+canvas_delete+"\nsame size\t\t"+same_size+"\ndiff size\t\t"+diff_size}function getCanvasFromPool(e,t,i){var n=canvas_pool.length,r;active_canvas++;if(n>0){var a=Infinity,s=0,o,l;for(l=n-1;l>=0;l--){r=canvas_pool[l];if(r.width===e&&r.height===t){canvas_pool.splice(l,1);r.reused=true;same_size++;canvas_pool_size--;r._inPool=false;return r}else{o=Math.abs(r.width-e)+Math.abs(r.height-t);if(o<a){a=o;s=l}}}diff_size++;r=canvas_pool.splice(s,1)[0];r.reused=false;r.width=e;r.height=t;canvas_pool_size--;r._inPool=false;return r}canvas_create++;if(self.flashnavigator&&flashnavigator.inOffscreenRenderingWorker){r=new OffscreenCanvas(e,t)}else{r=document.createElement("canvas");r.width=e;r.height=t}r.reused=i;r._inPool=false;return r}function releaseCanvasToPool(e){if(!e||e._inPool){return}if(e.inCache){e.activeCache=false;return}if(!e.reused&&0){e.width=0;e.height=0;delete e;e=null;active_canvas--;return}if(canvas_pool.length>200){canvasPoolCleanUp(200)}var t=e.getContext("2d");t.setTransform(1,0,0,1,0,0);t.clearRect(0,0,e.width,e.height);t=null;e._aborted=false;e.gc_state=null;e._inPool=true;canvas_pool.push(e);canvas_pool_size++;active_canvas--}function canvasPoolCleanUp(e){var t=canvas_pool.length,i,n,r;if(!e)e=25;if(t>e){i=Math.round(t*.25);r=0;while(r<t&&i>0){n=canvas_pool[r];if(!n.reused){n.width=0;n.height=0;delete n;n=null;canvas_pool.splice(r,1);canvas_pool_size--;i--;t--}else{r++}}while(i>0){canvas_delete++;n=canvas_pool.pop();n.width=0;n.height=0;delete n;n=null;canvas_pool_size--;i--}}}var fnPrinter2=function(e){};var fnBitmap2=function(e){};var fnSlider2=function(e){};flashnavigator2={};flashnavigator2.legacyObjects={fnLayer:{},fnMarker:{},fnAgent:{},fnCanvas:{},fnPrinter:{},fnBitmap:{},fnTooltip:{},fnSlider:{},fnKartehr:{},fnViewer:{}};flashnavigator2.html5=true;flashnavigator2.include=function(){};flashnavigator2.setOptions=function(e){flashnavigator2.extraOptions=e};flashnavigator2.initViewer=function(e,t,i,n){if(internalViewers[e]){lv=internalViewers[e];n();return}var r={maxZoom:25,zoom:0,latloncrs:true,center:new giscloud.LonLat(0,0),host:giscloud_tile_url,background:"#fff",attribution:{prefix:"Powered by <a href='https://www.giscloud.com/' target='_blank'>GIS Cloud</a>"}};if(flashnavigator2.extraOptions&&flashnavigator2.extraOptions.lockZoom){r.lockZoom=true}if(flashnavigator2.extraOptions&&flashnavigator2.extraOptions.hideZoomButtons){r.hideZoomButtons=true}if(e=="3D"){lv=new common.ViewerMapbox(t,i,r)}else if(e=="2D"){lv=new common.ViewerLeaflet(t,i,r)}internalViewers[e]=lv;lv.attribution=r.attribution.prefix;if(n){lv.init.done(n)}};flashnavigator2.container=function(e,t,i){viewerContainer=$("#"+t);if(["absolute","relative","fixed"].indexOf(viewerContainer.css("position"))===-1){viewerContainer.css("position","relative")}this.initViewer(e.mode,e,t);lv.onViewerLoad=i;lv.init.done(function(){lv.setZIndex(2);init();lv.onViewerLoad.onLoad()})};units=new Array;units_label=new Array;var mtopx=3779.527559055;units["meter"]=mtopx;units_label["meter"]="m";units["kilometer"]=mtopx*1e3;units_label["kilometer"]="km";units["centimeter"]=mtopx*.01;units_label["centimeter"]="cm";units["degree"]=mtopx*111319.49079327357;units_label["degree"]="°";units["foot"]=mtopx*.3048;units_label["foot"]="ft";units["foot_us"]=mtopx*.30480061;units_label["foot_us"]="ft";units["mile"]=mtopx*1609.344;units_label["mile"]="m";units["inch"]=mtopx*.0254;units_label["mile"]='"';units["yard"]=mtopx*.9144;units["link_ben"]=mtopx*.201167651;units["link_srs"]=mtopx*.201167651;units["ind_yard"]=mtopx*.914398554;units["srs_yard"]=mtopx*.914398415;units["fathom"]=mtopx*1.8288;unitFactor=units["meter"];unit="meter";function calculateImageColor(e){try{var t=e.icon_image;var i=document.createElement("canvas");i.width=t.width;i.height=t.height;var n=i.getContext("2d",flashnavigator.canvasOptions);n.drawImage(t,0,0);var r=n.getImageData(0,0,i.width,i.height);var a=r.data;var s=0,o=0,l=0;var c=0;for(var u=0,d=a.length;u<d;u+=4){if(a[u+3]>0){s+=a[u];o+=a[u+1];l+=a[u+2];c++}}return giscloud.Color.rgbToHex(Math.floor(s/c),Math.floor(o/c),Math.floor(l/c))}catch(e){return giscloud.Color.rgbToHex(255,255,255)}}function loadGeneratedSymbol(e,t){var i,n,r,a,s;s=parseInt(t.bw)*flashnavigator.scaleRatio;a=parseInt(t.size)*flashnavigator.scaleRatio;if(isNaN(s)){s=0}if(t.type==="circle")a+=4*flashnavigator.scaleRatio;else if(t.type==="box")a+=s*flashnavigator.scaleRatio;r=a+s*2;i=document.createElement("canvas");i.width=r;i.height=r;n=i.getContext("2d",flashnavigator.canvasOptions);n.beginPath();if(t.type==="circle"){n.arc(r/2,r/2,Math.ceil(a/2)+s/2-2,0,2*Math.PI,false)}else if(t.type==="box"){n.rect(s,s,a,a)}n.fillStyle="rgb("+t.color+")";n.fill();if(s>0){n.lineWidth=s;n.strokeStyle="rgb("+t.border+")";n.stroke()}e.generated=true;e.src=i.toDataURL()}function loadSymbol(e,t){var i,n=null,r;i=decodeURIComponent(t);if(i.match(/.*\/assets\/icon.php\?.*p=\/icons\/defaulticon.png/)){n={bw:1,size:7,type:"circle",color:"255, 51, 0",border:"0,0,0"}}else if(i.match(/.*\/assets\/icon.php\?.*type=.*size=/)){r=i.split("?")[1].split("&");n={};r.forEach(function(e){e=e.split("=");n[e[0]]=e[1]});if(n.type!=="circle"&&n.type!=="box"){n=null}}if(n){loadGeneratedSymbol(e,n)}else{e.crossOrigin="Anonymous";e.src=t}}flashnavigator=flashnavigator2;flashnavigator.html5Compatible=true;flashnavigator.hasCanvas=true;flashnavigator.hasCanvasInitialValue=flashnavigator.hasCanvas;flashnavigator.ready=function(){flashnavigator.legacyObjects.fnLayer=fnLayer2;flashnavigator.legacyObjects.fnMarker=fnMarker2;flashnavigator.legacyObjects.fnAgent=fnAgent2;flashnavigator.legacyObjects.fnCanvas=fnCanvas2;flashnavigator.legacyObjects.fnPrinter=fnPrinter2;flashnavigator.legacyObjects.fnBitmap=fnBitmap2;flashnavigator.legacyObjects.fnTooltip=fnTooltip2;flashnavigator.legacyObjects.fnSlider=fnSlider2;flashnavigator.legacyObjects.fnKartehr=function(){this.liveSite=function(){}}};flashnavigator.legacyObjects.fnViewer=fnViewer2;flashnavigator.html5Enabled=true;flashnavigator.exposeLegacyObjectsInto=function e(t){var i,n=t||{};for(i in this.legacyObjects){n[i]=this.legacyObjects[i]}return n}})(window,giscloud.exposeJQuery(),gcCommon());return flashnavigator}})(window,giscloud,giscloud.common);(function(e,t){giscloud.rest={get:e.proxy(t.rest.get,t.rest)}})(giscloud.exposeJQuery(),giscloud.common());(function(s,o,l,c){var e,u,d,h,f,p,n,g,r,m=false,a=false,t=false;try{t=s!==s.parent&&s.parent.giscloud&&s.parent.giscloud.oauth2&&s.name===s.parent.giscloud.oauth2.frameId()}catch(e){}if(t){if(document.location.search.indexOf("error=redirect_uri_mismatch")>-1){s.parent.giscloud.oauth2.uriMismatch(document.location)}else{e=document.location.href.match(/access_token=(\w+)/);u=e&&e[1];s.parent.giscloud.oauth2.setToken(u,document.location)}}else if(document.location.search.indexOf("error=redirect_uri_mismatch")>-1){s.parent.giscloud.oauth2.uriMismatch(document.location)}else{d=l.authHost();giscloud.oauth2={token:function(e){if(e){u=e;return this}else{return u}},frameId:function(){return g},authorize:function(e,t,i){var n,r,a=l.oid();h=t;if(!m){giscloud.includeCss(l.apiHost()+"/assets/api/1/auth.css");m=true}if(u===c||u===null){f="win_"+a;g="frame_"+f;r=(s.location.protocol=="https:"?"https:":"http:")+"//"+s.location.hostname+s.location.pathname;p=d+"/oauth/authorize?client_id="+e+"&redirect_uri="+r+"?nch="+Math.random()+"&response_type=token&fr="+g;n=o('<iframe name="'+g+'" id="'+g+'" style="position:absolute;visibility:hidden;width:1px;height:1px;"></iframe>');if(i!==c){n.one("load",i)}o("body").append(n);n.attr("src",p+"&authorize=true")}return this},signIn:function(e){var t,i;e=e||{};if(typeof e.template==="string"){i=p+"&template="+e.template}else{i=p}t="status=1, toolbar=1,  width=450, height=400";n=s.open(i,f,t)},signOut:function(e){var t,i;t=o("#"+g);i=new o.Deferred;if(typeof e=="function"){i.done(e)}u=null;t.one("load",function(){i.resolve()});t.attr("src",d+"/oauth/sign_out?redirect_uri="+s.location.href);return i.promise()},setToken:function(e,t){u=e;if(n){n.close();n=null}if(typeof h=="function"){h(u)}if(t){t.href=d+"/oauth/blank"}this.button(r)},uriMismatch:function(e){a=true;if(e){e.href=d+"/oauth/blank"}if(typeof h=="function"){h()}},thisIsOauthFrame:function(){return t},button:function(e,t){var i,n;r=e;i=o("<div/>",{class:"gc-auth-button"});if(a){i.addClass("gc-redirect-uri-mismatch");i.append("This is not a registered<br/>GIS Cloud app.")}else if(u){i.addClass("gc-authorized");i.append("You are signed in. <a href='#'>Sign out.</a>");i.click(function(e){giscloud.oauth2.signOut();e.preventDefault()})}else{i.click(function(e){giscloud.oauth2.signIn(t);e.preventDefault()})}if(e){n=o("#"+e);if(n.length){n.html("");n.append(i)}return this}else{return i}}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(a){giscloud.LonLat=function(e,t){if(e instanceof giscloud.LonLat){this.lon=e.lon;this.lat=e.lat}else{this.lon=isNaN(e)?null:e;this.lat=isNaN(t)?null:t}};giscloud.LonLat.prototype={toArray:function(){return[this.lon,this.lat]},toString:function(e){var t;if(e!==undefined){t=Math.pow(10,e);return Math.round(this.lon*t)/t+", "+Math.round(this.lat*t)/t}else{return this.lon+", "+this.lat}},clone:function(){return new giscloud.LonLat(this)},transform:function(e,t){var i,n,r;if(!giscloud.proj4){console.warn("Proj4js library is missing.");return this}if(typeof e==="number"){n="EPSG:"+e}else{n=e}if(!n){console.warn("Source projection is not ready to use.",n);return this}if(typeof t==="number"){r="EPSG:"+t}else{r=t}if(!r){console.warn("Destination projection is not ready to use.",r);return this}i={x:this.lon,y:this.lat},i=giscloud.proj4(n,r,i);this.lon=i.x;this.lat=i.y;return this},toBounds:function(e){e=isNaN(e)||e===null?0:e;return new giscloud.Bounds(this.lon-e,this.lat-e,this.lon+e,this.lat+e)},equals:function(e){return e instanceof giscloud.LonLat&&this.lon===e.lon&&this.lat===e.lat},valid:function(){return!(isNaN(this.lon)||isNaN(this.lat))}};giscloud.LonLat.parse=function(e){var t;if(typeof e==="string"){t=e.split(",");if(t.length===2){return new giscloud.LonLat(parseFloat(t[0]),parseFloat(t[1]))}}return null};giscloud.Bounds=function(e,t,i,n){var r;if(e instanceof giscloud.Bounds){this.left=e.left;this.bottom=e.bottom;this.right=e.right;this.top=e.top}else if(a.isArray(e)&&e.length){r=giscloud.Bounds.fromBounds(e);if(!r.valid())return;this.left=r.left;this.bottom=r.bottom;this.right=r.right;this.top=r.top}else{this.left=typeof e==="number"?e:parseFloat(e);this.bottom=typeof t==="number"?t:parseFloat(t);this.right=typeof i==="number"?i:parseFloat(i);this.top=typeof n==="number"?n:parseFloat(n)}};giscloud.Bounds.prototype={width:function(e,t){var i,n,r;if(e==null){if(isFinite(this.left)&&isFinite(this.right)){return Math.abs(this.right-this.left)}else{return null}}if(isFinite(this.left)&&isFinite(this.right)){i=Math.abs(this.right-this.left);n=(e-i)/2;this.left=this.left-n;this.right=this.right+n;if(t){r=this.height();this.height(r*e/i)}}return this},height:function(e,t){var i,n,r;if(e==null){if(isFinite(this.top)&&isFinite(this.bottom)){return Math.abs(this.top-this.bottom)}else{return null}}if(isFinite(this.top)&&isFinite(this.bottom)){i=Math.abs(this.top-this.bottom);n=(e-i)/2;this.bottom=this.bottom-n;this.top=this.top+n;if(t){r=this.width();this.width(r*e/i)}}return this},center:function(e){var t,i,n,r,a;if(this.isPoint()){if(e==null){return new giscloud.LonLat(this.left,this.bottom)}else{this.left=this.right=e.lon;this.top=this.bottom=e.lat;return this}}else{t=this.width();i=this.height();n=new giscloud.LonLat(this.left+t/2,this.bottom+i/2);if(e==null){return n}else{r=e.lon-n.lon;a=e.lat-n.lat;this.left+=r;this.right+=r;this.top+=a;this.bottom+=a;return this}}},isPoint:function(){return this.left===this.right&&this.top===this.bottom},valid:function(){return!(isNaN(this.left)||isNaN(this.bottom)||isNaN(this.right)||isNaN(this.top))},include:function(e,t){t=isNaN(t)||t===null?0:t;if(e instanceof giscloud.LonLat){this.left=Math.min(e.lon-t,this.left);this.bottom=Math.min(e.lat-t,this.bottom);this.right=Math.max(e.lon+t,this.right);this.top=Math.max(e.lat+t,this.top)}else if(e instanceof giscloud.Bounds){this.left=Math.min(e.left-t,this.left);this.bottom=Math.min(e.bottom-t,this.bottom);this.right=Math.max(e.right+t,this.right);this.top=Math.max(e.top+t,this.top)}return this},clone:function(){return new giscloud.Bounds(this)},toArray:function(){return[this.left,this.bottom,this.right,this.top]},toString:function(e){var t;if(e!==undefined){t=Math.pow(10,e);return Math.round(this.left*t)/t+", "+Math.round(this.bottom*t)/t+Math.round(this.right*t)/t+", "+Math.round(this.top*t)/t}else{return this.left+", "+this.bottom+", "+this.right+", "+this.top}}};giscloud.Bounds.parse=function(e){var t;if(typeof e==="string"){t=e.split(",");if(t.length===4){return new giscloud.Bounds(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))}}return null};giscloud.Bounds.fromBounds=function(e){var t,i,n;if(!e)return new giscloud.Bounds;if(e instanceof giscloud.Bounds)return new giscloud.Bounds(e);if(a.isArray(e)){n=new giscloud.Bounds;for(t=0,i=e.length;t<i;t++){if(!n.valid()){n=new giscloud.Bounds(e[t])}else{n.left=Math.min(n.left,e[t].left);n.bottom=Math.min(n.bottom,e[t].bottom);n.right=Math.max(n.right,e[t].right);n.top=Math.max(n.top,e[t].top)}}return n}return new giscloud.Bounds(e.left,e.bottom,e.right,e.top)}})(giscloud.exposeJQuery());(function(){var e;giscloud.geometry={Point:function(e,t,i){this.x=e;this.y=t;if(i!=null){this.z=i}},Multipoint:function(e){this.points=e},Line:function(e){this.points=e},Multiline:function(e){this.lines=e},Polygon:function(e){this.rings=e},Multipolygon:function(e){this.polygons=e},GeometryCollection:function(e){this.geometries=e},hasZ:function(e){var t,i;if(e instanceof giscloud.geometry.Point&&e.x!=null&&e.y!=null){return e.z!=null}else if(e instanceof giscloud.geometry.Multipoint&&e.points!=null){for(t=0,i=e.points.length;t<i;t++){if(e.points[t].hasZ()){return true}}return false}else if(e instanceof giscloud.geometry.Line&&e.points!=null){for(t=0,i=e.points.length;t<i;t++){if(e.points[t].hasZ()){return true}}return false}else if(e instanceof giscloud.geometry.Multiline&&e.lines!=null){for(t=0,i=e.lines.length;t<i;t++){if(e.lines[t].hasZ()){return true}}return false}else if(e instanceof giscloud.geometry.Polygon&&e.rings!=null){for(t=0,i=e.rings.length;t<i;t++){if(e.rings[t].hasZ()){return true}}return false}else if(e instanceof giscloud.geometry.Multipolygon&&e.polygons!=null){for(t=0,i=e.polygons.length;t<i;t++){if(e.polygons[t].hasZ()){return true}}return false}else if(e instanceof giscloud.geometry.GeometryCollection&&e.geometries!=null){for(t=0,i=e.geometries.length;t<i;t++){if(e.geometries[t].hasZ()){return true}}return false}else{return null}},toOGC:function(e,t){var i,n,r,a,s,o,l,c,u,d,h,f;i=function(e){return t||e.z==null?e.x+" "+e.y:e.x+" "+e.y+" "+e.z};n=function(e){return e.join()};r=function(e){return e.join()};try{if(e instanceof giscloud.geometry.Point&&e.x!=null&&e.y!=null){return"POINT ("+i(e)+")"}else if(e instanceof giscloud.geometry.Multipoint&&e.points!=null){a=[];for(l=0,u=e.points.length;l<u;l++){a.push("("+i(e.points[l])+")")}return"MULTIPOINT ("+a.join()+")"}else if(e instanceof giscloud.geometry.Line&&e.points!=null){a=[];for(l=0,u=e.points.length;l<u;l++){a.push(i(e.points[l]))}return"LINESTRING ("+n(a)+")"}else if(e instanceof giscloud.geometry.Multiline&&e.lines!=null){a=[];for(l=0,u=e.lines.length;l<u;l++){s=[];for(c=0,d=e.lines[l].points.length;c<d;c++){s.push(i(e.lines[l].points[c]))}a.push("("+n(s)+")")}return"MULTILINESTRING ("+n(a)+")"}else if(e instanceof giscloud.geometry.Polygon&&e.rings!=null){a=[];for(l=0,u=e.rings.length;l<u;l++){s=[];for(c=0,d=e.rings[l].points.length;c<d;c++){s.push(i(e.rings[l].points[c]))}s.push(i(e.rings[l].points[0]));a.push("("+n(s)+")")}return"POLYGON ("+r(a)+")"}else if(e instanceof giscloud.geometry.Multipolygon&&e.polygons!=null){a=[];for(l=0,d=e.polygons.length;l<d;l++){s=[];for(c=0,h=e.polygons[l].rings.length;c<h;c++){o=[];for(u=0,f=e.polygons[l].rings[c].points.length;u<f;u++){o.push(i(e.polygons[l].rings[c].points[u]))}o.push(i(e.polygons[l].rings[c].points[0]));s.push("("+n(o)+")")}a.push("("+r(s)+")")}return"MULTIPOLYGON ("+a.join()+")"}else if(e instanceof giscloud.geometry.GeometryCollection&&e.geometries!=null){a=[];for(l=0,d=e.geometries.length;l<d;l++){a.push(e.geometries[l].toOGC())}return"GEOMETRYCOLLECTION ("+a.join()+")"}else{return null}}catch(e){return null}},fromOGC:function(e){var n,t,i,r,a,s,o,l,c,u,d,h,f,p,g,m,v,y;r=/^([A-Z]+(?:\s*Z\s*)?)\s?(\([A-Ze\d.,()\s\-]*\))$/;a=e&&e.match&&e.match(r);s=a&&a[1];if(/Z\s*$/.test(s)){s=s.replace(/\s*Z\s*$/,"");i=true}o=a&&a[2]&&a[2].replace(/\s+/g," ").replace(/, /g,",");if(s==null||o==null){return null}if(s==="GEOMETRYCOLLECTION"){a=o.match(/([A-Z]+\s?\([\-\d.e,( )]*\))(?=\s?,|\s?\)\s?$)/g);if(a===null){return[]}l=[];for(n=0,t=a.length;n<t;n++){l.push(giscloud.geometry.fromOGC(a[n]))}return new giscloud.geometry.GeometryCollection(l)}o=o.replace(/([\d.e\-]+ [\d.e\-]+( [\d.e\-]+)?)/g,"[$1]");l=[];n=0;g=function(){var e,t=[""],i=0;while(true){n++;e=o[n];if(e==="]"){break}else if(e===" "){t.push("");i++;if(i>2){throw"Error parsing wkt: invalid value"}}else{t[i]+=e}}return t.length===3?[parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])]:[parseFloat(t[0]),parseFloat(t[1])]};p=function(){var e,t=[];while(n<o.length){n++;e=o[n];switch(e){case"(":t.push(p());break;case",":break;case")":return t;case"[":t.push(g());break;default:throw"Error parsing wkt: invalid structure"}}return t};c=a&&p();if(c.length<1){throw"Error parsing wkt: invalid geometry"}m=function(e){if(i&&e.length!==3){throw"Error parsing wkt: invalid geometry"}if(e.length!==2&&e.length!==3){throw"Error parsing wkt: invalid geometry"}return new giscloud.geometry.Point(e[0],e[1],e[2])};v=function(e,t){var i,n,r;if(e.length===0){throw"Error parsing wkt: invalid geometry"}i=[];for(n=0,r=e.length-(t?1:0);n<r;n++){i.push(m(e[n]))}return new giscloud.geometry.Line(i)};y=function(e){var t,i,n;if(e.length===0){throw"Error parsing wkt: invalid geometry"}t=[];for(i=0,n=e.length;i<n;i++){t.push(v(e[i]))}return new giscloud.geometry.Polygon(t)};switch(s){case"POINT":if(c.length>1){throw"Error parsing wkt: invalid point geometry"}return m(c[0]);case"MULTIPOINT":d=[];for(n=0,t=c.length;n<t;n++){if(c[n].length===2||c[n].length===3){d.push(m(c[n]))}else if(c[n].length===1){d.push(m(c[n][0]))}else{throw"Error parsing wkt: invalid geometry"}}return new giscloud.geometry.Multipoint(d);case"LINESTRING":return v(c);case"MULTILINESTRING":h=[];for(n=0,t=c.length;n<t;n++){h.push(v(c[n]))}return new giscloud.geometry.Multiline(h);case"POLYGON":return y(c);case"MULTIPOLYGON":f=[];for(n=0,t=c.length;n<t;n++){f.push(y(c[n]))}return new giscloud.geometry.Multipolygon(f);default:throw"Error parsing wkt: unknown geometry type"}return u},fromGeoJSON:function(e){if(typeof e=="string"){e=JSON.parse(e)}switch(e.type){case"Point":return e.coordinates.length===3?new giscloud.geometry.Point(e.coordinates[0],e.coordinates[1],e.coordinates[2]):new giscloud.geometry.Point(e.coordinates[0],e.coordinates[1]);case"LineString":return new giscloud.geometry.Line($.map(e.coordinates,function(e){return e.length===3?new giscloud.geometry.Point(e[0],e[1],e[2]):new giscloud.geometry.Point(e[0],e[1])}));case"Polygon":return new giscloud.geometry.Polygon($.map(e.coordinates,function(e){return new giscloud.geometry.Line($.map(e,function(e){return e.length===3?new giscloud.geometry.Point(e[0],e[1],e[2]):new giscloud.geometry.Point(e[0],e[1])}))}));default:return null}}};giscloud.Geometry=e=function(){};e.prototype={bounds:function(e){var t,i,n,r;e=e||0;if(this.x&&this.y){return new giscloud.Bounds(this.x-e,this.y-e,this.x+e,this.y+e)}n=this.points||this.lines||this.rings||this.polygons||this.geometries;if(!n||!n.length)return null;r=n[0].bounds();for(t=1,i=n.length;t<i;t++){r.include(n[t].bounds())}return r},toOGC:function(){return giscloud.geometry.toOGC(this)},hasZ:function(){return giscloud.geometry.hasZ(this)}};giscloud.geometry.Point.prototype=new e;giscloud.geometry.Multipoint.prototype=new e;giscloud.geometry.Line.prototype=new e;giscloud.geometry.Multiline.prototype=new e;giscloud.geometry.Polygon.prototype=new e;giscloud.geometry.Multipolygon.prototype=new e;giscloud.geometry.GeometryCollection.prototype=new e})();(function(w){giscloud.Color=function(e,t,i,n){var r,a,s,o,l,u,d,h,f,p,g,m,v,y,_,b;if(e!==w&&typeof e=="number"){if(e>255){r=255}else if(e<0){r=0}else{r=Math.round(e)}v=true;y=true;b=true}else{_=true}if(t!==w&&typeof t=="number"){if(t>255){a=255}else if(t<0){a=0}else{a=Math.round(t)}v=true;y=true;b=true}else{_=true}if(i!==w&&typeof i=="number"){if(i>255){s=255}else if(i<0){s=0}else{s=Math.round(i)}v=true;y=true;b=true}else{_=true}if(n!==w&&typeof n=="number"){if(n>100){o=100}else if(n<0){o=0}else{o=Math.round(n)}}else{o=100}v=true;y=true;b=true;this.hex=function(){var e=arguments[0],t=/^((#)|(0x))?([a-f0-9]{3}$)|([a-f0-9]{6}$)/i,i;if(e&&typeof e=="string"){if(e.match(t)){i=giscloud.Color.hexToRgb(e);r=i[0];a=i[1];s=i[2];v=true;y=true;b=true;return this}else{return giscloud.Color.rgbToHex(this.rgb(),e)}}else{return giscloud.Color.rgbToHex(this.rgb(),e)}};this.rgb=function(){var e,t;if(arguments.length>0){for(e=0;e<3;e++){t=arguments[e];if(t!==w&&t!==null&&typeof t=="number"){if(t>255){t=255}else if(t<0){t=0}else{t=Math.round(t)}switch(e){case 0:r=t;break;case 1:a=t;break;case 2:s=t;break}v=true;y=true;b=true}}return this}else{if(_){if(!v){t=giscloud.Color.hslToRgb(l,u,h)}else if(!y){t=giscloud.Color.hsvToRgb(l,d,f)}else if(!b){t=giscloud.Color.labToRgb(p,g,m)}r=t[0];a=t[1];s=t[2];_=false}return[r,a,s]}};this.rgba=function(){if(arguments.length>0){this.rgb.apply(this,Array.prototype.slice(arguments));if(arguments[3]!=null){this.alpha(arguments[3])}return this}if(_){if(!v){c=giscloud.Color.hslToRgb(l,u,h)}else if(!y){c=giscloud.Color.hsvToRgb(l,d,f)}else if(!b){c=giscloud.Color.labToRgb(p,g,m)}r=c[0];a=c[1];s=c[2];_=false}return[r,a,s,o]};this.hsl=function(e){var t,i;if(arguments.length===3){for(t=0;t<3;t++){i=arguments[t];if(i!==w&&i!==null&&typeof i=="number"){if(t===0){if(i>=360){i-=360}else if(i<0){i+=360}else{i=Math.round(i)}l=i}else{if(i>100){i=100}else if(i<0){i=0}if(t===1){u=i}else{h=i}}_=true;y=true;b=true}}v=false;return this}else{if(v){if(!_){i=giscloud.Color.rgbToHsl(r,a,s)}else if(!y){i=giscloud.Color.hsvToHsl(l,d,f)}else if(!b){i=giscloud.Color.labToHsl(p,g,m)}l=i[0];u=i[1];h=i[2];v=false}if(e){return[Math.round(l),Math.round(u),Math.round(h)]}else{return[l,u,h]}}};this.hsv=function(e){var t,i;if(arguments.length===3){for(t=0;t<3;t++){i=arguments[t];if(i!==w&&i!==null&&typeof i=="number"){if(t===0){if(i>=360){i-=360}else if(i<0){i+=360}else{i=Math.round(i)}l=i}else{if(i>100){i=100}else if(i<0){i=0}if(t===1){d=i}else{f=i}}_=true;v=true;b=true}}y=false;return this}else{if(y){if(!_){i=giscloud.Color.rgbToHsv(r,a,s)}else if(!v){i=giscloud.Color.hslToHsv(l,u,h)}else if(!b){i=giscloud.Color.labToRgb(p,g,m)}l=i[0];d=i[1];f=i[2];y=false}if(e){return[Math.round(l),Math.round(d),Math.round(f)]}else{return[l,d,f]}}};this.lab=function(e){var t,i;if(arguments.length===3){for(t=0;t<3;t++){i=arguments[t];if(i!==w&&i!==null&&typeof i=="number"){if(t===0){p=i}else if(t===1){g=i}else{m=i}_=true;v=true;y=true}}b=false;return this}else{if(b){if(!_){i=giscloud.Color.rgbToLab(r,a,s)}else if(!v){i=giscloud.Color.hslToLab(l,u,h)}else if(!y){i.giscloud.Color.hsvToLab(l,d,f)}p=i[0];g=i[1];m=i[2];b=false}if(e){return[Math.round(p),Math.round(g),Math.round(m)]}else{return[p,g,m]}}};this.alpha=function(e){if(e!==w&&typeof e=="number"){if(e>100){o=100}else if(e<0){o=0}else{o=Math.round(e)}}else{return o}};this.clone=function(){var e=this.rgba();return new giscloud.Color(e[0],e[1],e[2],e[3])}};giscloud.Color.prototype={brighter:function e(t){var i=this.hsl();t=t||20;return giscloud.Color.fromHsl(i[0],i[1],i[2]+t)},darker:function e(t){var i=this.hsl();t=t||20;return giscloud.Color.fromHsl(i[0],i[1],i[2]-t)},equals:function e(t){var i,n;if(t instanceof giscloud.Color){n=t.rgb();i=this.rgb();return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&this.alpha()===t.alpha()}else{return false}},toRgbaString:function e(){return"rgba("+this.rgba().join(", ")+")"},toRgbString:function e(){return"rgb("+this.rgb().join(", ")+")"}};giscloud.Color.fromRgb=function(e,t,i){return new giscloud.Color(e,t,i)};giscloud.Color.fromRgb=function(e,t,i,n){return new giscloud.Color(e,t,i,n)};giscloud.Color.fromHsl=function(e,t,i){var n=new giscloud.Color;n.hsl(e,t,i);return n};giscloud.Color.fromHsv=function(e,t,i){var n=new giscloud.Color;n.hsv(e,t,i);return n};giscloud.Color.fromLab=function(e,t,i){var n=new giscloud.Color;n.lab(e,t,i);return n};giscloud.Color.fromHex=function(e){var t=giscloud.Color.hexToRgb(e);return t&&new giscloud.Color(t[0],t[1],t[2])};giscloud.Color.fromRgbString=function(e){var t=/^rgb\((\d+)[,\s]*(\d+)[,\s]*(\d+)\)$/i,i=e&&e.match&&e.match(t);if(i&&i.length===4){return new giscloud.Color(parseInt(i[1]),parseInt(i[2]),parseInt(i[3]))}else{return null}};giscloud.Color.fromRgbaString=function(e){var t=/^rgba\((\d+)[,\s]*(\d+)[,\s]*(\d+)[,\s]*(\d+)\)$/i,i=e&&e.match&&e.match(t),n;if(i&&i.length===5){n=parseInt(i[4])<1?parseInt(i[4])*100:parseInt(i[4]);return new giscloud.Color(parseInt(i[1]),parseInt(i[2]),parseInt(i[3]),n)}else{return null}};giscloud.Color.fromString=function(e){return null||giscloud.Color.fromRgbaString(e)||giscloud.Color.fromRgbString(e)||giscloud.Color.fromHex(e)};giscloud.Color.hexToRgb=function(e){var t,i,n,r;if(typeof e=="string"){r=e.match(/^(?:#|0x)?(?:([a-f0-9]{1,2})([a-f0-9]{1,2})([a-f0-9]{1,2}))$/i);if(r&&r.length===4){t=parseInt(r[1],16);i=parseInt(r[2],16);n=parseInt(r[3],16);return[t,i,n]}else{return null}}else if(typeof e=="number"){t=(e&16711680)>>16;i=(e&65280)>>8;n=e&255;return!isNaN(t+i+n)&&[t,i,n]||null}};giscloud.Color.rgbToHex=function(e,t,i,n){var r,a,s;if(e.length&&e.length===3){if(typeof t=="string"){n=t}t=e[1];i=e[2];e=e[0]}r=e>15?e.toString(16):"0"+e.toString(16);a=t>15?t.toString(16):"0"+t.toString(16);s=i>15?i.toString(16):"0"+i.toString(16);if(n===w||n===null){n="#"}return n+r+a+s};giscloud.Color.rgbToHsl=function(e,t,i){var n,r,a,s,o,l,c,u,d,h;if(e.length&&e.length===3){n=e[0]/255;r=e[1]/255;a=e[2]/255}else{n=e/255;r=t/255;a=i/255}s=Math.min(n,r,a);o=Math.max(n,r,a);l=o-s;c=o+s;h=c/2;if(l===0){u=0;d=0}else{switch(o){case n:u=(r-a)/l;break;case r:u=2+(a-n)/l;break;case a:u=4+(n-r)/l;break}u=Math.min(Math.round(u*60),360);u=u<0?u+360:u;if(h<=.5){d=l/c}else{d=l/(2-c)}}return[u,d*100,h*100]};giscloud.Color.hslToRgb=function(e,t,i){var n,r,a,s,o,l,c,u,d;if(e.length&&e.length===3){c=e[0]/360;u=e[1]/100;d=e[2]/100}else{c=e/360;u=t/100;d=i/100}if(u===0){n=r=a=Math.round(d*255);return[n,r,a]}else{o=d<.5?d*(1+u):d+u-d*u;s=2*d-o;l=function(e,t,i){var n;if(i<0){i=i+1}else if(i>1){i=i-1}if(6*i<1){n=e+(t-e)*6*i}else if(2*i<1){n=t}else if(3*i<2){n=e+(t-e)*(2/3-i)*6}else{n=e}return n};n=l(s,o,c+1/3);r=l(s,o,c);a=l(s,o,c-1/3);return[Math.round(n*255),Math.round(r*255),Math.round(a*255)]}};giscloud.Color.rgbToHsv=function(e,t,i){var n,r,a,s,o,l,c,u,d;if(e.length&&e.length===3){n=e[0];r=e[1];a=e[2]}else{n=e;r=t;a=i}s=Math.min(n,r,a);o=Math.max(n,r,a);l=o-s;if(o===0){u=0}else{u=l/o*100}if(l===0){c=0}else{switch(o){case n:c=(r-a)/l;break;case r:c=2+(a-n)/l;break;case a:c=4+(n-r)/l;break}c=Math.min(Math.round(c*60),360);c=c<0?c+360:c}d=o/255*100;return[c,u,d]};giscloud.Color.hsvToRgb=function(e,t,i){var n,r,a,s,o,l,c,u;if(e.length&&e.length===3){l=e[0];c=e[1]/100;u=e[2]/100}else{l=e;c=t/100;u=i/100}o=Math.floor(l/60)%6;n=l/60-Math.floor(l/60);r=Math.round(255*u*(1-c));a=Math.round(255*u*(1-c*n));s=Math.round(255*u*(1-c*(1-n)));u=Math.round(255*u);switch(o){case 0:return[u,s,r];case 1:return[a,u,r];case 2:return[r,u,s];case 3:return[r,a,u];case 4:return[s,r,u];case 5:return[u,r,a]}};giscloud.Color.hslToHsv=function(e,t,i){var n,r,a;if(e.length&&e.length===3){n=e[0];r=e[1];a=e[2]}else{n=e;r=t;a=i}return giscloud.Color.rgbToHsv(giscloud.Color.hslToRgb(n,r,a))};giscloud.Color.hsvToHsl=function(e,t,i){var n,r,a;if(e.length&&e.length===3){n=e[0];r=e[1];a=e[2]}else{n=e;r=t;a=i}return giscloud.Color.rgbToHsl(giscloud.Color.hsvToRgb(n,r,a))};giscloud.Color.hsvToLab=function(e,t,i){var n,r,a;if(e.length&&e.length===3){n=e[0];r=e[1];a=e[2]}else{n=e;r=t;a=i}return giscloud.Color.rgbToLab(giscloud.Color.hsvToRgb(n,r,a))};giscloud.Color.hslToLab=function(e,t,i){var n,r,a;if(e.length&&e.length===3){n=e[0];r=e[1];a=e[2]}else{n=e;r=t;a=i}return giscloud.Color.rgbToLab(giscloud.Color.hslToRgb(n,r,a))};giscloud.Color.rgbToXyz=function(e,t,i){var n,r,a,s,o,l;if(e.length&&e.length===3){n=e[0]/255;r=e[1]/255;a=e[2]/255}else{n=e/255;r=t/255;a=i/255}if(n>.04045){n=Math.pow((n+.055)/1.055,2.4)}else{n=n/12.92}if(r>.04045){r=Math.pow((r+.055)/1.055,2.4)}else{r=r/12.92}if(a>.04045){a=Math.pow((a+.055)/1.055,2.4)}else{a=a/12.92}n=n*100;r=r*100;a=a*100;s=n*.4124+r*.3576+a*.1805;o=n*.2126+r*.7152+a*.0722;l=n*.0193+r*.1192+a*.9505;return[s,o,l]};giscloud.Color.xyzToRgb=function(e,t,i){var n,r,a;if(e.length&&e.length===3){t=e[1]/100;i=e[2]/100;e=e[0]/100}else{e=e/100;t=t/100;i=i/100}n=e*3.2406+t*-1.5372+i*-.4986;r=e*-.9689+t*1.8758+i*.0415;a=e*.0557+t*-.204+i*1.057;if(n>.0031308){n=1.055*Math.pow(n,1/2.4)-.055}else{n=12.92*n}if(r>.0031308){r=1.055*Math.pow(r,1/2.4)-.055}else{r=12.92*r}if(a>.0031308){a=1.055*Math.pow(a,1/2.4)-.055}else{a=12.92*a}n=n*255;r=r*255;a=a*255;return[n,r,a]};giscloud.Color.labToXyz=function(e,t,i){var n,r,a;if(e.length&&e.length===3){t=e[1];i=e[2];e=e[0]}r=(e+16)/116;n=t/500+r;a=r-i/200;if(r*r*r>.008856){r=r*r*r}else{r=(r-16/116)/7.787}if(n*n*n>.008856){n=n*n*n}else{n=(n-16/116)/7.787}if(a*a*a>.008856){a=a*a*a}else{a=(a-16/116)/7.787}n=95.047*n;r=100*r;a=108.883*a;return[n,r,a]};giscloud.Color.xyzToLab=function(e,t,i){var n,r,a;if(e.length&&e.length===3){t=e[1];i=e[2];e=e[0]}e=e/95.047;t=t/100;i=i/108.883;if(e>.008856){e=Math.pow(e,1/3)}else{e=7.787*e+16/116}if(t>.008856){t=Math.pow(t,1/3)}else{t=7.787*t+16/116}if(i>.008856){i=Math.pow(i,1/3)}else{i=7.787*i+16/116}n=116*t-16;r=500*(e-t);a=200*(t-i);return[n,r,a]};giscloud.Color.rgbToLab=function(e,t,i){var n=giscloud.Color.rgbToXyz(e,t,i);return giscloud.Color.xyzToLab(n)};giscloud.Color.labToRgb=function(e,t,i){var n=giscloud.Color.labToXyz(e,t,i);return giscloud.Color.xyzToRgb(n)};giscloud.Color.labToHsl=function(e,t,i){var n=giscloud.Color.labToXyz(e,t,i);return giscloud.Color.rgbToHsl(giscloud.Color.xyzToRgb(n))};giscloud.Color.labToHsl=function(e,t,i){var n=giscloud.Color.labToXyz(e,t,i);return giscloud.Color.rgbToHsv(giscloud.Color.xyzToRgb(n))};giscloud.Color.randomHue=function(e,t){return giscloud.Color.fromHsv(Math.round(Math.random()*360),e,t)};giscloud.Color.range=function(e,t,i,n){var r,a,s,o,l,c,u,d,h=[];if(e instanceof giscloud.Color&&t instanceof giscloud.Color&&i>=2){if(i===2){return[e.clone(),t.clone()]}else{u=[];c=(n||"hsl cw").match(/^((\w+)?\s)?(ccw$|cw$)/);if(c){n=c[2]||"hsl";d=c[3]}else{d="cw"}if(n==="rgb"){a=e.rgba();s=t.rgba();u=[(s[0]-a[0])/(i-1),(s[1]-a[1])/(i-1),(s[2]-a[2])/(i-1),(s[3]-a[3])/(i-1)]}else{if(n==="hsv"){a=e.hsv();s=t.hsv()}else{a=e.hsl();s=t.hsl()}a.push(e.alpha());s.push(t.alpha());if(d==="cw"){u=[s[0]>=a[0]?(s[0]-a[0])/(i-1):(360-a[0]+s[0])/(i-1),(s[1]-a[1])/(i-1),(s[2]-a[2])/(i-1),(s[3]-a[3])/(i-1)]}else{u=[s[0]<a[0]?(s[0]-a[0])/(i-1):(s[0]-a[0]-360)/(i-1),(s[1]-a[1])/(i-1),(s[2]-a[2])/(i-1),(s[3]-a[3])/(i-1)]}}l=[a[0],a[1],a[2],a[3]];for(r=0;r<i;r++){if(n==="rgb"){h.push(new giscloud.Color(l[0],l[1],l[2],l[3]))}else if(n==="hsv"){o=new giscloud.Color.fromHsv(l[0],l[1],l[2]);o.alpha(l[3]);h.push(o.clone())}else{o=new giscloud.Color.fromHsl(l[0],l[1],l[2]);o.alpha(l[3]);h.push(o.clone())}l[0]+=u[0];l[1]+=u[1];l[2]+=u[2];l[3]+=u[3]}return h}}else{return null}};giscloud.Color.hexNrToString=function(e,t){if(typeof e=="number"){return(t||"")+(16777216|e).toString(16).substr(1)}else{return null}};giscloud.Color.hexStringToNr=function(e,t){var i;if(typeof e=="string"&&e){t=t||"#";i=new RegExp("^(?:"+t+"|0x)?([a-f0-9]{3})([a-f0-9]{3})?$","i");return parseInt(e.replace(i,"$1$2"),16)}else{return NaN}};giscloud.Color.linearGradient=function(e,t,i,n){var r,a,s;if(!e||!t){console.warn("No input for linear gradient!");return null}if(typeof e!=="object"||Object.keys(e).length<2||typeof t!=="number"){console.warn("Wrong input type for linear gradient!");return null}if(!window.chroma){console.warn("No chroma library!");return null}a=Object.keys(e);if(i){a=a.reverse()}s=chroma.scale(a).domain(Object.values(e));r=s.colors(t);if(n==="rgb"){r=r.map(function(e){return giscloud.Color.hexToRgb(e)})}return r}})();(function(e,o,u,d){var n,h=new giscloud.Color(255,180,0);giscloud.FlagMarker=function(e,t,i,n){var r=t||"",a=i||"",s=n&&n instanceof giscloud.Color?n:h,o=e&&e instanceof giscloud.LonLat?e:null,l=true,c=function(){var e,t=this.sig,i;i=u.markers&&u.markers[t];if(t&&i){e=i.id;if(e!==d&&e!==null){i.m.remove(e)}if(l&&o){i.id=i.m.add(o.lon,o.lat,s.hex("0x"),r,a,null,i.open)}else{i.id=null}if(i.id&&i.initHandler){i.initHandler()}}};this.title=function(){var e;if(arguments.length>0){r=arguments[0];if(this.sig){e=u.markers[this.sig].id;if(e){u.markers[this.sig].m.setTitle(e,r)}}return this}else{return r}};this.content=function(){var e;if(arguments.length>0){a=arguments[0];if(this.sig){e=u.markers[this.sig].id;if(e){u.markers[this.sig].m.setContent(e,a)}}return this}else{return a}};this.color=function(){var e=arguments[0];if(arguments.length>0){if(e&&e instanceof giscloud.Color&&!e.equals(s)){s=e?e:h;c.call(this)}return this}else{return s}};this.visible=function(e){if(arguments.length>0){if(e!==l){l=!!e;c.call(this)}return this}else{return l}};this.position=function(){var e=arguments[0];if(arguments.length>0){if(e&&!e.equals(o)){o=e instanceof giscloud.LonLat?e:null;c.call(this)}return this}else{return o}}};giscloud.Marker=function(e,t){var i;t=t||{};i={location:e||null,title:t.title==null?null:t.title,content:t.content==null?null:t.content,visible:t.visible===false?false:true,icon:t.icon||null,label:t.label||null,rotation:t.rotation||0,popup:t.popup===true?true:false,color:t.color||h.clone(),clickable:t.clickable===false?false:true,marker:this};this.title=n.call(this,i,"title");this.content=n.call(this,i,"content");this.location=n.call(this,i,"location");this.visible=n.call(this,i,"visible");this.popup=n.call(this,i,"popup");this.icon=n.call(this,i,"icon");this.rotation=n.call(this,i,"rotation");this.label=n.call(this,i,"label");this.clickable=n.call(this,i,"clickable")};giscloud.LabelMarker=function(e,t){var i;t=t||{};i={location:e||null,content:t.content==null?null:t.content,visible:t.visible===false?false:true,marker:this};this.content=n.call(this,i,"content");this.location=n.call(this,i,"location");this.visible=n.call(this,i,"visible")};n=function(n,r,a){var s=this;return function(e,t){var i;if(e===d){return n[r]}else{if(a&&!a(e)){throw{msg:"Invalid value for "+(r||"???"),target:s}}else{i=n[r];n[r]=e;if(!t){o(s).triggerHandler("stateChanged",[{property:r,oldValue:i,newValue:e,state:n}])}return s}}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,r,t,i){"use strict";giscloud.Resource=function e(t){t=t||{};this.id=t.id;this.type=t.type!=null&&parseInt(t.type,10);this.targetId=t.target_resource_id,this.created=t.created!=null&&new Date(t.created*1e3)||null;this.modified=t.modified!=null&&new Date(t.modified*1e3)||null;this.accessed=t.access_time!=null&&new Date(t.access_time*1e3)||null;this.owner=t.owner_id};giscloud.Resource.prototype={update:function e(t){var i=this,n={type:parseInt(this.type),target_resource_id:this.targetId};if(this.id!=null)return giscloud.resources.update(this.id,n,t);return giscloud.resources.create(n,t).done(function(e){i.id=e})},remove:function e(t){return giscloud.resources.remove(this.id,t)},target:function e(t){var i=this,n;if(t!=null&&t!==true){if(t.id!=null){this.targetResourceId=t.id;this.targetResource=t}return this}if(this.targetResource&&t!==true){return this.targetResource}if(this.type===giscloud.resourceTypes.DATASOURCE)n=giscloud.datasources.byId(this.targetId);if(this.type===giscloud.resourceTypes.FEATURE_TABLE)n=giscloud.tables.byId(this.targetId);if(this.type===giscloud.resourceTypes.USER)n=giscloud.users.byId(this.targetId);if(this.type===giscloud.resourceTypes.LAYER)n=giscloud.layers.byId(this.targetId);if(this.type===giscloud.resourceTypes.MAP)n=giscloud.maps.byId(this.targetId);if(this.type===giscloud.resourceTypes.NOTIFICATION)n=giscloud.notifications.byId(this.targetId);if(this.type===giscloud.resourceTypes.STREAM)n=giscloud.streams.byId(this.targetId);if(this.type===giscloud.resourceTypes.GRAPHIC)n=giscloud.graphicFeatures.byId(this.targetId);if(n)n.done(function(e){i.targetResource=e});return n||r.Deferred().fail("Bad resource type")}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(s,o){"use strict";giscloud.resourceTypes={DATASOURCE:1,FEATURE_TABLE:2,USER:3,LAYER:4,MAP:5,PAYMENT:6,ORGANIZATION:7,APP:8,APP_INSTANCE:9,HOOK:10,ROLE:11,NOTIFICATION:12,STREAM:13,GRAPHIC:14,FILE:15};giscloud.resources={permissions:function(e,t){var i="resources/"+e+"/permission",n=new s.Deferred;o.rest.get(i,t).done(function(e){n.resolve(e)}).fail(function(){n.reject()});return n.promise()},addPermission:function(e,t){var n=new s.Deferred,r=this;o.rest.call("post","resources/"+e+"/permission",JSON.stringify(t),"application/json").done(function(e,t){var i=t&&t.match(/sharing\/(\w+)/);n.resolveWith(r,[i&&i[1]])}).fail(function(){n.rejectWith(r,arguments)});return n.promise()},removePermission:function(e,t){var i=new s.Deferred,n=this;o.rest.call("DELETE","resources/"+e+"/permission/"+t).done(function(){i.resolve()}).fail(function(){i.reject()});return i.promise()},byId:function(e,t,i){var n="resources/"+e,r=new s.Deferred,a=this;t=t||{};if(typeof t==="function"){i=t;t=null}else{i=i||t.callback}o.rest.get(n,t).done(function(){var e=arguments[0],t;try{t=e;if(typeof i=="function"){i(t)}r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject(a,arguments)});return r.promise()},update:function(e,t){var i=new s.Deferred,n=this;if(e==null){return this.create(t)}o.rest.call("PUT","resources/"+e,JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(s,o){"use strict";giscloud.addressmodels={list:function(e){var t="addressmodels.json",i=new s.Deferred;o.rest.get(t,e).done(function(e){if(e&&e.data&&e.data.length>0){var t=0;for(t;t<e.data.length;t++)e.data[t].definition=s.parseJSON(e.data[t].definition)}i.resolve(e)}).fail(function(){i.reject()});return i.promise()},create:function(e,t){var i="addressmodels.json",n=new s.Deferred,r={name:e,definition:typeof t==="string"?t:JSON.stringify(t)};o.rest.call("post",i,r,"application/json").done(function(e,t){n.resolve(t&&t.match&&t.match(/addressmodels\/(\d+)/)[1])}).fail(function(){n.reject()});return n.promise()},update:function(e,t,i){var n="addressmodels/"+e+".json",r=new s.Deferred,a={name:t,definition:typeof i==="string"?i:JSON.stringify(i)};o.rest.call("put",n,a,"application/json").then(r.resolve,r.reject);return r.promise()},remove:function(e){var t=new s.Deferred,i=this;o.rest.call("DELETE","addressmodels/"+e).done(function(){t.resolveWith(i)}).fail(function(){t.rejectWith(i,arguments)});return t.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(y){"use strict";giscloud.Queue=function(e){var a=false,s=0,o=e.slice(),l=this===giscloud?{}:this,t=new y.Deferred,c=[],i=[],u=[],d=null,h={},n=function(){return h},r=Array.prototype.slice;function f(){t.resolveWith(l,[u,i])}function p(){t.rejectWith(l,[u])}function g(){i.push(r.apply(arguments));u=i[i.length-1]}function m(){t.notifyWith(l,d!=null?[d].concat(i[s-1]):i[s-1])}function v(){var e,t,i,n,r;if(a){return}e=y.isArray(o[s].params)?u.concat(o[s].params):u,t=y.isFunction(o[s])?o[s]:o[s].func,i=y.isFunction(o[s])?l:o[s].context,n=y.isFunction(o[s])?null:o[s].msg,r=t.apply(i,e);if(r===h){f()}else{c.push(r);s++;d=n;r.always(g,m).done(v).fail(p)}}o.push(n);v();l.abort=function e(){p();a=true};l.results=function e(){return i};l.promises=function e(){return c};return t.promise(l)}})(giscloud.exposeJQuery());(function(r){"use strict";function e(e){var t,i,n;this.options=e;if(e.init){e.init.call(this)}for(t=0,i=e.triggers.length;t<i;t++){n=e.triggers[t];r(n.element).on(n.eventName,r.proxy(this.check,this))}}e.prototype={state:null,activate:function(){var e;this.state="active";if(this.options.onActivation){e=Array.prototype.slice.apply(arguments);this.options.onActivation.apply(this,e)}},deactivate:function(){var e;this.state="inactive";if(this.options.onDeactivation){e=Array.prototype.slice.apply(arguments);this.options.onDeactivation.apply(this,e)}},check:function(){var e,t=Array.prototype.slice.apply(arguments);if(this.options.check){e=this.options.check.apply(this,t);if(this.options.toggle&&this.state){if(e&&this.state!=="active"){this.activate()}else if(!e&&this.state!=="inactive"){this.deactivate()}}else{if(e){this.activate()}else{this.deactivate()}}}else{this.activate()}return e}};if(giscloud){giscloud.Relay=e}})(giscloud&&giscloud.exposeJQuery()||$||jQuery);(function(n){"use strict";var t=1.2.toLocaleString().match(/^[\d١٢۱۲]+(.+)[\d١٢۱۲]+$/)[1]||".";function r(e){if(!e||!e.replace){return e}return e.replace(/[٠١٢٣٤٥٦٧٨٩]/g,function(e){return e.charCodeAt(0)-1632}).replace(/[۰۱۲۳۴۵۶۷۸۹]/g,function(e){return e.charCodeAt(0)-1776}).replace(t,".")}function a(e,t){if(t==null){return e==null}if(e==null){return t==null||t==="null"}if(n.isArray(t)||n.isPlainObject(t)){return JSON.stringify(t)===JSON.stringify(e)}if(typeof t==="number"){return t===parseFloat(e)}if(t.toString&&e.toString){return t.toString()===e.toString()}return t===e}function s(e,t){if(typeof t==="number"){return parseFloat(e)>t}return e>t}function o(e,t){if(typeof t==="number"){return parseFloat(e)>=t}return e>=t}function l(e,t){if(typeof t==="number"){return parseFloat(e)<t}return e<t}function c(e,t){if(typeof t==="number"){return parseFloat(e)<=t}return e<=t}function u(e,t){if(e==null||e.length===0){return false}if(typeof e.indexOf==="function"){return e.indexOf(t)>-1}return false}function d(e){return e!==null&&e!==undefined&&e!==""&&(n.isArray(e)?!!e.length:true)}function i(e){return window[e.name]!=null}function h(e){var t,i=this.itemByUuid(e.name);if(!i)return false;if(!i.visible||i.visible.state==="inactive")return false;if(e.hasValue)return d(i.value);if(!e.value)return false;if(i.type==="numeric"){t=r(i.value)}else{t=i.value}if(e.value.hasOwnProperty("lessThan"))return l(t,e.value.lessThan);if(e.value.hasOwnProperty("lessThanOrEqual"))return c(t,e.value.lessThanOrEqual);if(e.value.hasOwnProperty("equals"))return a(t,e.value.equals);if(e.value.hasOwnProperty("moreThanOrEqual"))return o(t,e.value.moreThanOrEqual);if(e.value.hasOwnProperty("moreThan"))return s(t,e.value.moreThan);if(e.value.hasOwnProperty("contains"))return u(t,e.value.contains);return false}function f(e,t){var i,n;for(i=0,n=t.length;i<n;i++){if(m.call(this,e,t[i]))return true}return false}function p(e,t){var i,n;for(i=0,n=t.length;i<n;i++){if(!m.call(this,e,t[i]))return false}return true}function g(e,t){var i,n,r=0;for(i=0,n=t.length;i<n;i++){if(m.call(this,e,t[i])){r++;if(r>1)return false}}return r===1}function m(e,t){if(!t)return false;if(t.env)return i.call(this,t.env);if(t.item)return h.call(this,t.item);if(t.all)return p.call(this,e,t.all);if(t.any)return f.call(this,e,t.any);if(t.one)return g.call(this,e,t.one);if(t.none)return!f.call(this,e,t.none);return false}function v(e,t){var i;if(e==null||typeof e!=="object"){return false}if(e.hasOwnProperty(t)){return true}for(i in e){if(e.hasOwnProperty(i)&&v(e[i],t)){return true}}return false}function e(e){this.formHasDependencies=false;this.formHasItemDependencies=false;this.formHasEnvDependencies=false;this.items=[];this.itemIndex={};this.triggArray=e.triggers||[];this.items=n.map(e.formItems||[],n.proxy(function e(t,i){if(!t.uuid){t.uuid=giscloud.uuid()}this.itemIndex[t.uuid]=i;if(typeof t.active==="object"){this.formHasEnvDependencies=this.formHasEnvDependencies||v(t.active,"env");this.formHasItemDependencies=this.formHasItemDependencies||v(t.active,"item")}return t},this));this.formHasDependencies=this.formHasEnvDependencies||this.formHasItemDependencies}e.prototype.addItem=function(e){this.itemIndex[e.uuid]=this.items.length;this.items.push(e);if(typeof e.active==="object"){this.formHasEnvDependencies=this.formHasEnvDependencies||v(e.active,"env");this.formHasItemDependencies=this.formHasItemDependencies||v(e.active,"item");this.formHasDependencies=this.formHasEnvDependencies||this.formHasItemDependencies}};e.prototype.itemByUuid=function(e){return this.items[this.itemIndex[e]]};e.prototype.resolveDependency=function e(t,i){if(i==null)return true;if(!n.isPlainObject(i))return!!i;return new giscloud.Relay({init:function(){this.item=t},onActivation:function(){this.item.show&&this.item.show()},onDeactivation:function(){this.item.hide&&this.item.hide()},check:n.proxy(function(){return m.call(this,t,i)},this),triggers:this.triggArray,toggle:false})};e.prototype.check=function e(t){return m.call(this,{},t)};if(giscloud){giscloud.DependencyResolver=e}})(giscloud&&giscloud.exposeJQuery()||$||jQuery);(function(a){"use strict";var t=1.2.toLocaleString().match(/^[\d١٢۱۲]+(.+)[\d١٢۱۲]+$/)[1]||".";function n(e,t){var i;if(e==null||typeof e!=="object"){return false}if(e.all&&e.all.filter(function(e){return e.value&&e.value.type===t}).length>0){return true}return false}function s(e){if(!e||!e.replace){return e}return e.replace(/[٠١٢٣٤٥٦٧٨٩]/g,function(e){return e.charCodeAt(0)-1632}).replace(/[۰۱۲۳۴۵۶۷۸۹]/g,function(e){return e.charCodeAt(0)-1776}).replace(t,".")}function o(e,t,i,n){var r=0;if(!e||!t||!i||i.indexOf("form")<0){return true}for(r;r<this.items.length;r++){if(t.indexOf(this.items[r].def.uuid)<0){continue}if(e==this.items[r].value&&this.items[r].value){var a;var s;if(typeof n.def.title=="string"){a=n.def.title||n.def.name}else{a=n.def.title["default"]||n.def.title["en"]||n.def.name}if(typeof this.items[r].def.title=="string"){s=this.items[r].def.title||this.items[r].def.name}else{s=this.items[r].def.title["default"]||this.items[r].def.title["en"]||this.items[r].def.name}var o=a+__(" value ")+'"'+this.items[r].value+'"'+__(" exists in ")+s+".";this.messages.push({uuid:n.uuid,text:o});return false}}return true}function i(e,t){var i,n=t&&t.type,r=t&&t.among,a=t&&t.scope;if(!e){return false}if(!t){return false}if(!n){return false}if(e.type==="numeric"){i=s(e.value)}else{i=e.value}if(n==="unique"){return true}if(n==="unique-among"){return o.call(this,i,r,a,e)}return false}function r(e,t){var i,n;for(i=0,n=t.length;i<n;i++){if(!u.call(this,e,t[i])){return false}}return true}function l(e,t){var i,n;for(i=0,n=t.length;i<n;i++){if(u.call(this,e,t[i])){return true}}return false}function c(e,t){var i,n,r=0;for(i=0,n=t.length;i<n;i++){if(u.call(this,e,t[i])){r++;if(r>1){return false}}}return r===1}function u(e,t){if(!t){return true}if(t.value){return i.call(this,e,t.value)}if(t.all){return r.call(this,e,t.all)}if(t.any){return l.call(this,e,t.any)}if(t.one){return c.call(this,e,t.one)}if(t.none){return!l.call(this,e,depdef.none)}return false}function e(e){this.formHasValidation=false;this.formHasUniqueAmongValidation=false;this.items=[];this.messages=[];this.itemIndex={};this.triggArray=e.triggers||[];this.items=a.map(e.formItems||[],a.proxy(function e(t,i){if(!t.uuid){t.uuid=giscloud.uuid()}this.itemIndex[t.uuid]=i;if(typeof t.valid==="object"){this.formHasValidation=true;this.formHasUniqueAmongValidation=n(t.valid,"unique-among")}return t},this))}e.prototype.addItem=function(e){this.itemIndex[e.uuid]=this.items.length;this.items.push(e);if(typeof e.valid==="object"){this.formHasValidation=true;this.formHasUniqueAmongValidation=n(e.valid,"unique-among")}};e.prototype.itemByUuid=function(e){return this.items[this.itemIndex[e]]};e.prototype.isValid=function e(t,i){var n=0,r;if(i==null){return true}if(!a.isPlainObject(i)){return!!i}if(!this.formHasValidation){return true}return u.call(this,t,i)};e.prototype.check=function e(t,i){this.messages=[];return u.call(this,t,i)};e.prototype.getMessages=function e(){return this.messages};if(giscloud){giscloud.FormValidator=e}})(giscloud&&giscloud.exposeJQuery()||$||jQuery);(function(s){var t=["text","number","numeric","datetime","select","radio","checkbox","qr","barcode"];function n(e){return e.reduce(function(e,t,i){if(t.uuid)e[t.uuid]=i;return e},{})}function r(e){return e.filter(function(e){return e.value}).map(function(e){return e.uuid})}function o(t){var i=[];["all","any","one","none"].forEach(function(e){if(t[e]){t[e].forEach(function(e){if(!i.includes(e.field)){i.push(e.field)}})}});return i}function a(e,t,i){return i[e]<i[t]}function l(e,t,i,n){if(a(t,i,n)){if(!e[t]){e[t]=[]}if(!e[t].includes(i)){e[t].push(i)}}}function c(e,r){var a={};e.forEach(function(n){if(n.automationRules&&s.isArray(n.automationRules)){n.automationRules.forEach(function(e){var t=o(e.condition);t.forEach(function(e){l(a,e,n.uuid,r)});var i=e.action&&e.action.sourceField;if(i){l(a,i,n.uuid,r)}})}});Object.keys(a).forEach(function(t){var e=a[t];e.forEach(function(e){u(e,a[t],a,r)})});return a}function u(t,i,n,r){if(n[t]){n[t].forEach(function(e){if(!i.includes(e)&&a(t,e,r)){i.push(e);u(e,i,n,r)}})}}var e=function(e,t,i){this.formNode=e;this.formItems=t;this.getFieldValue=i;this.appliedRules={};this.manualOverrides={};this.itemIndex=n(t);this.reverseDependencyMap=c(t,this.itemIndex);this.itemsWithDefaultValues=r(t)};e.prototype={itemByUuid:function(e){return this.formItems[this.itemIndex[e]]},getDomElementValue:function(e){var t=this.itemByUuid(e);return this.getFieldValue(t.name)},setValue:function(e,t){var i=this.itemByUuid(e);s(this.formNode).trigger("setFieldValue.gc-custom-form",[i.name,t])},checkCondition:function(e){var t=function(e){var t=this.getDomElementValue(e.field)||"";return t==e.value}.bind(this);if(e.all){return e.all.every(t)}else if(e.any){return e.any.some(t)}else if(e.one){return e.one.filter(t).length===1}else if(e.none){return e.none.every(function(e){return!t(e)})}return false},shouldSkipItem:function(e){if(!e.automationRules||!s.isArray(e.automationRules)){return true}if(!t.includes(e.type)){return true}if(e.readOnly||e.persistent||this.itemsWithDefaultValues.includes(e.uuid)){return true}return false},setOverrides:function(){this.formItems.forEach(function(e){if(!this.itemByUuid(e.uuid)){return}var t=this.getDomElementValue(e.uuid);this.setManualOverride(e.uuid,t)},this)},evaluateRules:function(){this.formItems.forEach(function(e){this.evaluateRule(e.uuid)},this)},evaluateRule:function(e){var t=this.itemByUuid(e),i=false;if(!t){return}if(this.shouldSkipItem(t))return;for(var n=0;n<t.automationRules.length;n++){var r=t.automationRules[n];if(this.checkCondition(r.condition)){this.applyAction(t.uuid,r.action);this.appliedRules[t.uuid]=r;i=true;break}}if(!i&&this.appliedRules[t.uuid]){this.undoAction(t.uuid)}},setManualOverride:function(e,t){var i=this.itemByUuid(e).type;if(i==="datetime"){if(moment(t,moment.ISO_8601).isValid()){var n=moment(t).format("YYYY-MM-DD");this.manualOverrides[e]=n}else if(s.isPlainObject(t)){var n=moment({year:t.y,month:t.M,day:t.d,hour:t.h,minute:t.m,second:t.s}).format("YYYY-MM-DD");this.manualOverrides[e]=n}}else{this.manualOverrides[e]=t}},evaluateRulesThatDependOnItem:function(e,t){var i=this.itemByUuid(e);if(!i){return}if(i.type==="datetime"&&!s.isPlainObject(t)){return}this.setManualOverride(e,t);if(this.reverseDependencyMap[e]){this.reverseDependencyMap[e].forEach(function(e){this.evaluateRule(e)},this)}},applyAction:function(e,t){switch(t.type){case"predefined":this.setValue(e,t.value);break;case"field_value":var i=this.getDomElementValue(t.sourceField);this.setValue(e,i);break;case"today_date":var n=(new Date).toISOString().split("T")[0];this.setValue(e,n);break;default:console.error("Unsupported action type: "+t.type)}},undoAction:function(e){var t=this.itemByUuid(e).type,i=this.manualOverrides[e],n=t==="datetime"?undefined:"";this.setValue(e,i||n);delete this.appliedRules[e]}};if(giscloud){giscloud.FormAutomator=e}})(giscloud&&giscloud.exposeJQuery()||$||jQuery);(function(e,o,l,t){giscloud.maps={list:function(i,n){var e="maps",r=new o.Deferred;if(typeof i==="function"){n=i;i=null}else{n=n||i&&i.callback}if(i&&!i.perpage)i.nototal=1;l.rest.get(e,i).done(function(){var e=arguments[0],t=[];try{o.each(e.data,function(){t.push(new giscloud.Map(this))});if(!i||i.nototal)e.total=t.length;if(typeof n=="function"){n(t,e.total)}r.resolve(t,e.total)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},byId:function(e,t,i,n){var r="maps/"+e,a=new o.Deferred;if(typeof t==="function"){i=t;t=null}else{i=i||t&&t.callback}l.rest.get(r,t).done(function(){var e=arguments[0],t;try{t=n?e:new giscloud.Map(e);if(typeof i=="function"){i(t)}a.resolve(t)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()},remove:function(e){return l.rest.call("DELETE","maps/"+e)},archive:function(e){return l.rest.call("PUT","maps/"+e,l.toXml("map",{archived:true}),"text/xml")},restore:function(e){return l.rest.call("PUT","maps/"+e,l.toXml("map",{archived:false}),"text/xml")},update:function(e,t){return l.rest.call("PUT","maps/"+e,l.toXml("map",t),"text/xml")},create:function(e){var n=new o.Deferred;l.rest.call("post","maps/",l.toXml("map",e),"text/xml").fail(n.reject).done(function(e,t){var i=t&&t.match(/maps\/(\d+)/);if(i&&i[1]!=null){n.resolve(i[1])}else{n.reject()}});return n.promise()},users:function(e){var t=new o.Deferred,i,r={owner:null,editors:[],viewers:[]};this.byId(e,{expand:"owner"}).done(function(e){r.owner={id:e.owner.id,username:e.owner.username};giscloud.resources.permissions(e.resourceId,{expand:"user"}).done(function(e){if(e&&e.data&&e.data.length){o.each(e.data,function(e,i){var n={permissions:i.permissions};if(i.role){n.role=true;n.id=i.role.id;n.rolename=i.role.name}if(i.user){if(i.user.username==="anonymous"){return}n.id=i.user.id;n.username=i.user.username}o.each(i.permissions,function(e,t){if(t.type==="READ"||t.type==="EDIT"||t.type==="SHARE"||t.type==="EXPORT"){if(i.permissions.length===1&&t.type==="READ"){r.viewers.push(n)}else{r.editors.push(n)}return false}})});return t.resolve(r)}})});return t.promise()},reset:function(e,t,i){var n=new o.Deferred,r=this,a={},s="/2";if(o.isArray(t))a.layers=t.join();else if(t==null)a.layers=t;if(i){if(i.init===0)s="/0";if(i.init===1)s="/1"}if(i&&i.cascade)a.cascade=true;l.rest.call("DELETE","map_cache/"+e+s,a).done(function(){n.resolveWith(r)}).fail(function(){n.rejectWith(r,arguments)});return n.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,c,u,t){giscloud.layers={list:function(i,n){var e="layers",r=new c.Deferred;i=i||{};if(typeof i==="function"){n=i;i=null}else{n=n||i.callback}if(i&&!i.perpage)i.nototal=1;u.rest.get(e,i).done(function(){var e=arguments[0],t=[];try{c.each(e.data,function(){t.push(new giscloud.Layer(this))});if(!i||i.nototal)e.total=t.length;if(typeof n=="function"){n(t,e.total)}r.resolve(t,e.total)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},byId:function(e,t,i){var n="layers/"+e,r=new c.Deferred;t=t||{};if(typeof t==="function"){i=t;t=null}else{i=i||t.callback}u.rest.get(n,t).done(function(){var e=arguments[0],t;try{t=new giscloud.Layer(e);if(typeof i=="function"){i(t)}r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},byMapId:function(e,i,n){var t="maps/"+e+"/layers",r=new c.Deferred;i=i||{};if(typeof i==="function"){n=i;i=null}else{n=n||i.callback}if(i&&!i.perpage)i.nototal=1;u.rest.get(t,i).done(function(){var e=arguments[0],t=[];try{c.each(e.data,function(){t.push(new giscloud.Layer(this))});if(!i||i.nototal)e.total=t.length;if(typeof n=="function"){n(t,e.total)}r.resolve(t,e.total)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},remove:function(e){var t=new c.Deferred,i=this;u.rest.call("DELETE","layers/"+e).done(function(){t.resolveWith(i)}).fail(function(){t.rejectWith(i,arguments)});return t.promise()},update:function(e,t){var i=new c.Deferred,n=this,r=a(t||{});if(e==null){return this.create(r)}u.rest.call("PUT","layers/"+e,JSON.stringify(r),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},create:function(e){var n=new c.Deferred,r=this,t=a(e);delete t.id;u.rest.call("POST","layers/",JSON.stringify(t),"application/json").done(function(e,t){var i=t&&t.match(/layers\/(\d+)/);n.resolveWith(r,[i&&i[1]])}).fail(function(){n.rejectWith(r,arguments)});return n.promise()},reset:function(e,t,i){var n=new c.Deferred,r=this,a={};if(i&&i.cascade){a.cascade=true}u.rest.call("DELETE","map_cache/"+e+"/2?layers="+t.join(),a).done(function(){n.resolveWith(r)}).fail(function(){n.rejectWith(r,arguments)});return n.promise()},render:function(e,t,i,n){var r=u.rest.url()+"layers/"+e+"/render."+t+"?invalidate=true";if(i&&n){r+="&width="+i+"&height="+n}return r},export:function(e,t,i){var n=u.rest.url()+"layers/"+e+"/export."+t;if(i){n+=".zip"}return n},refreshColumns:function(e){var t=new c.Deferred,i=this;u.rest.call("PUT","layers/"+e+"/refresh_columns.json").done(function(){t.resolveWith(i)}).fail(function(){t.rejectWith(i,arguments)});return t.promise()},createBuffer:function(e,t){var i=new c.Deferred,n="layers/"+e+"/buffer",r={},a,s,o,l;t=t||{};if(!t.hasOwnProperty("name")){console.error("Name parameter is missing from options.");i.reject("Name parameter is missing from options.");return i.promise()}else if(!t.hasOwnProperty("size")){console.error("Size parameter is missing from options.");i.reject("Size parameter is missing from options.");return i.promise()}r.name=t.name;r.size=t.size;t.hasOwnProperty("units")&&(r.units=t.units);t.hasOwnProperty("mergeGeom")&&(r.merge_geom=t.mergeGeom);t.hasOwnProperty("borderWidth")&&(r.border_width=t.borderWidth);t.hasOwnProperty("borderColor")&&(r.border_color=t.borderColor);t.hasOwnProperty("fillColor")&&(r.fill_color=t.fillColor);if(r.border_color instanceof giscloud.Color){r.border_color=r.border_color.rgb().join(", ")}if(r.fill_color instanceof giscloud.Color){r.fill_color=r.fill_color.rgb().join(", ")}u.rest.call("POST",n,r).done(function(){a=arguments;try{s=a[1]&&a[1].split("/");o=s&&s.length&&s[s.length-1];i.resolve(o)}catch(e){i.reject("Unable to process response.")}}).fail(function(){l={status:arguments[0],error:arguments[4],message:arguments[5]&&arguments[5].msg?arguments[5].msg:""};i.reject(l)});return i.promise()},attributeOps:{distinct:function(e,t,i){var n="layers/"+e+"/attributeops/distinct.json";i=i||{perpage:10,page:1};if(t){i.attribute=t}return u.rest.get(n,i).pipe(function(e){return e},function(e){return e}).promise()},info:function(e,t){var i="layers/"+e+"/attributeops/info.json";return u.rest.get(i,t).pipe(function(e){return e},function(e){return e}).promise()}}};function i(t){try{return typeof t==="object"?JSON.stringify(t):t}catch(e){console.warn("Error while converting value to JSON",t,e);return t}}function a(e){var t=Object.assign({},e||{});delete t.modified;delete t.created;delete t.accessed;if(t.datasourceId){t.datasource_id=t.datasourceId;delete t.datasourceId}if(t.mapId){t.map_id=t.mapId;delete t.mapId}if(t.source)t.source=i(t.source);if(t.styles)t.styles=i(t.styles);if(t.label_placement)t.label_placement=i(t.label_placement);return t}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,o,l,c){function t(e){var t,i,n={};for(i in e){if(e.hasOwnProperty(i)){t=i.replace(".","\\.");n[t]=e[i]}}return n}giscloud.features={byLayer:function(n,e,r){var t="layers/"+n+"/features",a=new o.Deferred;e=e||{};if(typeof e==="function"){r=e;e=null}else{r=r||e.callback}l.rest.get(t,e).done(function(e){var t=e,i=[];o.each(t.data,function(){this.layerId=n;this.meta=t.meta;i.push(new giscloud.Feature(this))});if(typeof r=="function"){r(i,t.total)}a.resolve(i,t.total)}).fail(function(){a.reject()});return a.promise()},byId:function(n,e,t,r){var i="layers/"+n+"/features/"+e,a=new o.Deferred;t=t||{};if(typeof t==="function"){r=t;t=null}else{r=r||t.callback}l.rest.get(i,t).done(function(e){var t=e,i;t.layerId=n;i=new giscloud.Feature(t);if(typeof r=="function"){r(i)}a.resolve(i)}).fail(function(){a.reject()});return a.promise()},byBounds:function(n,e,r,a){var t="layers/"+n+"/features",s=new o.Deferred,i;r=r||{};if(typeof r==="function"){a=r;r={}}else{a=a||r.callback}r.bounds=e.toString();if(r.requestByPost){r.requestByPost=c;i=l.rest.call("post",t+"?_method=GET",r)}else{i=l.rest.get(t,r)}i.done(function(e){var t=e,i=[];o.each(t.data,function(){this.layerId=n;i.push(new giscloud.Feature(this))});if(typeof a=="function"){a(i,t.total,n,r)}s.resolve(i,t.total,n,r)}).fail(function(){s.reject()});return s.promise()},remove:function(e,t){var i=new o.Deferred,n=this;l.rest.call("DELETE","layers/"+e+"/features/"+t).done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},update:function(e,t,i,n){var r=new o.Deferred,a=this,s;if(i&&i.geometry){if(i.geometry.toOGC){i.geometry=i.geometry.toOGC()}}if(t==null){return this.create(e,i,n)}s="layers/"+e+"/features/"+t;if(n){s+="?"+o.map(n,function(e,t){return t+"="+e}).join("&")}l.rest.call("PUT",s,JSON.stringify(i),"application/json").done(function(){r.resolveWith(a,[t])}).fail(function(){r.rejectWith(a,arguments)});return r.promise()},create:function(e,t,i){var a=new o.Deferred,s=this,n="layers/"+e+"/features/";if(i){n+="?"+o.map(i,function(e,t){return t+"="+e}).join("&")}l.rest.call("post",n,JSON.stringify(t),"application/json").done(function(e,t,i){var n=t||i.getResponseHeader("Location"),r=n&&n.match(/features\/(\d+)/);a.resolveWith(s,[r&&r[1]])}).fail(function(){a.rejectWith(s,arguments)});return a.promise()},email:function(e){var t="layers/"+e.layer_id+"/features/email",i=new o.Deferred,n=this;if(!e||!e.layer_id||!e.feature_ids||!e.usernames&&!e.emails)return i.reject();e.feature_ids=jQuery.type(e.feature_ids)=="array"?e.feature_ids.join():e.feature_ids;e.usernames=jQuery.type(e.usernames)=="array"?e.usernames.join():e.usernames;e.emails=jQuery.type(e.emails)=="array"?e.emails.join():e.emails;l.rest.get(t,e).done(function(){i.resolve()}).fail(function(e){var t=o.parseJSON(e.responseText);i.rejectWith(n,[e,t])});return i.promise()},emailCSV:function(e){var t="layers/"+e.layer_id+"/features.csv",i=new o.Deferred,n=this;if(!e||!e.layer_id)return i.reject();e.format=1;e.emails=jQuery.type(e.emails)=="array"?e.emails.join():e.emails;l.rest.get(t,e).done(function(){i.resolve()}).fail(function(e){var t=o.parseJSON(e.responseText);i.rejectWith(n,[e,t])});return i.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,s,o,t){giscloud.graphicFeatures={list:function(t,n){var e="graphicfeatures",r=new s.Deferred;if(typeof t==="function"){n=t;t=null}else{n=n||t&&t.callback}if(t&&!t.perpage)t.nototal=1;o.rest.get(e,t).done(function(){var e=arguments[0],i=[];try{s.each(e.data,function(e,t){i.push(new giscloud.GraphicFeature({id:t.id,resourceId:t.resource_id,geometry:giscloud.geometry.fromOGC(t.geometry),style:giscloud.GraphicStyle.parse(t.style)}))});if(!t||t.nototal)e.total=i.length;if(typeof n=="function"){n(i,e.total)}r.resolve(i,e.total)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},byId:function(e,t,i){var n=e&&e.match?parseInt(e.match(/^(?:graphic_orig)?(\d+)$/)[1],10):e,r="graphicfeatures/"+n,a=new s.Deferred;if(t&&t.context&&t.contextId){r=t.context+"/"+t.contextId+"/"+r}if(typeof t==="function"){i=t;t=null}else{i=i||t&&t.callback}o.rest.get(r,t).done(function(e){var t;try{t=new giscloud.GraphicFeature({id:e.id,resourceId:e.resource_id,geometry:giscloud.geometry.fromOGC(e.geometry),style:giscloud.GraphicStyle.parse(e.style)});if(typeof i=="function"){i(t)}a.resolve(t)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()},remove:function(e){var t=e&&e.match?parseInt(e.match(/^(?:graphic_orig)?(\d+)$/)[1],10):e;return o.rest.call("DELETE","graphicfeatures/"+t)},update:function(e,t){var i=e&&e.match?parseInt(e.match(/^(?:graphic_orig)?(\d+)$/)[1],10):e;return o.rest.call("PUT","graphicfeatures/"+i,o.toXml("graphicfeature",t),"text/xml")},create:function(e){var n=new s.Deferred;o.rest.call("POST","graphicfeatures/",o.toXml("graphicfeature",e),"text/xml").fail(n.reject).done(function(e,t){var i=t&&t.match(/graphicfeatures\/(\d+)/);if(i&&i[1]!=null){n.resolve(i[1])}else{n.reject()}});return n.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(s,o,e){giscloud.search={features:function(e,t,i,n,r){var a;n=n||{};if(typeof n==="function"){r=n;n=null}else{r=r||n.callback}n.query=e;n.fields=t&&t.toString();if(i){if(i instanceof giscloud.LonLat){n.x=i.lon;n.y=i.lat}else if(i.x!=null&&i.y!=null){n.x=i.x;n.y=i.y}}else{n.x=n.y=0}a=new s.Deferred;o.rest.get("search",n).done(function(e){var t=[];try{s.each(e.data,function(){t.push(new giscloud.Feature(this))});a.resolve(t,e.total)}catch(e){a.reject()}}).fail(function(){a.reject()});if(r){a.done(r)}return a.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(t,r){var a,s,o,l=["id","created","lastlog","modified","username","email",{field:"email_md5",alias:"emailMd5"},"file_feature_count","db_feature_count","feature_count_limit","storage_raster","storage_raster_limit","subscriptions","resource","options","active","roles",{field:"parent_id",alias:"parentId"}],c=["created","lastlog","modified"],u=["language",{field:"firstname",alias:"firstName"},{field:"lastname",alias:"lastName"},"info","phone","mobile","company",{field:"web",alias:"website"}];giscloud.User=function(e){var t,i,n;for(t=0,i=l.length;t<i;t++){n=l[t];this[n.alias||n]=a(n.field||n,e)}for(t=0,i=u.length;t<i;t++){n=u[t];this[n.alias||n]=s(n.field||n,e)}for(t=0,i=c.length;t<i;t++){n=c[t];e[n.field||n]=o(e[n.field||n])}};giscloud.User.prototype={update:function(){var e,t,i,n;n={};for(e=0,t=u.length;e<t;e++){i=u[e];n[i.field||i]=this[i.alias||i]()}return giscloud.users.update(this.id(),n)},remove:function(){return giscloud.users.remove(this.id())},unsubscribe:function(e){return giscloud.users.unsubscribe(this.id(),e)},optionByName:function(e,t){return giscloud.options.byName(this.id(),e,{},t)},gravatarElement:function(e,t,i){var n=this.emailMd5()||this.email();if(!n||!giscloud.gravatar)return null;return giscloud.gravatar.element(this,n,e,t,i)},gravatarImage:function(e,t,i,n){var r=this.emailMd5()||this.email();if(!r||!giscloud.gravatar)return null;return giscloud.gravatar.image(r,e,t,i,n)},gravatarUrl:function(e,t,i){var n=this.emailMd5()||this.email();if(!n||!giscloud.gravatar)return null;return giscloud.gravatar.url(n,e,t,i)},gravatarProfile:function(){var e=this.emailMd5()||this.email();if(!e||!giscloud.gravatar)return t.Deferred().fail(null);return giscloud.gravatar.profile(e)}};o=function(e){var t=new Date(e*1e3);if(t&&!isNaN(t.getTime())){return t}else{return e}};a=function(e,t){return function(){return t[e]}};s=function(t,i,n){return function(e){if(e!==r){i[t]=e;return n}else{return i[t]}}}})(giscloud.exposeJQuery());(function(e,s,o,t){giscloud.users={list:function(e,r){var t="users",a=new s.Deferred;e=e||{};if(typeof e==="function"){r=e;e={}}else{r=r||e.callback}e.expand="roles, options";o.rest.get(t,e).done(function(i){var n,e,t=[];try{for(n=0,e=i.data.length;n<e;n++){if(i.data[n].options&&i.data[n].options.length){i.data[n]._options={};s.each(i.data[n].options,function(e,t){i.data[n]._options[t.name]=t.value});i.data[n].options=i.data[n]._options;delete i.data[n]._options}else{i.data[n].options=null}t.push(new giscloud.User(i.data[n]))}if(typeof r=="function"){r(t)}a.resolve(t)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()},byId:function(e,t,n){var i="users/"+e,r=new s.Deferred;t=t||{};if(typeof t==="function"){n=t;t={}}else{n=n||t.callback}t.expand="roles,options,subscriptions,resource";o.rest.get(i,t).done(function(i){var e;try{if(i.options&&i.options.length){i._options={};s.each(i.options,function(e,t){i._options[t.name]=t.value});i.options=i._options;delete i._options}else{i.options=null}e=new giscloud.User(i);if(typeof n=="function"){n(e)}r.resolve(e)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},current:function(e,t){var i="users/current",n=new s.Deferred;e=e||{};if(typeof e==="function"){t=e;e={}}else{t=t||e.callback}e.expand="roles,options";o.rest.get(i,e).done(function(i){var e;try{if(i.options&&i.options.length){i._options={};s.each(i.options,function(e,t){i._options[t.name]=t.value});i.options=i._options;delete i._options}else{i.options=null}e=new giscloud.User(i);if(typeof t=="function"){t(e)}n.resolve(e)}catch(e){n.reject()}}).fail(function(){n.reject()});return n.promise()},remove:function(e){var t=new s.Deferred,i=this;o.rest.call("DELETE","users/"+e).done(function(){t.resolveWith(i)}).fail(function(){t.rejectWith(i,arguments)});return t.promise()},unsubscribe:function(e,t){var i=new s.Deferred,n=this;o.rest.call("DELETE","users/"+e+"/subscriptions/"+t).done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},update:function(e,t){var i=new s.Deferred,n=this;o.rest.call("PUT","users/"+e,JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},create:function(e){var n=new s.Deferred,r=this;if(!e||!e.username||!e.password){return n.rejectWith(r,["No username or password"])}if(e.password.length<10){return n.rejectWith(r,["Use min 10 characters for password"])}o.rest.call("post","users/",JSON.stringify(e),"application/json").done(function(e,t){var i=t&&t.match(/users\/(\d+)/);n.resolveWith(r,[i&&i[1]])}).fail(function(){n.rejectWith(r,arguments)});return n.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,a){"use strict";giscloud.userOptions={userId:function(){return"current"},list:function(){var e="users/"+this.userId()+"/options.json";return a.rest.get(e).pipe(function(e){return e.data})},byId:function(e){var t="users/"+this.userId()+"/options/"+e+".json";return a.rest.get(t).promise()},byName:function(e){return this.byId(e)},create:function(e,t){var i="users/"+this.userId()+"/options.json",n={name:e,value:t||null};return a.rest.call("post",i,n,"application/json").pipe(function(e,t){return t&&t.match&&t.match(/options\/(\d+)/)[1]})},update:function(e,t,i){var n="users/"+this.userId()+"/options/"+e+".json",r={name:typeof i==="undefined"?e:t,value:typeof i==="undefined"?t:i};return a.rest.call("put",n,r,"application/json").promise()},remove:function(e){var t="users/"+this.userId()+"/options/"+e+".json";return a.rest.call("DELETE",t).promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(r,a){"use strict";function i(e){return{id:e.id,description:e.key_desc,created:new Date(e.created),accessed:new Date(e.accessed),trunc:e.key_trunc,scope:e.scope&&(e.scope.split?e.scope.split(","):[e.scope]),active:e.active==="t"}}giscloud.keys={list:function(){return a.rest.get("keys.json").then(function(e){var t=e&&r.map(e.data||[],i);if(!t){return r.Deferred().reject(e)}return r.Deferred().resolve(t,e.total)})},byId:function(e){return a.rest.get("keys/"+e+".json").then(i)},add:function(e){var t="keys.json",i=new r.Deferred,n;if(typeof e==="string"){n={key_desc:e}}else if(r.isPlainObject(e)){n=e;if(n.description){n["key_desc"]=n.description;delete n.description}}else{n={}}if(n.scope&&r.isArray(n.scope)){n.scope=n.scope.join(",")}a.rest.call("post",t,JSON.stringify(n),"application/json",true).done(function(e,t){i.resolve({id:t&&t.match&&t.match(/keys\/(\d+)/)[1],key:e.value})}).fail(function(){i.reject()});return i.promise()},remove:function(e){var t=new r.Deferred,i=this;a.rest.call("DELETE","keys/"+e).done(function(){t.resolveWith(i)}).fail(function(){t.rejectWith(i,arguments)});return t.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(e,t){"use strict";e.basemaps={list:function e(){return t.rest.get("basemaps").then(function(e){return e.data})}}})(giscloud,giscloud.common());(function(e,s,o,t){giscloud.payment=giscloud.payment||{};giscloud.payment.plans={list:function(e,r){var t="payment/plans",a=new s.Deferred;e=e||{};if(typeof e==="function"){r=e;e={}}else{r=r||e.callback}o.rest.get(t,e).done(function(i){var e,t,n=[];try{for(e=0,t=i.data.length;e<t;e++){if(i.data[e].options&&i.data[e].options.length){i.data[e]._options={};s.each(i.data[e].options,function(e,t){i.data[e]._options[t.name]=t.value});i.data[e].options=i.data[e]._options;delete i.data[e]._options}else{i.data[e].options=null}n.push(i.data[e])}if(typeof r=="function"){r(n)}a.resolve(n)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()},create:function(e){var n=new s.Deferred;o.rest.call("post","payment/plans",e,"application/json").done(function(e,t){var i=t&&t.match(/plans\/(\w+)/);n.resolve([i&&i[1]])}).fail(function(){n.reject(arguments)});return n.promise()},remove:function(e){var t=new s.Deferred;o.rest.call("DELETE","payment/plans/"+e).done(function(){t.resolve()}).fail(function(){t.reject()});return t.promise()},update:function(e,t){var i=new s.Deferred,n=this;o.rest.call("PUT","payment/plans/"+e,JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},byId:function(e,t,n){var i="payment/plans/"+e,r=new s.Deferred;t=t||{};if(typeof t==="function"){n=t;t={}}else{n=n||t.callback}o.rest.get(i,t).done(function(i){var e;try{if(i.options&&i.options.length){i._options={};s.each(i.options,function(e,t){i._options[t.name]=t.value});i.options=i._options;delete i._options}else{i.options=null}e=i;if(typeof n=="function"){n(e)}r.resolve(e)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,s,o,t){giscloud.payment=giscloud.payment||{};giscloud.payment.coupons={list:function(e,r){var t="payment/coupons",a=new s.Deferred;e=e||{};if(typeof e==="function"){r=e;e={}}else{r=r||e.callback}o.rest.get(t,e).done(function(e){var t,i,n=[];try{for(t=0,i=e.data.length;t<i;t++){n.push(e.data[t])}if(typeof r=="function"){r(n)}a.resolve(n)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()},byId:function(e,t,i){var n="payment/coupons/"+e,r=new s.Deferred;if(!e||!(e.length>0)){console.warn("Coupon id is not specified.")}t=t||{};if(typeof t==="function"){i=t;t={}}else{i=i||t.callback}o.rest.get(n,t).done(function(e){var t;try{t=e;if(typeof i=="function"){i(t)}r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,s,o,t){giscloud.payment=giscloud.payment||{};giscloud.payment.cards={add:function(e,t){var i=new s.Deferred;if(!e||!t){return}var n="payment/customers/"+e+"/cards",r={token:t};o.rest.call("post",n,o.toXml("card",r),"text/xml").done(function(e,t){i.resolve()}).fail(function(){i.reject(arguments)});return i.promise()},makeDefault:function(e,t){var i=new s.Deferred,n=this,r;var r="payment/customers/"+e+"/cards/"+t+"/makedefault";o.rest.call("PUT",r,null,"application/json").done(function(){i.resolveWith(n,[])}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},remove:function(e,t){var i=new s.Deferred;var n="payment/customers/"+e+"/cards/"+t;o.rest.call("DELETE",n).done(function(){i.resolve()}).fail(function(){i.reject()});return i.promise()},list:function(e,t,r){var i="payment/customers/"+e+"/cards",a=new s.Deferred;t=t||{};if(typeof t==="function"){r=t;t={}}else{r=r||t.callback}o.rest.get(i,t).done(function(e){var t,i,n=[];try{for(t=0,i=e.data.length;t<i;t++){n.push(e.data[t])}if(typeof r=="function"){r(n)}a.resolve(n)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,s,o,t){giscloud.payment=giscloud.payment||{};giscloud.payment.customers={create:function(e){var t="payment/customers",n=new s.Deferred,r=this;o.rest.call("post",t,JSON.stringify(e),"application/json").done(function(e,t){var i=t&&t.match(/payment\/customers\/(\d+)/);n.resolveWith(r,[i&&i[1]])}).fail(function(){n.rejectWith(r,arguments)});return n.promise()},remove:function(e){var t="payment/customers/"+e,i=new s.Deferred,n=this;o.rest.call("DELETE",t).done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},list:function(e,r){var t="payment/customers",a=new s.Deferred;e=e||{};if(typeof e==="function"){r=e;e={}}else{r=r||e.callback}if(e&&e.userId){t="users/"+e.userId+"/payment/customers"}if(e&&e.expand){t+="?expand="+e.expand}o.rest.get(t,e).done(function(e){var t,i,n=[];try{for(t=0,i=e.data.length;t<i;t++){n.push(e.data[t])}if(typeof r=="function"){r(n)}a.resolve(n)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,s,o,t){giscloud.payment=giscloud.payment||{};giscloud.payment.subscriptions={list:function(e,t,r){var i="payment/customers/"+e+"/subscriptions",a=new s.Deferred;t=t||{};if(typeof t==="function"){r=t;t={}}else{r=r||t.callback}o.rest.get(i,t).done(function(e){var t,i,n=[];try{for(t=0,i=e.data.length;t<i;t++){n.push(e.data[t])}if(typeof r=="function"){r(n)}a.resolve(n)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()},remove:function(e){var t="payment/subscriptions/"+e,i=new s.Deferred,n=this;o.rest.call("DELETE",t).done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},create:function(e,t){var i="payment/customers/"+e+"/subscriptions",n=new s.Deferred,r=this;o.rest.call("post",i,JSON.stringify(t),"application/json").done(function(e,t){var i=t&&t.match(/payment\/subscriptions\/(\d+)/);n.resolveWith(r,[i&&i[1]])}).fail(function(){n.rejectWith(r,arguments)});return n.promise()},update:function(e,t){var i="payment/subscriptions/"+e,n=new s.Deferred,r=this;o.rest.call("PUT",i,JSON.stringify(t),"application/json").done(function(){n.resolveWith(r)}).fail(function(){n.rejectWith(r,arguments)});return n.promise()},byId:function(e,t,i){var n="payment/subscriptions/"+e,r=new s.Deferred;t=t||{};if(typeof t==="function"){i=t;t={}}else{i=i||t.callback}o.rest.get(n,t).done(function(e){var t;try{t=e;if(typeof i=="function"){i(t)}r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,s,o,t){giscloud.apps={list:function(e,r){var t="apps",a=new s.Deferred;e=e||{};if(typeof e==="function"){r=e;e={}}else{r=r||e.callback}o.rest.get(t,e).done(function(e){var t,i,n=[];try{for(t=0,i=e.data.length;t<i;t++){n.push(e.data[t])}if(typeof r=="function"){r(n)}a.resolve(n)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()},byId:function(e,t,i){var n="apps/"+e,r=new s.Deferred;t=t||{};if(typeof t==="function"){i=t;t={}}else{i=i||t.callback}o.rest.get(n,t).done(function(e){var t;try{t=e;if(typeof i=="function"){i(t)}r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,s,o,t){giscloud.appinstances={list:function(e,r){var t="appinstances",a=new s.Deferred;e=e||{};if(typeof e==="function"){r=e;e={}}else{r=r||e.callback}o.rest.get(t,e).done(function(e){var t,i,n=[];try{for(t=0,i=e.data.length;t<i;t++){n.push(e.data[t])}if(typeof r=="function"){r(n)}a.resolve(n)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()},create:function(e){var n=new s.Deferred;o.rest.call("post","appinstances",e,"application/json").done(function(e,t){var i=t&&t.match(/appinstances\/(\w+)/);n.resolve([i&&i[1]])}).fail(function(){n.reject(arguments)});return n.promise()},remove:function(e){var t=new s.Deferred;o.rest.call("DELETE","appinstances/"+e).done(function(){t.resolve()}).fail(function(){t.reject()});return t.promise()},update:function(e,t){var i=new s.Deferred,n=this;o.rest.call("PUT","appinstances/"+e,JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},byId:function(e,t,i){var n="appinstances/"+e,r=new s.Deferred;t=t||{};if(typeof t==="function"){i=t;t={}}else{i=i||t.callback}o.rest.get(n,t).done(function(e){var t;try{t=e;if(typeof i=="function"){i(t)}r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(s,o){"use strict";giscloud.forms={byId:function(e,t){return o.rest.get("forms/"+e+".json",t||{}).then(function(e){return e})},byLayerAndId:function(e,t,i){return o.rest.get("layers/"+e+"/forms/"+t+".json",i||{}).then(function(e){return e})},create:function(e,t){var i="forms.json",n=new s.Deferred,r={name:e,definition:typeof t==="string"?t:JSON.stringify(t)};o.rest.call("post",i,r,"application/json").done(function(e,t){n.resolve(t&&t.match&&t.match(/forms\/(\d+)/)[1])}).fail(function(){n.reject()});return n.promise()},update:function(e,t,i){var n="forms/"+e+".json",r=new s.Deferred,a={name:t,definition:typeof i==="string"?i:JSON.stringify(i)};o.rest.call("put",n,a,"application/json").then(r.resolve,r.reject);return r.promise()},setLayerMappings:function(e,t,i){var n="layers/"+e+"/forms/"+t+".json",r=new s.Deferred,a={};if(i!=null){a.mappings=i}o.rest.call("put",n,a,"application/json").done(function(){r.resolve()}).fail(function(){r.reject()});return r.promise()},remove:function(e){var t=new s.Deferred,i=this;o.rest.call("DELETE","forms/"+e).done(function(){t.resolveWith(i)}).fail(function(){t.rejectWith(i,arguments)});return t.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(p,g){"use strict";function r(e){return"?"+p.map(e,function(e,t){if(t=="connectionId"){t="connection_id"}if(t=="noGeometryField"){t="no_geometry_field"}if(t=="perPage"){t="perpage"}return t+"="+e}).join("&")}giscloud.tables={list:function(e){var t="tables",i=new p.Deferred;if(e){t+="?"+p.map(e,function(e,t){if(t=="connectionId"){t="connection_id"}if(t=="meta"){t="expand";e="meta"}return t+"="+e}).join("&")}g.rest.get(t).done(function(e){i.resolve(e)}).fail(function(){i.reject(arguments)});return i.promise()},export:function(e,t){var i=g.rest.url()+"tables/"+e+"/rows.csv";if(t){i+=r(t)}return i},byName:function(e,i){var t="tables/"+e,n=new p.Deferred;if(i){p.each(i,function(e,t){if(e=="connectionId"){i["connection_id"]=t;delete i[e]}if(e=="count"){i["expand"]="count";delete i[e]}})}g.rest.get(t,i).done(function(e){n.resolve(e)}).fail(function(){n.reject(arguments)});return n.promise()},rows:{list:function(e,t){var i="tables/"+e+"/rows",n=new p.Deferred;if(t){i+=r(t)}g.rest.get(i).done(function(e){n.resolve(e)}).fail(function(){n.reject(arguments)});return n.promise()},add:function(e,t,i){var n="tables/"+e+"/rows",r=new p.Deferred;if(!t){return}if(i){n+="?"+p.map(i,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}g.rest.call("post",n,g.toXml("table",t),"text/xml").done(function(e,t){var i=t&&t.match(/tables\/rows\/(\w+)/);r.resolve(i&&i[1])}).fail(function(){r.reject(arguments)});return r.promise()},remove:function(e,t,i){var n="tables/"+e+"/rows/"+t,r=new p.Deferred;if(i){n+="?"+p.map(i,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}g.rest.call("DELETE",n).done(function(){r.resolve()}).fail(function(){r.reject(arguments)});return r.promise()},update:function(e,i,t,n){var r="tables/"+e+"/rows/"+i,a=new p.Deferred;if(!t){return}if(n){r+="?"+p.map(n,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}g.rest.call("put",r,JSON.stringify(t),"application/json").done(function(e,t){a.resolve([i])}).fail(function(){a.reject(arguments)});return a.promise()}},reset:function(e,t){var i=new p.Deferred,n="tables/"+e+"/reset";if(t){n+="?"+p.map(t,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}g.rest.call("DELETE",n).done(function(){i.resolve()}).fail(function(){i.reject(arguments)});return i.promise()},remove:function(e,t){var i=new p.Deferred,n="tables/"+e;if(t){n+="?"+p.map(t,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}g.rest.call("DELETE",n).done(function(){i.resolve()}).fail(function(){i.reject(arguments)});return i.promise()},create:function(e,t){var n=new p.Deferred,i="tables";if(!e){return}if(e.geometry==="line"||e.geometry==="LINE"){e.geometry="LINESTRING"}if(t){i+="?"+p.map(t,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}g.rest.call("post",i,g.toXml("table",e),"text/xml").done(function(e,t){var i=t&&t.match(/tables\/(\w+)/);n.resolve([i&&i[1]])}).fail(function(){n.reject(arguments)});return n.promise()},join:function(e,t,i,n,r,a,s){var o=new p.Deferred,l=e.table||e,c=t.table||t,u=!!e.readOnly,d=!!t.readOnly,h="tables/"+l+"/join.json",f={connection_id:t.connection_id||-1,schema:t.schema||null,table:c,name:i,on:n,id_fields:r,source_read_only:u,target_read_only:d};if(a&&p.isArray(a.source)&&p.isArray(a.target)){f.fields=a}if(typeof s==="string"){f.join_type=s}g.rest.call("get",h,f,"application/json").done(function(e,t,i){var n=i.getResponseHeader("Location"),r=n&&n.match(/tables\/(\w+)/);o.resolve([r&&r[1]])}).fail(function(){o.reject(arguments)});return o.promise()},query:function(e,t,i){var n="tables/"+e+"/query.json?orm="+t.toString(),r=new p.Deferred;if(t.options){i=p.extend({},t.options,i||{})}if(i){n+="&"+p.map(i,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}g.rest.get(n).done(function(e){r.resolve(e)}).fail(function(){r.reject(arguments)});return r.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(a,s){"use strict";giscloud.bookmarks={list:function(e){var t="bookmarks",i=new a.Deferred;s.rest.get(t,e).done(function(e){i.resolve(e)}).fail(function(){i.reject()});return i.promise()},byMapId:function(e,t,i){var n="maps/"+e+"/bookmarks",r=new a.Deferred;s.rest.get(n,t).done(function(e){r.resolve(e)}).fail(function(){r.reject()});return r.promise()},remove:function(e){var t=new a.Deferred;s.rest.call("DELETE","bookmarks/"+e).done(function(){t.resolve()}).fail(function(){t.reject()});return t.promise()},create:function(e){var n=new a.Deferred;if(!e){return}s.rest.call("post","bookmarks",s.toXml("bookmark",e),"text/xml").done(function(e,t){var i=t&&t.match(/bookmarks\/(\w+)/);n.resolve([i&&i[1]])}).fail(function(){n.reject(arguments)});return n.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){"use strict";giscloud.Role=function e(t){t=t||{};this.id=t.id;this.name=t.name;this.app_role=t.app_role||false;this.owner_id=t.owner_id||null;this.parent_id=t.parent_id||null;this.app_instance_id=t.app_instance_id||null};giscloud.Role.prototype={update:function e(t){var i=this,n={name:this.name};if(this.id!=null)return giscloud.roles.update(this.id,n,t);return giscloud.roles.create(n,t).done(function(e){i.id=e})},remove:function e(t){return giscloud.roles.remove(this.id,t)}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(a,s){"use strict";giscloud.roles={byId:function(e,t,i){var n="roles/"+e,r=new a.Deferred;t=t||{};if(typeof t==="function"){i=t;t=null}else{i=i||t.callback}s.rest.get(n,t).done(function(){var e=arguments[0],t;try{t=e;if(typeof i=="function"){i(t)}r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},list:function(i,n){var e="roles",r=new a.Deferred;i=i||{};if(typeof i==="function"){n=i;i=null}else{n=n||i.callback}if(i&&!i.perpage)i.nototal=1;s.rest.get(e,i).done(function(){var e=arguments[0],t=[];try{a.each(e.data,function(){t.push(new giscloud.Role(this))});if(!i||i.nototal)e.total=t.length;if(typeof n=="function"){n(t,e.total)}r.resolve(t,e.total)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},create:function(e){var t=new a.Deferred,i=this;if(e.id!=null){return this.update(e.id,e)}s.rest.call("POST","roles/",JSON.stringify(e),"application/json").done(function(){t.resolveWith(i)}).fail(function(){t.rejectWith(i,arguments)});return t.promise()},update:function(e,t){var i=new a.Deferred,n=this;if(e==null){return this.create(t)}s.rest.call("PUT","roles/"+e,JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},remove:function(e){var t=new a.Deferred,i=this;s.rest.call("DELETE","roles/"+e).done(function(){t.resolveWith(i)}).fail(function(){t.rejectWith(i,arguments)});return t.promise()},permissions:{list:function(e,t,i){var n=new a.Deferred;s.rest.get("roles/"+e+"/permissions/list",t).done(function(){var e=arguments[0],t;try{t=e;if(typeof i=="function"){i(t)}n.resolve(t)}catch(e){n.reject()}}).fail(function(){n.reject()});return n.promise()},add:function(e,t){var i=new a.Deferred,n=this;s.rest.call("POST","roles/"+e+"/permissions/add",JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},remove:function(e,t){var i=new a.Deferred,n=this;s.rest.call("DELETE","roles/"+e+"/permissions/remove",JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()}},users:{list:function(e,i){var n=new a.Deferred;s.rest.get("roles/"+e+"/users/list").done(function(){var e=arguments[0],t;try{t=e;if(typeof i=="function"){i(t)}n.resolve(t)}catch(e){n.reject()}}).fail(function(){n.reject()});return n.promise()},add:function(e,t){var i=new a.Deferred,n=this;s.rest.call("POST","roles/"+e+"/users/add",JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},remove:function(e,t){var i=new a.Deferred,n=this;s.rest.call("DELETE","roles/"+e+"/users/remove",JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()}}}})(giscloud.exposeJQuery(),giscloud.common());(function(e,i,t,n){"use strict";giscloud.File=function e(t){t=t||{};this.id=t.id;this.resourceId=t.resourceId||t.resource_id;this.created=t.created&&new Date(t.created*1e3);this.modified=t.modified&&new Date(t.modified*1e3);this.owner=t.owner?new giscloud.User(t.owner):t.owner_id;this.pathname=t.pathname;this.path=t.path;this.filename=t.filename;this.extension=t.extension;this.size=t.size;if(t.details)this.details=t.details;if(t.exif){this.exif={};if(t.exif.gps&&t.exif.gps.lon&&t.exif.gps.lat)this.exif.gps=new giscloud.LonLat(t.exif.gps.lon,t.exif.gps.lat);this.exif.date=t.exif.date}if(t.xmp){this.xmp={};this.xmp.panorama=t.xmp.panorama?true:false}this.isDir=t.isDir==null?t.is_dir==="t":t.isDir};giscloud.File.prototype={listContents:function(e){var t;if(!this.isDir){throw"giscloud.File: this is not a directory."}if(e){t=i.extend(true,{},e);if(t.expand){if(i.isArray(t.expand)&&i.inArray("dir")===-1){t.expand.push("dir");t.expand=t.expand.join(",")}else{t.expand=[t.expand,"dir"].join(",")}}t.expand="dir"}else{t={expand:"dir"}}return giscloud.files.byPath(this.pathname,t)},getDetails:function(){var t=this;return giscloud.files.byPath(this.pathname,{expand:"details"}).then(function(e){if(e.details){t.details=i.extend(true,{},e.details)}return t})},update:function(){var t=this,e={path:this.path,filename:this.filename,size:this.size};if(this.id==null){return giscloud.files.create(e).done(function(e){t.id=e})}return giscloud.files.update(this.id,e)},remove:function(){return giscloud.files.remove(this.id)}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(r,a){"use strict";function n(e){return encodeURIComponent(e).replace(/%2F/g,"/").replace(/%25/g,"%2525")}function s(e){var t;try{if(e.type==="files"){t=r.map(e.data||[],function(e){return new giscloud.File(e)});return r.Deferred().resolve(t,e.total)}return r.Deferred().resolve(new giscloud.File(e))}catch(e){console.log("Error creating giscloud.File",e);return r.Deferred().reject("Error creating giscloud.File",e)}}giscloud.files={list:function(e){var t="files",i=new r.Deferred;a.rest.get(t,e).then(function(e){if(!e.data){return r.Deferred().reject()}return s(e)}).done(function(e,t){i.resolve(e,t)}).fail(function(e,t){i.reject(e,t)});return i.promise()},byId:function(e,t){var i="files/"+e,n=new r.Deferred;if(t&&t.context&&t.contextId){i=t.context+"/"+t.contextId+"/"+i}a.rest.get(i,t).then(function(e){return s(e)}).done(function(e,t){n.resolve(e,t)}).fail(function(e,t){n.reject(e,t)});return n.promise()},byPath:function(e,t){return this.byId(n(e)+"/bypath.json",t)},create:function(e){var t=e.path==null||e.path===""||e.path==="/"?"":e.path+"/",i="files/"+n(t)+e.filename;return a.rest.call("POST",i,{},"application/json").then(function(e,t){var i=t&&t.match(/files\/(\w+)/);dfrd.resolve(i&&i[1])})},update:function(e,t){var i="files/"+e;return a.rest.call("PUT",i,JSON.stringify(t),"application/json")},remove:function(e){return a.rest.call("DELETE","files/"+e)}}})(giscloud.exposeJQuery(),giscloud.common());(function(r,a){"use strict";function s(e){try{return new giscloud.Stream(e)}catch(e){console.log("Error creating stream object",err);return null}}giscloud.streams={list:function(e,t){var i="resources/"+e+"/streams",n=new r.Deferred;a.rest.get(i,t).done(function(e){n.resolve(r.map(e.data,s))}).fail(function(){n.reject()});return n.promise()},byId:function(e,t){var i="streams/"+e,n=new r.Deferred;a.rest.get(i,t).done(function(e){n.resolve(s(e))}).fail(function(){n.reject()});return n.promise()},update:function(e,t){var i=new r.Deferred,n=this;a.rest.call("PUT","streams/"+e,JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},remove:function(e){var t=new r.Deferred;a.rest.call("DELETE","streams/"+e).done(function(){t.resolve()}).fail(function(){t.reject()});return t.promise()},create:function(e){var n=new r.Deferred,t=e.context_id||e.contextId,i="resources/"+t+"/streams";if(!e){return}a.rest.call("post",i,e,"application/json").done(function(e,t){var i=t&&t.match(/streams\/(\w+)/);n.resolve(i&&i[1])}).fail(function(){n.reject(arguments)});return n.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(r,a){"use strict";function s(e){try{return new giscloud.Post(e)}catch(e){console.log("Error creating post",err);return null}}giscloud.postTypes={COMMENT:1,DOCUMENT:2,DOODLE:3,LINK:4};giscloud.posts={list:function(e,t){var i="streams/"+e+"/posts",n=new r.Deferred;a.rest.get(i,t).done(function(e){n.resolve(r.map(e.data||[],s))}).fail(function(){n.reject()});return n.promise()},byId:function(e,t){var i="posts/"+e,n=new r.Deferred;a.rest.get(i,t).done(function(e){n.resolve(s(e))}).fail(function(){n.reject()});return n.promise()},update:function(e,t){var i=new r.Deferred,n=this;a.rest.call("PUT","posts/"+e,JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},remove:function(e){var t=new r.Deferred;a.rest.call("DELETE","posts/"+e).done(function(){t.resolve()}).fail(function(){t.reject()});return t.promise()},create:function(e,t){var n=new r.Deferred;if(!t){return}a.rest.call("post","streams/"+e+"/posts",t,"application/json").done(function(e,t){var i=t&&t.match(/posts\/(\w+)/);n.resolve(i&&i[1])}).fail(function(){n.reject(arguments)});return n.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(e,r,t,i){"use strict";function n(e){return r.map(e||[],function(e){return new giscloud.Resource(e)})}function a(e){if(e==null)return null;if(parseInt(e,10).toString()===e)return new Date(e*1e3);return new Date(e)}giscloud.Stream=function e(t){t=t||{};this.id=t.id;this.created=a(t.created);this.modified=a(t.modified);this.owner=t.owner;this.title=t.title;this.description=t.description;this.contextId=t.context_id||t.contextId;this.resources=n(t.resources);this.resourceId=t.resource_id||t.resourceId};giscloud.Stream.prototype={listPosts:function e(t){return giscloud.posts.list(this.id,t)},addPost:function e(t){if(!t||!(t instanceof giscloud.Post))throw"Invalid post";if(t.id!=null)return this.updatePost(t);t.streamId=this.id;return t.update()},updatePost:function e(t){if(!t||!(t instanceof giscloud.Post))throw"Invalid post";if(t.id==null){return this.addPost(t)}if(t.streamId!==this.streamId)throw"Post is not from this stream";return t.update()},update:function e(t){var i=this,n={title:this.title,description:this.description,resources:r.map(this.resources||[],function(e){return e.id}),resource_id:this.resourceId,context_id:this.contextId};if(this.id!=null)return giscloud.streams.update(this.id,n,t);return giscloud.streams.create(n,t).done(function(e){i.id=e})},remove:function e(t){return giscloud.streams.remove(this.id,t)}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,i,t,n){"use strict";function r(e){if(e.id)return new giscloud.Resource(e);return e}giscloud.Post=function e(t){t=t||{};this.id=t.id;this.streamId=t.stream_id||t.streamId;this.created=t.created&&new Date(t.created*1e3);this.modified=t.modified&&new Date(t.modified*1e3);this.owner=t.owner?new giscloud.User(t.owner):t.owner_id;this.type=t.type!=null&&giscloud.postTypes[t.type]||t.type;this.content=t.content;this.resourceId=t.resourceId!=null?t.resourceId:t.resource_id;this.attachments=i.isArray(t.attachments)?i.map(t.attachments,r):[]};giscloud.Post.prototype={update:function e(t){var i=this,n={content:this.content,type:parseInt(this.type),stream_id:this.streamId,attachments:this.attachments};if(this.id==null)return giscloud.posts.create(this.streamId,n).done(function(e){i.id=e});return giscloud.posts.update(this.id,n,t)},remove:function e(t){return giscloud.posts.remove(this.id,t)}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,s,o,t){function l(e){return encodeURIComponent(e).replace(/%2F/g,"/")}giscloud.storage={db:{import:function(e){if(e==null){e={}}if(e.geometryColumns){e.geometry_column_x=e.geometryColumns.x||e.geometryColumns.lon||e.geometryColumns.easting;e.geometry_column_y=e.geometryColumns.y||e.geometryColumns.lat||e.geometryColumns.northing;delete e.geometryColumns}else if(e.geometryColumn){e.geometry_column=e.geometryColumn;delete e.geometryColumn;if(e.geometryFormat){e.geometry_format=e.geometryFormat;delete e.geometryFormat}if(e.geometryType){e.geometry_type=e.geometryType;delete e.geometryType}}else{if(e.geometryColumnX){e.geometry_column_x=e.geometryColumnX;delete e.geometryColumnX}if(e.geometryColumnY){e.geometry_column_y=e.geometryColumnY;delete e.geometryColumnY}}if(e.geometrySRS!=null){e.geometry_srs=e.geometrySRS;delete e.geometrySRS}if(e.ifExists!=null){e.if_exists=e.ifExists||"fail";delete e.ifExists}else{e.if_exists=e.if_exists||"fail"}return o.rest.call("post","storage/db",e,"application/json").promise()}},fs:{list:function(e,t){var i="storage/fs/"+l(e)+"/info",n=new s.Deferred;t=t||{};o.rest.get(i,t).done(function(e){n.resolve(e)}).fail(function(){n.reject()});return n.promise()},get:function(e,t){var i="storage/fs/"+l(e)+"/get",n=new s.Deferred;t=t||{};o.rest.get(i,t).done(function(e){n.resolve(e)}).fail(function(){n.reject()});return n.promise()},update:function(e,t,i){var n=new s.Deferred,r=this,a;a="storage/fs/"+l(e);if(i){a+="?"+s.map(i,function(e,t){return t+"="+e}).join("&")}o.rest.call("PUT",a,JSON.stringify(t),"application/json").done(function(){n.resolveWith(r,[])}).fail(function(){n.rejectWith(r,arguments)});return n.promise()},mkdir:function(e){var n=new s.Deferred,r=this,t="storage/fs/"+l(e)+"/mkdir";o.rest.call("post",t,null,"application/json").done(function(e,t,i){n.resolveWith(r)}).fail(function(){n.rejectWith(r,arguments)});return n.promise()},create:function(e,t){var n=new s.Deferred,r=this,i="storage/fs/"+l(e);o.rest.call("post",i,JSON.stringify(t),"application/json").done(function(e,t,i){n.resolveWith(r)}).fail(function(){n.rejectWith(r,arguments)});return n.promise()},remove:function(e){var t=new s.Deferred,i=this,n="storage/fs/"+l(e);o.rest.call("delete",n).done(function(){t.resolveWith(i)}).fail(function(){t.rejectWith(i,arguments)});return t.promise()}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(s,a){"use strict";giscloud.logs={list:function(e){var t="logs",i=new s.Deferred;e=e||{};e.expand="user,custom";a.rest.get(t,e).done(function(e){i.resolve(e)}).fail(function(){i.reject()});return i.promise()},byUserId:function(e,t,i){var n="users/"+e+"/logs",r=new s.Deferred;a.rest.get(n,t).done(function(e){r.resolve(e)}).fail(function(){r.reject()});return r.promise()},create:function(e){var n=new s.Deferred;if(!e){return}a.rest.call("post","logs",a.toXml("log",e),"text/xml").done(function(e,t){var i=t&&t.match(/logs\/(\w+)/);n.resolve([i&&i[1]])}).fail(function(){n.reject(arguments)});return n.promise()},analytics:{get:function(e){var t="logs/analytics",i=new s.Deferred;e=e||{};e.expand="";a.rest.get(t,e).done(function(e){i.resolve(e)}).fail(function(){i.reject()});return i.promise()}}};giscloud.log={actions:{sign_in:{code:1,desc:"signed in"},sign_out:{code:2,desc:"signed out"},map_create:{code:1001,desc:"created '${map.name}' map",intercom:{alias:"created-map"}},map_update:{code:1002,desc:"updated '${map.name}' map",intercom:{alias:"updated-map"}},layer_new:{code:1003,desc:"added '${layer.name}' layer",intercom:{alias:"added_layer"}},layer_update:{code:1004,desc:"updated '${layer.name}' layer"},share_map_to_user:{code:1005,desc:"shared map",intercom:{alias:"shared-map"}},share_map_remove_user:{code:1006,desc:"unshared map",intercom:{alias:"unshared-map"}},share_map_change_user_access:{code:1007,desc:"changed map access",intercom:{alias:"shared-map"}},share_map_public:{code:1008,desc:"made map public",intercom:{alias:"shared-map"}},layer_export:{code:1009,desc:"exported '${layer.name}' layer "},map_delete:{code:1010,desc:"deleted '${mid}' map"},layer_delete:{code:1011,desc:"deleted '${lid}' layer(s)"},layer_create:{code:1012,desc:"created new '${layer.name}' layer"},csv_import:{code:1013,desc:"imported '${source}' CSV file to '${output}' table"},feature_edit:{code:1014,desc:"updated feature in the '${layer.name}' layer"},feature_add:{code:1015,desc:"added feature in the '${layer.name}' layer",intercom:{alias:"added_feature"}},feature_delete:{code:1016,desc:"deleted feature in the '${layer.name}' layer"},resource_share:{code:1017,desc:"shared resource",intercom:{alias:[{condition:"type",value:100,alias:"shared-map"}]}},resource_unshare:{code:1018,desc:"unshared resource",intercom:{alias:[{condition:"type",value:100,alias:"unshared-map"}]}},tool_set:{code:1019,skipWoopra:true,desc:"Switch tool to '${tool}'"},ui_click:{code:1020,skipWoopra:true,desc:""},form_close:{code:1021,skipWoopra:true},form_open:{code:1022,skipWoopra:true},source_browser_view_type:{code:1023,skipWoopra:true},show_feature_info:{code:1024,skipWoopra:true},assign_license_in_organization:{code:1025,desc:"assigned licence to '${username}'"},remove_license_in_organization:{code:1026,desc:"removed licence to '${username}'"},remove_custom_app_in_manager:{code:1027,desc:"removed custom app with id '${appinstanceid}' in manager"},disable_user_in_organization:{code:1028,desc:"disable user with id '${id}' in organization"},add_new_attr_in_table:{code:1029,desc:"Added new attribute '${attribute}' in table '${table}'"},edit_attr_in_editor:{code:1030,desc:"Edit attribute '${changedattrs}' in layer '${layerid}'"},create_custom_app_in_manager:{code:1031,desc:"Create custom app '${appinstanceid}' in manager",intercom:{alias:"created_custom_app"}},create_user_in_manager:{code:1032,desc:"Create user '${username}' by owner '${owner}' in manager"},rename_file_in_file_manager:{code:1033,desc:"Rename file '${newname}' in file manager by user '${username}'"},rename_table_in_db_manager:{code:1034,desc:"Rename table '${newname}' in db manager by user '${username}'"},custom_app_update_in_manager:{code:1035,desc:"Custom app updated in manager"},create_folder_in_layerlist:{code:1036,desc:"Create folder in layerlist in map '${mapid}'"},remove_file_from_storage:{code:1037,desc:"Remove files '${files}' from storage"},change_email_in_manager:{code:1038,desc:"Change email '${newemail}' in manager"},filemanager_upload:{code:1039,desc:"Upload file '${filename}' in file manager in source '${source}'",intercom:{alias:"uploaded-file"}},delete_project_in_mdcp:{code:1040,desc:"Delete project '${project}' in mdcp"},remove_table_from_db_manager:{code:1041,desc:"Remove table '${tables}' from db manager"},manager_dashboard_visit:{code:1041,desc:"manager dashboard visit"},consent_form_submit:{code:1042,desc:"user successfully submitted the consent form"},map_archive:{code:1050,desc:"user successfully archived map"},map_restore:{code:1051,desc:"user successfully restored map"},"used appearance wizard":{code:1052,desc:"user has successfully used the appearance wizard",intercom:{alias:"used_appearance_wizard"}},"opened appearance window":{code:1053,desc:"user has successfully opened the appearance window",intercom:{alias:"opened_appearance_window"}},"created report":{code:1054,desc:"user created report from layer '${layerId}"},"spatial selection":{code:1055,desc:"user used spatial selection"},"connect to external database":{code:1056,desc:"user has successfully created a connection to external PostGIS database",intercom:{alias:"connected_to_external_database"}},paste_layer_styles:{code:1060,desc:"user clicked on paste layer styles button"},switch_to_3d:{code:1062,desc:"user switched to 3D view",intercom:{alias:"switched_to_3D"}},switch_to_2d:{code:1063,desc:"user switched to 2D view"},mouse_down_with_ctrl:{code:1064,desc:"user pressed mouse down with CTRL key"},choose_subscription:{code:11001,desc:"Chosen subscription"},gt_user_add:{code:12100,desc:"added user (username '${username})'"},gt_device_add:{code:12100,desc:"added device with ID '${gps_device_id}'"},gt_device_edit:{code:12101,desc:"edit device with ID '${gps_device_id}'"},gt_requested_report:{code:12120,desc:"requested a report (report type id = ${report_type})"},gt_switch_to_new_app:{code:12121,desc:"user clicked on 'Switch to new app' button"},oauth_sign_in:{code:1e4,desc:"(OAuth) signed in"},oauth_sign_out:{code:10001,desc:"(OAuth) signed out"},"mdc proj create":{code:20001,desc:"mdc proj create",intercom:{alias:"created-mdc-project"}},"mdc proj option update":{code:20011,desc:"mdc proj option update"},"mdc proj option update failed":{code:20012,desc:"mdc proj option update failed"},"mdc proj name update":{code:20021,desc:"mdc proj name update"},"mdc proj name update failed":{code:20022,desc:"mdc proj name update failed"},"mdc proj item add":{code:20031,desc:"mdc proj item add"},"mdc proj item add failed":{code:20032,desc:"mdc proj item add failed"},"mdc proj item reorder":{code:20041,desc:"mdc proj item reorder"},"mdc proj item reorder failed":{code:20042,desc:"mdc proj item reorder failed"},"mdc proj item rename":{code:20051,desc:"mdc proj item rename"},"mdc proj item rename failed":{code:20052,desc:"mdc proj item rename failed"},"mdc proj item type change":{code:20061,desc:"mdc proj item type change"},"mdc proj item type change failed":{code:20062,desc:"mdc proj item type change failed"},"mdc proj item remove":{code:20071,desc:"mdc proj item remove"},"mdc proj item remove failed":{code:20072,desc:"mdc proj item remove failed"},"mdc proj form definition change":{code:20081,desc:"mdc proj form definition change"},"mdc proj form definition change failed":{code:20082,desc:"mdc proj form definition change failed"},"mdc proj projects button is first click":{code:20091,desc:"mdc proj projects button is first click"},mdc_sign_up:{code:25e3,desc:"signed up to MDC"},mdc_sign_in:{code:25001,desc:"signed in to MDC"},mdc_sign_out:{code:25002,desc:"signed out to MDC"},mdc_insert:{code:25003,desc:"sent new submission"},mdc_update:{code:25004,desc:"updated submission"},mdc_delete:{code:25005,desc:"deleted submission"},mdc_error:{code:25999,desc:"error occured"},"sign up social media -click":{code:3e4,desc:"Came to Sign Up form using social media."},"sign up create account button":{code:30001,desc:"Came to Sign Up form using Create account button."},"sign up step 1":{code:30002,desc:"Open Sign up step 1."},"sign up step 2":{code:30003,desc:"Open Sign up step 2."},"sign up step 3":{code:30004,desc:"Open Sign up step 3."},"sign up step 4":{code:30005,desc:"Open Sign up step 4."},"sign up step 5":{code:30006,desc:"Open Sign up step 5."},"manager visit":{code:30007,desc:"Open Manager after Sign Up."},p2_sign_in:{code:32e3,desc:"signed in"},p2_sign_out:{code:32001,desc:"signed out"},p2_switch_to_old_app:{code:32002,desc:"user returned to p1 app from p2 track web"},_:{}},push:function(t,n,i,e){n=n||{};var r=giscloud.log.actions[t];if(r&&r.code>=1e3){var a=s.extend(true,null,n);delete a.module;delete a.task;delete a.msg;delete a.result;if(!e)giscloud.logs.create({event:r.code,custom:a})}if(!r||r&&!r.skipWoopra){(function e(){if(!window.woopra){if(window.dfdWoopra)window.dfdWoopra.done(function(){giscloud.log.push(t,n,i,true)});return}window.woopra.track(t,n,i)})()}(function e(){var t;if(!window.intercomSettings||!window.intercomWrapper){return}else if(r&&r.intercom&&r.intercom.alias){t=r.intercom.alias;if(typeof t==="string"){window.intercomWrapper.sendEvent(t,n)}else if(Array.isArray(t)){for(var i in t){if(t[i].alias&&t[i].condition!==undefined&&n[t[i].condition]==t[i].value){window.intercomWrapper.sendEvent(t[i].alias,n)}}}}})()},getActionByCode:function(i,e){var n=null;if(e)i=i*1+1e5;s.each(giscloud.log.actions,function(e,t){if(t.code==i){n=t;return true}});return n},formatLogDetails:function(e){var t="";t+=moment.utc(e.time*1e3).local().format("DD/MM/YYYY hh:mm");if(e.log=="log"){t+=" App: "+e.domain}t+=" Device: ";if(e.log=="log"){switch(e.device_type*1){case 1:t+="Computer";break;case 2:t+="Tablet";break;case 3:t+="Mobile";break;default:}}else{t+=e.custom.device_model+" v"+e.custom.device_version}return t},formatLogMsg:function(e){var t,i=giscloud.log.getActionByCode(e.event,e.log=="mdc");t="User '"+e.user.username+"' ";if(i){try{t+=s.tmpl(i.desc,e.custom).text()}catch(e){t+=i.desc}}else{t+="did '"+e.event+"' event"}t+=" "+moment.utc(e.time*1e3).local().fromNow();t+=".";return t}}})(giscloud.exposeJQuery(),giscloud.common());(function(a,s){"use strict";giscloud.organizations={list:function(e){var t="organizations",i=new a.Deferred;s.rest.get(t,e).done(function(e){i.resolve(e)}).fail(function(){i.reject()});return i.promise()},byId:function(e,t,i){var n="/organizations/"+e,r=new a.Deferred;s.rest.get(n,t).done(function(e){r.resolve(e)}).fail(function(){r.reject()});return r.promise()},remove:function(e){var t=new a.Deferred;s.rest.call("DELETE","organizations/"+e).done(function(){t.resolve()}).fail(function(){t.reject()});return t.promise()},create:function(e){var n=new a.Deferred;if(!e){return}s.rest.call("post","organizations",s.toXml("organization",e),"text/xml").done(function(e,t){var i=t&&t.match(/organizations\/(\w+)/);n.resolve([i&&i[1]])}).fail(function(){n.reject(arguments)});return n.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(a,s){"use strict";giscloud.HookType={CREATE:1,READ:2,UPDATE:3,DELETE:4};giscloud.hooks={list:function(e){var t="hooks",i=new a.Deferred;s.rest.get(t,e).done(function(e){i.resolve(e)}).fail(function(){i.reject()});return i.promise()},byId:function(e,t,i){var n="/hooks/"+e,r=new a.Deferred;s.rest.get(n,t).done(function(e){r.resolve(e)}).fail(function(){r.reject()});return r.promise()},remove:function(e){var t=new a.Deferred;s.rest.call("DELETE","hooks/"+e).done(function(){t.resolve()}).fail(function(){t.reject()});return t.promise()},update:function(e,t){var i=new a.Deferred,n=this;s.rest.call("PUT","hooks/"+e,JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},create:function(e){var n=new a.Deferred;if(!e){return}s.rest.call("post","hooks",s.toXml("hook",e),"text/xml").done(function(e,t){var i=t&&t.match(/hooks\/(\w+)/);n.resolve([i&&i[1]])}).fail(function(){n.reject(arguments)});return n.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(e,n,r,t){giscloud.tasks={list:function(e){e=e||{};return r.rest.get("tasks",e).pipe(function(e){if(e&&e.data){if(e.data.length===0){return[]}return n.map(e.data,function(e){return new giscloud.Task(e)})}return null},function(){return null}).promise()},byType:function(e,t){t=t||{};t["type"]=e;return this.list(t)},byId:function(e,t){var i="tasks/"+e;t=t||{};return r.rest.get(i,t).pipe(function(e){try{return new giscloud.Task(e)}catch(e){return null}},function(){return null}).promise()},remove:function(e){return r.rest.call("DELETE","tasks/"+e).pipe(function(){return null},function(){return null}).promise()},create:function(e,t){var i="tasks/";if(t){i+="?"+n.map(t,function(e,t){return t+"="+e}).join("&")}if(e.id!=null){delete e.id}return r.rest.call("post",i,JSON.stringify(e),"application/json").pipe(function(e,t,i){var n=t||i.getResponseHeader("Location"),r=n&&n.match(/tasks\/(\d+)/);return r&&r[1]},function(){return null}).promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t){"use strict";giscloud.permissions={OWNER:"OWNER",READ:"READ",EDIT:"EDIT",EXPORT:"EXPORT",EDIT_MOBILE:"EDIT_MOBILE",EDIT_WITH_SHARE:"EDIT_WITH_SHARE",INSERT:"INSERT",INSERT_MDC:"INSERT_MDC",UPDATE:"UPDATE",UPDATE_MDC:"UPDATE_MDC",DELETE:"DELETE",DELETE_MDC:"DELETE_MDC",SHARE:"SHARE"}})(giscloud.exposeJQuery(),giscloud.common());(function(a,e,t){function i(e,t,i){var n=e.promise,r=Array.prototype.slice.apply(i);return n[t].apply(n,r)}giscloud.Query=function(e,t){this.table=e;this.options=t;this.actions=[]};giscloud.Query.prototype={select:function(e){this.actions.push(["select",[e]]);return this},selectFunction:function(e,t){this.actions.push(["select_function",[e,t]]);return this},where:function(e,t,i){this.actions.push(["where",[e,t,i]]);return this},whereOpen:function(){this.actions.push(["where_open"]);return this},whereClose:function(){this.actions.push(["where_close"]);return this},andWhere:function(e,t,i){this.actions.push(["and_where",[e,t,i]]);return this},andWhereOpen:function(){this.actions.push(["and_where_open"]);return this},andWhereClose:function(){this.actions.push(["and_where_close"]);return this},orWhere:function(e,t,i){this.actions.push(["or_where",[e,t,i]]);return this},orWhereOpen:function(){this.actions.push(["or_where_open"]);return this},orWhereClose:function(){this.actions.push(["or_where_close"]);return this},equalTo:function(e,t){return this.where(e,"=",t)},notEqualTo:function(e,t){return this.where(e,"<>",t)},greaterThan:function(e,t){return this.where(e,">",t)},greaterThanOrEqualTo:function(e,t){return this.where(e,">=",t)},lessThan:function(e,t){return this.where(e,"<",t)},lessThanOrEqualTo:function(e,t){return this.where(e,"<=",t)},limit:function(e){this.actions.push(["limit",[e]]);return this},offset:function(e){this.actions.push(["offset",[e]]);return this},ascending:function(e){this.actions.push(["order_by",[e,"ASC"]]);return this},descending:function(e){this.actions.push(["order_by",[e,"DESC"]]);return this},find:function(){this.actions.push(["find_all"]);this.promise=giscloud.tables.query(this.table,this.toString(),this.options);return this},first:function(){this.actions.push(["find"]);this.promise=giscloud.tables.query(this.table,this.toString(),this.options);return this},count:function(){this.actions.push(["count_all"]);this.promise=giscloud.tables.query(this.table,this.toString(),this.options);return this},join:function(e,t){this.actions.push(["join",[e,t]]);return this},on:function(e,t,i){this.actions.push(["on",[e,t,i]]);return this},delete:function(){this.actions.push(["delete"]);this.promise=giscloud.tables.query(this.table,this.toString(),this.options);return this},set:function(e,t){this.actions.push(["__set",[e,t]]);return this},save:function(){this.actions.push(["save"]);this.promise=giscloud.tables.query(this.table,this.toString(),this.options);return this},saveAll:function(){this.actions.push(["save_all"]);this.promise=giscloud.tables.query(this.table,this.toString(),this.options);return this},groupBy:function(e){this.actions.push(["group_by",[e]]);return this},fail:function(){return i(this,"fail",arguments)},done:function(){return i(this,"done",arguments)},always:function(){return i(this,"always",arguments)},progress:function(){return i(this,"progress",arguments)},then:function(){return i(this,"then",arguments)},each:function(t){return this.promise.done(function(e){a.each(e.data,t)})},toString:function(){return JSON.stringify(this.actions)}};giscloud.Query.or=function(e){var t,i,n,r=new giscloud.Query;if(a.isArray(e)){i=e}else{i=Array.prototype.slice.apply(arguments)}for(n=0;n<i.length;n++){t=i[n];if(t.table&&!r.table)r.table=t.table;if(t.options&&!r.options)r.options=t.options;r.orWhereOpen();r.actions=r.actions.concat(t.actions);r.orWhereClose()}return r}})(giscloud.exposeJQuery(),giscloud.common());(function(s,o){"use strict";giscloud.options={list:function(e){var t;e=e||{};if(s.isNumeric(e)){t="resources/"+e+"/options"}else if(e.resource&&e.id){t=e.resource+"/"+e.id+"/options";delete e.resource;delete e.id}else{t="options"}return o.rest.get(t,e).promise()},byId:function(e,t,i){var n="options/"+e,r=new s.Deferred;t=t||{};if(typeof t==="function"){i=t;t=null}else{i=i||t.callback}o.rest.get(n,t).done(function(){var e=arguments[0],t;try{t=e;if(typeof i=="function"){i(t)}r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},byName:function(e,n,t,r){var i="users/"+e+"/options",a=new s.Deferred;t=t||{};n=n||t.name;t.expand=t.expand||[];if(!s.isArray(t.expand)){t.expand=[t.expand]}if(s.inArray("dependency",t.expand)){t.expand.push("dependency")}o.rest.get(i,t).done(function(){var e=arguments[0],i=[];try{s.each(e.data,function(e,t){if(t.name==n){i.push(t)}});if(typeof r=="function"){r(i)}a.resolve(i)}catch(e){a.reject()}}).fail(function(){a.reject()});return a.promise()},update:function(e,t,i){var n=t.resource+"/"+t.id+"/options/"+e;if(e==null){return this.create(t,i)}return o.rest.call("PUT",n,JSON.stringify(i),"application/json").promise()},remove:function(e){return o.rest.call("DELETE","options/"+e).promise()},create:function(e,t){var i;if(!t){throw"No option data supplied."}if(s.isNumeric(e)){i="resources/"+e+"/options"}else if(e&&e.resource&&e.id){i=e.resource+"/"+e.id+"/options"}else{throw"Bad target definition."}return o.rest.call("post",i,t,"application/json").then(function(e,t){var i=t&&t.match(/options\/(\w+)/);return i&&i[1]})}}})(giscloud.exposeJQuery(),giscloud.common());(function(s,o){"use strict";function r(e){return"?"+s.map(e,function(e,t){if(t=="connectionId"){t="connection_id"}if(t=="noGeometryField"){t="no_geometry_field"}if(t=="perPage"){t="perpage"}return t+"="+e}).join("&")}giscloud.datasources={types:{FOLDER:5,DATABASE:10,DATABASE_ANY:15,TABLE:15,FILE:20,WMS_ANY:40,WMS:50,TMS:60,WFS:70,WMTS:80},typeCodeToTypeName:function e(t){var i=parseInt(t,10);switch(i){case 5:return o.__("Folder");case 15:case 10:return o.__("Table");case 20:return o.__("File");case 40:case 50:return o.__("WMS");case 60:return o.__("TMS");case 70:return o.__("WFS");case 80:return o.__("WMTS");default:return""}},typeNameToTypeCode:function e(t){var i=t.toLocaleLowerCase&&t.toLocaleLowerCase();switch(i){case"folder":return 5;case"database":return 10;case"database_any":return 15;case"table":return 15;case"file":return 20;case"wmts":return 80;case"wms_any":return 40;case"wms":return 50;case"tms":return 60;case"wfs":return 70;case o.__("Folder").toLocaleLowerCase():return 5;case o.__("Table").toLocaleLowerCase():return[10,15];case o.__("File").toLocaleLowerCase():return 20;case o.__("WMTS").toLocaleLowerCase():return 80;case o.__("WMS").toLocaleLowerCase():return[40,50];case o.__("TMS").toLocaleLowerCase():return 60;case o.__("WFS").toLocaleLowerCase():return 70;default:return null}},list:function(e){var t="datasources",i=new s.Deferred;o.rest.get(t,e).done(function(e){i.resolve(e)}).fail(function(){i.reject()});return i.promise()},byId:function(e,t,i){var n="datasources/"+e,r=new s.Deferred;t=t||{};if(typeof t==="function"){i=t;t=null}else{i=i||t.callback}o.rest.get(n,t).done(function(){var e=arguments[0],t;try{t=new giscloud.datasources.Datasource(e);if(typeof i=="function"){i(t)}r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()},update:function(e,t){var i=new s.Deferred,n=this;if(e==null){return this.create(t)}o.rest.call("PUT","datasources/"+e,JSON.stringify(t),"application/json").done(function(){i.resolveWith(n)}).fail(function(){i.rejectWith(n,arguments)});return i.promise()},remove:function(e){var t=new s.Deferred;o.rest.call("DELETE","datasources/"+e).done(function(){t.resolve()}).fail(function(){t.reject()});return t.promise()},create:function(e){var n=new s.Deferred;if(!e){return}o.rest.call("post","datasources",e,"application/json").done(function(e,t){var i=t&&t.match(/datasources\/(\w+)/);n.resolve([i&&i[1]])}).fail(function(){n.reject(arguments)});return n.promise()},columns:function(e,t,i){var n,r=new s.Deferred;if(s.isNumeric(e)){n="datasources/"+e+"/columns"}else{n="datasources/columns?source="+e}t=t||{};if(typeof t==="function"){i=t;t={}}else{i=i||t.callback}o.rest.get(n,t).done(function(){var e=arguments[0];try{if(typeof i=="function"){i(e)}r.resolve(e)}catch(e){r.reject(e)}}).fail(function(e){r.reject(e)});return r.promise()},addColumn:function(e,t,i){var n,r=new s.Deferred;if(!t){return}if(s.isNumeric(e)){n="datasources/"+e+"/columns?"}else{n="datasources/columns?source="+e}if(i){if(i.connid)n+="&connid="+i.connid;if(i.schema)n+="&schema="+i.schema;if(i.type)n+="&type="+i.type}o.rest.call("post",n,o.toXml("column",t),"text/xml").done(function(e,t){var i=t&&t.match(/datasources\/(\w+)/);r.resolve([i&&i[1]])}).fail(function(){r.reject.apply(r,arguments)});return r.promise()},dropColumn:function(e,t,i){var n,r=new s.Deferred,a=this;if(!t){return}if(s.isNumeric(e)){n="datasources/"+e+"/columns?"}else{n="datasources/columns?source="+e}if(i){if(i.connid)n+="&connid="+i.connid;if(i.schema)n+="&schema="+i.schema;if(i.type)n+="&type="+i.type}o.rest.call("DELETE",n,o.toXml("column",t),"text/xml").done(function(){r.resolveWith(a)}).fail(function(){r.reject(arguments)});return r.promise()},updateColumn:function(e,t,i){var n,r=new s.Deferred,a=this;if(!t){return}if(s.isNumeric(e)){n="datasources/"+e+"/columns?"}else{n="datasources/columns?source="+e}if(i){if(i.connid)n+="&connid="+i.connid;if(i.schema)n+="&schema="+i.schema;if(i.type)n+="&type="+i.type}o.rest.call("PUT",n,o.toXml("column",t),"text/xml").done(function(){r.resolveWith(a)}).fail(function(){r.reject(arguments)});return r.promise()},data:{list:function(e,t){var i="datasources/"+e+"/data",n=new s.Deferred;if(t){i+=r(t)}o.rest.get(i).done(function(e){n.resolve(e)}).fail(function(){n.reject(arguments)});return n.promise()},add:function(e,t,i){var n="datasources/"+e+"/data",r=new s.Deferred;if(!t){return}if(i){n+="?"+s.map(i,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}o.rest.call("post",n,o.toXml("datasource",t),"text/xml").done(function(e,t){var i=t&&t.match(/datasources\/data\/(\w+)/);r.resolve(i&&i[1])}).fail(function(){r.reject(arguments)});return r.promise()},remove:function(e,t,i){var n="datasources/"+e+"/data/"+t,r=new s.Deferred;if(i){n+="?"+s.map(i,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}o.rest.call("DELETE",n).done(function(){r.resolve()}).fail(function(){r.reject(arguments)});return r.promise()},update:function(e,i,t,n){var r="datasources/"+e+"/data/"+i,a=new s.Deferred;if(!t){return}if(n){r+="?"+s.map(n,function(e,t){if(t=="connectionId"){t="connection_id"}return t+"="+e}).join("&")}o.rest.call("put",r,JSON.stringify(t),"application/json").done(function(e,t){a.resolve([i])}).fail(function(){a.reject(arguments)});return a.promise()}}}})(giscloud.exposeJQuery(),giscloud.common());(function(e,t,i){var n;giscloud.datasources.Datasource=function(e){n=e;if(n){this.id=n.id;this.resource_id=n.resource_id;this.name=n.name;this.owner=n.owner_id;this.type=n.type;this.epsg=n.epsg&&parseInt(n.epsg,10);this.proj4=n.proj4;this.description=n.description;this.copyright=n.copyright;if(n.type!=15&&n.type!=20){this.params=t.parseJSON(n.params)}else{this.params=n.params}if(n.x_min&&n.x_max&&n.y_min&&n.y_max){this.bounds=new giscloud.Bounds(n.x_min,n.y_min,n.x_max,n.y_max)}}else{n={}}this.share=function(e,t){return giscloud.datasources.share(this.id,e,t)};this.remove=function(){return giscloud.datasources.remove(this.id)};this.update=function(e){return;var t;n.data=this.data;t=this.bounds;that=this;if(t){n.__x_min=t&&t.left;n.__y_min=t&&t.bottom;n.__x_max=t&&t.right;n.__y_max=t&&t.top}if(this.id!=null){return giscloud.datasources.update(this.id,n)}else{return giscloud.datasources.update(n.id,n).done(function(e){that.id=e})}};this.clone=function(){return giscloud.datasources.create(n.data)}}})(window,giscloud.exposeJQuery());(function(a,s){"use strict";var o=null;giscloud.datasources.sfdc={checkAuth:function(e){var t,i;if(e!=null){t="datasources/"+e+"/sfdc/oauth.json"}else if(o!=null){t="datasources/"+o+"/sfdc/oauth.json"}else{throw"No datasource id"}i=new a.Deferred;s.rest.get(t,options).fail(i.reject).done(function(e){if(e.access_token){i.resolve(e)}else{i.reject(e)}});return i.promise()},get:function(e,t){var i;if(typeof e==="string"){if(o!=null){i="datasources/"+o+"/sfdc/"+e}else{throw"No datasource id"}}else{if(e.datasource!=null){i="datasources/"+e.datasource+"/sfdc/"+e.resource}else if(o!=null){i="datasources/"+o+"/sfdc/"+e.resource}else{throw"No datasource id"}}return s.rest.get(i,t).promise()},create:function(e,t,i){var n=new a.Deferred,r;if(e.datasource!=null){r="datasources/"+e.datasource+"/sfdc/"+e.resource}else if(o!=null){r="datasources/"+o+"/sfdc/"+e.resource}else{throw"No datasource id"}return s.rest.call("post",r,JSON.stringify(t),"application/json",i).pipe(function(e,t){if(e.success)return e.id},function(){return null})},remove:function(e,t,i){var n=new a.Deferred,r;if(e.datasource!=null){r="datasources/"+e.datasource+"/sfdc/"+e.resource}else if(o!=null){r="datasources/"+o+"/sfdc/"+e.resource}else{throw"No datasource id"}return s.rest.call("DELETE",r+"/"+t)},datasource:function(e){if(e===undefined){return o}o=e;return this}}})(giscloud.exposeJQuery(),giscloud.common());(function(a,r){"use strict";giscloud.datasources.wms={getFeatureInfo:function(e,t){var i=new a.Deferred,n="layers/"+e+"/getfeatureinfo";r.rest.call("get",n,t,"text/html").done(function(){var e=arguments[0];try{i.resolve(e.responseText)}catch(e){i.reject()}}).fail(function(){var e=arguments[0];i.reject(e.responseText)});return i.promise()},getCapabilities:function(e,t){var i=new a.Deferred,n,r;n="/modules_gc/layer/cwms.php";r={task:"getcapabilities",module:"wms",wms:e,version:t?t:"1.1"};a.ajax({url:n,type:"GET",cache:false,dataType:"json",data:r}).done(function(){var e=Array.prototype.slice.apply(arguments);i.resolve.apply(i,e)}).fail(function(){var e=Array.prototype.slice.apply(arguments);i.reject.apply(i,e)});return i.promise()}};giscloud.datasources.wmts={getCapabilities:function(e,t){var i=new a.Deferred,n,r;n="/datasource/wmts_info";r={url:e,version:t?t:"1.1"};a.ajax({url:n,type:"GET",cache:false,dataType:"json",data:r}).done(function(){var e=Array.prototype.slice.apply(arguments);i.resolve.apply(i,e)}).fail(function(){var e=Array.prototype.slice.apply(arguments);i.reject.apply(i,e)});return i.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(o,l){"use strict";giscloud.spatialrelationship={within:function(e,t,i,n,r){var a="geometry/within",s=new o.Deferred;r=r||{};r.layer1_id=e;r.layer2_id=i;r.feature1_id=t;r.feature2_id=n;l.rest.get(a,r).done(function(e,t,i){s.resolve(i.status==201)}).fail(function(){s.reject()});return s.promise()},intersects:function(e,t,i,n,r){var a="geometry/intersects",s=new o.Deferred;r=r||{};r.layer1_id=e;r.layer2_id=i;r.feature1_id=t;r.feature2_id=n;l.rest.get(a,r).done(function(e,t,i){s.resolve(i.status==201)}).fail(function(){s.reject()});return s.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(e,a,t){function i(e){if(e==null){return null}if(typeof e==="string"){try{return JSON.parse(e)}catch(e){return null}}else{return e}}giscloud.Layer=function(t){var e=[];if(t.sublayers){a.each(t.sublayers,function(){e.push(new giscloud.Layer(this))})}a.extend(this,{id:t.id,resourceId:t.resource_id,name:t.name||null,owner:t.owner,source:i(t.source),datasourceId:t.datasource_id,columns:t.columns||null,onscale:t.onscale||null,offscale:t.offscale||null,label:t.label||null,textfield:t.textfield||null,styles:i(t.styles),alpha:t.alpha||null,encoding:t.encoding||null,margin:t.margin||null,created:t.created&&new Date(t.created*1e3)||null,visible:t.visible||null,lock:t.lock||null,raster:t.raster||null,grp:t.grp||null,exportable:t.exportable!="f",parent:t.parent||null,epsg:t.epsg||null,tooltip:t.tooltip||null,label_placement:i(t.label_placement),mapId:t.map_id||null,type:t.type||null,opened:t.opened,order:t.order,sublayers:e,useInfoWindow:t.use_info_window!=null?t.use_info_window:false,modified:t.modified&&new Date(t.modified*1e3)||null,form:t.form||null,bounds:new giscloud.Bounds(t.x_min,t.y_min,t.x_max,t.y_max)});if(t.datasource){this.datasource={id:t.datasource_id,type:t.datasource.type,owner_id:t.datasource.owner_id,permissions:t.datasource.permissions,resource_id:t.datasource.resource_id}}if(t.analysis){this.analysis={id:t.analysis.id,layer_id:t.analysis.layer_id,type:t.analysis.type,params:t.analysis.params}}if(t.options){this.options=t.options}if(this.form&&typeof this.form.definition==="string"){this.form.definition=JSON.parse(this.form.definition)}this.copyStylesFrom=function(e){var t,i,n,r;r=this;t=new a.Deferred;i=this.styles;giscloud.layers.byId(e).done(function(e){n=e.styles;r.styles=n;t.resolve({newStyles:n,oldStyles:i})}).fail(function(){t.reject()});return t.promise()};this.remove=function(){return giscloud.layers.remove(this.id)};this.update=function(){var e;t.name=this.name||null;t.source=this.source&&JSON.stringify(this.source)||null;t.datasource_id=this.datasourceId||null;t.columns=this.columns||null;t.onscale=this.onscale||null;t.offscale=this.offscale||null;t.label=this.label||null;t.textfield=this.textfield||null;t.alpha=this.alpha||null;t.encoding=this.encoding||null;t.margin=this.margin||null;t.visible=this.visible||null;t.lock=this.lock||null;t.raster=this.raster||null;t.grp=this.grp||null;t.parent=this.parent||null;t.tooltip=this.tooltip||null;t.label_placement=this.label_placement&&JSON.stringify(this.label_placement)||null;t.styles=this.styles&&JSON.stringify(this.styles)||null;t.map_id=this.mapId||null;t.type=this.type||null;t.opened=this.opened;t.order=this.order||null;t.form=this.form;t.use_info_window=this.useInfoWindow!=null?this.useInfoWindow:null;e=this.bounds;if(e&&e.valid()){t.x_min=e.left;t.y_min=e.bottom;t.x_max=e.right;t.y_max=e.top}return giscloud.layers.update(t.id,t)};this.clone=function(){var e={};a.extend(e,t);delete e.id;return giscloud.layers.create(e)};this.reset=function(){return giscloud.layers.reset(this.mapId,[this.id])}};giscloud.Layer.prototype={createBuffer:function(e){return giscloud.layers.createBuffer(this.id,e)}}})(window,giscloud.exposeJQuery());(function(e,t,i){function n(e){if(!e){return}if(typeof e==="number"){e=e*1e3}return new Date(e)}function r(e){var t={};if(e.__score){t.score=e.__score}if(e.__match){t.match=e.__match}if(e.__distance){t.distance=e.__distance}return t}giscloud.Feature=function(e){var i=e,t=r(i);if(i){this.id=i.__id!=null?i.__id:i.id;this.created=n(i.__created);this.modified=n(i.__modified);this.owner=i.__owner;this.layerId=i.__layerId!=null?i.__layerId:i.__layer_id||i.layerId;this.geometry=i.__geometry||i.geometry||null;this.bounds=new giscloud.Bounds(i.__xmin,i.__ymin,i.__xmax,i.__ymax);this.data=i.data||{};this.meta=i.meta;if(Object.keys(t).length>0){this.searchResult=t}}else{i={}}this.remove=function(){return giscloud.features.remove(this.layerId,this.id)};this.update=function(e){var t;i.layerId=this.layerId;i.data=this.data;i.geometry=this.geometry;t=this.bounds;that=this;delete i.__geometry;if(t){i.__x_min=t&&t.left;i.__y_min=t&&t.bottom;i.__x_max=t&&t.right;i.__y_max=t&&t.top}if(this.id!=null){return giscloud.features.update(i.layerId,this.id,i,e)}else{return giscloud.features.update(i.layerId,null,i,e).done(function(e){that.id=e})}};this.clone=function(){return giscloud.features.create(this.layerId,{data:i.data,geometry:i.geometry})}}})(window,giscloud.exposeJQuery());(function(e,n,t,s){giscloud.ViewerLayer=function(e){var t,i;if(e){this.id=parseInt(e.getId().replace(/layer(\d+)/,"$1"),10);i=e.getData();this.sourceId=i&&i.srcId;this.source=i&&i.src;t=e.getBound();this.bounds=t&&new giscloud.Bounds(t.xMin,t.yMin,t.xMax,t.yMax);this.instance=e}else{throw"Invalid arguments."}};giscloud.ViewerLayer.prototype={visible:function(){var e=arguments[0],t;if(n.type(e)=="boolean"){t=this.instance.viewer&&this.instance.viewer.getLayerByName("llayer"+this.id);if(e){this.instance.enable();t&&t.enable()}else{this.instance.disable();t&&t.disable()}return this}else{return this.instance.getVisibility()}},selectable:function(){var e=arguments[0];if(n.type(e)=="boolean"){this.instance.setSelectable(e);return this}else{return this.instance.getSelectable()}},opacity:function(){var e=arguments[0];if(n.type(e)=="number"){this.instance.setAlpha(e);return this}else{return this.instance.getAlpha()}},expressions:function(t){var i=this;if(!this.instance||!this.instance.features)throw"Invalid layer.";return n.map(this.instance.features,function(e){if(t&&t.withExpression&&t.withExpression!=e.expression)return;if(t&&t.withLabel&&t.withLabel!=e.expressionLabel)return;return new giscloud.ViewerLayerExpression(i,e)}).reverse()},redraw:function(){var e;e=this.instance.viewer.getLayerByName("llayer"+this.id);if(e){e.redraw()}this.instance.redraw()},expressionVisible:function(e,t){var i,n,r;if(e==null)throw"No index param provided.";if(!this.instance||!this.instance.features||!this.instance.features[e])throw"Invalid layer expression.";i=this.instance.features.length-e-1;if(t===s)return this.instance.features[i].visible!==false;n=this.instance.viewer.getLayerByName("llayer"+this.id);r=this.instance.features[i].expression;this.instance.features[i].visible=!!t;if(n){for(var a=0;a<n.features.length;a++){if(n.features[a].expression===r){n.features[a].visible=!!t}}n.redraw(true)}this.instance.features[i].visible=!!t;this.instance.calculateFeatureVisibility();this.instance.redraw(true);return this}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var r;giscloud.ViewerLayerExpression=function(e,t){var i,n;if(t){this.instance=t;r=e;this.expression=t&&t.expression;this.label=t&&t.expressionLabel}else{throw"Invalid arguments."}};giscloud.ViewerLayerExpression.prototype={visible:function(e){this.instance.visible=!!e;r.instance.calculateFeatureVisibility();r.instance.redraw();return this}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,c,u,d){giscloud.ViewerSelection=function(e){var r={},a=e,s={},o=0,l=u.oid(),t={};if(e&&e.constructor===giscloud.Viewer){c.extend(this,{add:function(e,t,i){if(r[t]===d){r[t]=[]}if(c.inArray(r[t],e)===-1){r[t].push(e);o++;if(!i){c(s).triggerHandler("featureAdd",[{featureId:e,layerId:t},this])}}return this},highlightSelected:function e(){var i=null,n=null;c.each(r,function(e,t){n=parseInt(e,10);c.each(t,function(e,t){i=parseInt(t,10);u.highlight(a.instance,i,n,false)})});return this},clearHighlight:function e(){u.highlight(a.instance,"",null,true);return this},remove:function(e,t){var i,n=r[t];if(n!==d){i=c.inArray(e,n);if(i>-1){n.splice(i,1);o--;c(s).triggerHandler("featureRemove",[{featureId:e,layerId:t},this])}}return this},toggle:function(e,t){if(this.isSelected(e,t)){this.remove(e,t)}else{this.add(e,t)}return this},clear:function(e){if(e!==d&&r[e]!==d){o-=r[e].length;delete r[e]}else{o=0;r={}}this.clearHighlight();c(s).triggerHandler("selectionClear",[this]);return this},isSelected:function(e,t){return r[t]!==d&&c.inArray(e,r[t])>-1},selected:function(e){var t=[],i=this.add,n=true;if(c.isArray(e)){if(o>0){this.clear()}c.each(e,function(e,t){i(t.featureId,t.layerId,n)});c(s).triggerHandler("multipleFeaturesAdd",[c.map(e,function(e){return{featureId:e.featureId,layerId:e.layerId}}),this]);return this}c.each(r,function(e){c.each(this,function(){t.push({featureId:this,layerId:e})})});return t},count:function(){return o},bind:function(e,t){var i=this,n;if(e&&typeof e=="string"&&typeof t=="function"){n=function(){t.apply(i,Array.prototype.slice.call(arguments,1))};c(s).on(e,n);if(!t.gcunbind){t.gcunbind={}}t.gcunbind[l+e]=n}return this},unbind:function(e,t){var i;if(e&&typeof e=="string"&&typeof t=="function"){i=t.gcunbind&&t.gcunbind[l+e];if(i){c(s).off(e,i)}}return this},featureAdd:function(e){return this.bind("featureAdd",e)},featureRemove:function(e){return this.bind("featureRemove",e)},selectionClear:function(e){return this.bind("selectionClear",e)},ctrlDown:false})}else{throw"Invalid constructor arguments."}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(p,m,g,v){var y=/^layer(\d+)\|\|(\d+)$/,i,o,r,_,b,w,x,C,T,k,M,S,L,D;giscloud.Viewer=function(){var s=this,e=arguments,a=g.oid(),c={},o=["columns","options"],l=new m.Deferred,u,d,t,h,f;if(typeof e[0]==="string"){this.containerId=t=e[0];this.mapId=h=e[1];f=e[2]||{};this.initializing=new m.Deferred;this.loading=new m.Deferred;this.layersLoading=new m.Deferred;f.graphicScalebar=true;if(f.offscreenRendering===true){try{this.offscreenRendering=p.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&new OffscreenCanvas(1,1).transferToImageBitmap&&p.Worker}catch(e){this.offscreenRendering=false}}this.mode=f.mode==="3D"&&giscloud.browserSupportsGL()?"3D":"2D";i.call(this,t,f).done(function(e){var t,i,n,r=s.flashnavigator,a=new C(e);a.plugins={};a.plugins.marker=new T(a);a.plugins.kartehr=new k(a);a.plugins.canvas=new M(a);a.plugins.tooltip=new S(a);a.plugins.kartehr.liveSite("http://www.mapcow.org/");if(f.scalebar){a.plugins.scalebar=new L(a)}if(f.slider){a.plugins.slider=new D(a)}a.enablePanWithMiddleButton();s.instance=a;a.parent=s;a.addEventListener("layerRemoved",m.proxy(_,s));a.addEventListener("load",function(){m.when(u,d).always(function(e,t){if(f.dontWaitForLayers){if(giscloud&&giscloud.layers&&s.mapId!=null){giscloud.layers.byMapId(s.mapId,{expand:o.join(",")}).done(function(e){b(s,e,t,o);s.layersLoading.resolveWith(s,[e,t])}).fail(s.layersLoading.reject)}}b(s,e,t,o);if(e){s.layersLoading.resolveWith(s,[e,t])}s.graphic=new giscloud.Graphic(s);if(!s.selection){s.selection=new giscloud.ViewerSelection(s);s.selection.featureAdd(function(e){g.highlight(s.instance,e.featureId,e.layerId,false);m(c).triggerHandler("selectionChange",{action:"add",feature:e})});s.selection.bind("multipleFeaturesAdd",function(e){var t={},i,n,r;for(i=0,n=e.length;i<n;i++){r=e[i].layerId;if(t[r]===v){t[r]=[e[i].featureId]}else{t[r].push(e[i].featureId)}}for(r in t){if(t.hasOwnProperty(r)){g.highlightMultiple(s.instance,t[r],r,false)}}m(c).triggerHandler("selectionChange",{action:"add",feature:e})});s.selection.featureRemove(function(e,t){var i=m.map(t.selected(),function(e){return"layer"+e.layerId+"||"+e.featureId}).join();g.highlight(s.instance,i,null,true);m(c).triggerHandler("selectionChange",{action:"remove",feature:e})});s.selection.selectionClear(function(){s.instance.modifyObject(null,{},null,true);m(c).triggerHandler("selectionChange",{action:"clear"})})}if(giscloud.proj4){giscloud.proj4.defs("GC_MAP_CURRENT",s.instance.projection)}s.projection=s.instance.projection;s.loading.resolveWith(s,[]);m(c).triggerHandler("loaded",[s]);m(c).triggerHandler("ready",[s])})});a.addEventListener("reload",function(){m.when(u,d).always(function(e,t){if(f.dontWaitForLayers){if(giscloud&&giscloud.layers&&s.mapId!=null){giscloud.layers.byMapId(s.mapId,{expand:o.join(",")}).then(function(e){e=e||[];e=e.sort(function(e,t){if(e.order!=null&&e.order!=null){return parseInt(e.order,10)>parseInt(t.order,10)?1:-1}return 0});return e}).done(function(e){b(s,e,t,o);s.layersLoading.resolveWith(s,[e,t])}).fail(s.layersLoading.reject)}}b(s,e,t,o);if(e){s.layersLoading.resolveWith(s,[e,t])}if(giscloud.proj4){giscloud.proj4.defs("GC_MAP_CURRENT",s.instance.projection)}s.projection=s.instance.projection;s.loading.resolveWith(s,[]);m(c).triggerHandler("reloaded",[s])})});if(s.instance.setLayerFeatureFilter&&r.extraOptions){for(t in r.extraOptions.data){s.instance.setLayerFeatureFilter("layer"+t,r.extraOptions.data[t])}}i=w.call(s,f.filterFeatures);n=x.call(s,f.initialBounds);n.fail(function(){console.warn("Not loading map due to initialBounds error.")});m.when(i,n,l).then(function(e,t){if(h){s.loadMap(h,v,t)}s.initializing.resolveWith(s,[]);m(c).triggerHandler("init",[s])})});this.initializing.done(function(){this.instance.addControlPlaceholders();this.instance.addAttributionControl();if(g.giscloudToolbar){p.toolbarControl=this.instance.addControl(g.giscloudToolbar)}if(g.LocationToolbar){p.locationToolbarControl=this.instance.addControl(g.LocationToolbar)}this.areaMeasure=giscloud.ui.defaultTools.tool("areaMeasure");this.areaMeasure.viewer=this;this.distanceMeasure=giscloud.ui.defaultTools.tool("distanceMeasure");this.distanceMeasure.viewer=this});if(f.graphicScalebar){this.initializing.done(function(){this.instance.addScaleControl()})}}else{g.setError(this,"constructor","Invalid constructor arguments")}this.activeLayer=null;this.markers=[];this.editing=null;m.extend(this,{bind:function(e,n){var r=this,t;if(e&&typeof e==="string"&&typeof n==="function"){switch(e){case"mouseDown":t=function(e){n.call(r,new giscloud.LonLat(e.x,e.y),{containerX:e.containerX,containerY:e.containerY})};this.initializing.done(function(){r.instance.addEventListener("mousedown",t)});break;case"mouseUp":t=function(e){n.call(r,new giscloud.LonLat(e.x,e.y))};this.initializing.done(function(){r.instance.addEventListener("mouseup",t)});break;case"mouseMove":t=function(e){n.call(r,new giscloud.LonLat(e.x,e.y))};this.initializing.done(function(){r.instance.addEventListener("mousemove",t)});break;case"doubleClick":t=function(e){n.call(r,new giscloud.LonLat(e.x,e.y))};this.initializing.done(function(){r.instance.addEventListener("doubleClick",t)});break;case"dragEnd":t=function(){n.call(r)};this.initializing.done(function(){r.instance.addEventListener("dragend",t)});break;case"scaleChange":t=function(e){n.call(r,r.instance.convertScale(e.zoom))};this.initializing.done(function(){r.instance.addEventListener("scalechange",t)});break;case"boundsChange":t=function(e){var t=new giscloud.Bounds(e.bounds.xMin,e.bounds.yMin,e.bounds.xMax,e.bounds.yMax);n.call(r,t)};this.initializing.done(function(){r.instance.addEventListener("boundschange",t)});break;case"featureClick":t=function(e){var t=e.id.match(y),i={layerId:parseInt(t[1],10),featureId:parseInt(t[2],10),key:e.key,attributes:e.object?e.object.attributes:e.attributes};n.call(r,i)};this.initializing.done(function(){r.instance.addEventListener("object_click",t)});break;case"featureDoubleclick":t=function(e){var t=e.id.match(y);n.call(r,{layerId:parseInt(t[1],10),featureId:parseInt(t[2],10),key:e.key,attributes:e.object?e.object.attributes:e.attributes})};this.initializing.done(function(){r.instance.addEventListener("object_dblclick",t)});break;case"featureOver":t=function(e){var t=e.id.match(y);n.call(r,{layerId:parseInt(t[1],10),featureId:parseInt(t[2],10),key:e.key,attributes:e.object?e.object.attributes:e.attributes})};this.initializing.done(function(){r.instance.addEventListener("object_over",t)});break;case"featureOut":t=function(e){var t=e.id.match(y);n.call(r,{layerId:parseInt(t[1],10),featureId:parseInt(t[2],10),key:e.key,attributes:e.object?e.object.attributes:e.attributes})};this.initializing.done(function(){r.instance.addEventListener("object_out",t)});break;case"mapTilesReady":this.initializing.done(function(){r.instance.addEventListener("mapTilesReady",n)});break;case"measure":this.initializing.done(function(){r.instance.on("measure",n)});break;default:t=function(){var e=Array.prototype.slice.call(arguments,1);n.apply(r,e)};m(c).on(e,t);break}if(!n.gcunbind){n.gcunbind={}}n.gcunbind[a+e]=t}return this},getRenderParams:function(e){var u=this,t=e;function d(e){var t=u.instance.calculateScaleZoom(e);return u.instance.convertScale(t)}function h(e,t){var i=e/d(t);return-1*Math.floor(Math.log(i)/Math.log(2))}function i(e){var t,i,n,r,a,s,o,l,c=u.scale();t=h(e,c);i=Math.pow(2,t);n=d(c)/i/e;r=m(u.container());a=r.width()*i;s=r.height()*i;o=Math.round(n*a);l=Math.round(n*s);return{scale:n,width:o,height:l}}return i(t)},unbind:function(e,t){var i=this,n;if(e&&typeof e==="string"&&typeof t==="function"){n=t.gcunbind&&t.gcunbind[a+e];if(n){switch(e){case"mouseDown":this.initializing.done(function(){i.instance.removeEventListener("mousedown",n)});break;case"mouseUp":this.initializing.done(function(){i.instance.removeEventListener("mouseup",n)});break;case"mouseMove":this.initializing.done(function(){i.instance.removeEventListener("mousemove",n)});break;case"doubleClick":this.initializing.done(function(){i.instance.removeEventListener("doubleClick",n)});break;case"dragEnd":this.initializing.done(function(){i.instance.removeEventListener("dragend",n)});break;case"scaleChange":this.initializing.done(function(){i.instance.removeEventListener("scalechange",n)});break;case"boundsChange":this.initializing.done(function(){i.instance.removeEventListener("boundschange",n)});break;case"featureClick":this.initializing.done(function(){i.instance.removeEventListener("object_click",n)});break;case"featureDoubleclick":this.initializing.done(function(){i.instance.removeEventListener("object_dblclick",n)});break;case"featureOver":this.initializing.done(function(){i.instance.removeEventListener("object_over",n)});break;case"featureOut":this.initializing.done(function(){i.instance.removeEventListener("object_out",n)});break;case"measure":this.initializing.done(function(){i.instance.off("measure",n)});break;default:m(c).off(e,n);break}}}return this},fire:function(e,t){m(c).triggerHandler(e,t)},zoomToCurrentLocation:function(n){var e;m(c).triggerHandler("startGeolocation");if(navigator.geolocation==null){console.log("Browser doesn't support geolocation.");m(c).triggerHandler("endGeolocation",{error:"Browser doesn't support geolocation."});return this}if(giscloud.proj4){e=this.loading}else{e=m.when(giscloud.includeJs(g.liveSite()+"libs/proj4js/proj4.js"),this.loading)}e.fail(function(e){m(c).triggerHandler("endGeolocation",{error:e})}).done(m.proxy(function(){var e={enableHighAccuracy:true,timeout:1e4,maximumAge:n?Infinity:2e4},t=function(e){var t;if(e){switch(e.code){case 1:t="No permission to get geolocation.";break;case 2:t="No geolocation available.";break;case 3:t="Geolocation request timed out.";break;default:t="Error acquiring geolocation (code: "+(e.code||"?")+")."}console.log(t);m(c).triggerHandler("endGeolocation",{error:t});if(e.message){console.log(e.message)}}else{console.log("Error acquiring geolocation.");m(c).triggerHandler("endGeolocation",{error:"Error acquiring geolocation."})}},i=m.proxy(function(e){var t={x:e.coords.longitude,y:e.coords.latitude},i=Math.max(e.coords.accuracy,70),n=this.bounds(),r,a,s,o=p.navigator.userAgent,l=o.indexOf("MSIE ");if(typeof this.projection==="string"){giscloud.proj4.defs("GC_MAP_CURRENT",this.projection)}t=giscloud.proj4("EPSG:4326",this.projection,t);if(l>0){return this.center(new giscloud.LonLat(t.x,t.y),11)}if(!i){return this.center(new giscloud.LonLat(t.x,t.y))}n.center(new giscloud.LonLat(t.x,t.y));if(this.projection.units==="degrees"){if(this.projection.a){if(this.projection.b){a=(this.projection.a+this.projection.b)/2}else{a=this.projection.a}}r=g.haversine(n.top,n.left,n.bottom,n.right,a);s=r/2/i;i=Math.max(n.width(),n.height())/s}else{i=giscloud.fromMeters(this.projection.units,i)}if(n.width()>n.height()){n.height(i*3,true)}else{n.width(i*3,true)}this.bounds(n);m(c).triggerHandler("endGeolocation",{bounds:n,center:n.center(),radius:i})},this);navigator.geolocation.getCurrentPosition(i,t,e)},this));return this},addLayersExpandParam:function(){var e=Array.prototype.slice.call(arguments),t=Array.prototype.concat.apply([],e),i;for(i=t.length-1;i>=0;i--){if(o.indexOf(t[i])===-1){o.push(t[i])}}},removeLayersExpandParam:function(){var e=Array.prototype.slice.call(arguments),t=Array.prototype.concat.apply([],e),i,n;for(i=t.length-1;i>=0;i--){n=o.indexOf(t[i]);if(n>-1){o.splice(n,1)}}},getXmlUrl:function(e){var t=[],i=g.liveSite()+"maps/map"+(e||this.mapId)+".xml",n;if(f.silentAccess){t.push("silent_access")}if(giscloud.oauth2){n=giscloud.oauth2.token();if(n){t.push("oauth_token="+n)}}n=giscloud.apiKey();if(n){t.push("api_key="+n);if(g.https()&&g.liveSite().indexOf("http://giscloud.local")!==0){i=i.replace("http:","https:")}}if(t.length>0)i+="?"+t.join("&");return i},loadLayersAndStates:function(){if(giscloud&&giscloud.layers&&this.mapId!=null&&!f.dontWaitForLayers){u=giscloud.layers.byMapId(this.mapId,{expand:o.join(",")}).then(function(e){e=e||[];e=e.sort(function(e,t){if(e.order!=null&&e.order!=null){return parseInt(e.order,10)>parseInt(t.order,10)?1:-1}return 0});return e})}else{u=m.Deferred().resolve(null)}if(giscloud&&giscloud.userOptions&&this.mapId!=null&&f.userLayerStates){d=giscloud.userOptions.byName("MAP_"+this.mapId+"_LAYERS_STATES").then(function(e){var t;try{t=e&&e.value&&JSON.parse(e.value);if(!t){return{}}return t}catch(e){return{}}},function(){return m.Deferred().resolve({})})}else{d=m.Deferred().resolve({})}return m.when(u,d)}});l.resolve()};m.extend(giscloud.Viewer.prototype,{loadMap:function(e,t,i){var n,r,a;if(!this.instance){g.setError(this,"loadMap","No viewer instance.");return this}if(!e){g.setError(this,"loadMap","Invalid map id.");return this}n=this.getXmlUrl(e);if(this.loading.state()!=="pending"){this.loading=new m.Deferred}if(this.layersLoading.state()!=="pending"){this.layersLoading=new m.Deferred}this.instance.src(true);if(i){a=i;if(!m.isFunction(a.valid)){a=new giscloud.Bounds(a.left,a.bottom,a.right,a.top)}if(a.valid()){a={xMin:a.left,yMin:a.top,xMax:a.right,yMax:a.bottom}}else{console.warn("Initial bounds are not valid.",i);a=null}}this.mapId=e;var s=this;this.loadLayersAndStates().always(function(){s.instance.load(n,false,t,a)});return this},reloadMap:function(e){var t,i;if(!this.instance){g.setError(this,"reloadMap","No viewer instance.");return this}if(!this.mapId){g.setError(this,"reloadMap","Invalid map id.");return this}t=this.getXmlUrl();if(this.loading.state()!=="pending"){this.loading=new m.Deferred}if(this.layersLoading.state()!=="pending"){this.layersLoading=new m.Deferred}var n=this;this.loadLayersAndStates().always(function(){if(e){n.instance.unload()}n.instance.reload(t)});return this},ready:function(e){return this.bind("ready",e)},mapTilesReady:function(e){return this.bind("mapTilesReady",e)},init:function(e){return this.bind("init",e)},mouseDown:function(e){return this.bind("mouseDown",e)},mouseUp:function(e){return this.bind("mouseUp",e)},mouseMove:function(e){return this.bind("mouseMove",e)},doubleClick:function(e){return this.bind("doubleClick",e)},dragEnd:function(e){return this.bind("dragEnd",e)},scaleChange:function(e){return this.bind("scaleChange",e)},boundsChange:function(e){return this.bind("boundsChange",e)},featureClick:function(e){return this.bind("featureClick",e)},featureDoubleclick:function(i){this.initializing.done(function(){this.instance.addEventListener("object_dblclick",function(e){var t=e.id.match(y);i({layerId:t[1],featureId:t[2],key:e.key,attributes:e.object?e.object.attributes:e.attributes})})});return this},featureOver:function(i){this.initializing.done(function(){this.instance.addEventListener("object_over",function(e){var t=e.id.match(y);i({layerId:t[1],featureId:t[2],key:e.key,attributes:e.object?e.object.attributes:e.attributes})})});return this},featureOut:function(i){this.initializing.done(function(){this.instance.addEventListener("object_out",function(e){var t=e.id.match(y);i({layerId:t[1],featureId:t[2],key:e.key,attributes:e.object?e.object.attributes:e.attributes})})});return this},selectionChange:function(e){return this.bind("selectionChange",e)},container:function(e){if(e===v){return m("#"+this.containerId)[0]}else{m("#"+e).append(m("#"+this.containerId).detach());this.containerId=e;return this}},width:function(e){if(e!==v){m("#"+this.containerId).width(e);if(this.instance){this.instance.invalidateSize()}return this}else{return m("#"+this.containerId).width()}},height:function(e){if(e!==v){m("#"+this.containerId).height(e);if(this.instance){this.instance.invalidateSize()}return this}else{return m("#"+this.containerId).height()}},bounds:function(e,t){var i;if(e!==v){this.loading.done(function(){this.instance.setViewBound(e.left,e.bottom,e.right,e.top,null,!t)});return this}else{i=this.instance.getViewBound();return new giscloud.Bounds(i.xMin,i.yMin,i.xMax,i.yMax)}},center:function(t,i,n,r){if(t!==v){if(!t||!(t instanceof giscloud.LonLat)){throw"Parameter 'center' should be a giscloud.LonLat instance."}else{this.loading.done(function(){var e=this.bounds();if(e&&e.center()){this.instance.setLocation(t.lon,t.lat,i,n,r)}else{throw"Viewer bounds are not set."}});return this}}else{var e=this.instance.getCenter();return new giscloud.LonLat(e.x,e.y)}},scale:function(e){if(e!==v){if(!isFinite(e)){throw"Parameter 'scale' should be a finite number."}else{this.loading.done(function(){this.instance.setScale(e)});return this}}else{return this.instance.getScale()}},bearing:function(e){if(e!==v){if(!isFinite(e)){throw"Parameter 'bearing' should be a finite number."}else{this.loading.done(function(){this.instance.setBearing(e)});return this}}else{return this.instance.getBearing()}},pitch:function(e){if(e!==v){if(!isFinite(e)){throw"Parameter 'pitch' should be a finite number."}else{this.loading.done(function(){this.instance.setPitch(e)});return this}}else{return this.instance.getPitch()}},showLayer:function(i){var e;e=this.layers.reduce(function(e,t){if(e){return e}if(t.id===i){e=t}return e},null);if(e){e.visible(true);this.showLayerLabels(i)}return this},hideLayer:function(i){var e;e=this.layers.reduce(function(e,t){if(e){return e}if(t.id===i){e=t}return e},null);if(e){e.visible(false);this.hideLayerLabels(i)}return this},showLayerLabels:function(e){giscloud.util.mediator.publish("labels/show",e);var t="llayer"+e,i=this.instance.getLayerByName(t);if(i){i.enable()}},hideLayerLabels:function(e){giscloud.util.mediator.publish("labels/hide",e);var t="llayer"+e,i=this.instance.getLayerByName(t);if(i){i.disable()}},layerById:function(e){var t,i,n;if(this.loading.state()==="resolved"){n=parseInt(e,10);for(t=0,i=this.layers.length;t<i;t++){if(this.layers[t].id===n){return this.layers[t]}}}return null},showTip:function(e,t){var i=this.instance.plugins.tooltip;this.initializing.done(function(){i.show(e,t)});return this},hideTip:function(){var e=this.instance.plugins.tooltip;this.initializing.done(function(){e.hide()});return this},addMarker:function(h){this.loading.done(function(){var u=this.instance.plugins.marker,n,e,t,i,l,d;l=function(e,t,i,n,r,a){var s,o,l,c;o=h.rotation();l=h.label();c=h.clickable();i=i||"";n=n?d(i,n):"";if(t.url!=null){s=a.loadPoi(e.lon,e.lat,t.url,{hoverText:i,popupContent:n,popupVisible:r},c,t.width,t.height,v,t.anchor)}else{s=a.loadPoi(e.lon,e.lat,t,{hoverText:i,popupContent:n,popupVisible:r},c);if(l){a.attachLabel({marker:s,data:l})}if(o){a.move(s,e.lon,e.lat,o)}}u.ready(s).done(function(e){if(!e._popup)return;if(h._popupCloseHandler){e._popup.on("close",h._popupCloseHandler)}if(h._popupOpenHandler){e._popup.on("open",h._popupOpenHandler)}});return s};d=function(e,t){var i=m("<div/>");if(e){i.append(m("<div/>",{class:"gc-info-popup-title"}).html(e))}if(t){i.append(m("<div/>",{class:"gc-info-popup-content"}).html(t))}return i.html()};i=function(e,t){var i=this.instance.plugins.marker,n=t.state,r=n.marker,a=r._id||null,s=t.newValue,o=r.location();if(t.oldValue===s){return}switch(t.property){case"location":if(s&&s instanceof giscloud.LonLat&&s.valid()&&r.visible()){if(a){i.move(a,s.lon,s.lat)}else{r._id=l(s,r.icon(),r.title(),r.content(),r.popup(),i)}}else{a&&i.remove(a);r._id=null}break;case"rotation":if(a){i.move(a,o.lon,o.lat,s)}break;case"visible":if(s&&o&&o instanceof giscloud.LonLat&&o.valid()){r._id=l(o,r.icon(),r.title(),r.content(),r.popup(),i)}else{a&&i.remove(a);r._id=null}break;case"popup":if(a){i.remove(a);r._id=l(o,r.icon(),r.title(),r.content(),s,i)}break;case"title":if(a){i.remove(a);r._id=l(o,r.icon(),s,r.content(),r.popup(),i)}break;case"content":if(a){i.remove(a);r._id=l(o,r.icon(),r.title(),s,r.popup(),i)}break;case"icon":if(a){i.remove(a);r._id=l(o,s,r.title(),r.content(),r.popup(),i)}break;case"label":if(a){if(s){i.attachLabel({marker:a,data:s})}else{i.remove(a);r._id=l(o,r.icon(),r.title(),r.content(),r.popup(),i)}}break;default:}};if(h instanceof giscloud.Marker){t=h.location();e=h.visible();ico=h.icon()||null;this.markers.push(h);m(h).on("stateChanged",m.proxy(i,this));h._popupCloseHandler=function(){h.popup(false,true)};h._popupOpenHandler=function(){h.popup(true,true)};if(e&&t&&t instanceof giscloud.LonLat&&t.valid()){h._id=l(t,ico,h.title(),h.content(),h.popup(),u)}}else if(h instanceof giscloud.FlagMarker){n=h.sig;if(n&&g.markers[n].m){throw"This marker has already been added to a viewer."}else{h.sig="m"+g.oid();n=h.sig;if(!g.markers){g.markers={}}g.markers[n]={m:u};e=h.visible();t=h.position();if(e&&t){g.markers[n].id=u.add(t.lon,t.lat,h.color().hex("0x"),h.title(),h.content(),null,true)}else{g.markers[n].id=null}this.markers.push(h);g.markers[n].open=true;g.markers[n].openCloseHandler=function(e,t,i){if(g.markers[n]){g.markers[n].open=i}};g.markers[n].initHandler=function(){u.getObject(g.markers[n].id).on("toggle",g.markers[n].openCloseHandler);g.markers[n].initHandler=null};if(g.markers[n].id){g.markers[n].initHandler()}}}else if(h instanceof giscloud.LabelMarker){n=h.sig;if(n&&g.markers[n].m){throw"This marker has already been added to a viewer."}h.sig="m"+g.oid();n=h.sig;if(!g.markers){g.markers={}}g.markers[n]={m:u,label:{className:"gc-map-tip",type:"div"}};t=h.location();e=h.visible();this.markers.push(h);m(h).on("stateChanged",m.proxy(r,this));if(e&&t&&t instanceof giscloud.LonLat&&t.valid()){t=this.instance.toInternalCoords(t.lon,t.lat);g.markers[n].marker=this.instance.newMarker(t,{icon:g.markers[n].label,clickable:false},h.content()||"");this.instance.addComponentToMap(g.markers[n].marker)}}else{throw"Not a giscloud marker."}});return this},removeMarker:function(n){this.loading.done(function(){var e=this.instance.plugins.marker,t;if(n instanceof giscloud.Marker){if(n._id){var i=e.getObject(n._id);if(i._popup){if(n._popupCloseHandler){i._popup.off("close",n._popupCloseHandler);n._popupCloseHandler=null}if(n._popupOpenHandler){i._popup.off("open",n._popupOpenHandler);n._popupOpenHandler=null}}e.remove(n._id)}t=m.inArray(n,this.markers);if(t>-1){this.markers.splice(t,1)}}else if(n instanceof giscloud.FlagMarker){if(n.sig&&g.markers[n.sig].m===e){if(e.getObject(g.markers[n.sig].id))e.getObject(g.markers[n.sig].id).off("toggle",g.markers[n.sig].openCloseHandler);g.markers[n.sig].m.remove(g.markers[n.sig].id);delete g.markers[n.sig].openCloseHandler;delete g.markers[n.sig];t=m.inArray(n,this.markers);if(t>-1){this.markers.splice(t,1)}delete n.sig}else if(n.sig){throw"This is not a marker which belongs to this viewer."}}else if(n instanceof giscloud.LabelMarker){if(n.sig&&g.markers[n.sig].m===e){g.markers[n.sig].marker.remove();delete g.markers[n.sig];t=m.inArray(n,this.markers);if(t>-1){this.markers.splice(t,1)}delete n.sig;m(n).off("stateChanged",r)}else if(n.sig){throw"This is not a marker which belongs to this viewer."}}else{throw"Not a giscloud marker."}});return this},createAsMaplimProject:function(e){var t=new m.Deferred;if(!this.options||!this.options.EMBLIM_PROJECT||this.options.EMBLIM_PROJECT!=="1"){giscloud.options.create({resource:"maps",id:e},{option_name:"EMBLIM_PROJECT",option_value:"1"}).done(function(){t.resolve()}).fail(function(){t.reject()})}else{t.resolve()}return t.promise()},openInMaplim:function(){var t=parseInt(this.mapId,10),i;this.createAsMaplimProject.call(this,t).done(function(){giscloud.maps.byId(t).done(function(e){i=getUrlFromAppName("maplim");i+="map/"+t+"/"+e.name;p.open(i)})}).fail(function(){alert("Problem with opening map in Maplim! You don't have edit rights for this map. Please contact owner of the map!")})},fullExtent:function(){var e=this.instance;this.loading.done(function(){e.setViewBound()});return this},measure:function(){var e=this;this.loading.done(function(){e.select(false);e.instance.setTool("MeasureTool")});return this},areaZoom:function(){var e=this;this.loading.done(function(){e.select(false);e.instance.setTool("SelectAreaTool")});return this},pan:function(){var e=this;this.loading.done(function(){e.select(false);e.instance.setTool("DragTool")});return this},zoomToLayer:function(t){var i=this;this.loading.done(function(){var e=i.layerById(t);if(e){i.bounds(e.bounds)}});return this},select:function(e){var l=this,t;if(e===true){this.instance.setTool("DragTool");this.instance.enableSelection();t=m(this).data("selectFeatureClickCallback");if(!t){t=function(e){var t=e.id.match(y),i=parseInt(t[2],10),n=parseInt(t[1],10),r=e.key===17,a=l.selection,s=l.instance,o=function(e,t,i){g.highlight(s,e,t,i)};if(r||a.ctrlDown){if(a.isSelected(i,n)){s.demodifyObjectsColor();a.remove(i,n);m.each(l.selection.selected().slice(0),function(){var e=this.featureId.toString(),t=this.layerId.toString();o(e,t,false)})}else{o(i,n,false);a.add(i,n)}}else{if(a.isSelected(i,n)&&a.count()===1){s.demodifyObjectsColor();a.remove(i,n)}else{a.clear();o(i,n,true);a.add(i,n)}}};m(this).data("selectFeatureClickCallback",t)}this.instance.addEventListener("object_click",t)}else if(e===false){this.instance.disableSelection();this.instance.removeEventListener("object_click",m(this).data("selectFeatureClickCallback"))}else{return!!(this.instance&&this.instance.selectionEnabled)}return this},selectFeature:function(e,t,i){var n=this.selection,r=n.isSelected(t,e),a=parseInt(t,10),s=parseInt(e,10),o=this;i=i===false?false:true;this.loading.done(function(){if(r&&!i){o.instance.demodifyObjectsColor();n.remove(a,s);m.each(n.selected().slice(0),function(){var e=this.featureId.toString(),t=this.layerId.toString();g.highlight(o.instance,e,t,false)})}else if(!r&&i){g.highlight(o.instance,a,s,false);n.add(a,s)}});return this},selectFeaturesByBounds:function(r,e,t){this.loading.done(function(){var n=this;if(t){this.instance.demodifyObjectsColor();this.selection.clear()}if(r!==null||r!==v){giscloud.features.byBounds(r,e).done(function(e){var t,i;for(t=0,i=e.length;t<i;t++){if(e[t].id!==v){n.selectFeature(r,e[t].id,true)}}})}})},editFeature:function(n,e,r){var a=this,t=this.editing,i,s;if(o(t)){i=m.proxy(t.fail,t);this.editCancel()}else{i=m.proxy(this.loading.done,this.loading)}s=new m.Deferred;r=r||{};i(function(){if(n==null||a.layerById(n)==null){s.reject("Invalid layer id");return}if(e==null){return}a.select(false);s.always(function(){a.select(true)});giscloud.features.byId(n,e,{geometry:"wkt"}).fail(function(){s.reject("Unknown feature")}).done(function(t){var e=giscloud.geometry.fromOGC(t.geometry),i=e&&new giscloud.GraphicFeature(e);if(!i){s.reject("Invalid feature geometry");return}if(i.geometry()instanceof giscloud.geometry.Line){i.style({size:5})}p.editGraphic=i;a.graphic.add(i).edit(i).fail(function(){s.reject("Cancelled")}).done(function(e){giscloud.features.update(t.layerId,t.id,{geometry:e.toOGC()},{use_map_srid:true}).done(function(){var e={};if(r&&r.cascade){e.cascade=true}if(r.dontReset){s.resolve()}else{giscloud.layers.reset(a.mapId,[n],e).always(function(){s.resolve()}).done(function(){a.instance.reload()})}}).fail(function(){s.reject("Error updating feature")})});s.always(function(){a.graphic.remove(i)})})});this.editing=s;return s.promise()},editAccept:function(){if(o(this.editing)){this.graphic.editAccept()}return this},editCancel:function(){if(o(this.editing)){this.graphic.editCancel()}return this},filterFeatures:function(r,a){var s=this;this.initializing.done(function(){var e,t,i,n=a?a.filter:v;if(n&&!a.context){console.warn("[giscloud] filterFeatures method requires context property to "+"be set when filter function is used. Use context property to have "+"data transfered to your filter function (as second argument). "+"Functions that depend on scope outside them will be deprecated.")}if(r){e="layer"+r,s.instance.setLayerFeatureFilter(e,a);t=s.instance.getLayerByName(e);i=t.filterFunction!=n;t.filterFunction=n;if(t&&i){t.redraw()}labelLayerName="llayer"+r,labelLayerObject=s.instance.getLayerByName(labelLayerName);if(t===0&&labelLayerObject===0){s.instance.setLayerFeatureFilter(labelLayerName,a)}else if(labelLayerObject){s.instance.setLayerFeatureFilter(labelLayerName,a);if(i){labelLayerObject.redraw()}}}})},changeMode:function(e,t){if(["3D","2D"].indexOf(e)===-1){throw"Invalid map mode"}this.instance.changeMode(e,t)},getMode:function(){return this.instance.getMode()}});giscloud.Viewer.__googleMapsApiLoaded=new m.Deferred;o=function(e){return e&&e.state()==="pending"};b=function(e,t,i,n){var r,a,s,o,l,c,u,d,h,f=/^layer(\d+)$/,p=[],g=e.instance;layerIndex={};e.layers=[];if(t&&t.length===2&&m.isArray(t[0])&&m.isNumeric(t[1])){t=t[0]}if(t&&t.length){for(l=0,d=t.length;l<d;l++){p.push(t[l]);if(t[l].sublayers&&t[l].sublayers.length){for(c=0,u=t[l].sublayers.length;c<u;c++){p.push(t[l].sublayers[c])}}}}try{for(l=0,c=g.getLayerCount();l<c;l++){a=g.getLayer(l);r=a.getId();u=r.match(f);if(u){r=u[1];layerIndex[r]=l;a=new giscloud.ViewerLayer(a);o=i&&i[r.toString()];if(o&&o.v!=null){a.visible(o.v)}if(o&&o.e!=null){a.expressions().forEach(function(e){var t=e.expression||"<empty>",i=o.e[t];if(i!=null){e.visible(i)}})}e.layers.push(a)}}if(p.length){for(l=0,d=p.length;l<d;l++){s=p[l];for(h=0;h<e.layers.length;h++){if(parseInt(s.id)===e.layers[h].id){a=e.layers[h];break}else{a=null}}if(a){o=i&&i[a.id.toString()];a.name=s.name;a.type=s.type;a.source=s.source.src||s.source.layer||s.source.service_name||"";a.sourceType=s.source.type;a.datasourceId=s.datasourceId;if(s.options){for(h=0,u=s.options.length;h<u;h++){if(s.options[h].option_name=="SUPPORT_INCOMPLETE_TILE_COVERAGE"&&s.options[h].option_value=="1"){a.instance.incompleteTileCoverage=true;break}}}a.opacity(s.alpha);m.each(n||[],function(e,t){a[t]=s[t]});if(!o||o.v==null){a.visible(s.visible==="t")}if(s.visible){a.visible(s.visible)}if(!o||o.l==null){a.selectable(s.lock==null||s.lock!=="t")}else{a.selectable(!o.l)}}}}}catch(e){console.log(e)}m.data(e,"layerIndex",layerIndex);giscloud.util.mediator.publish("labels/redraw")};_=function(e){var t=e&&e.id.match(/^layer(\d+)$/)[1],i=m.data(this,"layerIndex"),n=i[t],r;if(!isNaN(n)){this.layers.splice(n,1);i={};for(n=0,r=this.layers.length;n<r;n++){i[this.layers[n].id]=n}m.data(this,"layerIndex",i)}};r=function(e,t){var i=t.state,n=i.marker,r=n.sig,a=t.newValue,s=n.location();if(t.oldValue===a){return}switch(t.property){case"location":if(a&&a instanceof giscloud.LonLat&&a.valid()&&n.visible()){s=this.instance.toInternalCoords(s.lon,s.lat);if(g.markers[r].marker){g.markers[r].marker.setLatLng(s)}else{g.markers[r].marker=this.instance.newMarker(s,{icon:g.markers[r].label,clickable:false},i.content||"");this.instance.addComponentToMap(g.markers[r].marker)}}else{if(g.markers[r].marker){g.markers[r].marker.remove();g.markers[r].marker=null}}break;case"visible":if(a&&s&&s instanceof giscloud.LonLat&&s.valid()){s=this.instance.toInternalCoords(s.lon,s.lat);g.markers[r].marker=this.instance.newMarker(s,{icon:g.markers[r].label,clickable:false},i.content||"");this.instance.addComponentToMap(g.markers[r].marker)}else{g.markers[r].marker.remove();g.markers[r].marker=null}break;case"content":if(g.markers[r].marker){g.markers[r].marker.html(a)}break;default:}};i=function(e,t,i){var n="tooltip,marker,kartehr,canvas",r=new m.Deferred,a=this;t=t||{};this.flashnavigator=p.createFlashnavigator();this.flashnavigator.offscreenRendering=this.offscreenRendering;this.html5Map=new g.LegacyHtml5Map(this.flashnavigator);if(t.scalebar){n+=",scalebar"}if(t.slider){n+=",slider"}if(t.flashnavigatorInclude){n=t.flashnavigatorInclude}this.flashnavigator.include(n);this.flashnavigator.setOptions(t);if(g.deferreds.flashnavigator===v){g.deferreds.flashnavigator={}}g.deferreds.flashnavigator[e]=r;r.done(i||null);this.flashnavigator.container(this,e,{onLoad:function(e){C=a.flashnavigator.legacyObjects.fnViewer;T=a.flashnavigator.legacyObjects.fnMarker;k=a.flashnavigator.legacyObjects.fnKartehr;M=a.flashnavigator.legacyObjects.fnCanvas;S=a.flashnavigator.legacyObjects.fnTooltip;L=a.flashnavigator.legacyObjects.fnScalebar;D=a.flashnavigator.legacyObjects.fnSlider;r.resolve(e)}});return r};w=function e(t){var i,n,r=this;if(!t)return m.Deferred().resolve();try{if(typeof t==="function"){i=t();if(!i)return m.Deferred().resolve();if(typeof i.then==="function"){n=i}else{n=m.Deferred().resolve(i)}}else{n=m.Deferred().resolve(t)}n.done(function(e){if(!e)return;m.each(e,function(e,t){r.filterFeatures(e,t)})});return n}catch(e){console.error("Error applying the filterFeatures option",e);return m.Deferred().reject()}};x=function e(t){var i,n;if(typeof t!=="function"){return m.Deferred().resolve(t)}try{i=t();return i&&typeof i.then==="function"?i:m.Deferred().resolve(i)}catch(e){console.error("Error applying the filterFeatures option",e);return m.Deferred().reject()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(c,u,d,h){var f,b,p;d.deferreds.leafletLoading=new u.Deferred;if(c.L&&c.L.Map){b=c.L;d.deferreds.leafletLoading.resolve()}giscloud.exposeLeaflet=function(){return b};d.ViewerLeaflet=function(t,e,i){var r,_,a,s,n,o;r=this;s=d.oid();_={options:i};a={};_.layers=[];_.viewer=t;this.modeId="2D";if(d.deferreds.leafletLoading.state()!=="resolved"){giscloud.includeJs(d.assetsSite()+"libs/leaflet-git/"+giscloud_config.leafletScript(),function(){if(c.L){b=c.L;d.deferreds.leafletLoading.resolve()}else{d.deferreds.leafletLoading.reject();d.deferreds.leafletLoading=new u.Deferred}});if(!p){if(u.browser.msie&&parseFloat(u.browser.version)<9&&!("opacity"in document.createElement("div").style)){o=u.when(giscloud.includeCss(d.assetsSite()+"libs/leaflet-git/leaflet.css"),giscloud.includeCss(d.assetsSite()+"libs/leaflet-git/leaflet.ie.css"),giscloud.includeCss(d.assetsSite()+"assets/api/1/viewer/leaflet/viewer.leaflet.css"),giscloud.includeCss(d.assetsSite()+"assets/api/1/viewer.css"))}else{o=u.when(giscloud.includeCss(d.assetsSite()+"libs/leaflet-git/leaflet.css"),giscloud.includeCss(d.assetsSite()+"assets/api/1/viewer/leaflet/viewer.leaflet.css"),giscloud.includeCss(d.assetsSite()+"assets/api/1/viewer.css"))}o.done(function(){p=true})}}this.init=new u.Deferred;this.init.done(function(){r.map=_.map;r.container=_.map._container;this.overrideLeafletAddLayer();this._control=new d.ViewerLeafletControl(_);_.map.on("zoomend",function(){u(a).triggerHandler("scaleChanged")});_.map.on("zoomstart",function(){_.viewer.html5Map.html5ResetLoaders()})});function l(t,e,i){var n,r;if(u.isArray(e)){return u.map(e,function(e){return[l(t,e,i)]})}else if(e instanceof b.LatLng){r=t.fromInternalCoords(e);if(i){r.z=r.z||0}return r}else if(e instanceof b.Marker){r=t.fromInternalCoords(e.getLatLng());if(i){r.z=r.z||0}return r}else if(e instanceof b.Polygon){n=e.getLatLngs();if(u.isArray(n[0])){return new giscloud.geometry.Polygon(u.map(n,function(e){return new giscloud.geometry.Line(u.map(e,function(e){return l(t,e,i)}))}))}return new giscloud.geometry.Polygon([new giscloud.geometry.Line(u.map(n,function(e){return l(t,e,i)}))])}else if(e instanceof b.MultiPolygon){return new giscloud.geometry.Multipolygon(u.map(e._layers,function(e){return l(t,e,i)}))}else if(e instanceof b.Polyline){return new giscloud.geometry.Line(u.map(e.getLatLngs(),function(e){return l(t,e,i)}))}else if(e instanceof b.MultiPolyline){return new giscloud.geometry.Multiline(u.map(e._layers,function(e){return l(t,e,i)}))}else if(e instanceof b.FeatureGroup){if(e._gcType=="Multipoint"){return new giscloud.geometry.Multipoint(u.map(e._layers,function(e){return l(t,e,i)}))}return new giscloud.geometry.GeometryCollection(u.map(e._layers,function(e){return l(t,e,i)}))}else{return null}}this.fromViewerGeometry=function(e,t){return l(this,e,t)};this.overrideLeafletAddLayer=function(){var n,e=navigator.userAgent.match(/chrome\/(\d+)\./i);var r=_.map;function a(){r.on("zoomend",function(){var e=this._container.style.display||"block";this._container.style.display="none";this._container.offsetHeight;this._container.style.display=e});r.addLayer=n}if(e&&e.length===2){e=parseInt(e[1],10);if(!r.addLayerOverridden&&e>=38){n=r.addLayer;r.addLayer=function e(){var t=Array.prototype.slice.call(arguments),i=t[0];if(!r.svgFixApplied&&i._latlngs){setTimeout(a,0);r.svgFixApplied=true}return n.apply(this,t)};r.addLayerOverridden=true}}};d.deferreds.leafletLoading.done(function(){f(_,e,i);r.init.resolveWith(r)});this.bind=function(e,t){var i,n;if(typeof t!=="function"){throw"Handler is not a function!"}switch(e){case"click":i="click";break;case"mouseDown":i="mousedown";break;case"doubleClick":i="dblclick";break;case"mouseMove":i="mousemove";break;default:n=function(){t.apply(r,Array.prototype.slice.call(arguments,1))};u(a).on(e,n);t[e+s]=n;return this}n=function(e){t.apply(r,[new giscloud.LonLat(e.latlng.lng,e.latlng.lat)])};_.map.on(i,n);t[e+s]=n;return this};this.unbind=function(e,t){var i,n;if(typeof t!=="function"){throw"Handler is not a function!"}n=t[e+s];if(!n){return this}switch(e){case"click":i="click";break;case"mouseDown":i="mousedown";break;case"doubleClick":i="dblclick";break;case"mouseMove":i="mousemove";break;default:u(a).off(e,n);delete t[e+s];return this}_.map.off(i,n);delete t[e+s];return this};u.each(["click","doubleClick","mouseMove","mouseDown"],function(e,t){r[t]=function(e){r.bind(t,e)}});this.center=function(e,t){if(e==null){e=_.map.getCenter();return e&&new giscloud.LonLat(e.lng,e.lat)}else{_.map.setView(new c.L.LatLng(e.lat,e.lon),_.map.getZoom(),t);return this}};this.zoom=function(e,t){if(e==null){return _.map.getZoom()}else{_.map.setView(_.map.getCenter(),Math.floor(e),t);return this}};this.setMinZoom=function(e){if(e>0){_.map.options.minZoom=e}else{delete _.map.options.minZoom}};this.getMinZoom=function(){return _.map.options.minZoom?_.map.options.minZoom:0};this.setScale=function(e){var t=this.getViewBound();this.setLocation((t.xMin+t.xMax)/2,(t.yMin+t.yMax)/2,Math.floor(e))};this.getScale=function(){return _.map._zoom};this.addComponentToMap=function(e){e.addTo(_.map)};this.newPopup=function(e){return new d.ViewerLeafletPopup(e)};this.newMarker=function(e,t,i){return new d.ViewerLeafletMarker(e,t,i)};this.newPointGeom=function(e,t){var i=new b.DivIcon({iconSize:new b.Point(t.width,t.width),className:"leaflet-div-icon"});i.__div=i.createIcon();i.createIcon=function(){return this.__div};u(i.__div).css("background-color",t.fill).css("border","solid "+t.border+"px "+t.color).css("border-radius",t.borderRadius).css("-moz-border-radius",t.borderRadius).css("-webkit-border-radius",t.borderRadius).css("opacity",t.opacity);var n=new b.Marker(e,{icon:i,draggable:false});n.on("dragend",function(){t.parentShape.cursor=n.getLatLng()});n.isMarker=true;return n};this.newViewerGeometry=function(e,t,i,n){var r;if(i.isMulti){r=new b.FeatureGroup(t,i,n)}else if(e=="LineString"){r=new b.Polyline(t,i,n)}else if(e=="Polygon"){r=new b.Polygon(t,i,n)}else if(e=="Point"){r=this.newPointGeom(t,i)}if(n){_.map.addLayer(r)}return r};this.getViewerGeometry=function(e,t,i,n){var r=null;if(e instanceof giscloud.geometry.Multipolygon){r=new b.MultiPolygon(i,t)}else if(e instanceof giscloud.geometry.Polygon){r=new b.Polygon(i,t)}else if(e instanceof giscloud.geometry.Multiline){r=new b.MultiPolyline(i,t)}else if(e instanceof giscloud.geometry.Line){r=new b.Polyline(i,t)}else{t=t||{};t.icon=t.icon||(new b.Handler.PolyEdit).options.icon;t.draggable=t.draggable||false;if(e instanceof giscloud.geometry.Multipoint){r=new b.FeatureGroup(u.map(i,function(e){return new b.Marker(e,t)}),t);r._gcType="Multipoint"}else if(e instanceof giscloud.geometry.Point){r=new b.Marker(i,t)}}return n?[r]:r};this.extendLineGeometry=function(e,t){e.addLatLng(t)};this.initDrawing=function(){};this.getDrawingController=function(e,t){return new d.ViewerLeafletDrawing(e,_.map,t)};this.removeGeom=function(e){_.map.removeLayer(e)};this.enableGeometryEdit=function(e,t){var i,n=e.editing||e.dragging;if(n){if(t===false){n.disable()}else{n.enable()}return}if(e.shapes){if(t===false){i=function(e,t){if(t.editing){t.editing.disable()}else if(t.dragging){t.dragging.disable()}else if(t._layers){u.each(t._layers,i)}}}else{i=function(e,t){if(t.editing){t.editing.enable()}else if(t.dragging){t.dragging.enable()}else if(t._layers){u.each(t._layers,i)}}}u.each(e.shapes,i)}};this.toInternalCoords=function(e,t,i,n){var r=(1<<_.map._zoom)*256,a=_.map.getPixelBounds(),s=(e-_.map.gc_bounds.xmin)/_.map.gc_bounds.max*r-_.map._mapPane._leaflet_pos.x-a.min.x,o=(_.map.gc_bounds.ymax-t)/_.map.gc_bounds.max*r-_.map._mapPane._leaflet_pos.y-a.min.y,l=_.map.layerPointToLatLng(new b.Point(s,o));if(i!=null){l.z=i}if(n)l._o={x:e,y:t};return l};this.fromInternalCoords=function(e){var t,i,n=_.map.gc_bounds;if(e._o){t=e._o.x;i=e._o.y}else{var r=_.map.latLngToLayerPoint(e),a=(1<<_.map._zoom)*256,s=_.map.getPixelBounds();t=n.xmin+(r.x+_.map._mapPane._leaflet_pos.x+s.min.x)/a*n.max,i=n.ymax-(r.y+_.map._mapPane._leaflet_pos.y+s.min.y)/a*n.max}if(e.z!=null){return new giscloud.geometry.Point(t,i,e.z)}return new giscloud.geometry.Point(t,i)};this.toLeafletCoords=this.toInternalCoords;this.fromLeafletCoords=this.fromInternalCoords;this.on=function(e,t){if(e=="mousemove"||e=="mousedown"||e=="mouseup"||e=="click"||e=="touchstart"||e=="touchend"||e=="touchmove"){var r=t;if(!t._gc_event_proxy){t._gc_event_proxy={}}t._gc_event_proxy[e]=function(e){var t=_.map.gc_bounds,i,n;if(!t)return;if(!e.layerPoint&&e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]){e.layerPoint=_.map.mouseEventToLayerPoint(e.originalEvent.targetTouches[0])}e.z=_.map._zoom;if(e.layerPoint){i=_.map.getPixelBounds();n=1<<e.z;e.mapX=(i.min.x+e.layerPoint.x+_.map._mapPane._leaflet_pos.x)/256;e.mapY=(i.min.y+e.layerPoint.y+_.map._mapPane._leaflet_pos.y)/256;e.x=t.xmin+t.max*e.mapX/n;e.y=t.ymax-t.max*e.mapY/n;r(e)}};t=t._gc_event_proxy[e]}if(e=="touchstart"||e=="touchend"||e=="touchmove"){u(_.map._container).on(e,t)}else{_.map.on(e,t)}};this.off=function(e,t){if(t._gc_event_proxy&&t._gc_event_proxy[e]){var i=t._gc_event_proxy[e];delete t._gc_event_proxy[e];if(Object.keys(t._gc_event_proxy).length===0){delete t._gc_event_proxy}t=i}if(e=="touchstart"||e=="touchend"||e=="touchmove"){u(_.map._container).off(e,t)}else{_.map.off(e,t)}};this.fireSelectAreaEvent=function(e,t,i,n){var r=(1<<_.map._zoom)*256;var a=_.map.getPixelBounds();var s=_.map.gc_bounds;var o=Math.abs(t.x-e.x);var l=Math.abs(t.y-e.y);if(o>10&&l>10){var c=s.xmin+s.max*(e.x+_.map._mapPane._leaflet_pos.x+a.min.x)/r;var u=s.ymax-s.max*(e.y+_.map._mapPane._leaflet_pos.y+a.min.y)/r;var d=s.xmin+s.max*(t.x+_.map._mapPane._leaflet_pos.x+a.min.x)/r;var h=s.ymax-s.max*(t.y+_.map._mapPane._leaflet_pos.y+a.min.y)/r;n("areaselection",{originalEvent:i,xMin:c,yMin:u,xMax:d,yMax:h})}};this.fireSelectAreaToolEvent=function(e,t,i){var n=Math.abs(t.x-e.x);var r=Math.abs(t.y-e.y);if(n>10&&r>10){var a=new b.LatLngBounds(_.map.layerPointToLatLng(e),_.map.layerPointToLatLng(t));_.map.fitBounds(a)}};this.addLayer=function(e,t){if(t){e._tilesToRemove=[];for(var i in e._tiles){e._tiles[i].transferToAnotherViewer=true}}d.ViewerLeafletLayerFactory(e,_.map);e.addToMap();_.layers.push(e);if(t){e.gcmap.redraw();var i,n;for(i in e._tiles){n=e._tiles[i];if(!n.transferToAnotherViewer){e.viewerLayer.tileOnLoad(n)}}}};this.removeLayer=function(e){var t=_.layers.indexOf(e);if(t>-1){_.layers.splice(t,1)}e.removeFromMap()};this.whenIdle=function(e){t.instance.onRender=function(){delete t.instance.onRender;e()}};this.unload=function(){_.map.setView(new b.LatLng(0,0),0,true)};this.isLoaded=function(){return _.map._loaded};this.getViewBound=function(){var e=_.map.getPixelBounds();var t=_.map.gc_bounds;var i=t.max/(Math.pow(2,_.map._zoom)*256);var n=new Object;n.xMin=t.xmin+i*e.min.x;n.yMin=t.ymax-i*e.max.y;n.xMax=t.xmin+i*e.max.x;n.yMax=t.ymax-i*e.min.y;return n};this._setView=function(e,t,i){var n=_.map.gc_bounds;var r=_.map.getSize();_.map._zoom=i;var a=n.max/(Math.pow(2,i)*256);e=Math.round((e-n.xmin)/a-r.x/2);t=Math.round((n.ymax-t)/a-r.y/2);_.map._initialTopLeftPoint=new b.Point(e,t);b.DomUtil.setPosition(_.map._mapPane,new b.Point(0,0));_.map._tileLayersToLoad=_.map._tileLayersNum;if(_.map._tileBg)_.map._tileBg.innerHTML="";_.map.fire("viewreset",{hard:true});_.map.fire("move");_.map.fire("zoomend");_.map.fire("moveend");if(!_.map._loaded){_.map._loaded=true;_.map.fire("load")}};this.setViewUsingInternalCoords=function(e,t){_.map.setView(new b.LatLng(e[1],e[0]),t)};this.setViewBound=function(e,t,i,n,r,a){var s=_.map.gc_bounds;var o=_.map.layersMaxLevel;if(_.map._loaded&&!a){var l=(1<<_.map._zoom)*256;var c=_.map.getPixelBounds();var u=new b.LatLngBounds(this.toInternalCoords(e,t),this.toInternalCoords(i,n));var d=_.map.getBoundsZoom(u);if(d>o)d=o;if(this.mapViewPadding){if(this.mapViewPadding.left)e-=s.max/Math.pow(2,d)/256*this.mapViewPadding.left;u=new b.LatLngBounds(this.toInternalCoords(e,t),this.toInternalCoords(i,n));d=_.map.getBoundsZoom(u);if(d>o)d=o}_.map.setView(b.latLngBounds(u).getCenter(),d)}else{var l=i-e>n-t?i-e:n-t;var h=_.map.getSize();var f=_.map.getSize(),d=_.map.getMinZoom(),p=_.map.getMaxZoom(),g,m,v;if(!p||p>o)p=o;do{d++;var y=Math.pow(2,d)*256;m={x:i/s.max*y,y:t/s.max*y};v={x:e/s.max*y,y:n/s.max*y};g=new b.Point(m.x-v.x,v.y-m.y)}while(g.x-f.x<1e-4&&g.y-f.y<1e-4&&d<=p);d-=r;this._setView((i+e)/2,(n+t)/2,d)}};this.getCenter=function(){return this.fromInternalCoords(_.map.getCenter())};this.setLocation=function(e,t,i,n,r,a,s){if(e!==h&&t!==h){if(!(i>=0)){i=_.map._zoom}i=Math.floor(i);if(_.map._loaded){_.map.setView(this.toInternalCoords(e,t),i,a===0)}else{this._setView(e,t,i)}}if(s){s()}};this.getBearing=function(){return 0};this.setBearing=function(){};this.getPitch=function(){return 0};this.setPitch=function(){};this.invalidateSize=function(){_.map.invalidateSize()};this.initialize=function(){};this.uninitialize=function(){};this.show=function(){_.container.show()};this.hide=function(){_.container.hide()};this.setZIndex=function(e){_.container.css("z-index",e)};this.extractLayer=function(){return _.layers.pop()};this.resetZoomBearingPitch=function(e,t){t()};this.toggleInteractions=function(t){var e=["boxZoom","doubleClickZoom","scrollWheelZoom","touchZoom"];e.forEach(function(e){if(t){_.map[e].enable()}else{_.map[e].disable()}})};this.getBackgroundColor=function(){return this._backgroundColor};this.setBackgroundColor=function(e){this._backgroundColor=e;if(e){_.map._container.style.backgroundColor=e}else{_.map._container.style.backgroundColor="#ffffff"}};this.addScaleControl=function(){_.map.scaleControl=b.control.scale();_.map.scaleControl.original_update=_.map.scaleControl._update;_.map.scaleControl.original_updateScales=_.map.scaleControl._updateScales};this.setTool=function(e,t,i,n){if(t==="MeasureTool"){if(_.map.measure.enabled()){_.map.measure.disable()}}if(t==e){return}_.map.boxZoom._onDone=null;_.map.boxZoom.force(false);if(e=="SelectAreaTool"||e=="AreaSelection"){_.map.dragging.disable();_.map.boxZoom._onDone=n;_.map.boxZoom.force(true)}else{_.map.dragging.enable()}var r={tool:e,previous_tool:t};i("toolchange",r);return e};this.setProjection=function(e){if(e===3857){_.map.options.crs=b.CRS.EPSG3857}if(e===4326){_.map.options.crs=b.CRS.EPSG4326}};this.setCursor=function(e){this.container.style.cursor=e};this.reloadTerrain=function(){};this.dragging={enable:function(){_.map.dragging.enable()},disable:function(){_.map.dragging.disable()},enabled:function(){return _.map.dragging.enabled()}};this.doubleClickZoom={enable:function(){_.map.doubleClickZoom.enable()},disable:function(){_.map.doubleClickZoom.disable()},enabled:function(){return _.map.doubleClickZoom.enabled()}}};f=function(e,t,i){var n,r,a;try{n=[];a={layers:n,worldCopyJump:false,closePopupOnClick:false};if(e.options.latloncrs){a.crs=b.CRS.EPSG4326}if(e.options.lockZoom){u.extend(a,{touchZoom:false,scrollWheelZoom:false,doubleClickZoom:false,zoomControl:false})}if(e.options.hideZoomButtons){u.extend(a,{zoomControl:false})}var s=u("<div/>");s.css("position","absolute").css("width","100%").css("height","100%");u("#"+t).append(s);r=new b.Map(s[0],a);e.container=s;if(i.background){if(i.background.hex){u(".leaflet-container").css("background-color",i.background.hex())}else{u(".leaflet-container").css("background-color",i.background)}}if(i.center&&i.zoom){r.setView(new b.LatLng(i.center.lat,i.center.lon),i.zoom,true)}else if(i.bounds){r.fitBounds(new b.LatLngBounds(new b.LatLng(i.bounds.bottom,i.bounds.left),new b.LatLng(i.bounds.top,i.bounds.right)))}e.map=r;e.layers=n}catch(e){throw{name:"Leaflet error on viewer init.",err:e}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var s,r,a,o;i.ViewerLeafletLayerFactory=function(e,t){if(e.isTileLayer){new i.ViewerLeafletTileLayer(e,t)}else if(e.isBaseMapLayer){new i.ViewerLeafletBasemapLayer(e,t)}else{new i.ViewerLeafletLayer(e,t)}};o={initialize:function(e,t){this._layer=new r;this.initializeCommon(e,t)},initializeCommon:function(e,t){this._map=t;s.Util.setOptions(this._layer,e.options);this._layer._url=e._url;e.viewerLayer=this;this._layer.fnLayer=e;this._layer.viewerLayer=this},uninitialize:function(){},addToMap:function(){this._map.addLayer(this._layer)},removeFromMap:function(){this.uninitialize();this._map.removeLayer(this._layer)},setVisible:function(e){var t=this._layer;if(t._container){t._container.style.display=e?"block":"none"}this._updateLayerCount(e);t.options.visible=e;if(t instanceof s.TileLayer){t._update()}},update:function(){this._layer._update()},loaded:function(){return!!this._layer._map},setOpacity:function(e){this._layer.setOpacity(e)},setZIndex:function(e){this._layer.setZIndex(e)},_updateLayerCount:function(e){var t=this._layer;if(t.options.visible!=e&&t._map.options.zoomAnimation&&s.TileLayer&&t instanceof s.TileLayer){if(e){t._map._tileLayersNum++;t._map._tileLayersToLoad++;t.on("load",t._map._onTileLayerLoad,t._map)}else{t._map._tileLayersNum--;t._map._tileLayersToLoad--;t.off("load",t._map._onTileLayerLoad,t._map)}}},cleanTileCss:function(e){s.DomUtil.removeClass(e,"leaflet-tile");s.DomUtil.removeClass(e,"leaflet-tile-loaded")},onTileLoad:function(e,t){s.DomUtil.addClass(e,"leaflet-tile-loaded");e.complete=true;this._layer.fire("tileload",{tile:e,url:t});this._layer._tileLoaded()},onTileError:function(e,t){var i;this._layer.fire("tileerror",{tile:e,url:t});i=this.options.errorTileUrl;if(i&&i!=e.src){e.src=i}this._layer._tileLoaded()},tileShouldBeLoaded:function(e){return this._layer._tileShouldBeLoadedOriginal(e)},tileShouldBeVisible:function(e){if(!this._layer._map)return false;var t=this._layer._map.getPixelBounds(),i=this._layer.options.tileSize;var n=new s.Point(Math.floor(t.min.x/i),Math.floor(t.min.y/i)),r=new s.Point(Math.floor(t.max.x/i),Math.floor(t.max.y/i)),a=new s.Bounds(n,r);if(e.x<a.min.x||e.x>a.max.x||e.y<a.min.y||e.y>a.max.y){return false}return true},getTileUrl:function(e,t){return this._layer.getTileUrl(e,t)},repaint:function(){}};i.ViewerLeafletLayer=i.LayerClass.extend(o);var a={initialize:function(e,t){s.setOptions(this,t)},_loadTile:function(e,t){e._layer=this;e.onload=this._tileOnLoad;e.onerror=this._tileOnError;this.fnLayer._loadTile(e,t)},getVisible:function(e){return this.options.visible}};i.deferreds.leafletLoading.done(function(){s=e.L;r=s.TileLayer.extend(a);r.prototype._tileShouldBeLoadedOriginal=r.prototype._tileShouldBeLoaded;r.prototype._tileShouldBeLoaded=function(e,t,i){return this.fnLayer._tileShouldBeLoaded(e,t,i)};i._LeafletLayer=r})})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var r,a,s,o;o={initialize:function(e,t){var i=new a;this._layer=i;this.initializeCommon(e,t);i._updateOriginalFnLayer=i._update;i._update=function(){this._updateOriginalFnLayer();if(!this.fnLayer.viewer)return;this.fnLayer.viewer._layersForUpdateCount--;if(this.fnLayer.viewer._layersForUpdateCount<=0){this.fnLayer.legacyHtml5Map.Html5SendRequests();this.fnLayer.viewer._layersForUpdateCount=0}};i.on("tileerror",function(e){i.fnLayer.onTileError(e.tile)});i.on("load",function(){if(!t.options.zoomAnimation){i.fnLayer.cleanUpCanvasPool();i.unloadTilesOnClearBg=false}});i.on("tileunload",function(e){e.imidiateRelease=!i.unloadTilesOnClearBg;i.fnLayer._unloadTile(e)});i.on("stoploadingtiles",function(){i.fnLayer.onStopLoadingTiles()});this.clearTileBgHandler=function(){i.fnLayer.cleanUpCanvasPool();i.unloadTilesOnClearBg=false};this.zoomStartHandler=function(){i.unloadTilesOnClearBg=true;i.fnLayer.onZoomChange()};t.on("cleartilebg",this.clearTileBgHandler);t.on("zoomstart",this.zoomStartHandler)},uninitialize:function(){this._map.off("cleartilebg",this.clearTileBgHandler);this._map.off("zoomstart",this.zoomStartHandler)},tileOnLoad:function(e){this._layer._tileOnLoad.call(e);if(this._layer._oldContainer){l(e)}},tilesToLoad:function(){return this._layer._tilesToLoad&&this._layer._tilesToLoad>0},resetCache:function(){},render:function(){}};i.ViewerLeafletTileLayer=i.ViewerLeafletLayer.extend(o);s={_loadTile:function(e,t){if(this.viewerLayer.switching){return}this.fnLayer._loadTile(e,t)},_createTileProto:function(){this._canvasProto=r.DomUtil.create("canvas","leaflet-tile leaflet-tile-loaded")},_createTile:function(e){var t=this.fnLayer._tiles[e.x+":"+e.y+":"+e.z];if(t&&t.transferToAnotherViewer){if(!t.getContext){var i=t.gc_state;var n=this.fnLayer._createTile();n.gc_state=i;n.transferToAnotherViewer=true;t=n}}else{t=this.fnLayer._createTile()}t._layer=this;r.DomUtil.addClass(t,"leaflet-tile");r.DomUtil.addClass(t,"leaflet-tile-loaded");return t}};function l(e){var t=e._leaflet_pos.x;var i=e._leaflet_pos.y;var n=lv.map._animateScale;if(!n)return;var r=Math.round(lv.map._animateOrigin.x);var a=Math.round(lv.map._animateOrigin.y);var s=e._layer._oldContainer.childNodes;for(var o=0,l=s.length;o<l;o++){if(!s[o].gc_state._drawn)continue;var c=(s[o]._leaflet_pos.x-r)*n+r;var u=(s[o]._leaflet_pos.y-a)*n+a;var d=s[o].width*n;var h={xmin:t,ymin:i,xmax:t+e.width,ymax:i+e.height};var f={xmin:c,ymin:u,xmax:c+d,ymax:u+d};if(intersects(h,f)){rect={xmin:getmax(h.xmin,f.xmin),ymin:getmax(h.ymin,f.ymin),xmax:getmin(h.xmax,f.xmax),ymax:getmin(h.ymax,f.ymax)};var p={x:Math.floor((rect.xmin-c)/n),y:Math.floor((rect.ymin-u)/n),w:Math.ceil((rect.xmax-rect.xmin)/n),h:Math.ceil((rect.ymax-rect.ymin)/n),c:s[o]};var g=p.c.getContext("2d",flashnavigator.canvasOptions);g.clearRect(p.x,p.y,p.w,p.h)}}}i.deferreds.leafletLoading.done(function(){r=e.L;a=i._LeafletLayer.extend(s)})})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var r,a,s;s={initialize:function(e,t){this._layer=new a;this.initializeCommon(e,t)}};i.ViewerLeafletBasemapLayer=i.ViewerLeafletLayer.extend(s);leafletBasemapLayerDef={_createTileProto:function(){this._tileImg=r.DomUtil.create("canvas","leaflet-tile");this._tileImg.width=this._tileImg.height=this.options.tileSize*this.options.tileScaleFactor;if(this.options.tileScaleFactor!==1){this._tileImg.style.width="256px";this._tileImg.style.height="256px"}},_loadTile:function(e,t){this.fnLayer._loadTile(e,t)}};i.deferreds.leafletLoading.done(function(){r=e.L;a=i._LeafletLayer.extend(leafletBasemapLayerDef)})})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var r,a;a={initialize:function(e,t,i){this._map=null;this._type="marker";this._subtype="standard";this._clickable=t.clickable!==false;if(!e)e=new r.LatLng(0,0);if(t.icon){if(t.icon.type=="div"){t.icon=new r.DivIcon(t.icon);this._subtype="icon"}else{t.icon=new r.Icon.Label(t.icon);this._subtype="label"}}this._marker=new r.Marker(e,t);if(this._marker._icon){this._marker._icon.innerHTML=i||""}},move:function(e){var t=e.latlng||e;this._marker.setLatLng(t)},addTo:function(e){this._map=e;e.addLayer(this._marker);this._gc_container=t(this._marker._icon);this._gc_container.find(".leaflet-marker-iconlabel").addClass("gc-marker-iconlabel");this._gc_container.find(".leaflet-marker-icon").addClass("gc-marker-icon");if(!this._clickable){this._gc_container.css("pointer-events","none")}},text:function(e){this._gc_container.text(e)},html:function(e){this._gc_container.html(e)},remove:function(){this._map.removeLayer(this._marker)},bindPopup:function(e,t){this._marker.bindPopup(e,t);this._popup=new i.ViewerLeafletPopup(this._marker._popup);this._popup._map=this._map},setContent:function(e){this._marker.setContent(e)},setLabelText:function(e){if(this.isLabel()){this._marker.setLabelText(e)}},setLabel:function(e){if(this._marker.setLabelText){this._marker.setLabelText(e)}else if(this._marker.options.icon&&this._marker.options.icon.setLabelText){this._marker.options.icon.setLabelText(e)}else{t(this._marker._icon).find(".leaflet-marker-iconlabel").html(e)}},on:function(){this._gc_container.on.apply(this._gc_container,arguments);return this},off:function(){this._gc_container.off.apply(this._gc_container,arguments);return this},setLatLng:function(e){this._marker.setLatLng(e)},setRotation:function(e){this._marker.setRotation(e)}};i.ViewerLeafletMarker=i.LayerClass.extend(a);i.deferreds.leafletLoading.done(function(){r=e.L})})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var r,a;r={initialize:function(e){this._type="popup";this._map=null;if(e instanceof a.Popup){this._popup=e}else{this._popup=new a.Popup(e)}},move:function(e){var t=e.latlng||e;this._popup.setLatLng(t)},addTo:function(e){this._map=e;e.addLayer(this._popup);this._gc_container=t(this._popup._wrapper);t(this._popup._closeButton).addClass("gc-info-popup-close-button");this._gc_container.addClass("gc-info-popup-content-wrapper");this._gc_container.find(".leaflet-popup-content").addClass("gc-info-popup-content-outer");t(this._popup._tipContainer).find(".leaflet-popup-tip").addClass("gc-popup-tip");t(this._popup._container).on("mouseup mousedown mousemove mouseover touchstart",".leaflet-popup-close-button",function(e){e.stopPropagation()})},setContent:function(e){this._popup.setContent(e)},remove:function(){this._map.removeLayer(this._popup)},_initEventHandler:function(e,t){var i=this._popup;if(!this._gc_events){this._gc_events={}}this._gc_events[t]=function(e){if(e.popup===i){t()}}},fire:function(e,t){this._gc_container.triggerHandler(e,t)},on:function(e,t){if(e==="open"||e==="close"){this._initEventHandler(e,t);e="popup"+e;this._map.on(e,this._gc_events[t])}else{this._gc_container.on.apply(this._gc_container,arguments)}return this},off:function(e,t){if(e==="open"||e==="close"){e="popup"+e;this._map.off(e,this._gc_events[t])}else{this._gc_container.off.apply(this._gc_container,arguments)}return this}};i.ViewerLeafletPopup=i.LayerClass.extend(r);i.deferreds.leafletLoading.done(function(){a=e.L;if(!a.Popup.prototype._original_updatePosition)s()});function s(){a.Popup.prototype._original_updatePosition=a.Popup.prototype._updatePosition;a.Popup.prototype._updatePosition=function(){if(!this._map){return}var e=this._map.latLngToLayerPoint(this._latlng),t=this._animated,i=this.options.offset;e.x=Math.round(e.x);e.y=Math.round(e.y);if(t){a.DomUtil.setPosition(this._container,e)}this._containerBottom=-i.y-(t?0:e.y);this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(t?0:e.x);this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,E,t,i){t.ViewerLeafletDrawing=function(y,p,g){var r,a,s,i=(new L.Handler.PolyEdit).options.icon,o=[],l=[],c=null,u=false,d=false,h,f=[];function m(e){var t=new L.Marker(e,{icon:i});p.addLayer(t);l.push(t)}function v(){if(u==="line"){l[l.length-1].off("click",v)}else if(u==="polygon"){if(l&&l.length)l[0].off("click",v)}else if(u==="rectangle"){if(o.length!==5)o=null;E(document).off("mouseup",v);p.dragging.enable()}g.hideMeasureMarker();j()}function _(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}function b(e,t,i){var n,r,a,s,o,l,c;if(e.y===t.y&&e.x===t.x)e.y-=Number.MIN_VALUE;n=(i.y-e.y)*(t.y-e.y)+(i.x-e.x)*(t.x-e.x);r=Math.pow(t.y-e.y,2)+Math.pow(t.x-e.x,2);n/=r;a=new giscloud.geometry.Point(e.x+n*(t.x-e.x),e.y+n*(t.y-e.y));return a}function w(e,t,i){var n,r,a,s,o,l,c,u,d,h,f,p,g,m,v;n=y.fromInternalCoords(e);r=y.fromInternalCoords(t);a=y.fromInternalCoords(i);s=new giscloud.geometry.Point(r.x-n.x,r.y-n.y);o=new giscloud.geometry.Point(a.x-r.x,a.y-r.y);l=Math.sqrt(s.x*s.x+s.y*s.y);c=Math.sqrt(o.x*o.x+o.y*o.y);if(l===0||c===0)return i;u=new giscloud.geometry.Point(c*s.x/l,c*s.y/l);h=b(r,new giscloud.geometry.Point(r.x+-1*u.y,r.y+u.x),a);f=b(r,new giscloud.geometry.Point(r.x+u.y,r.y+-1*u.x),a);p=b(r,new giscloud.geometry.Point(r.x+u.x,r.y+u.y),a);g=h?_(a,h):Number.MAX_VALUE;m=f?_(a,f):Number.MAX_VALUE;v=p?_(a,p):Number.MAX_VALUE;d=Math.min(g,m,v);if(d===Number.MAX_VALUE)return i;if(d===g)return y.toInternalCoords(h.x,h.y);if(d===m)return y.toInternalCoords(f.x,f.y);return y.toInternalCoords(p.x,p.y)}function x(e,t){var i=l.length,n=!!t;if(!t){if(e===true||g.getInputValue()!==null){t=new L.LatLng(h.lat,h.lng)}else{t=g.snapping()?g.checkForSnapping(e.latlng):e.latlng;if(i>1&&d){t=w(o[i-2],o[i-1],t)}}}if(h&&h.isTempPoint){o.pop()}if(n){t.isTempPoint=true}o.push(t);h=t;if(!n){f.push(t);m(t)}if(u==="point"){j();return}else if(u==="line"||u==="polygon"&&o.length<3){if(!n){if(i>0&&u==="line"||i>1&&u==="polygon"){l[i-1].off("click",v)}l[i].on("click",v)}if(o.length>=2){if(r){r.setLatLngs(o)}else{r=new L.Polyline(o,{color:"#fbb03b",weight:2,dashArray:"1, 4",opacity:1});p.addLayer(r)}}}else if(u==="polygon"){if(!n){if(i!==0&&o.length>=3){l[i-1].off("click",v)}l[i].on("click",v)}if(o.length>=3){if(r instanceof L.Polyline){p.removeLayer(r);r=null}if(r){r.setLatLngs(o)}else{r=new L.Polygon(o,{color:"#fbb03b",fillColor:"#fbb03b",opacity:1,weight:2,dashArray:"1, 4"});p.addLayer(r)}}}s&&s.notify(u,o,n)}function n(e){var t=e.latlng;p.off("click",x);p.off("mousedown",n);p.dragging.disable();E(document).on("mouseup",function(){p.dragging.enable()}).on("mouseup",v);u="rectangle";o=[e.latlng]}function t(e,t){var i=o.length-1,n=g.snapping()?g.checkForSnapping(e.latlng):e.latlng,r;if(i<0||u==="point"){return}n=e.latlng;c={latlng:new L.LatLng(n.lat,n.lng)};if(!t){n=g.getOverridenPoint(n)}if(u==="line"||u==="polygon"){}else if(u==="rectangle"){if(!a){o=[o[0],new L.LatLng(o[0].lat,n.lng),new L.LatLng(n.lat,n.lng),new L.LatLng(n.lat,o[0].lng),o[0]];a=new L.Polyline(o,{color:"#fbb03b",weight:2,dashArray:"5, 5"});p.addLayer(a)}else{o.splice(1,3,new L.LatLng(o[0].lat,n.lng),new L.LatLng(n.lat,n.lng),new L.LatLng(n.lat,o[0].lng));a.setLatLngs(o)}}else{return}if(u!=="rectangle"){x(e,n)}}function e(){d=true}function C(){d=false}function T(e,t,i){var n=Math.sin(t),r=Math.cos(t),a,s;i.x-=e.x;i.y-=e.y;a=i.x*r-i.y*n;s=i.x*n+i.y*r;i.x=a+e.x;i.y=s+e.y;return i}function k(){if(L.Handler.PolyEdit.prototype._fnCanvasOverriden)return;L.Handler.PolyEdit.prototype.addHooks=function(){if(this._poly._map){if(!this._markerGroup){this._initMarkers()}this._poly._map.addLayer(this._markerGroup);this._poly.on("mousedown",this._onPolyMousedown,this);E(document).one("keydown",null,"r",E.proxy(this._rKeyDown,this)).one("keydown",null,"t",E.proxy(this._tKeyDown,this)).one("keydown",null,"ctrl",E.proxy(this._ctrlKeyDown,this))}};L.Handler.PolyEdit.prototype._origRemoveHooks=L.Handler.PolyEdit.prototype.removeHooks;L.Handler.PolyEdit.prototype.removeHooks=function(){E(document).off("keydown",this._rKeyDown).off("keydown",this._tKeyDown).off("keydown",this._ctrlKeyDown);this._origRemoveHooks.apply(this,Array.prototype.slice.apply(arguments))};L.Handler.PolyEdit.prototype._hideMarkers=function(){this._markerGroup.eachLayer(function(e){e._origOpacity=e.options.opacity;e.options.opacity=0;e._updateOpacity()})};L.Handler.PolyEdit.prototype._showMarkers=function(){this._markerGroup.eachLayer(function(e){if(e._origOpacity!=null)e.options.opacity=e._origOpacity||1;else e.options.opacity=1;e._updateOpacity()})};L.Handler.PolyEdit.prototype._showCenter=function(){var e=new L.LatLng(0,0),t,i,n,r,a,s=0,o,l,c,u;l=u=Number.MAX_VALUE;o=c=-1*Number.MAX_VALUE;e.x=e.y=0;i=this._poly._latlngs.length;if(this._poly._latlngs[i-1].lat===this._poly._latlngs[0].lat&&this._poly._latlngs[i-1].lng===this._poly._latlngs[0].lng){i--}for(t=0;t<i;t++){s=y.fromInternalCoords(this._poly._latlngs[t]);e.x+=s.x;e.y+=s.y}e.x/=i;e.y/=i;this._center=y.toInternalCoords(e.x,e.y);this._center.x=e.x;this._center.y=e.y;e.lat=this._center.lat;e.lng=this._center.lng;this._centerMarker=new L.Marker(e,{draggable:false,icon:this.options.icon});this._centerMarker.addTo(this._poly._map)};L.Handler.PolyEdit.prototype._hideCenter=function(){if(this._centerMarker&&this._centerMarker._map){this._centerMarker._map.removeLayer(this._centerMarker);this._centerMarker=null}};L.Handler.PolyEdit.prototype._rKeyDown=function(e){this._rotatePolys=true;this._hideMarkers();this._showCenter();E(document).one("keyup",null,"r",E.proxy(function(){this._rotatePolys=false;this._showMarkers();this._hideCenter();E(document).one("keydown",null,"r",E.proxy(this._rKeyDown,this))},this))};L.Handler.PolyEdit.prototype._tKeyDown=function(e){this._dragWholePolys=true;this._hideMarkers();E(document).one("keyup",null,"t",E.proxy(function(){this._dragWholePolys=false;this._showMarkers();E(document).one("keydown",null,"t",E.proxy(this._tKeyDown,this))},this))};L.Handler.PolyEdit.prototype._ctrlKeyDown=function(e){this._dragPerpendicular=true;E(document).one("keyup",null,"r",E.proxy(function(){this._dragPerpendicular=false;E(document).one("keydown",null,"ctrl",E.proxy(this._ctrlKeyDown,this))},this))};L.Handler.PolyEdit.prototype._onPolyMousedown=function(e){var t=y.fromInternalCoords(e.latlng);this._mousedownLatlng=e.latlng;this._mousedownLatlng.x=t.x;this._mousedownLatlng.y=t.y;if(this._dragWholePolys)return this._startPolyDrag(e);if(this._rotatePolys)return this._startPolyRotate(e)};L.Handler.PolyEdit.prototype._saveOrigins=function(){var e,t,i,n,r,a,s;t=this._markerGroup._layers;for(e in t){if(t.hasOwnProperty(e)){i=t[e].getLatLng();t[e]._origin=new L.LatLng(i.lat,i.lng);s=y.fromInternalCoords(t[e]._origin);t[e]._origin.x=s.x;t[e]._origin.y=s.y}}n=this._poly._latlngs;for(r=0,a=n.length;r<a;r++){n[r]._origin=new L.LatLng(n[r].lat,n[r].lng);s=y.fromInternalCoords(n[r]._origin);n[r]._origin.x=s.x;n[r]._origin.y=s.y}};L.Handler.PolyEdit.prototype._startPolyDrag=function(e){this._poly._map.on("mousemove",this._onPolyDragging,this);E(document).one("mouseup",E.proxy(this._endPolyDrag,this));this._saveOrigins()};L.Handler.PolyEdit.prototype._startPolyRotate=function(e){this._v1=new giscloud.geometry.Point(this._mousedownLatlng.y-this._center.y,this._mousedownLatlng.x-this._center.x);this._v1Atan=Math.atan2(this._v1.y,this._v1.x);this._poly._map.on("mousemove",this._onPolyRotate,this);E(document).one("mouseup",E.proxy(this._endPolyRotate,this));this._saveOrigins(e)};L.Handler.PolyEdit.prototype._onPolyDragging=function(e){var n=e.latlng.lng-this._mousedownLatlng.lng,r=e.latlng.lat-this._mousedownLatlng.lat,t=this._poly._latlngs,i,a,s,o,l,c,u,d,h,f;if(g.snapping()){o=this._markerGroup._layers;for(l in o){if(o.hasOwnProperty(l)){s=o[l]._origin;s=new L.LatLng(o[l]._origin.lat+r,o[l]._origin.lng+n);c=g.checkForSnapping(s);if(c&&!c.equals(s)){n=c.lng-o[l]._origin.lng;r=c.lat-o[l]._origin.lat;break}}}}this._markerGroup.eachLayer(function(e){var t=e._origin.lat+r,i=e._origin.lng+n;e.setLatLng(new L.LatLng(t,i));if(e._origLatLng){L.extend(e._origLatLng,e._latlng);e._origLatLng._o=null}});for(i=0,a=t.length;i<a;i++){t[i].lng=t[i]._origin.lng+n;t[i].lat=t[i]._origin.lat+r}this._poly.redraw();if(g.measureDisplay()){u=p.measure;d=this._mousedownLatlng;h=new L.LatLng(d.lat+r,d.lng+n);g.showMeasureMarker(1,d,h);if(!this._measureLine){this._measureLine=new L.Polyline([d,h],{color:"#333",weight:3,dashArray:"5, 5"});this._poly._map.addLayer(this._measureLine)}else{this._measureLine.setLatLngs([d,h])}}else{g.hideMeasureMarker(1);if(this._measureLine){this._poly._map.removeLayer(this._measureLine);this._measureLine=null}}};L.Handler.PolyEdit.prototype._onPolyRotate=function(e){var t=y.fromInternalCoords(e.latlng),i=new giscloud.geometry.Point(t.y-this._center.y,t.x-this._center.x),n=this._v1Atan-Math.atan2(i.y,i.x),r=this._center,a=this._poly._latlngs,s,o,l;this._markerGroup.eachLayer(function(e){var t=new giscloud.geometry.Point(e._origin.x,e._origin.y),i;T(r,n,t);i=y.toInternalCoords(t.x,t.y);e.setLatLng(i);if(e._origLatLng){L.extend(e._origLatLng,e._latlng);e._origLatLng._o=null}});for(s=0,o=a.length;s<o;s++){t=new giscloud.geometry.Point(a[s]._origin.x,a[s]._origin.y);t=T(this._center,n,t);a[s].x=t.x;a[s].y=t.y;t=y.toInternalCoords(t.x,t.y);a[s].lat=t.lat;a[s].lng=t.lng}this._poly.redraw()};L.Handler.PolyEdit.prototype._endPolyDrag=function(){var e=[],t,i,n;this._poly._map.off("mousemove",this._onPolyDragging);y.parent.hideTip();g.hideMeasureMarker(1);if(this._measureLine){this._poly._map.removeLayer(this._measureLine);this._measureLine=null}for(i=0,n=this._markers.length;i<n;i++){e.push(this._markers[i]._origLatLng)}this._poly.setLatLngs(e);this._poly.redraw();this._fireEdit()};L.Handler.PolyEdit.prototype._endPolyRotate=function(){var e=[],t,i,n;this._poly._map.off("mousemove",this._onPolyRotate);y.parent.hideTip();g.hideMeasureMarker(1);if(this._measureLine){this._poly._map.removeLayer(this._measureLine);this._measureLine=null}for(i=0,n=this._markers.length;i<n;i++){e.push(this._markers[i]._origLatLng)}this._poly.setLatLngs(e);this._poly.redraw();this._fireEdit()};L.Handler.PolyEdit.prototype._fnCanvasOverriden=true}function M(){if(!L.Handler.PolyEdit.prototype._onMarkerDragOrig){L.Handler.PolyEdit.prototype._onMarkerDragOrig=L.Handler.PolyEdit.prototype._onMarkerDrag;L.Handler.PolyEdit.prototype._onMarkerDrag=function(e){var t=e.target,i,n,r;t._origLatLng._o=null;if(g.snapping()){t.setLatLng(g.checkForSnapping(t._latlng))}if(g.measureDisplay()){if(t._prev){i=t._latlng;n=t._prev._latlng;g.showMeasureMarker(1,i,n)}else{g.hideMeasureMarker(1)}if(t._next){i=t._latlng;n=t._next._latlng;g.showMeasureMarker(2,i,n)}else{g.hideMeasureMarker(2)}}else{g.hideMeasureMarker(1);g.hideMeasureMarker(2)}this._onMarkerDragOrig(e)}}if(!L.Handler.PolyEdit.prototype._fireEditOrig){L.Handler.PolyEdit.prototype._fireEditOrig=L.Handler.PolyEdit.prototype._fireEdit;L.Handler.PolyEdit.prototype._fireEdit=function(e){y.parent.hideTip();g.hideMeasureMarker();this._fireEditOrig(e)}}}function S(){L.Handler.PolyEdit.prototype._onMarkerDrag=L.Handler.PolyEdit.prototype._onMarkerDragOrig;L.Handler.PolyEdit.prototype._fireEdit=L.Handler.PolyEdit.prototype._fireEditOrig;delete L.Handler.PolyEdit.prototype._onMarkerDragOrig;delete L.Handler.PolyEdit.prototype._fireEditOrig;g.hideMeasureMarker()}function D(){if(r){p.removeLayer(r);r=null}if(a){p.removeLayer(a);a=null}E.map(l,function(e){p.removeLayer(e);e=null});l=[];o=[];c=null;p.off("click",x);p.off("mousemove",t);g.cleanUp()}function j(e){if(s){if(o===null)s.reject(e);else s.resolve(o,e);D()}u=false;if(s)return s.promise()}function I(e){if(s){s.reject(e);D()}return s.promise()}return{initSnapping:M,endSnapping:S,initEdit:k,handleNumericKeypress:function(){if(c){t(c)}},addPoint:function(e){x(e)},currentlyDrawing:function(){return u},currentShapeGeometry:function(){if(u){return{currentlyDrawing:u,points:o,lastPoint:h}}return null},getPoint:function(e){if(e<0){e+=o.length}var t=o[e];if(!t)return null;return{lng:t.lng,lat:t.lat}},rectangleMode:function(e){if(e){p.dragging.disable();p.boxZoom.disable();p.on("mousedown",n)}else{p.off("mousedown",n);p.boxZoom.enable()}},start:function(e){p.doubleClickZoom.disable();u=e;p.on("click",x);p.on("mousemove",t);p.on("dblclick",v);s=new E.Deferred;return s.promise()},end:j,cancel:I,setPoints:function(e){o=e}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,B,t,i){t.ViewerLeafletControl=function(e){var z=e.viewer,H=e.map;this.selectExtent=function(e){var x,C,i,c,n,r,T,k,M,S,a,s,o,l,u={color:"#006BFF",weight:4,opacity:1},d={color:"#00c697",weight:8},t=function(e){x=z.instance;C=new L.DivIcon({className:"gc-select-extent-label"});H.dragging.disable();H.on("mousedown",f);B(z.container()).addClass("gc-cursor-crosshair")},h=function(){N();H.off("mousedown",f).off("mousemove",p).off("mousedown",N).off("mousemove",j).off("mousemove",I).off("mousemove",E).off("mousemove",A);B(z.container()).removeClass("gc-cursor-crosshair")},f=function(e){var t=e.latlng,i=new L.LatLngBounds(t,t);n=t.lat;r=t.lng;H.off("mousedown",f);H.off("mousedown",N);H.on("mousemove",p);B(document).on("mouseup",g);c=new L.Rectangle(i).addTo(H)},p=function(e){var t=R(e.latlng);c.setBounds(t);m(t)},g=function(){H.off("mousemove",p);B(document).off("mouseup",g);H.on("mousedown",N);H.on("mousedown",f);y()},m=function(e){var t=e.getCenter(),i=e.getNorthEast(),n=e.getSouthWest(),r=i.lat,a=i.lng,s=n.lat,o=n.lng,l=x.fromInternalCoords(i),c=x.fromInternalCoords(n),u=l.y,d=l.x,h=c.y,f=c.x,p=new L.LatLng(r,t.lng),g=new L.LatLng(t.lat,a),m=new L.LatLng(t.lat,o),v=new L.LatLng(s,t.lng),y,_,b,w;if(T==null){T=new L.Marker(p,{icon:C,html:u}).addTo(H);k=new L.Marker(g,{icon:C,html:d}).addTo(H);S=new L.Marker(m,{icon:C,html:f}).addTo(H);M=new L.Marker(v,{icon:C,html:h}).addTo(H)}else{T.setLatLng(p)._icon.innerHTML=u;k.setLatLng(g)._icon.innerHTML=d;S.setLatLng(m)._icon.innerHTML=f;M.setLatLng(v)._icon.innerHTML=h}y=B(T._icon);_=B(k._icon);b=B(S._icon);w=B(M._icon);y.css("margin-left",y.outerWidth()/-2).css("margin-top",-25);_.css("margin-left",5).css("margin-top",_.outerHeight()/-2);b.css("margin-left",b.outerWidth()*-1-5).css("margin-top",b.outerHeight()/-2);w.css("margin-left",w.outerWidth()/-2).css("margin-top",5)},v=function(){if(T==null){return}H.removeLayer(T);H.removeLayer(k);H.removeLayer(S);H.removeLayer(M);T=null;k=null;S=null;M=null},y=function(){var e=c.getBounds(),t=e.getNorthEast(),i=e.getSouthWest(),n=new L.LatLng(t.lat,i.lng),r=new L.LatLng(i.lat,t.lng);c.setStyle({stroke:false});a=new L.Polyline([n,t],u).addTo(H).on("mouseover",_).on("mouseout",b).on("mousedown",w);s=new L.Polyline([r,t],u).addTo(H).on("mouseover",_).on("mouseout",b).on("mousedown",w);o=new L.Polyline([i,n],u).addTo(H).on("mouseover",_).on("mouseout",b).on("mousedown",w);l=new L.Polyline([i,r],u).addTo(H).on("mouseover",_).on("mouseout",b).on("mousedown",w)},_=function(e){var t=e.target;if(i){return}H.removeLayer(t).addLayer(t);e.target.setStyle(d)},b=function(e){e.target.setStyle(u)},w=function(e){var t=e.target;if(i){return}i=t;t.off("mouseover",_).off("mouseout",b);B(document).on("mouseup",D);switch(t){case a:H.on("mousemove",j);break;case s:H.on("mousemove",I);break;case o:H.on("mousemove",E);break;case l:H.on("mousemove",A);break}},D=function(){B(document).off("mouseup",D);switch(i){case a:H.off("mousemove",j);break;case s:H.off("mousemove",I);break;case o:H.off("mousemove",E);break;case l:H.off("mousemove",A);break}i.on("mouseover",_).on("mouseout",b);i=null},j=function(e){var t=c.getBounds(),i=t.getNorthEast(),n=t.getSouthWest(),r=H.latLngToContainerPoint(n),a=e.containerPoint.y,s=r.y;if(a>s-d.weight){return}t=new L.LatLngBounds(new L.LatLng(e.latlng.lat,i.lng),n);c.setBounds(t);m(t);P(t)},I=function(e){var t=c.getBounds(),i=t.getNorthEast(),n=t.getSouthWest(),r=H.latLngToContainerPoint(n),a=e.containerPoint.x,s=r.x;if(a<s+d.weight){return}t=new L.LatLngBounds(new L.LatLng(i.lat,e.latlng.lng),n);c.setBounds(t);m(t);P(t)},E=function(e){var t=c.getBounds(),i=t.getSouthWest(),n=t.getNorthEast(),r=H.latLngToContainerPoint(n),a=e.containerPoint.x,s=r.x;if(a>s-d.weight){return}t=new L.LatLngBounds(n,new L.LatLng(i.lat,e.latlng.lng));c.setBounds(t);m(t);P(t)},A=function(e){var t=c.getBounds(),i=t.getSouthWest(),n=t.getNorthEast(),r=H.latLngToContainerPoint(n),a=e.containerPoint.y,s=r.y;if(a<s+d.weight){return}t=new L.LatLngBounds(n,new L.LatLng(e.latlng.lat,i.lng));c.setBounds(t);m(t);P(t)},P=function(e){var t=e.getNorthEast(),i=e.getSouthWest(),n=new L.LatLng(t.lat,i.lng),r=new L.LatLng(i.lat,t.lng);a.setLatLngs([n,t]);s.setLatLngs([r,t]);o.setLatLngs([i,n]);l.setLatLngs([i,r])},O=function(){if(a==null){return}H.removeLayer(a);H.removeLayer(s);H.removeLayer(o);H.removeLayer(l);a=null;s=null;o=null;l=null},N=function(){if(c==null){return}v();O();H.removeLayer(c);n=null;r=null;c=null},R=function(e){var t=new L.LatLng(Math.min(n,e.lat),Math.min(r,e.lng)),i=new L.LatLng(Math.max(n,e.lat),Math.max(r,e.lng));return new L.LatLngBounds(t,i)},F=function(){var e=c&&c.getBounds(),t,i,n,r,a,s,o,l;if(e==null){return null}t=e.getNorthEast();i=e.getSouthWest();n=x.fromInternalCoords(t);r=x.fromInternalCoords(i);a=n.y;s=n.x;o=r.y;l=r.x;return new giscloud.Bounds(l,o,s,a)};return{init:t,getExtent:F,finalize:h}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(c,d,h,f){var p,g;h.deferreds.mapboxLoading=new d.Deferred;h.ViewerMapbox=function(e,t,i){var a,u,r,s,n,o;a=this;s=h.oid();u={options:i};r={};u.layers=[];u.viewer=e;this.modeId="3D";if(h.deferreds.mapboxLoading.state()!=="resolved"){o=d.when(giscloud.includeJs(h.assetsSite()+"libs/mapbox-gl/mapbox-gl.js"),giscloud.includeJs(h.assetsSite()+"libs/mapbox-gl/mapbox-gl-draw.js"));o.done(function(){if(c.mapboxgl){h.deferreds.mapboxLoading.resolve()}else{h.deferreds.mapboxLoading.reject();h.deferreds.mapboxLoading=new d.Deferred}});if(!g){n=d.when(giscloud.includeCss(h.assetsSite()+"libs/mapbox-gl/mapbox-gl.css"),giscloud.includeCss(h.assetsSite()+"assets/api/1/viewer/mapbox/viewer.mapbox.css"),giscloud.includeCss(h.assetsSite()+"assets/api/1/viewer.css"));n.done(function(){g=true})}}this.init=new d.Deferred;this.init.done(function(){a.map=u.map;u.map.on("zoomend",function(e){d(r).triggerHandler("scaleChanged")});this._control=new h.ViewerMapboxControl(u)});h.deferreds.mapboxLoading.done(function(){p(u,t,i);u.map.on("load",function(){a.init.resolveWith(a)})});this.initialize=function(){this.initOnFirstLayerAdd=true};this.setupTerrain=function(){u.map.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:a.demMaxZoom});u.map.setTerrain({source:"mapbox-dem",exaggeration:a.exaggeration})};this.initOnLayerAdd=function(){if(!this.initOnFirstLayerAdd){return}if(u.viewer.instance.epsg==900913||u.viewer.instance.epsg==3857){u.map.setProjection("globe")}else{u.map.setProjection("mercator")}if(u.viewer.instance.epsg==900913||u.viewer.instance.epsg==3857||u.viewer.instance.layersDEM){if(!u.map.getTerrain()){this.setupTerrain()}}u.map.setFog({"horizon-blend":.1,color:"#add8e6","high-color":"#87CEEB","space-color":"#87CEEB","star-intensity":0,range:[6,10]});this.initOnFirstLayerAdd=false};this.uninitialize=function(){if(u.draw){u.map.removeControl(u.draw);u.draw=null}u.layers.forEach(function(e){e.resetCache()})};this.hide=function(){u.container.hide()};this.show=function(){u.container.show()};this.setZIndex=function(e){u.container.css("z-index",e)};this.extractLayer=function(){return u.layers.pop()};this.resetZoomBearingPitch=function(e,t){if(Math.abs(u.map.getZoom()-e+1)<.01){e=f}this.setLocation(f,f,e,0,0,f,t,"easeTo")};this.toggleInteractions=function(t){var e=["scrollZoom","boxZoom","dragRotate","dragPan","doubleClickZoom","touchZoomRotate"];e.forEach(function(e){if(t){u.map[e].enable()}else{u.map[e].disable()}})};this.fromViewerGeometry=function(e,t){if(!e._id){return l(this,e,t)}var i=e._id;var n=i.length;var r;if(n===1){r=u.draw.get(i[0]);return l(this,r,t)}var a=[];for(var s=0;s<n;s++){r=u.draw.get(i[s]);a.push(l(this,r,t))}return a};this.bind=function(e,t){var i,n;if(typeof t!=="function"){throw"Handler is not a function!"}switch(e){case"click":i="click";break;case"mouseDown":i="mousedown";break;case"doubleClick":i="dblclick";break;case"mouseMove":i="mousemove";break;default:n=function(){t.apply(a,Array.prototype.slice.call(arguments,1))};d(r).on(e,n);t[e+s]=n;return this}n=function(e){t.apply(a,[new giscloud.LonLat(e.latlng.lng,e.latlng.lat)])};u.map.on(i,n);t[e+s]=n;return this};this.unbind=function(e,t){var i,n;if(typeof t!=="function"){throw"Handler is not a function!"}n=t[e+s];if(!n){return this}switch(e){case"click":i="click";break;case"mouseDown":i="mousedown";break;case"doubleClick":i="dblclick";break;case"mouseMove":i="mousemove";break;default:d(r).off(e,n);delete t[e+s];return this}u.map.off(i,n);delete t[e+s];return this};d.each(["click","doubleClick","mouseMove","mouseDown"],function(e,t){a[t]=function(e){a.bind(t,e)}});this.zoom=function(e,t){if(e==null){return u.map.getZoom()}else{u.map.setView(u.map.getCenter(),e,t);return this}};this.setMinZoom=function(e){if(e===f||e<0){u.map.setMinZoom(-2)}else{u.map.setMinZoom(e+.5)}};this.getMinZoom=function(){return u.map.getMinZoom()-.5};this.setScale=function(e,t){e--;if(t){u.map.setZoom(e)}else{u.map.zoomTo(e)}};this.getScale=function(){return Math.ceil(u.map.getZoom()+.5)};this.addScaleControl=function(){};this.newPopup=function(e){return new h.ViewerMapboxPopup(e)};this.addComponentToMap=function(e){e.addTo(u.map)};this.newMarker=function(e,t,i){return new h.ViewerMapboxMarker(e,t,i)};this.newIcon=function(e){return new h.ViewerMapboxIcon(e)};this.initDrawing=function(e){u.drawing=e;if(!u.draw){u.drawing.initialize()}};this.newViewerGeometry=function(e,t,i){if(e=="Polygon"){var n=t[t.length-1];if(t[0]!==n[0]||t[1]!==n[1]){t.push(t[0])}t=[t]}if(e=="Point"){}if(i.isMulti){var r=[];feature={type:"FeatureCollection",features:r};if(e=="MultiPolygon"){for(var a=0,s=t.length;a<s;a++){r.push({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:t[a]}})}}else if(e=="MultiPoint"){for(var a=0,s=t.length;a<s;a++){r.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:t[a]}})}}}else{feature={type:"Feature",properties:{},geometry:{type:e,coordinates:t}}}var o=u.draw.add(feature);return{_id:o,_draw:u.draw,_feature:feature,hasGeom:true}};this.getViewerGeometry=function(e,t,i){return i};this.getDrawingController=function(e,t){return new h.ViewerMapboxDrawing(e,u,t)};this.removeGeom=function(e){u.draw.delete(e._id)};this.enableGeometryEdit=function(e,t){if(t===false){u.draw.changeMode("static")}else{var i=e.featureGroup?e.featureGroup._id:e._id;if(i.length==1&&!e.featureGroup&&e._feature.geometry.type!=="Point")u.draw.changeMode("direct_select",{featureId:i[0]});else u.draw.changeMode("simple_select",{featureIds:i})}};this.extendLineGeometry=function(e,t){e._feature.geometry.coordinates.push(t);var i={id:e._id[0],type:"Feature",properties:{},geometry:e._feature.geometry};e._draw.add(i)};this.toInternalCoords=function(e,t,i,n,r){var a=u.map.gc_bounds.max/2,s=e*180/a,o=Math.atan(Math.exp(t*Math.PI/a))*360/Math.PI-90,l=new mapboxgl.LngLat(s,o);if(r){l=[l.lng,l.lat]}else{if(i!=null){l.push(i)}}if(n)l._o={x:e,y:t};return l};this.fromInternalCoords=function(e,t){var i,n;if(e._o){i=e._o.x;n=e._o.y}else{var r=t?e[0]:e.lng,a=t?e[1]:e.lat;if(r<-180)r+=360;if(r>180)r-=360;var s=r/180*Math.PI,o=a/180*Math.PI,l=u.map.gc_bounds.max/Math.PI/2;i=l*s;n=l*Math.log((Math.sin(o)+1)/Math.cos(o))}if(e.z!=null){return new giscloud.geometry.Point(i,n,e.z)}return new giscloud.geometry.Point(i,n)};this.toLeafletCoords=this.toInternalCoords;this.fromLeafletCoords=this.fromInternalCoords;this.on=function(e,t){if(e=="mousemove"||e=="mousedown"||e=="mouseup"||e=="click"||e=="touchstart"||e=="touchend"||e=="touchmove"){var r=t;if(!t._gc_event_proxy){t._gc_event_proxy={}}t._gc_event_proxy[e]=function(e){var t=u.map.gc_bounds,i,n;e.latLng=e.lngLat;e.latlng=e.lngLat;if(t){i=a.fromInternalCoords(e.latLng);e.x=i.x;e.y=i.y;e.z=a.getScale();n=1<<e.z;e.mapX=(e.x-t.xmin)/t.max*n;e.mapY=(t.ymax-e.y)/t.max*n;r(e)}};t=t._gc_event_proxy[e]}u.map.on(e,t)};this.off=function(e,t){if(t._gc_event_proxy&&t._gc_event_proxy[e]){var i=t._gc_event_proxy[e];delete t._gc_event_proxy[e];if(Object.keys(t._gc_event_proxy).length===0){delete t._gc_event_proxy}t=i}u.map.off(e,t)};this.fireSelectAreaEvent=function(e,t,i,n){var r,a,s=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y);if(s>10&&o>10){r=this.fromInternalCoords(u.map.unproject(e));a=this.fromInternalCoords(u.map.unproject(t));n("areaselection",{originalEvent:i,xMin:r.x,yMin:r.y,xMax:a.x,yMax:a.y})}};this.fireSelectAreaToolEvent=function(e,t,i){var n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);if(n>10&&r>10){var a=new mapboxgl.LngLatBounds(u.map.unproject(e),u.map.unproject(t));u.map.fitBounds(a)}};this.addLayer=function(e,t){if(t){e._tilesToRemove=[];for(var i in e._tiles){e._tiles[i].transferToAnotherViewer=true}}this.initOnLayerAdd();h.ViewerMapboxLayerFactory(e,u.map);e.addToMap();u.layers.push(e)};this.removeLayer=function(e){var t=u.layers.indexOf(e);if(t>-1){u.layers.splice(t,1)}e.removeFromMap();if(u.layers.length==0){var i=i?i:u.map.getTerrain();if(i){u.map.setTerrain(null);u.map.style.removeSource("mapbox-dem")}u.map.setProjection("mercator");this.initOnFirstLayerAdd=true}};this.whenIdle=function(e){u.map.once("idle",e)};this.unload=function(){u.map.setPitch(0)};this.isLoaded=function(){return u.map._loaded};this.getViewBound=function(){var e=u.map.getBounds();var t=this.fromInternalCoords(e._ne);var i=this.fromInternalCoords(e._sw);var n=new Object;n.xMin=i.x;n.xMax=t.x;n.yMin=i.y;n.yMax=t.y;return n};this.setViewUsingInternalCoords=function(e,t){t--;u.map.flyTo({center:e,zoom:t})};this.setViewBound=function(e,t,i,n,r,a,s){var o=this.toInternalCoords(e,t);var l=this.toInternalCoords(i,n);var c=new mapboxgl.LngLatBounds(o,l);if(u.map._loaded&&!a&&!s)u.map.fitBounds(c);else u.map.fitBounds(c,{duration:0});return};this.getCenter=function(){return this.fromInternalCoords(u.map.getCenter())};this.setLocation=function(e,t,i,n,r,a,s,o){if(u.map._loaded){var l={};if(e!==f&&t!==f){l.center=this.toInternalCoords(e,t)}if(i!==f){l.zoom=i-1}if(n!==f){l.bearing=n}if(r!==f){l.pitch=r}if(a!=f){l.duration=a}if(s){u.map.once("moveend",s)}if(o=="easeTo"){u.map.easeTo(l)}else if(o=="jumpTo"){u.map.jumpTo(l)}else{u.map.flyTo(l)}}};this.getBearing=function(){return u.map.getBearing()};this.setBearing=function(e){u.map.setBearing(e)};this.getPitch=function(){return u.map.getPitch()};this.setPitch=function(e){u.map.setPitch(e)};this.invalidateSize=function(){u.map.resize()};this.getBackgroundColor=function(){return this._backgroundColor};this.setBackgroundColor=function(e){this._backgroundColor=e;if(u.map.getLayer("background")){u.map.removeLayer("background")}if(e&&e!=="#ffffff"){u.map.addLayer({id:"background",type:"background",paint:{"background-color":e}},u.layers[0]?u.layers[0].id:f)}};this.setTool=function(e,t,i,n){u.map.boxSelect._onDone=null;if(e=="SelectAreaTool"||e=="AreaSelection"){u.map.boxSelect._onDone=n;u.map.boxSelect.enable()}else{u.map.boxSelect.disable()}var r={tool:e,previous_tool:t};i("toolchange",r);return e};this.setProjection=function(e){};this.setCursor=function(e){u.container.css("cursor",e);u.map._canvasContainer.style.cursor=e};this.reloadTerrain=function(){if(u.map.getTerrain()){u.map.setTerrain();u.map.removeSource("mapbox-dem");this.setupTerrain()}};this.dragging={enable:function(){u.map.dragPan.enable()},disable:function(){u.map.dragPan.disable()},enabled:function(){return u.map.dragPan.isEnabled()}};this.doubleClickZoom={enable:function(){u.map.doubleClickZoom.enable()},disable:function(){u.map.doubleClickZoom.disable()},enabled:function(){return u.map.doubleClickZoom.isEnabled()}};function l(t,e,i){var n,r,a;if(e.geometry)a=e.geometry.type;if(e instanceof Array){r=t.fromInternalCoords(e,true);if(i){r.z=r.z||0}return r}else if(a==="Point"){return t.fromInternalCoords(e.geometry.coordinates,true)}else if(a==="Polygon"){n=e.geometry.coordinates;if(d.isArray(n[0])){return new giscloud.geometry.Polygon(d.map(n,function(e){return new giscloud.geometry.Line(d.map(e,function(e){return l(t,e,i)}))}))}return new giscloud.geometry.Polygon([new giscloud.geometry.Line(d.map(n,function(e){return l(t,e,i)}))])}else if(a==="LineString"){return new giscloud.geometry.Line(d.map(e.geometry.coordinates,function(e){return l(t,e,i)}))}else{return null}}};p=function(o,e,t){var i,n,r;try{i=[];var a=d("<div/>");a.css("position","absolute").css("width","100%").css("height","100%");d("#"+e).append(a);o.container=a;r={container:a[0],attributionControl:false,projection:"mercator"};if(o.options.lockZoom){d.extend(r,{touchZoom:false,scrollWheelZoom:false,doubleClickZoom:false,zoomControl:false})}if(o.options.hideZoomButtons){d.extend(r,{zoomControl:false})}mapboxgl.accessToken="pk.eyJ1IjoiZ2lzLWNsb3VkIiwiYSI6ImNsNXdpc2U3czBrMHkzY25wdHBpMmd3amMifQ.abdXJowhfoRKhR4Zc3k4AQ";n=new mapboxgl.Map(r);n.options={};n.is_mapbox_gl=true;n.on("boxselect",function(e){if(n.boxSelect._onDone){n.boxSelect._onDone(e.startPos,e.endPos,e.originalEvent)}});n.overrideDEMTileURL=function(e,t){var i,n,r,a,s;if(!o.viewer.instance.layersDEM){return e}i=1<<t.z;n=o.map.gc_bounds;a=o.viewer.instance.layersDEM;for(s=0;s<a.length;s++){r=a[s];if(!r.fnLayer.options.visible){continue}if(t.x>Math.floor((r.xmin-n.xmin)/n.max*i)&&t.x<Math.floor((r.xmax-n.xmin)/n.max*i)&&t.y>Math.floor((n.ymax-r.ymax)/n.max*i)&&t.y<Math.floor((n.ymax-r.ymin)/n.max*i)){return h.tileSite()+"r/"+r.timestamp+"/"+o.viewer.instance._mid+"/"+r.id+"/"+t.z+"/"+t.x+"/"+t.y+".png"}}return e};o.map=n;o.layers=i}catch(e){throw{name:"Mapbox error on viewer init.",err:e}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(r,e,t,i){var n;t.supportedMapbox=a;t.notSupportedReasonMapbox=s;function a(e){if(n===i){n=!s(e)}return n}function s(e){if(!o())return"not a browser";if(!l())return"insufficent Array support";if(!c())return"insufficient Function support";if(!u())return"insufficient Object support";if(!d())return"insufficient JSON support";if(!h())return"insufficient worker support";if(!f())return"insufficient Uint8ClampedArray support";if(!p())return"insufficient ArrayBuffer support";if(!g())return"insufficient Canvas/getImageData support";if(!v(e&&e.failIfMajorPerformanceCaveat))return"insufficient WebGL support";if(!b())return"insufficient ECMAScript 6 support"}function o(){return typeof r!=="undefined"&&typeof document!=="undefined"}function l(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function c(){return Function.prototype&&Function.prototype.bind}function u(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function d(){return"JSON"in r&&"parse"in JSON&&"stringify"in JSON}function h(){if(!("Worker"in r&&"Blob"in r&&"URL"in r)){return false}var e=new Blob([""],{type:"text/javascript"});var t=URL.createObjectURL(e);var i;var n;try{n=new Worker(t);i=true}catch(e){i=false}if(n){n.terminate()}URL.revokeObjectURL(t);return i}function f(){return"Uint8ClampedArray"in r}function p(){return ArrayBuffer.isView}function g(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t){return false}var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}var m={};function v(e){if(m[e]===i){m[e]=_(e)}return m[e]}a.webGLContextAttributes={antialias:false,alpha:true,stencil:true,depth:true};function y(e){var t=document.createElement("canvas");var i=Object.create(a.webGLContextAttributes);i.failIfMajorPerformanceCaveat=e;return t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}function _(e){var t=y(e);if(!t){return false}var i;try{i=t.createShader(t.VERTEX_SHADER)}catch(e){return false}if(!i||t.isContextLost()){return false}t.shaderSource(i,"void main() {}");t.compileShader(i);return t.getShaderParameter(i,t.COMPILE_STATUS)===true}function b(){return!document.documentMode}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var r;i.ViewerMapboxLayerFactory=function(e,t){if(e.isTileLayer){new i.ViewerMapboxTileLayer(e,t)}else if(e.isBaseMapLayer){new i.ViewerMapboxBasemapLayer(e,t)}else{new i.ViewerMapboxLayer(e,t)}};r={initialize:function(e,t){this.initializeCommon(e,t)},initializeCommon:function(e,t){this._map=t;this._layer._url=e._url;e.viewerLayer=this;this._layer.fnLayer=e},addToMap:function(){this._map.addLayer(this._layer)},removeFromMap:function(){if(this.resetCache){this.resetCache()}this._map.removeLayer(this._layer.id);this._map.removeSource(this._layer.id+"_src")},setVisible:function(e){},update:function(){this._layer.fnLayer.legacyHtml5Map.Html5SendRequests()},loaded:function(){return!!this._map},setOpacity:function(e){},setZIndex:function(e){},cleanTileCss:function(e){},onTileLoad:function(e,t){},onTileError:function(e,t){},tileShouldBeLoaded:function(e){return true},tileShouldBeVisible:function(e){},getTileUrl:function(e,t){},repaint:function(){this._map._sourcesDirty=true;this._map.triggerRepaint()}};i.ViewerMapboxLayer=i.LayerClass.extend(r)})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,c){var n,r;var a=0;r={type:"raster",tileSize:256,dontRetain:true,_getCanvasTile:function(e){return this._fnLayer._tiles[this._viewerLayer.getTileKey(e.tileID)]},_onStoreToCache:function(e){if(!this._fnLayer._tiles[e.gc_state._tileIndex]||this._viewerLayer.switching){return}e.gc_state._cacheId=++a;delete this._fnLayer._tiles[e.gc_state._tileIndex];this._fnLayer.gcmap.storeTileToCache(e)},_onRestoreFromCache:function(e){var t=this._viewerLayer.getTileKey(e.tileID);e.gc_state._tileIndexWrap=e.tileID.wrap;e.gc_state._tileIndex=t;this._fnLayer._tiles[t]=e.gc_state._canvas;e.state="loading";e.gc_state.cacheRestore=true;this._fnLayer.gcmap.restoreTileFromCache(e.gc_state._canvas);delete e.gc_state._cacheId},_abortTile:function(e){this._fnLayer.abortTileRequest(this._getCanvasTile(e))},_unloadTile:function(e){if(e.gc_state){this._fnLayer._unloadTile({tile:e.gc_state._canvas,imidiateRelease:true})}},_hasTile:function(e){return this._fnLayer._tileShouldBeLoaded(e.canonical,c,c,true)},_loadTile:function(e,t){var i=this._fnLayer,n=this._getCanvasTile(e);if(this._viewerLayer.switching){return}if(n&&n.transferToAnotherViewer){var r=n.coord;var a=n.zoom;var s=n.gc_state;delete n.transferToAnotherViewer;n.gc_state=null;n.coord=null;i._tilesToRemove.push(n);var o=i._createTile(true);o.gc_state=s;o.coord=r;o.zoom=a;o._layer=i;o.gc_state.viewerTile={tile:e,callback:t,isLoaded:true};e.gc_state=s;s._canvas=o;i._tiles[this._viewerLayer.getTileKey(e.tileID)]=o;this._fnLayer.render(o,n,{x:0,y:0},c,true);this._fnLayer.viewerLayer.tileOnLoad(o);return}n=i._createTile(true);n.gc_state.viewerTile={tile:e,callback:t,isLoaded:false};sourceObj=this;e.gc_state=n.gc_state;n._layer=i;n.gc_state.gc_layer=i;n.gc_state._canvas=n;var l=i._loadTile(n,e.tileID.canonical,e.tileID.wrap);if(!l){e.state="errored";t(null)}if(i._updateTimeout){clearTimeout(i._updateTimeout)}i._updateTimeout=setTimeout(function(){i._updateTimeout=null;i.update()},0)}};n={initialize:function(e,t){var i=e.id+"_src";var s=this;t.addSource(i,r);this._layer={id:e.id,type:"raster",source:i,paint:{"raster-fade-duration":0}};this.initializeCommon(e,t);this._source=t.getSource(i);this._source._offscreenRendering=!!this._layer.fnLayer.viewer.parent.offscreenRendering;this._source._getCanvasTile=r._getCanvasTile;this._source._fnLayer=this._layer.fnLayer;this._source._viewerLayer=this;this._source._sourceCache=this._map.style._sourceCaches["other:"+this._source.id];this._source._sourceCache.onHandleWrapJump=function(e){var t=s._layer.fnLayer._tiles,i,n,r,a;i={};for(a in t){n=t[a];r=t[a].gc_state;r._tileIndex=s.getTileKey(r.viewerTile.tile.tileID);r._tileIndexWrap=r.viewerTile.tile.tileID.wrap;i[r._tileIndex]=n}s._layer.fnLayer._tiles=i;if(s._source._offscreenRendering){s._layer.fnLayer.gcmap.workerWrapTiles(s._layer.id,e)}}},tileOnLoad:function(e){var t=e.gc_state;if(!t)return;var i=t.viewerTile;if(i.tile){i.isLoaded=true;if(i.tile.state!=="loaded"){i.tile.state="loaded";i.callback(null)}}},tilesToLoad:function(){return this._layer._tilesToLoad&&this._layer._tilesToLoad>0},setZIndex:function(){},resetCache:function(){var e=this._map.style._sourceCaches["other:"+this._source.id];if(e){e._cache.reset()}},render:function(e,t,i,n,r){var a,s,o=t;if(!r&&(!e.gc_state||!e.gc_state.viewerTile||!i)){return false}a=e.gc_state.viewerTile;s=!!a.tile.texture;if(n){o=this._layer.fnLayer.gcmap.getCanvasFromPool(i.width,i.height);o.getContext("2d").drawImage(t,i.xmin,i.ymin,i.width,i.height,0,0,i.width,i.height)}this._source.renderTile(a.tile,o,{x:i.xmin,y:i.ymin},s);if(o!==t){this._layer.fnLayer.gcmap.releaseCanvasToPool(o)}if(e.gc_state.cacheRestore){delete e.gc_state.cacheRestore;a.tile.state="loaded"}if(a.tile.state==="loaded"){a.callback(null)}return true},getTileKey:function(e){return this._layer.fnLayer.gcmap.getTileKey(e.canonical.x,e.canonical.y,e.canonical.z,e.wrap)}};i.ViewerMapboxTileLayer=i.ViewerMapboxLayer.extend(n)})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,u,i,n){var t,r;t={initialize:function(e,t,i){this._map=null;this._type="marker";this._subtype="standard";var n=u("<div>");var r=null;if(!e)e=[0,0];if(i){n.html(i)}else{var a=t.icon;if(a){if(a.iconUrl||t.iconInit){var s=u("<img>",{class:"gc-marker-icon"}).appendTo(n);this.markerIcon=s;if(a.iconAnchor){s.css({marginLeft:a.iconAnchor.x,marginTop:a.iconAnchor.y})}if(a.iconSize){s.width(a.iconSize.x);s.height(a.iconSize.y)}if(a.iconUrl){s[0].src=a.iconUrl}if(t.iconInit){t.iconInit(s)}}}if(t.icon.type!=="div"){r=u("<span>",{class:"gc-marker-iconlabel"}).appendTo(n)}if(a){if(a.wrapperAnchor){n.css({marginLeft:-a.wrapperAnchor.x,marginTop:-a.wrapperAnchor.y})}if(a.labelAnchor){r.css({marginLeft:a.labelAnchor.x,marginTop:a.labelAnchor.y})}}}this._marker=new mapboxgl.Marker(n[0],{anchor:"top-left"}).setLngLat(e);var o={};for(var l in t){o[l]=t[l]}this._marker.options=o;this._marker._icon=n[0];if(r){this._marker._label=r;this._marker.setLabelText=function(e){u(this._label).html(e)}}u(n).addClass(t.icon.className);var c=this;this.dragging={enable:function(){c._marker.setDraggable(true);u(c._marker._icon).css("cursor","pointer")},disable:function(){c._marker.setDraggable(false);u(c._marker._icon).css("cursor","")}}},move:function(e){var t=e.lngLat||e;this._marker.setLngLat(t)},addTo:function(e){this._map=e;this._marker.addTo(e);if(this._rotationHandler){this._map.on("rotate",this._rotationHandler)}this._gc_container=u(this._map._container)},text:function(e){u(this._marker._icon).text(e)},html:function(e){u(this._marker._icon).html(e)},remove:function(){if(this._rotationHandler){this._map.off("rotate",this._rotationHandler)}this._marker.remove();this._map=null},bindPopup:function(e,t){this._popup=new i.ViewerMapboxPopup(t);this._popup.setContent(e);this._popup._map=this._map;this._marker.setPopup(this._popup._popup)},isLabel:function(){return this._subtype==="label"},isIcon:function(){return this._subtype==="icon"},setContent:function(e){this._marker.setContent(e)},setLabelText:function(e){if(this.isLabel()){this._marker.setLabelText(e)}},setLabel:function(e){if(this._marker.setLabelText){this._marker.setLabelText(e)}else if(this._marker.options.icon&&this._marker.options.icon.setLabelText){this._marker.options.icon.setLabelText(e)}else{u(this._marker._icon).find(".gc-marker-iconlabel").html(e)}},getLatLng:function(){var e=this._marker.getLngLat();return new i.GeomLatLng(e.lat,e.lng)},setLatLng:function(e){this._marker.setLngLat(e)},setRotation:function(e){if(!this.markerIcon){this._marker.setRotation(e);return}if(e!==n){this._rotation=e;if(!this._rotationHandler){var t=this;this._rotationHandler=function(){t.setRotation()};if(this._map){this._map.on("rotate",this._rotationHandler)}}}else{e=this._rotation}if(this._map){e-=this._map.getBearing()}this.markerIcon.css({"-webkit-transform":"rotate("+e+"deg)","-moz-transform":"rotate("+e+"deg)","-ms-transform":"rotate("+e+"deg)",transform:"rotate("+e+"deg)"})},on:function(e,t){if(e==="dragend"){this._marker.on(e,t)}else{this._gc_container.on.apply(this._gc_container,arguments)}return this},off:function(e,t){if(e==="dragend"){this._marker.off(e,t)}else{this._gc_container.off.apply(this._gc_container,arguments)}return this}};i.ViewerMapboxMarker=i.LayerClass.extend(t)})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var r;r={initialize:function(e){this._type="popup";this._map=null;e.anchor="bottom";e.closeOnClick=false;this._popup=new mapboxgl.Popup(e);this._gc_content=t("<div>",{class1:e.className}).css({"min-width":e.minWidth})},move:function(e){var t=e.lngLat||e;this._popup.setLngLat(t)},addTo:function(e){this._map=e;this._popup.addTo(e);this._gc_container=t(this._popup._container);this._gc_container.find(".mapboxgl-popup-close-button").addClass("gc-info-popup-close-button");this._gc_container.find(".mapboxgl-popup-content").addClass("gc-info-popup-content-wrapper")},setContent:function(e){this._gc_content.html(e);this._popup.setHTML(this._gc_content.prop("outerHTML"));if(this._gc_container){this._gc_container.find(".mapboxgl-popup-close-button").addClass("gc-info-popup-close-button")}},remove:function(){this._popup.remove()},fire:function(e,t){this._gc_container.triggerHandler(e,t)},on:function(e,t){if(e==="open"||e==="close"){this._popup.on(e,t)}else{this._gc_container.on.apply(this._gc_container,arguments)}return this},off:function(e,t){if(e==="open"||e==="close"){this._popup.off(e,t)}else{this._gc_container.off.apply(this._gc_container,arguments)}return this}};i.ViewerMapboxPopup=i.LayerClass.extend(r)})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,p,t,g){t.ViewerMapboxDrawing=function(e,i,t){var n=[],r,a=false;var s={enable:function e(t){setTimeout(function(){if(!t.map||!t.map.doubleClickZoom||!t.map.dragPan||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue)return;if(!t._ctx.store.getInitialConfigValue("doubleClickZoom"))return;t.map.doubleClickZoom.enable();t.map.dragPan.enable()},0)},disable:function e(t){setTimeout(function(){if(!t.map||!t.map.doubleClickZoom||!t.map.dragPan)return;t.map.doubleClickZoom.disable();t.map.dragPan.disable()},0)}};var o={onSetup:function e(t){var i=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});this.addFeature(i);this.clearSelectedFeatures();s.disable(this);this.updateUIClasses({mouse:"add"});this.setActionableState({trash:true});return{rectangle:i}},onTap:function e(t,i){if(t.startPoint)this.onMouseMove(t,i);this.onClick(t,i)},onClick:function e(t,i){if(t.startPoint&&t.startPoint[0]!==i.lngLat.lng&&t.startPoint[1]!==i.lngLat.lat){this.updateUIClasses({mouse:"pointer"});t.endPoint=[i.lngLat.lng,i.lngLat.lat];this.changeMode("simple_select",{featuresId:t.rectangle.id})}var n=[i.lngLat.lng,i.lngLat.lat];t.startPoint=n},onDrag:function e(t,i){this.updateUIClasses({mouse:"add"});if(!t.startPoint)t.startPoint=[i.lngLat.lng,i.lngLat.lat];if(t.startPoint){l(t,i)}t.endPoint=[i.lngLat.lng,i.lngLat.lat]},onMouseUp:function e(t,i){if(t.startPoint&&t.endPoint){this.updateUIClasses({mouse:"pointer"});this.changeMode("simple_select",{featuresId:t.rectangle.id})}},onMouseMove:function e(t,i){if(t.startPoint){l(t,i)}},onKeyUp:function e(t,i){if(i.keyCode===27)return this.changeMode("simple_select")},onStop:function e(t){s.enable(this);this.updateUIClasses({mouse:"none"});this.activateUIButton();if(this.getFeature(t.rectangle.id)===g)return;t.rectangle.removeCoordinate("0.4");if(t.rectangle.isValid()){this.map.fire("draw.create",{features:[t.rectangle.toGeoJSON()]})}else{this.deleteFeature([t.rectangle.id],{silent:true});this.changeMode("simple_select",{},{silent:true})}},toDisplayFeatures:function e(t,i,n){var r=i.properties.id===t.rectangle.id;i.properties.active=r?"true":"false";if(!r)return n(i);if(!t.startPoint)return;return n(i)},onTrash:function e(t){this.deleteFeature([t.rectangle.id],{silent:true});this.changeMode("simple_select")}};function l(e,t){e.rectangle.updateCoordinate("0.0",e.startPoint[0],e.startPoint[1]);e.rectangle.updateCoordinate("0.1",t.lngLat.lng,e.startPoint[1]);e.rectangle.updateCoordinate("0.2",t.lngLat.lng,t.lngLat.lat);e.rectangle.updateCoordinate("0.3",e.startPoint[0],t.lngLat.lat);e.rectangle.updateCoordinate("0.4",e.startPoint[0],e.startPoint[1])}var c={};c.onSetup=function(){this.setActionableState();return{}};c.toDisplayFeatures=function(e,t,i){i(t)};function u(){if(MapboxDraw._gcOverrides)return;MapboxDraw.modes.draw_rectangle=o;MapboxDraw.modes.static=c;MapboxDraw.modes.direct_select.onDrag2=MapboxDraw.modes.direct_select.onDrag;MapboxDraw.modes.direct_select.onDrag=function(e,t){var i=this._ctx.map._gcState;t.lngLat=i.drawing.checkSnapping(t);this.onDrag2(e,t);if(!i.fnCanvas.measureDisplay())return;if(e.selectedCoordPaths&&e.selectedCoordPaths.length>=1){var n=e.selectedCoordPaths[0].split(".");var r=e.feature.coordinates[n[0]*1];var a=r.length;var s=n[1]*1;var o=s-1;var l=s+1;if(o<0){o=a-1}if(l>=a){l=0}s=h(r[s]);o=h(r[o]);l=h(r[l]);i.fnCanvas.showMeasureMarker(1,s,o);i.fnCanvas.showMeasureMarker(2,s,l)}};MapboxDraw.modes.direct_select.stopDragging2=MapboxDraw.modes.direct_select.stopDragging;MapboxDraw.modes.direct_select.stopDragging=function(e){var t=this._ctx.map._gcState;if(e.dragMoving){t.fnCanvas.hideSnappingTooltip();t.fnCanvas.hideMeasureMarker()}this.stopDragging2(e)};MapboxDraw.modes.draw_polygon.onKeyUp=function(){};MapboxDraw.modes.draw_polygon.onMouseMove2=MapboxDraw.modes.draw_polygon.onMouseMove;MapboxDraw.modes.draw_polygon.onMouseMove=function(e,t){var i=this._ctx.map._gcState;i.drawCurrentMode=this;i.drawLastMouseEvent=t;i.drawCurrentGeometryState=e;i.drawStore=e.polygon.ctx.store;i.drawing.setPoints(e.polygon.coordinates[0]);this.onMouseMove2(e,{lngLat:i.fnCanvas.getOverridenPoint(t.lngLat)});i.drawTriggerUpdate(e.polygon.coordinates[0],true)};MapboxDraw.modes.draw_polygon.clickAnywhere2=MapboxDraw.modes.draw_polygon.clickAnywhere;MapboxDraw.modes.draw_polygon.clickAnywhere=function(e,t){var i=this._ctx.map._gcState;var n=e.currentVertexPosition;i.drawing.setPoints(e.polygon.coordinates[0]);this.clickAnywhere2(e,{lngLat:i.fnCanvas.getOverridenPoint(t.lngLat)});if(n!=e.currentVertexPosition){i.drawTriggerUpdate(e.polygon.coordinates[0])}};MapboxDraw.modes.draw_line_string.onMouseMove2=MapboxDraw.modes.draw_line_string.onMouseMove;MapboxDraw.modes.draw_line_string.onMouseMove=function(e,t){var i=this._ctx.map._gcState;i.drawCurrentMode=this;i.drawLastMouseEvent=t;i.drawCurrentGeometryState=e;i.drawStore=e.line.ctx.store;this.onMouseMove2(e,{lngLat:i.fnCanvas.getOverridenPoint(t.lngLat)});i.drawTriggerUpdate(e.line.coordinates,true)};MapboxDraw.modes.draw_line_string.clickAnywhere2=MapboxDraw.modes.draw_line_string.clickAnywhere;MapboxDraw.modes.draw_line_string.clickAnywhere=function(e,t){var i=this._ctx.map._gcState;var n=e.currentVertexPosition;i.currentGeometry=e;this.clickAnywhere2(e,{lngLat:i.fnCanvas.getOverridenPoint(t.lngLat)});if(n!=e.currentVertexPosition){i.drawTriggerUpdate(e.line.coordinates)}};MapboxDraw.modes.draw_rectangle.onMouseMove2=MapboxDraw.modes.draw_rectangle.onMouseMove;MapboxDraw.modes.draw_rectangle.onMouseMove=function(e,t){var i=this._ctx.map._gcState;this.onMouseMove2(e,t);i.drawTriggerUpdate(e.rectangle.coordinates[0],true)};MapboxDraw._gcOverrides=true}function d(){u();var e=new MapboxDraw({displayControlsDefault:false,defaultMode:"static"});i.map._gcState=i;i.fnCanvas=t;i.drawTriggerUpdate=f;i.map.addControl(e);i.draw=e;i.map.on("draw.create",function(e){if(i.drawing){var t=e.features[0];if(t.geometry.type=="Point"){i.drawing.setPoints([t.geometry.coordinates])}else if(t.geometry.type=="Polygon"){i.drawing.setPoints(t.geometry.coordinates[0])}else{i.drawing.setPoints(t.geometry.coordinates)}i.drawing.end();i.draw.delete(t.id)}})}function h(e){return{lng:e[0],lat:e[1]}}function f(e,t){n=e;r&&r.notify(a,n,t)}return{initialize:function(){d()},initSnapping:function(){},endSnapping:function(){},initEdit:function(){},addPoint:function(){if(i.drawCurrentMode){i.drawCurrentMode.clickAnywhere(i.drawCurrentGeometryState,i.drawLastMouseEvent)}},handleNumericKeypress:function(){if(i.drawCurrentMode){i.drawCurrentMode.onMouseMove(i.drawCurrentGeometryState,i.drawLastMouseEvent);i.drawStore.render()}},currentlyDrawing:function(){return a},rectangleMode:function(e){i.drawCurrentMode=null;if(e){a="rectangle";i.draw.changeMode("draw_rectangle")}else{i.draw.changeMode("draw_polygon")}},checkSnapping:function(e){return t.snapping()?t.checkForSnapping(e.lngLat):e.lngLat},hideSnappingTooltip:function(){t.hideSnappingTooltip()},currentShapeGeometry:function(e){if(a){return{currentlyDrawing:a,points:n}}return null},getPoint:function(e){if(e<0){e+=n.length}var t=n[e];return t?h(t):null},start:function(e){a=e;var t="draw_polygon";if(e=="line"){t="draw_line_string"}else if(e=="point"){t="draw_point"}i.drawCurrentMode=null;i.draw.changeMode(t);r=new p.Deferred;return r.promise()},end:function(e){if(!a)return;a=false;i.drawCurrentMode=null;i.draw.changeMode("simple_select");if(r){if(n===null)r.reject(e);else r.resolve(n,e);n=[];t.cleanUp()}if(r)return r.promise()},cancel:function(e){a=false;i.drawCurrentMode=null;i.draw.changeMode("simple_select");if(r){r.reject(e);n=[];t.cleanUp()}return r.promise()},reloadSnappingData:function(){loadSnappingData()},setPoints:function(e){n=e}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){i.ViewerMapboxControl=function(g){var m=g.viewer;this.selectExtent=function(e){var h,t,f,p;t=function(e,t){var i=h.fromInternalCoords(g.map.unproject(e)),n=h.fromInternalCoords(g.map.unproject(t)),r,a,s,o,l,c,u,d;if(i.x<n.x){r=i.x;a=n.x}else{r=n.x;a=i.x}if(i.y<n.y){s=i.y;o=n.y}else{s=n.y;o=i.y}l=[new giscloud.geometry.Point(r,s),new giscloud.geometry.Point(a,s),new giscloud.geometry.Point(a,o),new giscloud.geometry.Point(r,o),new giscloud.geometry.Point(r,s)];c=new giscloud.GraphicStyle("polygon");u=new giscloud.geometry.Line(l);d=new giscloud.geometry.Polygon([u]);if(p){m.graphic.remove(p)}p=new giscloud.GraphicFeature(d,c);m.graphic.add(p);f=new giscloud.Bounds(r,s,a,o)},init=function(e){h=m.instance;g.map.boxSelect._onDone=t;g.map.boxSelect.enable();h.setCursor("crosshair")},finalize=function(){g.map.boxSelect.disable();g.map.boxSelect._onDone=null;if(p){m.graphic.remove(p)}p=null},getExtent=function(){return f};return{init:init,getExtent:getExtent,finalize:finalize}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,j,I,E){var t={};var A;giscloud.Graphic=function(l){var o={},c=this,r={},a=I.oid(),u=false,n=false,s,t=false,d=false,i={},h=new giscloud.GraphicStyle("line"),f,e,p,g,m;h.color=giscloud.Color.fromHex("#006BFF");h.color.alpha(80);h.size=6;function v(i){var n,e;if(!u){j.each(o,function(e,t){if(t.gid===i.id){n=t.feat;return null}});e={click:"click",dblclick:"doubleClick",mousedown:"mouseDown",mouseover:"mouseOver",mouseout:"mouseOut"}[i.type]||i.type;if(e&&n){j(r).triggerHandler(e,[n]);j(n).triggerHandler(e)}}}function y(e){var t=o[this.id],i=t&&t.gid,n,r;if(f&&i){if(e){f.remove(i);t.gid=null;if(e instanceof giscloud.geometry.Point||e instanceof giscloud.geometry.Multipoint){n=new giscloud.GraphicStyle("point")}else if(e instanceof giscloud.geometry.Line||e instanceof giscloud.geometry.Multiline){n=new giscloud.GraphicStyle("line")}else if(e instanceof giscloud.geometry.Polygon||e instanceof giscloud.geometry.Multipolygon){n=new giscloud.GraphicStyle("polygon")}else{n=new giscloud.GraphicStyle}r=t.feat.style();r.fill=n.fill?r.fill||n.fill:null;r.size=n.size?r.size||n.size:null;t.feat.style(r);i=f.addShape({geom:e,color:r.color.hex("0x"),fill:r.fill&&r.fill.hex("0x"),alpha:Math.max(r.color.alpha(),r.fill?r.fill.alpha():0),width:r.size,size:r.size},null,true);t.gid=i}}}function _(e){var t=o[this.id],i=t&&t.gid,n;if(f&&i){if(e.color!=null){f.setAttributeGeometry(i,"color",e.color.hex("#"),true)}if(e.fill!=null){f.setAttributeGeometry(i,"fill",e.fill.hex("#"),true)}if(e.size!=null){f.setAttributeGeometry(i,"size",e.size,true);f.setAttributeGeometry(i,"width",e.size,true)}if(e.border!=null){f.setAttributeGeometry(i,"border",e.border,true)}if(e.shape==="circle"){n=(e.size||0)+(e.border||0);f.setAttributeGeometry(i,"borderRadius",n,true)}else{f.setAttributeGeometry(i,"borderRadius",0,true)}f.redrawGeometry(i)}}function b(e){var t=o[this.id],i=t&&t.gid;if(f&&i){f.setGeometryVisible(i,!!e)}}function w(e){f.init();m=e;i={dragging:l.instance.dragging.enabled(),doubleClickZoom:l.instance.doubleClickZoom.enabled()};l.instance.dragging.disable();l.instance.doubleClickZoom.disable();l.instance.on("mousedown",C);l.instance.on("touchstart",C);j(document).keyup(x);t=false;d=false;return new j.Deferred}function x(e){if(e.which===27){L()}else if(e.which===13){S()}else{return true}}function C(e){l.instance.off("mousedown",C);l.instance.on("mousedown",T);l.instance.off("touchstart",C);l.instance.on("touchmove",T);if(e.type==="mousedown"){A=e.originalEvent.button;T(e)}}function T(e){if(A!==e.originalEvent.button)return;var t,i,n,r,a;if((e.type==="touchmove"||e.type==="touchstart")&&e.originalEvent){e.originalEvent.preventDefault()}if(e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>1){return}l.instance.off("touchmove",T);t=m.style;if(!t.color||!t.color.hex){n="#006BFF";r=.8}else{n=t.color.hex();r=t.color.alpha()/100}i={color:n,opacity:r,weight:t.size!=null?parseFloat(t.size):4};if(i.opacity>1)i.opacity/=100;var s=l.instance.fromInternalCoords(e.latlng);a=new giscloud.geometry.Line([s,s]);d=new giscloud.GraphicFeature(a,m.style);c.add(d);l.instance.on("mousemove",k);l.instance.on("mouseup",M);l.instance.on("touchmove",k);l.instance.on("touchend",M)}function k(e){if(e.type==="touchmove"&&e.originalEvent){e.originalEvent.preventDefault();if(e.originalEvent.touches&&e.originalEvent.touches.length>1){return}}d.geometry().points.push(l.instance.fromInternalCoords(e.latlng));y.call(d,d.geometry())}function M(){var e;l.instance.off("mousemove",k);l.instance.off("mouseup",M);l.instance.off("touchmove",k);l.instance.off("touchend",M);l.instance.on("touchmove",T);if(!d)return;e=d.geometry();if(!t){e=new giscloud.geometry.Multiline([e]);t=new giscloud.GraphicFeature(e,m.style);c.add(t)}else{t.geometry().lines.push(e);y.call(t,t.geometry())}c.remove(d);d=null}function S(){D()}function L(){if(t){c.remove(t);t=null}D()}function D(){i.dragging?l.instance.dragging.enable():l.instance.dragging.disable();i.doubleClickZoom?l.instance.doubleClickZoom.enable():l.instance.doubleClickZoom.disable();l.instance.off("mousedown",C);l.instance.off("mousedown",T);l.instance.off("mouseup",M);l.instance.off("mousemove",k);l.instance.off("touchstart",C);l.instance.off("touchstart",T);l.instance.off("touchend",M);l.instance.off("touchmove",T);l.instance.off("touchmove",k);j(document).off("keyup",x);u=false;if(t){c.remove(t);p.resolveWith(c,[t])}else{p.rejectWith(c,[null])}}l.initializing.done(function(){f=l.instance.plugins.canvas;f.addEventListener("click",v);f.addEventListener("dblclick",v);f.addEventListener("mousedown",v);f.addEventListener("mouseover",v);f.addEventListener("mouseout",v)});e=this.features=[];this.bind=function(e,t){var i=this,n=function(){var e=Array.prototype.slice.call(arguments,1);t.apply(i,e)};j(r).on(e,n);if(!t.gcunbind){t.gcunbind={}}t.gcunbind[a+e]=n;return this};this.unbind=function(e,t){var i;i=t.gcunbind&&t.gcunbind[a+e];j(r).off(e,i);return this};this.isFeatureCountOkForSnapping=function(){var e,i,t,n,r,a=new j.Deferred;if(!f){a.reject();return a.promise()}e=f.snappingLayers();i=0;for(t in e){if(e[t]){r++;l.layerById(t).instance.getFeatureIds(function(e,t){i+=t.length;f.setSnappingLayerFids(e,t);r--;if(r===0){n=i<1e4;f.canSnap(n);if(n){a.resolve()}else{a.reject()}}})}}return a.promise()};this.snapToLayersGeometry=function(r){var e,t,i,a,s=false,n,o;if(r==null){if(l.initializing.state()!=="resolved"||l.loading.state()!=="resolved"){return false}i={};a=f.snappingLayers();e=l.layers||[];for(n=e.length-1;n>=0;n--){t=e[n];o=t.id.toString();if(t.type&&j.inArray(t.type,["tile","wms","wfs","wmts","raster","folder"])>-1){continue}i[o]=f.snapping()&&!!a[o]}return i}l.initializing.done(function(){a={};if(r===false){f.snappingLayers({});f.snapping(false);return}j.each(l.layers,function(e,t){var i=t.id.toString(),n=r===true||!!r[i];if(t.type&&j.inArray(t.type,["tile","wms","wfs","wmts","raster","folder"])>-1){return true}s=s||n;a[i]=n});f.snappingLayers(a);f.snapping(s)});return this};this.draw=function(e,t,i,n){var a,s=this;if(!j.isFunction(t)&&!j.isFunction(i)){n=t||{}}if(p&&p.state()==="pending"){if(u==="freehand"){S()}else{f.endDraw()}}if(e===false){return p.promise()}else{g=function e(t,i){var n,r;if(!i){i=t}else if(t&&t instanceof giscloud.GraphicStyle){r=t}if(i&&i.geom){n=new giscloud.GraphicFeature(giscloud.geometry.fromOGC(i.geom));if(n){o[n.id]={gid:a,feat:n,ind:s.features.length};_.call(n,r||n.style());s.features.push(n);n.bind("geometryChanged",y);n.bind("styleChanged",_);n.bind("visibilityChanged",b);p.resolveWith(s,[n])}else{p.rejectWith(s,[])}}else{p.rejectWith(s,[])}u=false},onDraw=function e(t,i){p.notify(t,i)};if(e==="point"||e==="line"||e==="polygon"){p=new j.Deferred;f.addEventListener("add",g.bind(this,n));f.addEventListener("draw",onDraw);p.always(function(){f.removeEventListener("add",g.bind(this,n));f.removeEventListener("draw",onDraw)});u=e;a=f.add(e)}else if(e==="freehand"){if(!n){n={}}else if(n instanceof giscloud.GraphicStyle){n={style:n}}if(!n.style){n.style=h}p=w(n);u="freehand"}else{throw"Invalid type. Use 'point', 'line', 'polygon' or 'freehand'."}if(typeof t==="function"){p.done(t)}if(typeof i==="function"){p.fail(i)}return p.promise()}};this.acceptDraw=function(){if(p&&p.state()==="pending"){if(u==="freehand"){S()}else{f.endDraw({cancel:false});p.reject()}}return this};this.cancelDraw=function(){if(p&&p.state()==="pending"){if(u==="freehand"){L()}else{f.endDraw({cancel:true});p.reject()}}return this};this.exists=function(e){return o[e.id]};this.setId=function(e,t){if(this.exists(e)){o[t]=o[e.id];delete o[e.id]}e.id=t};this.add=function(r){var a=this;l.initializing.done(function(){var e,t,i,n;if(r instanceof giscloud.GraphicFeature){t=r.geometry();if(t){i=r.style();n=i.fill&&i.color.alpha()<i.fill.alpha()?i.fill.alpha():i.color.alpha();if(n>1)n=n/100;e=f.addShape({geom:t,color:i.color&&i.color.hex("0x"),fill:i.fill&&i.fill.hex("0x"),alpha:n,width:i.size,size:i.size,border:i.border,shape:i.shape},null,true);o[r.id]={gid:e,feat:r,ind:a.features.length};r.graphicScene=a;a.features.push(r);r.bind("geometryChanged",y);r.bind("styleChanged",_);r.bind("visibilityChanged",b)}}});return this};this.edit=function(t){var e,i=o[t.id];if(!i){throw"Unknown graphic feature."}if(n&&n.state()==="pending"){this.cancel()}e=f.getGeometry?f.getGeometry(i.gid):giscloud.geometry.fromOGC(f.serializeGeometryOpenGIS(i.gid));n=(new j.Deferred).done(function(){f.editGeometryEnd(i.gid);var e=f.getGeometry?f.getGeometry(i.gid):giscloud.geometry.fromOGC(f.serializeGeometryOpenGIS(i.gid));t.geometry(e)}).fail(function(){f.editGeometryEnd(i.gid);t.geometry(e)});f.editGeometry(i.gid);s=t;return n.pipe(function(){return t},function(){return t}).always(function(){s=null})};this.editAccept=function(){if(n&&n.state()==="pending"){n.resolve()}return this};this.editCancel=function(){if(n&&n.state()==="pending"){n.reject()}return this};this.editedFeature=function(){return s};this.remove=function(t){var i=this;l.initializing.done(function(){var e;if(t instanceof giscloud.GraphicFeature){if(t.graphicScene)delete t.graphicScene;t=t.id}e=o[t];if(e!==E){f.remove(e.gid);i.features.splice(e.ind,1);e.feat.unbind("geometryChanged",y);e.feat.unbind("styleChanged",_);e.feat.unbind("visibilityChanged",b);delete o[t];e=null}});return this};this.clear=function(){if(f){if(p&&p.state()==="pending"){f.endDraw()}f.clear();j.each(this.features,function(e,t){t.unbind("geometryChanged",y);t.unbind("styleChanged",_);t.unbind("visibilityChanged",b)});this.features=[];o={}}return this};this.measureDisplay=function(e){if(e==null)return f.measureDisplay();else f.measureDisplay(e);return this}};giscloud.GraphicFeature=function(e,t){var i=I.oid(),n,r,a,s=true;if(e&&e.geometry&&e.style&&t===E){n=e;i=n.id!=null?"_orig"+n.id:i;r=n.geometry;a=n.style;this.epsg=n.epsg||null;this.proj4=n.proj4||null;this.resourceId=n.resourceId}else{if(!t||t.constructor!==giscloud.GraphicStyle){if(e instanceof giscloud.geometry.Point||e instanceof giscloud.geometry.Multipoint){a=new giscloud.GraphicStyle("point")}else if(e instanceof giscloud.geometry.Line||e instanceof giscloud.geometry.Multiline){a=new giscloud.GraphicStyle("line")}else if(e instanceof giscloud.geometry.Polygon||e instanceof giscloud.geometry.Multipolygon){a=new giscloud.GraphicStyle("polygon")}else{a=new giscloud.GraphicStyle}}else{a=t}if(e instanceof giscloud.Geometry)r=e}this.geometry=function(e){if(e){r=e;j(this).triggerHandler("geometryChanged",[r]);return this}else{return r}};this.style=function(e){if(e){j.extend(a,e);j(this).triggerHandler("styleChanged",[a]);return this}else{return a}};this.visibility=function(e){if(typeof e==="boolean"){s=e;j(this).triggerHandler("visibilityChanged",[s]);return this}else{return s}};this.id="graphic"+i;this.bind=function(e,t){var i=this,n=function(){var e=Array.prototype.slice.call(arguments,1);t.apply(i,e)};j(this).on(e,n);if(!t.gcunbind){t.gcunbind={}}t.gcunbind[this.id+e]=n;return this};this.unbind=function(e,t){var i;i=t.gcunbind&&t.gcunbind[this.id+e];j(this).off(e,i);return this};this.toOGC=function(){if(r){return r.toOGC()}else{return null}}};giscloud.GraphicFeature.prototype={toDataObject:function(){var e={};if(typeof this.id==="string"&&this.id.indexOf("orig")>-1){e.id=parseInt(this.id.match(/graphic_orig(\d+)/)[1],10)}e.resourceId=this.resourceId;e.geometry=new giscloud.geometry.GeometryCollection([this.geometry()]).toOGC();e.style=this.style().stringify();e.epsg=this.epsg||null;e.proj4=this.proj4||null;return e},update:function(){var t=this,e=this.toDataObject(),i;if(e.id!=null){i=e.id;delete e.id;return giscloud.graphicFeatures.update(i,e)}return giscloud.graphicFeatures.create(e).then(function(e){if(t.graphicScene){t.graphicScene.setId(t,"graphic_orig"+e)}else{t.id="graphic_orig"+e}return t}).promise()},remove:function(){return giscloud.graphicFeatures.remove(this.toDataObject().id)}};giscloud.GraphicStyle=function(e){if(typeof e==="string"){switch(e){case"point":j.extend(true,this,t.pointStyle);break;case"line":j.extend(true,this,t.lineStyle);break;case"polygon":j.extend(true,this,t.polygonStyle);break;default:break}}else{e=e||{};this.color=e.color!=null&&e.color instanceof giscloud.Color?e.color:null;this.fill=e.fill!=null&&e.fill instanceof giscloud.Color?e.fill:null;this.size=typeof e.size==="number"?e.size:null;this.border=typeof e.border==="number"?e.border:null;this.shape=e.shape==="circle"?"circle":e.shape==="square"?"square":null}};giscloud.GraphicStyle.prototype.stringify=function e(){var t={};if(this.color!=null)t.color=this.color.toRgbaString();if(this.fill!=null)t.fill=this.fill.toRgbaString();if(this.size!=null)t.size=parseInt(this.size,10);if(this.border!=null)t.border=parseInt(this.border,10);if(this.shape!=null)t.shape=this.shape;return JSON.stringify(t)};giscloud.GraphicStyle.parse=function e(t){var i=JSON.parse(t);if(i.color!=null)i.color=giscloud.Color.fromString(i.color);if(i.fill!=null)i.fill=giscloud.Color.fromString(i.fill);if(i.size!=null){i.size=parseInt(i.size,10);if(isNaN(i.size))i.size=null}return new giscloud.GraphicStyle(i)};t={pointStyle:new giscloud.GraphicStyle({color:new giscloud.Color(0,0,0,100),fill:new giscloud.Color(255,255,255,100),size:8,border:1,shape:"circle"}),lineStyle:new giscloud.GraphicStyle({color:new giscloud.Color(0,0,0,100),size:1}),polygonStyle:new giscloud.GraphicStyle({color:new giscloud.Color(0,0,0,100),fill:new giscloud.Color(255,0,0,100)})}})(window,giscloud.exposeJQuery(),giscloud.common());(function(s,i){var n=/[a-z0-9._%+\-]+@[a-z0-9.\-]+/i,c=i&&i.exposeJQuery()||s.jQuery;gravatar={hash:function(e){var t=i.md5||s.md5;if(!t){throw"No window.md5 hashing function available."}if(typeof e==="string"){if(n.test(e))return t(e.toLowerCase());return e}return null},element:function(e,t,i,n,r){var a,s=new c.Deferred,o,l={width:i,height:i,borderRadius:i};a=this.url(t,i,n,"404");if(e.firstName()&&e.lastName()){o=e.firstName().charAt(0)+e.lastName().charAt(0)}else{o=e.username().charAt(0)}o=o.toUpperCase();c.ajax({url:a,context:this}).always(function(e,t){if(t.toLowerCase().indexOf("error")>-1){l=c.extend(l,{backgroundColor:"#f5f5f5",border:"1px solid #e3e3e3",textAlign:"center",lineHeight:i+"px",fontWeight:700,fontSize:i/2-2+"px"},r);s.resolve(c("<div>",{css:l,text:o}))}else{l=c.extend(l,{backgroundImage:"url("+a+")"},r);s.resolve(c("<div>",{css:l}))}});return s},url:function(e,t,i,n){var r,a;r=this.hash(e);if(typeof t!=="number"){t=80}if(i){a="https:"}else{a=s.location.protocol=="https:"?"https:":"http:"}if(n==null){n="mm"}return[a,"//www.gravatar.com/avatar/",r,"?r=g&s=",t,"&d=",n].join("")},image:function(e,t,i,n,r){var a,s;s=c("<img/>",{src:this.url(e,t,n,r)});if(i){if(i.jquery){a=c(i)}else{a=c("#"+i)}}if(a&&a.length){a.append(s)}return s},profile:function(e){var t=gravatar.hash(e),i=["https://www.gravatar.com/",t,".json"].join("");return c.ajax(i,{dataType:"jsonp"}).then(function(e){return e},function(){return null})}};if(i){i.gravatar=gravatar}else{s.gravatar=gravatar}})(window,giscloud);(function(e,o,l,a){giscloud.Map=function(){var e=this,t=arguments,i=t.length,n={},r=l.oid(),a,s;o.extend(this,{id:null,resourceId:null,name:null,description:null,owner:null,active:null,copyright:null,proj4:null,epsg:null,units_proj4:null,units:null,measure_unit:null,maxzoom:null,share:null,bgcolor:null,wmsaccess:null,archived:null,modified:null,accessed:null,created:null,visited:null,bounds:null});if(typeof t[0]=="number"){this.id=t[0];this.refresh(t[2],t[1])}else if(typeof t[0]=="object"){a=t[0];this.id=parseInt(a.id,10);this.resourceId=parseInt(a.resource_id,10);this.name=a.name;this.description=a.description;this.owner=a.owner;this.active=a.active;this.copyright=a.copyright;this.proj4=a.proj4;this.epsg=a.epsg;this.units=a.units;this.measure_unit=a.measure_unit;this.units_proj4=a.units_proj4;this.maxzoom=a.maxzoom;this.share=a.share;this.bgcolor=a.bgcolor;this.wmsaccess=a.wmsaccess;this.archived=a.archived;this.modified=new Date(a.modified*1e3);this.accessed=new Date(a.accessed*1e3);this.created=new Date(a.created*1e3);this.visited=isNaN(a.visited)?null:parseInt(a.visited,10);if(a.options){this.options=a.options}if(a.permissions){this.permissions=a.permissions}if(a.bounds){try{s=a.bounds&&o.parseJSON(a.bounds)}catch(e){s=null}if(s){this.bounds=new giscloud.Bounds(parseFloat(s.xmin),parseFloat(s.ymin),parseFloat(s.xmax),parseFloat(s.ymax))}}if(t[1]){this.refreshLayers(t[2])}o.extend(true,this,{remove:function(){return giscloud.maps.remove(this.id)},archive:function(){return giscloud.maps.archive(this.id)},restore:function(){return giscloud.maps.restore(this.id)},update:function(){var e,t=o.extend({},a);t.name=this.name;if(this.bounds){e={xmin:this.bounds.left,ymin:this.bounds.bottom,xmax:this.bounds.right,ymax:this.bounds.top}}t.bounds=JSON.stringify(e);t.description=this.description;t.active=this.active;t.copyright=this.copyright;t.proj4=this.proj4;t.units=this.units;t.measure_unit=this.measure_unit;t.units_proj4=this.units_proj4;t.maxzoom=this.maxzoom;t.share=this.share;t.bgcolor=this.bgcolor;t.wmsaccess=this.wmsaccess;t.archived=this.archived;delete t.id;delete t.resourceId;return giscloud.maps.update(a.id,t)},clone:function(){var e={};o.extend(e,a);delete e.id;delete e.resourceId;return giscloud.maps.create(e)},users:function(){var e,t,i={owner:null,editors:[],viewers:[]};if(typeof this.owner==="object"){i.owner={id:this.owner.id,username:this.owner.username}}else{i.owner=this.owner}t=l.rest.get("maps/"+this.id+"/sharing").done(function(e){if(e&&e.data&&e.data.length){o.each(e.data,function(e,t){if(t.view==="t"){i.viewers.push({id:t.user_id,username:t.username})}if(t.edit==="t"){i.editors.push({id:t.user_id,username:t.username})}})}});e=o.when(t);return e.pipe(function(){return i}).promise()}})}else{l.setError(this,"constructor","Invalid constructor arguments")}};o.extend(giscloud.Map.prototype,{refresh:function(t,i){var n=this,e=this.id,r=function(e){if(typeof t=="function"){t(e)}};if(typeof e===a||e===null){l.setError(this,"refresh","Map id is not set.")}else{giscloud.maps.byId(e,function(e){n.resourceId=parseInt(e.resource_id,10);n.name=e.name;n.description=e.description;n.owner=e.owner;n.active=e.active;n.copyright=e.copyright;n.proj4=e.proj4;n.epsg=e.epsg;n.units=e.units;n.measure_unit=e.measure_unit;n.units_proj4=e.units_proj4;n.maxzoom=e.maxzoom;n.share=e.share;n.bgcolor=e.bgcolor;n.wmsaccess=e.wmsaccess;n.archived=e.archived;n.modified=new Date(e.modified);n.accessed=new Date(e.accessed);n.created=new Date(e.created);if(e.bounds){b=e.bounds&&o.parseJSON(e.bounds);if(b){n.bounds=new giscloud.Bounds(parseFloat(b.xmin),parseFloat(b.ymin),parseFloat(b.xmax),parseFloat(b.ymax))}}if(i){n.refreshLayers(r)}else{r(n)}},true)}return this},refreshLayers:function(t){var i=this,e=this.id;if(!isFinite(e)){l.setError(this,"refreshLayers","Map id is not set.")}else{giscloud.layers.byMapId(e,function(e){i.layers=e;if(typeof t=="function"){t(i)}})}return this},reset:function(e){return giscloud.maps.reset(this.id,e)},imageUrl:function(e,t){if(typeof e!=="number"&&typeof t!=="number"){e=400;t=400}return l.rest.url(["maps/",this.id,"/render.png?width=",e,"&height=",t,"&timestamp="+this.modified].join(""))},iframeUrl:function(e,t){var i,n,r,a,s;if(typeof e==="object"){n=e}i=l.rest.url("maps/"+this.id+"/render.iframe");if(n){r=[];for(a in n){if(n.hasOwnProperty(a)){s=n[a]!=null?n[a].toString():"";r.push(a+"="+s)}}i+=r.length>0?"?"+r.join("&"):""}else if(typeof e==="number"&&typeof t==="number"){i+="?width="+e+"&height="+t}return i}})})(window,giscloud.exposeJQuery(),giscloud.common());(function(t,e,i){giscloud.Task=function(e){t.extend(this,{id:e&&e.id||null,owner:e&&e.owner_id||null,type:e&&e.task_type_id||null,params:e&&e.params||null,alternateEmail:e&&e.alternate_email||null,status:e&&!isNaN(e.status)?e.status:null,priority:e&&!isNaN(e.priority)?e.priority:null,appId:e&&!isNaN(e.appId)?e.gc_app_id:null,timeSpent:e&&!isNaN(e.time_spent)?e.time_spent:null,requested:e&&!isNaN(e.timestamp_requested)&&new Date(e.timestamp_requested)||null,processed:e&&!isNaN(e.timestamp_processed)&&new Date(e.timestamp_processed)||null,scheduled:e&&!isNaN(e.timestamp_scheduled)&&new Date(e.timestamp_scheduled)||null})};giscloud.Task.prototype={create:function(e){return giscloud.tasks.create({task_type_id:this.type,alternate_email:this.alternateEmail,gc_app_id:this.appId,priority:this.priority,params:e||this.params})},remove:function(){return giscloud.tasks.remove(this.id)}}})(giscloud.exposeJQuery(),giscloud.common());(function(e,m,v,t){giscloud.ui={Toolbar:function(r){var n=this,e,t,i=r.viewer,a=v.oid(),s={},o,l=[],c={},u=function(e){var t="gctoolbar"+"_"+a+"_"+e.name,i;i=m("<div/>",{id:t,class:r.type==="vertical"?"gc-toolbar-placeholder gc-toolbar-placeholder-vertical":"gc-toolbar-placeholder gc-toolbar-placeholder-horizontal"});i.appendTo(o);e.render(t);s[e.name]=t},d=function(e){var t=l.length>0?l[l.length-1]:null,i;if(t){i=n.tools[t];i.deactivate()}l.push(e.name);if(l.length>99){l.shift()}m(c).triggerHandler("toolChange",[i,e])},h=function(){var e=l.length>0?l[l.length-1]:null;if(e){n.tools[e].activate()}};if(!v.toolbarCssIncluded){giscloud.includeCss(v.apiHost()+"/assets/api/1/css/toolbar.css");v.toolbarCssIncluded=true}this.viewer=i;this.tools={};if(r.container){o=m("#"+r.container);o.addClass("gc-toolbar");if(r.type==="vertical"){o.addClass("gc-toolbar-vertical")}else{o.addClass("gc-toolbar-horizontal")}}this.add=function(){var e,t,i,n=true;for(e=0,t=arguments.length;e<t;e++){i=arguments[e];if(i&&i instanceof giscloud.ui.Toolbar.Tool){if(!i.toolbar||i.toolbar!==this){i.toolbar=this}else{n=false}this.tools[i.name]=i;i.bind("activation",d);i.bind("deactivation",h);if(r.container&&n){u(i)}}}return this};if(r.defaultTools){for(e=0,t=r.defaultTools.length;e<t;e++){this.add(giscloud.ui.defaultTools.tool(r.defaultTools[e]))}if(m.inArray("pan",r.defaultTools)>-1){this.tools.pan.activate()}}this.remove=function(e){var t=m.inArray(e,l);if(t>-1&&t===l.length-1){this.deactivateTool()}else if(t>-1){l.splice(t,1)}delete this.tools[e];if(s[e]){m("#"+s[e]).remove();delete s[e]}return this};this.bind=function(e,t){var i=this,n;if(e&&typeof e=="string"&&typeof t=="function"){n=function(){var e=Array.prototype.slice.call(arguments,1);t.apply(i,e)};m(c).on(e,n);if(!t.gcunbind){t.gcunbind={}}t.gcunbind[a+e]=n}return this};this.unbind=function(e,t){var i;if(e&&typeof e=="string"&&typeof t=="function"){i=t.gcunbind&&t.gcunbind[a+e];if(i){m(c).off(e,i)}}return this};this.toolChange=function(e){return this.bind("toolChange",e)}}};giscloud.ui.Toolbar.Tool=function(e,d){var a,s,h=false,f,p,g=v.oid(),o={};this.options=d;this.name=e;this.isToggle=function(){return f};this.isActive=function(){return h};this.toolbar=d.toolbar;this.viewer=d.viewer;a=d.actions.activation;s=d.actions.deactivation;f=d.toggle;this.activate=function(e){var t=this,i=this.toolbar&&this.toolbar.viewer||this.viewer,n=Array.prototype.slice.call(arguments,0),r="gctool_"+this.name+"_"+g;if(!h&&i){i.initializing.done(function(){if(d.instant){n.splice(0,0,this);a.apply(this,n)}else{h=true;m("#"+r).addClass(d.styles.active||"gc-tool-active");if(!e){m(o).triggerHandler("activation",[t])}if(a){n.splice(0,0,this);a.apply(t,n)}}})}return this};this.deactivate=function(e){var t=this,i=this.toolbar&&this.toolbar.viewer||this.viewer,n=Array.prototype.slice.call(arguments,0),r="gctool_"+this.name+"_"+g;if(h&&i){i.initializing.done(function(){h=false;m("#"+r).removeClass(d.styles.active||"gc-tool-active");if(s){n.splice(0,0,this);s.apply(t,n)}if(!e){m(o).triggerHandler("deactivation",[t])}})}return this};this.render=function(e){var t=this,i=d.styles||{},n="gctool_"+this.name+"_"+g,r,a,s,o,l,c,u;if(!v.toolbarCssIncluded){giscloud.includeCss(v.apiHost()+"/assets/api/1/css/toolbar.css");v.toolbarCssIncluded=true}p=m("#"+e);p.html("");if(i.icon){r="gctoolicon_"+this.name+"_"+g;l=m("<img/>",{id:r,src:i.icon,alt:i.caption||""});if(i.iconHover){a="gctoolicon_hover_"+this.name+"_"+g;c=m("<img/>",{id:a,src:i.iconHover,alt:i.caption||"",css:{display:"none"}})}if(i.iconActive){s="gctoolicon_active_"+this.name+"_"+g;u=m("<img/>",{id:s,src:i.iconActive,alt:i.caption||"",css:{display:"none"}})}}o=m("<div/>",{id:n,class:i.cssClass||"gc-tool",title:i.caption||"",mouseover:function(e){m(this).addClass(i.hover||"gc-tool-hover");if(c){c.show();u.hide();l.hide()}e.stopPropagation();e.preventDefault()},mouseout:function(e){m(this).removeClass(i.hover||"gc-tool-hover");if(c){c.hide();if(h){u.show();l.hide()}else{u.hide();l.show()}}e.stopPropagation();e.preventDefault()},click:function(e){if(d.instant){t.activate()}else{if(h&&f){t.deactivate()}else if(!h){t.activate()}e.stopPropagation();e.preventDefault()}}});if(r){o.append(l);if(s){o.append(u)}if(a){o.append(c)}}else if(i.caption&&i.showCaption){o.append(i.caption)}else{o.append("&nbsp;")}o.appendTo("#"+e);return this};this.bind=function(e,t){var i=this,n;if(e&&typeof e=="string"&&typeof t=="function"){n=function(){var e=Array.prototype.slice.call(arguments,1);t.apply(i,e)};m(o).on(e,n);if(!t.gcunbind){t.gcunbind={}}t.gcunbind[g+e]=n}return this};this.trigger=function(e,t){m(o).trigger(e,t)};this.unbind=function(e,t){var i;if(e&&typeof e=="string"&&typeof t=="function"){i=t.gcunbind&&t.gcunbind[g+e];if(i){m(o).off(e,i)}}return this}};giscloud.ui.defaultTools={pan:function(e){return new giscloud.ui.Toolbar.Tool("pan",m.extend({styles:{caption:"Pan",showCaption:false,cssClass:"gc-tool-pan",active:"gc-tool-pan-active",hover:"gc-tool-pan-hover"},actions:{activation:function(e){e.pan()}}},e||{}))},zoom:function(e){return new giscloud.ui.Toolbar.Tool("zoom",m.extend({styles:{caption:"Zoom",showCaption:false,cssClass:"gc-tool-zoom",active:"gc-tool-zoom-active",hover:"gc-tool-zoom-hover"},actions:{activation:function(e){e.areaZoom()}}},e||{}))},full:function(e){return new giscloud.ui.Toolbar.Tool("full",m.extend({styles:{caption:"Full",showCaption:false,cssClass:"gc-tool-full",active:"gc-tool-full-active",hover:"gc-tool-full-hover"},actions:{activation:function(e){e.fullExtent()}},instant:true},e||{}))},measure:function(e){return new giscloud.ui.Toolbar.Tool("measure",m.extend({styles:{caption:"Measure",showCaption:false,cssClass:"gc-tool-measure",active:"gc-tool-measure-active",hover:"gc-tool-measure-hover"},actions:{activation:function(e){e.measure()}}},e||{}))},select:function(e){return new giscloud.ui.Toolbar.Tool("select",m.extend({styles:{caption:"Select",showCaption:false,cssClass:"gc-tool-select",active:"gc-tool-select-active",hover:"gc-tool-select-hover"},actions:{activation:function(e){e.select(true)}}},e||{}))},info:function(t){function i(){var e=m(v).data("marker");if(e){this.viewer.removeMarker(e);m(v).data("marker",false)}}function e(e){m(this).data("lastLonLat",e)}function n(e){v.viewerShowFeatureInfo(this.viewer,e.layerId,e.featureId,m(this).data("lastLonLat"),t&&t.renderFunction)}function r(){if(!m(this).data("tracking")){this.getMouse=m.proxy(e,this);this.viewer.bind("mouseMove",this.getMouse);m(this).data("tracking",true)}}function a(){if(m(this).data("tracking")){m(this).data("tracking",false);this.viewer.unbind("mouseMove",this.getMouse);this.getMouse=null}}return new giscloud.ui.Toolbar.Tool("info",m.extend({styles:{caption:"Info",showCaption:false,cssClass:"gc-tool-info",active:"gc-tool-info-active",hover:"gc-tool-info-hover"},actions:{activation:function(e){m(this).data("prevState",e.select());if(!this.viewer){this.viewer=e||this.toolbar&&this.toolbar.viewer}if(!this.options.dontShow){this.onFeatureOver=m.proxy(r,this);this.onFeatureOut=m.proxy(a,this);this.onFeatureAdd=m.proxy(n,this);this.hideInfo=m.proxy(i,this);e.bind("featureOver",this.onFeatureOver);e.bind("featureOut",this.onFeatureOut);e.bind("mouseDown",this.hideInfo);e.selection.bind("featureAdd",this.onFeatureAdd)}e.select(true)},deactivation:function(e){e.select(m(this).data("prevState"));if(!this.options.dontShow){e.unbind("featureOver",this.onFeatureOver);e.unbind("featureOut",this.onFeatureOut);e.bind("mouseDown",this.hideInfo);e.selection.unbind("featureAdd",this.onFeatureAdd);this.onFeatureOver=null;this.onFeatureOut=null;this.hideInfo=null;this.onFeatureAdd=null}}}},t||{}))},areaSelect:function(e){var n=v.oid(),t=function(e){var t=new giscloud.Bounds(parseFloat(e.xMin),parseFloat(e.yMin),parseFloat(e.xMax),parseFloat(e.yMax)),i=v.refs[n];v.refs[n].selectFeaturesByBounds(i.activeLayer,t)};return new giscloud.ui.Toolbar.Tool("areaSelect",m.extend({styles:{caption:"Select area",showCaption:false,cssClass:"gc-tool-areaselect",active:"gc-tool-areaselect-active",hover:"gc-tool-areaselect-hover"},actions:{activation:function(e){e.loading.done(function(){var e=this.instance;v.refs[n]=this;e.addEventListener("areaselection",t);e.setTool("AreaSelection")})},deactivation:function(e){e.loading.done(function(){this.instance.removeEventListener("areaselection",t);this.instance.setTool("DragTool");delete v.refs[n]})}}},e||{}))},pickCoordinates:function(e){var t;function i(e){t.coordinates=e;t.deactivate()}t=new giscloud.ui.Toolbar.Tool("pickCoordinates",m.extend({styles:{caption:"Coordinate picker",showCaption:false,cssClass:"coordinate-tool",active:"coordinate-tool-active",hover:"coordinate-tool-hover"},actions:{activation:function(e){this.coordinates=null;e.loading.done(function(){m(e.container()).addClass("gc-cursor-crosshair");e.bind("mouseDown",i)})},deactivation:function(e){e.loading.done(function(){e.unbind("mouseDown",i);m(e.container()).removeClass("gc-cursor-crosshair")})}}},e||{}));return t},selectExtent:function(e){var i,n={};return new giscloud.ui.Toolbar.Tool("selectExtent",m.extend({extent:null,styles:{caption:v.__("Select extent"),showCaption:false,cssClass:"gc-tool-selectextent",active:"gc-tool-selectextent-active",hover:"gc-tool-selectextent-hover"},actions:{activation:function(e){var t=this;this.extent=null;e.loading.done(function(){i=e.instance.selectExtentTool();n.dragging=e.instance.dragging.enabled();i.init(t)})},deactivation:function(e){var t=this;e.loading.done(function(){t.extent=i.getExtent();i.finalize();n.dragging?e.instance.dragging.enable():e.instance.dragging.disable()})}}},e||{}))},tool:function(e,t){switch(e){case"pan":return this.pan(t);case"zoom":return this.zoom(t);case"full":return this.full(t);case"measure":return this.measure(t);case"select":return this.select(t);case"info":return this.info(t);case"areaSelect":return this.areaSelect(t);case"selectExtent":return this.selectExtent(t);case"freehandSelect":return giscloud.ui.defaultTools.freehand(t);case"azimuth":return giscloud.ui.defaultTools.azimuth(t);case"areaMeasure":return giscloud.ui.defaultTools.areaMeasure(t);case"distanceMeasure":return giscloud.ui.defaultTools.distanceMeasure(t);case"countByPolygon":return giscloud.ui.defaultTools.countByPolygon(t);default:return null}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(_,b,w,x){var C,T,f,p,g,M,S,l,L,D,m,v,h=[],j={selectable:true,locks:true,dnd:true,dropdownMenu:false,hiddenLayerIds:[]};(function(g,e){"use strict";var m,v,o=document.createElement("div");o.className="jstree-dropdown fa fa-ellipsis-v";function t(e,t){var i,n,r,a,s,o,l,c,u,d,h;function f(){m.addClass("gc-hidden")}function p(e){g(S).triggerHandler("menu_action",[g(e.currentTarget).attr("data-action"),n])}if(!m){m=g("<div/>").attr("id","gc_layer_list_dropdown").addClass("gc-layer-list-dropdown").addClass("gc-hidden").appendTo(g("body")).click(function(e){e.stopPropagation();m.toggleClass("gc-hidden")}).mouseenter(function(){g("#gc_layers_box").css("z-index",17007);g("#gc_layer_list_dropdown").css("z-index",17008)}).mouseleave(function(){g("#gc_layers_box").css("z-index",999);g("#gc_layer_list_dropdown").css("z-index",1e3)})}g(document).one("click",f);i=t.id&&t.id.split("_");n=i&&i.length&&i[2];r=D.layerById(n),a;if(t.id!=v){m.removeClass("gc-hidden")}else{m.toggleClass("gc-hidden")}v=t.id;m.empty();l=r?r.grp?"layer_group_"+n:"layer"+n:null;c=l?D.instance.getLayerByName(l):null;if(c&&t.data.type!=="folder"&&t.data.type!=="giscloud"){a=1-c.getAlpha()/100;o=g("<div/>",{class:"dragdealer",id:"demo-simple-slider"}).append(g("<div/>",{class:"gc-opacity-info",text:w.__("Transparency")}),g("<div/>",{class:"handle red-bar"})).prependTo(m).click(function(e){e.stopImmediatePropagation();e.preventDefault()});new Dragdealer("demo-simple-slider",{x:a,animationCallback:function(e){var t=Math.round(e*100),i=Math.round((1-e)*100);g("#demo-simple-slider .red-bar").text(t);c.setAlpha(i);g(S).triggerHandler("opacity",[n,i])}})}s=[{action:"zoomtolayer",text:w.__("Zoom_to_Layer")}];g(S).triggerHandler("menu_before",[s,t]);d=g("<ul/>",{class:"gc-list"});for(h=0;h<s.length;h++){if(s[h].text==="separator"){u=g("<li/>",{class:"gc-separator"})}else{u=g("<li/>",{class:"gc-list-item",text:s[h].text}).attr("data-action",s[h].action).click(p)}u.appendTo(d)}d.appendTo(m);m.position({my:"right top",at:"right top+"+e.height(),of:e,collision:"fit"});if(_.gcapp&&gcapp.config&&gcapp.config.newDatagrid){m.css("z-index",17008)}}g.jstree.defaults.dropdown=g.noop;g.jstree.plugins.dropdown=function(e,s){this.bind=function(){s.bind.call(this);this.element.on("dblclick.jstree",".jstree-dropdown",g.proxy(function(e){e.stopImmediatePropagation();e.preventDefault();this.settings.dropdown.call(this,this.get_node(e.target))},this)).on("click.jstree",".jstree-dropdown",g.proxy(function(e){e.stopImmediatePropagation();e.preventDefault();t(g(e.currentTarget),this.get_node(e.target))},this))};this.redraw_node=function(e,t,i){e=s.redraw_node.call(this,e,t,i);if(e){var n=o.cloneNode(true),r=this.get_node(e.id),a;if(!r||!r.data||r.data.type=="style"||r.data.type=="button"){return e}a=g(e).children(".jstree-wholerow");g(a).append(n)}return e}}})(b);(function(e,t){e.jstree.plugins.nohover=function(){this.hover_node=jQuery.noop}})(b);(function(e,t){e.jstree.plugins.noselect=function(){this.select_node=jQuery.noop}})(b);(function(f,e){"use strict";var p=document.createElement("i");p.className="gc-ll-icon gc-vicon gc-eye";f.jstree.defaults.visibility=f.noop;f.jstree.plugins.visibility=function(e,h){this.bind=function(){h.bind.call(this);this.element.on("dblclick.jstree",".gc-eye",f.proxy(function(e){e.stopImmediatePropagation();e.preventDefault();this.settings.visibility.call(this,this.get_node(e.target))},this)).on("click.jstree",".gc-eye",f.proxy(function(e){var s=f(e.target),t=s.closest("li"),i=t.attr("id").split("_"),n,r,a,o;e.stopImmediatePropagation();e.preventDefault();s.toggleClass("gc-eye-visible");if(t.hasClass("gc-layer-child-node")){r=t.attr("exprindex");if(!r){return}if(typeof r==="string"){r=parseInt(r)}n=D.layerById(t.attr("layerid"));if(s.hasClass("gc-eye-visible")){n.expressionVisible(r,true);f(S).triggerHandler("expressionVisibilityChange",[n.id,r,true])}else{n.expressionVisible(r,false);f(S).triggerHandler("expressionVisibilityChange",[n.id,r,false])}}else{o=s.siblings(".jstree-children").children();n=D.layerById(i[2]);o.each(function(e,t,i){var n=e&&e.expressions();var r=f(i).attr("exprindex");var a=f(i).children(".gc-vicon");if(s.hasClass("gc-eye-visible")){if(n&&n.length>0&&n[r]&&!n[r].instance.visible){return a.removeClass("gc-eye-visible")}a.addClass("gc-eye-visible")}else{a.removeClass("gc-eye-visible")}}.bind(this,n));a=T.recursive(i[2]);f.each(a,function(e,i){var t=i.data.id&&D.layerById(i.data.id);var n=t&&t.expressions();var r;if(s.hasClass("gc-eye-visible")){if(n&&n.length>0){n.forEach(function(e,t){r=f("#"+i.children[t]).children(".gc-vicon");if(!e.instance.visible){r.removeClass("gc-eye-visible")}else{r.addClass("gc-eye-visible")}})}T.show(i.data.id)}else{if(n&&n.length>0){n.forEach(function(e,t){r=f("#"+i.children[t]).children(".gc-vicon");r.removeClass("gc-eye-visible")})}T.hide(i.data.id)}f(S).triggerHandler("visibility",[i.data.id,s.hasClass("gc-eye-visible")])})}},this))};this.allChildrenVisible=function(){};this.redraw_node=function(e,t,i){var r,n,a,s,o,l,c,u,d;try{e=h.redraw_node.call(this,e,t,i)}catch(e){console.error("We are unable to call redraw_node method");return}if(e){n=this.get_node(e.id);if(n.data.type==="style"||n.data.type==="button"){return e}r=p.cloneNode(true),this.allChildrenVisible(n.data.id);e.insertBefore(r,e.childNodes[2]);a=e.id;s=a&&a.split("_");o=s&&s.length&&s[2];l=D.layerById(o);u=T.getLayerById(o);d=u&&(u.type==="folder"?u:null);if(d){if(d.visible==="t"){r.className+=" gc-eye-visible"}else{e.className+=" gc-layer-hidden"}e.insertBefore(r,e.childNodes[2]);return e}if(!l){return e}if(n.children.length>0){c=f(e.children).filter("ul.jstree-children");f.each(n.children,function(e,t){var i=f(r.cloneNode(true));var n=l.instance.features.length-1-e;if(n<0||!l.instance.features[n]){console.warn("Layers data from map.xml doesn't match data from REST!",l,t);return}if(l.instance.features[n].visible){i.addClass("gc-eye-visible")}else{i.addClass("gc-layer-hidden")}c.find("#"+t+" .jstree-icon.jstree-ocl").after(i)});if(l.visible()){r.className+=" gc-eye-visible"}else{e.className+=" gc-layer-hidden"}}if(l){if(l.visible()){r.className+=" gc-eye-visible"}else{e.className+=" gc-layer-hidden"}}}return e}}})(b);(function(u,e){"use strict";var d=document.createElement("i");d.className="jstree-icon jstree-locks";u.jstree.defaults.locks=u.noop;u.jstree.plugins.locks=function(e,c){this.bind=function(){c.bind.call(this);this.element.on("dblclick.jstree",".jstree-locks",u.proxy(function(e){e.stopImmediatePropagation();e.preventDefault();this.settings.locks.call(this,this.get_node(e.target))},this)).on("click.jstree",".jstree-locks",u.proxy(function(e){var t,i,n;e.stopImmediatePropagation();e.preventDefault();if(!D){return}t=u(e.target);i=t.closest("li");n=i.attr("id").split("_");T.selectability(n[2],!t.hasClass("jstree-lock-icon"))},this))};this.redraw_node=function(e,t,i){var n,r,a,s,o,l;e=c.redraw_node.call(this,e,t,i);if(e){r=this.get_node(e.id);if(r.data.type==="folder"||r.data.type==="style"){return e}a=e.id;s=a&&a.split("_");o=s&&s.length&&s[2];l=D.layerById(o);if(!l){return e}n=d.cloneNode(true);if(l.selectable&&u.inArray(r.data.type,["point","line","polygon","wms"])!==-1){n.className+=l.selectable()?" jstree-no-lock-icon":" jstree-lock-icon";e.insertBefore(n,e.childNodes[3])}}return e}}})(b);(function(a,e){"use strict";var u=document.createElement("i");u.className="jstree-icon jstree-settings ";a.jstree.defaults.settings=a.noop;a.jstree.plugins.settings=function(e,c){this.bind=function(){c.bind.call(this);this.element.on("dblclick.jstree",".jstree-settings",a.proxy(function(e){e.stopImmediatePropagation();e.preventDefault();this.settings.settings.call(this,this.get_node(e.target))},this)).on("click.jstree",".jstree-settings",a.proxy(function(e){var t,i,n,r;e.stopImmediatePropagation();e.preventDefault();if(!D){return}t=a(e.target);i=t.closest("li");n=i.attr("id").split("_");r=T.getLayerById(n[2]);a(S).triggerHandler("setting",[n[2],t.hasClass("jstree-lock-icon")])},this))};this.redraw_node=function(e,t,i){var n,r,a,s,o,l;e=c.redraw_node.call(this,e,t,i);if(e){r=this.get_node(e.id);if(r.data.type==="style"){return e}a=e.id;s=a&&a.split("_");o=s&&s.length&&s[2];l=D.layerById(o);n=u.cloneNode(true);if(r.data.type==="folder"){e.insertBefore(n,e.childNodes[3])}else{e.insertBefore(n,e.childNodes[4])}}return e}}})(b);giscloud.ui.LayerList=function(e,t,n,r){var s=w.oid(),a=!!(_.mdc&&_.cordova),o,l,c,u,d,h,f,p,g,m,v,y=false;if(!e){throw"No viewer to attach to."}T=this;this.initialized=false;this.layersLoading=new b.Deferred;L=t;D=e;b.extend(j,r);S={};c={};if(a&&!n||_.user&&_.user.id>-1){v=giscloud.userOptions.byName("MAP_"+D.mapId+"_LAYERS_STATES").then(function(e){var t;try{t=e&&e.value&&JSON.parse(e.value);if(!t){return{}}return t}catch(e){return{}}},function(){return b.Deferred().resolve({})})}else{v=b.Deferred().resolve({})}initTree=function(){var a=!_.mdc||!_.cordova;if(n){D.addLayersExpandParam("form","datasource","analysis","options");o=D.layersLoading}else{o=b.when(giscloud.layers.byMapId(D.mapId,{expand:"form,datasource,analysis,options"}),v)}a&&b("#"+L).loader("show");o.done(function(e,n){n=n||{};a&&b("#"+L).loader("hide");l=b.isArray(e[0])&&(e[0].length===0||e[0][0]instanceof giscloud.Layer)?e[0]:e;c={};function r(e){b.each(e,function(e,t){var i=t.id.toString();c[i]=t;if(n[i]){if(n[i].v!=null){t.visible=n[i].v?"t":"f"}if(t.opened!=null&&n[i].o!=null){t.opened=n[i].o?"t":"f"}}if(t.sublayers&&t.sublayers.length>0)r(t.sublayers)})}r(l);I(l);if(b.jstree.reference("#"+L)!=null){b("#"+L).jstree("destroy").empty();b("#"+L).trigger("jstree.after_destroy")}u=C(l,s,D);u.on({"before.jstree":function(){},"check_node.jstree":function(e,t){h(t.rslt.obj[0].id)},"uncheck_node.jstree":function(e,t){f(t.rslt.obj[0].id)},"check_all.jstree":function(){p()},"uncheck_all.jstree":function(){g()},"ready.jstree":function(){b(S).triggerHandler("ready");if(!j.dnd){b("#"+L).find(".jstree-container-ul li").on("mousedown",function(){return false})}if(!j.selectable){b("#"+L).find("a.jstree-anchor").css("cursor","default")}},"after_open.jstree":function(){b(S).triggerHandler("afterOpen")},"mousedown.jstree":function(){y=true},"mouseup.jstree":function(){y=false},"open_node.jstree":function(e,t){var i=t.node.id.split("_");b(S).triggerHandler("open",[i[2],t.node.state.opened])},"close_node.jstree":function(e,t){var i=t.node.id.split("_");b(S).triggerHandler("close",[i[2],t.node.state.opened])},"after_close.jstree":function(e,t){var i=t.node.id.split("_");b(S).triggerHandler("afterClose")},"rename_node.jstree":function(e,t){b(S).triggerHandler("rename",[t.node.data.id,t.old,t.text])},"select_node.jstree":function(e,t){var i=t.node.id.split("_");if(i.length>3)b(S).triggerHandler("select",["select",i[3],i[4],c[i[2]]]);else b(S).triggerHandler("select",["select",i[1],i[2],c[i[2]]])},"deselect_node.jstree":function(e,t){var i=t.node.id.split("_");if(i.length>3)b(S).triggerHandler("unselect",["unselect",i[3],i[4],c[i[2]]]);else b(S).triggerHandler("unselect",["unselect",i[1],i[2],c[i[2]]])},"dblclick.jstree":function(e,t){var i,n,r=b(e.target).hasClass("jstree-icon")?"style":"general",a=b(e.target).closest("li");if(a.length<1)return;i=a.attr("id");if(typeof i!=="string")return;n=i.split("_");node=b("#"+L).jstree().get_node("#"+i);if(node&&node.data.type==="style")b(S).triggerHandler("dblclick",["dblclick",n[3],n[4],c[n[2]],r]);else b(S).triggerHandler("dblclick",["dblclick",n[1],n[2],c[n[2]],r])},"changed.jstree":function(e,t){var i=b.map(t&&t.selected||[],function(e){var t=e.split("_");if(t.length>3)return{type:t[3],id:t[4],layer:c[t[2]]};else return{type:t[1],id:t[2],layer:c[t[2]]}});b(S).triggerHandler("changed",["changed",i])}});b("#"+L).on("move_node.jstree",function(e,t){var i=t.node.id.split("_"),n=i[2],r=t.parent.split("_"),a=t.old_parent.split("_"),s=r==a;r=r&&r.length==3?r[2]*1:null;a=a&&a.length==3?a[2]*1:null;var o=T.recursive(),l=[];b.each(o,function(e,t){l.push({id:t.data.id})});b(S).triggerHandler("orderchange",[l,n,r,a])});b(S).triggerHandler("reload");T.initialized=true;if(_.gcapp&&gcapp.config&&gcapp.config.newDatagrid){var t=b("#gc_layers_box");var i=b("#layer_list_parent ul");t.add(i).mouseenter(function(){t.css("z-index",17007);b("#gc_layer_list_dropdown").css("z-index",17008)});t.mouseleave(function(){t.css("z-index",999);b("#gc_layer_list_dropdown").css("z-index",1e3)})}});o.then(T.layersLoading.resolve,T.layersLoading.reject)};D.loading.done(initTree);this.bind=function(e,t){var i=this,n=function(){var e=Array.prototype.slice.call(arguments,1);t.apply(i,e)};b(S).on(e,n);if(!t.gcunbind){t.gcunbind={}}t.gcunbind[s+e]=n;return this};this.unbind=function(e,t){var i;i=t.gcunbind&&t.gcunbind[s+e];b(S).off(e,i);return this};this.selectAll=function(){if(!c)return;var i=[];b.each(c,function(e,t){i.push(t)});this.select(i)};this.isDragging=function(){return y};this.select=function(e,n){if(e){if(!c)return;if(!b.isArray(e)){e=[e]}b.each(e,function(e,t){var i;if(!(t instanceof giscloud.Layer)){t=c[t]}if(!t)return;i=s+(t.type==="folder"?"_folder_":"_layer_")+t.id;if(!n&&u&&u.jstree)u.jstree("select_node",i,false,true)})}return this};this.unselect=function(e){if(e){if(!b.isArray(e)){e=[e]}b.each(e,function(e,t){var i;if(!(t instanceof giscloud.Layer)){t=c[t]}i=s+(t.type==="folder"?"_folder_":"_layer_")+t.id;u.jstree("deselect_node","#"+i)})}else{if(u&&u.jstree)u.jstree("deselect_all")}return this};this.selected=function(){if(!u)return;return b.map(b("#"+L).jstree("get_selected"),function(e){var t;if(typeof e!=="string")return;t=e.split("_");return c[t[2]]})};this.toggle=function(e,n){if(!c)return;if(e){if(!b.isArray(e)){e=[e]}b.each(e,function(e,t){var i;if(!(t instanceof giscloud.Layer)){t=c[t]}i=s+(t.type==="folder"?"_folder_":"_layer_")+t.id;if(n)u.jstree("open_node","#"+i);else u.jstree("close_node","#"+i)})}return this};this.expandAll=function(){u.jstree("open_all")};this.collapseAll=function(){u.jstree("close_all")};this.rename=function(e){var t=this.getNodeById(e);if(!t)return;b("#"+L).jstree("edit",t.id)};this.lock=function(e){this.selectability(e,true)};this.unlock=function(e){this.selectability(e,false)};this.selectability=function(e,t){var i=T.getLayerById(e),n=D.layerById(e);if(i&&n){i.lock=t?"t":"f";var r=getNodeByLayerId("#",e),a=b("#"+r.id+" .jstree-locks");if(t){n.selectable(false);a.addClass("jstree-lock-icon");a.removeClass("jstree-no-lock-icon")}else{n.selectable(true);a.addClass("jstree-no-lock-icon");a.removeClass("jstree-lock-icon")}b(S).triggerHandler("lock",[e,t])}};this.show=function(e){this.visibility(e,true)};this.hide=function(e){this.visibility(e,false)};this.visibility=function(e,t){var n=T.getLayerById(e),r=D.layerById(e);if(n){n.visible=t?"t":"f";var a=getNodeByLayerId("#",e);var s=b("#"+a.id).children(".gc-vicon");if(t){b("#"+a.id).removeClass("gc-layer-hidden");s.addClass("gc-eye-visible")}else{b("#"+a.id).addClass("gc-layer-hidden");s.removeClass("gc-eye-visible")}if(t){if(n.type!="folder"){D.showLayer(e)}}else{if(n.type!="folder"){D.hideLayer(e)}else{cl=d(e);if(cl){for(i=0,k=cl.length;i<k;i++){D.hideLayer(cl[i])}}}}}};this.check=function(e){if(e){if(!b.isArray(e)){e=[e]}b.each(e,function(e,t){var i;if(!(t instanceof giscloud.Layer)){t=c[t]}i=s+(t.type==="folder"?"_folder_":"_layer_")+t.id;var n=u.get_node("#"+i)})}return this};this.uncheck=function(e){if(e){if(!b.isArray(e)){e=[e]}b.each(e,function(e,t){var i;if(!(t instanceof giscloud.Layer)){t=c[t]}i=s+(t.type==="folder"?"_folder_":"_layer_")+t.id;b("#"+L).jstree("uncheck_node","#"+i)})}return this};this.checkAll=function(){u.jstree("check_all");return this};this.uncheckAll=function(){u.jstree("uncheck_all");return this};this.destroy=function(){b("#"+L).jstree("destroy").empty();b("#customDemList").empty();b("#"+L).trigger("jstree.after_destroy");S={};c={}};this.layers=function(){return l};this.width=function(e){if(e===x){return b("#"+L).width()}b("#"+L).width(e);return this};this.height=function(e){if(e===x){return b("#"+L).height()}b("#"+L).height(e);return this};this.layersOrder=function(){var e=[];return e};this.loader=_.mdc&&_.cordova?b.noop:function(e){var t=b("#"+L);if(e==="hide"){t.loader("hide");t.children().show()}else if(e==="show"){t.children().hide();t.loader("show")}};recursive=function(e,t,i){var n=[],r;if(!e)e=b("#"+L).jstree().get_node(t);if(!e){return n}else if(e.data&&e.data.type!="style"||e.id=="#"){r=i&&i.excludeEmbededLayers&&e.data.type&&e.data.type=="giscloud";if(e.id!="#")n=[e];if(e.children&&!r){for(var a=0;a<e.children.length;a++){n=b.merge(n,recursive(null,e.children[a],i))}}}return n};this.recursive=function(e,t){var i=e?getNodeByLayerId("#",e):this.getNode("#");return recursive(i,null,t)};this.getNode=function(e){return b("#"+L).jstree().get_node(e)};getNodeByLayerId=function(e,t){var i=b("#"+L).jstree().get_node(e);if(!i){return null}else if(i.data&&i.data.id==t){return i}else if(i.children){var n;for(var r=0;r<i.children.length;r++){var a=getNodeByLayerId(i.children[r],t);if(a)return a}}};this.getNodeById=function(e){return getNodeByLayerId("#",e)};this.getLayerById=function(e){return c[e]};h=function(e){var t,i,n,r=e.split("_");if(r[1]==="layer"){D.showLayer(r[2])}else{n=d(e);if(n){for(t=0,i=n.length;t<i;t++){D.showLayer(n[t])}}}};f=function(e){var t,i,n,r=e.split("_");if(r[1]==="layer"){D.hideLayer(r[2])}else{n=d(e);if(n){for(t=0,i=n.length;t<i;t++){D.hideLayer(n[t])}}}};p=function(){b.each(D.layers,function(e,t){t.visible(true)})};g=function(){b.each(D.layers,function(e,t){t.visible(false)})};d=function(e){var i=[];b("#"+e).find("li[rel!='style']").each(function(e,t){if(this.id.indexOf("folder")===-1){i.push(this.id.split("_")[2])}});return M(i)};m=function(e,t){var i=D.layerById(e);if(i){i.selectable(t)}}};C=function(e,t,i){var n=["themes","ui","types","wholerow","visibility"];if(j.locks===true)n.push("locks");l=b.browser.msie&&b.inArray(jQuery.browser.version,["8.0","9.0"])>-1;if(j.dropdownMenu&&!l)n.push("dropdown");if(j.dnd===true)n.push("dnd");if(!j.selectable){n.push("nohover");n.push("noselect")}var r,a=f(e,t),s=_.mdc&&_.cordova?"libs/giscloud/giscloud.ui.css":w.apiHost()+"/1/giscloud.ui.css?modules=layerlist",o={plugins:n,dnd:{copy:false},types:{max_depth:-2,max_children:-2,valid_children:["layer","folder"],layer:{valid_children:["style"]},folder:{valid_children:["layer","folder"]},style:{valid_children:[],start_drag:false,move_node:false,hover_node:false,dehover_node:false,select_node:false}},ui:{selected_parent_close:false},core:{check_callback:function(e,t,i,n,r){if(e=="move_node"){if(t.data&&t.data.type=="style"){return false}if(t.original&&t.original.belongsToGcMap){return false}if(i.original&&i.original.belongsToGcMap){return false}if(!i.parent)return true;return i.data&&i.data.type=="folder"?true:false}},themes:{url:giscloud.app?null:s,theme:"giscloud",dots:false,responsive:j.responsive||false},multiple:false,animation:0,data:a}};r=b("#"+L).jstree(o);b.each(h,function(e){b("#"+h[e]+" > a > i").addClass("nocolorLayerList")});return r};m=function(e){if(e.showlabel){return giscloud.xssSafe(e.label)}else if(e.value_min!==x&&e.value_max!==x){return e.value_min+" - "+e.value_max}else{return giscloud.xssSafe(e.expression)||""}};f=function(e,c,t){var i,n,r,a,s,u,o,l=[],d={},h=[];if(!e){return{}}for(i=0,n=e.length;i<n;i++){r=e[i];a=null;if(b.inArray(r.id*1,j.hiddenLayerIds)>-1)continue;if(r.type==="folder"){s="folder"+r.id;if(d[s]){d[s].obj=r;d[s].shouldExpand=!!r.opened&&r.opened==="t";a=d[s]}else{a={id:s,obj:r,nodes:[],shouldExpand:!!r.opened&&r.opened==="t"};d[s]=a}}else{s="layer"+r.id;a={id:s,obj:r,shouldExpand:!!r.opened&&r.opened==="t"}}if(r.parent===null){l.push(a)}else{o="folder"+r.parent;if(!d[o]){d[o]={id:r.parent,obj:null,nodes:[]}}d[o].nodes.push(a)}}u=function(e,o){var t;function l(e){return!!e&&(e.hatchUrl||e.galleryUrl||e.hatchGalleryUrl||e.url&&!/^\/icons\//i.test(e.url))}t=e.sort(g);return b.map(t,function(i){var e,t;if(i.nodes){return{id:c+"_folder_"+i.obj.id,text:giscloud.xssSafe(i.obj.name),data:{type:"folder",title:giscloud.xssSafe(i.obj.name),id:i.obj.id*1},belongsToGcMap:o,children:u(i.nodes,o),state:{opened:i.shouldExpand},li_attr:{title:"ID: "+i.obj.id+"\n"+w.__("Name")+": "+giscloud.xssSafe(i.obj.name)+"\nType: 'Folder'",rel:"folder",id:c+"_folder_"+i.obj.id,class:"jstree-undetermined"+(i.shouldExpand?" jstree-open":"")}}}else if(i.obj.type=="giscloud"){e=e&&e[0];return{id:c+"_gcmap_"+i.obj.id,text:giscloud.xssSafe(i.obj.name),icon:p("giscloud"),children:f(i.obj.sublayers,c,true),data:{type:i.obj.type,title:giscloud.xssSafe(i.obj.name),id:i.obj.id*1},state:{opened:i.shouldExpand},li_attr:{title:"ID: "+i.obj.id+"\n"+w.__("Name")+": "+giscloud.xssSafe(i.obj.name)+"\n"+w.__("Type")+": '"+i.obj.source.type+"'\n"+w.__("Source")+": '"+i.obj.source.src+(i.obj.datasourceId?"'\n"+w.__("Datasource_ID")+": "+i.obj.datasourceId:""),rel:"layer",id:c+"_layer_"+i.obj.id,class:i.obj.visible==="t"?"jstree-checked":""}}}else{e=i.obj.styles;var n=i.obj.source.type&&i.obj.source.type==="raster"?i.obj.source.type:i.obj.source.dbtype||i.obj.source.type;if(e&&e.length>1){var r=false;if(e[0].relief_color!==x&&e[0].value_stop!==x){r=true}return{id:c+"_layer_"+i.obj.id,text:giscloud.xssSafe(i.obj.name),icon:p(null,"multi"),data:{type:i.obj.type,title:giscloud.xssSafe(i.obj.name),id:i.obj.id*1},state:{opened:i.shouldExpand},li_attr:{title:"ID: "+i.obj.id+"\n"+w.__("Name")+": "+giscloud.xssSafe(i.obj.name)+"\n"+w.__("Type")+": '"+n+"'\n"+w.__("Source")+": '"+i.obj.source.src+(i.obj.datasourceId?"'\n"+w.__("Datasource_ID")+": "+i.obj.datasourceId:""),rel:"layer",id:c+"_layer_"+i.obj.id,class:(i.obj.visible==="t"?"jstree-checked":"")+(i.shouldExpand?" jstree-open":"")},belongsToGcMap:o,children:function(){if(r){return[{id:c+"_layer_"+i.obj.id+"_expression_"+i.obj.id,text:"",icon:v(e,i.obj.id),data:{type:"style",title:""},li_attr:{rel:"style",layerid:i.obj.id,exprindex:i.obj.id,id:c+"_layer_"+i.obj.id+"_expression_"+i.obj.id,class:"jstree-style-node gc-layer-child-node jstree-cover gradient"},belongsToGcMap:o}]}return b.map(e,function(e,t){return{id:c+"_layer_"+i.obj.id+"_expression_"+t,text:m(e),icon:p("geometry",e.offlineUrl&&e||e.symbol||(e.galleryUrl||e.url)&&e||e.hatchGalleryUrl&&e||{type:i.obj.type,color:e.color,border:e.bordercolor,relief_color:e.relief_color}),data:{type:"style",title:m(e)},li_attr:{rel:"style",layerid:i.obj.id,exprindex:t,id:c+"_layer_"+i.obj.id+"_expression_"+t,class:"jstree-style-node gc-layer-child-node"+(l(e)?" jstree-cover":"")},belongsToGcMap:o}})}()}}else{e=e&&e[0];var a="",s=false;if(i.obj&&i.obj.source)a="ID: "+i.obj.id+"\n"+w.__("Name")+": "+giscloud.xssSafe(i.obj.name)+"\n"+w.__("Type")+": '"+n+"'\n"+w.__("Source")+": '"+i.obj.source.src+(i.obj.datasourceId?"'\n"+w.__("Datasource_ID")+": "+i.obj.datasourceId:"");if(i.obj&&i.obj.type&&i.obj.type==="dem")s=true;return{id:c+"_layer_"+i.obj.id,text:giscloud.xssSafe(i.obj.name),icon:p(i.obj.type,e&&(e.offlineUrl&&e||e.symbol||(e.galleryUrl||e.url||e.hatchUrl||e.hatchGalleryUrl)&&e||{type:i.obj.type,color:e.color,border:e.bordercolor}),i.obj&&i.obj.source&&i.obj.source.type,c+"_layer_"+i.obj.id),data:{type:i.obj.type,title:giscloud.xssSafe(i.obj.name),id:i.obj.id*1},li_attr:{title:a,rel:"layer",id:c+"_layer_"+i.obj.id,class:(i.obj.visible==="t"?"jstree-checked":"")+(l(e)?" jstree-cover":"")+(s?" hidden":"")},belongsToGcMap:o}}}})};h=u(l,t);return h};g=function(e,t){var i,n;if(typeof e.obj.order==="string"){i=parseInt(e.obj.order,10);n=parseInt(t.obj.order,10)}else{i=e.obj.order;n=t.obj.order}return n-i};M=function(e){var t,i,n,r=[];for(t=0,i=e.length;t<i;t++){n=e[t];if(Object.prototype.toString.call(n)==="[object Array]"){r=r.concat(M(n))}else{r.push(n)}}return r};v=function(i,e){var t,n,r="";b.each(i,function(e,t){r=r+t.relief_color+" "+t.value_stop*100+"%";if(e!==i.length-1){r=r+", "}});for(t=0,n=document.styleSheets.length;t<n;t++){console.log(document.styleSheets[t]);if(document.styleSheets[t].href===null){document.styleSheets[t].addRule(".jstree-themeicon-custom.raster_gradient_"+e,"background-image: linear-gradient("+r+")");break}}return"raster_gradient_"+e};p=function(e,t,i,n){var r,a,s,o,l=j.responsive?18:10,c=_.location.protocol=="https:"?"https:":"http:",u=giscloud.offlineMode()&&giscloudOffline.documentDirectory;if(t==="multi"){r="/assets/images/layertree/color_swatch.gif"}else{switch(e){case"folder":r="/assets/images/layertree/folder.gif";break;case"analysis":r="/assets/images/layertree/color_swatch.gif";break;case"raster":r="/assets/images/image.gif";break;case"giscloud":case"wms":case"wfs":case"wmts":case"tile":r="/assets/images/world.gif";break;case"point":case"line":case"polygon":case"geometry":if(t&&u&&t.offlineUrl){r="/assets/"+t.offlineUrl}else if(i=="wfs"){r="/assets/images/world.gif"}else if(t&&t.galleryUrl){r=t.galleryUrl.replace(/^.*\/rest\//i,"/")}else if(t&&t.url){r="/assets/icon.php?p="+encodeURI(t.url).replace("(","%28").replace(")","%29")}else if(t&&t.hatchUrl){return"/assets/icon.php?p="+encodeURI(t.hatchUrl).replace("(","%28").replace(")","%29")}else if(t&&t.hatchGalleryUrl){r=t.hatchGalleryUrl.replace(/^.*\/rest/i,"")}else if(t){s=parseInt(t.size,10)||0;o=parseInt(t.bw,10)||0;a=(s+2*o)/l;if(a){o=Math.round(o/a)}s=l-2*o;if(t.color===x&&t.type==="line"){t.color="";if(t.border===x){h.push(n)}}else if(t.color===x){t.color="255,255,255";if(t.border===x){h.push(n)}}if(t.border===x){t.border="0,0,0"}if(t.relief_color){var d=giscloud.Color.hexToRgb(t.relief_color);t.color=d?d.join(","):t.relief_color;t.border=d?d.join(","):t.relief_color;t.type="box"}if(t.color===""){r="/assets/icon.php?type="+t.type+"&border="+t.border+"&bw="+o+"&size="+s}else{r="/assets/icon.php?type="+t.type+"&color="+t.color+"&border="+t.border+"&bw="+o+"&size="+s}}break;default:return null}}if(u){return"file://"+giscloudOffline.documentDirectory.slice(0,-1)+r}if(r&&r.indexOf("assets/icon.php")===-1){if(r.indexOf("/1/icons/")===0){r="/rest"+r}return giscloud_config.assetsSite()+r.substr(1)}return w.apiHost().replace("http:",c)+r};function r(e){var t,i,n;if(e.env){return e}if(e.item){return null}if(e.all){i="all"}else if(e.any){i="any"}else if(e.one){i="one"}else if(e.none){i="none"}else{console.log("unknown deps operator",e);return null}n=b.map(e[i],r);if(n.length===0){return null}t={};t[i]=n;return t}function a(e){if(!e||!e.form||!e.form.definition||!e.form.definition.items){return}return b.map(e.form.definition.items,function(e){var t;if(!b.isPlainObject(e.active)){return}t=r(e.active);if(t){return{uuid:e.uuid,name:e.name,active:t}}})}function I(r){b.each(r||[],function(e,t){var i,n;if(!t.form){return}i=a(t);if(!i||i.length===0){r[e].hideFields=[];return}n=new giscloud.DependencyResolver({formItems:i});r[e].hideFields=b.map(i,function(e){var t=n.resolveDependency(e,e.active);if(t&&t.check&&!t.check()||t===false){return e.name}})})}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e){var p=[0,3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745],t=[[0,7,1],[1,12,2],[2,17,3],[3,22,4],[4,7,5],[5,12,6],[6,17,7],[7,22,8],[8,7,9],[9,12,10],[10,17,11],[11,22,12],[12,7,13],[13,12,14],[14,17,15],[15,22,16]],i=[[1,5,17],[6,9,18],[11,14,19],[0,20,20],[5,5,21],[10,9,22],[15,14,23],[4,20,24],[9,5,25],[14,9,26],[3,14,27],[8,20,28],[13,5,29],[2,9,30],[7,14,31],[12,20,32]],n=[[5,4,33],[8,11,34],[11,16,35],[14,23,36],[1,4,37],[4,11,38],[7,16,39],[10,23,40],[13,4,41],[0,11,42],[3,16,43],[6,23,44],[9,4,45],[12,11,46],[15,16,47],[2,23,48]],r=[[0,6,49],[7,10,50],[14,15,51],[5,21,52],[12,6,53],[3,10,54],[10,15,55],[1,21,56],[8,6,57],[15,10,58],[6,15,59],[13,21,60],[4,6,61],[11,10,62],[2,15,63],[9,21,64]];function a(e,t,i){return e&t|~e&i}function s(e,t,i){return e&i|t&~i}function o(e,t,i){return e^t^i}function l(e,t,i){return t^(e|~i)}var g=[[a,t],[s,i],[o,n],[l,r]];function m(e){return String.fromCharCode(e&255)+String.fromCharCode(e>>>8&255)+String.fromCharCode(e>>>16&255)+String.fromCharCode(e>>>24&255)}function c(e){return e.charCodeAt(0)|e.charCodeAt(1)<<8|e.charCodeAt(2)<<16|e.charCodeAt(3)<<24}function v(e){while(e<0)e+=4294967296;while(e>4294967295)e-=4294967296;return e}function y(e,t,i,n,r){var a,s,o,l,c,u,d,h,f;a=n[0];s=n[1];o=n[2];l=n[3];c=r[0];u=r[1];d=r[2];f=i(t[s],t[o],t[l]);h=t[a]+f+e[c]+p[d];h=v(h);h=h<<u|h>>>32-u;h+=t[s];t[a]=v(h)}function u(e){var t,i,n,r,a,s,o,l,c,u,d,h,f;n=[1732584193,4023233417,2562383102,271733878];a=e.length;s=a&63;o=s<56?56-s:120-s;if(o>0){e+="";for(u=0;u<o-1;u++){e+="\0"}}e+=m(a*8);e+=m(0);a+=o+8;t=[0,1,2,3];i=[16];r=[4];for(h=0;h<a;h+=64){for(u=0,d=h;u<16;u++,d+=4){i[u]=e.charCodeAt(d)|e.charCodeAt(d+1)<<8|e.charCodeAt(d+2)<<16|e.charCodeAt(d+3)<<24}for(u=0;u<4;u++)r[u]=n[u];for(u=0;u<4;u++){l=g[u][0];c=g[u][1];for(d=0;d<16;d++){y(i,r,l,t,c[d]);f=t[0];t[0]=t[3];t[3]=t[2];t[2]=t[1];t[1]=f}}for(u=0;u<4;u++){n[u]+=r[u];n[u]=v(n[u])}}return m(n[0])+m(n[1])+m(n[2])+m(n[3])}function d(e){var t,i,n;var r;r=u(e);i="";for(t=0;t<16;t++){n=r.charCodeAt(t);i+="0123456789abcdef".charAt(n>>4&15);i+="0123456789abcdef".charAt(n&15)}return i}function h(e){e=e?e:"";return d(e.toString())}giscloud.md5=h;if(e){e.md5=h}else{window.md5=h}})(typeof giscloud!=="undefined"?giscloud.common():null);(function(e){function t(e){var t=Math.random()*16|0,i=e=="x"?t:t&3|8;return i.toString(16)}function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t)}giscloud.uuid=i;if(e){e.uuid=i}else{window.uuid=i}})(typeof giscloud!=="undefined"?giscloud.common():null);(function(e,a,s,t){giscloud.proxy={call:function(e,t,i){var n="proxy",r=new a.Deferred;t=t||{};if(typeof t==="function"){i=t;t={}}else{i=i||t.callback}t.url=e;s.rest.get(n,t).done(function(e){try{if(typeof i=="function"){i(e)}r.resolve(users)}catch(e){r.reject()}}).fail(function(){r.reject()});return r.promise()}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(c,u){"use strict";giscloud.geoutils={merge:function(e,t){var a=new c.Deferred,i="geo_utils/merge.json",n={sources:e};if(t&&t.fieldsMap){t.fields_map=c.isArray(t.fieldsMap)?t.fieldsMap.join():t.fieldsMap;delete t.fieldsMap}c.extend(n,t);u.rest.get(i,n,"application/json").done(function(e,t,i){var n=i.getResponseHeader("Location"),r=n&&n.match(/tables\/(\w+)/);a.resolve([r&&r[1]])}).fail(function(){a.reject(arguments)});return a.promise()},featuresAtPoint:function(e,t,i,n){var r=new c.Deferred,a="geo_utils/features_at_point.json?",s={},o=e&&e instanceof giscloud.LonLat?e:null;if(!o||!t)return;if(typeof i==="function"){n=i;i=null}else{n=n||i&&i.callback}a+="point_x="+o.lon;a+="&point_y="+o.lat;a+="&layer_id="+t.join(",");if(i&&i.srid){a+="&srid="+i.srid}if(i&&i.buffer){a+="&buffer="+i.buffer}u.rest.get(a).done(function(){var e=arguments[0],t=[];try{c.each(e,function(){t.push(new giscloud.Feature(this))});r.resolve(t)}catch(e){r.reject()}}).fail(function(){r.reject()});if(n){r.done(n)}return r.promise()},featuresAtPointForMap:function(n,e,t){var r=new c.Deferred;giscloud.layers.byMapId(e,function(e){var t,i=new Array;try{c.each(e,function(e,t){i.push(t.id)});giscloud.geoutils.featuresAtPoint(n,i,t,function(e){try{r.resolve(e)}catch(e){r.reject()}})}catch(e){r.reject()}});return r.promise()},nearest:function(e,t,i,n){var r=new c.Deferred,a="geo_utils/nearest.json?",s=e&&e instanceof giscloud.LonLat?e:null;if(!s||!t){return}if(typeof i==="function"){n=i;i=null}else{n=n||i&&i.callback}a+="point_x="+s.lon;a+="&point_y="+s.lat;a+="&layer_id="+t.join(",");if(i&&i.srid){a+="&srid="+i.srid}if(i&&i.results){a+="&results="+i.results}u.rest.get(a).done(function(){var e=arguments[0],t=[];try{c.each(e,function(){t.push(new giscloud.Feature(this))});r.resolve(t)}catch(e){r.reject(e)}}).fail(function(){r.reject(arguments)});if(n){r.done(n)}return r.promise()},spatialFilter:function(e,t,i,n){var s=new c.Deferred,r="geo_utils/spatial_filter.json",a={perPage:5e3,page:1};function o(n,r,a){u.rest.call("POST",n,r).done(function(e){var t=a||[],i;if(e.length===5e3&&r.page<4){i=true}try{c.each(e,function(){t.push(new giscloud.Feature(this))});if(i){r.page=r.page+1;r.perPage=r.perpage;delete r.perpage;o(n,r,t)}else{s.resolve(t)}}catch(e){s.reject()}}).fail(function(){s.reject()})}if(!t)return;if(typeof i==="function"){n=i;i=null}else{n=n||i&&i.callback}if(i&&i.srid){a.srid=i.srid}if(i&&i.operation){a.operation=i.operation}if(i&&i.onlyFeatureIds){a.only_feature_ids=1}if(i&&i.filterByExpression){a.filter_by_expression=1}if(typeof e==="string"){a.features=e}else if(e instanceof giscloud.Geometry){a.filter=e.toOGC()}a.layer_ids=t.join(",");o(r,a);if(n){s.done(n)}return s.promise()},area:function(e,t,i,n){var r=e;if(r.rings){var a=new giscloud.GraphicStyle("polygon");r=new giscloud.GraphicFeature(e,a)}var s=new c.Deferred,o="geo_utils/area.json?geometry="+r.toOGC()+"&geometry_srid="+t+"&output_srid="+i;u.rest.call("POST",o).done(function(){var e=arguments[0],t="";try{c.each(e,function(){t=this.toString()});s.resolve(t)}catch(e){s.reject()}}).fail(function(){s.reject()});if(n){s.done(n)}return s.promise()},featureArea:function(e,t,i,n,r){if(!e||!t){console.log("Please define layer id and feature id to proceed.");return}if(!i){i="900913"}if(!n){n=i}var a=e,s=t,o="",l=new c.Deferred;giscloud.features.byId(a,s,{geometry:"wkt"}).done(function(e){if(e.geometry){o=e.geometry;var t="geo_utils/area.json?geometry="+o+"&geometry_srid="+i+"&output_srid="+n;u.rest.call("POST",t).done(function(){var e=arguments[0],t="";try{c.each(e,function(){t=this.toString()});l.resolve(t)}catch(e){l.reject()}}).fail(function(){l.reject()})}else{console.log("Geometry is not defined.");return}});if(r){l.done(r)}return l.promise()},featureBounds:function(e,t,i){var n=new c.Deferred,r="geo_utils/feature_bounds.json?",a={};if(!e)return;r+="layer_id="+e;if(t&&t.where){r+="&where="+encodeURIComponent(t.where)}if(t&&t.srid){r+="&srid="+t.srid}if(t&&t.proj4){r+="&proj4="+encodeURIComponent(t.proj4)}u.rest.get(r).done(function(){var e=arguments[0];n.resolve(e)}).fail(function(){n.reject(arguments)});if(i){n.done(i)}return n.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(s,o){"use strict";giscloud.geocoder={query:function(e,t,i){var n=new s.Deferred,r="geocoder.json",a={service:"tt"};if(typeof t==="function"){i=t;t=null}else{i=i||t&&t.callback}if(typeof e=="object"){s.extend(a,e)}else if(typeof e=="string"){s.extend(a,{address:e})}else{console.log("Invalid first arg.");return n}if(t&&t.srid){a.srid=t.srid}if(t&&t.service){a.service=t.service.toLowerCase()}o.rest.get(r,a).done(function(){var e=arguments[0],t={};if(a.service=="tt"){try{t.results=e.geoResponse.geoResult;s.each(t.results,function(e,t){delete t.geohash;delete t.mapName;delete t.isCensusMicropolitanFlag;delete t.iteration;delete t.widthMeters;delete t.heightMeters});n.resolve(t)}catch(e){n.reject()}}else{t.results=e;n.resolve(t)}}).fail(function(){var e=arguments[0],t=e?s.parseJSON(e.responseText):null;n.reject(t,e?e.status:null)});if(i){n.done(i)}return n.promise()}}})(giscloud.exposeJQuery(),giscloud.common());(function(e,c,u,n){"use strict";giscloud.ui.FeatureForm=function e(i,r,a){var s,o,l;function t(){var n=new c.Deferred;var e="layers/"+r;if(a!=null){e+="/features/"+a}e+="/form.html";function t(e,t,i){s=t;o=i;n.resolve("form ready").promise()}c(i).one("formReady.gc-custom-form",t);u.rest.call("get",e,{buttons:"none"},"text/html").always(function(e){var t=c(e.responseText);l=t.attr("id");t.appendTo(i)});return n}this.loaded=t();this.save=function(){var i=c.Deferred();c(s).trigger("save.gc-custom-form");c(s).on("submitSuccess.gc-custom-form",function(e,t){i.resolve(t).promise()});return i};this.data=function(e){if(Object.prototype.toString.call(e)==="[object Object]"){for(var t in e){if(e.hasOwnProperty(t)){c(s).trigger("setFieldValue.gc-custom-form",[t,e[t]])}}}else if(e===n){return o.gatherData().data}else{return}};this.reset=function(){o.reset()};this.clear=function(){var e=this.data();var t={};for(var i in e){if(e.hasOwnProperty(i)){t[i]=null}}this.data(t)};this.destroy=function(){c(s).off("submitSuccess.gc-custom-form");c("#"+l).remove();c(s).trigger("destroy.gc-custom-form")}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var r,a,s,o,l,c,u=Math.PI/180,d,h,f,p,g,m,v,y,_,b={color:new giscloud.Color(160,160,160,100),size:1},w=new giscloud.GraphicStyle(b),x=new giscloud.GraphicStyle("point"),C,T=false,k,M,S;giscloud.ui.defaultTools.azimuth=function(){return new giscloud.ui.Toolbar.Tool("azimuth",{styles:{caption:"Azimuth",showCaption:false,cssClass:"gc-tool-azimuth",active:"gc-tool-azimuth-active",hover:"gc-tool-azimuth-hover"},actions:{activation:function(e){S=e;S.loading.done(function(){S.bind("mouseDown",L);S.bind("mouseMove",D);S.instance.setCursor("crosshair")})},deactivation:function(e){S=e;for(var t=0;t<S.markers.length;t++){S.markers[t].visible(false)}S.graphic.unbind("doubleClick",j);S.unbind("mouseMove",D);S.unbind("mouseDown",L);S.instance.setCursor("");S.graphic.clear();C=null;m=null;r=null;T=false;p=null}}})};function L(e){if(C){S.graphic.add(C);f=new giscloud.LabelMarker;S.addMarker(f);f.location(e).content(k);C=null}d=new giscloud.geometry.Point(e.lon,e.lat);o=e.lon*u;s=e.lat*u;if(!T){g=new giscloud.GraphicFeature(d,x);S.graphic.add(g);S.graphic.bind("doubleClick",j)}T=true}function D(e){var t,i,n,r;if(!T){return}h=new giscloud.geometry.Point(e.lon,e.lat);v=new giscloud.geometry.Line([d,h]);if(!C){C=new giscloud.GraphicFeature(v,w);S.graphic.add(C)}C.geometry(v);if(!m){m=new giscloud.GraphicFeature(h,x);S.graphic.add(m)}m.geometry(h);c=e.lon*u;l=e.lat*u;y=c-o;_=l-s;if(y>0&&_>0){t=Math.atan(y/_)*(1/u)}else if(y>0&&_<0){t=Math.atan(y/_)*(1/u)+180}else if(y<0&&_<0){t=Math.atan(y/_)*(1/u)+180}else if(y<0&&_>0){t=Math.atan(y/_)*(1/u)+360}else if(y===0&&_>0){t=0}else if(y===0&&_<0){t=180}else if(y>0&&_===0){t=90}else if(y<0&&_===0){t=270}else if(y===0&&_===0){t=0}else{console.log("Problem with azimuth!")}i=t|0;n=Math.abs(t-i)*60|0;r=Math.abs(t-i)*3600-n*60|0;k=i+"°"+n+"'"+r+"''";if(!p){p=new giscloud.LabelMarker;S.addMarker(p)}p.location(e).content(k)}function j(){C=null;m=null;r=null;T=false;p=null;return}})(window,giscloud.exposeJQuery(),giscloud.common());(function(r,t,e,i){var n=this,a,s,o,l=new giscloud.GraphicStyle({color:giscloud.Color.fromHex(0),size:1}),c=new giscloud.GraphicStyle({size:1,color:new giscloud.Color(0,0,0),fill:new giscloud.Color(255,0,0)});giscloud.ui.defaultTools.freehand=function(e){a=new giscloud.ui.Toolbar.Tool("freehand",{styles:{caption:"Freehand",showCaption:false,cssClass:"gc-tool-freehand",active:"gc-tool-freehand-active",hover:"gc-tool-freehand-hover"},actions:{activation:function(e){o=e;o.loading.done(function(){u();o.instance.setCursor("crosshair")})},deactivation:function(e){d()}}});a.layerId=e&&e.layerId?e.layerId:null;return a};function u(){if(s)o.graphic.remove(s);o.instance.setTool("SelectTool");p()}function d(){if(s)o.graphic.remove(s);o.graphic.cancelDraw();t(o.container()).off("mousedown",f);t(o.container()).off("mouseup",h)}function h(e){n.lastMouseEvent=e;o.graphic.acceptDraw()}function f(e){if(t.inArray(t(e.target).prop("tagName").toLowerCase(),["svg","canvas"])==-1){p();return}t(document).one("mouseup",h)}function p(){t(o.container()).one("mousedown",f);o.graphic.draw("freehand",l).done(function(e){if(s)o.graphic.remove(s);var t=e.geometry(),i,n;t.lines[0].points.push(t.lines[0].points[0]);t=new giscloud.geometry.Polygon(t.lines);i=a.layerId?a.layerId:null;if(!i){n=r.gcapp&&gcapp.gclayer.llist?gcapp.gclayer.llist.getSelected():null;i=n?n.id:null}if(!i){if(giscloud.ui&&giscloud.ui.alert)giscloud.ui.alert.red(__("No layer selected"),2e3);p();return}if(n&&n.lock=="t"){if(giscloud.ui&&giscloud.ui.alert)giscloud.ui.alert.red(__("The currently selected layer is locked"),2e3);p();return}if(giscloud.ui&&giscloud.ui.alert)giscloud.ui.alert.green(__("PleaseWait"));giscloud.geoutils.spatialFilter(t,[i],{srid:o.instance.epsg,operation:"intersect",onlyFeatureIds:1}).always(function(){if(giscloud.ui&&giscloud.ui.alert)giscloud.ui.alert.hide()}).done(function(e){g(e)});s=new giscloud.GraphicFeature(t,c);o.graphic.add(s);a.trigger("select",{geometry:t});p()})}function g(e){a.trigger("selectFeatures",{features:e});if(r.gcapp){var i={lid:gcapp.gclayer.llist.getSelected().id,fids:[]};t.each(e,function(e,t){i.fids.push(t.id)});i.fids=i.fids.join(",");gcapp.selo.onGetFeaturesByBoundComplete(i,n.lastMouseEvent.originalEvent)}else{o.selection.clear();t.each(e,function(e,t){o.selectFeature(a.layerId,t.id)})}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(n,t,e,i){var o,l=[],c={url:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",width:0,height:0},u,d=[],h=[],f,p,g=3410,m,v="m",r;giscloud.ui.defaultTools.areaMeasure=function(e){if(e&&e.srid){giscloud.ui.defaultTools.areaMeasure.outputSrid(e.srid)}if(e&&e.unit){giscloud.ui.defaultTools.areaMeasure.measureUnit(e.unit)}return new giscloud.ui.Toolbar.Tool("areaMeasure",t.extend({styles:{caption:"Area measure",showCaption:false,cssClass:"gc-tool-areaMeasure",active:"gc-tool-areaMeasure-active",hover:"gc-tool-areaMeasure-hover"},actions:{activation:a,deactivation:s}},e||{}))};function a(e){r=true;p=e;t(document).keyup(_);p.loading.done(function(){p.instance.setCursor("crosshair");var e=function(){m=giscloud.proj4(p.projection,"EPSG:"+g);p.graphic.draw("polygon").progress(w).then(C)};if(giscloud.proj4.defs("EPSG:"+g)){e()}else{giscloud.includeJs("/rest/1/geo_utils/epsg_to_proj4js?srid="+g).done(e)}})}function s(e){r=false;t(document).unbind("keyup");p.graphic.clear();y();while(o=l.pop()){p.removeMarker(o)}}function y(){d=[];h=[];o=null;p.graphic.cancelDraw()}function _(e){if(e.keyCode==27){s(p)}}giscloud.ui.defaultTools.areaMeasure.outputSrid=function(e){var t;if(!e){if(n.user&&n.user.options&&user.options.UNIT_SRID){t=user.options.UNIT_SRID}}else{t=e}if(!t){return}var i=function(){m=giscloud.proj4(giscloud.ui.map?"EPSG:CURRENT":p.projection,"EPSG:"+t)};if(giscloud.proj4.defs("EPSG:"+t)){i()}else{giscloud.includeJs("/rest/1/geo_utils/epsg_to_proj4js?srid="+t).done(i)}return t};giscloud.ui.defaultTools.areaMeasure.measureUnit=function(e){if(e!==i&&b(e)){v=e}return v};function b(e){if(typeof e!=="string"){return null}if(!giscloud.toSqMeterRatio[e]&&!giscloud.toMeterRatios[e]){return null}return e}function w(e,t){if(e){var i={lon:e.rings[0].points[e.rings[0].points.length-1].x,lat:e.rings[0].points[e.rings[0].points.length-1].y};x(i,t)}return}function x(e,t){var i,n,r=giscloud.proj4.defs("EPSG:"+g)?giscloud.proj4.defs("EPSG:"+g).units:giscloud.proj4.defs("GC_MAP_CURRENT").units,a;if(!r){r="degrees"}u=new giscloud.geometry.Point(e.lon,e.lat);d.push(u);h.push(m.forward({x:u.x,y:u.y}));if(d.length>2){if(p.instance.epsg){f=parseInt(p.instance.epsg)}else{f=3410}areaCount=giscloud.math.util.calculatePolygonAreaAndCentroid(h).area;if(!o&&!t){o=new giscloud.Marker;o.icon(c);p.addMarker(o);l.push(o)}var s=areaCount;if(v!==r&&r!=="degrees"&&areaCount!=="0"){if(v=="acre"||v=="ha"){areaCount=giscloud.toMeters(r,parseFloat(areaCount),true);areaCount=giscloud.fromSquareMeter(v,areaCount)}else{areaCount=giscloud.toMeters(r,parseFloat(areaCount),true);areaCount=giscloud.fromMeters(v,areaCount,true)}}areaCount=parseFloat(areaCount).toFixed(2).toString().replace(".",",");switch(v){case"foot":case"us survey foot":case"foot_us":a="ft";break;case"meter":case"meters":a="m";break;case"acres":a="acres";break;default:a=v}p.fire("areaMeasure",{epsg_area:s,epsg_unit:r,epsg:f});n=areaCount.split(",");j=0;i=n[0].length-3;for(i;i>0;i=i-3){areaCount=[areaCount.slice(0,i),".",areaCount.slice(i)].join("");j++}if(v=="acre"||v=="ha"){areaCount=areaCount+"&nbsp;"+a+"&nbsp;"}else{areaCount=areaCount+"&nbsp;"+a+"<sup>2</sup>"}if(!t){centroid=giscloud.math.util.calculatePolygonAreaAndCentroid(d).centroid;centroid=new giscloud.LonLat(centroid.x,centroid.y);o.location(centroid)}if(o){o.label(areaCount)}}if(t){d.pop();h.pop()}}function C(){y();setTimeout(function(){if(r){p.graphic.draw("polygon").progress(w).then(C)}},0)}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,i,s,t){var o=[],l={icon:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",width:0,height:0},c,u,d,h,f,p=0,g,n;giscloud.ui.defaultTools.distanceMeasure=function(e){return new giscloud.ui.Toolbar.Tool("distanceMeasure",i.extend({styles:{caption:"Distance measure",showCaption:false,cssClass:"gc-tool-distanceMeasure",active:"gc-tool-distanceMeasure-active",hover:"gc-tool-distanceMeasure-hover"},actions:{activation:r,deactivation:a}},e||{}))};function r(e){n=true;h=e;i(document).keyup(v);h.loading.done(function(){g=giscloud.proj4(h.projection,"EPSG:4326");h.instance.setCursor("crosshair");h.graphic.draw("line").progress(y).then(b)})}function a(e){var t=null;h=e;n=false;i(document).unbind("keyup");h.graphic.clear();m();while(t=o.pop()){h.removeMarker(t)}}function m(){p=0;d=null;u=null;f=null;h.graphic.cancelDraw()}function v(e){if(e.keyCode==27){a(h)}}function y(e,t){if(e){var i={lon:e.points[e.points.length-1].x,lat:e.points[e.points.length-1].y};_(i,t)}return}function _(e,t){var i=giscloud.proj4.defs("EPSG:4326").units,n;c=new giscloud.geometry.Point(e.lon,e.lat);n=g.forward({x:c.x,y:c.y});d=new giscloud.LonLat(e.lon,e.lat);if(u){var r=p+s.haversine(u.y,u.x,n.y,n.x);if(!t){p=r}var a;if(f)a=f;else{a=new giscloud.Marker;a.icon(l.icon);a.clickable(false);h.addMarker(a);o.push(a)}h.fire("distanceMeasure",{epsg_distance:r,epsg_unit:i});a.location(d).label(h.instance.measureLabelFunction(r));if(t){f=a}else{f=null}}if(!t){u=n}}function b(){m();setTimeout(function(){if(n){h.graphic.draw("line").progress(y).then(b)}},0);return}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,t,i,n){var c,u,d;giscloud.ui.defaultTools.countByPolygon=function(){return new giscloud.ui.Toolbar.Tool("countByPolygon",{styles:{caption:"Count by polygon",showCaption:false,cssClass:"gc-tool-countByPolygon",active:"gc-tool-countByPolygon-active",hover:"gc-tool-countByPolygon-hover"},actions:{activation:function(e){c=e;c.loading.done(function(){c.instance.setTool("AreaSelection");c.instance.addEventListener("areaselection",r)})},deactivation:function(e){c.instance.removeEventListener("areaselection",r)}}})};function h(){if(u)c.graphic.remove(u);if(d)c.removeMarker(d)}function r(e){var t=giscloud.ui.layerList.selected();if(t==null||isNaN(t)){alert("Please select the layer first.");return}var i=new giscloud.Bounds(Math.min(e.xMin,e.xMax),Math.min(e.yMin,e.yMax),Math.max(e.xMin,e.xMax),Math.max(e.yMin,e.yMax));h();var n=[];n.push(new giscloud.geometry.Point(e.xMin,e.yMin));n.push(new giscloud.geometry.Point(e.xMax,e.yMin));n.push(new giscloud.geometry.Point(e.xMax,e.yMax));n.push(new giscloud.geometry.Point(e.xMin,e.yMax));n.push(new giscloud.geometry.Point(e.xMin,e.yMin));var r=new giscloud.GraphicStyle("polygon"),a=new giscloud.geometry.Line(n),s=new giscloud.geometry.Polygon([a]);u=new giscloud.GraphicFeature(s,r);u.bind("click",h);c.graphic.add(u);var o=new giscloud.LonLat(i.left,i.top),l="Loading...";d=new giscloud.LabelMarker;c.addMarker(d);d.location(o).content(l);giscloud.features.byBounds(t,i).done(function(e){var t=e.length>=5e3?e.length+"+":e.length;d.content(t)})}})(window,giscloud.exposeJQuery(),giscloud.common());(function(d,e){"use strict";var h={title:"GIS Cloud",message:"",value:null,placeholder:null,container:null,inputType:"text",inputValues:null},f={width:"auto",overlay:false,escClose:true,draggable:true,privateButtons:true,buttons:[{class:"btn btn-default gc-prompt-cancel-button",html:e.__("Cancel")},{class:"btn btn-primary gc-prompt-ok-button",html:e.__("OK")}]},p=d("<div/>",{class:"gc-prompt-buttons"}).append(d("<button/>",{class:"btn btn-primary gc-prompt-ok-button",value:e.__("OK")}),d("<button/>",{class:"btn btn-default gc-prompt-cancel-button",value:e.__("Cancel")}));function i(e,t){if(t&&t.length){setTimeout(function(){t.empty().remove();t=null},1e3)}e.empty().remove();e=null}function g(e,t,i){if(i.which===13){v(e,t)}}function m(e,t){if(t.data("gc-prompt-result")){e.resolve(t.find(".gc-prompt-input").val())}else{e.reject()}i(t,t.closest(".modal"))}function v(e,t){t.data("gc-prompt-result",true);if(t.data("gc-prompt-modal")){t.closest(".modal").hide()}m(e,t)}function y(e,t){if(t.data("gc-prompt-modal")){t.closest(".modal").hide()}m(e,t)}giscloud.ui.prompt=function e(t,i,n,r,a){var s,o,l,c,u=new d.Deferred;if(d.isPlainObject(t)){s=d.extend(true,{},h,t)}else{s=d.extend(true,{},h);s.title=n!=null?n:s.title;s.message=t!=null?t:s.message;s.value=i!=null?i:s.value;s.placeholder=r!=null?r:s.placeholder;s.container=a!=null?a:s.container}if(s.inputType==="select"){c=d("<select/>",{class:" form-control gc-prompt-input gc-prompt-input-select"});c.append(d.map(s.inputValues||[],function(e){if(e.name){return d("<option/>",{text:e.title||e.name,value:e.name})}return d("<option/>",{text:e,value:e})}))}else{c=d("<input/>",{type:s.inputType,class:"form-control gc-prompt-input gc-prompt-input-"+s.inputType})}l=d("<div/>",{class:"form-group gc-prompt-content"}).append(d("<label/>",{class:"gc-prompt-message",html:s.message}),c);if(s.container){s.container=d(s.container);s.container.addClass("gc-prompt-container");s.container.append(l);s.container.append(p);s.container.on("click",".gc-prompt-ok-button",d.proxy(v,window,u,s.container)).on("click",".gc-prompt-cancel-button",d.proxy(y,window,u,s.container));if(s.value!=null){c.val(s.value)}c.focus()}else{o=giscloud.ui.modal(d.extend(true,{},f,{title:s.title,content:l[0].outerHTML}));s.container=o.find(".modal-body");s.container.data("gc-prompt-modal",true);o.on("hide.bs.modal",d.proxy(m,window,u,s.container)).on("keydown",d.proxy(g,window,u,s.container)).on("click",".gc-prompt-ok-button",d.proxy(v,window,u,s.container)).on("click",".gc-prompt-cancel-button",d.proxy(y,window,u,s.container));o.one("shown.bs.modal",function(){var e=d(this).find(".gc-prompt-input");if(s.value!=null){e.val(s.value)}e.focus()})}s.container.data("gc-prompt-result",false);return u.promise()}})(giscloud.exposeJQuery(),giscloud.common());(function(C){"use strict";giscloud.ui.ProjectionPicker=function(h,f){var p=this,i,g,m,r=[],v,y,_,b,w,t={my:"left top",at:"left bottom",collision:"none"},x=[{epsg:900913,title:"EPSG:900913 Google Maps Global Mercator",proj4:"+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"},{epsg:4326,title:"EPSG:4326 WGS84",proj4:"+proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"},{epsg:3410,title:"EPSG:3410 NSIDC EASE-Grid Global",proj4:"+proj=cea +lon_0=0 +lat_ts=30 +x_0=0 +y_0=0 +a=6371228 +b=6371228 +units=m +no_defs",addToProj4js:true}];this.options=f;p.init=function(){if(f&&!f.no_title){var e=f.title||"Choose projection";h.html(e)}g=C("<div/>",{class:"gc-projectionpicker"});var t=C("<div/>",{text:gclang.Last_used_spatial_projection,class:"gc-header"});var i=C("<ul/>",{class:"gc-list"});var n=C("<div/>",{class:"gc-aux-menu"});C("body").append(g);g.append(t,i,n);y=g.find(".gc-aux-menu");var r=C("<span/>",{text:gclang.Projection_is_not_on_the_list__Look_up_the_full_list_,class:"gc-comment"});var a=C("<a/>",{text:gclang.Open_projection_form,class:"gc-projection-form linkbutton"});y.append(r,a);v=g.find(".gc-projection-form");m=g.find(".gc-list");C(h).click(p.toggle);v.click(p.openProjectionForm);C(document).mouseup(function(e){if(_&&!g.is(e.target)&&!C(h).is(e.target)&&g.has(e.target).length===0){p.close()}});C(document).keyup(function(e){if(e.keyCode==27)p.close()});if(C.cookie){var s=C.cookie("gc-projection-last-used")&&C.cookie("gc-projection-last-used").length?C.parseJSON(C.cookie("gc-projection-last-used")):null,o,l;if(s){for(l=s.length-1;l>=0;l--){o=s[l];o.epsg=+o.epsg;if(!x.find(function(e){return e.epsg===o.epsg})){x.unshift(o)}}}}C.each(x,function(e,t){p.addProjection(t)});if(f&&f.hidden_fields){var c=f.epsg_field||"epsg";var u=f.proj4_field||"proj4";var d=h.parents("form:first");b=d.find("input[name='"+c+"']").first();w=d.find("input[name='"+u+"']").first();if(b.length&&w.length){p.select({epsg:b.val(),proj4:w.val()})}else{b=C("<input type='hidden' name='"+c+"' />");d.prepend(b);w=C("<input type='hidden' name='"+u+"' />");d.prepend(w)}}if(f&&f.default_proj)p.select(f.default_proj)};p.openProjectionForm=function(e){showProjections({proj4:C("#proj4").val()},function(e){if(!e||!e.proj4)return;p.setProjTitle(e);p.select(e)});p.close()},p.setProjTitle=function(e){if(e.title)return;e.title="EPSG:"+(e.epsg>0?e.epsg:__("Unknown"));if(e.name)e.title+=" "+e.name},p.active=function(){return i},p.unselect=function(e){if(f&&!f.no_title){var t=f&&f.title||"Choose projection";h.html(t)}h.attr("title","");if(b&&w){b.val(null);w.val(null)}i=null;p.close();m.find("li").removeClass("gc-active")},p.select=function(n){if(!n||!C.isNumeric(n.epsg))return;p.close();p.addProjection(n,true);p.setProjTitle(n);if(p.options&&!p.options.no_title){h.html(n.title)}h.attr("title","EPSG:"+n.epsg+" Proj4: "+n.proj4);if(b&&w){b.val(n.epsg);w.val(n.proj4)}i=n;C.each(m.find("li").removeClass("gc-active"),function(e,t){var t=C(t),i=t.data("proj");if(i&&i.epsg==n.epsg){t.addClass("gc-active")}});if(n.epsg>0){C.each(r,function(e,t){if(t.epsg==n.epsg){r.splice(e,1);r.splice(0,0,n)}});p.saveCookie()}h.trigger("select",n)},p.addProjection=function(i,e){if(!i||!(i.epsg>0))return;var n=false;C.each(r,function(e,t){if(t.epsg==i.epsg){if(!i.title&&t.title){i.title=t.title}if(!i.proj4&&t.proj4){i.proj4=t.proj4}n=true}});if(n||!i.epsg||!i.proj4){return}p.setProjTitle(i);var t=C("<li/>",{text:i.title,title:i.proj4});t.click(function(){p.select(i,true)});if(e){m.prepend(t);r.splice(0,0,i)}else{m.append(t);r.push(i)}t.data("proj",i);r=C(r).slice(0,10);p.saveCookie();if(i.addToProj4js){giscloud.proj4.defs("EPSG:"+i.epsg,i.proj4)}},p.saveCookie=function(){if(!C.cookie)return;var i=[];C.each(r,function(e,t){i.push({epsg:t.epsg,proj4:t.proj4,title:t.title})});C.cookie("gc-projection-last-used",JSON.stringify(i))},p.toggle=function(){if(_)p.close();else p.open()};p.open=function(e){g.show();h.addClass("gc-hover");_=true;g.position(C.extend({of:h},t))};p.close=function(e){g.hide();h.removeClass("gc-hover");_=false};p.init()};C(function(){})})(giscloud.exposeJQuery());(function(s,g,e){"use strict";var i={data_filter_input:{code:"DATA_FILTER_INPUT",label:"Input Filter"},data_filter_autocomplete:{code:"DATA_FILTER_AUTOCOMPLETE",label:"Autocomplete filter"},data_filter_minmax:{code:"DATA_FILTER_MINMAX",type:[0,2],label:"Min/Max filter"},data_filter_range:{code:"DATA_FILTER_RANGE",type:[0,2],label:"Range filter"},data_filter_dropdown:{code:"DATA_FILTER_DROPDOWN",label:"Dropdown filter"},data_filter_datetime:{code:"DATA_FILTER_DATETIME",type:[0,2,11],label:"Date filter"},data_filter_slider:{code:"DATA_FILTER_SLIDER",type:[0,2],label:"Slider filter"},data_filter_features_number:{code:"DATA_FILTER_FEATURES_NUMBER",label:"Features number filter"}};giscloud.ui.filters=function(h,f,e){var p=this,o,t=false;p.eventNamespace="gc-filter";p.options={gcdatagrid:null,viewer:null,zoomToFeatures:true,flagRelevantVal:false};p.EVENTS=["filter-add","filter-remove","panel-rendering","panel-rendered"];p.layerId=null;p.whereObjects=[];p.whereObjectsBetween=[];p.filterColumnsList=[];p.layer=null;p.init=function(){p.options=g.extend(true,{},p.options,e);if(s.gcdatagrid&&!p.options.gcdatagrid){p.options.gcdatagrid=s.gcdatagrid}if(giscloud.ui.map&&!p.options.viewer){p.options.viewer=giscloud.ui.map}p.layerId=h.layer_id;p.layer=p.options.viewer.layerById(p.layerId);if(!p.options.viewer){throw"giscloud.ui.filters: viewer is not defined"}if(!p.layerId){throw"giscloud.ui.filters: layerId is not defined"}if(!p.layer){throw"giscloud.ui.filters: layer is not defined"}if(p.options.gcdatagrid){p.options.gcdatagrid.addEvent("applyfilters",function(){p.getNumOfFeatures()})}p.render();p.getNumOfFeatures()};p.on=function(){g(p).on.apply(p,Array.prototype.slice.apply(arguments));return p};p.off=function(){g(p).off.apply(p,Array.prototype.slice.apply(arguments));return p};p.bind=function(){return p.on.apply(p,Array.prototype.slice.apply(arguments))};p.unbind=function(){return p.off.apply(p,Array.prototype.slice.apply(arguments))};p.triggerEvent=function(e,t){var i=e+"."+p.eventNamespace;g(p).trigger(i,t)};p.failHandler=function(e){throw e||"An error has occurred please contact technical support for further help"};p.render=function(){f.find(".gc-filter-item").remove();var e=h.items,t,i;for(t=0;t<e.length;t++){i=e[t];p.renderFilter(i)}var n=g("<button/>").html("Reset").css("margin-right",10).addClass("btn btn-default btn-info btn-sm btn-reset").click(p.reset),r=g("<button/>").html("Export").css("margin-right",10).addClass("btn btn-default btn-sm btn-success").click(p.exportCSV);var a=g("<div/>").addClass("gc-filter-item").css("padding-top",10);if(!h.search)a.append(n);if(h.export_csv)a.append(r);if(h.mail_csv){o=g("<button/>").html(h.mailto_label?h.mailto_label:"Mail").css("margin-right",10).addClass("btn btn-default btn-sm btn-success").click(p.mailCSV).appendTo(a)}if(h.applyButton){var s=g("<button/>").html("Apply").addClass("btn btn-default btn-sm btn-primary").appendTo(a)}f.append(a)};p.reset=function(){var e=h.items,t;if(p.options.gcdatagrid){p.options.gcdatagrid.removeAllFilters(true)}if(p.options.gcdatagrid){p.options.gcdatagrid.applyFilters()}p.clearWhereObjects();for(t=0;t<e.length;t++){e[t].value=null;e[t].forceMin=null;e[t].forceMax=null;e[t].forceIncludeNull=null;e[t].dataCondition=null}p.render();p.triggerEvent(p.EVENTS[1],p);p.applyFilterOnMap()};p.exportCSV=function(){if(p.options.gcdatagrid){p.options.gcdatagrid.last_req_params={where:p.options.gcdatagrid.options.where};p.options.gcdatagrid.downloadCSV(true)}};p.mailCSV=function(){if(p.sending_email){return}o.text("Sending...");p.sending_email=true;giscloud.features.emailCSV({emails:h.mailto,layer_id:h.layer_id,where:p.options.gcdatagrid?p.options.gcdatagrid.options.where:null}).done(function(){alert("Mail has been sent successfully.")}).fail(function(){alert("Mail has NOT been sent successfully. Please try again or contact us directly.")}).always(function(){p.sending_email=false;o.text(h.mailto_label?h.mailto_label:"Mail")})};p.apply=function(e,t,i,n){if(t===""||t===undefined||t===null||g.isArray(t)&&g.inArray("__gc_no_filter",t)!=-1){p.removeFilter(e,n)}else{p.addFilter(e,t,i,n)}p.refreshFilterItems(n.target)};p.refreshFilterItems=function(t){var n="",r="",e,i,a,s,o,l,c,u;o=function(e){if(e){e=" AND "+e}return e};l=function(e){if(e){e=" OR "+e}return e};c=function(e,t){if(e){e=e+" "+t+" "}return e};u=function(t){return g.grep(h.items,function(e){if(e.id==t){return e}})[0]};g.map(p.whereObjects,function(i){if(i.value){if(g.isArray(i.value)){r="";g.map(i.value,function(e,t){if(t>0){r=c(r,i.insideOpr)}if(e==="null"||e==="(null)"){r+='"'+i.column+'" IS NULL'}else{r+='"'+i.column+"\"='"+e+"'"}});if(r){n="("+r+")"+o(n)}}else{n='"'+i.column+"\"='"+i.value+"'"+o(n)}}});e=g.map(p.whereObjectsBetween,function(e){r="";if(e.max){r='"'+e.column+'"<='+e.max+""}if(e.min){r='"'+e.column+'">='+e.min+""+o(r)}if(r){r="("+r+")"}if(e.includeNull){r='"'+e.column+"\"='"+e.includeNull+"'"+l(r)}return r});if(e.length>0){if(e.length==1){n="("+e.join(" ")+")"+o(n)}else{n="("+e.join(" AND ")+")"+o(n)}}g.map(p.whereObjects,function(e){i=u(e.itemId);if(i){i.value=e.value}});g.map(p.whereObjectsBetween,function(e){i=u(e.itemId);if(i){i.value=e.value;i.forceMin=e.min;i.forceMax=e.max;i.forceIncludeNull=e.includeNull}});g.map(h.items,function(e){if(!e.relevantValues||t&&e.id==p.getElementItemId(t)){return}if(e.relevantValues){e.dataCondition=n;a=p.isFilterActive(e);s=p.renderFilter(e,true);if(a){s.addClass("active")}}})};p.clearWhereObjects=function(){p.whereObjects=[];p.whereObjectsBetween=[]};p.removeWhereObjects=function(t){p.whereObjects=g.grep(p.whereObjects,function(e){if(e.itemId===t){return false}return true});p.whereObjectsBetween=g.grep(p.whereObjectsBetween,function(e){if(e.itemId===t){return false}return true})};p.applyWhereObjects=function(e,t,i,n){var r="AND",a={};if(i&&i.between){r="BETWEEN"}if(!g.isArray(t)){t=[t]}p.removeWhereObjects(n);if(t.length===0){return}if(r==="BETWEEN"){p.whereObjectsBetween.push({column:e,option:i,min:t[0],max:t[1],includeNull:t[2],itemId:n})}else{a={column:e,value:t,option:i,insideOpr:i.insideOperator||r,itemId:n};p.whereObjects.push(a)}};p.addFilter=function(e,t,i,n){var r=g(n.target).parents("[data-column='"+e+"']")||f.find("[data-column='"+e+"']"),a,s,o=false;r.addClass("active");if(!g.isEmptyObject(i)){a=i}if(p.filterColumnsList.indexOf(e)==-1){p.filterColumnsList.push(e)}if(t&&(t.length===1&&t[0]==="(null)")){t=[null];o=true}else if(t&&t.length>1&&(t.indexOf(null)>=0||t.indexOf("(null)")>=0)){if(t.indexOf("(null)")>=0){t[t.indexOf("(null)")]=null}o=true}if(p.options.gcdatagrid){s=p.options.gcdatagrid.isFilterAdded(e,t,a);if(s){p.options.gcdatagrid.removeFIlterByColumnAndValue(e,[a.preMin,a.preMax],a)}if(a&&a.preMin&&a.preMax){s=p.options.gcdatagrid.isFilterAdded(e,[a.preMin,a.preMax],{itemId:a.itemId,between:true});if(s){p.options.gcdatagrid.removeFIlterByColumnAndValue(e,[a.preMin,a.preMax],{itemId:a.itemId,between:true})}delete a.preMin;delete a.preMax}if(a.distinct&&s!==true){s=p.options.gcdatagrid.isFilterAdded(e,t.slice(0,t.length-1),a);if(s){p.options.gcdatagrid.removeFIlterByColumnAndValue(e,t.slice(0,t.length-1),a)}}if(g.isArray(t)&&t.length>0){p.options.gcdatagrid.addFilter(e,t,a,false)}else if(g.isArray(t)&&t.length===0){var l=p.getWhereObjectValueAndOpt(p.getElementItemId(n.target));if(l&&l.value){p.options.gcdatagrid.removeFIlterByColumnAndValue(e,l.value,l.option,true)}}else{p.options.gcdatagrid.addFilter(e,t,a,false)}}p.applyWhereObjects(e,t,i,p.getElementItemId(n.target));p.applyFilterOnMap(o);p.triggerEvent(p.EVENTS[0],p)};p.getElementItemId=function(e){return g(e).parents(".gc-filter-item").attr("item-id")};p.isFilterActive=function(e){return f.find(".gc-filter-item[item-id='"+e.id+"']").hasClass("active")};p.getWhereObjectValueAndOpt=function(t){var e;var i=g.grep(p.whereObjects,function(e){if(e.itemId===t){return true}return false})[0];if(!i){i=g.grep(p.whereObjectsBetween,function(e){if(e.itemId===t){return true}return false})[0];if(i){e=[i.min,i.max];if(i.includeNull){e.push(i.includeNull)}}}else{e=[i.value]}if(e===undefined){return}return{value:e,option:i.option}};p.applyFilterOnMap=function(e){if(p.options.viewer.selection.clearHighlight){p.options.viewer.selection.clearHighlight()}var t={context:{whereObjects:p.whereObjects,whereObjectsBetween:p.whereObjectsBetween,isFilterNull:e},attributes:p.filterColumnsList.join(","),filter:function e(a,s){var t,i,n,r;if(s.whereObjects.length===0&&s.whereObjectsBetween.length===0){return true}r=s.whereObjects.concat(s.whereObjectsBetween).filter(function(e){return a[e.column]!==undefined?false:true}).length===0;if(!r&&s.isFilterNull){return true}t=Object.keys(a).map(function(t){var i=a[t];var e=s.whereObjects.filter(function(e){return e.column===t});var n=s.whereObjectsBetween.filter(function(e){return e.column===t});var r=e.filter(function(e){if(e.option.datetime){i=new Date(i);i.setHours(0,0,0,0,0);e.value[0].setHours(0,0,0,0,0)}if(e.option.operator){switch(e.option.operator){case"after":return e.value[0]>i;case"onorafter":return e.value[0]>=i;case"before":return e.value[0]<i;case"onorbefore":return e.value[0]<=i}}else{return Array.isArray(e.value)?e.value.indexOf(i)>-1:e.value==i}});if(r.length===0&&n.length>0){r=n.filter(function(e){return i>=e.min&&i<=e.max||(e.includeNull?i===null:false)})}if(e.length>0||n.length>0){if(r.length===0){r=0}else{r=1}}else{r=2}return r});i=t.filter(function(e){return e===1});n=t.filter(function(e){return e===2});return i.length+n.length===t.length&&r}};p.options.viewer.filterFeatures(p.layerId,t);if(p.options.zoomToFeatures){giscloud.geoutils.featureBounds(p.layerId,{where:gcdatagrid.options.where,srid:fn.getMap().epsg}).done(function(e){if(e.bounds.left==0||e.bounds.right==0)return;p.options.viewer.bounds(new giscloud.Bounds(e.bounds.left,e.bounds.bottom,e.bounds.right,e.bounds.top))}).fail(function(){var e="Error zooming to features";var t;var i="";try{t=JSON.parse(arguments[0][0].responseText)}catch(e){console.warn("aiee, could not decode server response")}if(t.msg){i+=t.msg}if(t.nested.msg){i+=" "+t.nested.msg}if(i){i=e+": "+i}else{i=e}giscloud.ui.alert.red().show(i,5e3);g.proxy(p.failHandler,this)})}};p.removeFilter=function(e,t){var i=h.items,n,r,a;if(p.options.gcdatagrid){a=p.getWhereObjectValueAndOpt(p.getElementItemId(t.target));if(a&&a.value&&a.option){p.options.gcdatagrid.removeFIlterByColumnAndValue(e,a.value,a.option,true)}}for(n=0;n<i.length;n++){r=i[n];if(r.id.toString()===g(t.target).parents(".gc-filter-item").attr("item-id")){p.removeWhereObjects(r.id);r.value=null;r.forceMin=null;r.forceMax=null;r.dataCondition={};r.forceIncludeNull=null;p.renderFilter(r,true)}}p.applyFilterOnMap();p.refreshFilterItems();p.triggerEvent(p.EVENTS[1],p)};p.renderFilter=function(e,t){var i,n;var r=giscloud.ui.filters.getFilters();switch(e.type.toUpperCase()){case r.data_filter_input.code:i=p.renderInput(e,t);break;case r.data_filter_autocomplete.code:i=p.renderAutocomplete(e,t);break;case r.data_filter_minmax.code:i=p.renderMinMax(e,t);break;case r.data_filter_range.code:i=p.renderRange(e,t);break;case r.data_filter_dropdown.code:i=p.renderDropdown(e,t);break;case r.data_filter_datetime.code:i=p.renderDateTime(e,t);break;case r.data_filter_slider.code:i=p.renderSlider(e,t);break;case r.data_filter_features_number.code:p.renderFeaturesNumber(e,t);i=null;break;default:i=null;break}if(p.options.flagRelevantVal&&e.relevantValues&&i){n=g("<i>",{class:"fa relevant-value fa-bookmark","data-toggle":"tooltip"});n.attr("title",p.tooltip);i.eq(0).addClass("relevant-value").prepend(n)}if(i){var a=g('<button type="button" class="close removeFilter" title="Remove filter" ></button>').click(function(e){var t=g(e.currentTarget).parents(".gc-filter-item").attr("data-column");p.removeFilter(t,e)});if(i.length>1){i=i.eq(0)}i.append(a)}return i};p.renderAutocomplete=function(r,e){var t=r.label?r.label:r.column,i={},n=g("<input type='text' />").attr("placeholder",t).addClass("form-control").val(r.value),a=g("<label/>").text(t).addClass("control-label"),s=p.layer.sourceType==="file"&&p.layer.source.endsWith(".sqlite")?"LIKE":"ILIKE",o=p.renderFilterDiv(r,e).append(a).append(n);if(r.style)n.attr("style",r.style);if(!e)f.append(o);if(r.mode=="search"){var l=r.layer_id?r.layer_id:h.layer_id;r.component=n.autocomplete({source:function(e,t){var i=e.term;giscloud.features.byLayer(l,{where:r.column+" "+s+" '"+i+"%'",format:true,perPage:20}).done(t)},focus:function(){return false},select:function(e,t){var i=r.column_alias?t.item.data[r.column_alias]:t.item.data[r.column];this.value=i;p.options.viewer.bounds(t.item.bounds);var n={count:1,format:true,data:t.item.data,meta:t.item.meta,__id:t.item.id,__xmin:t.item.bounds.left,__ymin:t.item.bounds.bottom,__xmax:t.item.bounds.right,__ymax:t.item.bounds.top};gcapp.selo.showRecordInfo(n);return false},change:function(e){}}).data("autocomplete")._renderItem=function(e,t){var i=r.column_alias?t.data[r.column_alias]:t.data[r.column];e.addClass("filter");return g("<li>").attr("data-value",t).append(g("<a>").text(i)).appendTo(e)}}else{g.extend(i,{order_by:r.column+":ASC"});if(r.dataCondition){var c={};h.items.forEach(function(e){if(e.type==="DATA_FILTER_RANGE"&&e.column===r.column){c["filter[column][>]"]=e.forceMin||e.min;c["filter[column][<]"]=e.forceMax||e.max}else if(e.type==="DATA_FILTER_AUTOCOMPLETE"){c["filter[column][LIKE]"]=""}});g.extend(i,c)}n.typeahead({hint:true,highlight:true,minLength:1,showHintOnFocus:r.dataCondition?true:false,source:function(e,t){if(e===n.val()){t([])}if(r.dataCondition&&g.isEmptyObject(r.dataCondition)===false){i["filter[column][LIKE]"]="*"+e+"*"}else{g.extend(i,{["filter[column][LIKE]"]:"*"+e+"*"})}giscloud.layers.attributeOps.distinct(h.layer_id,r.column,i).done(function(e){t(e.data)})},afterSelect:function(e){p.apply(r.column,e,{itemId:r.id},{target:n})},render:function(e){var n=false;e=g(e).map(g.proxy(function(e,t){var i=this.displayText(t);e=g(this.options.item).data("value",t);e.find("a").html(this.highlighter(i));e.attr("title",i);if(i==this.$element.val()){e.addClass("active");this.$element.data("active",t);n=true}return e[0]},this));if(this.autoSelect&&!n){e.first().addClass("active");this.$element.data("active",e.first().data("value"))}this.$menu.html(e);return this}})}return o};p.renderInput=function(t,e){var i=t.label?t.label:t.column,n=g("<input type='text' />").attr("placeholder",i).addClass("form-control").change(function(e){p.apply(t.column,n.val(),{itemId:t.id},e)}).keypress(function(e){if(e.which==13){p.apply(t.column,n.val(),{itemId:t.id},e)}}),r=g("<label/>").text(i).addClass("control-label"),a=p.renderFilterDiv(t,e).append(r).append(n);t.component=n;if(t.style)n.attr("style",t.style);if(!e)f.append(a);return a};p.getColumnMinMax=function(e){var t={min:0,max:0};if(e&&e.data.length>0){t.max=Math.max.apply(Math,e.data);t.min=Math.min.apply(Math,e.data);if(isNaN(t.max)||isNaN(t.min)){t=Number.NaN}}return t};p.renderSlider=function(s,e){var t=s.label?s.label:s.column,n=g("<div/>").addClass("form-control"),o=g("<div/>").addClass("comment ").css("margin-top",5),i=g("<label/>").text(t).addClass("control-label"),r=p.renderFilterDiv(s,e).append(i).append(n).append(o),a={};if(s.style)n.attr("style",s.style);if(!e)f.append(r);n[0].slide=null;var l=function(e){var t=e?e.min:parseFloat(s.min),i=e?e.max:parseFloat(s.max);if(!s.orgMin){s.orgMin=[]}s.orgMin.push(t);if(!s.orgMax){s.orgMax=[]}s.orgMax.push(i);o.text("Min: "+t+" - Max: "+i);s.component=n.slider({range:true,min:s.orgMin[0],max:s.orgMax[0],step:parseFloat(s.step),values:[t,i],slide:function(e,t){var i=t.value;g(this).tooltip("destroy");g(this).attr({"data-toggle":"tooltip",title:i,"data-trigger":"manual"});g(this).tooltip("show")},stop:function(e,t){var i=parseFloat(t.values[0]),n=parseFloat(t.values[1]),r=s.orgMin[s.orgMin.length-1],a=s.orgMax[s.orgMax.length-1];p.apply(s.column,[i,n],{itemId:s.id,between:true,preMin:r,preMax:a},e);o.text("Min: "+i+" - Max: "+n);g(this).tooltip("destroy")}})};if(s.autofetch){p.toggleLoader(s.id,"show",r);if(s.dataCondition){a={where:s.dataCondition}}giscloud.layers.attributeOps.distinct(h.layer_id,s.column,a).then(g.proxy(p.getColumnMinMax,this)).fail(function(){p.toggleLoader(s.id,"hide");l()}).fail(g.proxy(p.failHandler,this)).done(function(e){p.toggleLoader(s.id,"hide");if(!g.isPlainObject(e)){o.append("<p class='text-danger'><b>Error:</b></br>"+"Slider filter defined column is '"+s.column+"' which values are not <b>Number</b>.</p>");return}l(e);if(s.forceMin){n.slider("option","values",[s.forceMin,s.forceMax]);o.text(s.forceMin+" - "+s.forceMax)}})}else{l()}return r};p.wrapNull=function(e){return g.map(e,function(e){if(!g.isPlainObject(e)){e={value:e,label:e}}if(e["label"]===null){e["label"]="(null)";e["value"]="null"}return e})};p.wrapWhiteSpace=function(e){return g.map(e,function(e){if(!g.isPlainObject(e)){e={value:e,label:e}}if(g.trim(e["label"])===""){e["label"]="(Empty string)"}return e})};p.getDropdownValues=function(e){e.data=p.wrapNull(e.data);e.data=p.wrapWhiteSpace(e.data);var t=g.map(e.data,function(e){return g("<option/>",{value:e["value"],html:e["label"]})});return t};p.toggleLoader=function(e,t,i){var n=!s.mdc||!s.cordova,r=g("[loader-item-id='"+e+"']"),a=f.find("div.loader").filter(function(e,t){return g(t).closest(".gc-filter-features-number").length===0});if(r.length===0){if(g("[item-id='"+e+"']").length>0){r=g("[item-id='"+e+"']").after(g("<div>",{"loader-item-id":e}).hide())}else if(i){r=g("<div>",{"loader-item-id":e}).hide();i.after(r)}}if(t=="show"){if(a.length===0){p.triggerEvent(p.EVENTS[2],p)}r.show();if(g("[item-id='"+e+"']").length>0){g("[item-id='"+e+"']").hide()}else if(i){i.eq(0).hide()}n&&r.loader("show")}else{if(g("[item-id='"+e+"']").length>0){g("[item-id='"+e+"']").show()}else if(i){i.eq(0).show()}n&&r.loader("hide");if(f.find("div.loader").length===0){p.triggerEvent(p.EVENTS[3],p)}}};p.renderDropdown=function(t,e){var i=t.label?t.label:t.column,n=g("<select/>").addClass("form-control  selectpicker dropdown-filter"),r=g("<label/>").text(i).addClass("control-label"),a=p.renderFilterDiv(t,e).append(r).append(n),s={},o=false,l,c,u,d;d=function(e){u=g(e.target).val();if(!g.isArray(u)){u=[u]}u=g.map(u,function(e){if(typeof e==="string"&&e.toLowerCase()==="null"){return[null]}else{return e}});if(u.indexOf("__gc_no_filter")>-1){u=[];n.selectpicker("deselectAll").parent(".dropdown-filter").removeClass("open");p.removeFilter(t.column,e)}else if(l&&l.prop("checked")){u.push(t.null_value)}if(u.length===1&&u[0]===null){u=null}if(u===null&&g(e.currentTarget).find("option:selected").text()==="(null)"){u=["(null)"]}p.apply(t.column,u,{insideOperator:"OR",itemId:t.id,distinct:true},e)};t.component=n;if(t.multiselect){g(n).attr("multiple",true)}g(n).attr("title",i);g(n).selectpicker({title:i,style:"filter form-control btn-default"}).on("change",d);a.find("button.dropdown-toggle.filter").attr("style",t.style);if(!t.autofetch){c=g.map(t.items,function(e){if(e.no_filter){o=true}if(e.value!==null){return g("<option/>",{value:e.no_filter?"__gc_no_filter":e.value,html:e.label||e.value,class:e.no_filter?"gc-clear-filter":null})}});if(t.no_filter&&o===false){c.unshift(g("<option/>",{value:"__gc_no_filter",html:t.no_filter,class:"gc-clear-filter"}))}if(c){n.append(c)}g(n).selectpicker("refresh");a.find(".bootstrap-select.dropdown-filter").attr("style",t.style)}else{p.toggleLoader(t.id,"show",a);g.extend(s,{order_by:t.column+":ASC"});if(t.dataCondition){g.extend(s,{where:t.dataCondition})}giscloud.layers.attributeOps.distinct(h.layer_id,t.column,s).then(g.proxy(p.getDropdownValues,this)).fail(function(){p.toggleLoader(t.id,"hide")}).fail(g.proxy(p.failHandler,this)).done(function(e){if(t.no_filter){e.unshift(g("<option/>",{value:"__gc_no_filter",html:t.no_filter,class:"gc-clear-filter"}))}n.append(e);n.selectpicker("refresh");g.map(a.find(".dropdown-filter .dropdown-menu.open span.text"),function(e){g(e).closest("li").attr("title",g(e).text())});a.find(".bootstrap-select.dropdown-filter").attr("style",t.style);if(t.value){if(!g.isArray(t.value)){t.value=[t.value]}g.map(t.value,function(e){if(n.find("option[value='"+e+"']").length===0){n.append(g("<option/>",{html:e,value:e}))}});n.selectpicker("refresh");n.selectpicker("val",t.value)}p.toggleLoader(t.id,"hide")})}if(t.null_value){l=p.renderNullCheckbox(t,a,d)}if(!e){f.append(a)}return a};p.renderDateTime=function(i,e){var t=i.label?i.label:i.column,n,r=g("<label/>").text(t).addClass("control-label"),a=p.renderFilterDiv(i,e).append(r),s={},o=false,l,c,u,d;n='<div class="input-group date" >';n+='  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span></span>';n+='  <input type="text" maxlength="10" class="form-control" />';n+="</div>";n=g(n);a.append(n);d=function(e){var t=e.date.toDate();u=[t];p.apply(i.column,u,{itemId:i.id,operator:i.operator,datetime:true},e)};if(!e){f.append(a)}n.datetimepicker({pickTime:false,format:"DD/MM/YYYY"}).on("dp.change",d);return a};p.renderMinMax=function(r,e){var t=r.label?r.label:r.column,a=g("<div/>").addClass("comment ").css("margin-top",5),i=g("<label/>").text(t).addClass("control-label"),s=g("<input type='text' />").addClass("gc-filter-spinner").addClass("form-control").val(r.value).hide(),n=p.renderFilterDiv(r,e).append(i).append(s).append(a),o={};if(r.style)s.attr("style",r.style);if(!e)f.append(n);s.attr("data-parsley-type","number");s.attr("data-parsley-errors-container","[item-id='"+r.id+"']");var l=function(e){var t=s.parsley().validate(),i=parseFloat(s.val()),n=parseFloat(s.attr("max"));if(t!==true){s.parent(".ui-spinner").find(".ui-spinner-button").addClass("error");return}a.text("Min : "+i+" - Max: "+n);p.apply(r.column,[i,n],{itemId:r.id,between:true},e)};var c=function(e){var t=e?e.min:parseFloat(r.min),i=e?e.max:parseFloat(r.max);r.component=s.spinner({min:t,max:i,stop:function(e){clearTimeout(g.data(s,"timer"));var t=setTimeout(l,500,e);s.data("timer",t)}});if(r.forceMin&&r.forceMin>=t){s.val(r.forceMin).show()}else{s.val(e?e.min:r.min).show()}s.attr("min",t).attr("max",i);a.text("Min: "+t+" - Max: "+i);s.parent(".ui-spinner").addClass("filter-min-max")};if(r.dataCondition){o={where:r.dataCondition}}if(r.autofetch){p.toggleLoader(r.id,"show",n);giscloud.layers.attributeOps.distinct(h.layer_id,r.column,o).then(g.proxy(p.getColumnMinMax,this)).fail(function(){c();p.toggleLoader(r.id,"hide")}).fail(g.proxy(p.failHandler,this)).done(function(e){if(!g.isPlainObject(e)){n.empty().append("<p class='text-danger'><b>Error:</b></br>"+"Min/max filter defined column is '"+r.column+"' which values are not <b>Number</b>.</p>");return}c(e);p.toggleLoader(r.id,"hide")})}else{c()}return n};p.renderFeaturesNumber=function(e,t){var i=g("<div/>").addClass("gc-filter-features-number");e.id=e.id||giscloud.ui.id();var n=g("<div/>").addClass("gc-filter-item").attr("item-id",e.id).css("height","20px").append(i);if(e.style){i.attr("style",e.style)}e.component=i;f.append(n);p.getNumOfFeatures();return n};p.getNumOfFeatures=function(e,t){var i=!!(s.mdc&&s.cordova),n=f.find(".gc-filter-features-number"),r=p.options.gcdatagrid.options.where;if(n.length===0){return}if(!i&&n.find(".loader").length===0){n.empty().loader("show").height("20px")}giscloud.features.byLayer(h.layer_id,{perPage:1,where:r}).done(function(e,t){!i&&n.loader("hide");n.text((h.results_num_label?h.results_num_label:"Results: ")+t)})};p.renderRange=function(r,e){var t=r.label?r.label:r.column,a,s=g("<input type='text' />").addClass("form-control gc-filter-spinner").hide(),o=g("<input type='text' />").addClass("form-control gc-filter-spinner").hide(),i=g("<label/>").text(t).addClass("control-label"),n=p.renderFilterDiv(r,e).append(i).append(s).append(o),l={};if(r.style){s.attr("style",r.style);o.attr("style",r.style)}s.attr("data-parsley-type","number");o.attr("data-parsley-type","number");s.attr("data-parsley-errors-container","[item-id='"+r.id+"']");o.attr("data-parsley-errors-container","[item-id='"+r.id+"']");r.component=[];if(!e)f.append(n);if(r.null_value){a=p.renderNullCheckbox(r,n,function(e){var t=[s.val()*1,o.val()*1];if(a.prop("checked"))t.push(r.null_value);p.apply(r.column,t,{itemId:r.id},e)});a.parent("label").show();r.component.push(a)}var c=function(e){var t=s.parsley().validate(),i=o.parsley().validate(),n=[s.val()*1,o.val()*1];if(t!==true||i!==true){if(t!==true){s.parent(".ui-spinner").find(".ui-spinner-button").addClass("error")}if(i!==true){o.parent(".ui-spinner").find(".ui-spinner-button").addClass("error")}return}else{s.parent(".ui-spinner").find(".ui-spinner-button").removeClass("error");o.parent(".ui-spinner").find(".ui-spinner-button").addClass("error")}if(a&&a.prop("checked")){n.push(r.null_value)}p.apply(r.column,n,{itemId:r.id,between:true},e)};var u=function(e){var t=e?e.min:r.min,i=e?e.max:r.max;r.component.push(s.spinner({min:t,max:i,step:r.step?r.step:1,stop:function(e){clearTimeout(g.data(s,"timer"));var t=setTimeout(c,500,e);s.data("timer",t)}}));r.component.push(o.spinner({min:t,max:i,step:r.step?r.step:1,stop:function(e){clearTimeout(g.data(o,"timer"));var t=setTimeout(c,500,e);o.data("timer",t)}}));o.parent(".ui-spinner").addClass("pull-right");if(r.forceMin){s.val(r.forceMin).show()}else{s.val(e?e.min:r.min).show()}if(r.forceMax){o.val(r.forceMax).show()}else{o.val(e?e.max:r.max).show()}if(a){if(r.includeNull){a.prop("checked",r.includeNull).parent("label").show()}else{a.parent("label").show()}}s.attr("min",t).attr("max",i);o.attr("min",t).attr("max",i)};if(r.dataCondition){l={where:r.dataCondition}}if(r.autofetch){p.toggleLoader(r.id,"show",n);giscloud.layers.attributeOps.distinct(h.layer_id,r.column,l).then(g.proxy(p.getColumnMinMax,this)).fail(function(){p.toggleLoader(r.id,"hide");u()}).fail(g.proxy(p.failHandler,this)).done(function(e){p.toggleLoader(r.id,"hide");if(!g.isPlainObject(e)){n.empty().append("<p class='text-danger'><b>Error:</b></br>"+"Range filter defined column is '"+r.column+"' which values are not <b>Number</b>.</p>");return}u(e)})}else{u()}return n};p.renderNullCheckbox=function(e,t,i){var n=g("<label/>").text(" Include null values").appendTo(g("<div/>").appendTo(t));return g("<input type='checkbox' />").val(e.null_value).prependTo(n).prop("checked",true).change(i)};p.renderFilterDiv=function(e,t){var i;e.id=e.id||giscloud.ui.id();if(t){i=f.find("[item-id='"+e.id+"']")}else{i=g("<div/>").attr("item-id",e.id).addClass("gc-filter-item").attr("data-column",e.column)}return i.empty().removeClass("active")};p.getActiveFilters=function(){return f.find(".gc-filter-item.active")};p.init()};giscloud.ui.filters.getFilters=function(){return i};giscloud.ui.filters.getFilterByCode=function(t){return g.map(i,function(e){if(e.code===t)return e})[0]}})(window,giscloud.exposeJQuery(),giscloud.common());(function(e,b,t,w){"use strict";giscloud.ui.Panel=function(a){var s=this,o,l,c,u,d,t,h,e,f,p,i=a.push?true:false,g=a.resizeble,m={alsoResize:null,maxHeight:null,maxWidth:null,minHeight:null,minWidth:null},u=a.container&&b(a.container).length===1?b(a.container):b("body"),v=a.width?a.width:240,y=a.height?a.height:140,_=a.size?a.size:240,n={right:"left",left:"right",top:"bottom",bottom:"top"};s.render=function(){if(a.resizableOpt){b.extend(m,a.resizableOpt)}f=b("<div>",{class:"gc_panel-root-conteiner"});u.append(f);var e=a.id?a.id:"gc_panel"+Math.round(Math.random()*1e5);o=a.position=="floating"?"floating":a.position=="right"||a.position=="left"?"vertical":"horizontal";l=b("<nav/>").addClass("gc-panel gc-panel-"+o).addClass(a.position).attr("id",e).appendTo(f);if(o=="vertical"||o=="horizontal"){s.size(_)}else{s.size(v,y)}u.addClass("gc-panel-wrapper "+a.position);c=b("<div/>").addClass("gc-panel-content").appendTo(l);if(giscloud.app&&giscloud.app.config.panels&&giscloud.app.config.panels.length>0&&s.getPanelEl()[0].id!=="gc-panel-right"){c.css("height",y-70+"px")}if(a.panelBg){var t=b("<div/>").addClass("gc-panel-bg").appendTo(l);if(a.transparent)t.addClass("transparent")}if(a.titleHtml){p=b(a.titleHtml);l.prepend(p)}else if(a.title){p=b("<h3/>").text(a.title).addClass("gc-panel-title");l.prepend(p)}if(a.css)l.css(a.css);if(a.content)c.html(a.content);if(a.style_content)c.attr("style",a.style_content);if(a.url){c.load(a.url,a.contentLoad?a.contentLoad:null,function(){l.trigger("load")})}if(a.draggable){l.draggable({handle:p||false}).addClass("draggable")}if(a.resizeble){var i=null;if(a.position=="right"&&o=="vertical"){i="w"}else if(a.position=="left"&&o=="vertical"){i="e"}else if(a.position=="top"&&o=="horizontal"){i="n"}else if(a.position=="bottom"&&o=="horizontal"){i="s"}b.extend(m,{handles:i,start:s.resizePanel,stop:s.resizePanel,resize:s.resizePanel,animateDuration:"fast"});u.resizable(m);var n=b("<div/>",{class:"arrow-"+i+" fa fa-ellipsis-v"});b("div.ui-resizable-"+i).append(n);n.on("click",s.collapseExpand)}if(a.closeButton===w||a.closeButton){d=b("<button/>").attr("type","button").addClass("close gc-panel-close").text("x").click(function(){s.close()}).appendTo(l)}if(a.drawer){h=b("<div/>").addClass("gc-panel-drawer").click(function(){s.toggle()}).appendTo(l)}if(u.prop("tagName")!=="BODY"){l.addClass("gc-panel-container");if(g){if(o=="vertical"){var r=l.outerWidth(true);u.css("width",r);s.size(r)}else{var i=l.outerHeight(true);u.css("height",i);s.size(i)}}if(p&&p.filter('[style*="width"]')>0)p.width(u.outerWidth(true))}if(a.open)s.open();else s.close()};s.collapseExpand=function(){var e,t;e=u.isCollapsed?u.orgWidth:0;t=u.isCollapsed?u.orgHeight:0;if(a.position=="left"||a.position=="right"){u.animate({width:e},{progress:s.alsoResizeTrigger},500)}else{u.animate({height:t},{progress:s.alsoResizeTrigger},500)}if(l.is(":visible")==true){b.extend(u,{orgWidth:u.width(),orgHeight:u.height()});l.hide();b.extend(u,{isCollapsed:true});u.trigger("collapse",{isCollapsed:true})}else{b.extend(u,{isCollapsed:false});u.trigger("collapse",{isCollapsed:false});l.show()}if(p&&p.filter('[style*="width"]')>0)p.width(u.outerWidth(true))};s.alsoResizeTrigger=function(){if(m.alsoResize instanceof Array){b.each(m.alsoResize,function(e,t){b(t).trigger("resize")})}else if(m.alsoResize){b(m.alsoResize).trigger("resize")}};s.resizePanel=function(e,t){var i;if(!l.is(":visible")){l.show()}if(o=="vertical"){i=b(t.element).width()}else{i=b(t.element).height()}if(a.position==="right"){t.position.left=0}s.size(i)};s.getPanelEl=function(){return l};s.getWidth=function(){return l.width()};s.getHeight=function(){return l.height()};s.getMargin=function(e){return parseInt(l.css("margin-"+e).replace("px",""))};s.open=s.show=function(e){if(e){s.size(e)}if(o=="vertical"||o=="horizontal"){if(i){u.css(n[a.position],-_)}if(u.prop("tagName")==="BODY"){l.css(a.position,0)}}else{l.show()}l.trigger("open");t=true;if(d)d.show()};s.empty=function(){c.empty()};s.toggle=function(){if(!t)s.open();else s.close()};s.size=function(e,t){_=e;if(o=="vertical"){l.css("width",_)}else if(o=="horizontal"){l.css("height",_)}else if(o=="floating"){l.css("width",e);l.css("height",t)}if(p)p.width(u.outerWidth(true))};s.content=function(){return c};s.close=s.hide=function(){if(i){u.css(n[a.position],0)}if(o=="vertical")l.css(a.position,typeof _=="string"&&_.indexOf("%")>0?-1*l.width():-_);else if(o=="horizontal")l.css(a.position,typeof _=="string"&&_.indexOf("%")>0?-1*l.height():-_);else l.hide();t=false;l.trigger("close");if(d)d.hide()};s.render()}})(window,giscloud.exposeJQuery(),giscloud.common());(function(c,e){"use strict";if(c==null||c.fn==null||c.fn.jquery==null){throw"The filterBuilder requires jQuery to function."}var n={filterMaskUrl:"/filterform",viewer:null,layer:null,filterConfig:null,panelContent:null,i18n:{applyOk:gclang.config_successfullyAppliedFilterItem,ErrorOccurred:gclang.AnErrorOccurred,promptRemoveFilter:gclang.prompt_sureRemoveFilter},internalColumn:["__created","__modified","__owner","__id"]},s=function e(t){return c.inArray(t,this.options.internalColumn)>-1},a=function e(t){var i;if(t&&t.responseText){i=JSON.parse(t.responseText);if(i.nested&&i.nested.msg){i=i.nested.msg}else{i=i.msg}}r.apply(this,["layer '"+this.options.layer.name+"' : "+i]);throw t&&t.responseText||this.options.i18n.ErrorOccurred},l=function e(){giscloud.ui.alert.green().show(this.options.i18n.applyOk,5e3)},r=function e(t){giscloud.ui.alert.red().show(t||this.options.i18n.ErrorOccurred,5e3)},i=function e(t,i){var n=t+"."+this.eventNamespace;c(this).trigger(n,i);this.container.trigger(n,i)},o=function e(t){var i=this.container.find(".filter-config:visible input.typeahead"),n=c.map(t.data,function(e){if(e!==null){return e+""}});c.map(i,c.proxy(function(t){if(c(t).data("typeahead")!==undefined){c(t).typeahead("destroy")}c(t).typeahead({hint:true,highlight:true,minLength:0,source:n,updater:c.proxy(function(e){c(t).parents(".dropdown-items").find(".dropdown-item-label").val(e);return e},this)})},this))},u=function e(t,i){var n=this.container.find(".filter-config .filter-cmp:visible"),r,a;if(c.isEmptyObject(this.layerAtrributes)){this.layerAtrributes=t}if(this.layerAtrributes&&c.isArray(this.layerAtrributes.attributes)){this.container.find(".filter-config .filter-cmp .fa-spinner").hide();this.container.find(".bootstrap-select.layer-attribute").show();this.container.find(".layer-attribute.selectpicker").find("option").remove();c.map(this.layerAtrributes.attributes,c.proxy(function(e){if(i!==undefined&&c.inArray(e.type,i)===-1){return}if(s.apply(this,[e.name])){return}this.container.find(".layer-attribute.selectpicker").append(c("<option>",{text:e.name,val:e.name}))},this));this.container.find(".filter-cmp:visible .layer-attribute.selectpicker").selectpicker("refresh");if(n.length>0&&this.container.find(".filter-cmp:visible .layer-attribute.selectpicker").length>0){r=n.attr("item-id");a=p.apply(this,[r]);if(a&&a.column){this.container.find(".filter-cmp:visible .layer-attribute.selectpicker").selectpicker("val",a.column)}}}},d=function e(t){var a=this.container.find(".filter-config .filter-cmp."+t.type.toLowerCase()),i=a.find("[data]"),n=giscloud.ui.filters.getFilterByCode(t.type),s=[];if(a.find("[subitem-property]").length>1){c.map(a.find("[subitem-property]"),function(e){if(a.find("[subitem-property]").length>1){c(e).remove()}})}u.apply(this,[this.layerAtrributes,n.type]);c.map(i,function(e){s=t[c(e).attr("data")];if(c(e).is(":checkbox")){if(s){c(e).prop("checked",true)}else{c(e).prop("checked",false)}}if(c(e).is(":radio")){if(s==c(e).val()){c(e).prop("checked",true)}}else if(c(e).attr("subitem-property")){var n=c(e),r=t[n.attr("data")];c.map(r||[],c.proxy(function(e,t){var i=n.clone();i.find(".remove-item").show();if(t===r.length-1){i.find(".add-item").show()}else{i.find(".add-item").hide()}if(e.no_filter){a.find("[data='no_filter']").val(e.label)}else{c.map(e,c.proxy(function(e,t){i.find("[data="+t+"]").val(e)},this));n.parents(".dropdown-items-wrapper").append(i)}},this));if(s&&s.length>0){n.remove()}}else{if(c(e).hasClass("selectpicker")){if(!s){c(e).selectpicker("refresh")}else{c(e).selectpicker("val",s)}}else{c(e).val(s)}}});x.apply(this);if(this.container.find(".layer-attribute.selectpicker").length>0){v.apply(this,[this.container.find(".filter-cmp:visible .layer-attribute.selectpicker")])}},h=function e(t){var r=this.container.find(".existing-filters .list-group"),a=this.container.find(".existing-filters .list-group-item.tmp");this.container.find(".existing-filters .list-group-item:not(.tmp)").remove();if(this.options.filterConfig&&!c.isEmptyObject(this.options.filterConfig)){c.map(this.options.filterConfig.items,c.proxy(function(e){var t=a.clone(),i=giscloud.ui.filters.getFilterByCode(e.type),n=i?i.label:e.type;t.append(n);if(e.label||e.column){t.append(c("<span>",{text:" ("+(e.label||e.column)+")",class:"list-filter-label"}))}t.attr("item-id",e.id);t.removeClass("tmp");t.on("click",c.proxy(function(){r.find(".list-group-item.active").removeClass("active");t.addClass("active");f.apply(this,[["hideAll","show"],e.type.toLowerCase(),e.id]);d.apply(this,[e])},this));r.append(t);t.show()},this))}if(t){this.container.find(".existing-filters .list-group-item[item-id='"+t+"']").addClass("active")}},f=function e(t,i,n){var r;if(!c.isArray(t)){t=[t]}if(c.inArray("hideAll",t)>-1){this.container.find(".filter-config").hide();this.container.find(".filter-config .filter-cmp").hide()}if(c.inArray("hide",t)>-1){this.container.find(".filter-config").hide();this.container.find(".filter-config .filter-cmp:not(."+i+")").hide()}if(c.inArray("show",t)>-1){this.container.find(".filter-config").show();this.container.find(".filter-config .filter-cmp."+i).show();r=this.container.find(".filter-config .filter-cmp."+i).parsley();if(r){r.reset()}if(n){this.container.find(".filter-config .filter-cmp."+i).attr("item-id",n)}}},p=function e(t){if(!this.options.filterConfig){return}return c.grep(this.options.filterConfig.items,c.proxy(function(e){return e.id==t}))[0]},g=function e(t){var i=this.container.find(".filter-config .filter-cmp:visible"),n=i.attr("item-id");if(!n){n=c(t.target).parents(".list-group-item").attr("item-id")}giscloud.ui.confirm(this.options.i18n.promptRemoveFilter,{overlay:true}).yes(c.proxy(function(){this.options.filterConfig.items=c.grep(this.options.filterConfig.items,c.proxy(function(e){return e.id!=n}));f.apply(this,["hideAll"]);h.apply(this)},this))},m=function e(){var t=this.container.find(".filter-config .filter-cmp:visible"),i=t.data("Parsley"),n=t.attr("item-id"),o=p.apply(this,[n])||{},r;if(!i.validate()){return}else{i.reset()}c.map(o,function(e,t){if(c.isArray(e)){o[t]=[]}});c.map(t.find("[data]").filter(":not([subitem])"),function(e){var t=c(e).val(),i=c(e),a=i.attr("subitem-property"),s=i.attr("type");if(c(e).is(":checkbox")){if(c(e).is(":checked")){o[c(e).attr("data")]=true}else{o[c(e).attr("data")]=false}}else if(c(e).is(":radio")){if(c(e).is(":checked")){o[c(e).attr("data")]=t}}else if(c(e).attr("subitem-property")){c.map(i,c.proxy(function(e){var t=c(e).find("[data]"),i=c(e).find(".wrapper").attr("subtype"),n,r;if(i==="array"){r.push(c(e).find("[data]").val())}else if(i==="object"){r={};c.map(t,c.proxy(function(e){r[c(e).attr("data")]=c(e).val()},this))}else{o[a]=n}if(s==="array"){if(!o[a]){o[a]=[]}o[a].push(r)}else{o[a]=r}},this))}else{o[c(e).attr("data")]=t}});if(o.autofetch===true){t.find(".toggle-autofetch").find("[data]").map(function(){if(o.items){delete o.items}else if(o.min!==undefined||o.max!==undefined){delete o.min;delete o.max}})}r=this.container.find(".existing-filters .list-group-item[item-id='"+n+"']");if(r.find("span.list-filter-label").length===0){r.append(c("<span>",{class:"list-filter-label"}))}if(o.label){this.container.find(".existing-filters .list-group-item[item-id='"+n+"'] span.list-filter-label").text(" ("+o.label+")")}else if(o.column){this.container.find(".existing-filters .list-group-item[item-id='"+n+"'] span.list-filter-label").text(" ("+o.column+")")}l.apply(this)},v=function e(t){var i=this.container.find(".filter-config .filter-cmp:visible"),n=p.apply(this,[i.attr("item-id")])||{},r=t.target?c(t.target).val():t.val();if(r&&this.container.find(".filter-cmp:visible .filter-autofetch").is(":checked")){giscloud.layers.attributeOps.distinct(this.options.layer.id,r,{}).done(c.proxy(o,this)).fail(c.proxy(a,this))}if(r&&this.container.find(".filter-cmp:visible input.filter-label").length>0&&(n&&n.label===null)){this.container.find(".filter-cmp:visible input.filter-label").val(r)}},y=function e(t){var i=c(t.target).val(),n=giscloud.ui.id(),r=this.container.find(".filter-config .filter-cmp:visible"),a=r.data("Parsley"),s=this.options.filterConfig?this.options.filterConfig.items:[],o=this.container.find(".filter-config .filter-cmp."+i).find("[data]").filter(":not([subitem])"),l={type:i.toUpperCase(),id:n};this.container.find(".filter-attribute.selectpicker").selectpicker("refresh").selectpicker("deselectAll");if(r.length>0&&!a.validate()){return}c.map(o,function(e){if(c(e).attr("type")==="array"){l[c(e).attr("data")]=[]}else if(c(e).attr("type")==="object"){l[c(e).attr("data")]={}}else{l[c(e).attr("data")]=null}});if(!this.options.filterConfig){this.options.filterConfig={layer_id:this.options.layer.id,items:[l]}}else{s.push(l)}h.apply(this,[n]);f.apply(this,[["hideAll","show"],i,n]);d.apply(this,[l]);this.container.find(".filter-cmp:visible .layer-attribute.selectpicker").selectpicker("refresh").selectpicker("deselectAll")},_=function e(){var t=this.container.find(".filter-config .filter-cmp:visible"),i=t.attr("item-id"),n=p.apply(this,[i]);h.apply(this,[i]);d.apply(this,[n])},b=function e(t){var i=c(t.target).parents(".dropdown-items").clone();c(t.target).parents(".dropdown-items").find(".remove-item").show();c(t.target).parents(".dropdown-items").find(".add-item").hide();i.find("input").val("");this.container.find(".dropdown-items-wrapper").append(i);v.apply(this,[this.container.find(".filter-cmp:visible .layer-attribute.selectpicker")])},w=function e(){var t=this.container.find(".filter-cmp:visible .filter-relevant-values");if(!t.is(":visible")){t.prop("checked",false)}},x=function e(t){var i,n;if(this.container.find(".filter-cmp:visible .filter-autofetch").length===0){return}if(t){i=c(t.target).parents(".filter-cmp:visible").find(".toggle-autofetch");n=c(t.target).parents(".filter-cmp:visible").find(".relevant-value-wrap");if(i.is(":visible")){i.hide();n.show()}else{i.show();n.hide()}}else{if(this.container.find(".filter-cmp:visible .filter-autofetch").length>0&&this.container.find(".filter-cmp:visible .filter-autofetch").is(":checked")){this.container.find(".filter-cmp:visible .relevant-value-wrap").show();this.container.find(".filter-cmp:visible .toggle-autofetch").hide()}else{this.container.find(".filter-cmp:visible .relevant-value-wrap").hide();this.container.find(".filter-cmp:visible .toggle-autofetch").show()}}w.apply(this)},C=function e(t){var i=c(t.target).parents(".filter-cmp");if(i.find(".dropdown-items").length===1){i.find(".dropdown-items input").val("")}else{c(t.target).parents(".dropdown-items").remove()}i.find(".dropdown-items").last().find(".add-item").show()},T=function e(){this.container.find(".bootstrap-select.layer-attribute").hide().after("<i class='fa-li fa fa-spinner fa-spin'></i>");giscloud.layers.attributeOps.info(this.options.layer.id).done(c.proxy(u,this)).fail(c.proxy(function(){this.container.find(".bootstrap-select.layer-attribute").show();this.container.find(".filter-config .filter-cmp .fa-spinner").hide()},this)).fail(c.proxy(a,this))},k=function e(){var t=giscloud.ui.filters.getFilters(),i;this.container.on("change",".filter-attribute.selectpicker",c.proxy(y,this));this.container.on("change",".layer-attribute.selectpicker ",c.proxy(v,this));this.container.on("click",".add-Item-wrapper .remove-item",c.proxy(C,this));this.container.on("click",".add-Item-wrapper .add-item",c.proxy(b,this));this.container.on("click",".apply-filter",c.proxy(m,this));this.container.on("click",".remove-filter",c.proxy(g,this));this.container.on("click",".discard-filter",c.proxy(_,this));this.container.on("click",".filter-autofetch",c.proxy(x,this));c.each(t,c.proxy(function(e){i=t[e].label;this.container.find(".filter-attribute.selectpicker").append(c("<option>",{text:i,value:e}))},this));this.container.find(".filter-attribute.selectpicker").selectpicker("refresh").selectpicker("deselectAll");c.map(this.container.find(".filter-config .filter-cmp input.filter-min, .filter-config .filter-cmp input.filter-max"),c.proxy(function(e){var t=c(e).parents(".filter-cmp").attr("class"),i;t=t.replace("filter-cmp","");if(c(e).parents(".filter-cmp").find(".filter-autofetch").length>0){i="#"+this.options.panelContent.attr("id")+" ."+t+" .filter-autofetch , "+"#"+this.options.panelContent.attr("id")+" ."+t+" .";if(c(e).hasClass("filter-max")){c(e).attr("data-parsley-fgt",i+"filter-min")}else if(c(e).hasClass("filter-min")){c(e).attr("data-parsley-flt",i+"filter-max")}}},this));c.map(this.container.find(".filter-config .filter-cmp"),function(e){c(e).parsley()});h.apply(this);this.container.find(".selectpicker").selectpicker();if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){this.container.find(".selectpicker").selectpicker("mobile")}T.apply(this)},M=function e(){if(!this.options.filterConfig||c.isEmptyObject(this.options.filterConfig)){return}c.map(this.options.filterConfig.items,function(e){e.id=giscloud.ui.id()})},S=function e(){this.container.load(this.options.filterMaskUrl,c.proxy(function(e,t){i.apply(this,[this.EVENTS[0],{status:t,object:this}]);if(t==="success"){k.apply(this)}else{throw"form didn't load properly"}},this))};giscloud.ui.FilterBuilder=function(t,i){this.eventNamespace="gc-filter-builder";this.EVENTS=["form-loaded"];this.options={};this.layerAtrributes={};this.container=null;this.initialize=function e(){if(c.isPlainObject(t)){this.options=c.extend(true,{},n,{viewer:giscloud.ui.map||null},t)}else{this.options=i||{};this.options.selector=t;this.options=c.extend(true,{},n,{viewer:giscloud.ui.map||null},i)}if(c.isPlainObject(t)){this.container=t}else{this.container=c(t)}M.apply(this);if(!this.options.viewer){throw"giscloud.Viewer object is required."}if(!this.options.layer){throw"giscloud.viewerLayer object is required."}S.apply(this)};return this.initialize()};giscloud.ui.FilterBuilder.prototype={on:function e(){this.container.on.apply(this.container,Array.prototype.slice.apply(arguments));return this},off:function e(){this.container.off.apply(this.container,Array.prototype.slice.apply(arguments));return this},bind:function e(){return this.on.apply(this,Array.prototype.slice.apply(arguments))},unbind:function e(){return this.off.apply(this,Array.prototype.slice.apply(arguments))},discardFilterForm:function e(){_.apply(this);return this},getFilterConfig:function e(){var t=jQuery.extend(true,{},this.options.filterConfig),i,n,r;if(this.options.filterConfig){r=c.map(t.items,c.proxy(function(e){n=this.container.find(".filter-cmp."+e.type.toLowerCase());i=n.parsley();if(!i){return}n.find(".layer-attribute.selectpicker").selectpicker("refresh");f.apply(this,[["hideAll","show"],e.type.toLowerCase(),e.id]);d.apply(this,[e]);if(n.length>0&&!i.validate()){return e}f.apply(this,[["hide"],e.type.toLowerCase(),e.id])},this));if(r.length>0){this.container.find(".existing-filters .list-group").find(".list-group-item[item-id='"+r[0].id+"']").trigger("click");i=this.container.find(".filter-cmp."+r[0].type.toLowerCase()).parsley();i.validate();return false}}if(c.isEmptyObject(t)===false){c.map(t.items,function(e){delete e.id})}return t}}})(giscloud.exposeJQuery(),giscloud.common());(function(c,s){"use strict";if(c==null||c.fn==null||c.fn.jquery==null){throw"giscloud.ui.FilterBuilderManager: FilterBuilderManager requires jQuery to function."}var n={managerMaskUrl:"/filtermanager",maskWraperId:"GcFilterManager",viewer:null,fullWidth:true,containerId:"GcFilterBuilder",mode:"fullscreen",fileConfig:"app.json",filePath:"/apps/",triggerEventOnDoc:true,standalone:true,authorization:true,helpPointContent:gclang.filter_point_layer_info,i18n:{saveOk:gclang.Successfully_saved_,ErrorOccurred:gclang.AnErrorOccurred,modalTitle:gclang.filterManager},panelFilter:{id:"gc-panel-filter",title:gclang.filter,position:"floating",width:350,height:600,open:false,draggable:true,closeButton:true,filters:[],css:{top:"100px"}}},r=function e(t){l.apply(this,[t]);throw t||this.options.i18n.ErrorOccurred},o=function e(){giscloud.ui.alert.green().show(this.options.i18n.saveOk,5e3)},l=function e(t){giscloud.ui.alert.red().show(t||this.options.i18n.ErrorOccurred)},t=function e(t){this.save(true,t)},u=function e(t,i){var n=t+"."+this.eventNamespace;c(this).trigger(n,i);if(this.options.triggerEventOnDoc){c(document).trigger(n,i)}},i=function e(){if(this.options.mode==="fullscreen"){this.maskWraper.on("click",".close-mng,.forward-mng",c.proxy(this.close,this));this.maskWraper.on("click",".save-mng",c.proxy(this.save,this));this.maskWraper.on("click",".save-close-mng",c.proxy(t,this))}else if(this.modal!==null){this.modal.on("click",".close-mng",c.proxy(this.close,this));this.modal.on("click",".save-mng",c.proxy(this.save,this))}},a=function e(t){this.layers=c.grep(t,function(e){return c.inArray(e.type.toUpperCase(),["POINT","LINE","POLYGON","GEOMETRY"])!==-1})},d=function e(){c("#"+this.options.containerId).load(this.options.managerMaskUrl,c.proxy(function(e,t){u.apply(this,[this.EVENTS[0],{status:t,object:this}]);if(t==="success"){this.maskWraper=c("#"+this.options.maskWraperId);p.apply(this)}else{throw"giscloud.ui.FilterBuilderManager: form didn't load properly."}},this))},h=function e(){giscloud.layers.byMapId(this.options.viewer.mapId,{expand:"columns"}).fail(c.proxy(r,this)).done(c.proxy(a,this)).done(c.proxy(d,this))},f=function e(t){if(!this.filterConfig){return{}}return c.grep(this.filterConfig,function(e){if(e.layer_id==t){return e}})[0]},p=function e(){var s=this.classNamespace+giscloud.ui.id(),o,l;if(this.options.mode==="fullscreen"&&this.options.standalone===true){this.maskWraper.find("nav.manager-navbar").addClass("navbar-fixed-top")}else if(this.options.mode==="modal"){this.maskWraper.find("nav.manager-navbar").remove()}if(this.options.standalone===false){this.maskWraper.find("nav.manager-navbar").find(".save-mng, .save-close-mng").hide();this.maskWraper.find(".manager-contant").addClass("standalone-false")}else{this.maskWraper.find("nav.manager-navbar").find(".forward-mng").hide()}this.dom=c.extend(this.dom,{accordion:this.maskWraper.find(".filter-accordion").attr("id",s),panels:[]});o=this.dom.accordion.find(".filter-panel .panel-heading "),l=this.dom.accordion.find(".filter-panel .panel-collapse");c.each(this.layers,c.proxy(function(e,t){var i=o.clone(),n=l.clone(),r="head-"+t.id,a="panel-"+t.id;i.attr("id",r);i.attr("data-parent","#"+s);i.attr("href","#"+a);i.attr("aria-controls",a);i.find(".panel-title a").text(t.name);n.attr("id",a);n.attr("aria-labelledby",r);this.dom.accordion.find(".filter-panel").append(i);this.dom.accordion.find(".filter-panel").append(n);this.dom.panels.push({panelTitle:i,panelContent:n,layer:t});if(t.type.toUpperCase()=="POINT"){i.find(".panel-title").append(c("<i>",{class:"fa fa-info-circle pull-right filter-point-info"}).attr("data-toggle","popover").attr("data-placement","left").popover({html:true,container:this.maskWraper,content:this.options.helpPointContent}))}this.filterBuilders.push({component:new giscloud.ui.FilterBuilder(n.find(".filter-container"),{layer:t,viewer:this.options.viewer,filterConfig:f.apply(this,[t.id]),panelContent:n})})},this));i.apply(this);this.registerMinMaxVal(this);o.remove();l.remove()},g=function e(t){var i=[],n;if(this.options.standalone===true){this.fileConfig=c.parseJSON(t.content);n=c.grep(this.fileConfig.panels||[],c.proxy(function(e){return c.isArray(e.filters)||c.isPlainObject(e.filters)},this))[0]}else{n=this.panelFilter.filters;this.fileConfig.panels=[];this.fileConfig.panels.push(this.panelFilter)}if(!n){if(this.fileConfig&&!c.isArray(this.fileConfig.panels)){this.fileConfig.panels=this.fileConfig.panels?[this.fileConfig.panels]:[]}this.fileConfig.panels.push(this.options.panelFilter)}if(this.fileConfig.panels.length>0){c.map(this.fileConfig.panels,c.proxy(function(e){if(e.filters){this.filterPanel=e}else{return}if(c.isArray(e.filters)){n=c.map(e.filters,c.proxy(function(e){return e[this.options.viewer.mapId]},this))}else{n=e.filters[this.options.viewer.mapId]||[]}i=c.merge(i,n)},this))}if(i.length>0){this.filterConfig=i}h.apply(this)};giscloud.ui.FilterBuilderManager=function(i){this.eventNamespace="gc-filter-manager-builder";this.classNamespace="GcFilterMng";this.dom={panels:[]};this.filterPanel=null;this.filterBuilders=[];this.EVENTS=["form-loaded","form-save","form-close"];this.options={};this.layers=[];this.modal=null;this.relpath=null;this.fileConfig={};this.filterConfig=[];this.maskWraper=null;this.initialize=function e(){this.options=c.extend(true,{},n,{viewer:giscloud.ui.map||null},i);if(this.options.authorization===true&&fno.app_instance_owner_id!=giscloud.app.user.id()){alert(gclang.filterBuilderAuth||"You are not authorized for Filter builder.");return}if(!this.options.viewer||!this.options.viewer.mapId){throw"giscloud.ui.FilterBuilderManager: giscloud.Viewer object is required."}if(!this.options.filePath){throw"giscloud.ui.FilterBuilderManager: filePath is required."}if(!this.options.fileConfig){throw"giscloud.ui.FilterBuilderManager: fileConfig name is required."}if(this.options.filePath==="/apps/"&&giscloud.app.config&&giscloud.app.config.instanceId){this.relpath=this.options.filePath+"app"+giscloud.app.config.instanceId+"/"+this.options.fileConfig}if(this.options.standalone){this.options.viewer.loading.done(c.proxy(function(){giscloud.storage.fs.get(this.relpath).done(c.proxy(g,this)).fail(c.proxy(r,this))},this))}else{this.panelFilter=this.options.panelFilter;g.apply(this)}if(this.options.mode==="fullscreen"){giscloud.ui.fullScreen({id:this.options.containerId,class:"filter-builder-manager"});c("#"+this.options.containerId).append("<i class='fa fa-refresh fa-spin'>")}else if(this.options.mode==="modal"){var t={overlay:false,title:this.options.i18n.modalTitle,fid:"ModalFilterMng",phoneFullSc:true,dragable:true,content:"<div id='"+this.options.containerId+"' class='filter-builder-manager'></div>",buttons:[{html:"close",class:"close-mng"},{html:"Save",class:"save-mng btn-primary"}]};if(c(window).width()>767){t=c.extend(t,{width:"800px"})}this.modal=giscloud.ui.modal(t)}else{throw"giscloud.ui.FilterBuilderManager: opening mode is not defined properly."}};return this.initialize()};giscloud.ui.FilterBuilderManager.prototype={on:function e(){c(this).on(this,Array.prototype.slice.apply(arguments));return this},off:function e(){c(this).off(this,Array.prototype.slice.apply(arguments));return this},bind:function e(){return this.on.apply(this,Array.prototype.slice.apply(arguments))},unbind:function e(){return this.off.apply(this,Array.prototype.slice.apply(arguments))},close:function e(t){var i=this.options.viewer.mapId,n=this.applyFIltersFromBuilders(),r={},a=c(t.target).parent().hasClass("close-mng");if(this.options.standalone===false&&!a){if(n===false){return}else if(c.isArray(this.filterPanel.filters)){if(this.filterPanel.filters.length>0){c.map(this.filterPanel.filters,c.proxy(function(e){e[i]=this.filterConfig},this))}else{r[i]=this.filterConfig;this.filterPanel.filters.push(r)}}else{this.filterPanel.filters[i]=this.filterConfig}}u.apply(this,[this.EVENTS[2],{object:this,filterPanel:this.filterPanel}]);this.unregisterMinMaxVal();if(this.options.mode==="fullscreen"){formManager.closeFullpage(this.options.containerId)}else if(this.modal!==null){this.modal.remove()}},applyFIltersFromBuilders:function e(){var i,t,n;this.filterConfig=[];t=c.map(this.filterBuilders,c.proxy(function(t){i=t.component.getFilterConfig();if(c.isEmptyObject(i)===false){this.filterConfig.push(i)}else if(i===false){n=c.grep(this.dom.panels,function(e){if(e.layer.id===t.component.options.layer.id){return true}return false})[0];if(n&&!n.panelContent.is(":visible")){n.panelTitle.trigger("click")}return false}},this));if(t.length>0){return false}},save:function e(t,i){var n=[],r={},a=this.options.viewer.mapId,s;n=this.applyFIltersFromBuilders();if(n===false){return}if(!c.isArray(this.filterPanel.filters)){this.filterPanel.filters=[]}s=c.grep(this.filterPanel.filters,function(e){if(e[a]){e[a]=[];return true}else{return false}})[0];if(!s){s={};s[a]=[];this.filterPanel.filters.push(s)}c.map(this.filterConfig,c.proxy(function(e){if(this.filterPanel.filters.length===0){r[a]=[e];this.filterPanel.filters.push(r)}else if(e.items.length>0){s[a].push(e)}},this));giscloud.storage.fs.update(this.relpath,{content:JSON.stringify(this.fileConfig)}).done(c.proxy(o,this)).fail(c.proxy(l,this));u.apply(this,[this.EVENTS[1],{object:this,config:this.fileConfig}]);if(t===true){this.close(i)}},unregisterMinMaxVal:function e(){window.ParsleyValidator.removeValidator("fgt");window.ParsleyValidator.removeValidator("flt")},registerMinMaxVal:function e(){var a=this.maskWraper;window.ParsleyValidator.addValidator("fgt",function(e,t){var i,n,r=true;t=t.split(",");i=a.find(t[0]);n=a.find(t[1]);window.ParsleyUI.removeError(this.element.parsley(),"condGr");window.ParsleyUI.removeError(this.element.parsley(),"condReq");if(!i.is(":checked")){if(!e){window.ParsleyUI.addError(this.element.parsley(),"condReq",s.__("This value is required."));r=false}if(n.val()&&parseFloat(e)>parseFloat(n.val())===false&&r===true){window.ParsleyUI.addError(this.element.parsley(),"condGr",s.__("This value should be greater."));r=false}}return r},32).addMessage("en","fgt",ParsleyUtils.noMessage);window.ParsleyValidator.addValidator("flt",function(e,t){var i,n,r=true;t=t.split(",");i=a.find(t[0]);n=a.find(t[1]);window.ParsleyUI.removeError(this.element.parsley(),"condReq");window.ParsleyUI.removeError(this.element.parsley(),"condLs");if(!i.is(":checked")){if(!e){window.ParsleyUI.addError(this.element.parsley(),"condReq",s.__("This value is required."));r=false}if(n.val()&&parseFloat(e)<parseFloat(n.val())===false&&r===true){window.ParsleyUI.addError(this.element.parsley(),"condLs",s.__("This value should be less."));r=false}}return r},2).addMessage("en","flt",ParsleyUtils.noMessage)}}})(giscloud.exposeJQuery(),giscloud.common());(function(o){"use strict";var n={viewer:null,filterDef:[],gcdatagrid:null,saveScrollPosition:true};var l=function e(t,i){var n=this.find(".panel-title div.total");if(n.length===0){n=o("<div>",{class:"total pull-right"});this.find(".panel-title").append(n)}if(i.getActiveFilters().length===0){n.text("")}else{n.text("("+i.getActiveFilters().length+")")}};var c=function e(){this.container.scrollTop(this.container.data("scrollPostion"))};var u=function e(){this.container.data("scrollPostion",this.container.scrollTop())};var r=function e(){var i=this.classNamespace+giscloud.ui.id(),n,r,a,s;this.template.panelGroup.attr("id",i);this.container.empty();o.map(this.options.filterDef,o.proxy(function(e){n=this.options.viewer.layerById(e.layer_id);if(!n){console.info("layer doesn't exist "+e.layer_id);return}a=this.template.panelHeading.clone();s=this.template.panelCollapse.clone();r="layerId-"+n.id;a.attr("data-parent","#"+i).attr("data-target","#"+r);a.find("a").text(n.name);s.attr("id",r);var t={filter:new giscloud.ui.filters(e,s.find(".panel-body"),{gcdatagrid:this.options.gcdatagrid,viewer:this.options.viewer}),panelCollapse:s,panelHeading:a};o(t.filter).on("filter-add.gc-filter",o.proxy(l,t.panelHeading)).on("filter-remove.gc-filter",o.proxy(l,t.panelHeading));if(this.options.saveScrollPosition){o(t.filter).on("panel-rendering.gc-filter",o.proxy(u,this)).on("panel-rendered.gc-filter",o.proxy(c,this))}this.filters.push(t);if(this.options.filterDef.length===1){s.addClass("in");a.removeClass("collapsed")}this.template.panelGroup.find(".panel").append(a);this.template.panelGroup.find(".panel").append(s)},this));this.container.append(this.template.panelGroup)};giscloud.ui.LayerFilterForm=function(t,i){this.eventNamespace="gc-layer-filter-form";this.EVENTS=["form-rendered"];this.options={};this.filters=[];this.classNamespace="gcLayerFilterForm";this.container=null;this.template={panelGroup:o("<div>",{class:"panel-group gc-filter-form",role:"tablist","aria-multiselectable":true}).append(o("<div>",{class:"panel panel-default"})),panelHeading:o("<div>",{class:"accordion-toggle collapsed panel-heading",role:"tab","data-toggle":"collapse","aria-expanded":true}).append(o("<div>",{class:"panel-title"}).append(o("<a>"))),panelCollapse:o("<div>",{class:"panel-collapse collapse",role:"tabpanel"}).append(o("<div>",{class:"panel-body"}))};this.initialize=function e(){if(o.isPlainObject(t)){this.options=o.extend(true,{},n,{viewer:giscloud.ui.map||null},t)}else{this.options=i||{};this.options.container=t;this.options=o.extend(true,{},n,{viewer:giscloud.ui.map||null},i)}if(o.isPlainObject(t)){this.container=o(this.options.container)}else{this.container=o(t)}if(!o.isArray(this.options.filterDef)){this.options.filterDef=[this.options.filterDef]}if(this.container===null||!this.container.length){throw"giscloud.ui.LayerFilterForm: invalid container"}if(!this.options.viewer){throw"giscloud.Viewer object is required."}this.container.empty().append(o("<i>",{class:"fa fa-refresh fa-spin fa-4x"}));this.options.viewer.loading.done(o.proxy(r,this))};return this.initialize()};giscloud.ui.LayerFilterForm.prototype={on:function e(){this.container.on.apply(this.container,Array.prototype.slice.apply(arguments));return this},off:function e(){this.container.off.apply(this.container,Array.prototype.slice.apply(arguments));return this},bind:function e(){return this.on.apply(this,Array.prototype.slice.apply(arguments))},unbind:function e(){return this.off.apply(this,Array.prototype.slice.apply(arguments))}}})(giscloud&&giscloud.exposeJQuery()||window.jQuery);(function(r){"use strict";var a={ajax:{type:"POST",url:null,data:null},savecloseButton:true,editButton:false,editButtonTemplate:"<a class='btn-inline-edit' href='#'><i class='fa fa-pencil'></a>",inputPlaceholder:null,inputInitValue:null,id:null,hideEditMaskOnBlur:true,autosize:false};var s=function e(){if(this.wrapContainer.width()>this.container.textWidth()+30){this.container.removeClass("widthFull").addClass("widthAuto")}else{this.container.removeClass("widthAuto").addClass("widthFull")}};var o=function e(t,i){r(this).trigger(t,i);this.container.trigger(t,i)};var l=function e(){var t=this.options.ajax.data;t.value=this.wrapContainer.find(".inline-wrap-edit .inline-edit-element").val();return r.ajax({method:this.options.ajax.type,url:this.options.ajax.url,data:this.options.ajax.data}).done(r.proxy(function(e){o.apply(this,[this.EVENTS[3],{component:this,message:e}])},this)).fail(r.proxy(function(e,t){o.apply(this,[this.EVENTS[4],{component:this,xhr:e,status:t}])},this))};var c=function e(t){u.apply(this,["SET",t]);i.call(this)};var u=function e(t,i){var n;function r(){if(this.useText){this.container.text(n)}else{this.container.val(n)}}if(t==="SET"){n=this.wrapContainer.find(".inline-wrap-edit .inline-edit-element").val();this.values.changedValue.push(n);if(i===true){r.apply(this)}}else if(t==="RESTORE"){if(this.values.savedValue.length>0){n=this.values.savedValue[this.values.savedValue.length-1]}else{n=this.values.initalValue}this.wrapContainer.find(".inline-wrap-edit .inline-edit-element").val(n);if(i===true){r.apply(this)}}};var i=function e(t){if(t==="DISPLAY"){this.showDisplayMask.call(this)}else if(t=="EDIT"){this.showEditMask.call(this,true)}if(!t){if(this.wrapContainer.find(".inline-wrap-display").is(":visible")){this.showEditMask.call(this,true)}else{this.showDisplayMask.call(this)}}};var d=function e(t){var i={component:this,cancelSave:false,value:this.wrapContainer.find(".inline-wrap-edit .inline-edit-element").val()},n;if(this.options.ajax.url){o.apply(this,[this.EVENTS[2],i]);n=l.apply(this)}else{c.apply(this,[true]);o.apply(this,[this.EVENTS[5],i])}if(n!==undefined){n.done(function(){this.values.savedValue.push(i.value)})}else if(i.cancelSave===false){this.values.savedValue.push(i.value)}if(t&&t instanceof jQuery.Event){t.stopPropagation()}};var h=function e(t){u.apply(this,["RESTORE"]);i.apply(this);o.apply(this,[this.EVENTS[1],{component:this}]);if(t&&t instanceof jQuery.Event){t.stopPropagation()}};var f=function e(t){var i=r(t.target);if(t.which===13&&i.prop("tagName")!=="TEXTAREA"){d.apply(this)}else if(t.which===13&&t.ctrlKey===true&&i.prop("tagName")==="TEXTAREA"){d.apply(this)}else if(t.which==27){h.apply(this)}};giscloud.ui.inlineEdit=function e(i,n){this.EVENTS=["gc.inlineEdit.initial.done","gc.inlineEdit.cancel","gc.inlineEdit.save.before","gc.inlineEdit.save.done","gc.inlineEdit.save.fail","gc.inlineEdit.save.click","gc.inlineEdit.showEditMask","gc.inlineEdit.showDisplayMask","gc.inlineEdit.refreshDisplayMask","gc.inlineEdit.hideBtns","gc.inlineEdit.showBtns"];this.template={inlineWrap:r("<div>",{class:"inline-wrap"}),inlineWrapEdit:r("<div>",{class:"inline-wrap-edit ",css:{display:"none"}}),inlineWrapDisplay:r("<div>",{class:"inline-wrap-display"}),inputTemplate:r("<input>",{type:"text",class:"form-group form-control inline-edit-element",value:"",placeholder:""}),textAreaTemplate:r("<textarea>",{type:"text",class:"form-group form-control inline-edit-element",value:"",placeholder:""}),buttonsWrap:r("<div>",{class:"form-group inline-btn-wrap"}),buttonsTemplate:[r("<a>",{class:"btn btn-md btn-primary btn-save",type:"button"}).append(r("<i>",{class:"fa fa-check"})),r("<a>",{class:"btn btn-md btn-default btn-cancel",type:"button"}).append(r("<i>",{class:"fa fa-times"})),r("<div>",{class:"clearfix"})]};this.values={initalValue:null,changedValue:[],savedValue:[]};this.useText=false;this.container=null;this.wrapContainer=null;this.elId=null;this.initialize=function e(){var t=this.template.inputTemplate;if(r.isPlainObject(i)){this.options=r.extend(true,{},a,i)}else{this.options=n||{};this.options.selector=i;this.options=r.extend(true,{},a,n)}if(r.isPlainObject(i)){this.container=i}else{this.container=r(i)}if(r.inArray(this.container.prop("tagName"),["INPUT","TEXTAREA"])==-1&&!this.options.inputInitValue){this.values.initalValue=this.container.text();this.useText=true}else{if(this.container.prop("tagName")==="TEXTAREA")t=this.template.textAreaTemplate;this.values.initalValue=this.options.inputInitValue||this.container.val()}this.template.textAreaTemplate.val(this.values.initalValue);t.val(this.values.initalValue);this.elId=this.options.id||giscloud.uuid();this.template.inlineWrap.attr("id",this.elId);this.container.wrap(this.template.inlineWrap);this.container.wrap(this.template.inlineWrapDisplay);this.container.addClass("inline-dispay-element");if(this.options.savecloseButton){this.template.buttonsWrap.append(this.template.buttonsTemplate)}this.wrapContainer=r("#"+this.elId);this.wrapContainer.append(this.template.inlineWrapEdit);this.wrapContainer.find(".inline-wrap-edit").append(t);this.wrapContainer.find(".inline-wrap-edit").append(this.template.buttonsWrap);if(this.options.autosize)this.wrapContainer.find(".inline-edit-element").autosize({append:false});if(this.options.editButton===true){this.wrapContainer.find(".inline-wrap-display").append(this.options.editButtonTemplate);this.wrapContainer.on("click","a.btn-inline-edit",r.proxy(c,this));s.apply(this)}else{this.container.addClass("inline-no-btn");this.wrapContainer.on("click focus",".inline-dispay-element",r.proxy(c,this))}if(this.options.hideEditMaskOnBlur===true){this.wrapContainer.on("blur",".inline-edit-element",r.proxy(this.showDisplayMask,this))}this.wrapContainer.on("mousedown",".btn-cancel",r.proxy(h,this)).on("mousedown",".btn-save",r.proxy(d,this));this.wrapContainer.on("keydown",".inline-wrap-edit .inline-edit-element",r.proxy(f,this)).on("keyup",".inline-wrap-edit .inline-edit-element",r.proxy(u,this,"SET"));o.apply(this,[this.EVENTS[0],{component:this}]);return this};return this.initialize()};giscloud.ui.inlineEdit.prototype={on:function e(){this.container.on.apply(this.container,Array.prototype.slice.apply(arguments));return this},off:function e(){this.container.off.apply(this.container,Array.prototype.slice.apply(arguments));return this},bind:function e(){return this.on.apply(this,Array.prototype.slice.apply(arguments))},unbind:function e(){return this.off.apply(this,Array.prototype.slice.apply(arguments))},setEditValue:function e(t){this.wrapContainer.find(".inline-wrap-edit .inline-edit-element").val(t);u.apply(this,["SET"]);return this},refreshDisplayMask:function e(){o.apply(this,[this.EVENTS[8],{component:this}]);if(this.options.editButton===true)s.apply(this)},clearEditValue:function e(t){if(t){this.wrapContainer.find(".inline-wrap-edit .inline-edit-element").val(this.values.initalValue)}else{this.wrapContainer.find(".inline-wrap-edit .inline-edit-element").val("")}u.apply(this,["SET"]);return this},showDisplayMask:function e(){var t;o.apply(this,[this.EVENTS[7],{component:this}]);this.wrapContainer.find(".inline-wrap-display").show();if(this.options.editButton===true)s.apply(this);if(this.options.autosize)this.container.trigger("autosize.resize");this.wrapContainer.find(".inline-wrap-edit").hide();if(this.options.saveOnOutsideClick){t={component:this,cancelSave:false,value:this.wrapContainer.find(".inline-wrap-edit .inline-edit-element").val()};this.values.savedValue.push(t.value);this.container.text(t.value);o.apply(this,[this.EVENTS[5],t])}return this},showEditMask:function e(t){o.apply(this,[this.EVENTS[6],{component:this}]);this.wrapContainer.find(".inline-wrap-display").hide();this.wrapContainer.find(".inline-wrap-edit").show();if(t===true){this.wrapContainer.find(".inline-wrap-edit .inline-edit-element").focus()}if(this.options.autosize)this.wrapContainer.find(".inline-edit-element").trigger("autosize.resize");return this}}})(giscloud.exposeJQuery());(function(e,_,t,i){"use strict";if(!giscloud.ui.columns)giscloud.ui.columns={hasNullValue:false,selectedColumn:null};giscloud.ui.columns.filterDropdown=function(h,f){var p,g,m,v=_(this),y=!e.mdc||!e.cordova;f.page=f.page?f.page:1;f.perpage=f.perpage?f.perpage:10;f.sort=f.sort||f.column;_(h).find(".gc-list").empty();_(h).find(".gc-dropdown-list").hide();m=_(h).find(".gc-pagination-list").addClass("gc-hidden");y&&_(h).loader();giscloud.layers.attributeOps.distinct(f.layer_id,f.column,f).done(function(e){if(giscloud.ui.columns.selectedColumn!==f.column){giscloud.ui.columns.hasNullValue=false;giscloud.ui.columns.selectedColumn=f.column}y&&_(h).loader("hide");var i,n,t,r,a,s,o,l,c,u;p=Math.ceil(e.total/f.perpage),g=e.page;a=g+" / "+p;var d=g===p;i=_(h).find(".gc-list");t=_(h).find(".gc-dropdown-list").show();l=_(h).find("#gc-dropdown-input");r=_(h).find(".gc-page-stats");r=_(h).find(".gc-page-stats");s=_(h).find(".gc-arrow-left");o=_(h).find(".gc-arrow-right");if(!i.length){i=_("<ul/>").addClass("gc-list");t=_("<div/>").addClass("gc-dropdown-list");l=_("<input/>").attr({id:"gc-dropdown-input",type:"text",placeholder:"filter..."});m=_("<div/>").addClass("gc-pagination-list gc-hidden").css("margin","10px 0 0 0");s=_("<div/>").addClass("gc-icon gc-arrow-left gc-pointer");o=_("<div/>").addClass("gc-icon gc-arrow-right gc-pointer").css("float","right").css("margin","0");r=_("<div/>").addClass("gc-comment gc-page-stats").css("float","left").css("margin","3px 0 0 17px").css("font-size",10);_(h).append(l);_(h).append(t);_(h).append(m);t.append(i);m.append(s);m.append(r);m.append(o)}s.unbind();o.unbind();l.unbind();s.click(function(){if(g<=1)return;f.page--;f.dontUnbind=true;giscloud.ui.columns.filterDropdown(h,f)});o.click(function(){if(g>=p)return;f.page++;f.dontUnbind=true;giscloud.ui.columns.filterDropdown(h,f)});l.bind("keypress",function(e){if(e.keyCode===13){var t=l.val();v.trigger("item-click",[{value:{text:t},column:f.column}])}});if(p==1){}else{m.removeClass("gc-hidden");r.html(a)}n=_("<li/>").addClass("gc-item gc-pointer").html("<a class='deletebutton' >Clear filter</a>");n.click(function(){v.trigger("item-click",[{value:null,column:f.column}])});i.append(n);if(e.data[0]===null){giscloud.ui.columns.hasNullValue=true;e.data.shift()}if(d&&giscloud.ui.columns.hasNullValue){e.data.push(null)}_.each(e.data,function(e,t){c=t;u="";if(t===""){c="< empty >";u="-gray"}if(t===null){c="< null >";u="-gray"}n=_("<li/>").addClass("gc-item gc-pointer "+u).text(c);n.click(function(){v.trigger("item-click",[{value:{text:t},column:f.column}])});i.append(n)});v.trigger("done")}).fail(function(){y&&_(h).hideLoader();_(h).hide();om.showError("There was an error.")});if(f&&!f.dontUnbind)v.unbind("item-click");return v}})(window,giscloud.exposeJQuery(),giscloud.common());(function(o){"use strict";var i,a,l,n,r,s,c,t,u=false,d=false,h=false,f={};function p(e,t){return giscloud.ui.alert.color("red").show(e,t)}function g(e,t){return giscloud.ui.alert.color("green").show(e,t)}function m(){n={}}function v(e){var t,i,n=giscloud.ui.map.instance,r=n.getLayerCount();for(t=0;t<r;t++){i=n.getLayer(t);if(i.id==="layer"+e){return i}}return null}function y(e,t){var i=v(e.id),n=i&&i.getSelectable();e=fnl.getLayerById(e.id);if(!t){return n&&gcapp.isEditable(e)}switch(t.toLowerCase()){case"insert":return gcapp.canInsert(e)&&n;case"update":return gcapp.canUpdate(e)&&n;case"delete":return gcapp.canDelete(e)&&n;default:return gcapp.isEditable(e)&&n}}function _(){var e,t,i;if(gcapp.gclayer.llist){t=gcapp.gclayer.llist.getSelected();i=t&&gcapp.canInsert(t)}else{t=giscloud.ui.map.layerById(giscloud.ui.map.activeLayer);i=t&&gcapp.canInsert(t)}if(i){return{id:t.id,type:t.tip||t.type,sourceType:t.source&&t.source.type,h3:t.source&&t.source.h3}}return null}function b(e,i){var t=o.map(giscloud.ui.map.layers,function(e){var t={layerId:e.id,status:e.selectable()};e.selectable(y(e,i));return t});if(!e){r=t}}function w(){return b(true)}function x(){o.each(r||[],function(e,t){var i=giscloud.ui.map.layerById(t.layerId);if(i)i.selectable(t.status)})}function C(){giscloud.ui.map.reloadMap();gcdatagrid&&gcdatagrid.refresh()}function T(){g(gclang["form_saving"]);giscloud.ui.customForm.disable()}function k(){var e={};if(user&&user.options&&user.options.CLEAR_MAP_CACHE_CASCADE==="1"||giscloud.ui.map&&giscloud.ui.map.options&&giscloud.ui.map.options.CLEAR_MAP_CACHE_CASCADE==="1"){e.cascade=true}g(gclang["form_saving_done"],2e3);giscloud.layers.reset(giscloud.ui.map.mapId,[l.id],e).done(C,giscloud.ui.customForm.close,s.resolve);giscloud.log.push("feature_add",{lid:l.id,mid:giscloud.ui.map.mapId})}function M(){p(gclang["form_input_error"],2e3);giscloud.ui.customForm.enable()}function e(e){var t=o("#gc-edit-latlon-input > input"),i=o(e.target).is("button"),n=/^\s*(-?\d*.?\d+)\s*[\s,]\s*(-?\d*.?\d+)\s*$/,r=t.val().match(n);if(r&&r.length===3){if(!i){o("#gc-edit-latlon-input > button").prop("disabled",false)}if(i||e.type==="keyup"&&e.which===13){S(r[1],r[2])}}else{o("#gc-edit-latlon-input > button").prop("disabled",true)}}function S(e,t){var i={x:parseFloat(t),y:parseFloat(e)};i=giscloud.proj4("EPSG:4326",giscloud.ui.map.instance.projection,i);c=new giscloud.geometry.Point(i.x,i.y);if(a){giscloud.ui.map.graphic.editedFeature().geometry(c)}else{giscloud.ui.map.graphic.cancelDraw()}}function L(){o("<div/>",{id:"gc-edit-latlon-input"}).append(o("<input/>",{placeholder:"GPS: Lat, Lon"}).on("change keyup",e),o("<button/>",{text:"OK",disabled:true}).on("click",e)).appendTo("body").offset(function(){var e=o(giscloud.ui.map.container()).offset();return{top:e.top,left:e.left+giscloud.ui.map.width()/2+100}})}function D(t){giscloud.ui.customForm.open({layerId:l.id}).done(function(e){e.trigger("setFeatureGeometry.gc-custom-form",t.geometry().toOGC()).trigger("setRestParams.gc-custom-form",{use_map_srid:true}).on({"submitStart.gc-custom-form":T,"submitSuccess.gc-custom-form":k,"submitFailure.gc-custom-form":M,"close.gc-custom-form":s.reject});c=null}).fail(s.reject)}function j(){if(c){D({geometry:function(){return c}})}s.reject()}function I(e){return"<div class='edit-feature-message'>"+gclang.Editing_feature+(e.type!=="point"?"<br/>"+te():"")+ie()+"<a href='#' class='edit-feature-accept-button'>"+gclang.Save_changes+"</a>"+"<a href='#' class='edit-feature-cancel-button'>"+gclang.Cancel+"</a>"+"</div>"}function E(e){var t=function(e){e.preventDefault();giscloud.ui.edit.editCancel()},i=function(e){e.preventDefault();giscloud.ui.edit.editAccept()},n=giscloud.ui.map.layerById(e.layerId);giscloud.ui.map.unbind("featureClick",A);giscloud.ui.map.select(false);if(!n||!y(n,"update")){return}if(n.type==="point"){L();c=null}l=n;g(I(n));o(".edit-feature-cancel-button").click(t);o(".edit-feature-accept-button").click(i);K();X();Z();var r={};if(user&&user.options&&user.options.CLEAR_MAP_CACHE_CASCADE==="1"||giscloud.ui.map&&giscloud.ui.map.options&&giscloud.ui.map.options.CLEAR_MAP_CACHE_CASCADE==="1"){r.cascade=true}giscloud.ui.map.editFeature(e.layerId,e.featureId,r).always(function(){o("#gc-edit-latlon-input").remove();a=false;gcapp.gcmap.options.dontShowInfo=false;o(".edit-feature-cancel-button").off("click",t);o(".edit-feature-accept-button").off("click",i);Y();ee();giscloud.ui.alert.hide();x();giscloud.log.push("feature_edit",{lid:e.layerId,fid:e.featureId})}).then(s.resolve,s.reject)}function A(t){if(typeof n.beforeEdit==="function"){o.when(n.beforeEdit(t)).fail(function(e){if(!e){giscloud.ui.edit.editCancel()}}).done(function(e){if(e===false){giscloud.ui.edit.editCancel()}else if(e===true){}else if(e!==undefined){E(e)}else{E(t)}})}else{E(t)}}function P(e){if(e.tool==="SelectTool"||e.tool==="InfoTool"){giscloud.ui.edit.editCancel()}}function O(t,e){var i,n={};if(user&&user.options&&user.options.CLEAR_MAP_CACHE_CASCADE==="1"||giscloud.ui.map&&giscloud.ui.map.options&&giscloud.ui.map.options.CLEAR_MAP_CACHE_CASCADE==="1"){n.cascade=true}gcapp.selo.clearSelection();gcapp.gcmap.options.dontShowInfo=false;a=false;x();g(gclang["PleaseWait"]);i=o.map(t.featureIds||[],function(e){return giscloud.features.remove(t.layerId,e)});o.when.apply(o,i).done(function(){giscloud.layers.reset(giscloud.ui.map.mapId,[t.layerId],n).done(function(){g(gclang["Successfully_deleted_"],3e3);C();s.resolve();giscloud.log.push("feature_delete",{layerid:t.layerId,featureid:t.featureIds,count:t.featureIds.length,app:gcapp.name(),url:window.location.href})})}).fail(function(){p(gclang["AnErrorOccurred"],3e3);s.reject()})}function N(){var t;if(gcapp.selo.selectionCount()===0){giscloud.ui.edit.deleteCancel();return}t={layerId:gcapp.selo.selection.lid,featureIds:gcapp.selo.selection.fids};if(typeof n.beforeDelete==="function"){o.when(n.beforeDelete(t)).fail(function(e){if(!e){giscloud.ui.edit.deleteCancel()}}).done(function(e){if(e===false){giscloud.ui.edit.editCancel()}else if(e===true){}else if(e!==undefined){O(e)}else{O(t)}})}else{O(t)}}function R(e){e.preventDefault();o(".snapping-layers-list").toggle()}function F(){var a={},s=false;o(".snapping-layer-check").each(function(e,t){var i=o(t),n=i.prop("checked"),r=i.val();s=s||n;a[r]=n});f[l.id]=a;giscloud.ui.map.graphic.snapToLayersGeometry(a);o(".snapping-onoff-check").prop("checked",s)}function z(e){var t,i=e.which===77||e.which===109,n=o(e.target).is(".measure-onoff-check"),r=!o(e.target).is("input");if(i&&(n||r)){t=o(".measure-onoff-check");t.prop("checked",!t.prop("checked"));B();e.stopImmediatePropagation()}}function H(e){var t,i=e.which===83||e.which===115,n=o(e.target).is(".snapping-onoff-check,.snapping-layer-check"),r=!o(e.target).is("input");if(i&&(n||r)){t=o(".snapping-onoff-check");t.prop("checked",!t.prop("checked"));W();e.stopImmediatePropagation()}}function B(){d=o(".measure-onoff-check").prop("checked");giscloud.ui.edit.measureDisplay(d)}function W(){var e=o(".snapping-onoff-check").prop("checked"),r=f[l.id],a=true;if(e){if(r){o(".snapping-layer-check").each(function(e,t){var i=o(t),n=r[i.val()];if(n!=null){i.prop("checked",n);a=a&&!n}});giscloud.ui.map.graphic.snapToLayersGeometry(r)}if(!r||a){o(".snapping-layer-check").each(function(e,t){var i=o(t),n=i.val()===l.id.toString();i.prop("checked",n)});F()}$();Q(1500)}else{J();o(".snapping-layer-check").prop("checked",e);giscloud.ui.map.graphic.snapToLayersGeometry(e)}}function q(){giscloud.ui.map.graphic.isFeatureCountOkForSnapping().done(function(){o(".zoom-in-more-label,.snapping-controls").addClass("enabled").removeClass("disabled")}).fail(function(){o(".zoom-in-more-label,.snapping-controls").addClass("disabled").removeClass("enabled")})}function G(e){u=e.type==="mouseenter"}function V(){o(".gc-green-alert").on("mouseenter",$).on("mouseleave",Q)}function U(){h=false;o(".gc-green-alert").off("mouseenter",$).off("mouseleave",Q)}function $(){if(t!=null){clearTimeout(t);t=null}if(h)return;if(o(".snapping-layer-check").is(":checked")){h=true;o(".snapping-layers-list").slideDown("fast",V)}}function J(){if(u)return;o(".snapping-layers-list").slideUp("fast",U);if(t!=null){clearTimeout(t);t=null}}function Q(e){if(t!=null){clearTimeout(t);t=null}if(isNaN(e))e=800;t=setTimeout(J,e)}function X(){o(".snapping-onoff-check").change(W);o(".snapping-layer-check").change(F);o(".snapping-layers-toggle").click(R);o(".snapping-controls").mouseenter($);giscloud.ui.map.bind("mouseDown",J);o("body").on("mouseenter mouseleave",".gc-green-alert",G);o("body").keypress(H)}function Y(){o(".snapping-onoff-check").off("change",W);o(".snapping-layer-check").off("change",F);o(".snapping-layers-toggle").off("click",R);o(".snapping-controls").off("mouseenter",$);giscloud.ui.map.unbind("mouseDown",J);o("body").off("mouseenter mouseleave",".gc-green-alert",G);o("body").off("keypress",H)}function Z(){var e=o(".snapping-layers-list");h=false;if(e.height()>180){e.height(180).addClass("snapping-layers-list-overflowing")}q();$();Q(1500);W()}function K(){o(".measure-onoff-check").on("change",B);o("body").keypress(z)}function ee(){o(".measure-onoff-check").off("change",B);o("body").off("keypress",z)}function te(){return"<div class='measure-controls'>"+"<div>"+"<label style='display: inline; font-size: inherit;'><input type='checkbox' class='measure-onoff-check' "+(d?"checked='checked'/>":"/>")+"<u>M</u>easure display</label>"+"</div></div>"}function ie(){var e=giscloud.ui.map.graphic.snapToLayersGeometry(),n=false,r=[];o.each(e,function(e,t){var i=giscloud.xssSafe(giscloud.ui.map.layerById(e).name);n=n||t;r.push("<li title='"+i+"'><label><input type='checkbox' class='snapping-layer-check' "+"value='"+e+"' "+(t?"checked='checked'/>":"/>")+i+"</label></li>")});return"<div class='snapping-controls'>"+"<div>"+"<label style='display: inline; font-size: inherit;'><input type='checkbox' class='snapping-onoff-check' "+(n?"checked='checked'/>":"/>")+"<u>S</u>napping</label> "+"<span class='zoom-in-more-label enabled'>(zoom in more)</span>"+"<div><ul class='list-unstyled snapping-layers-list' style='display: none'>"+r.join("")+"</ul></div></div></div>"}function ne(e){return"<div class='add-feature-message'>"+gclang["addfeature_message_"+e.type]+(e.type!=="point"?"<br/>"+te():"")+"<br/>"+ie()+"<a href='#' class='add-feature-cancel-button'>"+gclang.Cancel+"</a>"+"</div>"}giscloud.ui.edit={isActive:function(){return i||a},addGeoImages:function(){var e=_();if(i||a){return}if(!e){giscloud.ui.redAlert(__("Please select the layer"),2e3);return}if(e.type!="point"){giscloud.ui.redAlert("You can insert geotagged images only in a point layer.",2e3);return}if(window.checkIfUserExceedsStorageLimits&&window.checkIfUserExceedsStorageLimits()){return window.showStorageForbiddenMsg()}l=e;o("#geoimages_form").remove();return giscloud.ui.modal({fid:"geoimages_form",title:__("Add geotagged images"),url:"/feature/form_geoimages",data:e,overlay:false})},checkIfShouldDisableFeatureButtons:function(){var e=_();if(e.sourceType==="file"){gcapp.disablefeatureoptionsforfilelayers=formManager.showWindow({fid:"disablefeatureoptionsforfilelayers",bootstrap:true,title:__("Editing is only possible for database layers"),height:"auto",text:__("Learn how to import data from a file into a database to make it editable."),buttons:[{html:__("OK"),click:"gcapp.disablefeatureoptionsforfilelayers.close()"}]});return false}else if(e.h3){gcapp.disablefeatureoptionsforh3layers=formManager.showWindow({fid:"disablefeatureoptionsforh3layers",bootstrap:true,title:__("Not possible to edit H3 geometry"),height:"auto",text:__("Editing H3 layers is currently not supported."),buttons:[{html:__("OK"),click:"gcapp.disablefeatureoptionsforh3layers.close()"}]});return false}return true},addFeature:function(){var e=_(),t=function(e){e.preventDefault();giscloud.ui.edit.addCancel()};if(i||a){return}if(window.checkIfUserExceedsStorageLimits&&window.checkIfUserExceedsStorageLimits()){return window.showStorageForbiddenMsg()}if(e){if(!this.checkIfShouldDisableFeatureButtons()){return}this.measureDisplay(d);l=e;g(ne(e));e.type!=="point"&&K();o(".add-feature-cancel-button").click(t);X();Z();if(e.type==="point"){L();c=null}i=true;s=new o.Deferred;if(gcapp.gctoolbar.active!=="InfoTool"||gcapp.gctoolbar.active!=="SelectTool"){gcapp.gctoolbar.setTool("InfoTool")}giscloud.ui.map.instance.setCursor("crosshair");gcapp.gcmap.dontShowInfo=true;giscloud.ui.map.select(false);s.always(function(){o(".add-feature-cancel-button").off("click",t);ee();Y();gcapp.gcmap.dontShowInfo=false;giscloud.ui.map.select(true);giscloud.ui.map.graphic.clear();i=false});giscloud.ui.map.graphic.draw(e.type).then(D,j).always(function(){if(d){giscloud.ui.map.graphic.measureDisplay(false)}giscloud.ui.alert.hide();giscloud.ui.map.instance.setCursor("");o("#gc-edit-latlon-input").remove()})}else{p(gclang["addfeature_message_select_layer"],3e3);return(new o.Deferred).reject().promise()}return s.promise()},addCancel:function(){giscloud.ui.map.graphic&&giscloud.ui.map.graphic.cancelDraw();s.reject()},editFeature:function(e){n=e||{};if(i||a){return}if(window.checkIfUserExceedsStorageLimits&&window.checkIfUserExceedsStorageLimits()){return window.showStorageForbiddenMsg()}if(!this.checkIfShouldDisableFeatureButtons()){return}this.measureDisplay(d);a=true;s=new o.Deferred;gcapp.gcmap.options.dontShowInfo=true;if(gcapp.gctoolbar.active!=="InfoTool"||gcapp.gctoolbar.active!=="SelectTool"){gcapp.gctoolbar.setTool("InfoTool")}gcapp.gctoolbar.addEvent("toolchange",P);s.always(function(){gcapp.gctoolbar.removeEvent("toolchange",P)});b(null,"edit");if(n.layerId&&n.featureId){A({layerId:n.layerId,featureId:n.featureId})}else{g((n.message||gclang["editfeature_choose_feature_message"])+"<br/><br/><a href='javascript:;' "+"onclick='giscloud.ui.edit.editCancel(); return false;'>"+gclang.Cancel+"</a>");giscloud.ui.map.featureClick(A)}s.always(m);return s.promise()},editCancel:function(){giscloud.ui.map.editCancel();a=false;gcapp.gcmap.options.dontShowInfo=false;giscloud.ui.map.unbind("featureClick",A);giscloud.ui.alert.hide();x();if(s)s.reject()},editAccept:function(){giscloud.ui.map.editAccept();g(gclang["PleaseWait"])},deleteFeature:function(e){n=e||{};if(i||a){return}if(!this.checkIfShouldDisableFeatureButtons()){return}a=true;s=new o.Deferred;g((n.message||gclang["deletefeature_choose_feature_message"])+"<br/><br/>"+"<a href='javascript:;' onclick='giscloud.ui.edit.deleteAccept(); return false;'>"+gclang.Delete_features+"</a>"+"<a href='javascript:;' onclick='giscloud.ui.edit.deleteCancel(); return false;'>"+gclang.Cancel+"</a>");s.always(m);gcapp.gcmap.options.dontShowInfo=true;gcapp.gctoolbar.addEvent("toolchange",w);s.always(function(){gcapp.gctoolbar.removeEvent("toolchange",w)});if(gcapp.selo.selectionCount()!==0){if(!y(giscloud.ui.map.layerById(gcapp.selo.selection.lid))){gcapp.selo.clearSelection()}}b(null,"delete");return s.promise()},deleteAccept:function(){N()},deleteCancel:function(){a=false;gcapp.gcmap.options.dontShowInfo=false;giscloud.ui.alert.hide();x();s.reject()},enableDisableSnapping:function(){q()},measureDisplay:function(e){d=e;if(e==null)return giscloud.ui.map.graphic.measureDisplay();else giscloud.ui.map.graphic.measureDisplay(e);return this}}})(giscloud.exposeJQuery());(function(t){"use strict";var i,n,e,r,a="<a href='javascript:;' onclick='return giscloud.ui.selectExtent.accept()'>"+gclang.Accept+"</a>"+"<a href='javascript:;' onclick='return giscloud.ui.selectExtent.cancel()'>"+gclang.Cancel+"</a>",s=gclang["Select_extent_message"]+"<br/><br/>"+a;function o(e,t){return giscloud.ui.alert.color("green").show(e,t)}function l(){var e=t.map(giscloud.ui.map.layers,function(e){var t={layerId:e.id,status:e.selectable()};e.selectable(false);return t});n=e}function c(){t.each(n,function(e,t){var i=giscloud.ui.map.layerById(t.layerId);i&&i.selectable(t.status)})}function u(){if(r.activeTool){gcapp.gctoolbar.setTool(r.activeTool)}gcapp.gcmap.options.dontShowInfo=r.dontShowInfo}function d(e){if(e.tool==="SelectTool"||e.tool==="InfoTool"){r.activeTool=null;giscloud.ui.selectExtent.cancel()}}function h(){e=giscloud.ui.defaultTools.selectExtent();e.viewer=giscloud.ui.map}function f(e){if(e.extent){i.resolve(e.extent)}else{i.reject()}}giscloud.ui.selectExtent={start:function(){if(!giscloud.ui.map||giscloud.ui.map.loading.state()!=="resolved"){giscloud.ui.alert.color("red").show("A map needs to be opened to select an extent.",2e3);return t.Deferred().reject()}i=new t.Deferred;r={activeTool:gcapp.gctoolbar.active,dontShowInfo:gcapp.gcmap.options.dontShowInfo};gcapp.gcmap.options.dontShowInfo=true;gcapp.gcmap.marker.clear();gcapp.gctoolbar.addEvent("toolchange",d);i.always(function(){u();c();gcapp.gctoolbar.removeEvent("toolchange",d)});l();o(s);if(!e){h()}e.activate();e.bind("deactivation",f);return i.promise()},cancel:function(){if(!e||!i){return}e.unbind("deactivation",f);e.deactivate();giscloud.ui.alert.hide();i.reject()},accept:function(){if(!e){return}e.deactivate();giscloud.ui.alert.hide()}}})(giscloud.exposeJQuery());(function(i,e){"use strict";giscloud.ui.id=function(){var n=i.now();return function(e,t,i){return[e||"",n++,t||""].join(i||"")}}();giscloud.ui.dataGrid={refresh:function(){gcdatagrid.refresh();return this},show:function(){gcapp.dataPanel.expand();return this},hide:function(){gcapp.dataPanel.expand();return this}};giscloud.ui.layerList={refresh:function(e){if(gcapp.gclayer)gcapp.gclayer.loadLayerList(e)},selected:function(e){var t;if(e===undefined){t=gcapp.gclayer.llist.getSelected();return t&&t.id*1||null}else{gcapp.gclayer.llist.selectByID(e);return this}}};giscloud.ui.homepage={show:function e(){if(!gcapp.homepage){return this}gcapp.homepage.show();this.trigger("shown.gc-ui-homepage");return this},hide:function e(){if(!gcapp.homepage){return this}gcapp.homepage.hide();this.trigger("hidden.gc-ui-homepage");return this},toggle:function e(){if(!gcapp.homepage){return this}gcapp.homepage.visible(!gcapp.homepage.homepage.is(":visible"));return this},visible:function(e){if(!gcapp.homepage){return this}if(e==null){return gcapp.homepage.homepage.is(":visible")}if(e){this.show()}else{this.hide()}return this},refresh:function(){gcapp.homepage.refresh();return this}};e.addEventsInterface(giscloud.ui.homepage,function(){return gcapp.homepage.homepage||document.body});giscloud.ui.openMap=function(e){gcproject.mapChange(e);return this};giscloud.ui.checkLogin=function(){if(user&&user.id&&user.id!=-1&&fno||fno.gcinit_auth.logged){return true}giscloud.ui.alert.color("red").show(gclang["Not_logged_in_warning"],3e3);return false};giscloud.ui.fullScreen=function(){var t=[];return function(e){e=e||{};if(e==="close"){formManager.closeFullpage(t.length&&t.pop()||null);if(i("div.gc-full-page").length===0){t=[]}return giscloud.ui}if(e.id==null){e.id=giscloud.ui.id("fullscreen")}t.push(e.id);return formManager.fullpage(e)||giscloud.ui}}();giscloud.ui.newWindow=function(l){var c={};function u(n,r,a){return function(){var i,e=15e3;if(!n){r.reject();return}if(a.focus==="immediately"){n.focus()}else if(a.focus==="afterLoad"){r.done(function(){n.focus()})}i=setInterval(function(){var e=n&&n.document&&l(n.document),t=a.check?a.check(e):true;if(t&&e&&e.length){clearInterval(i);i=null;r.resolve(n)}},100);setTimeout(function(){if(i!==null){clearInterval(i);r.reject()}},e)}}return function(e){var t,i,n,r=new l.Deferred,a={focus:"immediately"},s=window.navigator.userAgent,o=s.indexOf("MSIE");e=l.extend(a,e||{});if(e.check&&typeof e.check==="string"){n=e.check.toString();e.check=function(e){return e&&!!l(n,e).html()}}if(e.id==null){e.id=giscloud.ui.id("newWindow")}else{if(c[e.id]&&e.clear){t=c[e.id];if(!o&&t&&t.document){l("html",t.document).remove()}}}if(e.url){i=e.url}else{i=document.location.origin||function(e){return e.protocol+"//"+e.host}(document.location);if(e.view){if(!giscloud||!giscloud.app||!giscloud.app.loadView){throw"newWindow: no view handling method available."}i+="/appinstance/view/"+e.view}}t=window.open(i,e.id,"menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes");if(!t){return r.reject().promise()}c[e.id]=t;setTimeout(u(t,r,e),10);return r.promise()}}(i)})(giscloud.exposeJQuery(),giscloud.common());(function(c,i){"use strict";var u,d,r,h=null,f=null,n=null,e="key = 'val'",p=[{name:"FID",alias:"ID",order:1,type:"number",enabled:true},{name:"CREATED",alias:"CREATED",order:2,type:"timestamp",enabled:true},{name:"MODIFIED",alias:"MODIFIED",order:3,type:"timestamp",enabled:true}];function a(e){var t=e.form&&e.form.definition,n=e.form&&e.form.mappings||{},i=e.columns,a={},s=p.length+1,o=[],r=c.map(p,function(e){o.push(e.name);return{name:e.name,alias:i[e.name].alias||e.name,type:e.type,order:e.order,enabled:true}}),l=[];if(t){t.items.forEach(function(e){if(e.type==="group"){l=l.concat(e.items)}else{l.push(e)}});c.each(l,function(e,t){var i=n[t.name]||t.name;a[i]={name:t.name,alias:t.title,type:t.type}})}r=r.concat(c.map(i,function(e,t){var i,n,r;if(c.inArray(t,o)>-1){return null}i=a[t]||{};if(i.type==="recording"||i.type==="audio"){return null}r=parseInt(e.order,10);if(isNaN(r)){n=s++}else{n=r+s}return{name:t,alias:e.alias||t,type:i.type||e.data||"text",order:n,enabled:e.enabled}}));r=r.sort(function(e,t){if(!e||!e.order)return-1;if(!t||!t.order)return 1;if(e.order===t.order)return 0;return parseInt(e.order,10)>parseInt(t.order,10)?1:-1});return r}function s(e){var t=e.form&&e.form.definition,o=e.form&&e.form.mappings||{},l=e.columns||{},i=c.map(p,function(e){return{name:e.name,alias:l[e.name].alias||e.name,type:e.type,order:e.order,enabled:true}}),n=[];t.items.forEach(function(e){if(e.type==="group"){n=n.concat(e.items)}else{n.push(e)}});i=i.concat(c.map(n,function(e,t){var i=o[e.name]||e.name,n=e.title,r,a,s;if(e.type==="recording"||e.type==="audio"){return null}if(!n){r=o[e.name]?l[o[e.name]]:l[e.name];if(r&&r.alias){n=r.alias}else{n=e.name}}a=p.length+t+1;return{name:i,alias:n,type:e.type,order:a,enabled:true}}));return i}function o(e){return giscloud.layers.byId(e,{expand:["form","columns","meta"]}).then(function(e){var t=!!(e.form&&e.form.id);n=null;f=null;h=e;return{fromLayer:a(e),fromForm:t&&s(e)}})}function l(e){var t="${name} (${filter})",i=gcdatagrid&&gcdatagrid.__filters,n=c("#reportFieldListItemTemplate").clone().attr("id",null);n.find("input[type=checkbox]").val(e.mappedColumn||e.name).data("alias",e.alias).data("type",e.type).prop("checked",e.enabled);if(i&&i[e.name]){n.find("label").append(document.createTextNode(t.replace("${name}",e.mappedColumn||e.alias||e.name).replace("${filter}",i[e.name].value)))}else{n.find("label").append(document.createTextNode(e.alias||e.name))}return n}function g(){return["i"].concat(c("#reportFieldsList input[type=checkbox]:checked").map(function(e,t){return c(t).val()}).toArray())}function m(){return["#"].concat(c("#reportFieldsList input[type=checkbox]:checked").map(function(e,t){return c(t).data("alias")}).toArray())}function v(){var n={keys:{},indices:{}};c("#reportFieldsList input[type=checkbox]:checked").each(function(e,t){var i=c(t).data("type");if(i.indexOf("photo")===0||i==="signature"){n.indices[e+1]=true;n.keys[c(t).val()]=true}});return n}function y(){var n={keys:{},indices:{}};c("#reportFieldsList input[type=checkbox]:checked").each(function(e,t){var i=c(t).data("type");if(i==="timestamp"||i==="mdcLocationTime"||i==="datetime"){n.indices[e+1]=true;n.keys[c(t).val()]=true}});return n}function _(){var n={keys:{},indices:{}};c("#reportFieldsList input[type=checkbox]:checked").each(function(e,t){var i=c(t).data("type");if(["numeric","number","mdcLocationLat","mdcLocationLon","mdcLocationAlt","mdcLocationSpeed","mdcLocationHeading","mdcCompassHeading","mdcLocationAcc","mdcLocationAltAcc"].indexOf(i)>-1){n.indices[e+1]=true;n.keys[c(t).val()]=true}});return n}function b(e){var t,i,n=gcapp.config&&gcapp.config.newDatagrid?gcapp.dataGridOptions.params.getLayerData("[default]"):gcdatagrid.options.qsParams;if(!e||!e.data){return c.Deferred().reject("Missing report data for layer ID "+n.lid)}t=e&&e.data||[];i=e&&e.meta&&e.meta.columns;if(!i||!i.length){return t}c.each(t,function(e,n){var r={};c.each(i,function(e,t){var i;if(t.field==="FID"){r.FID=n.__id||n.data[t.alias]}else if(t.field==="CREATED"){r.CREATED=n.__created||n.data[t.alias]}else if(t.field==="MODIFIED"){r.MODIFIED=n.__modified||n.data[t.alias]}else if(t.field==="OWNER"){r.OWNER=n.__owner_username||n.__owner||n.data[t.alias]}else{i=n.data[t.alias||t.field];if(i!=null){r[t.field]=i}}});t[e].data=r});return t}function w(e,t){var i,n,r,a=gcapp.config&&gcapp.config.newDatagrid?gcapp.dataGridOptions.params.getLayerData("[default]"):gcdatagrid.options.qsParams;if(e){return giscloud.features.byLayer(e,{sort:"CREATED",where:t&&t.length?t.join(" AND "):null})}i=a&&c.map(a,function(e,t){if(e!=null){return t+"="+encodeURIComponent(e)}}).join("&");if(i.length<1){return c.Deferred().reject("Could not determine initial report data (layer, map)")}n={perpage:5e3,page:1,order_by:"FID",where:t||[]};if(gcapp.config&&gcapp.config.newDatagrid){if(c.isArray(n.where)){if(n.where.length>1){n.where=n.where.join(" AND ");r=true}else{n.where=n.where.join();r=n.where.length>0}}n.where+=(r?" AND ":"")+gcapp.dataGridSelectors.getCurrentFilterExpressions("[default]")}else{if(gcdatagrid&&gcdatagrid.options.where){n.where.push(gcdatagrid.options.where)}if(c.isArray(n.where)&&n.where.length>1){n.where=n.where.join(" AND ")}else if(c.isArray(n.where)&&n.where.length===1){n.where=n.where.join()}}return c.post("/modules_gc/layer/clayer.php?"+i,n,null,"json").then(function(e){if(e&&e.total&&e.total>5e3&&e.page===1){n.page=2;return c.post("/modules_gc/layer/clayer.php?"+i,n,null,"json").then(function(e,t){var i=b(e),n=b(t);if(!i||!Array.isArray(i)){return i}if(!n||!Array.isArray(n)){return n}return i.concat(n)}.bind(this,e))}return b(e)})}function x(e,t){return c.map(e,function(i,n){var r={};c.each(t||[],function(e,t){switch(t){case"i":r["i"]=n;break;case"FID":r["FID"]=i.__id;break;case"CREATED":r["CREATED"]=i.__created;break;case"MODIFIED":r["MODIFIED"]=i.__modified;break;default:r[t]=i.data[t]==null?"":i.data[t]}});return r})}function C(e,t,i){var n;try{n=JSON.parse(e.substring(7))}catch(e){console.error("Error decoding JSON attachment string",e);return"..."}return c.map(n,function(e){if(e.ext&&window.gcFileExt&&window.gcFileExt.Image.ext.split(",").includes(e.ext.toString().toLowerCase())){return c("<img/>",{class:"img-thumbnail thumb collapsed",src:["/rest/1/layers",i||e.lid,"features",t||e.fid,e.field,"resources",e.rid].join("/")}).get(0).outerHTML}return e.title||e.pathname})}function T(e){var t;if(!e)return"";if(e.indexOf("file://")===0){t=e.replace("file://","")}else{if(e.indexOf("uploads")===-1){t="uploads/"+e}}return c("<img/>",{src:"/view/${layerId}/"+t,class:"img-thumbnail thumb collapsed"}).get(0).outerHTML}function k(i){return function(e,t){if(!e){return e}if(e.indexOf("___json")===0){return new Handlebars.SafeString(C(e,t,i).join(""))}return new Handlebars.SafeString(c.map(e&&e.split&&e.split(",")||[],T).join("").replace(/\$\{layerId\}/g,i))}}function M(e,i){var n=e,r,t,a=[];if(typeof n==="object"){n=n.valueOf()}if(typeof n==="number"){n=n*1e3}if(i&&i.data&&i.data.root&&i.data.root.currentForm){t=i.data.root.currentForm.items;t.forEach(function(e){if(e.type==="group"){a=a.concat(e.items)}else{a.push(e)}});c.each(a,function(e,t){if(t.name===i.data.key){r=t.mode||(t.type==="mdcLocationTime"?"mdcLocationTime":"date");if(t.type==="mdcLocationTime"&&typeof n!=="number"){n=parseInt(n)*1e3}}})}if(i.data.key==="CREATED"||i.data.key==="MODIFIED"){r="datetimeSeconds"}return!n?"":window.formatDateTime?window.formatDateTime(n,r):new Date(n).toLocaleString()}function S(e,t,i){var n,r,a;if(this===window){return""}n=i.data.index;r=i.data.key;if(r){if(t.keys[r]===true){return i.fn(this)}else if(this&&(typeof this==="string"&&this.startsWith("___json"))||this.toString()&&this.toString().startsWith("___json")){a=JSON.parse(this.replace("___json",""))[0];if(a.ext&&window.gcFileExt&&window.gcFileExt.Media.ext.split(",").includes(a.ext.toString().toLowerCase())){return i.fn(this)}else{return i.inverse(this)}}else if(this&&typeof this==="string"&&(this.startsWith("file://")||this.startsWith("mdc_photo_")||this.startsWith("mdc_recording_")||this.startsWith("mdc_file_"))){return i.fn(this)}return i.inverse(this)}if(t.indices[n]===true){return i.fn(this)}return i.inverse(this)}function L(e,t,i){var n,r;if(this===window){return""}n=i.data.index;r=i.data.key;t=t||i.data.root.timestampColumns;if(r){if(t.keys[r]===true)return i.fn(this);return i.inverse(this)}if(t.indices[n]===true){return i.fn(this)}return i.inverse(this)}function D(e,t,i){var n,r;if(this===window){return""}r=e;n=i.data.index;t=t||i.data.root.numericColumns;if(r&&t.keys[r]===true){return i.fn(this)}if(t.indices[n]===true){return i.fn(this)}return i.inverse(this)}function j(e,t){t.data("DateTimePicker").setMinDate(e)}function I(e,t){t.data("DateTimePicker").setMaxDate(e)}function t(e,t){if(e.type.indexOf("photo")===0)return 1;if(t.type.indexOf("photo")===0)return-1;return e.order>=t.order?1:-1}function E(e){return{fromLayer:e.fromLayer.sort(t),fromForm:e.fromForm&&e.fromForm.sort(t)}}function A(e){var t;if(!n){n=e}if(n.fromForm){if(gcApp.utils.isMdcpLayerOfCurrentMap(h&&h.id)){c(".gc-report-column-source-choice").hide();t=n.fromForm}else{c(".gc-report-column-source-choice").show();if(c(".gc-report-column-source-choice input[value='form']").is(":checked")){t=n.fromForm}else{t=n.fromLayer}}}else{c(".gc-report-column-source-choice").hide();t=n.fromLayer}c("#reportFieldsList").empty().append(c.map(t,l)).sortable({axis:"y",cursor:"n-resize"})}function P(){var e;if(!r)return;e=r.data&&r.data();if(!e||!e["bs.modal"]||!e["bs.modal"].hide)return;e["bs.modal"].hide();r=null}function O(e,t){var n=c.Deferred();P();r=giscloud.ui.modal({title:t||i.__("Layer Report"),overlay:false,footer:false});r.find(".modal-body").load(e,null,function(e,t,i){if(t!=="success"){n.rejectWith(r,[e,t,i])}r.find(".gc-report-column-source-choice input").on("change",A);n.resolve(c(this))});return n}function N(){var e=gcdatagrid&&gcdatagrid.__filters,t=g(),i=m(),n=v(),r=y(),a=_(),s=!!u.val()&&u.data("DateTimePicker").getDate(),o=!!d.val()&&d.data("DateTimePicker").getDate(),l=[];Handlebars.registerHelper("thumbs",k(h.id));Handlebars.registerHelper("timestamp",M);Handlebars.registerHelper("ifMedia",S);Handlebars.registerHelper("ifTimestamp",L);Handlebars.registerHelper("ifNumeric",D);if(o&&o.toISOString){o=o.toDate();o.setHours(24);if(!s||!s.toISOString){l.push("__created < '"+o.toISOString()+"'")}else{l.push("__created >= '"+s.toISOString()+"'");l.push("__created < '"+o.toISOString()+"'")}}else{if(s&&s.toISOString){l.push("__created >= '"+s.toISOString()+"'")}}return w(null,l).then(function(e){return x(e,t)}).fail(function(e){f=null}).then(function(e){f={title:h.name,date:(new Date).toLocaleDateString(),description:null,start:s&&s.toDate().toLocaleDateString(),end:o&&o.toLocaleDateString(),columns:i,photoColumns:n,timestampColumns:r,numericColumns:a,data:e,currentForm:typeof h.form.definition==="string"?JSON.parse(h.form.definition):h.form.definition};return f})}function R(t,i,e){var n,r=t.find(i),a=new c.Deferred;if(r.length){return a.resolve(r).promise()}e=e!==undefined?e:15e3;n=setInterval(function(){var e=t.find(i);if(e.length){if(n!=null){clearInterval(n);n=null}a.resolve(e)}},97);setTimeout(function(){if(n!=null){clearInterval(n);n=null}a.reject()},e);return a.promise()}function F(i){var t;giscloud.ui.greenAlert("Creating report...");t=giscloud.ui.newWindow({id:"report",url:"/reports/view",focus:"afterLoad",check:"body",clear:true});t.then(function(e){var t=c(e.document).find("body");e.document.cookie="PHPSESSID="+giscloud.sessid()+";path=/view/"+i+";secure=false;samesite=none";t.find("#loader-holder p").append(__("The report is being generated. Please wait."))});giscloud.log.push("created report",{username:user.username,layerId:i,url:window.location.href});return c.when(t,N()).then(function(e){var t=c(e.document),i=t.find("body");return c.when(c.Deferred().resolve(t),R(i,"#loader-holder"),R(i,"#report"))}).fail(function(e){var n="";if(e&&e.status!==0){n=e.statusText?e.statusText:""}var r=__("An error occurred.");t.done(function(e){var t=c(e.document.body);t.find("#loader-holder").css("display","none");var i=t.find("#error-msg");i.append(r+" "+n);i.css("display","block")});giscloud.ui.redAlert(r,3e3)}).done(function(e,t,i){var n=["Report:",h.name,(new Date).toLocaleDateString()].join(" ");t.css("display","none");e.attr("title",n);i.handlebars(i,f);i.find("th").first().addClass("sort-nr sorted sorted-asc");i.css("display","block");P();giscloud.ui.greenAlert("The report is ready.",2e3)})}giscloud.ui.reports={create:function(e,t){c.when(o(e),O("/reports/setup",t&&t.title)).then(E).done(A).done(function(){u=c("#reportStartDateInput").datetimepicker({pickTime:false}).on("dp.change",function(e){j(e.date,d)});d=c("#reportEndDateInput").datetimepicker({pickTime:false}).on("dp.change",function(e){I(e.date,u)});c("#createReportButton").click(function(){return F(e)});c("#cancelReportButton").click(P)});return this}}})(giscloud.exposeJQuery(),giscloud.common());(function(r,a,n){"use strict";var s={avatar:false,container:null,responsive:false};giscloud.ui.UserMenu=function e(t,i){this.container=null;this.component=null;this.options=a.extend(true,{},s,i||{});this.initialize=function e(){if(a.isPlainObject(t)){this.container=a(this.options.container)}else{this.container=a(t)}if(this.container===null||!this.container.length){throw"giscloud.ui.UserMenu: invalid container"}if(!this.options.responsive&&!n.isMobileBrowser){this.options.responsive=false}this.user=r.user;if(this.user&&this.user.id>=0){this.component=this.createComponent()}else{this.component=a("<button>Sign In</button>").attr({id:"signupcombo",onClick:"window.showLoginForm();",class:"btn btn-default"})}this.container.append(this.component);if(this.options.avatar&&giscloud.app.user){this.appendAvatar()}};this.createComponent=function e(){var t,i,n;t=a("<div>").attr({id:"signupcombo",class:"btn-group"});i=a("<button>").attr({id:"btn-signInCombo",type:"button",class:"btn btn-default dropdown-toggle","aria-expanded":"true","data-toggle":"dropdown"});i.text(this.user.firstname||this.user.lastname?this.user.firstname+" "+this.user.lastname+" ":__("Sign in"));i.append(a("<span>").attr({class:"caret"}));t.append(i);n=a("<ul>").attr({class:"dropdown-menu pull-right",role:"menu"});if(this.options.responsive){n.append(a("<li>").append(a("<a>").attr({href:"javascript:;",onClick:"gcapp.loadHomeWorkspace();"}).text(__("Home"))))}else{n.append(a("<li>").append(a("<a>").attr({href:"javascript:;",onClick:"gcapp.showAdmin();"}).text(__("My Apps"))),a("<li>").append(a("<a>").attr({href:"javascript:;",onClick:"showSubscription();"}).text(__("Subscription & Storage"))));if(!this.user.options["DISABLE_MY_ACCOUNT"]){n.append(a("<li>").append(a("<a>").attr({href:"javascript:;",onClick:"myAccount();"}).text(__("MyAccount"))))}}if(r.fno&&fno.giscloud&&fno.gcinit_docs_url){n.append(a("<li>").append(a("<a>").attr({href:"javascript:;",onClick:"openDocsWindow(event); return false;"}).text(__("User Manual"))))}n.append(a("<li>").attr({style:"border-bottom:none; font-weight:bold;"}).append(a("<a>").attr({href:"javascript:;",onClick:"logOut();return false;",style:"color:#555;"}).text(__("Log out"))));t.append(n);return t};this.appendAvatar=function e(){var t=a("#signupcombo .dropdown-toggle").addClass("gc-ct-avatar");a("#signupcombo .dropdown-menu").addClass("pull-right");giscloud.app.user.gravatarElement(36,null,{color:"#000000"}).done(function(e){t.empty();e.addClass("gc-avatar");t.append(e)})};return this.initialize()}})(window,giscloud.exposeJQuery(),giscloud.common());var fleetNamespace=giscloud;(function(e,i,t){fleetNamespace.FuelReading=function(e,t){if(t){i.extend(this,t);this.vehicleId=e}this.remove=function(){return giscloud.fuelReadings.remove(this.vehicleId,this.id)}}})(window,window.giscloud.exposeJQuery());(function(r,a,e){fleetNamespace.fuelReadings={byVehicle:function(i){var e="vehicles/"+i+"/fuelreadings/",n=new r.Deferred;a.rest.get(e).done(function(e){var t=[];r.each(e.data,function(){t.push(new fleetNamespace.FuelReading(i,this))});n.resolve(t,e.total)}).fail(function(){n.reject()});return n.promise()},create:function(e,t){var i="vehicles/"+e+"/fuelreadings/";return a.rest.call("POST",i,t,"application/json").then(function(e,t){var i=t&&t.match(/fuelreadings\/(\d+)/);return i&&i[1]})},remove:function(e,t){var i="vehicles/"+e+"/fuelreadings/"+t;return a.rest.call("DELETE",i).promise()},byId:function(t,e){var i="vehicles/"+t+"/fuelreadings/"+e,n=new r.Deferred;a.rest.get(i).done(function(e){n.resolve(new giscloud.FuelReading(t,e))}).fail(function(){n.reject()});return n.promise()}}})(giscloud.exposeJQuery(),window.giscloud.common());(function(e,t,i){fleetNamespace.Vehicle=function(e){if(e){this.id=e.id;this.mark=e.mark;this.client_id=e.client_id;this.device_id=e.device_id}}})(window,window.giscloud.exposeJQuery());(function(n,r,e){fleetNamespace.vehicles={list:function(e){var t="vehicles/",i=new n.Deferred;if(e&&e.query){t+=e.query}r.rest.get(t).done(function(e){var t=[];n.each(e.data,function(){t.push(new fleetNamespace.Vehicle(this))});i.resolve(t,e.total)}).fail(function(){i.reject()});return i.promise()},byId:function(e){var t="vehicles/"+e,i=new n.Deferred;r.rest.get(t).done(function(e){i.resolve(new giscloud.Vehicle(e))}).fail(function(){i.reject()});return i.promise()},byMark:function(e){return this.list({query:"?query_on=mark&query="+e})}}})(giscloud.exposeJQuery(),window.giscloud.common());!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.proj4=t()}(giscloud,function(){"use strict";function c(e,t){if(e[t])return e[t];for(var i,n=Object.keys(e),r=t.toLowerCase().replace(Ae,""),a=-1;++a<n.length;)if(i=n[a],i.toLowerCase().replace(Ae,"")===r)return e[i]}function t(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Oe}function a(e){return new t(e).output()}function r(e,t,i){Array.isArray(t)&&(i.unshift(t),t=null);var n=t?{}:e,r=i.reduce(function(e,t){return s(t,e),e},n);t&&(e[t]=r)}function s(e,t){if(Array.isArray(e)){var i=e.shift();if("PARAMETER"===i&&(i=e.shift()),1===e.length)return Array.isArray(e[0])?(t[i]={},void s(e[0],t[i])):void(t[i]=e[0]);if(e.length)if("TOWGS84"!==i){if("AXIS"===i)return i in t||(t[i]=[]),void t[i].push(e);Array.isArray(i)||(t[i]={});var n;switch(i){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[i]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&s(e[2],t[i]));case"SPHEROID":case"ELLIPSOID":return t[i]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&s(e[3],t[i]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void r(t,i,e);default:for(n=-1;++n<e.length;)if(!Array.isArray(e[n]))return s(e,t[i]);return r(t,i,e)}}else t[i]=e;else t[i]=!0}else t[e]=!0}function o(e,t){var i=t[0],n=t[1];!(i in e)&&n in e&&(e[i]=e[n],3===t.length&&(e[i]=t[2](e[i])))}function l(e){return e*Be}function u(t){function e(e){return e*(t.to_meter||1)}if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var i="",n=0,r=t.AXIS.length;n<r;++n){var a=[t.AXIS[n][0].toLowerCase(),t.AXIS[n][1].toLowerCase()];-1!==a[0].indexOf("north")||("y"===a[0]||"lat"===a[0])&&"north"===a[1]?i+="n":-1!==a[0].indexOf("south")||("y"===a[0]||"lat"===a[0])&&"south"===a[1]?i+="s":-1!==a[0].indexOf("east")||("x"===a[0]||"lon"===a[0])&&"east"===a[1]?i+="e":-1===a[0].indexOf("west")&&("x"!==a[0]&&"lon"!==a[0]||"west"!==a[1])||(i+="w")}2===i.length&&(i+="u"),3===i.length&&(t.axis=i)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var s=t.GEOGCS;"GEOGCS"===t.type&&(s=t),s&&(s.DATUM?t.datumCode=s.DATUM.name.toLowerCase():t.datumCode=s.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(t.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=s.DATUM.SPHEROID.a,t.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(t.datum_params=s.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",l],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",l],["x0","false_easting",e],["y0","false_northing",e],["long0","central_meridian",l],["lat0","latitude_of_origin",l],["lat0","standard_parallel_1",l],["lat1","standard_parallel_1",l],["lat2","standard_parallel_2",l],["azimuth","Azimuth"],["alpha","azimuth",l],["srsCode","name"]].forEach(function(e){return o(t,e)}),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=l(t.lat1>0?90:-90),t.lat_ts=t.lat1)}function n(e){var t=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?n[e]=Pe(arguments[1]):n[e]=We(arguments[1]):n[e]=i}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?n.apply(t,e):n(e)});if("string"==typeof e){if(e in n)return n[e]}else"EPSG"in e?n["EPSG:"+e.EPSG]=e:"ESRI"in e?n["ESRI:"+e.ESRI]=e:"IAU2000"in e?n["IAU2000:"+e.IAU2000]=e:console.log(e);return}}function d(e){return"string"==typeof e}function h(e){return e in n}function f(t){return qe.some(function(e){return t.indexOf(e)>-1})}function p(e){var t=c(e,"authority");if(t){var i=c(t,"epsg");return i&&Ge.indexOf(i)>-1}}function g(e){var t=c(e,"extension");if(t)return c(t,"proj4")}function m(e){return"+"===e[0]}function v(e){if(!d(e))return e;if(h(e))return n[e];if(f(e)){var t=We(e);if(p(t))return n["EPSG:3857"];var i=g(t);return i?Pe(i):t}return m(e)?Pe(e):void 0}function e(e){return e}function i(e,t){var i=Ke.length;return e.names?(Ke[i]=e,e.names.forEach(function(e){Ze[e.toLowerCase()]=i}),this):(console.log(t),!0)}function y(e,t,i,n){var r=e*e,a=t*t,s=(r-a)/r,o=0;return n?(r=(e*=1-s*(xe+s*(Ce+s*Te)))*e,s=0):o=Math.sqrt(s),{es:s,e:o,ep2:(r-a)/a}}function _(e,t,i,n,r){if(!e){var a=c(tt,n);a||(a=it),e=a.a,t=a.b,i=a.rf}return i&&!t&&(t=(1-1/i)*e),(0===i||Math.abs(e-t)<ke)&&(r=!0,t=e),{a:e,b:t,rf:i,sphere:r}}function b(e,t,i,n,r,a,s){var o={};return o.datum_type=void 0===e||"none"===e?_e:ye,t&&(o.datum_params=t.map(parseFloat),0===o.datum_params[0]&&0===o.datum_params[1]&&0===o.datum_params[2]||(o.datum_type=ge),o.datum_params.length>3&&(0===o.datum_params[3]&&0===o.datum_params[4]&&0===o.datum_params[5]&&0===o.datum_params[6]||(o.datum_type=me,o.datum_params[3]*=be,o.datum_params[4]*=be,o.datum_params[5]*=be,o.datum_params[6]=o.datum_params[6]/1e6+1))),s&&(o.datum_type=ve,o.grids=s),o.a=i,o.b=n,o.es=r,o.ep2=a,o}function w(e){return void 0===e?null:e.split(",").map(x)}function x(e){if(0===e.length)return null;var t="@"===e[0];return t&&(e=e.slice(1)),"null"===e?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:rt[e]||null,isNull:!1}}function C(e){return e/3600*Math.PI/180}function T(e){var t=e.getInt32(8,!1);return 11!==t&&(11!==(t=e.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function k(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:M(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}function M(e,t,i){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,i)))}function S(e,t,i){for(var n=[],r=0;r<t.nSubgrids;r++){var a=D(e,176,i),s=j(e,176,a,i),o=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),l=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);n.push({ll:[C(a.lowerLongitude),C(a.lowerLatitude)],del:[C(a.longitudeInterval),C(a.latitudeInterval)],lim:[o,l],count:a.gridNodeCount,cvs:L(s)})}return n}function L(e){return e.map(function(e){return[C(e.longitudeShift),C(e.latitudeShift)]})}function D(e,t,i){return{name:M(e,t+8,t+16).trim(),parent:M(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,i),upperLatitude:e.getFloat64(t+88,i),lowerLongitude:e.getFloat64(t+104,i),upperLongitude:e.getFloat64(t+120,i),latitudeInterval:e.getFloat64(t+136,i),longitudeInterval:e.getFloat64(t+152,i),gridNodeCount:e.getInt32(t+168,i)}}function j(e,t,i,n){for(var r=t+176,a=[],s=0;s<i.gridNodeCount;s++){var o={latitudeShift:e.getFloat32(r+16*s,n),longitudeShift:e.getFloat32(r+16*s+4,n),latitudeAccuracy:e.getFloat32(r+16*s+8,n),longitudeAccuracy:e.getFloat32(r+16*s+12,n)};a.push(o)}return a}function I(e,t){if(!(this instanceof I))return new I(e);t=t||function(e){if(e)throw e};var i=v(e);if("object"==typeof i){var n=I.projections.get(i.projName);if(n){if(i.datumCode&&"none"!==i.datumCode){var r=c(nt,i.datumCode);r&&(i.datum_params=i.datum_params||(r.towgs84?r.towgs84.split(","):null),i.ellps=r.ellipse,i.datumName=r.datumName?r.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var a=_(i.a,i.b,i.rf,i.ellps,i.sphere),s=y(a.a,a.b,a.rf,i.R_A),o=w(i.nadgrids),l=i.datum||b(i.datumCode,i.datum_params,a.a,a.b,s.es,s.ep2,o);Ve(this,i),Ve(this,n),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=l,this.init(),t(null,this)}else t(e)}else t(e)}function E(e,t){return e.datum_type===t.datum_type&&(!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(e.datum_type===ge?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type!==me||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6]))}function A(e,t,i){var n,r,a,s,o=e.x,l=e.y,c=e.z?e.z:0;if(l<-we&&l>-1.001*we)l=-we;else if(l>we&&l<1.001*we)l=we;else{if(l<-we)return{x:-1/0,y:-1/0,z:e.z};if(l>we)return{x:1/0,y:1/0,z:e.z}}return o>Math.PI&&(o-=2*Math.PI),r=Math.sin(l),s=Math.cos(l),a=r*r,n=i/Math.sqrt(1-t*a),{x:(n+c)*s*Math.cos(o),y:(n+c)*s*Math.sin(o),z:(n*(1-t)+c)*r}}function P(e,t,i,n){var r,a,s,o,l,c,u,d,h,f,p,g,m,v,y,_,b=e.x,w=e.y,x=e.z?e.z:0;if(r=Math.sqrt(b*b+w*w),a=Math.sqrt(b*b+w*w+x*x),r/i<1e-12){if(v=0,a/i<1e-12)return y=we,_=-n,{x:e.x,y:e.y,z:e.z}}else v=Math.atan2(w,b);s=x/a,d=(o=r/a)*(1-t)*(l=1/Math.sqrt(1-t*(2-t)*o*o)),h=s*l,m=0;do{m++,c=t*(u=i/Math.sqrt(1-t*h*h))/(u+(_=r*d+x*h-u*(1-t*h*h))),g=(p=s*(l=1/Math.sqrt(1-c*(2-c)*o*o)))*d-(f=o*(1-c)*l)*h,d=f,h=p}while(g*g>1e-24&&m<30);return y=Math.atan(p/Math.abs(f)),{x:v,y:y,z:_}}function O(e,t,i){if(t===ge)return{x:e.x+i[0],y:e.y+i[1],z:e.z+i[2]};if(t===me){var n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],c=i[6];return{x:c*(e.x-l*e.y+o*e.z)+n,y:c*(l*e.x+e.y-s*e.z)+r,z:c*(-o*e.x+s*e.y+e.z)+a}}}function N(e,t,i){if(t===ge)return{x:e.x-i[0],y:e.y-i[1],z:e.z-i[2]};if(t===me){var n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],c=i[6],u=(e.x-n)/c,d=(e.y-r)/c,h=(e.z-a)/c;return{x:u+l*d-o*h,y:-l*u+d+s*h,z:o*u-s*d+h}}}function R(e){return e===ge||e===me}function F(e,t,i){if(null===e.grids||0===e.grids.length)return console.log("Grid shift grids not found"),-1;for(var n={x:-i.x,y:i.y},r={x:Number.NaN,y:Number.NaN},a=[],s=0;s<e.grids.length;s++){var o=e.grids[s];if(a.push(o.name),o.isNull){r=n;break}if(null!==o.grid){var l=o.grid.subgrids[0],c=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,u=l.ll[0]-c,d=l.ll[1]-c,h=l.ll[0]+(l.lim[0]-1)*l.del[0]+c,f=l.ll[1]+(l.lim[1]-1)*l.del[1]+c;if(!(d>n.y||u>n.x||f<n.y||h<n.x||(r=z(n,t,l),isNaN(r.x))))break}else if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*Se+" "+n.y*Se+" tried: '"+a+"'"),-1):(i.x=-r.x,i.y=r.y,0)}function z(e,t,i){var n={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return n;var r={x:e.x,y:e.y};r.x-=i.ll[0],r.y-=i.ll[1],r.x=Je(r.x-Math.PI)+Math.PI;var a=H(r,i);if(t){if(isNaN(a.x))return n;a.x=r.x-a.x,a.y=r.y-a.y;var s,o,l=9;do{if(o=H(a,i),isNaN(o.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}s={x:r.x-(o.x+a.x),y:r.y-(o.y+a.y)},a.x+=s.x,a.y+=s.y}while(l--&&Math.abs(s.x)>1e-12&&Math.abs(s.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=Je(a.x+i.ll[0]),n.y=a.y+i.ll[1]}else isNaN(a.x)||(n.x=e.x+a.x,n.y=e.y+a.y);return n}function H(e,t){var i,n={x:e.x/t.del[0],y:e.y/t.del[1]},r={x:Math.floor(n.x),y:Math.floor(n.y)},a={x:n.x-1*r.x,y:n.y-1*r.y},s={x:Number.NaN,y:Number.NaN};if(r.x<0||r.x>=t.lim[0])return s;if(r.y<0||r.y>=t.lim[1])return s;i=r.y*t.lim[0]+r.x;var o={x:t.cvs[i][0],y:t.cvs[i][1]};i++;var l={x:t.cvs[i][0],y:t.cvs[i][1]};i+=t.lim[0];var c={x:t.cvs[i][0],y:t.cvs[i][1]};i--;var u={x:t.cvs[i][0],y:t.cvs[i][1]},d=a.x*a.y,h=a.x*(1-a.y),f=(1-a.x)*(1-a.y),p=(1-a.x)*a.y;return s.x=f*o.x+h*l.x+p*u.x+d*c.x,s.y=f*o.y+h*l.y+p*u.y+d*c.y,s}function B(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function W(e,t){return(e.datum.datum_type===ge||e.datum.datum_type===me)&&"WGS84"!==t.datumCode||(t.datum.datum_type===ge||t.datum.datum_type===me)&&"WGS84"!==e.datumCode}function q(e,t,i,n){var r;if(Array.isArray(i)&&(i=ot(i)),lt(i),e.datum&&t.datum&&W(e,t)&&(i=q(e,r=new I("WGS84"),i,n),e=r),n&&"enu"!==e.axis&&(i=st(e,!1,i)),"longlat"===e.projName)i={x:i.x*Me,y:i.y*Me,z:i.z||0};else if(e.to_meter&&(i={x:i.x*e.to_meter,y:i.y*e.to_meter,z:i.z||0}),!(i=e.inverse(i)))return;if(e.from_greenwich&&(i.x+=e.from_greenwich),i=at(e.datum,t.datum,i))return t.from_greenwich&&(i={x:i.x-t.from_greenwich,y:i.y,z:i.z||0}),"longlat"===t.projName?i={x:i.x*Se,y:i.y*Se,z:i.z||0}:(i=t.forward(i),t.to_meter&&(i={x:i.x/t.to_meter,y:i.y/t.to_meter,z:i.z||0})),n&&"enu"!==t.axis?st(t,!0,i):i}function G(t,i,n,e){var r,a,s;return Array.isArray(n)?(r=q(t,i,n,e)||{x:NaN,y:NaN},n.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==i.name&&"geocent"===i.name?"number"==typeof r.z?[r.x,r.y,r.z].concat(n.splice(3)):[r.x,r.y,n[2]].concat(n.splice(3)):[r.x,r.y].concat(n.splice(2)):[r.x,r.y]):(a=q(t,i,n,e),2===(s=Object.keys(n)).length?a:(s.forEach(function(e){if(void 0!==t.name&&"geocent"===t.name||void 0!==i.name&&"geocent"===i.name){if("x"===e||"y"===e||"z"===e)return}else if("x"===e||"y"===e)return;a[e]=n[e]}),a))}function V(e){return e instanceof I?e:e.oProj?e.oProj:I(e)}function U(i,n,e){i=V(i);var t,r=!1;return void 0===n?(n=i,i=ct,r=!0):(void 0!==n.x||Array.isArray(n))&&(e=n,n=i,i=ct,r=!0),n=V(n),e?G(i,n,e):(t={forward:function(e,t){return G(i,n,e,t)},inverse:function(e,t){return G(n,i,e,t)}},r&&(t.oProj=n),t)}function $(e,t){return t=t||5,ee(Y({lat:e[1],lon:e[0]}),t)}function J(e){var t=Z(re(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Q(e){return e*(Math.PI/180)}function X(e){return e/Math.PI*180}function Y(e){var t,i,n,r,a,s,o,l=e.lat,c=e.lon,u=6378137,d=Q(l),h=Q(c);o=Math.floor((c+180)/6)+1,180===c&&(o=60),l>=56&&l<64&&c>=3&&c<12&&(o=32),l>=72&&l<84&&(c>=0&&c<9?o=31:c>=9&&c<21?o=33:c>=21&&c<33?o=35:c>=33&&c<42&&(o=37)),s=Q(6*(o-1)-180+3),t=u/Math.sqrt(1-.00669438*Math.sin(d)*Math.sin(d)),i=Math.tan(d)*Math.tan(d),n=.006739496752268451*Math.cos(d)*Math.cos(d);var f=.9996*t*((r=Math.cos(d)*(h-s))+(1-i+n)*r*r*r/6+(5-18*i+i*i+72*n-.39089081163157013)*r*r*r*r*r/120)+5e5,p=.9996*((a=u*(.9983242984503243*d-.002514607064228144*Math.sin(2*d)+2639046602129982e-21*Math.sin(4*d)-3.418046101696858e-9*Math.sin(6*d)))+t*Math.tan(d)*(r*r/2+(5-i+9*n+4*n*n)*r*r*r*r/24+(61-58*i+i*i+600*n-2.2240339282485886)*r*r*r*r*r*r/720));return l<0&&(p+=1e7),{northing:Math.round(p),easting:Math.round(f),zoneNumber:o,zoneLetter:K(l)}}function Z(e){var t=e.northing,i=e.easting,n=e.zoneLetter,r=e.zoneNumber;if(r<0||r>60)return null;var a,s,o,l,c,u,d,h,f=6378137,p=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),g=i-5e5,m=t;n<"N"&&(m-=1e7),u=6*(r-1)-180+3,h=(d=m/.9996/6367449.145945056)+(3*p/2-27*p*p*p/32)*Math.sin(2*d)+(21*p*p/16-55*p*p*p*p/32)*Math.sin(4*d)+151*p*p*p/96*Math.sin(6*d),a=f/Math.sqrt(1-.00669438*Math.sin(h)*Math.sin(h)),s=Math.tan(h)*Math.tan(h),o=.006739496752268451*Math.cos(h)*Math.cos(h),l=.99330562*f/Math.pow(1-.00669438*Math.sin(h)*Math.sin(h),1.5),c=g/(.9996*a);var v=h-a*Math.tan(h)/l*(c*c/2-(5+3*s+10*o-4*o*o-.06065547077041606)*c*c*c*c/24+(61+90*s+298*o+45*s*s-1.6983531815716497-3*o*o)*c*c*c*c*c*c/720);v=X(v);var y=(c-(1+2*s+o)*c*c*c/6+(5-2*o+28*s-3*o*o+.05391597401814761+24*s*s)*c*c*c*c*c/120)/Math.cos(h);y=u+X(y);var _;if(e.accuracy){var b=Z({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});_={top:b.lat,right:b.lon,bottom:v,left:y}}else _={lat:v,lon:y};return _}function K(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function ee(e,t){var i="00000"+e.easting,n="00000"+e.northing;return e.zoneNumber+e.zoneLetter+te(e.easting,e.northing,e.zoneNumber)+i.substr(i.length-5,t)+n.substr(n.length-5,t)}function te(e,t,i){var n=ie(i);return ne(Math.floor(e/1e5),Math.floor(t/1e5)%20,n)}function ie(e){var t=e%ut;return 0===t&&(t=ut),t}function ne(e,t,i){var n=i-1,r=dt.charCodeAt(n),a=ht.charCodeAt(n),s=r+e-1,o=a+t,l=!1;return s>vt&&(s=s-vt+ft-1,l=!0),(s===pt||r<pt&&s>pt||(s>pt||r<pt)&&l)&&s++,(s===gt||r<gt&&s>gt||(s>gt||r<gt)&&l)&&++s===pt&&s++,s>vt&&(s=s-vt+ft-1),o>mt?(o=o-mt+ft-1,l=!0):l=!1,(o===pt||a<pt&&o>pt||(o>pt||a<pt)&&l)&&o++,(o===gt||a<gt&&o>gt||(o>gt||a<gt)&&l)&&++o===pt&&o++,o>mt&&(o=o-mt+ft-1),String.fromCharCode(s)+String.fromCharCode(o)}function re(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,i=e.length,n=null,r="",a=0;!/[A-Z]/.test(t=e.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+e;r+=t,a++}var s=parseInt(r,10);if(0===a||a+3>i)throw"MGRSPoint bad conversion from: "+e;var o=e.charAt(a++);if(o<="A"||"B"===o||"Y"===o||o>="Z"||"I"===o||"O"===o)throw"MGRSPoint zone letter "+o+" not handled: "+e;n=e.substring(a,a+=2);for(var l=ie(s),c=ae(n.charAt(0),l),u=se(n.charAt(1),l);u<oe(o);)u+=2e6;var d=i-a;if(d%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var h,f,p,g,m,v=d/2,y=0,_=0;return v>0&&(h=1e5/Math.pow(10,v),f=e.substring(a,a+v),y=parseFloat(f)*h,p=e.substring(a+v),_=parseFloat(p)*h),g=y+c,m=_+u,{easting:g,northing:m,zoneLetter:o,zoneNumber:s,accuracy:h}}function ae(e,t){for(var i=dt.charCodeAt(t-1),n=1e5,r=!1;i!==e.charCodeAt(0);){if(++i===pt&&i++,i===gt&&i++,i>vt){if(r)throw"Bad character: "+e;i=ft,r=!0}n+=1e5}return n}function se(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var i=ht.charCodeAt(t-1),n=0,r=!1;i!==e.charCodeAt(0);){if(++i===pt&&i++,i===gt&&i++,i>mt){if(r)throw"Bad character: "+e;i=ft,r=!0}n+=1e5}return n}function oe(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function le(e,t,i){if(!(this instanceof le))return new le(e,t,i);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var n=e.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=e,this.y=t,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}function ce(e){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],i="object"==typeof e.PROJECTION?Object.keys(e.PROJECTION)[0]:e.PROJECTION;return"no_uoff"in e||"no_off"in e||-1!==t.indexOf(i)}function ue(e){var t,i=[];return i[0]=e*ti,t=e*e,i[0]+=t*ii,i[1]=t*ri,t*=e,i[0]+=t*ni,i[1]+=t*ai,i[2]=t*si,i}function de(e,t){var i=e+e;return e+t[0]*Math.sin(i)+t[1]*Math.sin(i+i)+t[2]*Math.sin(i+i+i)}function he(e,t,i,n){var r;return e<ke?(n.value=Mi.AREA_0,r=0):(r=Math.atan2(t,i),Math.abs(r)<=Le?n.value=Mi.AREA_0:r>Le&&r<=we+Le?(n.value=Mi.AREA_1,r-=we):r>we+Le||r<=-(we+Le)?(n.value=Mi.AREA_2,r=r>=0?r-je:r+je):(n.value=Mi.AREA_3,r+=we)),r}function fe(e,t){var i=e+t;return i<-je?i+=De:i>+je&&(i-=De),i}function pe(e,t,i,n){for(var r=t;n;--n){var a=e(r);if(r-=a,Math.abs(a)<i)break}return r}var ge=1,me=2,ve=3,ye=4,_e=5,be=484813681109536e-20,we=Math.PI/2,xe=.16666666666666666,Ce=.04722222222222222,Te=.022156084656084655,ke=1e-10,Me=.017453292519943295,Se=57.29577951308232,Le=Math.PI/4,De=2*Math.PI,je=3.14159265359,Ie={};Ie.greenwich=0,Ie.lisbon=-9.131906111111,Ie.paris=2.337229166667,Ie.bogota=-74.080916666667,Ie.madrid=-3.687938888889,Ie.rome=12.452333333333,Ie.bern=7.439583333333,Ie.jakarta=106.807719444444,Ie.ferro=-17.666666666667,Ie.brussels=4.367975,Ie.stockholm=18.058277777778,Ie.athens=23.7163375,Ie.oslo=10.722916666667;var Ee={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Ae=/[\s_\-\/\(\)]/g,Pe=function(e){var t,i,n,r={},a=e.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var i=t.split("=");return i.push(!0),e[i[0].toLowerCase()]=i[1],e},{}),s={proj:"projName",datum:"datumCode",rf:function(e){r.rf=parseFloat(e)},lat_0:function(e){r.lat0=e*Me},lat_1:function(e){r.lat1=e*Me},lat_2:function(e){r.lat2=e*Me},lat_ts:function(e){r.lat_ts=e*Me},lon_0:function(e){r.long0=e*Me},lon_1:function(e){r.long1=e*Me},lon_2:function(e){r.long2=e*Me},alpha:function(e){r.alpha=parseFloat(e)*Me},gamma:function(e){r.rectified_grid_angle=parseFloat(e)},lonc:function(e){r.longc=e*Me},x_0:function(e){r.x0=parseFloat(e)},y_0:function(e){r.y0=parseFloat(e)},k_0:function(e){r.k0=parseFloat(e)},k:function(e){r.k0=parseFloat(e)},a:function(e){r.a=parseFloat(e)},b:function(e){r.b=parseFloat(e)},r_a:function(){r.R_A=!0},zone:function(e){r.zone=parseInt(e,10)},south:function(){r.utmSouth=!0},towgs84:function(e){r.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){r.to_meter=parseFloat(e)},units:function(e){r.units=e;var t=c(Ee,e);t&&(r.to_meter=t.to_meter)},from_greenwich:function(e){r.from_greenwich=e*Me},pm:function(e){var t=c(Ie,e);r.from_greenwich=(t||parseFloat(e))*Me},nadgrids:function(e){"@null"===e?r.datumCode="none":r.nadgrids=e},axis:function(e){3===e.length&&-1!=="ewnsud".indexOf(e.substr(0,1))&&-1!=="ewnsud".indexOf(e.substr(1,1))&&-1!=="ewnsud".indexOf(e.substr(2,1))&&(r.axis=e)},approx:function(){r.approx=!0}};for(t in a)i=a[t],t in s?"function"==typeof(n=s[t])?n(i):r[n]=i:r[t]=i;return"string"==typeof r.datumCode&&"WGS84"!==r.datumCode&&(r.datumCode=r.datumCode.toLowerCase()),r},Oe=1,Ne=/\s/,Re=/[A-Za-z]/,Fe=/[A-Za-z84]/,ze=/[,\]]/,He=/[\d\.E\-\+]/;t.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;Ne.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case Oe:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},t.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(ze.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},t.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=Oe)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=Oe,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},t.prototype.number=function(e){if(!He.test(e)){if(ze.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},t.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},t.prototype.keyword=function(e){if(Fe.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=Oe)}if(!ze.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},t.prototype.neutral=function(e){if(Re.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(He.test(e))return this.word=e,void(this.state=3);{if(!ze.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)}},t.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var Be=.017453292519943295,We=function(e){var t=a(e),i=t.shift(),n=t.shift();t.unshift(["name",n]),t.unshift(["type",i]);var r={};return s(t,r),u(r),r};!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(n);var qe=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],Ge=["3857","900913","3785","102113"],Ve=function(e,t){e=e||{};var i,n;if(!t)return e;for(n in t)void 0!==(i=t[n])&&(e[n]=i);return e},Ue=function(e,t,i){var n=e*t;return i/Math.sqrt(1-n*n)},$e=function(e){return e<0?-1:1},Je=function(e){return Math.abs(e)<=je?e:e-$e(e)*De},Qe=function(e,t,i){var n=e*i,r=.5*e;return n=Math.pow((1-n)/(1+n),r),Math.tan(.5*(we-t))/n},Xe=function(e,t){for(var i,n,r=.5*e,a=we-2*Math.atan(t),s=0;s<=15;s++)if(i=e*Math.sin(a),n=we-2*Math.atan(t*Math.pow((1-i)/(1+i),r))-a,a+=n,Math.abs(n)<=1e-10)return a;return-9999},Ye=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Ue(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t=e.x,i=e.y;if(i*Se>90&&i*Se<-90&&t*Se>180&&t*Se<-180)return null;var n,r;if(Math.abs(Math.abs(i)-we)<=ke)return null;if(this.sphere)n=this.x0+this.a*this.k0*Je(t-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(Le+.5*i));else{var a=Math.sin(i),s=Qe(this.e,i,a);n=this.x0+this.a*this.k0*Je(t-this.long0),r=this.y0-this.a*this.k0*Math.log(s)}return e.x=n,e.y=r,e},inverse:function(e){var t,i,n=e.x-this.x0,r=e.y-this.y0;if(this.sphere)i=we-2*Math.atan(Math.exp(-r/(this.a*this.k0)));else{var a=Math.exp(-r/(this.a*this.k0));if(-9999===(i=Xe(this.e,a)))return null}return t=Je(this.long0+n/(this.a*this.k0)),e.x=t,e.y=i,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:e,inverse:e,names:["longlat","identity"]}],Ze={},Ke=[],et={start:function(){Ye.forEach(i)},add:i,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==Ze[t]&&Ke[Ze[t]]?Ke[Ze[t]]:void 0}},tt={};tt.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},tt.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},tt.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},tt.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},tt.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},tt.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},tt.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},tt.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},tt.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},tt.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},tt.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},tt.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},tt.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},tt.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},tt.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},tt.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},tt.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},tt.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},tt.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},tt.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},tt.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},tt.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},tt.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},tt.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},tt.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},tt.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},tt.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},tt.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},tt.hough={a:6378270,rf:297,ellipseName:"Hough"},tt.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},tt.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},tt.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},tt.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},tt.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},tt.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},tt.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},tt.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},tt.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},tt.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},tt.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},tt.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var it=tt.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};tt.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var nt={};nt.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},nt.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},nt.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nt.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nt.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},nt.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},nt.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},nt.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},nt.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},nt.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nt.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nt.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},nt.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},nt.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},nt.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},nt.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},nt.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var rt={};I.projections=et,I.projections.start();var at=function(e,t,i){if(E(e,t))return i;if(e.datum_type===_e||t.datum_type===_e)return i;var n=e.a,r=e.es;if(e.datum_type===ve){if(0!==F(e,!1,i))return;n=6378137,r=.0066943799901413165}var a=t.a,s=t.b,o=t.es;return t.datum_type===ve&&(a=6378137,s=6356752.314,o=.0066943799901413165),r!==o||n!==a||R(e.datum_type)||R(t.datum_type)?(i=A(i,r,n),R(e.datum_type)&&(i=O(i,e.datum_type,e.datum_params)),R(t.datum_type)&&(i=N(i,t.datum_type,t.datum_params)),i=P(i,o,a,s),t.datum_type!==ve||0===F(t,!0,i)?i:void 0):i},st=function(e,t,i){var n,r,a,s=i.x,o=i.y,l=i.z||0,c={};for(a=0;a<3;a++)if(!t||2!==a||void 0!==i.z)switch(0===a?(n=s,r=-1!=="ew".indexOf(e.axis[a])?"x":"y"):1===a?(n=o,r=-1!=="ns".indexOf(e.axis[a])?"y":"x"):(n=l,r="z"),e.axis[a]){case"e":c[r]=n;break;case"w":c[r]=-n;break;case"n":c[r]=n;break;case"s":c[r]=-n;break;case"u":void 0!==i[r]&&(c.z=n);break;case"d":void 0!==i[r]&&(c.z=-n);break;default:return null}return c},ot=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t},lt=function(e){B(e.x),B(e.y)},ct=I("WGS84"),ut=6,dt="AJSAJS",ht="AFAFAF",ft=65,pt=73,gt=79,mt=86,vt=90,yt={forward:$,inverse:function(e){var t=Z(re(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]},toPoint:J};le.fromMGRS=function(e){return new le(J(e))},le.prototype.toMGRS=function(e){return $([this.x,this.y],e)};var _t=.01068115234375,bt=function(e){var t=[];t[0]=1-e*(.25+e*(.046875+e*(.01953125+e*_t))),t[1]=e*(.75-e*(.046875+e*(.01953125+e*_t)));var i=e*e;return t[2]=i*(.46875-e*(.013020833333333334+.007120768229166667*e)),i*=e,t[3]=i*(.3645833333333333-.005696614583333333*e),t[4]=i*e*.3076171875,t},wt=function(e,t,i,n){return i*=t,t*=t,n[0]*e-i*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))},xt=function(e,t,i){for(var n=1/(1-t),r=e,a=20;a;--a){var s=Math.sin(r),o=1-t*s*s;if(o=(wt(r,s,Math.cos(r),i)-e)*(o*Math.sqrt(o))*n,r-=o,Math.abs(o)<ke)return r}return r},Ct={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=bt(this.es),this.ml0=wt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,i,n,r=e.x,a=e.y,s=Je(r-this.long0),o=Math.sin(a),l=Math.cos(a);if(this.es){var c=l*s,u=Math.pow(c,2),d=this.ep2*Math.pow(l,2),h=Math.pow(d,2),f=Math.abs(l)>ke?Math.tan(a):0,p=Math.pow(f,2),g=Math.pow(p,2);t=1-this.es*Math.pow(o,2),c/=Math.sqrt(t);var m=wt(a,o,l,this.en);i=this.a*(this.k0*c*(1+u/6*(1-p+d+u/20*(5-18*p+g+14*d-58*p*d+u/42*(61+179*g-g*p-479*p)))))+this.x0,n=this.a*(this.k0*(m-this.ml0+o*s*c/2*(1+u/12*(5-p+9*d+4*h+u/30*(61+g-58*p+270*d-330*p*d+u/56*(1385+543*g-g*p-3111*p))))))+this.y0}else{var v=l*Math.sin(s);if(Math.abs(Math.abs(v)-1)<ke)return 93;if(i=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,n=l*Math.cos(s)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(n))>=1){if(v-1>ke)return 93;n=0}else n=Math.acos(n);a<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return e.x=i,e.y=n,e},inverse:function(e){var t,i,n,r,a=(e.x-this.x0)*(1/this.a),s=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+s/this.k0,i=xt(t,this.es,this.en),Math.abs(i)<we){var o=Math.sin(i),l=Math.cos(i),c=Math.abs(l)>ke?Math.tan(i):0,u=this.ep2*Math.pow(l,2),d=Math.pow(u,2),h=Math.pow(c,2),f=Math.pow(h,2);t=1-this.es*Math.pow(o,2);var p=a*Math.sqrt(t)/this.k0,g=Math.pow(p,2);n=i-(t*=c)*g/(1-this.es)*.5*(1-g/12*(5+3*h-9*u*h+u-4*d-g/30*(61+90*h-252*u*h+45*f+46*u-g/56*(1385+3633*h+4095*f+1574*f*h)))),r=Je(this.long0+p*(1-g/6*(1+2*h+u-g/20*(5+28*h+24*f+8*u*h+6*u-g/42*(61+662*h+1320*f+720*f*h))))/l)}else n=we*$e(s),r=0;else{var m=Math.exp(a/this.k0),v=.5*(m-1/m),y=this.lat0+s/this.k0,_=Math.cos(y);t=Math.sqrt((1-Math.pow(_,2))/(1+Math.pow(v,2))),n=Math.asin(t),s<0&&(n=-n),r=0===v&&0===_?0:Je(Math.atan2(v,_)+this.long0)}return e.x=r,e.y=n,e},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]},Tt=function(e){var t=Math.exp(e);return t=(t-1/t)/2},kt=function(e,t){e=Math.abs(e),t=Math.abs(t);var i=Math.max(e,t),n=Math.min(e,t)/(i||1);return i*Math.sqrt(1+Math.pow(n,2))},Mt=function(e){var t=1+e,i=t-1;return 0===i?e:e*Math.log(t)/i},St=function(e){var t=Math.abs(e);return t=Mt(t*(1+t/(kt(1,t)+1))),e<0?-t:t},Lt=function(e,t){for(var i,n=2*Math.cos(2*t),r=e.length-1,a=e[r],s=0;--r>=0;)i=n*a-s+e[r],s=a,a=i;return t+i*Math.sin(2*t)},Dt=function(e,t){for(var i,n=2*Math.cos(t),r=e.length-1,a=e[r],s=0;--r>=0;)i=n*a-s+e[r],s=a,a=i;return Math.sin(t)*i},jt=function(e){var t=Math.exp(e);return t=(t+1/t)/2},It=function(e,t,i){for(var n,r,a=Math.sin(t),s=Math.cos(t),o=Tt(i),l=jt(i),c=2*s*l,u=-2*a*o,d=e.length-1,h=e[d],f=0,p=0,g=0;--d>=0;)n=p,r=f,h=c*(p=h)-n-u*(f=g)+e[d],g=u*p-r+c*f;return c=a*l,u=s*o,[c*h-u*g,c*g+u*h]},Et={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ct.init.apply(this),this.forward=Ct.forward,this.inverse=Ct.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),i=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),i*=t,this.cgb[1]=i*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),i*=t,this.cgb[2]=i*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=i*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),i*=t,this.cgb[3]=i*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=i*(1237/630+t*(t*(-24832/14175)-2.4)),i*=t,this.cgb[4]=i*(4174/315+t*(-144838/6237)),this.cbg[4]=i*(-734/315+t*(109598/31185)),i*=t,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+i*(.25+i*(1/64+i/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=i*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=i*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),i*=t,this.utg[2]=i*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=i*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),i*=t,this.utg[3]=i*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=i*(49561/161280+t*(-179/168+t*(6601661/7257600))),i*=t,this.utg[4]=i*(-4583/161280+t*(108847/3991680)),this.gtu[4]=i*(34729/80640+t*(-3418889/1995840)),i*=t,this.utg[5]=-.03233083094085698*i,this.gtu[5]=.6650675310896665*i;var n=Lt(this.cbg,this.lat0);this.Zb=-this.Qn*(n+Dt(this.gtu,2*n))},forward:function(e){var t=Je(e.x-this.long0),i=e.y;i=Lt(this.cbg,i);var n=Math.sin(i),r=Math.cos(i),a=Math.sin(t),s=Math.cos(t);i=Math.atan2(n,s*r),t=Math.atan2(a*r,kt(n,r*s)),t=St(Math.tan(t));var o=It(this.gtu,2*i,2*t);i+=o[0],t+=o[1];var l,c;return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,c=this.a*(this.Qn*i+this.Zb)+this.y0):(l=1/0,c=1/0),e.x=l,e.y=c,e},inverse:function(e){var t=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,t/=this.Qn;var n,r;if(Math.abs(t)<=2.623395162778){var a=It(this.utg,2*i,2*t);i+=a[0],t+=a[1],t=Math.atan(Tt(t));var s=Math.sin(i),o=Math.cos(i),l=Math.sin(t),c=Math.cos(t);i=Math.atan2(s*c,kt(l,c*o)),t=Math.atan2(l,c*o),n=Je(t+this.long0),r=Lt(this.cgb,i)}else n=1/0,r=1/0;return e.x=n,e.y=r,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]},At=function(e,t){if(void 0===e){if((e=Math.floor(30*(Je(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e},Pt={init:function(){var e=At(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*Me,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Et.init.apply(this),this.forward=Et.forward,this.inverse=Et.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},Ot=function(e,t){return Math.pow((1-e)/(1+e),t)},Nt=20,Rt={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Le)/(Math.pow(Math.tan(.5*this.lat0+Le),this.C)*Ot(this.e*e,this.ratexp))},forward:function(e){var t=e.x,i=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+Le),this.C)*Ot(this.e*Math.sin(i),this.ratexp))-we,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,i=e.y,n=Math.pow(Math.tan(.5*i+Le)/this.K,1/this.C),r=Nt;r>0&&(i=2*Math.atan(n*Ot(this.e*Math.sin(e.y),-.5*this.e))-we,!(Math.abs(i-e.y)<1e-14));--r)e.y=i;return r?(e.x=t,e.y=i,e):null},names:["gauss"]},Ft={init:function(){Rt.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,i,n,r;return e.x=Je(e.x-this.long0),Rt.forward.apply(this,[e]),t=Math.sin(e.y),i=Math.cos(e.y),n=Math.cos(e.x),r=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*i*n),e.x=r*i*Math.sin(e.x),e.y=r*(this.cosc0*t-this.sinc0*i*n),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,i,n,r,a;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,a=Math.sqrt(e.x*e.x+e.y*e.y)){var s=2*Math.atan2(a,this.R2);t=Math.sin(s),i=Math.cos(s),r=Math.asin(i*this.sinc0+e.y*t*this.cosc0/a),n=Math.atan2(e.x*t,a*this.cosc0*i-e.y*this.sinc0*t)}else r=this.phic0,n=0;return e.x=n,e.y=r,Rt.inverse.apply(this,[e]),e.x=Je(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},zt={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ke&&(this.k0=.5*(1+$e(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=ke&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=ke&&(this.k0=.5*this.cons*Ue(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Qe(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Ue(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-we,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,i,n,r,a,s,o=e.x,l=e.y,c=Math.sin(l),u=Math.cos(l),d=Je(o-this.long0);return Math.abs(Math.abs(o-this.long0)-Math.PI)<=ke&&Math.abs(l+this.lat0)<=ke?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*c+this.coslat0*u*Math.cos(d)),e.x=this.a*t*u*Math.sin(d)+this.x0,e.y=this.a*t*(this.coslat0*c-this.sinlat0*u*Math.cos(d))+this.y0,e):(i=2*Math.atan(this.ssfn_(l,c,this.e))-we,r=Math.cos(i),n=Math.sin(i),Math.abs(this.coslat0)<=ke?(a=Qe(this.e,l*this.con,this.con*c),s=2*this.a*this.k0*a/this.cons,e.x=this.x0+s*Math.sin(o-this.long0),e.y=this.y0-this.con*s*Math.cos(o-this.long0),e):(Math.abs(this.sinlat0)<ke?(t=2*this.a*this.k0/(1+r*Math.cos(d)),e.y=t*n):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*r*Math.cos(d))),e.y=t*(this.cosX0*n-this.sinX0*r*Math.cos(d))+this.y0),e.x=t*r*Math.sin(d)+this.x0,e))},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,i,n,r,a,s=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var o=2*Math.atan(s/(2*this.a*this.k0));return t=this.long0,i=this.lat0,s<=ke?(e.x=t,e.y=i,e):(i=Math.asin(Math.cos(o)*this.sinlat0+e.y*Math.sin(o)*this.coslat0/s),t=Je(Math.abs(this.coslat0)<ke?this.lat0>0?this.long0+Math.atan2(e.x,-1*e.y):this.long0+Math.atan2(e.x,e.y):this.long0+Math.atan2(e.x*Math.sin(o),s*this.coslat0*Math.cos(o)-e.y*this.sinlat0*Math.sin(o))),e.x=t,e.y=i,e)}if(Math.abs(this.coslat0)<=ke){if(s<=ke)return i=this.lat0,t=this.long0,e.x=t,e.y=i,e;e.x*=this.con,e.y*=this.con,n=s*this.cons/(2*this.a*this.k0),i=this.con*Xe(this.e,n),t=this.con*Je(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else r=2*Math.atan(s*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,s<=ke?a=this.X0:(a=Math.asin(Math.cos(r)*this.sinX0+e.y*Math.sin(r)*this.cosX0/s),t=Je(this.long0+Math.atan2(e.x*Math.sin(r),s*this.cosX0*Math.cos(r)-e.y*this.sinX0*Math.sin(r)))),i=-1*Xe(this.e,Math.tan(.5*(we+a)));return e.x=t,e.y=i,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(e,t,i){return t*=i,Math.tan(.5*(we+e))*Math.pow((1-t)/(1+t),.5*i)}},Ht={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),i=this.a,n=1/this.rf,r=2*n-Math.pow(n,2),a=this.e=Math.sqrt(r);this.R=this.k0*i*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),o=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+a*t)/(1-a*t));this.K=s-this.alpha*o+this.alpha*a/2*l},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+i)+this.K,r=2*(Math.atan(Math.exp(n))-Math.PI/4),a=this.alpha*(e.x-this.lambda0),s=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(a));return e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,e.x=this.R*s+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,i=e.y-this.y0,n=t/this.R,r=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(n)),s=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(r))),o=this.lambda0+s/this.alpha,l=0,c=a,u=-1e3,d=0;Math.abs(c-u)>1e-7;){if(++d>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=o,e.y=c,e},names:["somerc"]},Bt=1e-7,Wt={init:function(){var e,t,i,n,r,a,s,o,l,c,u,d=0,h=0,f=0,p=0,g=0,m=0,v=0;this.no_off=ce(this),this.no_rot="no_rot"in this;var y=!1;"alpha"in this&&(y=!0);var _=!1;if("rectified_grid_angle"in this&&(_=!0),y&&(v=this.alpha),_&&(d=this.rectified_grid_angle*Me),y||_)h=this.longc;else if(f=this.long1,g=this.lat1,p=this.long2,m=this.lat2,Math.abs(g-m)<=Bt||(e=Math.abs(g))<=Bt||Math.abs(e-we)<=Bt||Math.abs(Math.abs(this.lat0)-we)<=Bt||Math.abs(Math.abs(m)-we)<=Bt)throw new Error;var b=1-this.es;t=Math.sqrt(b),Math.abs(this.lat0)>ke?(o=Math.sin(this.lat0),i=Math.cos(this.lat0),e=1-this.es*o*o,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/b),this.A=this.B*this.k0*t/e,(r=(n=this.B*t/(i*Math.sqrt(e)))*n-1)<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=n,this.E*=Math.pow(Qe(this.e,this.lat0,o),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=r=1),y||_?(y?(u=Math.asin(Math.sin(v)/n),_||(d=v)):(u=d,v=Math.asin(n*Math.sin(u))),this.lam0=h-Math.asin(.5*(r-1/r)*Math.tan(u))/this.B):(a=Math.pow(Qe(this.e,g,Math.sin(g)),this.B),s=Math.pow(Qe(this.e,m,Math.sin(m)),this.B),r=this.E/a,l=(s-a)/(s+a),c=((c=this.E*this.E)-s*a)/(c+s*a),(e=f-p)<-Math.pi?p-=De:e>Math.pi&&(p+=De),this.lam0=Je(.5*(f+p)-Math.atan(c*Math.tan(.5*this.B*(f-p))/l)/this.B),u=Math.atan(2*Math.sin(this.B*Je(f-this.lam0))/(r-1/r)),d=v=Math.asin(n*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(d),this.cosrot=Math.cos(d),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(v))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(Le-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(Le+r))},forward:function(e){var t,i,n,r,a,s,o,l,c={};if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-we)>ke){if(a=this.E/Math.pow(Qe(this.e,e.y,Math.sin(e.y)),this.B),s=1/a,t=.5*(a-s),i=.5*(a+s),r=Math.sin(this.B*e.x),n=(t*this.singam-r*this.cosgam)/i,Math.abs(Math.abs(n)-1)<ke)throw new Error;l=.5*this.ArB*Math.log((1-n)/(1+n)),s=Math.cos(this.B*e.x),o=Math.abs(s)<Bt?this.A*e.x:this.ArB*Math.atan2(t*this.cosgam+r*this.singam,s)}else l=e.y>0?this.v_pole_n:this.v_pole_s,o=this.ArB*e.y;return this.no_rot?(c.x=o,c.y=l):(o-=this.u_0,c.x=l*this.cosrot+o*this.sinrot,c.y=o*this.cosrot-l*this.sinrot),c.x=this.a*c.x+this.x0,c.y=this.a*c.y+this.y0,c},inverse:function(e){var t,i,n,r,a,s,o,l={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(i=e.y,t=e.x):(i=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*i),r=.5*(n-1/n),a=.5*(n+1/n),s=Math.sin(this.BrA*t),o=(s*this.cosgam+r*this.singam)/a,Math.abs(Math.abs(o)-1)<ke)l.x=0,l.y=o<0?-we:we;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=Xe(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(r*this.cosgam-s*this.singam,Math.cos(this.BrA*t))}return l.x+=this.lam0,l},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},qt={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<ke)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),i=Math.cos(this.lat1),n=Ue(this.e,t,i),r=Qe(this.e,this.lat1,t),a=Math.sin(this.lat2),s=Math.cos(this.lat2),o=Ue(this.e,a,s),l=Qe(this.e,this.lat2,a),c=Qe(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>ke?this.ns=Math.log(n/o)/Math.log(r/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,i=e.y;Math.abs(2*Math.abs(i)-Math.PI)<=ke&&(i=$e(i)*(we-2*ke));var n,r,a=Math.abs(Math.abs(i)-we);if(a>ke)n=Qe(this.e,i,Math.sin(i)),r=this.a*this.f0*Math.pow(n,this.ns);else{if((a=i*this.ns)<=0)return null;r=0}var s=this.ns*Je(t-this.long0);return e.x=this.k0*(r*Math.sin(s))+this.x0,e.y=this.k0*(this.rh-r*Math.cos(s))+this.y0,e},inverse:function(e){var t,i,n,r,a,s=(e.x-this.x0)/this.k0,o=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(s*s+o*o),i=1):(t=-Math.sqrt(s*s+o*o),i=-1);var l=0;if(0!==t&&(l=Math.atan2(i*s,i*o)),0!==t||this.ns>0){if(i=1/this.ns,n=Math.pow(t/(this.a*this.f0),i),-9999===(r=Xe(this.e,n)))return null}else r=-we;return a=Je(l/this.ns+this.long0),e.x=a,e.y=r,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},Gt={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,i,n,r,a,s,o,l=e.x,c=e.y,u=Je(l-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),n=-u*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),a=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(r)),s=this.n*a,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),e.y=o*Math.cos(s)/1,e.x=o*Math.sin(s)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,i,n,r,a,s,o,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),a=Math.sqrt(e.x*e.x+e.y*e.y),r=Math.atan2(e.y,e.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(r)),i=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(t)),e.x=this.long0-i/this.alfa,s=t,o=0;var c=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-e.y)<1e-10&&(o=1),s=e.y,c+=1}while(0===o&&c<15);return c>=15?null:e},names:["Krovak","krovak"]},Vt=function(e,t,i,n,r){return e*r-t*Math.sin(2*r)+i*Math.sin(4*r)-n*Math.sin(6*r)},Ut=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},$t=function(e){return.375*e*(1+.25*e*(1+.46875*e))},Jt=function(e){return.05859375*e*e*(1+.75*e)},Qt=function(e){return e*e*e*(35/3072)},Xt=function(e,t,i){var n=t*i;return e/Math.sqrt(1-n*n)},Yt=function(e){return Math.abs(e)<we?e:e-$e(e)*Math.PI},Zt=function(e,t,i,n,r){var a,s;a=e/t;for(var o=0;o<15;o++)if(s=(e-(t*a-i*Math.sin(2*a)+n*Math.sin(4*a)-r*Math.sin(6*a)))/(t-2*i*Math.cos(2*a)+4*n*Math.cos(4*a)-6*r*Math.cos(6*a)),a+=s,Math.abs(s)<=1e-10)return a;return NaN},Kt={init:function(){this.sphere||(this.e0=Ut(this.es),this.e1=$t(this.es),this.e2=Jt(this.es),this.e3=Qt(this.es),this.ml0=this.a*Vt(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,i,n=e.x,r=e.y;if(n=Je(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(r)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(r),Math.cos(n))-this.lat0);else{var a=Math.sin(r),s=Math.cos(r),o=Xt(this.a,this.e,a),l=Math.tan(r)*Math.tan(r),c=n*Math.cos(r),u=c*c,d=this.es*s*s/(1-this.es);t=o*c*(1-u*l*(1/6-(8-l+8*d)*u/120)),i=this.a*Vt(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+o*a/s*u*(.5+(5-l+6*d)*u/24)}return e.x=t+this.x0,e.y=i+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,i,n=e.x/this.a,r=e.y/this.a;if(this.sphere){var a=r+this.lat0;t=Math.asin(Math.sin(a)*Math.cos(n)),i=Math.atan2(Math.tan(n),Math.cos(a))}else{var s=this.ml0/this.a+r,o=Zt(s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-we)<=ke)return e.x=this.long0,e.y=we,r<0&&(e.y*=-1),e;var l=Xt(this.a,this.e,Math.sin(o)),c=l*l*l/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(o),2),d=n*this.a/l,h=d*d;t=o-l*Math.tan(o)/c*d*d*(.5-(1+3*u)*d*d/24),i=d*(1-h*(u/3+(1+3*u)*u*h/15))/Math.cos(o)}return e.x=Je(i+this.long0),e.y=Yt(t),e},names:["Cassini","Cassini_Soldner","cass"]},ei=function(e,t){var i;return e>1e-7?(i=e*t,(1-e*e)*(t/(1-i*i)-.5/e*Math.log((1-i)/(1+i)))):2*t},ti=.3333333333333333,ii=.17222222222222222,ni=.10257936507936508,ri=.06388888888888888,ai=.0664021164021164,si=.016415012942191543,oi={init:function(){var e=Math.abs(this.lat0);if(Math.abs(e-we)<ke?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<ke?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=ei(this.e,1),this.mmf=.5/(1-this.es),this.apa=ue(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=ei(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,i,n,r,a,s,o,l,c,u,d=e.x,h=e.y;if(d=Je(d-this.long0),this.sphere){if(a=Math.sin(h),u=Math.cos(h),n=Math.cos(d),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+u*n:1+this.sinph0*a+this.cosph0*u*n)<=ke)return null;t=(i=Math.sqrt(2/i))*u*Math.sin(d),i*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*u*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(h+this.lat0)<ke)return null;i=Le-.5*h,t=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(d),i*=n}}else{switch(o=0,l=0,c=0,n=Math.cos(d),r=Math.sin(d),a=Math.sin(h),s=ei(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=s/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:c=1+this.sinb1*o+this.cosb1*l*n;break;case this.EQUIT:c=1+l*n;break;case this.N_POLE:c=we+h,s=this.qp-s;break;case this.S_POLE:c=h-we,s=this.qp+s}if(Math.abs(c)<ke)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),i=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*o-this.sinb1*l*n):(c=Math.sqrt(2/(1+l*n)))*o*this.ymf,t=this.xmf*c*l*r;break;case this.N_POLE:case this.S_POLE:s>=0?(t=(c=Math.sqrt(s))*r,i=n*(this.mode===this.S_POLE?c:-c)):t=i=0}}return e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,i,n,r,a,s,o,l=e.x/this.a,c=e.y/this.a;if(this.sphere){var u,d=0,h=0;if(u=Math.sqrt(l*l+c*c),(i=.5*u)>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(h=Math.sin(i),d=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(u)<=ke?0:Math.asin(c*h/u),l*=h,c=d*u;break;case this.OBLIQ:i=Math.abs(u)<=ke?this.lat0:Math.asin(d*this.sinph0+c*h*this.cosph0/u),l*=h*this.cosph0,c=(d-Math.sin(i)*this.sinph0)*u;break;case this.N_POLE:c=-c,i=we-i;break;case this.S_POLE:i-=we}t=0!==c||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(l,c):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,c*=this.dd,(s=Math.sqrt(l*l+c*c))<ke)return e.x=this.long0,e.y=this.lat0,e;r=2*Math.asin(.5*s/this.rq),n=Math.cos(r),l*=r=Math.sin(r),this.mode===this.OBLIQ?(o=n*this.sinb1+c*r*this.cosb1/s,a=this.qp*o,c=s*this.cosb1*n-c*this.sinb1*r):(o=c*r/s,a=this.qp*o,c=s*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(c=-c),!(a=l*l+c*c))return e.x=this.long0,e.y=this.lat0,e;o=1-a/this.qp,this.mode===this.S_POLE&&(o=-o)}t=Math.atan2(l,c),i=de(Math.asin(o),this.apa)}return e.x=Je(this.long0+t),e.y=i,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},li=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)},ci={init:function(){Math.abs(this.lat1+this.lat2)<ke||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Ue(this.e3,this.sin_po,this.cos_po),this.qs1=ei(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Ue(this.e3,this.sin_po,this.cos_po),this.qs2=ei(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ei(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>ke?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,i=e.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=ei(this.e3,this.sin_phi,this.cos_phi),r=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,a=this.ns0*Je(t-this.long0),s=r*Math.sin(a)+this.x0,o=this.rh-r*Math.cos(a)+this.y0;return e.x=s,e.y=o,e},inverse:function(e){var t,i,n,r,a,s;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),n=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),n=-1),r=0,0!==t&&(r=Math.atan2(n*e.x,n*e.y)),n=t*this.ns0/this.a,this.sphere?s=Math.asin((this.c-n*n)/(2*this.ns0)):(i=(this.c-n*n)/this.ns0,s=this.phi1z(this.e3,i)),a=Je(r/this.ns0+this.long0),e.x=a,e.y=s,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var i,n,r,a,s,o=li(.5*t);if(e<ke)return o;for(var l=e*e,c=1;c<=25;c++)if(i=Math.sin(o),n=Math.cos(o),r=e*i,a=1-r*r,s=.5*a*a/n*(t/(1-l)-i/a+.5/e*Math.log((1-r)/(1+r))),o+=s,Math.abs(s)<=1e-7)return o;return null}},ui={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,i,n,r,a,s,o,l=e.x,c=e.y;return n=Je(l-this.long0),t=Math.sin(c),i=Math.cos(c),r=Math.cos(n),(a=this.sin_p14*t+this.cos_p14*i*r)>0||Math.abs(a)<=ke?(s=this.x0+1*this.a*i*Math.sin(n)/a,o=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*i*r)/a):(s=this.x0+this.infinity_dist*i*Math.sin(n),o=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*i*r)),e.x=s,e.y=o,e},inverse:function(e){var t,i,n,r,a,s;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(r=Math.atan2(t,this.rc),i=Math.sin(r),n=Math.cos(r),s=li(n*this.sin_p14+e.y*i*this.cos_p14/t),a=Math.atan2(e.x*i,t*this.cos_p14*n-e.y*this.sin_p14*i),a=Je(this.long0+a)):(s=this.phic0,a=0),e.x=a,e.y=s,e},names:["gnom"]},di=function(e,t){var i=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-i)<1e-6)return t<0?-1*we:we;for(var n,r,a,s,o=Math.asin(.5*t),l=0;l<30;l++)if(r=Math.sin(o),a=Math.cos(o),s=e*r,n=Math.pow(1-s*s,2)/(2*a)*(t/(1-e*e)-r/(1-s*s)+.5/e*Math.log((1-s)/(1+s))),o+=n,Math.abs(n)<=1e-10)return o;return NaN},hi={init:function(){this.sphere||(this.k0=Ue(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,i,n=e.x,r=e.y,a=Je(n-this.long0);if(this.sphere)t=this.x0+this.a*a*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else{var s=ei(this.e,Math.sin(r));t=this.x0+this.a*this.k0*a,i=this.y0+this.a*s*.5/this.k0}return e.x=t,e.y=i,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,i;return this.sphere?(t=Je(this.long0+e.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(i=di(this.e,2*e.y*this.k0/this.a),t=Je(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=i,e},names:["cea"]},fi={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,i=e.y,n=Je(t-this.long0),r=Yt(i-this.lat0);return e.x=this.x0+this.a*n*this.rc,e.y=this.y0+this.a*r,e},inverse:function(e){var t=e.x,i=e.y;return e.x=Je(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=Yt(this.lat0+(i-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},pi=20,gi={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ut(this.es),this.e1=$t(this.es),this.e2=Jt(this.es),this.e3=Qt(this.es),this.ml0=this.a*Vt(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,i,n,r=e.x,a=e.y,s=Je(r-this.long0);if(n=s*Math.sin(a),this.sphere)Math.abs(a)<=ke?(t=this.a*s,i=-1*this.a*this.lat0):(t=this.a*Math.sin(n)/Math.tan(a),i=this.a*(Yt(a-this.lat0)+(1-Math.cos(n))/Math.tan(a)));else if(Math.abs(a)<=ke)t=this.a*s,i=-1*this.ml0;else{var o=Xt(this.a,this.e,Math.sin(a))/Math.tan(a);t=o*Math.sin(n),i=this.a*Vt(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+o*(1-Math.cos(n))}return e.x=t+this.x0,e.y=i+this.y0,e},inverse:function(e){var t,i,n,r,a,s,o,l,c;if(n=e.x-this.x0,r=e.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=ke)t=Je(n/this.a+this.long0),i=0;else{s=this.lat0+r/this.a,o=n*n/this.a/this.a+s*s,l=s;var u;for(a=pi;a;--a)if(u=Math.tan(l),c=-1*(s*(l*u+1)-l-.5*(l*l+o)*u)/((l-s)/u-1),l+=c,Math.abs(c)<=ke){i=l;break}t=Je(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(i))}else if(Math.abs(r+this.ml0)<=ke)i=0,t=Je(this.long0+n/this.a);else{s=(this.ml0+r)/this.a,o=n*n/this.a/this.a+s*s,l=s;var d,h,f,p,g;for(a=pi;a;--a)if(g=this.e*Math.sin(l),d=Math.sqrt(1-g*g)*Math.tan(l),h=this.a*Vt(this.e0,this.e1,this.e2,this.e3,l),f=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),p=h/this.a,c=(s*(d*p+1)-p-.5*d*(p*p+o))/(this.es*Math.sin(2*l)*(p*p+o-2*s*p)/(4*d)+(s-p)*(d*f-2/Math.sin(2*l))-f),l-=c,Math.abs(c)<=ke){i=l;break}d=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),t=Je(this.long0+Math.asin(n*d/this.a)/Math.sin(i))}return e.x=t,e.y=i,e},names:["Polyconic","poly"]},mi={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,i=e.x,n=e.y-this.lat0,r=i-this.long0,a=n/be*1e-5,s=r,o=1,l=0;for(t=1;t<=10;t++)o*=a,l+=this.A[t]*o;var c,u=l,d=s,h=1,f=0,p=0,g=0;for(t=1;t<=6;t++)c=f*u+h*d,h=h*u-f*d,f=c,p=p+this.B_re[t]*h-this.B_im[t]*f,g=g+this.B_im[t]*h+this.B_re[t]*f;return e.x=g*this.a+this.x0,e.y=p*this.a+this.y0,e},inverse:function(e){var t,i,n=e.x,r=e.y,a=n-this.x0,s=(r-this.y0)/this.a,o=a/this.a,l=1,c=0,u=0,d=0;for(t=1;t<=6;t++)i=c*s+l*o,l=l*s-c*o,c=i,u=u+this.C_re[t]*l-this.C_im[t]*c,d=d+this.C_im[t]*l+this.C_re[t]*c;for(var h=0;h<this.iterations;h++){var f,p=u,g=d,m=s,v=o;for(t=2;t<=6;t++)f=g*u+p*d,p=p*u-g*d,g=f,m+=(t-1)*(this.B_re[t]*p-this.B_im[t]*g),v+=(t-1)*(this.B_im[t]*p+this.B_re[t]*g);p=1,g=0;var y=this.B_re[1],_=this.B_im[1];for(t=2;t<=6;t++)f=g*u+p*d,p=p*u-g*d,g=f,y+=t*(this.B_re[t]*p-this.B_im[t]*g),_+=t*(this.B_im[t]*p+this.B_re[t]*g);var b=y*y+_*_;u=(m*y+v*_)/b,d=(v*y-m*_)/b}var w=u,x=d,C=1,T=0;for(t=1;t<=9;t++)C*=w,T+=this.D[t]*C;var k=this.lat0+T*be*1e5,M=this.long0+x;return e.x=M,e.y=k,e},names:["New_Zealand_Map_Grid","nzmg"]},vi={init:function(){},forward:function(e){var t=e.x,i=e.y,n=Je(t-this.long0),r=this.x0+this.a*n,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return e.x=r,e.y=a,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Je(this.long0+e.x/this.a),i=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=i,e},names:["Miller_Cylindrical","mill"]},yi=20,_i={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=bt(this.es)},forward:function(e){var t,i,n=e.x,r=e.y;if(n=Je(n-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(r),s=yi;s;--s){var o=(this.m*r+Math.sin(r)-a)/(this.m+Math.cos(r));if(r-=o,Math.abs(o)<ke)break}else r=1!==this.n?Math.asin(this.n*Math.sin(r)):r;t=this.a*this.C_x*n*(this.m+Math.cos(r)),i=this.a*this.C_y*r}else{var l=Math.sin(r),c=Math.cos(r);i=this.a*wt(r,l,c,this.en),t=this.a*n*c/Math.sqrt(1-this.es*l*l)}return e.x=t,e.y=i,e},inverse:function(e){var t,i,n,r;return e.x-=this.x0,n=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,n/=this.C_x*(this.m+Math.cos(t)),this.m?t=li((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=li(Math.sin(t)/this.n)),n=Je(n+this.long0),t=Yt(t)):(t=xt(e.y/this.a,this.es,this.en),(r=Math.abs(t))<we?(r=Math.sin(t),i=this.long0+e.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(t)),n=Je(i)):r-ke<we&&(n=this.long0)),e.x=n,e.y=t,e},names:["Sinusoidal","sinu"]},bi={init:function(){},forward:function(e){for(var t=e.x,i=e.y,n=Je(t-this.long0),r=i,a=Math.PI*Math.sin(i);;){var s=-(r+Math.sin(r)-a)/(1+Math.cos(r));if(r+=s,Math.abs(s)<ke)break}r/=2,Math.PI/2-Math.abs(i)<ke&&(n=0);var o=.900316316158*this.a*n*Math.cos(r)+this.x0,l=1.4142135623731*this.a*Math.sin(r)+this.y0;return e.x=o,e.y=l,e},inverse:function(e){var t,i;e.x-=this.x0,e.y-=this.y0,i=e.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),t=Math.asin(i);var n=Je(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*t+Math.sin(2*t))/Math.PI,Math.abs(i)>1&&(i=1);var r=Math.asin(i);return e.x=n,e.y=r,e},names:["Mollweide","moll"]},wi={init:function(){Math.abs(this.lat1+this.lat2)<ke||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ut(this.es),this.e1=$t(this.es),this.e2=Jt(this.es),this.e3=Qt(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Ue(this.e,this.sinphi,this.cosphi),this.ml1=Vt(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<ke?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Ue(this.e,this.sinphi,this.cosphi),this.ml2=Vt(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Vt(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,i=e.x,n=e.y;if(this.sphere)t=this.a*(this.g-n);else{var r=Vt(this.e0,this.e1,this.e2,this.e3,n);t=this.a*(this.g-r)}var a=this.ns*Je(i-this.long0),s=this.x0+t*Math.sin(a),o=this.y0+this.rh-t*Math.cos(a);return e.x=s,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,i,n,r;this.ns>=0?(i=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(i=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var a=0;if(0!==i&&(a=Math.atan2(t*e.x,t*e.y)),this.sphere)return r=Je(this.long0+a/this.ns),n=Yt(this.g-i/this.a),e.x=r,e.y=n,e;var s=this.g-i/this.a;return n=Zt(s,this.e0,this.e1,this.e2,this.e3),r=Je(this.long0+a/this.ns),e.x=r,e.y=n,e},names:["Equidistant_Conic","eqdc"]},xi={init:function(){this.R=this.a},forward:function(e){var t,i,n=e.x,r=e.y,a=Je(n-this.long0);Math.abs(r)<=ke&&(t=this.x0+this.R*a,i=this.y0);var s=li(2*Math.abs(r/Math.PI));(Math.abs(a)<=ke||Math.abs(Math.abs(r)-we)<=ke)&&(t=this.x0,i=r>=0?this.y0+Math.PI*this.R*Math.tan(.5*s):this.y0+Math.PI*this.R*-Math.tan(.5*s));var o=.5*Math.abs(Math.PI/a-a/Math.PI),l=o*o,c=Math.sin(s),u=Math.cos(s),d=u/(c+u-1),h=d*d,f=d*(2/c-1),p=f*f,g=Math.PI*this.R*(o*(d-p)+Math.sqrt(l*(d-p)*(d-p)-(p+l)*(h-p)))/(p+l);a<0&&(g=-g),t=this.x0+g;var m=l+d;return g=Math.PI*this.R*(f*m-o*Math.sqrt((p+l)*(l+1)-m*m))/(p+l),i=r>=0?this.y0+g:this.y0-g,e.x=t,e.y=i,e},inverse:function(e){var t,i,n,r,a,s,o,l,c,u,d,h,f;return e.x-=this.x0,e.y-=this.y0,d=Math.PI*this.R,n=e.x/d,r=e.y/d,a=n*n+r*r,s=-Math.abs(r)*(1+a),o=s-2*r*r+n*n,l=-2*s+1+2*r*r+a*a,f=r*r/l+(2*o*o*o/l/l/l-9*s*o/l/l)/27,c=(s-o*o/3/l)/l,u=2*Math.sqrt(-c/3),d=3*f/c/u,Math.abs(d)>1&&(d=d>=0?1:-1),h=Math.acos(d)/3,i=e.y>=0?(-u*Math.cos(h+Math.PI/3)-o/3/l)*Math.PI:-(-u*Math.cos(h+Math.PI/3)-o/3/l)*Math.PI,t=Math.abs(n)<ke?this.long0:Je(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(n*n-r*r)+a*a))/2/n),e.x=t,e.y=i,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},Ci={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,i,n,r,a,s,o,l,c,u,d,h,f,p,g,m,v,y,_,b,w,x,C,T=e.x,k=e.y,M=Math.sin(e.y),S=Math.cos(e.y),L=Je(T-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=ke?(e.x=this.x0+this.a*(we-k)*Math.sin(L),e.y=this.y0-this.a*(we-k)*Math.cos(L),e):Math.abs(this.sin_p12+1)<=ke?(e.x=this.x0+this.a*(we+k)*Math.sin(L),e.y=this.y0+this.a*(we+k)*Math.cos(L),e):(y=this.sin_p12*M+this.cos_p12*S*Math.cos(L),m=Math.acos(y),v=m?m/Math.sin(m):1,e.x=this.x0+this.a*v*S*Math.sin(L),e.y=this.y0+this.a*v*(this.cos_p12*M-this.sin_p12*S*Math.cos(L)),e):(t=Ut(this.es),i=$t(this.es),n=Jt(this.es),r=Qt(this.es),Math.abs(this.sin_p12-1)<=ke?(a=this.a*Vt(t,i,n,r,we),s=this.a*Vt(t,i,n,r,k),e.x=this.x0+(a-s)*Math.sin(L),e.y=this.y0-(a-s)*Math.cos(L),e):Math.abs(this.sin_p12+1)<=ke?(a=this.a*Vt(t,i,n,r,we),s=this.a*Vt(t,i,n,r,k),e.x=this.x0+(a+s)*Math.sin(L),e.y=this.y0+(a+s)*Math.cos(L),e):(o=M/S,l=Xt(this.a,this.e,this.sin_p12),c=Xt(this.a,this.e,M),u=Math.atan((1-this.es)*o+this.es*l*this.sin_p12/(c*S)),d=Math.atan2(Math.sin(L),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(L)),_=0===d?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(d)-Math.PI)<=ke?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(L)*Math.cos(u)/Math.sin(d)),h=this.e*this.sin_p12/Math.sqrt(1-this.es),f=this.e*this.cos_p12*Math.cos(d)/Math.sqrt(1-this.es),p=h*f,g=f*f,b=_*_,w=b*_,x=w*_,C=x*_,m=l*_*(1-b*g*(1-g)/6+w/8*p*(1-2*g)+x/120*(g*(4-7*g)-3*h*h*(1-7*g))-C/48*p),e.x=this.x0+m*Math.sin(d),e.y=this.y0+m*Math.cos(d),e))},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,i,n,r,a,s,o,l,c,u,d,h,f,p,g,m,v,y,_,b,w,x,C,T;if(this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*we*this.a)return;return i=t/this.a,n=Math.sin(i),r=Math.cos(i),a=this.long0,Math.abs(t)<=ke?s=this.lat0:(s=li(r*this.sin_p12+e.y*n*this.cos_p12/t),o=Math.abs(this.lat0)-we,a=Je(Math.abs(o)<=ke?this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y):this.long0+Math.atan2(e.x*n,t*this.cos_p12*r-e.y*this.sin_p12*n))),e.x=a,e.y=s,e}return l=Ut(this.es),c=$t(this.es),u=Jt(this.es),d=Qt(this.es),Math.abs(this.sin_p12-1)<=ke?(h=this.a*Vt(l,c,u,d,we),t=Math.sqrt(e.x*e.x+e.y*e.y),f=h-t,s=Zt(f/this.a,l,c,u,d),a=Je(this.long0+Math.atan2(e.x,-1*e.y)),e.x=a,e.y=s,e):Math.abs(this.sin_p12+1)<=ke?(h=this.a*Vt(l,c,u,d,we),t=Math.sqrt(e.x*e.x+e.y*e.y),f=t-h,s=Zt(f/this.a,l,c,u,d),a=Je(this.long0+Math.atan2(e.x,e.y)),e.x=a,e.y=s,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),m=Math.atan2(e.x,e.y),p=Xt(this.a,this.e,this.sin_p12),v=Math.cos(m),y=this.e*this.cos_p12*v,_=-y*y/(1-this.es),b=3*this.es*(1-_)*this.sin_p12*this.cos_p12*v/(1-this.es),w=t/p,x=w-_*(1+_)*Math.pow(w,3)/6-b*(1+3*_)*Math.pow(w,4)/24,C=1-_*x*x/2-w*x*x*x/6,g=Math.asin(this.sin_p12*Math.cos(x)+this.cos_p12*Math.sin(x)*v),a=Je(this.long0+Math.asin(Math.sin(m)*Math.sin(x)/Math.cos(g))),T=Math.sin(g),s=Math.atan2((T-this.es*C*this.sin_p12)*Math.tan(g),T*(1-this.es)),e.x=a,e.y=s,e)},names:["Azimuthal_Equidistant","aeqd"]},Ti={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,i,n,r,a,s,o,l=e.x,c=e.y;return n=Je(l-this.long0),t=Math.sin(c),i=Math.cos(c),r=Math.cos(n),((a=this.sin_p14*t+this.cos_p14*i*r)>0||Math.abs(a)<=ke)&&(s=1*this.a*i*Math.sin(n),o=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*i*r)),e.x=s,e.y=o,e},inverse:function(e){var t,i,n,r,a,s,o;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),i=li(t/this.a),n=Math.sin(i),r=Math.cos(i),s=this.long0,Math.abs(t)<=ke?(o=this.lat0,e.x=s,e.y=o,e):(o=li(r*this.sin_p14+e.y*n*this.cos_p14/t),a=Math.abs(this.lat0)-we,Math.abs(a)<=ke?(s=Je(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y)),e.x=s,e.y=o,e):(s=Je(this.long0+Math.atan2(e.x*n,t*this.cos_p14*r-e.y*this.sin_p14*n)),e.x=s,e.y=o,e))},names:["ortho"]},ki={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Mi={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4},Si={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=we-Le/2?this.face=ki.TOP:this.lat0<=-(we-Le/2)?this.face=ki.BOTTOM:Math.abs(this.long0)<=Le?this.face=ki.FRONT:Math.abs(this.long0)<=we+Le?this.face=this.long0>0?ki.RIGHT:ki.LEFT:this.face=ki.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(e){var t,i,n,r,a,s,o={x:0,y:0},l={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,i=e.x,this.face===ki.TOP)r=we-t,i>=Le&&i<=we+Le?(l.value=Mi.AREA_0,n=i-we):i>we+Le||i<=-(we+Le)?(l.value=Mi.AREA_1,n=i>0?i-je:i+je):i>-(we+Le)&&i<=-Le?(l.value=Mi.AREA_2,n=i+we):(l.value=Mi.AREA_3,n=i);else if(this.face===ki.BOTTOM)r=we+t,i>=Le&&i<=we+Le?(l.value=Mi.AREA_0,n=-i+we):i<Le&&i>=-Le?(l.value=Mi.AREA_1,n=-i):i<-Le&&i>=-(we+Le)?(l.value=Mi.AREA_2,n=-i-we):(l.value=Mi.AREA_3,n=i>0?-i+je:-i-je);else{var c,u,d,h,f,p;this.face===ki.RIGHT?i=fe(i,+we):this.face===ki.BACK?i=fe(i,+je):this.face===ki.LEFT&&(i=fe(i,-we)),h=Math.sin(t),f=Math.cos(t),p=Math.sin(i),c=f*Math.cos(i),u=f*p,d=h,this.face===ki.FRONT?n=he(r=Math.acos(c),d,u,l):this.face===ki.RIGHT?n=he(r=Math.acos(u),d,-c,l):this.face===ki.BACK?n=he(r=Math.acos(-c),d,-u,l):this.face===ki.LEFT?n=he(r=Math.acos(-u),d,c,l):(r=n=0,l.value=Mi.AREA_0)}return s=Math.atan(12/je*(n+Math.acos(Math.sin(n)*Math.cos(Le))-we)),a=Math.sqrt((1-Math.cos(r))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(n))))),l.value===Mi.AREA_1?s+=we:l.value===Mi.AREA_2?s+=je:l.value===Mi.AREA_3&&(s+=1.5*je),o.x=a*Math.cos(s),o.y=a*Math.sin(s),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,e.x=o.x,e.y=o.y,e},inverse:function(e){var t,i,n,r,a,s,o,l,c,u={lam:0,phi:0},d={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,i=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?d.value=Mi.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(d.value=Mi.AREA_1,t-=we):e.x<0&&-e.x>=Math.abs(e.y)?(d.value=Mi.AREA_2,t=t<0?t+je:t-je):(d.value=Mi.AREA_3,t+=we),c=je/12*Math.tan(t),a=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),s=Math.atan(a),n=Math.cos(t),r=Math.tan(i),(o=1-n*n*r*r*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?o=-1:o>1&&(o=1),this.face===ki.TOP)l=Math.acos(o),u.phi=we-l,d.value===Mi.AREA_0?u.lam=s+we:d.value===Mi.AREA_1?u.lam=s<0?s+je:s-je:d.value===Mi.AREA_2?u.lam=s-we:u.lam=s;else if(this.face===ki.BOTTOM)l=Math.acos(o),u.phi=l-we,d.value===Mi.AREA_0?u.lam=-s+we:d.value===Mi.AREA_1?u.lam=-s:d.value===Mi.AREA_2?u.lam=-s-we:u.lam=s<0?-s-je:-s+je;else{var h,f,p;c=(h=o)*h,f=(c+=(p=c>=1?0:Math.sqrt(1-c)*Math.sin(s))*p)>=1?0:Math.sqrt(1-c),d.value===Mi.AREA_1?(c=f,f=-p,p=c):d.value===Mi.AREA_2?(f=-f,p=-p):d.value===Mi.AREA_3&&(c=f,f=p,p=-c),this.face===ki.RIGHT?(c=h,h=-f,f=c):this.face===ki.BACK?(h=-h,f=-f):this.face===ki.LEFT&&(c=h,h=f,f=-c),u.phi=Math.acos(-p)-we,u.lam=Math.atan2(f,h),this.face===ki.RIGHT?u.lam=fe(u.lam,-we):this.face===ki.BACK?u.lam=fe(u.lam,-je):this.face===ki.LEFT&&(u.lam=fe(u.lam,+we))}if(0!==this.es){var g,m,v;g=u.phi<0?1:0,m=Math.tan(u.phi),v=this.b/Math.sqrt(m*m+this.one_minus_f_squared),u.phi=Math.atan(Math.sqrt(this.a*this.a-v*v)/(this.one_minus_f*v)),g&&(u.phi=-u.phi)}return u.lam+=this.long0,e.x=u.lam,e.y=u.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Li=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Di=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],ji=.8487,Ii=1.3523,Ei=Se/5,Ai=1/Ei,Pi=18,Oi=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))},Ni=function(e,t){return e[1]+t*(2*e[2]+3*t*e[3])},Ri={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(e){var t=Je(e.x-this.long0),i=Math.abs(e.y),n=Math.floor(i*Ei);n<0?n=0:n>=Pi&&(n=Pi-1),i=Se*(i-Ai*n);var r={x:Oi(Li[n],i)*t,y:Oi(Di[n],i)};return e.y<0&&(r.y=-r.y),r.x=r.x*this.a*ji+this.x0,r.y=r.y*this.a*Ii+this.y0,r},inverse:function(e){var t={x:(e.x-this.x0)/(this.a*ji),y:Math.abs(e.y-this.y0)/(this.a*Ii)};if(t.y>=1)t.x/=Li[Pi][0],t.y=e.y<0?-we:we;else{var i=Math.floor(t.y*Pi);for(i<0?i=0:i>=Pi&&(i=Pi-1);;)if(Di[i][0]>t.y)--i;else{if(!(Di[i+1][0]<=t.y))break;++i}var n=Di[i],r=5*(t.y-n[0])/(Di[i+1][0]-n[0]);r=pe(function(e){return(Oi(n,e)-t.y)/Ni(n,e)},r,ke,100),t.x/=Oi(Li[i],r),t.y=(5*i+r)*Me,e.y<0&&(t.y=-t.y)}return t.x=Je(t.x+this.long0),t},names:["Robinson","robin"]},Fi={init:function(){this.name="geocent"},forward:function(e){return A(e,this.es,this.a)},inverse:function(e){return P(e,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},zi={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Hi={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}},Bi={init:function(){if(Object.keys(Hi).forEach(function(e){if(void 0===this[e])this[e]=Hi[e].def;else{if(Hi[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);Hi[e].num&&(this[e]=parseFloat(this[e]))}Hi[e].degrees&&(this[e]=this[e]*Me)}.bind(this)),Math.abs(Math.abs(this.lat0)-we)<ke?this.mode=this.lat0<0?zi.S_POLE:zi.N_POLE:Math.abs(this.lat0)<ke?this.mode=zi.EQUIT:(this.mode=zi.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)},forward:function(e){e.x-=this.long0;var t,i,n=Math.sin(e.y),r=Math.cos(e.y),a=Math.cos(e.x);switch(this.mode){case zi.OBLIQ:i=this.sinph0*n+this.cosph0*r*a;break;case zi.EQUIT:i=r*a;break;case zi.S_POLE:i=-n;break;case zi.N_POLE:i=n}switch(i=this.pn1/(this.p-i),t=i*r*Math.sin(e.x),this.mode){case zi.OBLIQ:i*=this.cosph0*n-this.sinph0*r*a;break;case zi.EQUIT:i*=n;break;case zi.N_POLE:i*=-r*a;break;case zi.S_POLE:i*=r*a}var s,o;return s=i*this.cg+t*this.sg,o=1/(s*this.sw*this.h1+this.cw),t=(t*this.cg-i*this.sg)*this.cw*o,i=s*o,e.x=t*this.a,e.y=i*this.a,e},inverse:function(e){e.x/=this.a,e.y/=this.a;var t,i,n,r={x:e.x,y:e.y};n=1/(this.pn1-e.y*this.sw),t=this.pn1*e.x*n,i=this.pn1*e.y*this.cw*n,e.x=t*this.cg+i*this.sg,e.y=i*this.cg-t*this.sg;var a=kt(e.x,e.y);if(Math.abs(a)<ke)r.x=0,r.y=e.y;else{var s,o;switch(o=1-a*a*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/a+a/this.pn1),s=Math.sqrt(1-o*o),this.mode){case zi.OBLIQ:r.y=Math.asin(s*this.sinph0+e.y*o*this.cosph0/a),e.y=(s-this.sinph0*Math.sin(r.y))*a,e.x*=o*this.cosph0;break;case zi.EQUIT:r.y=Math.asin(e.y*o/a),e.y=s*a,e.x*=o;break;case zi.N_POLE:r.y=Math.asin(s),e.y=-e.y;break;case zi.S_POLE:r.y=-Math.asin(s)}r.x=Math.atan2(e.x,e.y)}return e.x=r.x+this.long0,e.y=r.y,e},names:["Tilted_Perspective","tpers"]},Wi={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(e){var t,i,n,r,a=e.x,s=e.y;if(a-=this.long0,"ellipse"===this.shape){s=Math.atan(this.radius_p2*Math.tan(s));var o=this.radius_p/kt(this.radius_p*Math.cos(s),Math.sin(s));if(i=o*Math.cos(a)*Math.cos(s),n=o*Math.sin(a)*Math.cos(s),r=o*Math.sin(s),(this.radius_g-i)*i-n*n-r*r*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;t=this.radius_g-i,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/kt(r,t)),e.y=this.radius_g_1*Math.atan(r/t)):(e.x=this.radius_g_1*Math.atan(n/t),e.y=this.radius_g_1*Math.atan(r/kt(n,t)))}else"sphere"===this.shape&&(t=Math.cos(s),i=Math.cos(a)*t,n=Math.sin(a)*t,r=Math.sin(s),t=this.radius_g-i,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/kt(r,t)),e.y=this.radius_g_1*Math.atan(r/t)):(e.x=this.radius_g_1*Math.atan(n/t),e.y=this.radius_g_1*Math.atan(r/kt(n,t))));return e.x=e.x*this.a,e.y=e.y*this.a,e},inverse:function(e){var t,i,n,r,a=-1,s=0,o=0;if(e.x=e.x/this.a,e.y=e.y/this.a,"ellipse"===this.shape){this.flip_axis?(o=Math.tan(e.y/this.radius_g_1),s=Math.tan(e.x/this.radius_g_1)*kt(1,o)):(s=Math.tan(e.x/this.radius_g_1),o=Math.tan(e.y/this.radius_g_1)*kt(1,s));var l=o/this.radius_p;if(t=s*s+l*l+a*a,i=2*this.radius_g*a,(n=i*i-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;r=(-i-Math.sqrt(n))/(2*t),a=this.radius_g+r*a,s*=r,o*=r,e.x=Math.atan2(s,a),e.y=Math.atan(o*Math.cos(e.x)/a),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if("sphere"===this.shape){if(this.flip_axis?(o=Math.tan(e.y/this.radius_g_1),s=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+o*o)):(s=Math.tan(e.x/this.radius_g_1),o=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+s*s)),t=s*s+o*o+a*a,i=2*this.radius_g*a,(n=i*i-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;r=(-i-Math.sqrt(n))/(2*t),a=this.radius_g+r*a,s*=r,o*=r,e.x=Math.atan2(s,a),e.y=Math.atan(o*Math.cos(e.x)/a)}return e.x=e.x+this.long0,e},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};return U.defaultDatum="WGS84",U.Proj=I,U.WGS84=new U.Proj("WGS84"),U.Point=le,U.toPoint=ot,U.defs=n,U.nadgrid=function(e,t){var i=new DataView(t),n=T(i),r=k(i,n);r.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var a={header:r,subgrids:S(i,r,n)};return rt[e]=a,a},U.transform=q,U.mgrs=yt,U.version="2.8.0",function(e){e.Proj.projections.add(Ct),e.Proj.projections.add(Et),e.Proj.projections.add(Pt),e.Proj.projections.add(Ft),e.Proj.projections.add(zt),e.Proj.projections.add(Ht),e.Proj.projections.add(Wt),e.Proj.projections.add(qt),e.Proj.projections.add(Gt),e.Proj.projections.add(Kt),e.Proj.projections.add(oi),e.Proj.projections.add(ci),e.Proj.projections.add(ui),e.Proj.projections.add(hi),e.Proj.projections.add(fi),e.Proj.projections.add(gi),e.Proj.projections.add(mi),e.Proj.projections.add(vi),e.Proj.projections.add(_i),e.Proj.projections.add(bi),e.Proj.projections.add(wi),e.Proj.projections.add(xi),e.Proj.projections.add(Ci),e.Proj.projections.add(Ti),e.Proj.projections.add(Si),e.Proj.projections.add(Ri),e.Proj.projections.add(Fi),e.Proj.projections.add(Bi),e.Proj.projections.add(Wi)}(U),U});(function(e,r,t,a){"use strict";var s,o,l,c,u=[],d=null,h=null,f="red";giscloud.ui.alert={show:function(e,t,i,n){if(!s||e===a||typeof e!=="string"){return this}if(h!==null){clearTimeout(h);h=null}if(d!==null){clearTimeout(d);d=null}if(i&&s.data("gc-alert-showing")){u.push({msg:o,color:f,duration:l,options:c})}s.html(r("<div/>").append(e)).css("margin-left",-.5*s.outerWidth()).data("gc-alert-showing",true).stop(true,true).fadeIn("fast");if(n&&n.closeButton){s.append(r("<a />",{class:"btn btn-default gc-alert-close-button "+(f==="green"||s.hasClass("gc-green-alert")?"gc-alert-close-button-green":"gc-alert-close-button-red"),text:"Close",href:"#"}))}if(!isNaN(t)&&t){d=setTimeout(r.proxy(giscloud.ui.alert.hide,giscloud.ui.alert),t)}o=e;l=t;c=n;return this},hide:function(){var e;if(!s){return this}if(u.length){e=u.pop();s.hide().removeData("gc-alert-showing");return this.color(e.color).show(e.msg,e.duration,false,e.options)}else{h=setTimeout(function(){h=null;s.fadeOut("fast",function(){s.removeData("gc-alert-showing")})},0)}return this},color:function(e,t,i,n,r){if(!s){return this}f=s.hasClass("gc-green-alert")?"green":"red";if(e==="green"){s.addClass("gc-green-alert");s.removeClass("gc-red-alert")}else if(e==="red"){s.addClass("gc-red-alert");s.removeClass("gc-green-alert")}return this.show(t,i,n,r)},red:function(e,t,i,n){return this.color("red",e,t,i,n)},green:function(e,t,i,n){return this.color("green",e,t,i,n)},get:function(){if(!s){return this}return{msg:s.html(),color:s.hasClass("gc-red-alert")?"red":"green"}}};giscloud.ui.redAlert=function(e,t,i){return giscloud.ui.alert.color("red").show(e,t,null,i)};giscloud.ui.greenAlert=function(e,t,i){return giscloud.ui.alert.color("green").show(e,t,null,i)};r(function(){s=r("<div class='gc-alert'></div>").appendTo(r("body")).on("click",".gc-alert-close-button",function e(t){t.stopPropagation();giscloud.ui.alert.hide()})})})(window,giscloud.exposeJQuery(),giscloud.common());(function(M,S,L,e){"use strict";giscloud.ui.Search=function(u,l,e){var c=this,d={giscloud:true,google:false,here:false,buttons:true,selectFeature:true,showFeatureInfo:true,clearButton:true,mobile:M.fno&&M.fno.mobilebrowser,app_code:M.fno&&fno.here_search_app_code,app_id:M.fno&&fno.here_search_app_id,embed:false};S.extend(d,e);function h(){if(c._search_options.find(".gc-sr-giscloud").hasClass("active")){if(d.giscloud)c.gc_input.show().first().focus();if(d.google||d.here)c.go_input.hide()}else{if(d.google||d.here)c.go_input.show().focus();if(d.giscloud)c.gc_input.hide()}}function f(){var e=u.layers,t;if(!e)return[];t=["tile","buffer","raster","wms","wmts","folder","feature"];return S.map(e,function(e){return e&&e.sourceType&&S.inArray(e.sourceType,t)===-1?e:null})}function s(e,t){return giscloud.ui.alert.color("red").show(e,t)}function o(e,t){return giscloud.ui.alert.color("green").show(e,t)}function p(e){return S.map(e,function(e){var t=u.instance.epsg*1?u.instance.epsg*1:900913;if(e.__here){var i;if(typeof t==="number"){t=giscloud.proj4.defs("EPSG:"+t)?"EPSG:"+t:"GC_MAP_CURRENT"}if(e.position){var n=new giscloud.LonLat(e.position[1],e.position[0]);n.transform(4326,t);i=new giscloud.Bounds(n.lon,n.lat,n.lon,n.lat)}else if(e.bbox){var r=new giscloud.LonLat(e.bbox[0],e.bbox[1]),a=new giscloud.LonLat(e.bbox[2],e.bbox[3]);r.transform(4326,t);a.transform(4326,t);i=new giscloud.Bounds(r.lon,r.lat,a.lon,a.lat)}else{return}var s,o=e.title;if(e.vicinity)s=e.vicinity.replace(/<br\/>/gi,", ");return{result:o,desc:s,bounds:i,__here:true}}var l=new giscloud.Feature(e),o=T(e.__layer_id,l.data,e);return{id:l.id,result:o,data:l.data,meta:e.__meta,bounds:l.bounds,layerId:l.layerId}})}function a(e,t){var i,n,r,a,s=[];for(i=0,a=t.length;i<a;i++){for(n=0,r=Object.keys(e).length;n<r;n++){if(e[n].layerId===t[i]){s.push(e[n])}}if(s.length>0){return s}}}function g(e,t){var i,n=Object.keys(t),r=n.indexOf("orderBy");if(r===-1)r=n.indexOf("byOrder");if(r!==-1){n.splice(r,1)}i=a(e,n);o(L.__("Results")+": "+i.length,2e3);x(i,"id")}function r(e){c.spinner.hide();var t,i=u.options.RESULT_FIELDS,n=i?JSON.parse(i):null,r=n?n.orderBy||n.byOrder:null,a=n!=null?Object.keys(n).length-1:0;if(!e||!e.total){s("No results.",2e3);S(".gc-search-box").remove()}else{t=p(e.data);if(t.length>1&&r==="true"&&a>1){g(t,n)}else{o(L.__("Results")+": "+e.total,2e3);x(t,"id")}}}function m(e,t){var i=e.at;i.transform(t,4326);return S.getJSON(location.protocol+"//places.api.here.com/places/v1/autosuggest",{app_code:d.app_code,app_id:d.app_id,at:i.lat+","+i.lon,pretty:false,q:e.query})}function v(e){var t={data:e.results,total:e.results.length};S.each(t.data,function(e,t){t.__here=true});r(t)}function y(){var e=c.go_input.val(),t=u.instance.epsg*1?u.instance.epsg*1:900913;if(!(e.length>1)){w();return}var i=u.bounds().center(),n={query:e,at:i};c.spinner.show();if(typeof t==="number"){t=giscloud.proj4.defs("EPSG:"+t)?"EPSG:"+t:"GC_MAP_CURRENT"}m(n,t).done(v)}function n(e,t){var i=u.bounds().center(),n={query:e,columns_meta:true,perpage:100,fields:t,x:i.lon,y:i.lat,proj4:u.instance.projection,srid:u.instance.epsg};c.spinner.show();return S.when(giscloud.rest.get("search.json",n)).then(function(e){return{total:e.total,data:e.data}}).done(r)}function _(e,t){var i=k();o(L.__("Searching")+"...");n(t,i).done(r).fail(function(){s(L.__("Error"))})}function b(e,t,i){var n,r=[{header:e,dataIndex:e,hidden:true}];for(n in t){if(n===e){continue}if(t.hasOwnProperty(n)){if(n==="bounds"||n==="layerId"||n==="data"||n==="meta"){continue}r.push({header:i&&i[n]||n,dataIndex:n,hidden:false})}}return r}function w(){S(".gc-search-box").remove()}function x(e,i,t){var n,r,o;if(!S.isArray(e)||e.length===0){return}if(i==null){i="__id"}n=b(i,e[0],t);S(giscloud.ui.search).triggerHandler("results",[e,n]);var a=false;e=S.map(e,function(e){var t;if(e[i]==null){e[i]=""}t=S.extend({__id:e[i]},e);if(e.__here)a=true;if(t.bounds){if(!t.bounds.valid()){t.bounds=giscloud.ui.map?giscloud.ui.map.bounds().clone():new giscloud.Bounds(0,0,0,0)}S.extend(t,{__xmin:t.bounds.left,__xmax:t.bounds.right,__ymin:t.bounds.bottom,__ymax:t.bounds.top})}return t});S(".gc-search-box").remove();r=S("<div/>").addClass("gc-search-box").appendTo(S("#"+l));o=S("<ul/>");S.each(e,function(e,t){var i,n,r,a=t.result,s;if(!t.layerId){s="";if(!a){a=""}}else{i=u.layerById(t.layerId);s=i?i.name:""}if(t.__here)s=t.desc;n=S("<li/>").data("resultData",t).click(C).appendTo(o);if(a.indexOf("___json")>-1&&giscloud&&giscloud.FileFormats){a=GISCLOUD.FileFormats.formatRecordValue(a,t.layerId,{featureId:t.__id,json:true,lightbox:true});if(S.isArray(a)){a=a.join(" ")}}r=S("<a/>").text(a).append(" <span class='comment small'>"+giscloud.xssSafe(s)+"</span>").appendTo(n)});o.appendTo(r);c.__open=true}function C(e){var t=S(e.currentTarget||e.target),i=t.is("li")?t:t.closest("li"),n=S.extend(true,{},i.data("resultData")),r=n&&new giscloud.Bounds(n.__xmin,n.__ymin,n.__xmax,n.__ymax);if(r){L.zoomToBounds(u,r)}u.markers.forEach(function(e){u.removeMarker(e)});if(n.__here){var a=new giscloud.FlagMarker;a.position(r.center()).content(n.result+(n.desc?", "+n.desc:""));u.addMarker(a)}if(d.showFeatureInfo&&n.data){if(M.gcapp&&gcapp.selo&&gcapp.selo.showRecordInfo){n.count=1;n.format=true;gcapp.selo.showRecordInfo(n)}else if(!d.embed){L.viewerShowFeatureInfo(u,n.layerId,n.__id,n.bounds.center(),d.renderFunction)}}if(d.selectFeature){u.selection.clear();if(d.embed){M.selectionFromSearch=true}u.selectFeature(n.layerId,n.__id,true)}if(n.__here){S("#gc_here_address_input").val(t.text());S(".gc-search-box").hide()}else if(d.embed){S(".gc-search-box").hide()}}function T(e,t,i){var n,r,a,s,o,l,c=u.options.RESULT_FIELDS;n=c?S.parseJSON(c):null;if(!n||!n[e])return i.__match;r=n[e];a=[];for(o=0,l=r.length;o<l;o++){s=r[o];if(s==="FID"){a.push(i.__id)}else{a.push(t[s])}}return a.join(" ")}function k(e){var t,i=u.options.SEARCH_FIELDS,n=i?S.parseJSON(i):null;if(e){t=S.map(e,function(e){var t=e.lid,i="*";if(n){if(n[t]){i=n[t].join(",");return t+"~"+i}}else{return t+"~"+i}})}else if(n){t=S.map(n,function(e,t){return t+"~"+e.join(",")})}else{t=S.map(u.layers,function(e){if(S.inArray(e.sourceType,["pg","file"])>-1)return e.id+"~*"})}t=t.join(";");t=t.replace(/\bFID\b/g,"ogc_fid");return t}this.initialize=function e(){var t,i,n,r,a,s=S("#"+l);if(!s||s.length===0)return;if(u){a=u.mapId;u.bind("loaded",function(){if(a!==u.mapId){if(c.go_input){c.go_input.val(null)}if(c.gc_input){c.gc_input.val(null)}c.spinner.hide()}a=u.mapId})}s.addClass("gc-toolbar-panel gc-search-panel");c.spinner=S("<div/>").addClass("search-spinner").hide().appendTo(s);S("<i/>").addClass("fa fa-spinner fa-spin").appendTo(c.spinner);if(d.google){c.go_input=S("<input/>").addClass("").attr("id","gc_google_address_input").attr("type","text").attr("aria-label",L.__("Search for a location...")).attr("placeholder",L.__("Search for a location...")).hide().appendTo(s)}if(d.here){c.go_input=S("<input/>").addClass("").attr("id","gc_here_address_input").attr("type","text").attr("aria-label",L.__("Search for a location...")).attr("placeholder",L.__("Search for a location...")).appendTo(s);var o=null;c.go_input.keyup(function(e){if(c.go_input.val().length>0){c.clear_bt.show()}else{c.clear_bt.hide()}});c.go_input.keydown(function(e){if(e.keyCode==13){y()}else{var t;if(o)clearInterval(o);if(y.delay){o=y.delay(200)}else{o=setTimeout(y,200)}}})}if(d.giscloud){if(M.user&&M.user.options&&user.options.SEARCH_DEFAULT_VALUE){t=user.options.SEARCH_DEFAULT_VALUE}else{t=L.__("Search your map data...")}c.gc_input=S("<input/>").addClass("quicksearch").attr("type","text").attr("placeholder",t).attr("aria-label",t).hide().appendTo(s);c.gc_input.keyup(function(e){var t;if(e.keyCode==13){t=f();if(t.length>0){S(giscloud.ui.search).triggerHandler("start",[S(e.target).val()])}else{giscloud.ui.redAlert("No layers for search!",2e3)}}if(c.gc_input.val().length>0){c.clear_bt.show()}else{c.clear_bt.hide()}})}i='<div class="search-options gc-btn-group" >';if(d.google){r=d.mobile?"GM":"Google Maps";i+='    <button type="button" class="gc-sr-google gc-btn gc-btn-xs gc-btn-default active">'+r+"</button>"}if(d.here){r=d.mobile?"GM":L.__("Addresses");i+='    <button type="button" class="gc-sr-here gc-btn gc-btn-xs gc-btn-default active">'+r+"</button>"}if(d.giscloud){r=d.mobile?"GC":"GIS Cloud";i+='    <button type="button" class="gc-sr-giscloud gc-btn gc-btn-xs gc-btn-default">'+r+"</button>"}i+="</div>";c._search_options=i=S(i).appendTo(s);c._search_options.find(".gc-btn").click(function(e){if(!S(e.currentTarget).hasClass("active"))w();i.find(".gc-btn").removeClass("active");S(e.target).addClass("active");if(c._search_options.find(".gc-sr-giscloud").hasClass("active")&&c.gc_input.val().length>0){S(giscloud.ui.search).triggerHandler("start",[c.gc_input.val()])}if(c._search_options.find(".gc-sr-here").hasClass("active")){if(c.gc_input){var t=c.gc_input.val();if(t.length>1){c.go_input.val(t);y()}}}h()});c.clear_bt=S('<div><i class="fa fa-times" ></i></div>').attr("title",L.__("Clear")).appendTo(s).addClass("gc-quicksearch-clear-bt").click(function(e){e&&e.preventDefault&&e.preventDefault();if(d.google||d.here){c.go_input.val(null);c.go_input.focus()}w();if(d.giscloud){S(".quicksearch").val(null);S(".gc-search-box").remove()}c.clear_bt.hide()}).hide();if(d.google||d.here||M.user&&M.user.options&&user.options.MODULE_GOOGLE_SEARCH*1===1){if(d.google){n=new giscloud.ui.search.Google({viewer:u})}if(!d.giscloud){i.find(".gc-sr-google,.gc-sr-here").addClass("active");h()}}if(d.giscloud&&!i.find(".gc-btn").hasClass("active")){i.find(".gc-sr-giscloud").addClass("active");h()}S(giscloud.ui.search).on("start",_);S(document).mouseup(function(e){var t=S(".gc-search-box");if(M.gcapp&&gcapp.gcsearch&&c.__open&&!t.is(e.target)&&t.has(e.target).length===0&&(user.options.SEARCH_RESULTS_CLOSE_ON_CLICK==null||user.options.SEARCH_RESULTS_CLOSE_ON_CLICK*1)){gcapp.gcsearch.clearSearchResult()}})};return S(this.initialize())};giscloud.ui.Search.prototype={};giscloud.ui.search={overrideDefaultBehaviour:function(){if(gcapp&&gcapp.gcsearch){gcapp.gcsearch.addEvent("start",function(e){e.preventDefault=true;S(giscloud.ui.search).triggerHandler("search",[e.value])});gcapp.gcsearch.addEvent("searchchange",function(e){e.preventDefault=true;if(e.keyCode==13){S(giscloud.ui.search).triggerHandler("start",[e.value])}});gcapp.gcsearch.addEvent("searchclick",function(e){e.preventDefault=true;S(giscloud.ui.search).triggerHandler("resultClick",[e.data])})}}}})(window,giscloud.exposeJQuery(),giscloud.common());(function(i,c,o,e){"use strict";giscloud.ui.search.Google=function(e){var t=this,l=e&&e.viewer||giscloud.ui.map;if(!l){return}t.init=function(){var o=this;giscloud.__googleMapsApiLoadedGeocoder=function(){if(!i.google){console.log("Google map API is not loaded.")}var s=setInterval(function(){clearInterval(s);var e=document.getElementById("gc_google_address_input"),t={},i,n,r;for(i in l.layers){n=l.layers[i];if(c.inArray(n.source,["gmaps"])>=0){r=n.instance._google;break}}e.value="";var a=o.autocomplete=new google.maps.places.Autocomplete(e,t);google.maps.event.addListener(a,"place_changed",o.onPlaceChanged.bind(o))},500)};if(!i.google){}else{giscloud.__googleMapsApiLoadedGeocoder()}return o};t.onPlaceChanged=function(){if(l.markers.length!=0){for(var e=0;e<l.markers.length;e++){l.markers[e].visible(false)}}var t=this.autocomplete.getPlace(),i=new giscloud.FlagMarker;if(!t.geometry||!t.geometry.location){return}var n=t.geometry.location.lng(),r=t.geometry.location.lat(),a="WGS84",s={x:n,y:r};s=giscloud.proj4(a,l.projection,s);o.zoomToBounds(l,new giscloud.Bounds(s.x,s.y,s.x,s.y));i.position(new giscloud.LonLat(s.x,s.y)).content(t.formatted_address);l.addMarker(i)};return t.init()}})(window,giscloud.exposeJQuery(),giscloud.common());(function(o){"use strict";var t,i,l,n,r,a,s,c,u,d,h,f,p,g,m,v,y,_,b,w,x,C,T,k=0;function M(){var e=o("#mapPanel");if(h.loading.state()!=="pending"||h.container()){return o(h.container())}return o("#mapPanel")}function S(){if(t){return}if(window.fno&&window.fno.mobilebrowser){return}p&&p.refresh&&p.refresh();t=setTimeout(function e(){t=null},750)}function L(){var e=M(),t,i,n;if(e&&e.length>0){t=M().offset();i=l.offset();n=i.top-t.top;if(n>0){h.height(n)}}}function D(){S();if(g!==0){giscloud.ui.datagridDrawer.size(f.height()*g,true)}n.css("top",f.height()-_);if(!C){L()}}function j(){switch(m){case 0:R(f.height()/3);m=1;break;case 1:R(f.height()/2);m=2;break;case 2:R(2*f.height()/3);m=3;break}n.css("top",f.height()-_)}function I(){switch(m){case 1:R(0);m=0;break;case 2:R(f.height()/3);m=1;break;case 3:R(f.height()/2);m=2;break}n.css("top",f.height()-_)}function E(e){if(e&&o(e.target).hasClass("drag-handle")||o.now()-k<300)return;if(_>0){giscloud.ui.datagridDrawer.collapse()}else{giscloud.ui.datagridDrawer.expand()}}function A(e,t){w=x=t.offset.top;b=_}function P(){k=o.now()}function O(e,t){var i=b+w-t.offset.top;if(N(i,f.height())){giscloud.ui.datagridDrawer.size(i);x=t.offset.top}else{t.offset.top=x;t.position.top=x}}function N(e,t){return e>=0&&t-e>105}function R(e,t){var i,n,r,a,s;n=Math.max(e,0);r=f.height();if(!N(n,r)){return}if(_===0&&n>0){T.trigger("open.gc-datagrid-drawer");l.removeClass("closed");d.addClass("glyphicon-arrow-down").removeClass("glyphicon-arrow-up")}else if(_>0&&n===0){T.trigger("close.gc-datagrid-drawer");l.addClass("closed");d.addClass("glyphicon-arrow-up").removeClass("glyphicon-arrow-down")}a=n-_;_=n;g=_/r;l.height(_);if(!t&&!C){L()}S();T.trigger(o.Event("size.gc-datagrid-drawer",{datagridDrawer:giscloud.ui.datagridDrawer,size:_}))}giscloud.ui.datagridDrawer={init:function(e,t){if(i&&e!==true&&e!=="force")return this;if(!t)t={};l=o(".datagrid-drawer");n=o(".datagrid-pulltab");a=n.find(".drawer-controls");s=n.find(".drag-handle");c=n.find(".open-icon");u=n.find(".close-icon");d=n.find(".toggle-icon");r=t.datagridPad||o("#datagrid_pad");f=o("body");p=t.datagrid||window.gcdatagrid?window.gcdatagrid:null;h=t.viewer||giscloud.ui.map;C=t&&t.leaveMapAlone;T=o(l);if(l.length===0||n.length===0)return this;n.css("top",o("body").height()).draggable({axis:"y",handle:".drag-handle",scroll:false,start:A,drag:O,stop:P});if(window.fno&&window.fno.mobilebrowser){o(".datagrid-pulltab").addClass("mobile")}else{o(".datagrid-pulltab").addClass("non-mobile")}c.on("click",j);u.on("click",I);a.on("click",E);o(window).on("resize",D);_=0;m=0;y=Math.floor(Math.max((h.height()||200)/2,f.height()/3));g=0;v=false;h.initializing.done(function(){D()});i=true;if(localStorage.getItem("gc_datagrid_drawer")==="open"){this.toggle()}l.mouseenter(function(){l.css("z-index",1e3)});l.mouseleave(function(){if(o(".context-menu-list").length)return;l.css("z-index",998)});return this},show:function(){if(i){l.show();n.show();n.css("top",f.height()-_);v=true;T.trigger(o.Event("show.gc-datagrid-drawer",{datagridDrawer:giscloud.ui.datagridDrawer}))}return this},hide:function(){if(i){l.hide();n.hide();v=false;T.trigger(o.Event("hide.gc-datagrid-drawer",{datagridDrawer:giscloud.ui.datagridDrawer}))}return this},collapse:function(){if(i){y=Math.max(_,200);R(0);localStorage.removeItem("gc_datagrid_drawer");n.css("top",f.height()-_)}},expand:function(){if(i){R(y);localStorage.setItem("gc_datagrid_drawer","open");n.css("top",f.height()-_)}},toggle:function(){if(i){E()}return this},size:function(e,t){if(e==null){return _}R(e,t);return this},on:function(){T.on.apply(T,Array.prototype.slice.apply(arguments));return this},off:function(){T.off.apply(T,Array.prototype.slice.apply(arguments));return this},bind:function(){return this.on.apply(this,Array.prototype.slice.apply(arguments))},unbind:function(){return this.off.apply(this,Array.prototype.slice.apply(arguments))}}})(giscloud.exposeJQuery());window.jQuery=window.$=giscloud.exposeJQuery();(function(r,e){function a(e){e.preventDefault(),r.event.remove(w,"click",a)}function i(e,t){return(m?t.originalEvent.touches[0]:t)["page"+e.toUpperCase()]}function s(e,t,i){var n=r.Event(t,C);r.event.trigger(n,{originalEvent:e},e.target),n.isDefaultPrevented()&&(~t.indexOf("tap")&&!m?r.event.add(w,"click",a):e.preventDefault()),i&&(r.event.remove(w,_+"."+b,o),r.event.remove(w,y+"."+b,l))}function t(e){var t=e.timeStamp||+new Date;n!=t&&(n=t,x.x=C.x=i("x",e),x.y=C.y=i("y",e),x.time=t,x.target=e.target,C.orientation=null,C.end=!1,c=!1,u=!1,d=setTimeout(function(){u=!0,s(e,"press")},r.Finger.pressDuration),r.event.add(w,_+"."+b,o),r.event.add(w,y+"."+b,l),T.preventDefault&&(e.preventDefault(),r.event.add(w,"click",a)))}function o(e){if(C.x=i("x",e),C.y=i("y",e),C.dx=C.x-x.x,C.dy=C.y-x.y,C.adx=Math.abs(C.dx),C.ady=Math.abs(C.dy),c=C.adx>T.motionThreshold||C.ady>T.motionThreshold){for(clearTimeout(d),C.orientation||(C.adx>C.ady?(C.orientation="horizontal",C.direction=C.dx>0?1:-1):(C.orientation="vertical",C.direction=C.dy>0?1:-1));e.target&&e.target!==x.target;)e.target=e.target.parentNode;return e.target!==x.target?(e.target=x.target,l.call(this,r.Event(y+"."+b,e)),void 0):(s(e,"drag"),void 0)}}function l(e){var t,i=e.timeStamp||+new Date,n=i-x.time;if(clearTimeout(d),c||u||e.target!==x.target)e.target=x.target,T.flickDuration>n&&s(e,"flick"),C.end=!0,t="drag";else{var r=h===e.target&&T.doubleTapInterval>i-f;t=r?"doubletap":"tap",h=r?null:x.target,f=i}s(e,t,!0)}var c,u,n,d,h,f,p=/chrome/i.exec(e),g=/android/i.exec(e),m="ontouchstart"in window&&!(p&&!g),v=m?"touchstart":"mousedown",y=m?"touchend touchcancel":"mouseup mouseleave",_=m?"touchmove":"mousemove",b="finger",w=r("html")[0],x={},C={},T=r.Finger={pressDuration:300,doubleTapInterval:300,flickDuration:150,motionThreshold:5};r.event.add(w,v+"."+b,t)})(jQuery,navigator.userAgent);(function(Vt,Ut,$t){(function(e){"use strict";if(typeof define==="function"&&define.amd){define("datatables",["jquery"],e)}else if(typeof exports==="object"){module.exports=e(require("jquery"))}else if(jQuery&&!jQuery.fn.dataTable){e(jQuery)}})(function(B){"use strict";var N;var n;var y;var t;var e;var i={};var r=/[\r\n]/g;var a=/<.*?>/g;var s=/^[\w\+\-]/;var o=/[\w\+\-]$/;var l=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\","$","^","-"].join("|\\")+")","g");var c=/[',$£€¥%\u2009\u202F]/g;var u=function(e){return!e||e===true||e==="-"?true:false};var d=function(e){var t=parseInt(e,10);return!isNaN(t)&&isFinite(e)?t:null};var h=function(e,t){if(!i[t]){i[t]=new RegExp(Te(t),"g")}return typeof e==="string"&&t!=="."?e.replace(/\./g,"").replace(i[t],"."):e};var f=function(e,t,i){var n=typeof e==="string";if(t&&n){e=h(e,t)}if(i&&n){e=e.replace(c,"")}return u(e)||!isNaN(parseFloat(e))&&isFinite(e)};var p=function(e){return u(e)||typeof e==="string"};var g=function(e,t,i){if(u(e)){return true}var n=p(e);return!n?null:f(w(e),t,i)?true:null};var v=function(e,t,i){var n=[];var r=0,a=e.length;if(i!==$t){for(;r<a;r++){if(e[r]&&e[r][t]){n.push(e[r][t][i])}}}else{for(;r<a;r++){if(e[r]){n.push(e[r][t])}}}return n};var m=function(e,t,i,n){var r=[];var a=0,s=t.length;if(n!==$t){for(;a<s;a++){if(e[t[a]][i]){r.push(e[t[a]][i][n])}}}else{for(;a<s;a++){r.push(e[t[a]][i])}}return r};var _=function(e,t){var i=[];var n;if(t===$t){t=0;n=e}else{n=t;t=e}for(var r=t;r<n;r++){i.push(r)}return i};var b=function(e){var t=[];for(var i=0,n=e.length;i<n;i++){if(e[i]){t.push(e[i])}}return t};var w=function(e){return e.replace(a,"")};var x=function(e){var t=[],i,n,r=e.length,a,s=0;e:for(n=0;n<r;n++){i=e[n];for(a=0;a<s;a++){if(t[a]===i){continue e}}t.push(i);s++}return t};function C(i){var n="a aa ai ao as b fn i m o s ",r,a,s={};B.each(i,function(e,t){r=e.match(/^([^A-Z]+?)([A-Z])/);if(r&&n.indexOf(r[1]+" ")!==-1){a=e.replace(r[0],r[2].toLowerCase());s[a]=e;if(r[1]==="o"){C(i[e])}}});i._hungarianMap=s}function R(i,n,r){if(!i._hungarianMap){C(i)}var a;B.each(n,function(e,t){a=i._hungarianMap[e];if(a!==$t&&(r||n[a]===$t)){if(a.charAt(0)==="o"){if(!n[a]){n[a]={}}B.extend(true,n[a],n[e]);R(i[a],n[a],r)}else{n[a]=n[e]}}})}function F(e){var t=N.defaults.oLanguage;var i=e.sZeroRecords;if(!e.sEmptyTable&&i&&t.sEmptyTable==="No data available in table"){ut(e,e,"sZeroRecords","sEmptyTable")}if(!e.sLoadingRecords&&i&&t.sLoadingRecords==="Loading..."){ut(e,e,"sZeroRecords","sLoadingRecords")}if(e.sInfoThousands){e.sThousands=e.sInfoThousands}var n=e.sDecimal;if(n){qt(n)}}var T=function(e,t,i){if(e[t]!==$t){e[i]=e[t]}};function z(e){T(e,"ordering","bSort");T(e,"orderMulti","bSortMulti");T(e,"orderClasses","bSortClasses");T(e,"orderCellsTop","bSortCellsTop");T(e,"order","aaSorting");T(e,"orderFixed","aaSortingFixed");T(e,"paging","bPaginate");T(e,"pagingType","sPaginationType");T(e,"pageLength","iDisplayLength");T(e,"searching","bFilter");var t=e.aoSearchCols;if(t){for(var i=0,n=t.length;i<n;i++){if(t[i]){R(N.models.oSearch,t[i])}}}}function H(e){T(e,"orderable","bSortable");T(e,"orderData","aDataSort");T(e,"orderSequence","asSorting");T(e,"orderDataType","sortDataType")}function W(e){var t=e.oBrowser;var i=B("<div/>").css({position:"absolute",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(B("<div/>").css({position:"absolute",top:1,left:1,width:100,overflow:"scroll"}).append(B('<div class="test"/>').css({width:"100%",height:10}))).appendTo("body");var n=i.find(".test");t.bScrollOversize=n[0].offsetWidth===100;t.bScrollbarLeft=n.offset().left!==1;i.remove()}function k(e,t,i,n,r,a){var s=n,o,l=false;if(i!==$t){o=i;l=true}while(s!==r){if(!e.hasOwnProperty(s)){continue}o=l?t(o,e[s],s,e):e[s];l=true;s+=a}return o}function q(e,t){var i=N.defaults.column;var n=e.aoColumns.length;var r=B.extend({},N.models.oColumn,i,{nTh:t?t:Ut.createElement("th"),sTitle:i.sTitle?i.sTitle:t?t.innerHTML:"",aDataSort:i.aDataSort?i.aDataSort:[n],mData:i.mData?i.mData:n,idx:n});e.aoColumns.push(r);var a=e.aoPreSearchCols;a[n]=B.extend({},N.models.oSearch,a[n]);G(e,n,B(t).data())}function G(e,t,i){var n=e.aoColumns[t];var r=e.oClasses;var a=B(n.nTh);if(!n.sWidthOrig){n.sWidthOrig=a.attr("width")||null;var s=(a.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);if(s){n.sWidthOrig=s[1]}}if(i!==$t&&i!==null){H(i);R(N.defaults.column,i);if(i.mDataProp!==$t&&!i.mData){i.mData=i.mDataProp}if(i.sType){n._sManualType=i.sType}if(i.className&&!i.sClass){i.sClass=i.className}B.extend(n,i);ut(n,i,"sWidth","sWidthOrig");if(typeof i.iDataSort==="number"){n.aDataSort=[i.iDataSort]}ut(n,i,"aDataSort")}var o=n.mData;var l=Y(o);var c=n.mRender?Y(n.mRender):null;var u=function(e){return typeof e==="string"&&e.indexOf("@")!==-1};n._bAttrSrc=B.isPlainObject(o)&&(u(o.sort)||u(o.type)||u(o.filter));n.fnGetData=function(e,t,i){var n=l(e,t,$t,i);return c&&t?c(n,t,e,i):n};n.fnSetData=function(e,t,i){return Z(o)(e,t,i)};if(typeof o!=="number"){e._rowReadObject=true}if(!e.oFeatures.bSort){n.bSortable=false;a.addClass(r.sSortableNone)}var d=B.inArray("asc",n.asSorting)!==-1;var h=B.inArray("desc",n.asSorting)!==-1;if(!n.bSortable||!d&&!h){n.sSortingClass=r.sSortableNone;n.sSortingClassJUI=""}else if(d&&!h){n.sSortingClass=r.sSortableAsc;n.sSortingClassJUI=r.sSortJUIAscAllowed}else if(!d&&h){n.sSortingClass=r.sSortableDesc;n.sSortingClassJUI=r.sSortJUIDescAllowed}else{n.sSortingClass=r.sSortable;n.sSortingClassJUI=r.sSortJUI}}function M(e){if(e.oFeatures.bAutoWidth!==false){var t=e.aoColumns;Ve(e);for(var i=0,n=t.length;i<n;i++){t[i].nTh.style.width=t[i].sWidth}}var r=e.oScroll;if(r.sY!==""||r.sX!==""){We(e)}pt(e,null,"column-sizing",[e])}function V(e,t){var i=D(e,"bVisible");return typeof i[t]==="number"?i[t]:null}function S(e,t){var i=D(e,"bVisible");var n=B.inArray(t,i);return n!==-1?n:null}function L(e){return D(e,"bVisible").length}function D(e,i){var n=[];B.map(e.aoColumns,function(e,t){if(e[i]){n.push(t)}});return n}function j(e){var t=e.aoColumns;var i=e.aoData;var n=N.ext.type.detect;var r,a,s,o,l,c;var u,d,h,f;for(r=0,a=t.length;r<a;r++){u=t[r];f=[];if(!u.sType&&u._sManualType){u.sType=u._sManualType}else if(!u.sType){for(s=0,o=n.length;s<o;s++){for(l=0,c=i.length;l<c;l++){if(f[l]===$t){f[l]=A(e,l,r,"type")}h=n[s](f[l],e);if(!h&&s!==n.length-1){break}if(h==="html"){break}}if(h){u.sType=h;break}}if(!u.sType){u.sType="string"}}}}function U(e,t,i,n){var r,a,s,o,l,c,u;var d=e.aoColumns;if(t){for(r=t.length-1;r>=0;r--){u=t[r];var h=u.targets!==$t?u.targets:u.aTargets;if(!B.isArray(h)){h=[h]}for(s=0,o=h.length;s<o;s++){if(typeof h[s]==="number"&&h[s]>=0){while(d.length<=h[s]){q(e)}n(h[s],u)}else if(typeof h[s]==="number"&&h[s]<0){n(d.length+h[s],u)}else if(typeof h[s]==="string"){for(l=0,c=d.length;l<c;l++){if(h[s]=="_all"||B(d[l].nTh).hasClass(h[s])){n(l,u)}}}}}}if(i){for(r=0,a=i.length;r<a;r++){n(r,i[r])}}}function $(e,t,i,n){var r=e.aoData.length;var a=B.extend(true,{},N.models.oRow,{src:i?"dom":"data"});a._aData=t;e.aoData.push(a);var s,o;var l=e.aoColumns;for(var c=0,u=l.length;c<u;c++){if(i){P(e,r,c,A(e,r,c))}l[c].sType=null}e.aiDisplayMaster.push(r);if(i||!e.oFeatures.bDeferRender){re(e,r,i,n)}return r}function J(i,e){var n;if(!(e instanceof B)){e=B(e)}return e.map(function(e,t){n=ne(i,t);return $(i,n.data,t,n.cells)})}function I(e,t){return t._DT_RowIndex!==$t?t._DT_RowIndex:null}function E(e,t,i){return B.inArray(i,e.aoData[t].anCells)}function A(e,t,i,n){var r=e.iDraw;var a=e.aoColumns[i];var s=e.aoData[t]._aData;var o=a.sDefaultContent;var l=a.fnGetData(s,n,{settings:e,row:t,col:i});if(l===$t){if(e.iDrawError!=r&&o===null){ct(e,0,"Requested unknown parameter "+(typeof a.mData=="function"?"{function}":"'"+a.mData+"'")+" for row "+t,4);e.iDrawError=r}return o}if((l===s||l===null)&&o!==null){l=o}else if(typeof l==="function"){return l.call(s)}if(l===null&&n=="display"){return""}return l}function P(e,t,i,n){var r=e.aoColumns[i];var a=e.aoData[t]._aData;r.fnSetData(a,n,{settings:e,row:t,col:i})}var O=/\[.*?\]$/;var Q=/\(\)$/;function X(e){return B.map(e.match(/(\\.|[^\.])+/g),function(e){return e.replace(/\\./g,".")})}function Y(r){if(B.isPlainObject(r)){var a={};B.each(r,function(e,t){if(t){a[e]=Y(t)}});return function(e,t,i,n){var r=a[t]||a._;return r!==$t?r(e,t,i,n):e}}else if(r===null){return function(e){return e}}else if(typeof r==="function"){return function(e,t,i,n){return r(e,t,i,n)}}else if(typeof r==="string"&&(r.indexOf(".")!==-1||r.indexOf("[")!==-1||r.indexOf("(")!==-1)){var f=function(e,t,i){var n,r,a,s;if(i!==""){var o=X(i);for(var l=0,c=o.length;l<c;l++){n=o[l].match(O);r=o[l].match(Q);if(n){o[l]=o[l].replace(O,"");if(o[l]!==""){e=e[o[l]]}a=[];o.splice(0,l+1);s=o.join(".");for(var u=0,d=e.length;u<d;u++){a.push(f(e[u],t,s))}var h=n[0].substring(1,n[0].length-1);e=h===""?a:a.join(h);break}else if(r){o[l]=o[l].replace(Q,"");e=e[o[l]]();continue}if(e===null||e[o[l]]===$t){return $t}e=e[o[l]]}}return e};return function(e,t){return f(e,t,r)}}else{return function(e,t){return e[r]}}}function Z(n){if(B.isPlainObject(n)){return Z(n._)}else if(n===null){return function(){}}else if(typeof n==="function"){return function(e,t,i){n(e,"set",t,i)}}else if(typeof n==="string"&&(n.indexOf(".")!==-1||n.indexOf("[")!==-1||n.indexOf("(")!==-1)){var p=function(e,t,i){var n=X(i),r;var a=n[n.length-1];var s,o,l,c;for(var u=0,d=n.length-1;u<d;u++){s=n[u].match(O);o=n[u].match(Q);if(s){n[u]=n[u].replace(O,"");e[n[u]]=[];r=n.slice();r.splice(0,u+1);c=r.join(".");for(var h=0,f=t.length;h<f;h++){l={};p(l,t[h],c);e[n[u]].push(l)}return}else if(o){n[u]=n[u].replace(Q,"");e=e[n[u]](t)}if(e[n[u]]===null||e[n[u]]===$t){e[n[u]]={}}e=e[n[u]]}if(a.match(Q)){e=e[a.replace(Q,"")](t)}else{e[a.replace(O,"")]=t}};return function(e,t){return p(e,t,n)}}else{return function(e,t){e[n]=t}}}function K(e){return v(e.aoData,"_aData")}function ee(e){e.aoData.length=0;e.aiDisplayMaster.length=0;e.aiDisplay.length=0}function te(e,t,i){var n=-1;for(var r=0,a=e.length;r<a;r++){if(e[r]==t){n=r}else if(e[r]>t){e[r]--}}if(n!=-1&&i===$t){e.splice(n,1)}}function ie(i,n,e,t){var r=i.aoData[n];var a,s;var o=function(e,t){while(e.childNodes.length){e.removeChild(e.firstChild)}e.innerHTML=A(i,n,t,"display")};if(e==="dom"||(!e||e==="auto")&&r.src==="dom"){r._aData=ne(i,r,t,t===$t?$t:r._aData).data}else{var l=r.anCells;if(l){if(t!==$t){o(l[t],t)}else{for(a=0,s=l.length;a<s;a++){o(l[a],a)}}}}r._aSortData=null;r._aFilterData=null;var c=i.aoColumns;if(t!==$t){c[t].sType=null}else{for(a=0,s=c.length;a<s;a++){c[a].sType=null}ae(r)}}function ne(e,t,i,a){var n=[],r=t.firstChild,s,o,l,c=0,u,d=e.aoColumns,h=e._rowReadObject;a=a||h?{}:[];var f=function(e,t){if(typeof e==="string"){var i=e.indexOf("@");if(i!==-1){var n=e.substring(i+1);var r=Z(e);r(a,t.getAttribute(n))}}};var p=function(e){if(i===$t||i===c){o=d[c];u=B.trim(e.innerHTML);if(o&&o._bAttrSrc){var t=Z(o.mData._);t(a,u);f(o.mData.sort,e);f(o.mData.type,e);f(o.mData.filter,e)}else{if(h){if(!o._setter){o._setter=Z(o.mData)}o._setter(a,u)}else{a[c]=u}}}c++};if(r){while(r){s=r.nodeName.toUpperCase();if(s=="TD"||s=="TH"){p(r);n.push(r)}r=r.nextSibling}}else{n=t.anCells;for(var g=0,m=n.length;g<m;g++){p(n[g])}}return{data:a,cells:n}}function re(e,t,i,n){var r=e.aoData[t],a=r._aData,s=[],o,l,c,u,d;if(r.nTr===null){o=i||Ut.createElement("tr");r.nTr=o;r.anCells=s;o._DT_RowIndex=t;ae(r);for(u=0,d=e.aoColumns.length;u<d;u++){c=e.aoColumns[u];l=i?n[u]:Ut.createElement(c.sCellType);s.push(l);if(!i||c.mRender||c.mData!==u){l.innerHTML=A(e,t,u,"display")}if(c.sClass){l.className+=" "+c.sClass}if(c.bVisible&&!i){o.appendChild(l)}else if(!c.bVisible&&i){l.parentNode.removeChild(l)}if(c.fnCreatedCell){c.fnCreatedCell.call(e.oInstance,l,A(e,t,u),a,t,u)}}pt(e,"aoRowCreatedCallback",null,[o,a,t])}r.nTr.setAttribute("role","row")}function ae(e){var t=e.nTr;var i=e._aData;if(t){if(i.DT_RowId){t.id=i.DT_RowId}if(i.DT_RowClass){var n=i.DT_RowClass.split(" ");e.__rowc=e.__rowc?x(e.__rowc.concat(n)):n;B(t).removeClass(e.__rowc.join(" ")).addClass(i.DT_RowClass)}if(i.DT_RowAttr){B(t).attr(i.DT_RowAttr)}if(i.DT_RowData){B(t).data(i.DT_RowData)}}}function se(e){var t,i,n,r,a;var s=e.nTHead;var o=e.nTFoot;var l=B("th, td",s).length===0;var c=e.oClasses;var u=e.aoColumns;if(l){r=B("<tr/>").appendTo(s)}for(t=0,i=u.length;t<i;t++){a=u[t];n=B(a.nTh).addClass(a.sClass);if(l){n.appendTo(r)}if(e.oFeatures.bSort){n.addClass(a.sSortingClass);if(a.bSortable!==false){n.attr("tabindex",e.iTabIndex).attr("aria-controls",e.sTableId);nt(e,a.nTh,t)}}if(a.sTitle!=n.html()){n.html(a.sTitle)}mt(e,"header")(e,n,a,c)}if(l){de(e.aoHeader,s)}B(s).find(">tr").attr("role","row");B(s).find(">tr>th, >tr>td").addClass(c.sHeaderTH);B(o).find(">tr>th, >tr>td").addClass(c.sFooterTH);if(o!==null){var d=e.aoFooter[0];for(t=0,i=d.length;t<i;t++){a=u[t];a.nTf=d[t].cell;if(a.sClass){B(a.nTf).addClass(a.sClass)}}}}function oe(e,t,i){var n,r,a,s,o,l,c,u;var d=[];var h=[];var f=e.aoColumns.length;var p,g;if(!t){return}if(i===$t){i=false}for(n=0,r=t.length;n<r;n++){d[n]=t[n].slice();d[n].nTr=t[n].nTr;for(a=f-1;a>=0;a--){if(!e.aoColumns[a].bVisible&&!i){d[n].splice(a,1)}}h.push([])}for(n=0,r=d.length;n<r;n++){u=d[n].nTr;if(u){while(c=u.firstChild){u.removeChild(c)}}for(a=0,s=d[n].length;a<s;a++){p=1;g=1;if(h[n][a]===$t){u.appendChild(d[n][a].cell);h[n][a]=1;while(d[n+p]!==$t&&d[n][a].cell==d[n+p][a].cell){h[n+p][a]=1;p++}while(d[n][a+g]!==$t&&d[n][a].cell==d[n][a+g].cell){for(o=0;o<p;o++){h[n+o][a+g]=1}g++}B(d[n][a].cell).attr("rowspan",p).attr("colspan",g)}}}}function le(e){var t=pt(e,"aoPreDrawCallback","preDraw",[e]);if(B.inArray(false,t)!==-1){He(e,false);return}var i,n,r;var a=[];var s=0;var o=e.asStripeClasses;var l=o.length;var c=e.aoOpenRows.length;var u=e.oLanguage;var d=e.iInitDisplayStart;var h=vt(e)=="ssp";var f=e.aiDisplay;e.bDrawing=true;if(d!==$t&&d!==-1){e._iDisplayStart=h?d:d>=e.fnRecordsDisplay()?0:d;e.iInitDisplayStart=-1}var p=e._iDisplayStart;var g=e.fnDisplayEnd();if(e.bDeferLoading){e.bDeferLoading=false;e.iDraw++;He(e,false)}else if(!h){e.iDraw++}else if(!e.bDestroying&&!pe(e)){return}if(f.length!==0){var m=h?0:p;var v=h?e.aoData.length:g;for(var y=m;y<v;y++){var _=f[y];var b=e.aoData[_];if(b.nTr===null){re(e,_)}var w=b.nTr;if(l!==0){var x=o[s%l];if(b._sRowStripe!=x){B(w).removeClass(b._sRowStripe).addClass(x);b._sRowStripe=x}}pt(e,"aoRowCallback",null,[w,b._aData,s,y]);a.push(w);s++}}else{var C=u.sZeroRecords;if(e.iDraw==1&&vt(e)=="ajax"){C=u.sLoadingRecords}else if(u.sEmptyTable&&e.fnRecordsTotal()===0){C=Vt.__?__(u.sEmptyTable):u.sEmptyTable}a[0]=B("<tr/>",{class:l?o[0]:""}).append(B("<td />",{valign:"top",colSpan:L(e),class:e.oClasses.sRowEmpty}).html(C))[0]}pt(e,"aoHeaderCallback","header",[B(e.nTHead).children("tr")[0],K(e),p,g,f]);pt(e,"aoFooterCallback","footer",[B(e.nTFoot).children("tr")[0],K(e),p,g,f]);var T=B(e.nTBody);T.children().detach();T.append(B(a));pt(e,"aoDrawCallback","draw",[e]);e.bSorted=false;e.bFiltered=false;e.bDrawing=false}function ce(e,t){var i=e.oFeatures,n=i.bSort,r=i.bFilter;if(n){et(e)}if(r){_e(e,e.oPreviousSearch)}else{e.aiDisplay=e.aiDisplayMaster.slice()}if(t!==true){e._iDisplayStart=0}e._drawHold=t;le(e);e._drawHold=false}function ue(e){var t=e.oClasses;var i=B(e.nTable);var n=B("<div/>").insertBefore(i);var r=e.oFeatures;var a=B("<div/>",{id:e.sTableId+"_wrapper",class:t.sWrapper+(e.nTFoot?"":" "+t.sNoFooter)});e.nHolding=n[0];e.nTableWrapper=a[0];e.nTableReinsertBefore=e.nTable.nextSibling;var s=e.sDom.split("");var o,l,c,u,d,h;for(var f=0;f<s.length;f++){o=null;l=s[f];if(l=="<"){c=B("<div/>")[0];u=s[f+1];if(u=="'"||u=='"'){d="";h=2;while(s[f+h]!=u){d+=s[f+h];h++}if(d=="H"){d=t.sJUIHeader}else if(d=="F"){d=t.sJUIFooter}if(d.indexOf(".")!=-1){var p=d.split(".");c.id=p[0].substr(1,p[0].length-1);c.className=p[1]}else if(d.charAt(0)=="#"){c.id=d.substr(1,d.length-1)}else{c.className=d}f+=h}a.append(c);a=B(c)}else if(l==">"){a=a.parent()}else if(l=="l"&&r.bPaginate&&r.bLengthChange){o=Ne(e)}else if(l=="f"&&r.bFilter){o=ye(e)}else if(l=="r"&&r.bProcessing){o=ze(e)}else if(l=="t"){o=Be(e)}else if(l=="i"&&r.bInfo){o=je(e)}else if(l=="p"&&r.bPaginate){o=Re(e)}else if(N.ext.feature.length!==0){var g=N.ext.feature;for(var m=0,v=g.length;m<v;m++){if(l==g[m].cFeature){o=g[m].fnInit(e);break}}}if(o){var y=e.aanFeatures;if(!y[l]){y[l]=[]}y[l].push(o);a.append(o)}}n.replaceWith(a)}function de(e,t){var i=B(t).children("tr");var n,r;var a,s,o,l,c,u,d,h,f;var p;var g=function(e,t,i){var n=e[t];while(n[i]){i++}return i};e.splice(0,e.length);for(a=0,l=i.length;a<l;a++){e.push([])}for(a=0,l=i.length;a<l;a++){n=i[a];d=0;r=n.firstChild;while(r){if(r.nodeName.toUpperCase()=="TD"||r.nodeName.toUpperCase()=="TH"){h=r.getAttribute("colspan")*1;f=r.getAttribute("rowspan")*1;h=!h||h===0||h===1?1:h;f=!f||f===0||f===1?1:f;u=g(e,a,d);p=h===1?true:false;for(o=0;o<h;o++){for(s=0;s<f;s++){e[a+s][u+o]={cell:r,unique:p};e[a+s].nTr=n}}}r=r.nextSibling}}}function he(e,t,i){var n=[];if(!i){i=e.aoHeader;if(t){i=[];de(i,t)}}for(var r=0,a=i.length;r<a;r++){for(var s=0,o=i[r].length;s<o;s++){if(i[r][s].unique&&(!n[s]||!e.bSortCellsTop)){n[s]=i[r][s].cell}}}return n}function fe(r,e,i){pt(r,"aoServerParams","serverParams",[e]);if(e&&B.isArray(e)){var a={};var s=/(.*?)\[\]$/;B.each(e,function(e,t){var i=t.name.match(s);if(i){var n=i[0];if(!a[n]){a[n]=[]}a[n].push(t.value)}else{a[t.name]=t.value}});e=a}var t;var n=r.ajax;var o=r.oInstance;if(B.isPlainObject(n)&&n.data){t=n.data;var l=B.isFunction(t)?t(e):t;e=B.isFunction(t)&&l?l:B.extend(true,e,l);delete n.data}var c={data:e,success:function(e){var t=e.error||e.sError;if(t){r.oApi._fnLog(r,0,t)}r.json=e;pt(r,null,"xhr",[r,e]);i(e)},dataType:"json",cache:false,type:r.sServerMethod,error:function(e,t,i){var n=r.oApi._fnLog;if(t=="parsererror"){n(r,0,"Invalid JSON response",1)}else if(e.readyState===4){n(r,0,"Ajax error",7)}He(r,false)}};r.oAjaxData=e;pt(r,null,"preXhr",[r,e]);if(r.fnServerData){r.fnServerData.call(o,r.sAjaxSource,B.map(e,function(e,t){return{name:t,value:e}}),i,r)}else if(r.sAjaxSource||typeof n==="string"){r.jqXHR=B.ajax(B.extend(c,{url:n||r.sAjaxSource}))}else if(B.isFunction(n)){r.jqXHR=n.call(o,e,i,r)}else{r.jqXHR=B.ajax(B.extend(c,n));n.data=t}}function pe(t){if(t.bAjaxDataGet){t.iDraw++;He(t,true);fe(t,ge(t),function(e){me(t,e)});return false}return true}function ge(e){var t=e.aoColumns,i=t.length,n=e.oFeatures,r=e.oPreviousSearch,a=e.aoPreSearchCols,s,o=[],l,c,u,d=Ke(e),h=e._iDisplayStart,f=n.bPaginate!==false?e._iDisplayLength:-1;var p=function(e,t){o.push({name:e,value:t})};p("sEcho",e.iDraw);p("iColumns",i);p("sColumns",v(t,"sName").join(","));p("iDisplayStart",h);p("iDisplayLength",f);var g={draw:e.iDraw,columns:[],order:[],start:h,length:f,search:{value:r.sSearch,regex:r.bRegex}};for(s=0;s<i;s++){c=t[s];u=a[s];l=typeof c.mData=="function"?"function":c.mData;g.columns.push({data:l,name:c.sName,searchable:c.bSearchable,orderable:c.bSortable,search:{value:u.sSearch,regex:u.bRegex}});p("mDataProp_"+s,l);if(n.bFilter){p("sSearch_"+s,u.sSearch);p("bRegex_"+s,u.bRegex);p("bSearchable_"+s,c.bSearchable)}if(n.bSort){p("bSortable_"+s,c.bSortable)}}if(n.bFilter){p("sSearch",r.sSearch);p("bRegex",r.bRegex)}if(n.bSort){B.each(d,function(e,t){g.order.push({column:t.col,dir:t.dir});p("iSortCol_"+e,t.col);p("sSortDir_"+e,t.dir)});p("iSortingCols",d.length)}var m=N.ext.legacy.ajax;if(m===null){return e.sAjaxSource?o:g}return m?o:g}function me(e,i){var t=function(e,t){return i[e]!==$t?i[e]:i[t]};var n=t("sEcho","draw");var r=t("iTotalRecords","recordsTotal");var a=t("iTotalDisplayRecords","recordsFiltered");if(n){if(n*1<e.iDraw){return}e.iDraw=n*1}ee(e);e._iRecordsTotal=parseInt(r,10);e._iRecordsDisplay=parseInt(a,10);var s=ve(e,i);for(var o=0,l=s.length;o<l;o++){$(e,s[o])}e.aiDisplay=e.aiDisplayMaster.slice();e.bAjaxDataGet=false;le(e);if(!e._bInitComplete){Pe(e,i)}e.bAjaxDataGet=true;He(e,false)}function ve(e,t){var i=B.isPlainObject(e.ajax)&&e.ajax.dataSrc!==$t?e.ajax.dataSrc:e.sAjaxDataProp;if(i==="data"){return t.aaData||t[i]}return i!==""?Y(i)(t):t}function ye(i){var e=i.oClasses;var t=i.sTableId;var n=i.oLanguage;var r=i.oPreviousSearch;var a=i.aanFeatures;var s='<input type="search" class="'+e.sFilterInput+'"/>';var o=n.sSearch;o=o.match(/_INPUT_/)?o.replace("_INPUT_",s):o+s;var l=B("<div/>",{id:!a.f?t+"_filter":null,class:e.sFilter}).append(B("<label/>").append(o));var c=function(){var e=a.f;var t=!this.value?"":this.value;if(t!=r.sSearch){_e(i,{sSearch:t,bRegex:r.bRegex,bSmart:r.bSmart,bCaseInsensitive:r.bCaseInsensitive});i._iDisplayStart=0;le(i)}};var u=i.searchDelay!==null?i.searchDelay:vt(i)==="ssp"?400:0;var d=B("input",l).val(r.sSearch).attr("placeholder",n.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",u?Ue(c,u):c).bind("keypress.DT",function(e){if(e.keyCode==13){return false}}).attr("aria-controls",t);B(i.nTable).on("search.dt.DT",function(e,t){if(i===t){try{if(d[0]!==Ut.activeElement){d.val(r.sSearch)}}catch(e){}}});return l[0]}function _e(e,t,i){var n=e.oPreviousSearch;var r=e.aoPreSearchCols;var a=function(e){n.sSearch=e.sSearch;n.bRegex=e.bRegex;n.bSmart=e.bSmart;n.bCaseInsensitive=e.bCaseInsensitive};var s=function(e){return e.bEscapeRegex!==$t?!e.bEscapeRegex:e.bRegex};j(e);if(vt(e)!="ssp"){xe(e,t.sSearch,i,s(t),t.bSmart,t.bCaseInsensitive);a(t);for(var o=0;o<r.length;o++){we(e,r[o].sSearch,o,s(r[o]),r[o].bSmart,r[o].bCaseInsensitive)}be(e)}else{a(t)}e.bFiltered=true;pt(e,null,"search",[e])}function be(e){var t=N.ext.search;var i=e.aiDisplay;var n,r;for(var a=0,s=t.length;a<s;a++){var o=[];for(var l=0,c=i.length;l<c;l++){r=i[l];n=e.aoData[r];if(t[a](e,n._aFilterData,r,n._aData,l)){o.push(r)}}i.length=0;i.push.apply(i,o)}}function we(e,t,i,n,r,a){if(t===""){return}var s;var o=e.aiDisplay;var l=Ce(t,n,r,a);for(var c=o.length-1;c>=0;c--){s=e.aoData[o[c]]._aFilterData[i];if(!l.test(s)){o.splice(c,1)}}}function xe(e,t,i,n,r,a){var s=Ce(t,n,r,a);var o=e.oPreviousSearch.sSearch;var l=e.aiDisplayMaster;var c,u,d;if(N.ext.search.length!==0){i=true}u=Se(e);if(t.length<=0){e.aiDisplay=l.slice()}else{if(u||i||o.length>t.length||t.indexOf(o)!==0||e.bSorted){e.aiDisplay=l.slice()}c=e.aiDisplay;for(d=c.length-1;d>=0;d--){if(!s.test(e.aoData[c[d]]._sFilterRow)){c.splice(d,1)}}}}function Ce(e,t,i,n){e=t?e:Te(e);if(i){var r=B.map(e.match(/"[^"]+"|[^ ]+/g)||"",function(e){if(e.charAt(0)==='"'){var t=e.match(/^"(.*)"$/);e=t?t[1]:e}return e.replace('"',"")});e="^(?=.*?"+r.join(")(?=.*?")+").*$"}return new RegExp(e,n?"i":"")}function Te(e){return e.replace(l,"\\$1")}var ke=B("<div>")[0];var Me=ke.textContent!==$t;function Se(e){var t=e.aoColumns;var i;var n,r,a,s,o,l,c;var u=N.ext.type.search;var d=false;for(n=0,a=e.aoData.length;n<a;n++){c=e.aoData[n];if(!c._aFilterData){o=[];for(r=0,s=t.length;r<s;r++){i=t[r];if(i.bSearchable){l=A(e,n,r,"filter");if(u[i.sType]){l=u[i.sType](l)}if(l===null){l=""}if(typeof l!=="string"&&l.toString){l=l.toString()}}else{l=""}if(l.indexOf&&l.indexOf("&")!==-1){ke.innerHTML=l;l=Me?ke.textContent:ke.innerText}if(l.replace){l=l.replace(/[\r\n]/g,"")}o.push(l)}c._aFilterData=o;c._sFilterRow=o.join("  ");d=true}}return d}function Le(e){return{search:e.sSearch,smart:e.bSmart,regex:e.bRegex,caseInsensitive:e.bCaseInsensitive}}function De(e){return{sSearch:e.search,bSmart:e.smart,bRegex:e.regex,bCaseInsensitive:e.caseInsensitive}}function je(e){var t=e.sTableId,i=e.aanFeatures.i,n=B("<div/>",{class:e.oClasses.sInfo,id:!i?t+"_info":null});if(!i){e.aoDrawCallback.push({fn:Ie,sName:"information"});n.attr("role","status").attr("aria-live","polite");B(e.nTable).attr("aria-describedby",t+"_info")}return n[0]}function Ie(e){var t=e.aanFeatures.i;if(t.length===0){return}var i=e.oLanguage,n=e._iDisplayStart+1,r=e.fnDisplayEnd(),a=e.fnRecordsTotal(),s=e.fnRecordsDisplay(),o=s?i.sInfo:i.sInfoEmpty;if(s!==a){o+=" "+i.sInfoFiltered}o+=i.sInfoPostFix;o=Ee(e,o);var l=i.fnInfoCallback;if(l!==null){o=l.call(e.oInstance,e,n,r,a,s,o)}B(t).html(o)}function Ee(e,t){var i=e.fnFormatNumber,n=e._iDisplayStart+1,r=e._iDisplayLength,a=e.fnRecordsDisplay(),s=r===-1;return t.replace(/_START_/g,i.call(e,n)).replace(/_END_/g,i.call(e,e.fnDisplayEnd())).replace(/_MAX_/g,i.call(e,e.fnRecordsTotal())).replace(/_TOTAL_/g,i.call(e,a)).replace(/_PAGE_/g,i.call(e,s?1:Math.ceil(n/r))).replace(/_PAGES_/g,i.call(e,s?1:Math.ceil(a/r)))}function Ae(i){var n,e,r=i.iInitDisplayStart;var t=i.aoColumns,a;var s=i.oFeatures;if(!i.bInitialised){setTimeout(function(){Ae(i)},200);return}ue(i);se(i);oe(i,i.aoHeader);oe(i,i.aoFooter);He(i,true);if(s.bAutoWidth){Ve(i)}for(n=0,e=t.length;n<e;n++){a=t[n];if(a.sWidth){a.nTh.style.width=Ye(a.sWidth)}}ce(i);var o=vt(i);if(o!="ssp"){if(o=="ajax"){fe(i,[],function(e){var t=ve(i,e);for(n=0;n<t.length;n++){$(i,t[n])}i.iInitDisplayStart=r;ce(i);He(i,false);Pe(i,e)},i)}else{He(i,false);Pe(i)}}}function Pe(e,t){e._bInitComplete=true;if(t){M(e)}pt(e,"aoInitComplete","init",[e,t])}function Oe(e,t){var i=parseInt(t,10);e._iDisplayLength=i;gt(e);pt(e,null,"length",[e,i])}function Ne(n){var e=n.oClasses,t=n.sTableId,i=n.aLengthMenu,r=B.isArray(i[0]),a=r?i[0]:i,s=r?i[1]:i;var o=B("<select/>",{name:t+"_length","aria-controls":t,class:e.sLengthSelect});for(var l=0,c=a.length;l<c;l++){o[0][l]=new Option(s[l],a[l])}var u=B("<div><label/></div>").addClass(e.sLength);if(!n.aanFeatures.l){u[0].id=t+"_length"}u.children().append(n.oLanguage.sLengthMenu.replace("_MENU_",o[0].outerHTML));B("select",u).val(n._iDisplayLength).bind("change.DT",function(e){Oe(n,B(this).val());le(n)});B(n.nTable).bind("length.dt.DT",function(e,t,i){if(n===t){B("select",u).val(i)}});return u[0]}function Re(e){var t=e.sPaginationType,u=N.ext.pager[t],d=typeof u==="function",h=function(e){le(e)},i=B("<div/>").addClass(e.oClasses.sPaging+t)[0],f=e.aanFeatures;if(!d){u.fnInit(e,i,h)}if(!f.p){i.id=e.sTableId+"_paginate";e.aoDrawCallback.push({fn:function(e){if(d){var t=e._iDisplayStart,i=e._iDisplayLength,n=e.fnRecordsDisplay(),r=i===-1,a=r?0:Math.ceil(t/i),s=r?1:Math.ceil(n/i),o=u(a,s),l,c;for(l=0,c=f.p.length;l<c;l++){mt(e,"pageButton")(e,f.p[l],l,o,a,s)}}else{u.fnUpdate(e,h)}},sName:"pagination"})}return i}function Fe(e,t,i){var n=e._iDisplayStart,r=e._iDisplayLength,a=e.fnRecordsDisplay();if(a===0||r===-1){n=0}else if(typeof t==="number"){n=t*r;if(n>a){n=0}}else if(t=="first"){n=0}else if(t=="previous"){n=r>=0?n-r:0;if(n<0){n=0}}else if(t=="next"){if(n+r<a){n+=r}}else if(t=="last"){n=Math.floor((a-1)/r)*r}else{ct(e,0,"Unknown paging action: "+t,5)}var s=e._iDisplayStart!==n;e._iDisplayStart=n;if(s){pt(e,null,"page",[e]);if(i){le(e)}}return s}function ze(e){return B("<div/>",{id:!e.aanFeatures.r?e.sTableId+"_processing":null,class:e.oClasses.sProcessing}).html(e.oLanguage.sProcessing).insertBefore(e.nTable)[0]}function He(e,t){if(e.oFeatures.bProcessing){B(e.aanFeatures.r).css("display",t?"block":"none")}pt(e,null,"processing",[e,t])}function Be(e){var t=B(e.nTable);t.attr("role","grid");var i=e.oScroll;if(i.sX===""&&i.sY===""){return e.nTable}var n=i.sX;var r=i.sY;var a=e.oClasses;var s=t.children("caption");var o=s.length?s[0]._captionSide:null;var l=B(t[0].cloneNode(false));var c=B(t[0].cloneNode(false));var u=t.children("tfoot");var d="<div/>";var h=function(e){return!e?null:Ye(e)};if(i.sX&&t.attr("width")==="100%"){t.removeAttr("width")}if(!u.length){u=null}var f=B(d,{class:a.sScrollWrapper}).append(B(d,{class:a.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:n?h(n):"100%"}).append(B(d,{class:a.sScrollHeadInner}).css({"box-sizing":"content-box",width:i.sXInner||"100%"}).append(l.removeAttr("id").css("margin-left",0).append(o==="top"?s:null).append(t.children("thead"))))).append(B(d,{class:a.sScrollBody}).css({overflow:"auto",height:h(r),width:h(n)}).append(t));if(u){f.append(B(d,{class:a.sScrollFoot}).css({overflow:"hidden",border:0,width:n?h(n):"100%"}).append(B(d,{class:a.sScrollFootInner}).append(c.removeAttr("id").css("margin-left",0).append(o==="bottom"?s:null).append(t.children("tfoot")))))}var p=f.children();var g=p[0];var m=p[1];var v=u?p[2]:null;if(n){B(m).on("scroll.DT",function(e){var t=this.scrollLeft;g.scrollLeft=t;if(u){v.scrollLeft=t}})}e.nScrollHead=g;e.nScrollBody=m;e.nScrollFoot=v;e.aoDrawCallback.push({fn:We,sName:"scrolling"});return f[0]}function We(i){var e=i.oScroll,t=e.sX,n=e.sXInner,r=e.sY,a=e.iBarWidth,s=B(i.nScrollHead),o=s[0].style,l=s.children("div"),c=l[0].style,u=l.children("table"),d=i.nScrollBody,h=B(d),f=d.style,p=B(i.nScrollFoot),g=p.children("div"),m=g.children("table"),v=B(i.nTHead),y=B(i.nTable),_=y[0],b=_.style,w=i.nTFoot?B(i.nTFoot):null,x=i.oBrowser,C=x.bScrollOversize,T,k,M,S,L,D,j=[],I=[],E=[],A,P,O,N=function(e){var t=e.style;t.paddingTop="0";t.paddingBottom="0";t.borderTopWidth="0";t.borderBottomWidth="0";t.height=0};y.children("thead, tfoot").remove();L=v.clone().prependTo(y);T=v.find("tr");M=L.find("tr");L.find("th, td").removeAttr("tabindex");if(w){D=w.clone().prependTo(y);k=w.find("tr");S=D.find("tr")}if(!t){f.width="100%";s[0].style.width="100%"}B.each(he(i,L),function(e,t){A=V(i,e);t.style.width=i.aoColumns[A].sWidth});if(w){qe(function(e){e.style.width=""},S)}if(e.bCollapse&&r!==""){f.height=h[0].offsetHeight+v[0].offsetHeight+"px"}O=y.outerWidth();if(t===""){b.width="100%";if(C&&(y.find("tbody").height()>d.offsetHeight||h.css("overflow-y")=="scroll")){b.width=Ye(y.outerWidth()-a)}}else{if(n!==""){b.width=Ye(n)}else if(O==h.width()&&h.height()<y.height()){b.width=Ye(O-a);if(y.outerWidth()>O-a){b.width=Ye(O)}}else{b.width=Ye(O)}}O=y.outerWidth();qe(N,M);qe(function(e){E.push(e.innerHTML);j.push(Ye(B(e).css("width")))},M);qe(function(e,t){e.style.width=j[t]},T);B(M).height(0);if(w){qe(N,S);qe(function(e){I.push(Ye(B(e).css("width")))},S);qe(function(e,t){e.style.width=I[t]},k);B(S).height(0)}qe(function(e,t){e.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+E[t]+"</div>";e.style.width=j[t]},M);if(w){qe(function(e,t){e.innerHTML="";e.style.width=I[t]},S)}if(y.outerWidth()<O){P=d.scrollHeight>d.offsetHeight||h.css("overflow-y")=="scroll"?O+a:O;if(C&&(d.scrollHeight>d.offsetHeight||h.css("overflow-y")=="scroll")){b.width=Ye(P-a)}if(t===""||n!==""){ct(i,1,"Possible column misalignment",6)}}else{P="100%"}f.width=Ye(P);o.width=Ye(P);if(w){i.nScrollFoot.style.width=Ye(P)}if(!r){if(C){f.height=Ye(_.offsetHeight+a)}}if(r&&e.bCollapse){f.height=Ye(r);var R=t&&_.offsetWidth>d.offsetWidth?a:0;if(_.offsetHeight<d.offsetHeight){f.height=Ye(_.offsetHeight+R)}}var F=y.outerWidth();u[0].style.width=Ye(F);c.width=Ye(F);var z=y.height()>d.clientHeight||h.css("overflow-y")=="scroll";var H="padding"+(x.bScrollbarLeft?"Left":"Right");c[H]=z?a+"px":"0px";if(w){m[0].style.width=Ye(F);g[0].style.width=Ye(F);g[0].style[H]=z?a+"px":"0px"}h.scroll();if((i.bSorted||i.bFiltered)&&!i._drawHold){d.scrollTop=0}}function qe(e,t,i){var n=0,r=0,a=t.length;var s,o;while(r<a){s=t[r].firstChild;o=i?i[r].firstChild:null;while(s){if(s.nodeType===1){if(i){e(s,o,n)}else{e(s,n)}n++}s=s.nextSibling;o=i?o.nextSibling:null}r++}}var Ge=/<.*?>/g;function Ve(e){var t=e.nTable,i=e.aoColumns,n=e.oScroll,r=n.sY,a=n.sX,s=n.sXInner,o=i.length,l=D(e,"bVisible"),c=B("th",e.nTHead),u=t.style.width||t.getAttribute("width"),d=t.parentNode,h=false,f,p,g,m,v;for(f=0;f<l.length;f++){p=i[l[f]];if(p.sWidth!==null){p.sWidth=$e(p.sWidthOrig,d);h=true}}if(!h&&!a&&!r&&o==L(e)&&o==c.length){for(f=0;f<o;f++){i[f].sWidth=Ye(c.eq(f).width())}}else{var y=B(t).clone().empty().css("visibility","hidden").removeAttr("id").append(B(e.nTHead).clone(false)).append(B(e.nTFoot).clone(false)).append(B("<tbody><tr/></tbody>"));y.find("tfoot th, tfoot td").css("width","");var _=y.find("tbody tr");c=he(e,y.find("thead")[0]);for(f=0;f<l.length;f++){p=i[l[f]];c[f].style.width=p.sWidthOrig!==null&&p.sWidthOrig!==""?Ye(p.sWidthOrig):""}if(e.aoData.length){for(f=0;f<l.length;f++){g=l[f];p=i[g];B(Qe(e,g)).clone(false).append(p.sContentPadding).appendTo(_)}}y.appendTo(d);if(a&&s){y.width(s)}else if(a){y.css("width","auto");if(y.width()<d.offsetWidth){y.width(d.offsetWidth)}}else if(r){y.width(d.offsetWidth)}else if(u){y.width(u)}Je(e,y[0]);if(a){var b=0;for(f=0;f<l.length;f++){p=i[l[f]];v=B(c[f]).outerWidth();b+=p.sWidthOrig===null?v:parseInt(p.sWidth,10)+v-B(c[f]).width()}y.width(Ye(b));t.style.width=Ye(b)}for(f=0;f<l.length;f++){p=i[l[f]];m=B(c[f]).width();if(m){p.sWidth=Ye(m)}}t.style.width=Ye(y.css("width"));y.remove()}if(u){t.style.width=Ye(u)}if((u||a)&&!e._reszEvt){B(Vt).bind("resize.DT-"+e.sInstance,Ue(function(){M(e)}));e._reszEvt=true}}function Ue(n,e){var r=e!==$t?e:200,a,s;return function(){var e=this,t=+new Date,i=arguments;if(a&&t<a+r){clearTimeout(s);s=setTimeout(function(){a=$t;n.apply(e,i)},r)}else{a=t;n.apply(e,i)}}}function $e(e,t){if(!e){return 0}var i=B("<div/>").css("width",Ye(e)).appendTo(t||Ut.body);var n=i[0].offsetWidth;i.remove();return n}function Je(e,t){var i=e.oScroll;if(i.sX||i.sY){var n=!i.sX?i.iBarWidth:0;t.style.width=Ye(B(t).outerWidth()-n)}}function Qe(e,t){var i=Xe(e,t);if(i<0){return null}var n=e.aoData[i];return!n.nTr?B("<td/>").html(A(e,i,t,"display"))[0]:n.anCells[t]}function Xe(e,t){var i,n=-1,r=-1;for(var a=0,s=e.aoData.length;a<s;a++){i=A(e,a,t,"display")+"";i=i.replace(Ge,"");if(i.length>n){n=i.length;r=a}}return r}function Ye(e){if(e===null){return"0px"}if(typeof e=="number"){return e<0?"0px":e+"px"}return e.match(/\d$/)?e+"px":e}function Ze(){if(!N.__scrollbarWidth){var e=B("<p/>").css({width:"100%",height:200,padding:0})[0];var t=B("<div/>").css({position:"absolute",top:0,left:0,width:200,height:150,padding:0,overflow:"hidden",visibility:"hidden"}).append(e).appendTo("body");var i=e.offsetWidth;t.css("overflow","scroll");var n=e.offsetWidth;if(i===n){n=t[0].clientWidth}t.remove();N.__scrollbarWidth=i-n}return N.__scrollbarWidth}function Ke(e){var t,i,n,r,a=[],s=[],o=e.aoColumns,l,c,u,d,h=e.aaSortingFixed,f=B.isPlainObject(h),p=[],g=function(e){if(e.length&&!B.isArray(e[0])){p.push(e)}else{p.push.apply(p,e)}};if(B.isArray(h)){g(h)}if(f&&h.pre){g(h.pre)}g(e.aaSorting);if(f&&h.post){g(h.post)}for(t=0;t<p.length;t++){d=p[t][0];l=o[d].aDataSort;for(n=0,r=l.length;n<r;n++){c=l[n];u=o[c].sType||"string";if(p[t]._idx===$t){p[t]._idx=B.inArray(p[t][1],o[c].asSorting)}a.push({src:d,col:c,dir:p[t][1],index:p[t]._idx,type:u,formatter:N.ext.type.order[u+"-pre"]})}}return a}function et(e){var t,i,n,r,a,s,o,l,c,h=[],f=N.ext.type.order,p=e.aoData,u=e.aoColumns,d,g,m,v,y,_=0,b,w=e.aiDisplayMaster,x;j(e);x=Ke(e);for(t=0,i=x.length;t<i;t++){b=x[t];if(b.formatter){_++}at(e,b.col)}if(vt(e)!="ssp"&&x.length!==0){for(t=0,n=w.length;t<n;t++){h[w[t]]=t}if(_===x.length){w.sort(function(e,t){var i,n,r,a,s,o=x.length,l=p[e]._aSortData,c=p[t]._aSortData;for(r=0;r<o;r++){s=x[r];i=l[s.col];n=c[s.col];a=i<n?-1:i>n?1:0;if(a!==0){return s.dir==="asc"?a:-a}}i=h[e];n=h[t];return i<n?-1:i>n?1:0})}else{w.sort(function(e,t){var i,n,r,a,s,o,l,c=x.length,u=p[e]._aSortData,d=p[t]._aSortData;for(r=0;r<c;r++){o=x[r];i=u[o.col];n=d[o.col];l=f[o.type+"-"+o.dir]||f["string-"+o.dir];s=l(i,n);if(s!==0){return s}}i=h[e];n=h[t];return i<n?-1:i>n?1:0})}}e.bSorted=true}function tt(e){var t;var i;var n=e.aoColumns;var r=Ke(e);var a=e.oLanguage.oAria;for(var s=0,o=n.length;s<o;s++){var l=n[s];var c=l.asSorting;var u=l.sTitle.replace(/<.*?>/g,"");var d=l.nTh;d.removeAttribute("aria-sort");if(l.bSortable){if(r.length>0&&r[0].col==s){d.setAttribute("aria-sort",r[0].dir=="asc"?"ascending":"descending");i=c[r[0].index+1]||c[0]}else{i=c[0]}t=u+(i==="asc"?a.sSortAscending:a.sSortDescending)}else{t=u}d.setAttribute("aria-label",t)}}function it(e,t,i,n){var r=e.aoColumns[t];var a=e.aaSorting;var s=r.asSorting;var o;var l=function(e,t){var i=e._idx;if(i===$t){i=B.inArray(e[1],s)}return i+1<s.length?i+1:t?null:0};if(typeof a[0]==="number"){a=e.aaSorting=[a]}if(i&&e.oFeatures.bSortMulti){var c=B.inArray(t,v(a,"0"));if(c!==-1){o=l(a[c],true);if(o===null){a.splice(c,1)}else{a[c][1]=s[o];a[c]._idx=o}}else{a.push([t,s[0],0]);a[a.length-1]._idx=0}}else if(a.length&&a[0][0]==t){o=l(a[0]);a.length=1;a[0][1]=s[o];a[0]._idx=o}else{a.length=0;a.push([t,s[0]]);a[0]._idx=0}ce(e);if(typeof n=="function"){n(e)}}function nt(t,e,i,n){var r=t.aoColumns[i];ht(e,{},function(e){if(r.bSortable===false){return}if(t.oFeatures.bProcessing){He(t,true);setTimeout(function(){it(t,i,e.shiftKey,n);if(vt(t)!=="ssp"){He(t,false)}},0)}else{it(t,i,e.shiftKey,n)}})}function rt(e){var t=e.aLastSort;var i=e.oClasses.sSortColumn;var n=Ke(e);var r=e.oFeatures;var a,s,o;if(r.bSort&&r.bSortClasses){for(a=0,s=t.length;a<s;a++){o=t[a].src;B(v(e.aoData,"anCells",o)).removeClass(i+(a<2?a+1:3))}for(a=0,s=n.length;a<s;a++){o=n[a].src;B(v(e.aoData,"anCells",o)).addClass(i+(a<2?a+1:3))}}e.aLastSort=n}function at(e,t){var i=e.aoColumns[t];var n=N.ext.order[i.sSortDataType];var r;if(n){r=n.call(e.oInstance,e,t,S(e,t))}var a,s;var o=N.ext.type.order[i.sType+"-pre"];for(var l=0,c=e.aoData.length;l<c;l++){a=e.aoData[l];if(!a._aSortData){a._aSortData=[]}if(!a._aSortData[t]||n){s=n?r[l]:A(e,l,t,"sort");a._aSortData[t]=o?o(s):s}}}function st(i){if(!i.oFeatures.bStateSave||i.bDestroying){return}var e={time:+new Date,start:i._iDisplayStart,length:i._iDisplayLength,order:B.extend(true,[],i.aaSorting),search:Le(i.oPreviousSearch),columns:B.map(i.aoColumns,function(e,t){return{visible:e.bVisible,search:Le(i.aoPreSearchCols[t])}})};pt(i,"aoStateSaveParams","stateSaveParams",[i,e]);i.oSavedState=e;i.fnStateSaveCallback.call(i.oInstance,i,e)}function ot(i,e){var t,n;var r=i.aoColumns;if(!i.oFeatures.bStateSave){return}var a=i.fnStateLoadCallback.call(i.oInstance,i);if(!a||!a.time){return}var s=pt(i,"aoStateLoadParams","stateLoadParams",[i,a]);if(B.inArray(false,s)!==-1){return}var o=i.iStateDuration;if(o>0&&a.time<+new Date-o*1e3){return}if(r.length!==a.columns.length){return}i.oLoadedState=B.extend(true,{},a);i._iDisplayStart=a.start;i.iInitDisplayStart=a.start;i._iDisplayLength=a.length;i.aaSorting=[];B.each(a.order,function(e,t){i.aaSorting.push(t[0]>=r.length?[0,t[1]]:t)});B.extend(i.oPreviousSearch,De(a.search));for(t=0,n=a.columns.length;t<n;t++){var l=a.columns[t];r[t].bVisible=l.visible;B.extend(i.aoPreSearchCols[t],De(l.search))}pt(i,"aoStateLoaded","stateLoaded",[i,a])}function lt(e){var t=N.settings;var i=B.inArray(e,v(t,"nTable"));return i!==-1?t[i]:null}function ct(e,t,i,n){i="DataTables warning: "+(e!==null?"table id="+e.sTableId+" - ":"")+i;if(n){i+=". For more information about this error, please see "+"http://datatables.net/tn/"+n}if(!t){var r=N.ext;var a=r.sErrMode||r.errMode;pt(e,null,"error",[e,n,i]);if(a=="alert"){alert(i)}else if(a=="throw"){throw new Error(i)}else if(typeof a=="function"){a(e,n,i)}}else if(Vt.console&&console.log){console.log(i)}}function ut(i,n,e,t){if(B.isArray(e)){B.each(e,function(e,t){if(B.isArray(t)){ut(i,n,t[0],t[1])}else{ut(i,n,t)}});return}if(t===$t){t=e}if(n[e]!==$t){i[t]=n[e]}}function dt(e,t,i){var n;for(var r in t){if(t.hasOwnProperty(r)){n=t[r];if(B.isPlainObject(n)){if(!B.isPlainObject(e[r])){e[r]={}}B.extend(true,e[r],n)}else if(i&&r!=="data"&&r!=="aaData"&&B.isArray(n)){e[r]=n.slice()}else{e[r]=n}}}return e}function ht(t,e,i){B(t).bind("click.DT",e,function(e){t.blur();i(e)}).bind("keypress.DT",e,function(e){if(e.which===13){e.preventDefault();i(e)}}).bind("selectstart.DT",function(){return false})}function ft(e,t,i,n){if(i){e[t].push({fn:i,sName:n})}}function pt(i,e,t,n){var r=[];if(e){r=B.map(i[e].slice().reverse(),function(e,t){return e.fn.apply(i.oInstance,n)})}if(t!==null){B(i.nTable).trigger(t+".dt",n)}return r}function gt(e){var t=e._iDisplayStart,i=e.fnDisplayEnd(),n=e._iDisplayLength;if(t>=i){t=i-n}t-=t%n;if(n===-1||t<0){t=0}e._iDisplayStart=t}function mt(e,t){var i=e.renderer;var n=N.ext.renderer[t];if(B.isPlainObject(i)&&i[t]){return n[i[t]]||n._}else if(typeof i==="string"){return n[i]||n._}return n._}function vt(e){if(e.oFeatures.bServerSide){return"ssp"}else if(e.ajax||e.sAjaxSource){return"ajax"}return"dom"}N=function(E){this.$=function(e,t){return this.api(true).$(e,t)};this._=function(e,t){return this.api(true).rows(e,t).data()};this.api=function(e){return e?new y(lt(this[n.iApiIndex])):new y(this)};this.fnAddData=function(e,t){var i=this.api(true);var n=B.isArray(e)&&(B.isArray(e[0])||B.isPlainObject(e[0]))?i.rows.add(e):i.row.add(e);if(t===$t||t){i.draw()}return n.flatten().toArray()};this.fnAdjustColumnSizing=function(e){var t=this.api(true).columns.adjust();var i=t.settings()[0];var n=i.oScroll;if(e===$t||e){t.draw(false)}else if(n.sX!==""||n.sY!==""){We(i)}};this.fnClearTable=function(e){var t=this.api(true).clear();if(e===$t||e){t.draw()}};this.fnClose=function(e){this.api(true).row(e).child.hide()};this.fnDeleteRow=function(e,t,i){var n=this.api(true);var r=n.rows(e);var a=r.settings()[0];var s=a.aoData[r[0][0]];r.remove();if(t){t.call(this,a,s)}if(i===$t||i){n.draw()}return s};this.fnDestroy=function(e){this.api(true).destroy(e)};this.fnDraw=function(e){this.api(true).draw(!e)};this.fnFilter=function(e,t,i,n,r,a){var s=this.api(true);if(t===null||t===$t){s.search(e,i,n,a)}else{s.column(t).search(e,i,n,a)}s.draw()};this.fnGetData=function(e,t){var i=this.api(true);if(e!==$t){var n=e.nodeName?e.nodeName.toLowerCase():"";return t!==$t||n=="td"||n=="th"?i.cell(e,t).data():i.row(e).data()||null}return i.data().toArray()};this.fnGetNodes=function(e){var t=this.api(true);return e!==$t?t.row(e).node():t.rows().nodes().flatten().toArray()};this.fnGetPosition=function(e){var t=this.api(true);var i=e.nodeName.toUpperCase();if(i=="TR"){return t.row(e).index()}else if(i=="TD"||i=="TH"){var n=t.cell(e).index();return[n.row,n.columnVisible,n.column]}return null};this.fnIsOpen=function(e){return this.api(true).row(e).child.isShown()};this.fnOpen=function(e,t,i){return this.api(true).row(e).child(t,i).show().child()[0]};this.fnPageChange=function(e,t){var i=this.api(true).page(e);if(t===$t||t){i.draw(false)}};this.fnSetColumnVis=function(e,t,i){var n=this.api(true).column(e).visible(t);if(i===$t||i){n.columns.adjust().draw()}};this.fnSettings=function(){return lt(this[n.iApiIndex])};this.fnSort=function(e){this.api(true).order(e).draw()};this.fnSortListener=function(e,t,i){this.api(true).order.listener(e,t,i)};this.fnUpdate=function(e,t,i,n,r){var a=this.api(true);if(i===$t||i===null){a.row(t).data(e)}else{a.cell(t,i).data(e)}if(r===$t||r){a.columns.adjust()}if(n===$t||n){a.draw()}return 0};this.fnVersionCheck=n.fnVersionCheck;var A=this;var P=E===$t;var O=this.length;if(P){E={}}this.oApi=this.internal=n.internal;for(var e in N.ext.internal){if(e){this[e]=Gt(e)}}this.each(function(){var e={};var t=O>1?dt(e,E,true):E;var i=0,n,r,a,s,o;var l=this.getAttribute("id");var c=false;var u=N.defaults;var d=B(this);if(this.nodeName.toLowerCase()!="table"){ct(null,0,"Non-table node initialisation ("+this.nodeName+")",2);return}z(u);H(u.column);R(u,u,true);R(u.column,u.column,true);R(u,B.extend(t,d.data()));var h=N.settings;for(i=0,n=h.length;i<n;i++){var f=h[i];if(f.nTable==this||f.nTHead.parentNode==this||f.nTFoot&&f.nTFoot.parentNode==this){var p=t.bRetrieve!==$t?t.bRetrieve:u.bRetrieve;var g=t.bDestroy!==$t?t.bDestroy:u.bDestroy;if(P||p){return f.oInstance}else if(g){f.oInstance.fnDestroy();break}else{ct(f,0,"Cannot reinitialise DataTable",3);return}}if(f.sTableId==this.id){h.splice(i,1);break}}if(l===null||l===""){l="DataTables_Table_"+N.ext._unique++;this.id=l}var m=B.extend(true,{},N.models.oSettings,{nTable:this,oApi:A.internal,oInit:t,sDestroyWidth:d[0].style.width,sInstance:l,sTableId:l});h.push(m);m.oInstance=A.length===1?A:d.dataTable();z(t);if(t.oLanguage){F(t.oLanguage)}if(t.aLengthMenu&&!t.iDisplayLength){t.iDisplayLength=B.isArray(t.aLengthMenu[0])?t.aLengthMenu[0][0]:t.aLengthMenu[0]}t=dt(B.extend(true,{},u),t);ut(m.oFeatures,t,["bPaginate","bLengthChange","bFilter","bSort","bSortMulti","bInfo","bProcessing","bAutoWidth","bSortClasses","bServerSide","bDeferRender"]);ut(m,t,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);ut(m.oScroll,t,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);ut(m.oLanguage,t,"fnInfoCallback");ft(m,"aoDrawCallback",t.fnDrawCallback,"user");ft(m,"aoServerParams",t.fnServerParams,"user");ft(m,"aoStateSaveParams",t.fnStateSaveParams,"user");ft(m,"aoStateLoadParams",t.fnStateLoadParams,"user");ft(m,"aoStateLoaded",t.fnStateLoaded,"user");ft(m,"aoRowCallback",t.fnRowCallback,"user");ft(m,"aoRowCreatedCallback",t.fnCreatedRow,"user");ft(m,"aoHeaderCallback",t.fnHeaderCallback,"user");ft(m,"aoFooterCallback",t.fnFooterCallback,"user");ft(m,"aoInitComplete",t.fnInitComplete,"user");ft(m,"aoPreDrawCallback",t.fnPreDrawCallback,"user");var v=m.oClasses;if(t.bJQueryUI){B.extend(v,N.ext.oJUIClasses,t.oClasses);if(t.sDom===u.sDom&&u.sDom==="lfrtip"){m.sDom='<"H"lfr>t<"F"ip>'}if(!m.renderer){m.renderer="jqueryui"}else if(B.isPlainObject(m.renderer)&&!m.renderer.header){m.renderer.header="jqueryui"}}else{B.extend(v,N.ext.classes,t.oClasses)}d.addClass(v.sTable);if(m.oScroll.sX!==""||m.oScroll.sY!==""){m.oScroll.iBarWidth=Ze()}if(m.oScroll.sX===true){m.oScroll.sX="100%"}if(m.iInitDisplayStart===$t){m.iInitDisplayStart=t.iDisplayStart;m._iDisplayStart=t.iDisplayStart}if(t.iDeferLoading!==null){m.bDeferLoading=true;var y=B.isArray(t.iDeferLoading);m._iRecordsDisplay=y?t.iDeferLoading[0]:t.iDeferLoading;m._iRecordsTotal=y?t.iDeferLoading[1]:t.iDeferLoading}var _=m.oLanguage;B.extend(true,_,t.oLanguage);if(_.sUrl!==""){B.ajax({dataType:"json",url:_.sUrl,success:function(e){F(e);R(u.oLanguage,e);B.extend(true,_,e);Ae(m)},error:function(){Ae(m)}});c=true}if(t.asStripeClasses===null){m.asStripeClasses=[v.sStripeOdd,v.sStripeEven]}var b=m.asStripeClasses;var w=B("tbody tr",this).eq(0);if(B.inArray(true,B.map(b,function(e,t){return w.hasClass(e)}))!==-1){B("tbody tr",this).removeClass(b.join(" "));m.asDestroyStripes=b.slice()}var x=[];var C;var T=this.getElementsByTagName("thead");if(T.length!==0){de(m.aoHeader,T[0]);x=he(m)}if(t.aoColumns===null){C=[];for(i=0,n=x.length;i<n;i++){C.push(null)}}else{C=t.aoColumns}for(i=0,n=C.length;i<n;i++){q(m,x?x[i]:null)}U(m,t.aoColumnDefs,C,function(e,t){G(m,e,t)});if(w.length){var k=function(e,t){return e.getAttribute("data-"+t)!==null?t:null};B.each(ne(m,w[0]).cells,function(e,t){var i=m.aoColumns[e];if(i.mData===e){var n=k(t,"sort")||k(t,"order");var r=k(t,"filter")||k(t,"search");if(n!==null||r!==null){i.mData={_:e+".display",sort:n!==null?e+".@data-"+n:$t,type:n!==null?e+".@data-"+n:$t,filter:r!==null?e+".@data-"+r:$t};G(m,e)}}})}var M=m.oFeatures;if(t.bStateSave){M.bStateSave=true;ot(m,t);ft(m,"aoDrawCallback",st,"state_save")}if(t.aaSorting===$t){var S=m.aaSorting;for(i=0,n=S.length;i<n;i++){S[i][1]=m.aoColumns[i].asSorting[0]}}rt(m);if(M.bSort){ft(m,"aoDrawCallback",function(){if(m.bSorted){var e=Ke(m);var i={};B.each(e,function(e,t){i[t.src]=t.dir});pt(m,null,"order",[m,e,i]);tt(m)}})}ft(m,"aoDrawCallback",function(){if(m.bSorted||vt(m)==="ssp"||M.bDeferRender){rt(m)}},"sc");W(m);var L=d.children("caption").each(function(){this._captionSide=d.css("caption-side")});var D=d.children("thead");if(D.length===0){D=B("<thead/>").appendTo(this)}m.nTHead=D[0];var j=d.children("tbody");if(j.length===0){j=B("<tbody/>").appendTo(this)}m.nTBody=j[0];var I=d.children("tfoot");if(I.length===0&&L.length>0&&(m.oScroll.sX!==""||m.oScroll.sY!=="")){I=B("<tfoot/>").appendTo(this)}if(I.length===0||I.children().length===0){d.addClass(v.sNoFooter)}else if(I.length>0){m.nTFoot=I[0];de(m.aoFooter,m.nTFoot)}if(t.aaData){for(i=0;i<t.aaData.length;i++){$(m,t.aaData[i])}}else if(m.bDeferLoading||vt(m)=="dom"){J(m,B(m.nTBody).children("tr"))}m.aiDisplay=m.aiDisplayMaster.slice();m.bInitialised=true;if(c===false){Ae(m)}});A=null;return this};var yt=[];var _t=Array.prototype;var bt=function(e){var t,i;var n=N.settings;var r=B.map(n,function(e,t){return e.nTable});if(!e){return[]}else if(e.nTable&&e.oApi){return[e]}else if(e.nodeName&&e.nodeName.toLowerCase()==="table"){t=B.inArray(e,r);return t!==-1?[n[t]]:null}else if(e&&typeof e.settings==="function"){return e.settings().toArray()}else if(typeof e==="string"){i=B(e)}else if(e instanceof B){i=e}if(i){return i.map(function(e){t=B.inArray(this,r);return t!==-1?n[t]:null}).toArray()}};y=function(e,t){if(!this instanceof y){throw"DT API must be constructed as a new object"}var i=[];var n=function(e){var t=bt(e);if(t){i.push.apply(i,t)}};if(B.isArray(e)){for(var r=0,a=e.length;r<a;r++){n(e[r])}}else{n(e)}this.context=x(i);if(t){this.push.apply(this,t.toArray?t.toArray():t)}this.selector={rows:null,cols:null,opts:null};y.extend(this,this,yt)};N.Api=y;y.prototype={concat:_t.concat,context:[],each:function(e){for(var t=0,i=this.length;t<i;t++){e.call(this,this[t],t,this)}return this},eq:function(e){var t=this.context;return t.length>e?new y(t[e],this[e]):null},filter:function(e){var t=[];if(_t.filter){t=_t.filter.call(this,e,this)}else{for(var i=0,n=this.length;i<n;i++){if(e.call(this,this[i],i,this)){t.push(this[i])}}}return new y(this.context,t)},flatten:function(){var e=[];return new y(this.context,e.concat.apply(e,this.toArray()))},join:_t.join,indexOf:_t.indexOf||function(e,t){for(var i=t||0,n=this.length;i<n;i++){if(this[i]===e){return i}}return-1},iterator:function(e,t,i,n){var r=[],a,s,o,l,c,u=this.context,d,h,f,p=this.selector;if(typeof e==="string"){n=i;i=t;t=e;e=false}for(s=0,o=u.length;s<o;s++){var g=new y(u[s]);if(t==="table"){a=i.call(g,u[s],s);if(a!==$t){r.push(a)}}else if(t==="columns"||t==="rows"){a=i.call(g,u[s],this[s],s);if(a!==$t){r.push(a)}}else if(t==="column"||t==="column-rows"||t==="row"||t==="cell"){h=this[s];if(t==="column-rows"){d=Mt(u[s],p.opts)}for(l=0,c=h.length;l<c;l++){f=h[l];if(t==="cell"){a=i.call(g,u[s],f.row,f.column,s,l)}else{a=i.call(g,u[s],f,s,l,d)}if(a!==$t){r.push(a)}}}}if(r.length||n){var m=new y(u,e?r.concat.apply([],r):r);var v=m.selector;v.rows=p.rows;v.cols=p.cols;v.opts=p.opts;return m}return this},lastIndexOf:_t.lastIndexOf||function(e,t){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(e){var t=[];if(_t.map){t=_t.map.call(this,e,this)}else{for(var i=0,n=this.length;i<n;i++){t.push(e.call(this,this[i],i))}}return new y(this.context,t)},pluck:function(t){return this.map(function(e){return e[t]})},pop:_t.pop,push:_t.push,reduce:_t.reduce||function(e,t){return k(this,e,t,0,this.length,1)},reduceRight:_t.reduceRight||function(e,t){return k(this,e,t,this.length-1,-1,-1)},reverse:_t.reverse,selector:null,shift:_t.shift,sort:_t.sort,splice:_t.splice,toArray:function(){return _t.slice.call(this)},to$:function(){return B(this)},toJQuery:function(){return B(this)},unique:function(){return new y(this.context,x(this))},unshift:_t.unshift};y.extend=function(e,t,i){if(!i.length||!t||!(t instanceof y)&&!t.__dt_wrapper){return}var n,r,a,s,o,l,c=function(t,i,n){return function(){var e=i.apply(t,arguments);y.extend(e,e,n.methodExt);return e}};for(n=0,r=i.length;n<r;n++){o=i[n];t[o.name]=typeof o.val==="function"?c(e,o.val,o):B.isPlainObject(o.val)?{}:o.val;t[o.name].__dt_wrapper=true;y.extend(e,t[o.name],o.propExt)}};y.register=t=function(e,t){if(B.isArray(e)){for(var i=0,n=e.length;i<n;i++){y.register(e[i],t)}return}var r,a,s=e.split("."),o=yt,l,c;var u=function(e,t){for(var i=0,n=e.length;i<n;i++){if(e[i].name===t){return e[i]}}return null};for(r=0,a=s.length;r<a;r++){c=s[r].indexOf("()")!==-1;l=c?s[r].replace("()",""):s[r];var d=u(o,l);if(!d){d={name:l,val:{},methodExt:[],propExt:[]};o.push(d)}if(r===a-1){d.val=t}else{o=c?d.methodExt:d.propExt}}};y.registerPlural=e=function(e,t,i){y.register(e,i);y.register(t,function(){var e=i.apply(this,arguments);if(e===this){return this}else if(e instanceof y){return e.length?B.isArray(e[0])?new y(e.context,e[0]):e[0]:$t}return e})};var wt=function(e,i){if(typeof e==="number"){return[i[e]]}var n=B.map(i,function(e,t){return e.nTable});return B(n).filter(e).map(function(e){var t=B.inArray(this,n);return i[t]}).toArray()};t("tables()",function(e){return e?new y(wt(e,this.context)):this});t("table()",function(e){var t=this.tables(e);var i=t.context;return i.length?new y(i[0]):t});e("tables().nodes()","table().node()",function(){return this.iterator("table",function(e){return e.nTable},1)});e("tables().body()","table().body()",function(){return this.iterator("table",function(e){return e.nTBody},1)});e("tables().header()","table().header()",function(){return this.iterator("table",function(e){return e.nTHead},1)});e("tables().footer()","table().footer()",function(){return this.iterator("table",function(e){return e.nTFoot},1)});e("tables().containers()","table().container()",function(){return this.iterator("table",function(e){return e.nTableWrapper},1)});t("draw()",function(t){return this.iterator("table",function(e){ce(e,t===false)})});t("page()",function(t){if(t===$t){return this.page.info().page}return this.iterator("table",function(e){Fe(e,t)})});t("page.info()",function(e){if(this.context.length===0){return $t}var t=this.context[0],i=t._iDisplayStart,n=t._iDisplayLength,r=t.fnRecordsDisplay(),a=n===-1;return{page:a?0:Math.floor(i/n),pages:a?1:Math.ceil(r/n),start:i,end:t.fnDisplayEnd(),length:n,recordsTotal:t.fnRecordsTotal(),recordsDisplay:r}});t("page.len()",function(t){if(t===$t){return this.context.length!==0?this.context[0]._iDisplayLength:$t}return this.iterator("table",function(e){Oe(e,t)})});var xt=function(r,a,e){if(vt(r)=="ssp"){ce(r,a)}else{He(r,true);fe(r,[],function(e){ee(r);var t=ve(r,e);for(var i=0,n=t.length;i<n;i++){$(r,t[i])}ce(r,a);He(r,false)})}if(e){var t=new y(r);t.one("draw",function(){e(t.ajax.json())})}};t("ajax.json()",function(){var e=this.context;if(e.length>0){return e[0].json}});t("ajax.params()",function(){var e=this.context;if(e.length>0){return e[0].oAjaxData}});t("ajax.reload()",function(t,i){return this.iterator("table",function(e){xt(e,i===false,t)})});t("ajax.url()",function(t){var e=this.context;if(t===$t){if(e.length===0){return $t}e=e[0];return e.ajax?B.isPlainObject(e.ajax)?e.ajax.url:e.ajax:e.sAjaxSource}return this.iterator("table",function(e){if(B.isPlainObject(e.ajax)){e.ajax.url=t}else{e.ajax=t}})});t("ajax.url().load()",function(t,i){return this.iterator("table",function(e){xt(e,i===false,t)})});var Ct=function(e,t){var i=[],n,r,a,s,o,l,c=typeof e;if(!e||c==="string"||c==="function"||e.length===$t){e=[e]}for(a=0,s=e.length;a<s;a++){r=e[a]&&e[a].split?e[a].split(","):[e[a]];for(o=0,l=r.length;o<l;o++){n=t(typeof r[o]==="string"?B.trim(r[o]):r[o]);if(n&&n.length){i.push.apply(i,n)}}}return i};var Tt=function(e){if(!e){e={}}if(e.filter&&!e.search){e.search=e.filter}return{search:e.search||"none",order:e.order||"current",page:e.page||"all"}};var kt=function(e){for(var t=0,i=e.length;t<i;t++){if(e[t].length>0){e[0]=e[t];e.length=1;e.context=[e.context[t]];return e}}e.length=0;return e};var Mt=function(e,t){var i,n,r,a=[],s=e.aiDisplay,o=e.aiDisplayMaster;var l=t.search,c=t.order,u=t.page;if(vt(e)=="ssp"){return l==="removed"?[]:_(0,o.length)}else if(u=="current"){for(i=e._iDisplayStart,n=e.fnDisplayEnd();i<n;i++){a.push(s[i])}}else if(c=="current"||c=="applied"){a=l=="none"?o.slice():l=="applied"?s.slice():B.map(o,function(e,t){return B.inArray(e,s)===-1?e:null})}else if(c=="index"||c=="original"){for(i=0,n=e.aoData.length;i<n;i++){if(l=="none"){a.push(i)}else{r=B.inArray(i,s);if(r===-1&&l=="removed"||r>=0&&l=="applied"){a.push(i)}}}}return a};var St=function(s,e,o){return Ct(e,function(i){var e=d(i);var t,n;if(e!==null&&!o){return[e]}var r=Mt(s,o);if(e!==null&&B.inArray(e,r)!==-1){return[e]}else if(!i){return r}if(typeof i==="function"){return B.map(r,function(e){var t=s.aoData[e];return i(e,t._aData,t.nTr)?e:null})}var a=b(m(s.aoData,r,"nTr"));if(i.nodeName){if(B.inArray(i,a)!==-1){return[i._DT_RowIndex]}}return B(a).filter(i).map(function(){return this._DT_RowIndex}).toArray()})};t("rows()",function(t,i){if(t===$t){t=""}else if(B.isPlainObject(t)){i=t;t=""}i=Tt(i);var e=this.iterator("table",function(e){return St(e,t,i)},1);e.selector.rows=t;e.selector.opts=i;return e});t("rows().nodes()",function(){return this.iterator("row",function(e,t){return e.aoData[t].nTr||$t},1)});t("rows().data()",function(){return this.iterator(true,"rows",function(e,t){return m(e.aoData,t,"_aData")},1)});e("rows().cache()","row().cache()",function(n){return this.iterator("row",function(e,t){var i=e.aoData[t];return n==="search"?i._aFilterData:i._aSortData},1)});e("rows().invalidate()","row().invalidate()",function(i){return this.iterator("row",function(e,t){ie(e,t,i)})});e("rows().indexes()","row().index()",function(){return this.iterator("row",function(e,t){return t},1)});e("rows().remove()","row().remove()",function(){var o=this;return this.iterator("row",function(e,t,i){var n=e.aoData;n.splice(t,1);for(var r=0,a=n.length;r<a;r++){if(n[r].nTr!==null){n[r].nTr._DT_RowIndex=r}}var s=B.inArray(t,e.aiDisplay);te(e.aiDisplayMaster,t);te(e.aiDisplay,t);te(o[i],t,false);gt(e)})});t("rows.add()",function(a){var e=this.iterator("table",function(e){var t,i,n;var r=[];for(i=0,n=a.length;i<n;i++){t=a[i];if(t.nodeName&&t.nodeName.toUpperCase()==="TR"){r.push(J(e,t)[0])}else{r.push($(e,t))}}return r},1);var t=this.rows(-1);t.pop();t.push.apply(t,e.toArray());return t});t("row()",function(e,t){return kt(this.rows(e,t))});t("row().data()",function(e){var t=this.context;if(e===$t){return t.length&&this.length?t[0].aoData[this[0]]._aData:$t}t[0].aoData[this[0]]._aData=e;ie(t[0],this[0],"data");return this});t("row().node()",function(){var e=this.context;return e.length&&this.length?e[0].aoData[this[0]].nTr||null:null});t("row.add()",function(t){if(t instanceof B&&t.length){t=t[0]}var e=this.iterator("table",function(e){if(t.nodeName&&t.nodeName.toUpperCase()==="TR"){return J(e,t)[0]}return $(e,t)});return this.row(e[0])});var Lt=function(n,e,t,i){var r=[];var a=function(e,t){if(e.nodeName&&e.nodeName.toLowerCase()==="tr"){r.push(e)}else{var i=B("<tr><td/></tr>").addClass(t);B("td",i).addClass(t).html(e)[0].colSpan=L(n);r.push(i[0])}};if(B.isArray(t)||t instanceof B){for(var s=0,o=t.length;s<o;s++){a(t[s],i)}}else{a(t,i)}if(e._details){e._details.remove()}e._details=B(r);if(e._detailsShow){e._details.insertAfter(e.nTr)}};var Dt=function(e,t){var i=e.context;if(i.length){var n=i[0].aoData[t!==$t?t:e[0]];if(n._details){n._details.remove();n._detailsShow=$t;n._details=$t}}};var jt=function(e,t){var i=e.context;if(i.length&&e.length){var n=i[0].aoData[e[0]];if(n._details){n._detailsShow=t;if(t){n._details.insertAfter(n.nTr)}else{n._details.detach()}It(i[0])}}};var It=function(l){var r=new y(l);var e=".dt.DT_details";var t="draw"+e;var i="column-visibility"+e;var n="destroy"+e;var c=l.aoData;r.off(t+" "+i+" "+n);if(v(c,"_details").length>0){r.on(t,function(e,t){if(l!==t){return}r.rows({page:"current"}).eq(0).each(function(e){var t=c[e];if(t._detailsShow){t._details.insertAfter(t.nTr)}})});r.on(i,function(e,t,i,n){if(l!==t){return}var r,a=L(t);for(var s=0,o=c.length;s<o;s++){r=c[s];if(r._details){r._details.children("td[colspan]").attr("colspan",a)}}});r.on(n,function(e,t){if(l!==t){return}for(var i=0,n=c.length;i<n;i++){if(c[i]._details){Dt(r,i)}}})}};var Et="";var At=Et+"row().child";var Pt=At+"()";t(Pt,function(e,t){var i=this.context;if(e===$t){return i.length&&this.length?i[0].aoData[this[0]]._details:$t}else if(e===true){this.child.show()}else if(e===false){Dt(this)}else if(i.length&&this.length){Lt(i[0],i[0].aoData[this[0]],e,t)}return this});t([At+".show()",Pt+".show()"],function(e){jt(this,true);return this});t([At+".hide()",Pt+".hide()"],function(){jt(this,false);return this});t([At+".remove()",Pt+".remove()"],function(){Dt(this);return this});t(At+".isShown()",function(){var e=this.context;if(e.length&&this.length){return e[0].aoData[this[0]]._detailsShow||false}return false});var Ot=/^(.+):(name|visIdx|visible)$/;var Nt=function(e,t,i,n,r){var a=[];for(var s=0,o=r.length;s<o;s++){a.push(A(e,r[s],t))}return a};var Rt=function(s,e,o){var l=s.aoColumns,c=v(l,"sName"),u=v(l,"nTh");return Ct(e,function(i){var e=d(i);if(i===""){return _(l.length)}if(e!==null){return[e>=0?e:l.length+e]}if(typeof i==="function"){var n=Mt(s,o);return B.map(l,function(e,t){return i(t,Nt(s,t,0,0,n),u[t])?t:null})}var r=typeof i==="string"?i.match(Ot):"";if(r){switch(r[2]){case"visIdx":case"visible":var t=parseInt(r[1],10);if(t<0){var a=B.map(l,function(e,t){return e.bVisible?t:null});return[a[a.length+t]]}return[V(s,t)];case"name":return B.map(c,function(e,t){return e===r[1]?t:null})}}else{return B(u).filter(i).map(function(){return B.inArray(this,u)}).toArray()}})};var Ft=function(e,t,i,n){var r=e.aoColumns,a=r[t],s=e.aoData,o,l,c,u,d;if(i===$t){return a.bVisible}if(a.bVisible===i){return}if(i){var h=B.inArray(true,v(r,"bVisible"),t+1);for(c=0,u=s.length;c<u;c++){d=s[c].nTr;l=s[c].anCells;if(d){d.insertBefore(l[t],l[h]||null)}}}else{B(v(e.aoData,"anCells",t)).detach()}a.bVisible=i;oe(e,e.aoHeader);oe(e,e.aoFooter);if(n===$t||n){M(e);if(e.oScroll.sX||e.oScroll.sY){We(e)}}pt(e,null,"column-visibility",[e,t,i]);st(e)};t("columns()",function(t,i){if(t===$t){t=""}else if(B.isPlainObject(t)){i=t;t=""}i=Tt(i);var e=this.iterator("table",function(e){return Rt(e,t,i)},1);e.selector.cols=t;e.selector.opts=i;return e});e("columns().header()","column().header()",function(e,t){return this.iterator("column",function(e,t){return e.aoColumns[t].nTh},1)});e("columns().footer()","column().footer()",function(e,t){return this.iterator("column",function(e,t){return e.aoColumns[t].nTf},1)});e("columns().data()","column().data()",function(){return this.iterator("column-rows",Nt,1)});e("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(e,t){return e.aoColumns[t].mData},1)});e("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",function(e,t,i,n,r){return m(e.aoData,r,a==="search"?"_aFilterData":"_aSortData",t)},1)});e("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(e,t,i,n,r){return m(e.aoData,r,"anCells",t)},1)});e("columns().visible()","column().visible()",function(i,n){return this.iterator("column",function(e,t){if(i===$t){return e.aoColumns[t].bVisible}Ft(e,t,i,n)})});e("columns().indexes()","column().index()",function(i){return this.iterator("column",function(e,t){return i==="visible"?S(e,t):t},1)});t("columns.adjust()",function(){return this.iterator("table",function(e){M(e)},1)});t("column.index()",function(e,t){if(this.context.length!==0){var i=this.context[0];if(e==="fromVisible"||e==="toData"){return V(i,t)}else if(e==="fromData"||e==="toVisible"){return S(i,t)}}});t("column()",function(e,t){return kt(this.columns(e,t))});var zt=function(i,e,t){var n=i.aoData;var r=Mt(i,t);var a=b(m(n,r,"anCells"));var s=B([].concat.apply([],a));var o;var l=i.aoColumns.length;var c,u,d,h,f,p;return Ct(e,function(e){var t=typeof e==="function";if(e===null||e===$t||t){c=[];for(u=0,d=r.length;u<d;u++){o=r[u];for(h=0;h<l;h++){f={row:o,column:h};if(t){p=i.aoData[o];if(e(f,A(i,o,h),p.anCells[h])){c.push(f)}}else{c.push(f)}}}return c}if(B.isPlainObject(e)){return[e]}return s.filter(e).map(function(e,t){o=t.parentNode._DT_RowIndex;return{row:o,column:B.inArray(t,n[o].anCells)}}).toArray()})};t("cells()",function(t,e,i){if(B.isPlainObject(t)){if(typeof t.row!==$t){i=e;e=null}else{i=t;t=null}}if(B.isPlainObject(e)){i=e;e=null}if(e===null||e===$t){return this.iterator("table",function(e){return zt(e,t,Tt(i))})}var n=this.columns(e,i);var r=this.rows(t,i);var a,s,o,l,c;var u=this.iterator("table",function(e,t){a=[];for(s=0,o=r[t].length;s<o;s++){for(l=0,c=n[t].length;l<c;l++){a.push({row:r[t][s],column:n[t][l]})}}return a},1);B.extend(u.selector,{cols:e,rows:t,opts:i});return u});e("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(e,t,i){var n=e.aoData[t].anCells;return n?n[i]:$t},1)});t("cells().data()",function(){return this.iterator("cell",function(e,t,i){return A(e,t,i)},1)});e("cells().cache()","cell().cache()",function(n){n=n==="search"?"_aFilterData":"_aSortData";return this.iterator("cell",function(e,t,i){return e.aoData[t][n][i]},1)});e("cells().render()","cell().render()",function(n){return this.iterator("cell",function(e,t,i){return A(e,t,i,n)},1)});e("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(e,t,i){return{row:t,column:i,columnVisible:S(e,i)}},1)});e("cells().invalidate()","cell().invalidate()",function(n){return this.iterator("cell",function(e,t,i){ie(e,t,n,i)})});t("cell()",function(e,t,i){return kt(this.cells(e,t,i))});t("cell().data()",function(e){var t=this.context;var i=this[0];if(e===$t){return t.length&&i.length?A(t[0],i[0].row,i[0].column):$t}P(t[0],i[0].row,i[0].column,e);ie(t[0],i[0].row,"data",i[0].column);return this});t("order()",function(t,e){var i=this.context;if(t===$t){return i.length!==0?i[0].aaSorting:$t}if(typeof t==="number"){t=[[t,e]]}else if(!B.isArray(t[0])){t=Array.prototype.slice.call(arguments)}return this.iterator("table",function(e){e.aaSorting=t.slice()})});t("order.listener()",function(t,i,n){return this.iterator("table",function(e){nt(e,t,i,n)})});t(["columns().order()","column().order()"],function(n){var r=this;return this.iterator("table",function(e,t){var i=[];B.each(r[t],function(e,t){i.push([t,n])});e.aaSorting=i})});t("search()",function(t,i,n,r){var e=this.context;if(t===$t){return e.length!==0?e[0].oPreviousSearch.sSearch:$t}return this.iterator("table",function(e){if(!e.oFeatures.bFilter){return}_e(e,B.extend({},e.oPreviousSearch,{sSearch:t+"",bRegex:i===null?false:i,bSmart:n===null?true:n,bCaseInsensitive:r===null?true:r}),1)})});e("columns().search()","column().search()",function(n,r,a,s){return this.iterator("column",function(e,t){var i=e.aoPreSearchCols;if(n===$t){return i[t].sSearch}if(!e.oFeatures.bFilter){return}B.extend(i[t],{sSearch:n+"",bRegex:r===null?false:r,bSmart:a===null?true:a,bCaseInsensitive:s===null?true:s});_e(e,e.oPreviousSearch,1)})});t("state()",function(){return this.context.length?this.context[0].oSavedState:null});t("state.clear()",function(){return this.iterator("table",function(e){e.fnStateSaveCallback.call(e.oInstance,e,{})})});t("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:null});t("state.save()",function(){return this.iterator("table",function(e){st(e)})});N.versionCheck=N.fnVersionCheck=function(e){var t=N.version.split(".");var i=e.split(".");var n,r;for(var a=0,s=i.length;a<s;a++){n=parseInt(t[a],10)||0;r=parseInt(i[a],10)||0;if(n===r){continue}return n>r}return true};N.isDataTable=N.fnIsDataTable=function(e){var i=B(e).get(0);var n=false;B.each(N.settings,function(e,t){if(t.nTable===i||B("table",t.nScrollHead)[0]===i||B("table",t.nScrollFoot)[0]===i){n=true}});return n};N.tables=N.fnTables=function(t){return B.map(N.settings,function(e){if(!t||t&&B(e.nTable).is(":visible")){return e.nTable}})};N.util={throttle:Ue,escapeRegex:Te};N.camelToHungarian=R;t("$()",function(e,t){var i=this.rows(t).nodes(),n=B(i);return B([].concat(n.filter(e).toArray(),n.find(e).toArray()))});B.each(["on","one","off"],function(e,i){t(i+"()",function(){var e=Array.prototype.slice.call(arguments);if(!e[0].match(/\.dt\b/)){e[0]+=".dt"}var t=B(this.tables().nodes());t[i].apply(t,e);return this})});t("clear()",function(){return this.iterator("table",function(e){ee(e)})});t("settings()",function(){return new y(this.context,this.context)});t("data()",function(){return this.iterator("table",function(e){return v(e.aoData,"_aData")}).flatten()});t("destroy()",function(p){p=p||false;return this.iterator("table",function(t){var e=t.nTableWrapper.parentNode;var i=t.oClasses;var n=t.nTable;var r=t.nTBody;var a=t.nTHead;var s=t.nTFoot;var o=B(n);var l=B(r);var c=B(t.nTableWrapper);var u=B.map(t.aoData,function(e){return e.nTr});var d,h;t.bDestroying=true;pt(t,"aoDestroyCallback","destroy",[t]);if(!p){new y(t).columns().visible(true)}c.unbind(".DT").find(":not(tbody *)").unbind(".DT");B(Vt).unbind(".DT-"+t.sInstance);if(n!=a.parentNode){o.children("thead").detach();o.append(a)}if(s&&n!=s.parentNode){o.children("tfoot").detach();o.append(s)}o.detach();c.detach();t.aaSorting=[];t.aaSortingFixed=[];rt(t);B(u).removeClass(t.asStripeClasses.join(" "));B("th, td",a).removeClass(i.sSortable+" "+i.sSortableAsc+" "+i.sSortableDesc+" "+i.sSortableNone);if(t.bJUI){B("th span."+i.sSortIcon+", td span."+i.sSortIcon,a).detach();B("th, td",a).each(function(){var e=B("div."+i.sSortJUIWrapper,this);B(this).append(e.contents());e.detach()})}if(!p&&e){e.insertBefore(n,t.nTableReinsertBefore)}l.children().detach();l.append(u);o.css("width",t.sDestroyWidth).removeClass(i.sTable);h=t.asDestroyStripes.length;if(h){l.children().each(function(e){B(this).addClass(t.asDestroyStripes[e%h])})}var f=B.inArray(t,N.settings);if(f!==-1){N.settings.splice(f,1)}})});N.version="1.10.5";N.settings=[];N.models={};N.models.oSearch={bCaseInsensitive:true,sSearch:"",bRegex:false,bSmart:true};N.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null};N.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:false,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};N.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:true,bDeferRender:false,bDestroy:false,bFilter:true,bInfo:true,bJQueryUI:false,bLengthChange:true,bPaginate:true,bProcessing:false,bRetrieve:false,bScrollCollapse:false,bServerSide:false,bSort:true,bSortMulti:true,bSortCellsTop:false,bSortClasses:true,bStateSave:false,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(e){try{return JSON.parse((e.iStateDuration===-1?sessionStorage:localStorage).getItem("DataTables_"+e.sInstance+"_"+location.pathname))}catch(e){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(e,t){try{(e.iStateDuration===-1?sessionStorage:localStorage).setItem("DataTables_"+e.sInstance+"_"+location.pathname,JSON.stringify(t))}catch(e){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:B.extend({},N.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null};C(N.defaults);N.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:true,bSortable:true,bVisible:true,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};C(N.defaults.column);N.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:false,bScrollbarLeft:false},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:false,bInitialised:false,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:true,jqXHR:null,json:$t,oAjaxData:$t,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:false,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:false,bSorted:false,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return vt(this)=="ssp"?this._iRecordsTotal*1:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return vt(this)=="ssp"?this._iRecordsDisplay*1:this.aiDisplay.length},fnDisplayEnd:function(){var e=this._iDisplayLength,t=this._iDisplayStart,i=t+e,n=this.aiDisplay.length,r=this.oFeatures,a=r.bPaginate;if(r.bServerSide){return a===false||e===-1?t+n:Math.min(t+e,this._iRecordsDisplay)}else{return!a||i>n||e===-1?n:i}},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{}};N.ext=n={buttons:{},classes:{},errMode:"alert",feature:[],search:[],internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:N.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:N.version};B.extend(n,{afnFiltering:n.search,aTypes:n.type.detect,ofnSearch:n.type.search,oSort:n.type.order,afnSortData:n.order,aoFeatures:n.feature,oApi:n.internal,oStdClasses:n.classes,oPagination:n.pager});B.extend(N.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});(function(){var e="";e="";var t=e+"ui-state-default";var i=e+"css_right ui-icon ui-icon-";var n=e+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";B.extend(N.ext.oJUIClasses,N.ext.classes,{sPageButton:"fg-button ui-button "+t,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi "+"ui-buttonset-multi paging_",sSortAsc:t+" sorting_asc",sSortDesc:t+" sorting_desc",sSortable:t+" sorting",sSortableAsc:t+" sorting_asc_disabled",sSortableDesc:t+" sorting_desc_disabled",sSortableNone:t+" sorting_disabled",sSortJUIAsc:i+"triangle-1-n",sSortJUIDesc:i+"triangle-1-s",sSortJUI:i+"carat-2-n-s",sSortJUIAscAllowed:i+"carat-1-n",sSortJUIDescAllowed:i+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+t,sScrollFoot:"dataTables_scrollFoot "+t,sHeaderTH:t,sFooterTH:t,sJUIHeader:n+" ui-corner-tl ui-corner-tr",sJUIFooter:n+" ui-corner-bl ui-corner-br"})})();var Ht=N.ext.pager;function Bt(e,t){var i=[],n=Ht.numbers_length,r=Math.floor(n/2),a=1;if(t<=n){i=_(0,t)}else if(e<=r){i=_(0,n-2);i.push("ellipsis");i.push(t-1)}else if(e>=t-1-r){i=_(t-(n-2),t);i.splice(0,0,"ellipsis");i.splice(0,0,0)}else{i=_(e-1,e+2);i.push("ellipsis");i.push(t-1);i.splice(0,0,"ellipsis");i.splice(0,0,0)}i.DT_el="span";return i}B.extend(Ht,{simple:function(e,t){return["previous","next"]},full:function(e,t){return["first","previous","next","last"]},simple_numbers:function(e,t){return["previous",Bt(e,t),"next"]},full_numbers:function(e,t){return["first","previous",Bt(e,t),"next","last"]},_numbers:Bt,numbers_length:7});B.extend(true,N.ext.renderer,{pageButton:{_:function(l,e,c,t,u,d){var h=l.oClasses;var f=l.oLanguage.oPaginate;var p,g,m=0;var v=function(e,t){var i,n,r,a;var s=function(e){Fe(l,e.data.action,true)};for(i=0,n=t.length;i<n;i++){a=t[i];if(B.isArray(a)){var o=B("<"+(a.DT_el||"div")+"/>").appendTo(e);v(o,a)}else{p="";g="";switch(a){case"ellipsis":e.append("<span>&hellip;</span>");break;case"first":p=f.sFirst;g=a+(u>0?"":" "+h.sPageButtonDisabled);break;case"previous":p=Vt.__?__(f.sPrevious):f.sPrevious;g=a+(u>0?"":" "+h.sPageButtonDisabled);break;case"next":p=Vt.__?__(f.sNext):f.sNext;g=a+(u<d-1?"":" "+h.sPageButtonDisabled);break;case"last":p=f.sLast;g=a+(u<d-1?"":" "+h.sPageButtonDisabled);break;default:p=a+1;g=u===a?h.sPageButtonActive:"";break}if(p){r=B("<a>",{class:h.sPageButton+" "+g,"aria-controls":l.sTableId,"data-dt-idx":m,tabindex:l.iTabIndex,id:c===0&&typeof a==="string"?l.sTableId+"_"+a:null}).html(p).appendTo(e);ht(r,{action:a},s);m++}}}};var i;try{i=B(Ut.activeElement).data("dt-idx")}catch(e){}v(B(e).empty(),t);if(i){B(e).find("[data-dt-idx="+i+"]").focus()}}}});B.extend(N.ext.type.detect,[function(e,t){var i=t.oLanguage.sDecimal;return f(e,i)?"num"+i:null},function(e,t){if(e&&!(e instanceof Date)&&(!s.test(e)||!o.test(e))){return null}var i=Date.parse(e);return i!==null&&!isNaN(i)||u(e)?"date":null},function(e,t){var i=t.oLanguage.sDecimal;return f(e,i,true)?"num-fmt"+i:null},function(e,t){var i=t.oLanguage.sDecimal;return g(e,i)?"html-num"+i:null},function(e,t){var i=t.oLanguage.sDecimal;return g(e,i,true)?"html-num-fmt"+i:null},function(e,t){return u(e)||typeof e==="string"&&e.indexOf("<")!==-1?"html":null}]);B.extend(N.ext.type.search,{html:function(e){return u(e)?e:typeof e==="string"?e.replace(r," ").replace(a,""):""},string:function(e){return u(e)?e:typeof e==="string"?e.replace(r," "):e}});var Wt=function(e,t,i,n){if(e!==0&&(!e||e==="-")){return-Infinity}if(t){e=h(e,t)}if(e.replace){if(i){e=e.replace(i,"")}if(n){e=e.replace(n,"")}}return e*1};function qt(i){B.each({num:function(e){return Wt(e,i)},"num-fmt":function(e){return Wt(e,i,c)},"html-num":function(e){return Wt(e,i,a)},"html-num-fmt":function(e){return Wt(e,i,a,c)}},function(e,t){n.type.order[e+i+"-pre"]=t;if(e.match(/^html\-/)){n.type.search[e+i]=n.type.search.html}})}B.extend(n.type.order,{"date-pre":function(e){return Date.parse(e)||0},"html-pre":function(e){return u(e)?"":e.replace?e.replace(/<.*?>/g,"").toLowerCase():e+""},"string-pre":function(e){return u(e)?"":typeof e==="string"?e.toLowerCase():!e.toString?"":e.toString()},"string-asc":function(e,t){return e<t?-1:e>t?1:0},"string-desc":function(e,t){return e<t?1:e>t?-1:0}});qt("");B.extend(true,N.ext.renderer,{header:{_:function(a,s,o,l){B(a.nTable).on("order.dt.DT",function(e,t,i,n){if(a!==t){return}var r=o.idx;s.removeClass(o.sSortingClass+" "+l.sSortAsc+" "+l.sSortDesc).addClass(n[r]=="asc"?l.sSortAsc:n[r]=="desc"?l.sSortDesc:o.sSortingClass)})},jqueryui:function(a,s,o,l){B("<div/>").addClass(l.sSortJUIWrapper).append(s.contents()).append(B("<span/>").addClass(l.sSortIcon+" "+o.sSortingClassJUI)).appendTo(s);B(a.nTable).on("order.dt.DT",function(e,t,i,n){if(a!==t){return}var r=o.idx;s.removeClass(l.sSortAsc+" "+l.sSortDesc).addClass(n[r]=="asc"?l.sSortAsc:n[r]=="desc"?l.sSortDesc:o.sSortingClass);s.find("span."+l.sSortIcon).removeClass(l.sSortJUIAsc+" "+l.sSortJUIDesc+" "+l.sSortJUI+" "+l.sSortJUIAscAllowed+" "+l.sSortJUIDescAllowed).addClass(n[r]=="asc"?l.sSortJUIAsc:n[r]=="desc"?l.sSortJUIDesc:o.sSortingClassJUI)})}}});N.render={number:function(r,a,s,o){return{display:function(e){var t=e<0?"-":"";e=Math.abs(parseFloat(e));var i=parseInt(e,10);var n=s?a+(e-i).toFixed(s).substring(2):"";return t+(o||"")+i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,r)+n}}}};function Gt(t){return function(){var e=[lt(this[N.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return N.ext.internal[t].apply(this,e)}}B.extend(N.ext.internal,{_fnExternApiFunc:Gt,_fnBuildAjax:fe,_fnAjaxUpdate:pe,_fnAjaxParameters:ge,_fnAjaxUpdateDraw:me,_fnAjaxDataSrc:ve,_fnAddColumn:q,_fnColumnOptions:G,_fnAdjustColumnSizing:M,_fnVisibleToColumnIndex:V,_fnColumnIndexToVisible:S,_fnVisbleColumns:L,_fnGetColumns:D,_fnColumnTypes:j,_fnApplyColumnDefs:U,_fnHungarianMap:C,_fnCamelToHungarian:R,_fnLanguageCompat:F,_fnBrowserDetect:W,_fnAddData:$,_fnAddTr:J,_fnNodeToDataIndex:I,_fnNodeToColumnIndex:E,_fnGetCellData:A,_fnSetCellData:P,_fnSplitObjNotation:X,_fnGetObjectDataFn:Y,_fnSetObjectDataFn:Z,_fnGetDataMaster:K,_fnClearTable:ee,_fnDeleteIndex:te,_fnInvalidate:ie,_fnGetRowElements:ne,_fnCreateTr:re,_fnBuildHead:se,_fnDrawHead:oe,_fnDraw:le,_fnReDraw:ce,_fnAddOptionsHtml:ue,_fnDetectHeader:de,_fnGetUniqueThs:he,_fnFeatureHtmlFilter:ye,_fnFilterComplete:_e,_fnFilterCustom:be,_fnFilterColumn:we,_fnFilter:xe,_fnFilterCreateSearch:Ce,_fnEscapeRegex:Te,_fnFilterData:Se,_fnFeatureHtmlInfo:je,_fnUpdateInfo:Ie,_fnInfoMacros:Ee,_fnInitialise:Ae,_fnInitComplete:Pe,_fnLengthChange:Oe,_fnFeatureHtmlLength:Ne,_fnFeatureHtmlPaginate:Re,_fnPageChange:Fe,_fnFeatureHtmlProcessing:ze,_fnProcessingDisplay:He,_fnFeatureHtmlTable:Be,_fnScrollDraw:We,_fnApplyToChildren:qe,_fnCalculateColumnWidths:Ve,_fnThrottle:Ue,_fnConvertToWidth:$e,_fnScrollingWidthAdjust:Je,_fnGetWidestNode:Qe,_fnGetMaxLenString:Xe,_fnStringToCss:Ye,_fnScrollBarWidth:Ze,_fnSortFlatten:Ke,_fnSort:et,_fnSortAria:tt,_fnSortListener:it,_fnSortAttachListener:nt,_fnSortingClasses:rt,_fnSortData:at,_fnSaveState:st,_fnLoadState:ot,_fnSettingsFromNode:lt,_fnLog:ct,_fnMap:ut,_fnBindAction:ht,_fnCallbackReg:ft,_fnCallbackFire:pt,_fnLengthOverflow:gt,_fnRenderer:mt,_fnDataSource:vt,_fnRowAttributes:ae,_fnCalculateEnd:function(){}});B.fn.dataTable=N;B.fn.dataTableSettings=N.settings;B.fn.dataTableExt=N.ext;B.fn.DataTable=function(e){return B(this).dataTable(e).api()};B.each(N,function(e,t){B.fn.DataTable[e]=t});return B.fn.dataTable})})(window,document);(function(s,t,e){var i=function(h,r){"use strict";var a=function(e,t){if(!r.versionCheck||!r.versionCheck("1.10.1")){throw"DataTables Responsive requires DataTables 1.10.1 or newer"}this.s={dt:new r.Api(e),columns:[]};if(this.s.dt.settings()[0].responsive){return}if(t&&typeof t.details==="string"){t.details={type:t.details}}this.c=h.extend(true,{},a.defaults,r.defaults.responsive,t);e.responsive=this;this._constructor()};a.prototype={_constructor:function(){var r=this;var a=this.s.dt;a.settings()[0]._responsive=this;h(s).on("resize.dtr orientationchange.dtr",a.settings()[0].oApi._fnThrottle(function(){r._resize()}));a.on("destroy.dtr",function(){h(s).off("resize.dtr orientationchange.dtr draw.dtr")});this.c.breakpoints.sort(function(e,t){return e.width<t.width?1:e.width>t.width?-1:0});this._classLogic();this._resizeAuto();this._resize();var e=this.c.details;if(e.type){r._detailsInit();this._detailsVis();a.on("column-visibility.dtr",function(){r._detailsVis()});a.on("draw.dtr",function(){a.rows().iterator("row",function(e,t){var i=a.row(t);if(i.child.isShown()){var n=r.c.details.renderer(a,t);i.child(n,"child").show()}})});h(a.table().node()).addClass("dtr-"+e.type)}},_columnsVisiblity:function(t){var e=this.s.dt;var i=this.s.columns;var n,r;var a=h.map(i,function(e){return e.auto&&e.minWidth===null?false:e.auto===true?"-":h.inArray(t,e.includeIn)!==-1});var s=0;for(n=0,r=a.length;n<r;n++){if(a[n]===true){s+=i[n].minWidth}}var o=e.table().container().offsetWidth;var l=o-s;for(n=0,r=a.length;n<r;n++){if(i[n].control){l-=i[n].minWidth}}for(n=0,r=a.length;n<r;n++){if(a[n]==="-"&&!i[n].control){a[n]=l-i[n].minWidth<0?false:true;l-=i[n].minWidth}}var c=false;for(n=0,r=i.length;n<r;n++){if(!i[n].control&&!i[n].never&&!a[n]){c=true;break}}for(n=0,r=i.length;n<r;n++){if(i[n].control){a[n]=c}}if(h.inArray(true,a)===-1){a[0]=true}return a},_classLogic:function(){var o=this;var e={};var l=this.c.breakpoints;var c=this.s.dt.columns().eq(0).map(function(e){var t=this.column(e).header().className;return{className:t,includeIn:[],auto:false,control:false,never:t.match(/\bnever\b/)?true:false}});var u=function(e,t){var i=c[e].includeIn;if(h.inArray(t,i)===-1){i.push(t)}};var d=function(e,t,i,n){var r,a,s;if(!i){c[e].includeIn.push(t)}else if(i==="max-"){r=o._find(t).width;for(a=0,s=l.length;a<s;a++){if(l[a].width<=r){u(e,l[a].name)}}}else if(i==="min-"){r=o._find(t).width;for(a=0,s=l.length;a<s;a++){if(l[a].width>=r){u(e,l[a].name)}}}else if(i==="not-"){for(a=0,s=l.length;a<s;a++){if(l[a].name.indexOf(n)===-1){u(e,l[a].name)}}}};c.each(function(e,a){var t=e.className.split(" ");var s=false;for(var i=0,n=t.length;i<n;i++){var o=h.trim(t[i]);if(o==="all"){s=true;e.includeIn=h.map(l,function(e){return e.name});return}else if(o==="none"||o==="never"){s=true;return}else if(o==="control"){s=true;e.control=true;return}h.each(l,function(e,t){var i=t.name.split("-");var n=new RegExp("(min\\-|max\\-|not\\-)?("+i[0]+")(\\-[_a-zA-Z0-9])?");var r=o.match(n);if(r){s=true;if(r[2]===i[0]&&r[3]==="-"+i[1]){d(a,t.name,r[1],r[2]+r[3])}else if(r[2]===i[0]&&!r[3]){d(a,t.name,r[1],r[2])}}})}if(!s){e.auto=true}});this.s.columns=c},_detailsInit:function(){var r=this;var a=this.s.dt;var e=this.c.details;if(e.type==="inline"){e.target="td:first-child"}var s=e.target;var t=typeof s==="string"?s:"td";h(a.table().body()).on("click",t,function(e){if(!h(a.table().node()).hasClass("collapsed")){return}if(!a.row(h(this).closest("tr")).length){return}if(typeof s==="number"){var t=s<0?a.columns().eq(0).length+s:s;if(a.cell(this).index().column!==t){return}}var i=a.row(h(this).closest("tr"));if(i.child.isShown()){i.child(false);h(i.node()).removeClass("parent")}else{var n=r.c.details.renderer(a,i[0]);i.child(n,"child").show();h(i.node()).addClass("parent")}})},_detailsVis:function(){var n=this;var r=this.s.dt;var e=r.columns().indexes().filter(function(e){var t=r.column(e);if(t.visible()){return null}return h(t.header()).hasClass("never")?null:e});var t=true;if(e.length===0||e.length===1&&this.s.columns[e[0]].control){t=false}if(t){h(r.table().node()).addClass("collapsed");r.rows().eq(0).each(function(e){var t=r.row(e);if(t.child()){var i=n.c.details.renderer(r,t[0]);if(i===false){t.child.hide()}else{t.child(i,"child").show()}}})}else{h(r.table().node()).removeClass("collapsed");r.rows().eq(0).each(function(e){r.row(e).child.hide()})}},_find:function(e){var t=this.c.breakpoints;for(var i=0,n=t.length;i<n;i++){if(t[i].name===e){return t[i]}}},_resize:function(){var i=this.s.dt;var e=h(s).width();var t=this.c.breakpoints;var n=t[0].name;for(var r=t.length-1;r>=0;r--){if(e<=t[r].width){n=t[r].name;break}}var a=this._columnsVisiblity(n);i.columns().eq(0).each(function(e,t){i.column(e).visible(a[t])})},_resizeAuto:function(){var i=this.s.dt;var t=this.s.columns;if(!this.c.auto){return}if(h.inArray(true,h.map(t,function(e){return e.auto}))===-1){return}var e=i.table().node().offsetWidth;var n=i.columns;var r=i.table().node().cloneNode(false);var a=h(i.table().header().cloneNode(false)).appendTo(r);var s=h(i.table().body().cloneNode(false)).appendTo(r);i.rows({page:"current"}).indexes().flatten().each(function(e){var t=i.row(e).node().cloneNode(true);if(i.columns(":hidden").flatten().length){h(t).append(i.cells(e,":hidden").nodes().to$().clone())}h(t).appendTo(s)});var o=i.columns().header().to$().clone(false);h("<tr/>").append(o).appendTo(a);var l=h("<div/>").css({width:1,height:1,overflow:"hidden"}).append(r).insertBefore(i.table().node());i.columns().eq(0).each(function(e){t[e].minWidth=o[e].offsetWidth||0});l.remove()}};a.breakpoints=[{name:"desktop",width:Infinity},{name:"tablet-l",width:1024},{name:"tablet-p",width:768},{name:"mobile-l",width:480},{name:"mobile-p",width:320}];a.defaults={breakpoints:a.breakpoints,auto:true,details:{renderer:function(s,e){var t=s.cells(e,":hidden").eq(0).map(function(e){var t=h(s.column(e.column).header());var i=s.cell(e).index();if(t.hasClass("control")||t.hasClass("never")){return""}var n=s.settings()[0];var r=n.oApi._fnGetCellData(n,i.row,i.column,"display");var a=t.text();if(a){a=a+":"}return'<li data-dtr-index="'+i.column+'">'+'<span class="dtr-title">'+a+"</span> "+'<span class="dtr-data">'+r+"</span>"+"</li>"}).toArray().join("");return t?h('<ul data-dtr-index="'+e+'"/>').append(t):false},target:0,type:"inline"}};var e=h.fn.dataTable.Api;e.register("responsive()",function(){return this});e.register("responsive.index()",function(e){e=h(e);return{column:e.data("dtr-index"),row:e.parent().data("dtr-index")}});e.register("responsive.rebuild()",function(){return this.iterator("table",function(e){if(e._responsive){e._responsive._classLogic()}})});e.register("responsive.recalc()",function(){return this.iterator("table",function(e){if(e._responsive){e._responsive._resizeAuto();e._responsive._resize()}})});a.version="1.0.4";h.fn.dataTable.Responsive=a;h.fn.DataTable.Responsive=a;h(t).on("init.dt.dtr",function(e,t,i){if(h(t.nTable).hasClass("responsive")||h(t.nTable).hasClass("dt-responsive")||t.oInit.responsive||r.defaults.responsive){var n=t.oInit.responsive;if(n!==false){new a(t,h.isPlainObject(n)?n:{})}}});return a};if(typeof define==="function"&&define.amd){define(["jquery","datatables"],i)}else if(typeof exports==="object"){i(require("jquery"),require("datatables"))}else if(jQuery&&!jQuery.fn.dataTable.Responsive){i(jQuery,jQuery.fn.dataTable)}})(window,document);(function(e,s,o){function y(e){var t=[];for(var i=0,n=e.length;i<n;i++){t[e[i]]=i}return t}function _(e,t,i){var n=e.splice(t,1)[0];e.splice(i,0,n)}function b(e,t,i){var n=[];for(var r=0,a=e.childNodes.length;r<a;r++){if(e.childNodes[r].nodeType==1){n.push(e.childNodes[r])}}var s=n[t];if(i!==null){e.insertBefore(s,n[i])}else{e.appendChild(s)}}$.fn.dataTableExt.oApi.fnColReorder=function(i,e,t){var n=$.fn.dataTable.Api?true:false;var r,a,s,o,l=i.aoColumns.length,c,u;var d=function(e,t,i){if(!e[t]){return}var n=e[t].split(".");var r=n.shift();if(isNaN(r*1)){return}e[t]=i[r*1]+"."+n.join(".")};if(e==t){return}if(e<0||e>=l){this.oApi._fnLog(i,1,"ColReorder 'from' index is out of bounds: "+e);return}if(t<0||t>=l){this.oApi._fnLog(i,1,"ColReorder 'to' index is out of bounds: "+t);return}var h=[];for(r=0,a=l;r<a;r++){h[r]=r}_(h,e,t);var f=y(h);for(r=0,a=i.aaSorting.length;r<a;r++){i.aaSorting[r][0]=f[i.aaSorting[r][0]]}if(i.aaSortingFixed!==null){for(r=0,a=i.aaSortingFixed.length;r<a;r++){i.aaSortingFixed[r][0]=f[i.aaSortingFixed[r][0]]}}for(r=0,a=l;r<a;r++){u=i.aoColumns[r];for(s=0,o=u.aDataSort.length;s<o;s++){u.aDataSort[s]=f[u.aDataSort[s]]}if(n){u.idx=f[u.idx]}}if(n){$.each(i.aLastSort,function(e,t){i.aLastSort[e].src=f[t.src]})}for(r=0,a=l;r<a;r++){u=i.aoColumns[r];if(typeof u.mData=="number"){u.mData=f[u.mData];i.oApi._fnColumnOptions(i,r,{})}else if($.isPlainObject(u.mData)){d(u.mData,"_",f);d(u.mData,"filter",f);d(u.mData,"sort",f);d(u.mData,"type",f);i.oApi._fnColumnOptions(i,r,{})}}if(i.aoColumns[e].bVisible){var p=this.oApi._fnColumnIndexToVisible(i,e);var g=null;r=t<e?t:t+1;while(g===null&&r<l){g=this.oApi._fnColumnIndexToVisible(i,r);r++}c=i.nTHead.getElementsByTagName("tr");for(r=0,a=c.length;r<a;r++){b(c[r],p,g)}if(i.nTFoot!==null){c=i.nTFoot.getElementsByTagName("tr");for(r=0,a=c.length;r<a;r++){b(c[r],p,g)}}for(r=0,a=i.aoData.length;r<a;r++){if(i.aoData[r].nTr!==null){b(i.aoData[r].nTr,p,g)}}}_(i.aoColumns,e,t);_(i.aoPreSearchCols,e,t);for(r=0,a=i.aoData.length;r<a;r++){var m=i.aoData[r];if(n){if(m.anCells){_(m.anCells,e,t)}if(m.src!=="dom"&&$.isArray(m._aData)){_(m._aData,e,t)}}else{if($.isArray(m._aData)){_(m._aData,e,t)}_(m._anHidden,e,t)}}for(r=0,a=i.aoHeader.length;r<a;r++){_(i.aoHeader[r],e,t)}if(i.aoFooter!==null){for(r=0,a=i.aoFooter.length;r<a;r++){_(i.aoFooter[r],e,t)}}if(n){var v=new $.fn.dataTable.Api(i);v.rows().invalidate()}for(r=0,a=l;r<a;r++){$(i.aoColumns[r].nTh).off("click.DT");this.oApi._fnSortAttachListener(i,i.aoColumns[r].nTh,r)}$(i.oInstance).trigger("column-reorder",[i,{iFrom:e,iTo:t,aiInvertMapping:f}])};var t=function(c,e){"use strict";var r=function(e,t){var i;if(c.fn.dataTable.Api){i=new c.fn.dataTable.Api(e).settings()[0]}else if(e.fnSettings){i=e.fnSettings()}else if(typeof e==="string"){if(c.fn.dataTable.fnIsDataTable(c(e)[0])){i=c(e).eq(0).dataTable().fnSettings()}}else if(e.nodeName&&e.nodeName.toLowerCase()==="table"){if(c.fn.dataTable.fnIsDataTable(e.nodeName)){i=c(e.nodeName).dataTable().fnSettings()}}else if(e instanceof jQuery){if(c.fn.dataTable.fnIsDataTable(e[0])){i=e.eq(0).dataTable().fnSettings()}}else{i=e}var n=c.fn.dataTable.camelToHungarian;if(n){n(r.defaults,r.defaults,true);n(r.defaults,t||{})}this.s={dt:null,init:c.extend(true,{},r.defaults,t),fixed:0,fixedRight:0,dropCallback:null,mouse:{startX:-1,startY:-1,offsetX:-1,offsetY:-1,target:-1,targetIndex:-1,fromIndex:-1},aoTargets:[]};this.dom={drag:null,pointer:null};this.s.dt=i.oInstance.fnSettings();this.s.dt._colReorder=this;this._fnConstruct();i.oApi._fnCallbackReg(i,"aoDestroyCallback",c.proxy(this._fnDestroy,this),"ColReorder");return this};r.prototype={fnReset:function(){var e=[];for(var t=0,i=this.s.dt.aoColumns.length;t<i;t++){e.push(this.s.dt.aoColumns[t]._ColReorder_iOrigCol)}this._fnOrderColumns(e);return this},fnGetCurrentOrder:function(){return this.fnOrder()},fnOrder:function(e){if(e===o){var t=[];for(var i=0,n=this.s.dt.aoColumns.length;i<n;i++){t.push(this.s.dt.aoColumns[i]._ColReorder_iOrigCol)}return t}this._fnOrderColumns(y(e));return this},_fnConstruct:function(){var i=this;var e=this.s.dt.aoColumns.length;var t;if(this.s.init.iFixedColumns){this.s.fixed=this.s.init.iFixedColumns}this.s.fixedRight=this.s.init.iFixedColumnsRight?this.s.init.iFixedColumnsRight:0;if(this.s.init.fnReorderCallback){this.s.dropCallback=this.s.init.fnReorderCallback}for(t=0;t<e;t++){if(t>this.s.fixed-1&&t<e-this.s.fixedRight){this._fnMouseListener(t,this.s.dt.aoColumns[t].nTh)}this.s.dt.aoColumns[t]._ColReorder_iOrigCol=t}this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(e,t){i._fnStateSave.call(i,t)},"ColReorder_State");var n=null;if(this.s.init.aiOrder){n=this.s.init.aiOrder.slice()}if(this.s.dt.oLoadedState&&typeof this.s.dt.oLoadedState.ColReorder!="undefined"&&this.s.dt.oLoadedState.ColReorder.length==this.s.dt.aoColumns.length){n=this.s.dt.oLoadedState.ColReorder}if(n){if(!i.s.dt._bInitComplete){var r=false;this.s.dt.aoDrawCallback.push({fn:function(){if(!i.s.dt._bInitComplete&&!r){r=true;var e=y(n);i._fnOrderColumns.call(i,e)}},sName:"ColReorder_Pre"})}else{var a=y(n);i._fnOrderColumns.call(i,a)}}else{this._fnSetColumnIndexes()}},_fnOrderColumns:function(e){if(e.length!=this.s.dt.aoColumns.length){this.s.dt.oInstance.oApi._fnLog(this.s.dt,1,"ColReorder - array reorder does not "+"match known number of columns. Skipping.");return}for(var t=0,i=e.length;t<i;t++){var n=c.inArray(t,e);if(t!=n){_(e,n,t);this.s.dt.oInstance.fnColReorder(n,t)}}if(this.s.dt.oScroll.sX!==""||this.s.dt.oScroll.sY!==""){this.s.dt.oInstance.fnAdjustColumnSizing()}this.s.dt.oInstance.oApi._fnSaveState(this.s.dt);this._fnSetColumnIndexes()},_fnStateSave:function(e){var t,i,n,r;var a=this.s.dt;var s=a.aoColumns;e.ColReorder=[];if(e.aaSorting){for(t=0;t<e.aaSorting.length;t++){e.aaSorting[t][0]=s[e.aaSorting[t][0]]._ColReorder_iOrigCol}var o=c.extend(true,[],e.aoSearchCols);for(t=0,i=s.length;t<i;t++){r=s[t]._ColReorder_iOrigCol;e.aoSearchCols[r]=o[t];e.abVisCols[r]=s[t].bVisible;e.ColReorder.push(r)}}else if(e.order){for(t=0;t<e.order.length;t++){e.order[t][0]=s[e.order[t][0]]._ColReorder_iOrigCol}var l=c.extend(true,[],e.columns);for(t=0,i=s.length;t<i;t++){r=s[t]._ColReorder_iOrigCol;e.columns[r]=l[t];e.ColReorder.push(r)}}},_fnMouseListener:function(e,t){var i=this;c(t).on("mousedown.ColReorder",function(e){e.preventDefault();i._fnMouseDown.call(i,e,t)})},_fnMouseDown:function(e,t){var i=this;var n=c(e.target).closest("th, td");var r=n.offset();var a=parseInt(c(t).attr("data-column-index"),10);if(a===o){return}this.s.mouse.startX=e.pageX;this.s.mouse.startY=e.pageY;this.s.mouse.offsetX=e.pageX-r.left;this.s.mouse.offsetY=e.pageY-r.top;this.s.mouse.target=this.s.dt.aoColumns[a].nTh;this.s.mouse.targetIndex=a;this.s.mouse.fromIndex=a;this._fnRegions();c(s).on("mousemove.ColReorder",function(e){i._fnMouseMove.call(i,e)}).on("mouseup.ColReorder",function(e){i._fnMouseUp.call(i,e)})},_fnMouseMove:function(e){var t=this;if(this.dom.drag===null){if(Math.pow(Math.pow(e.pageX-this.s.mouse.startX,2)+Math.pow(e.pageY-this.s.mouse.startY,2),.5)<5){return}this._fnCreateDragNode()}this.dom.drag.css({left:e.pageX-this.s.mouse.offsetX,top:e.pageY-this.s.mouse.offsetY});var i=false;var n=this.s.mouse.toIndex;for(var r=1,a=this.s.aoTargets.length;r<a;r++){if(e.pageX<this.s.aoTargets[r-1].x+(this.s.aoTargets[r].x-this.s.aoTargets[r-1].x)/2){this.dom.pointer.css("left",this.s.aoTargets[r-1].x);this.s.mouse.toIndex=this.s.aoTargets[r-1].to;i=true;break}}if(!i){this.dom.pointer.css("left",this.s.aoTargets[this.s.aoTargets.length-1].x);this.s.mouse.toIndex=this.s.aoTargets[this.s.aoTargets.length-1].to}if(this.s.init.bRealtime&&n!==this.s.mouse.toIndex){this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex);this.s.mouse.fromIndex=this.s.mouse.toIndex;this._fnRegions()}},_fnMouseUp:function(e){var t=this;c(s).off("mousemove.ColReorder mouseup.ColReorder");if(this.dom.drag!==null){this.dom.drag.remove();this.dom.pointer.remove();this.dom.drag=null;this.dom.pointer=null;this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex);this._fnSetColumnIndexes();if(this.s.dt.oScroll.sX!==""||this.s.dt.oScroll.sY!==""){this.s.dt.oInstance.fnAdjustColumnSizing()}if(this.s.dropCallback!==null){this.s.dropCallback.call(this)}this.s.dt.oInstance.oApi._fnSaveState(this.s.dt)}},_fnRegions:function(){var e=this.s.dt.aoColumns;this.s.aoTargets.splice(0,this.s.aoTargets.length);this.s.aoTargets.push({x:c(this.s.dt.nTable).offset().left,to:0});var t=0;for(var i=0,n=e.length;i<n;i++){if(i!=this.s.mouse.fromIndex){t++}if(e[i].bVisible){this.s.aoTargets.push({x:c(e[i].nTh).offset().left+c(e[i].nTh).outerWidth(),to:t})}}if(this.s.fixedRight!==0){this.s.aoTargets.splice(this.s.aoTargets.length-this.s.fixedRight)}if(this.s.fixed!==0){this.s.aoTargets.splice(0,this.s.fixed)}},_fnCreateDragNode:function(){var e=this.s.dt.oScroll.sX!==""||this.s.dt.oScroll.sY!=="";var t=this.s.dt.aoColumns[this.s.mouse.targetIndex].nTh;var i=t.parentNode;var n=i.parentNode;var r=n.parentNode;var a=c(t).clone();this.dom.drag=c(r.cloneNode(false)).addClass("DTCR_clonedTable").append(n.cloneNode(false).appendChild(i.cloneNode(false).appendChild(a[0]))).css({position:"absolute",top:0,left:0,width:c(t).outerWidth(),height:c(t).outerHeight()}).appendTo("body");this.dom.pointer=c("<div></div>").addClass("DTCR_pointer").css({position:"absolute",top:e?c("div.dataTables_scroll",this.s.dt.nTableWrapper).offset().top:c(this.s.dt.nTable).offset().top,height:e?c("div.dataTables_scroll",this.s.dt.nTableWrapper).height():c(this.s.dt.nTable).height()}).appendTo("body")},_fnDestroy:function(){var e,t;for(e=0,t=this.s.dt.aoDrawCallback.length;e<t;e++){if(this.s.dt.aoDrawCallback[e].sName==="ColReorder_Pre"){this.s.dt.aoDrawCallback.splice(e,1);break}}c(this.s.dt.nTHead).find("*").off(".ColReorder");c.each(this.s.dt.aoColumns,function(e,t){c(t.nTh).removeAttr("data-column-index")});this.s.dt._colReorder=null;this.s=null},_fnSetColumnIndexes:function(){c.each(this.s.dt.aoColumns,function(e,t){c(t.nTh).attr("data-column-index",e)})}};r.defaults={aiOrder:null,bRealtime:false,iFixedColumns:0,iFixedColumnsRight:0,fnReorderCallback:null};r.version="1.1.2";c.fn.dataTable.ColReorder=r;c.fn.DataTable.ColReorder=r;if(typeof c.fn.dataTable=="function"&&typeof c.fn.dataTableExt.fnVersionCheck=="function"&&c.fn.dataTableExt.fnVersionCheck("1.9.3")){c.fn.dataTableExt.aoFeatures.push({fnInit:function(e){var t=e.oInstance;if(!e._colReorder){var i=e.oInit;var n=i.colReorder||i.oColReorder||{};new r(e,n)}else{t.oApi._fnLog(e,1,"ColReorder attempted to initialise twice. Ignoring second")}return null},cFeature:"R",sFeature:"ColReorder"})}else{alert("Warning: ColReorder requires DataTables 1.9.3 or greater - www.datatables.net/download")}if(c.fn.dataTable.Api){c.fn.dataTable.Api.register("colReorder.reset()",function(){return this.iterator("table",function(e){e._colReorder.fnReset()})});c.fn.dataTable.Api.register("colReorder.order()",function(t){if(t){return this.iterator("table",function(e){e._colReorder.fnOrder(t)})}return this.context.length?this.context[0]._colReorder.fnOrder():null})}return r};if(typeof define==="function"&&define.amd){define(["jquery","datatables"],t)}else if(typeof exports==="object"){t(require("jquery"),require("datatables"))}else if(jQuery&&!jQuery.fn.dataTable.ColReorder){t(jQuery,jQuery.fn.dataTable)}})(window,document);var TableTools;(function(o,l,i){var e=function(e,b){"use strict";var s={version:"1.0.4-TableTools2",clients:{},moviePath:"",nextId:1,$:function(e){if(typeof e=="string"){e=l.getElementById(e)}if(!e.addClass){e.hide=function(){this.style.display="none"};e.show=function(){this.style.display=""};e.addClass=function(e){this.removeClass(e);this.className+=" "+e};e.removeClass=function(e){this.className=this.className.replace(new RegExp("\\s*"+e+"\\s*")," ").replace(/^\s+/,"").replace(/\s+$/,"")};e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}}return e},setMoviePath:function(e){this.moviePath=e},dispatch:function(e,t,i){var n=this.clients[e];if(n){n.receiveEvent(t,i)}},register:function(e,t){this.clients[e]=t},getDOMObjectPosition:function(e){var t={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};if(e.style.width!==""){t.width=e.style.width.replace("px","")}if(e.style.height!==""){t.height=e.style.height.replace("px","")}while(e){t.left+=e.offsetLeft;t.top+=e.offsetTop;e=e.offsetParent}return t},Client:function(e){this.handlers={};this.id=s.nextId++;this.movieId="ZeroClipboard_TableToolsMovie_"+this.id;s.register(this.id,this);if(e){this.glue(e)}}};s.Client.prototype={id:0,ready:false,movie:null,clipText:"",fileName:"",action:"copy",handCursorEnabled:true,cssEffects:true,handlers:null,sized:false,glue:function(e,t){this.domElement=s.$(e);var i=99;if(this.domElement.style.zIndex){i=parseInt(this.domElement.style.zIndex,10)+1}var n=s.getDOMObjectPosition(this.domElement);this.div=l.createElement("div");var r=this.div.style;r.position="absolute";r.left="0px";r.top="0px";r.width=n.width+"px";r.height=n.height+"px";r.zIndex=i;if(typeof t!="undefined"&&t!==""){this.div.title=t}if(n.width!==0&&n.height!==0){this.sized=true}if(this.domElement){this.domElement.appendChild(this.div);this.div.innerHTML=this.getHTML(n.width,n.height).replace(/&/g,"&amp;")}},positionElement:function(){var e=s.getDOMObjectPosition(this.domElement);var t=this.div.style;t.position="absolute";t.width=e.width+"px";t.height=e.height+"px";if(e.width!==0&&e.height!==0){this.sized=true}else{return}var i=this.div.childNodes[0];i.width=e.width;i.height=e.height},getHTML:function(e,t){var i="";var n="id="+this.id+"&width="+e+"&height="+t;if(navigator.userAgent.match(/MSIE/)){var r=location.href.match(/^https/i)?"https://":"http://";i+='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+r+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+s.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+n+'"/><param name="wmode" value="transparent"/></object>'}else{i+='<embed id="'+this.movieId+'" src="'+s.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+n+'" wmode="transparent" />'}return i},hide:function(){if(this.div){this.div.style.left="-2000px"}},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML="";var e=l.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(e){}this.domElement=null;this.div=null}},reposition:function(e){if(e){this.domElement=s.$(e);if(!this.domElement){this.hide()}}if(this.domElement&&this.div){var t=s.getDOMObjectPosition(this.domElement);var i=this.div.style;i.left=""+t.left+"px";i.top=""+t.top+"px"}},clearText:function(){this.clipText="";if(this.ready){this.movie.clearText()}},appendText:function(e){this.clipText+=e;if(this.ready){this.movie.appendText(e)}},setText:function(e){this.clipText=e;if(this.ready){this.movie.setText(e)}},setCharSet:function(e){this.charSet=e;if(this.ready){this.movie.setCharSet(e)}},setBomInc:function(e){this.incBom=e;if(this.ready){this.movie.setBomInc(e)}},setFileName:function(e){this.fileName=e;if(this.ready){this.movie.setFileName(e)}},setAction:function(e){this.action=e;if(this.ready){this.movie.setAction(e)}},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");if(!this.handlers[e]){this.handlers[e]=[]}this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e;if(this.ready){this.movie.setHandCursor(e)}},setCSSEffects:function(e){this.cssEffects=!!e},receiveEvent:function(e,t){var i;e=e.toString().toLowerCase().replace(/^on/,"");switch(e){case"load":this.movie=l.getElementById(this.movieId);if(!this.movie){i=this;setTimeout(function(){i.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){i=this;setTimeout(function(){i.receiveEvent("load",null)},100);this.ready=true;return}this.ready=true;this.movie.clearText();this.movie.appendText(this.clipText);this.movie.setFileName(this.fileName);this.movie.setAction(this.action);this.movie.setCharSet(this.charSet);this.movie.setBomInc(this.incBom);this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":if(this.domElement&&this.cssEffects){if(this.recoverActive){this.domElement.addClass("active")}}break;case"mouseout":if(this.domElement&&this.cssEffects){this.recoverActive=false;if(this.domElement.hasClass("active")){this.domElement.removeClass("active");this.recoverActive=true}}break;case"mousedown":if(this.domElement&&this.cssEffects){this.domElement.addClass("active")}break;case"mouseup":if(this.domElement&&this.cssEffects){this.domElement.removeClass("active");this.recoverActive=false}break}if(this.handlers[e]){for(var n=0,r=this.handlers[e].length;n<r;n++){var a=this.handlers[e][n];if(typeof a=="function"){a(this,t)}else if(typeof a=="object"&&a.length==2){a[0][a[1]](this,t)}else if(typeof a=="string"){o[a](this,t)}}}}};o.ZeroClipboard_TableTools=s;(function(_,p,g){TableTools=function(e,t){if(!this instanceof TableTools){alert("Warning: TableTools must be initialised with the keyword 'new'")}var i=_.fn.dataTable.Api?new _.fn.dataTable.Api(e).settings()[0]:e.fnSettings();this.s={that:this,dt:i,print:{saveStart:-1,saveLength:-1,saveScroll:-1,funcEnd:function(){}},buttonCounter:0,select:{type:"",selected:[],preRowSelect:null,postSelected:null,postDeselected:null,all:false,selectedClass:""},custom:{},swfPath:"",buttonSet:[],master:false,tags:{}};this.dom={container:null,table:null,print:{hidden:[],message:null},collection:{collection:null,background:null}};this.classes=_.extend(true,{},TableTools.classes);if(this.s.dt.bJUI){_.extend(true,this.classes,TableTools.classes_themeroller)}this.fnSettings=function(){return this.s};if(typeof t=="undefined"){t={}}TableTools._aInstances.push(this);this._fnConstruct(t);return this};TableTools.prototype={fnGetSelected:function(e){var t=[],i=this.s.dt.aoData,n=this.s.dt.aiDisplay,r,a;if(e){for(r=0,a=n.length;r<a;r++){if(i[n[r]]._DTTT_selected){t.push(i[n[r]].nTr)}}}else{for(r=0,a=i.length;r<a;r++){if(i[r]._DTTT_selected){t.push(i[r].nTr)}}}return t},fnGetSelectedData:function(){var e=[];var t=this.s.dt.aoData;var i,n;for(i=0,n=t.length;i<n;i++){if(t[i]._DTTT_selected){e.push(this.s.dt.oInstance.fnGetData(i))}}return e},fnGetSelectedIndexes:function(e){var t=[],i=this.s.dt.aoData,n=this.s.dt.aiDisplay,r,a;if(e){for(r=0,a=n.length;r<a;r++){if(i[n[r]]._DTTT_selected){t.push(n[r])}}}else{for(r=0,a=i.length;r<a;r++){if(i[r]._DTTT_selected){t.push(r)}}}return t},fnIsSelected:function(e){var t=this.s.dt.oInstance.fnGetPosition(e);return this.s.dt.aoData[t]._DTTT_selected===true?true:false},fnSelectAll:function(e){this._fnRowSelect(e?this.s.dt.aiDisplay:this.s.dt.aoData)},fnSelectNone:function(e){this._fnRowDeselect(this.fnGetSelectedIndexes(e))},fnSelect:function(e){if(this.s.select.type=="single"){this.fnSelectNone();this._fnRowSelect(e)}else{this._fnRowSelect(e)}},fnDeselect:function(e){this._fnRowDeselect(e)},fnGetTitle:function(e){var t="";if(typeof e.sTitle!="undefined"&&e.sTitle!==""){t=e.sTitle}else{var i=g.getElementsByTagName("title");if(i.length>0){t=i[0].innerHTML}}if("¡".toString().length<4){return t.replace(/[^a-zA-Z0-9_\u00A1-\uFFFF\.,\-_ !\(\)]/g,"")}else{return t.replace(/[^a-zA-Z0-9_\.,\-_ !\(\)]/g,"")}},fnCalcColRatios:function(e){var t=this.s.dt.aoColumns,i=this._fnColumnTargets(e.mColumns),n=[],r=0,a=0,s,o;for(s=0,o=i.length;s<o;s++){if(i[s]){r=t[s].nTh.offsetWidth;a+=r;n.push(r)}}for(s=0,o=n.length;s<o;s++){n[s]=n[s]/a}return n.join("\t")},fnGetTableData:function(e){if(this.s.dt){return this._fnGetDataTablesData(e)}},fnSetText:function(e,t){this._fnFlashSetText(e,t)},fnResizeButtons:function(){for(var e in s.clients){if(e){var t=s.clients[e];if(typeof t.domElement!="undefined"&&t.domElement.parentNode){t.positionElement()}}}},fnResizeRequired:function(){for(var e in s.clients){if(e){var t=s.clients[e];if(typeof t.domElement!="undefined"&&t.domElement.parentNode==this.dom.container&&t.sized===false){return true}}}return false},fnPrint:function(e,t){if(t===i){t={}}if(e===i||e){this._fnPrintStart(t)}else{this._fnPrintEnd()}},fnInfo:function(e,t){var i=_("<div/>").addClass(this.classes.print.info).html(e).appendTo("body");setTimeout(function(){i.fadeOut("normal",function(){i.remove()})},t)},fnContainer:function(){return this.dom.container},_fnConstruct:function(e){var t=this;this._fnCustomiseSettings(e);this.dom.container=g.createElement(this.s.tags.container);this.dom.container.className=this.classes.container;if(this.s.select.type!="none"){this._fnRowSelectConfig()}this._fnButtonDefinations(this.s.buttonSet,this.dom.container);this.s.dt.aoDestroyCallback.push({sName:"TableTools",fn:function(){_(t.s.dt.nTBody).off("click.DTTT_Select","tr");_(t.dom.container).empty();var e=_.inArray(t,TableTools._aInstances);if(e!==-1){TableTools._aInstances.splice(e,1)}}})},_fnCustomiseSettings:function(e){if(typeof this.s.dt._TableToolsInit=="undefined"){this.s.master=true;this.s.dt._TableToolsInit=true}this.dom.table=this.s.dt.nTable;this.s.custom=_.extend({},TableTools.DEFAULTS,e);this.s.swfPath=this.s.custom.sSwfPath;if(typeof s!="undefined"){s.moviePath=this.s.swfPath}this.s.select.type=this.s.custom.sRowSelect;this.s.select.preRowSelect=this.s.custom.fnPreRowSelect;this.s.select.postSelected=this.s.custom.fnRowSelected;this.s.select.postDeselected=this.s.custom.fnRowDeselected;if(this.s.custom.sSelectedClass){this.classes.select.row=this.s.custom.sSelectedClass}this.s.tags=this.s.custom.oTags;this.s.buttonSet=this.s.custom.aButtons},_fnButtonDefinations:function(e,t){var i;for(var n=0,r=e.length;n<r;n++){if(typeof e[n]=="string"){if(typeof TableTools.BUTTONS[e[n]]=="undefined"){alert("TableTools: Warning - unknown button type: "+e[n]);continue}i=_.extend({},TableTools.BUTTONS[e[n]],true)}else{if(typeof TableTools.BUTTONS[e[n].sExtends]=="undefined"){alert("TableTools: Warning - unknown button type: "+e[n].sExtends);continue}var a=_.extend({},TableTools.BUTTONS[e[n].sExtends],true);i=_.extend(a,e[n],true)}var s=this._fnCreateButton(i,_(t).hasClass(this.classes.collection.container));if(s){t.appendChild(s)}}},_fnCreateButton:function(t,e){var i=this._fnButtonBase(t,e);if(t.sAction.match(/flash/)){if(!this._fnHasFlash()){return false}this._fnFlashConfig(i,t)}else if(t.sAction=="text"){this._fnTextConfig(i,t)}else if(t.sAction=="div"){this._fnTextConfig(i,t)}else if(t.sAction=="collection"){this._fnTextConfig(i,t);this._fnCollectionConfig(i,t)}if(this.s.dt.iTabIndex!==-1){_(i).attr("tabindex",this.s.dt.iTabIndex).attr("aria-controls",this.s.dt.sTableId).on("keyup.DTTT",function(e){if(e.keyCode===13){e.stopPropagation();_(this).trigger("click")}}).on("mousedown.DTTT",function(e){if(!t.sAction.match(/flash/)){e.preventDefault()}})}return i},_fnButtonBase:function(e,t){var i,n,r;if(t){i=e.sTag&&e.sTag!=="default"?e.sTag:this.s.tags.collection.button;n=e.sLinerTag&&e.sLinerTag!=="default"?e.sLiner:this.s.tags.collection.liner;r=this.classes.collection.buttons.normal}else{i=e.sTag&&e.sTag!=="default"?e.sTag:this.s.tags.button;n=e.sLinerTag&&e.sLinerTag!=="default"?e.sLiner:this.s.tags.liner;r=this.classes.buttons.normal}var a=g.createElement(i),s=g.createElement(n),o=this._fnGetMasterSettings();a.className=r+" "+e.sButtonClass;a.setAttribute("id","ToolTables_"+this.s.dt.sInstance+"_"+o.buttonCounter);a.appendChild(s);s.innerHTML=e.sButtonText;o.buttonCounter++;return a},_fnGetMasterSettings:function(){if(this.s.master){return this.s}else{var e=TableTools._aInstances;for(var t=0,i=e.length;t<i;t++){if(this.dom.table==e[t].s.dt.nTable){return e[t].s}}}},_fnCollectionConfig:function(e,t){var i=g.createElement(this.s.tags.collection.container);i.style.display="none";i.className=this.classes.collection.container;t._collection=i;g.body.appendChild(i);this._fnButtonDefinations(t.aButtons,i)},_fnCollectionShow:function(e,t){var i=this,n=_(e).offset(),r=t._collection,a=n.left,s=n.top+_(e).outerHeight(),o=_(p).height(),l=_(g).height(),c=_(p).width(),u=_(g).width();r.style.position="absolute";r.style.left=a+"px";r.style.top=s+"px";r.style.display="block";_(r).css("opacity",0);var d=g.createElement("div");d.style.position="absolute";d.style.left="0px";d.style.top="0px";d.style.height=(o>l?o:l)+"px";d.style.width=(c>u?c:u)+"px";d.className=this.classes.collection.background;_(d).css("opacity",0);g.body.appendChild(d);g.body.appendChild(r);var h=_(r).outerWidth();var f=_(r).outerHeight();if(a+h>u){r.style.left=u-h+"px"}if(s+f>l){r.style.top=s-f-_(e).outerHeight()+"px"}this.dom.collection.collection=r;this.dom.collection.background=d;setTimeout(function(){_(r).animate({opacity:1},500);_(d).animate({opacity:.25},500)},10);this.fnResizeButtons();_(d).click(function(){i._fnCollectionHide.call(i,null,null)})},_fnCollectionHide:function(e,t){if(t!==null&&t.sExtends=="collection"){return}if(this.dom.collection.collection!==null){_(this.dom.collection.collection).animate({opacity:0},500,function(e){this.style.display="none"});_(this.dom.collection.background).animate({opacity:0},500,function(e){this.parentNode.removeChild(this)});this.dom.collection.collection=null;this.dom.collection.background=null}},_fnRowSelectConfig:function(){if(this.s.master){var l=this,e,t,c=this.s.dt,i=this.s.dt.aoOpenRows;_(c.nTable).addClass(this.classes.select.table);if(this.s.select.type==="os"){_(c.nTBody).on("mousedown.DTTT_Select","tr",function(e){if(e.shiftKey){_(c.nTBody).css("-moz-user-select","none").one("selectstart.DTTT_Select","tr",function(){return false})}});_(c.nTBody).on("mouseup.DTTT_Select","tr",function(e){_(c.nTBody).css("-moz-user-select","")})}_(c.nTBody).on("click.DTTT_Select",this.s.custom.sRowSelector,function(e){var t=this.nodeName.toLowerCase()==="tr"?this:_(this).parents("tr")[0];var i=l.s.select;var n=l.s.dt.oInstance.fnGetPosition(t);if(t.parentNode!=c.nTBody){return}if(c.oInstance.fnGetData(t)===null){return}if(i.type=="os"){if(e.ctrlKey||e.metaKey){if(l.fnIsSelected(t)){l._fnRowDeselect(t,e)}else{l._fnRowSelect(t,e)}}else if(e.shiftKey){var r=l.s.dt.aiDisplay.slice();var a=_.inArray(i.lastRow,r);var s=_.inArray(n,r);if(l.fnGetSelected().length===0||a===-1){r.splice(_.inArray(n,r)+1,r.length)}else{if(a>s){var o=s;s=a;a=o}r.splice(s+1,r.length);r.splice(0,a)}if(!l.fnIsSelected(t)){l._fnRowSelect(r,e)}else{r.splice(_.inArray(n,r),1);l._fnRowDeselect(r,e)}}else{if(l.fnIsSelected(t)&&l.fnGetSelected().length===1){l._fnRowDeselect(t,e)}else{l.fnSelectNone();l._fnRowSelect(t,e)}}}else if(l.fnIsSelected(t)){l._fnRowDeselect(t,e)}else if(i.type=="single"){l.fnSelectNone();l._fnRowSelect(t,e)}else if(i.type=="multi"){l._fnRowSelect(t,e)}i.lastRow=n});c.oApi._fnCallbackReg(c,"aoRowCreatedCallback",function(e,t,i){if(c.aoData[i]._DTTT_selected){_(e).addClass(l.classes.select.row)}},"TableTools-SelectAll")}},_fnRowSelect:function(e,t){var i=this,n=this._fnSelectData(e),r=n.length===0?null:n[0].nTr,a=[],s,o;for(s=0,o=n.length;s<o;s++){if(n[s].nTr){a.push(n[s].nTr)}}if(this.s.select.preRowSelect!==null&&!this.s.select.preRowSelect.call(this,t,a,true)){return}for(s=0,o=n.length;s<o;s++){n[s]._DTTT_selected=true;if(n[s].nTr){_(n[s].nTr).addClass(i.classes.select.row)}}if(this.s.select.postSelected!==null){this.s.select.postSelected.call(this,a)}TableTools._fnEventDispatch(this,"select",a,true)},_fnRowDeselect:function(e,t){var i=this,n=this._fnSelectData(e),r=n.length===0?null:n[0].nTr,a=[],s,o;for(s=0,o=n.length;s<o;s++){if(n[s].nTr){a.push(n[s].nTr)}}if(this.s.select.preRowSelect!==null&&!this.s.select.preRowSelect.call(this,t,a,false)){return}for(s=0,o=n.length;s<o;s++){n[s]._DTTT_selected=false;if(n[s].nTr){_(n[s].nTr).removeClass(i.classes.select.row)}}if(this.s.select.postDeselected!==null){this.s.select.postDeselected.call(this,a)}TableTools._fnEventDispatch(this,"select",a,false)},_fnSelectData:function(e){var t=[],i,n,r;if(e.nodeName){i=this.s.dt.oInstance.fnGetPosition(e);t.push(this.s.dt.aoData[i])}else if(typeof e.length!=="undefined"){for(n=0,r=e.length;n<r;n++){if(e[n].nodeName){i=this.s.dt.oInstance.fnGetPosition(e[n]);t.push(this.s.dt.aoData[i])}else if(typeof e[n]==="number"){t.push(this.s.dt.aoData[e[n]])}else{t.push(e[n])}}return t}else{t.push(e)}return t},_fnTextConfig:function(t,i){var n=this;if(i.fnInit!==null){i.fnInit.call(this,t,i)}if(i.sToolTip!==""){t.title=i.sToolTip}_(t).hover(function(){if(i.fnMouseover!==null){i.fnMouseover.call(this,t,i,null)}},function(){if(i.fnMouseout!==null){i.fnMouseout.call(this,t,i,null)}});if(i.fnSelect!==null){TableTools._fnEventListen(this,"select",function(e){i.fnSelect.call(n,t,i,e)})}_(t).click(function(e){if(i.fnClick!==null){i.fnClick.call(n,t,i,null,e)}if(i.fnComplete!==null){i.fnComplete.call(n,t,i,null,null)}n._fnCollectionHide(t,i)})},_fnHasFlash:function(){try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(e){return true}}catch(e){if(navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!==i&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin){return true}}return false},_fnFlashConfig:function(i,n){var r=this;var a=new s.Client;if(n.fnInit!==null){n.fnInit.call(this,i,n)}a.setHandCursor(true);if(n.sAction=="flash_save"){a.setAction("save");a.setCharSet(n.sCharSet=="utf16le"?"UTF16LE":"UTF8");a.setBomInc(n.bBomInc);a.setFileName(n.sFileName.replace("*",this.fnGetTitle(n)))}else if(n.sAction=="flash_pdf"){a.setAction("pdf");a.setFileName(n.sFileName.replace("*",this.fnGetTitle(n)))}else{a.setAction("copy")}a.addEventListener("mouseOver",function(e){if(n.fnMouseover!==null){n.fnMouseover.call(r,i,n,a)}});a.addEventListener("mouseOut",function(e){if(n.fnMouseout!==null){n.fnMouseout.call(r,i,n,a)}});a.addEventListener("mouseDown",function(e){if(n.fnClick!==null){n.fnClick.call(r,i,n,a)}});a.addEventListener("complete",function(e,t){if(n.fnComplete!==null){n.fnComplete.call(r,i,n,a,t)}r._fnCollectionHide(i,n)});this._fnFlashGlue(a,i,n.sToolTip)},_fnFlashGlue:function(e,t,i){var n=this;var r=t.getAttribute("id");if(g.getElementById(r)){e.glue(t,i)}else{setTimeout(function(){n._fnFlashGlue(e,t,i)},100)}},_fnFlashSetText:function(e,t){var i=this._fnChunkData(t,8192);e.clearText();for(var n=0,r=i.length;n<r;n++){e.appendText(i[n])}},_fnColumnTargets:function(e){var t=[];var i=this.s.dt;var n,r;var a=i.aoColumns;var s=a.length;if(typeof e=="function"){var o=e.call(this,i);for(n=0,r=s;n<r;n++){t.push(_.inArray(n,o)!==-1?true:false)}}else if(typeof e=="object"){for(n=0,r=s;n<r;n++){t.push(false)}for(n=0,r=e.length;n<r;n++){t[e[n]]=true}}else if(e=="visible"){for(n=0,r=s;n<r;n++){t.push(a[n].bVisible?true:false)}}else if(e=="hidden"){for(n=0,r=s;n<r;n++){t.push(a[n].bVisible?false:true)}}else if(e=="sortable"){for(n=0,r=s;n<r;n++){t.push(a[n].bSortable?true:false)}}else{for(n=0,r=s;n<r;n++){t.push(true)}}return t},_fnNewline:function(e){if(e.sNewLine=="auto"){return navigator.userAgent.match(/Windows/)?"\r\n":"\n"}else{return e.sNewLine}},_fnGetDataTablesData:function(e){var t,i,n,r;var a,s=[],o="",l;var c=this.s.dt,u,d;var h=new RegExp(e.sFieldBoundary,"g");var f=this._fnColumnTargets(e.mColumns);var p=typeof e.bSelectedOnly!="undefined"?e.bSelectedOnly:false;if(e.bHeader){a=[];for(t=0,i=c.aoColumns.length;t<i;t++){if(f[t]){o=c.aoColumns[t].sTitle.replace(/\n/g," ").replace(/<.*?>/g,"").replace(/^\s+|\s+$/g,"");o=this._fnHtmlDecode(o);a.push(this._fnBoundData(o,e.sFieldBoundary,h))}}s.push(a.join(e.sFieldSeperator))}p=true;var g;var m=this.fnGetSelectedIndexes();p=this.s.select.type!=="none"&&p&&m.length!==0;if(p){g=m}else if(b.Api){g=new b.Api(c).rows(e.oSelectorOpts).indexes().flatten().toArray()}else{g=c.oInstance.$("tr",e.oSelectorOpts).map(function(e,t){return c.oInstance.fnGetPosition(t)}).get()}for(n=0,r=g.length;n<r;n++){u=c.aoData[g[n]].nTr;a=[];for(t=0,i=c.aoColumns.length;t<i;t++){if(f[t]){var v=c.oApi._fnGetCellData(c,g[n],t,"display");if(e.fnCellRender){o=e.fnCellRender(v,t,u,g[n])+""}else if(typeof v=="string"){o=v.replace(/\n/g," ");o=o.replace(/<img.*?\s+alt\s*=\s*(?:"([^"]+)"|'([^']+)'|([^\s>]+)).*?>/gi,"$1$2$3");o=o.replace(/<.*?>/g,"")}else{o=v+""}o=o.replace(/^\s+/,"").replace(/\s+$/,"");o=this._fnHtmlDecode(o);a.push(this._fnBoundData(o,e.sFieldBoundary,h))}}s.push(a.join(e.sFieldSeperator));if(e.bOpenRows){l=_.grep(c.aoOpenRows,function(e){return e.nParent===u});if(l.length===1){o=this._fnBoundData(_("td",l[0].nTr).html(),e.sFieldBoundary,h);s.push(o)}}}if(e.bFooter&&c.nTFoot!==null){a=[];for(t=0,i=c.aoColumns.length;t<i;t++){if(f[t]&&c.aoColumns[t].nTf!==null){o=c.aoColumns[t].nTf.innerHTML.replace(/\n/g," ").replace(/<.*?>/g,"");o=this._fnHtmlDecode(o);a.push(this._fnBoundData(o,e.sFieldBoundary,h))}}s.push(a.join(e.sFieldSeperator))}var y=s.join(this._fnNewline(e));return y},_fnBoundData:function(e,t,i){if(t===""){return e}else{return t+e.replace(i,t+t)+t}},_fnChunkData:function(e,t){var i=[];var n=e.length;for(var r=0;r<n;r+=t){if(r+t<n){i.push(e.substring(r,r+t))}else{i.push(e.substring(r,n))}}return i},_fnHtmlDecode:function(e){if(e.indexOf("&")===-1){return e}var i=g.createElement("div");return e.replace(/&([^\s]*?);/g,function(e,t){if(e.substr(1,1)==="#"){return String.fromCharCode(Number(t.substr(1)))}else{i.innerHTML=e;return i.childNodes[0].nodeValue}})},_fnPrintStart:function(e){var t=this;var i=this.s.dt;this._fnPrintHideNodes(i.nTable);this.s.print.saveStart=i._iDisplayStart;this.s.print.saveLength=i._iDisplayLength;if(e.bShowAll){i._iDisplayStart=0;i._iDisplayLength=-1;if(i.oApi._fnCalculateEnd){i.oApi._fnCalculateEnd(i)}i.oApi._fnDraw(i)}if(i.oScroll.sX!==""||i.oScroll.sY!==""){this._fnPrintScrollStart(i);_(this.s.dt.nTable).bind("draw.DTTT_Print",function(){t._fnPrintScrollStart(i)})}var n=i.aanFeatures;for(var r in n){if(r!="i"&&r!="t"&&r.length==1){for(var a=0,s=n[r].length;a<s;a++){this.dom.print.hidden.push({node:n[r][a],display:"block"});n[r][a].style.display="none"}}}_(g.body).addClass(this.classes.print.body);if(e.sInfo!==""){this.fnInfo(e.sInfo,3e3)}if(e.sMessage){_("<div/>").addClass(this.classes.print.message).html(e.sMessage).prependTo("body")}this.s.print.saveScroll=_(p).scrollTop();p.scrollTo(0,0);_(g).bind("keydown.DTTT",function(e){if(e.keyCode==27){e.preventDefault();t._fnPrintEnd.call(t,e)}})},_fnPrintEnd:function(e){var t=this;var i=this.s.dt;var n=this.s.print;var r=this.dom.print;this._fnPrintShowNodes();if(i.oScroll.sX!==""||i.oScroll.sY!==""){_(this.s.dt.nTable).unbind("draw.DTTT_Print");this._fnPrintScrollEnd()}p.scrollTo(0,n.saveScroll);_("div."+this.classes.print.message).remove();_(g.body).removeClass("DTTT_Print");i._iDisplayStart=n.saveStart;i._iDisplayLength=n.saveLength;if(i.oApi._fnCalculateEnd){i.oApi._fnCalculateEnd(i)}i.oApi._fnDraw(i);_(g).unbind("keydown.DTTT")},_fnPrintScrollStart:function(){var e=this.s.dt,t=e.nScrollHead.getElementsByTagName("div")[0],i=t.getElementsByTagName("table")[0],n=e.nTable.parentNode,r,a;r=e.nTable.getElementsByTagName("thead");if(r.length>0){e.nTable.removeChild(r[0])}if(e.nTFoot!==null){a=e.nTable.getElementsByTagName("tfoot");if(a.length>0){e.nTable.removeChild(a[0])}}r=e.nTHead.cloneNode(true);e.nTable.insertBefore(r,e.nTable.childNodes[0]);if(e.nTFoot!==null){a=e.nTFoot.cloneNode(true);e.nTable.insertBefore(a,e.nTable.childNodes[1])}if(e.oScroll.sX!==""){e.nTable.style.width=_(e.nTable).outerWidth()+"px";n.style.width=_(e.nTable).outerWidth()+"px";n.style.overflow="visible"}if(e.oScroll.sY!==""){n.style.height=_(e.nTable).outerHeight()+"px";n.style.overflow="visible"}},_fnPrintScrollEnd:function(){var e=this.s.dt,t=e.nTable.parentNode;if(e.oScroll.sX!==""){t.style.width=e.oApi._fnStringToCss(e.oScroll.sX);t.style.overflow="auto"}if(e.oScroll.sY!==""){t.style.height=e.oApi._fnStringToCss(e.oScroll.sY);t.style.overflow="auto"}},_fnPrintShowNodes:function(){var e=this.dom.print.hidden;for(var t=0,i=e.length;t<i;t++){e[t].node.style.display=e[t].display}e.splice(0,e.length)},_fnPrintHideNodes:function(e){var t=this.dom.print.hidden;var i=e.parentNode;var n=i.childNodes;for(var r=0,a=n.length;r<a;r++){if(n[r]!=e&&n[r].nodeType==1){var s=_(n[r]).css("display");if(s!="none"){t.push({node:n[r],display:s});n[r].style.display="none"}}}if(i.nodeName.toUpperCase()!="BODY"){this._fnPrintHideNodes(i)}}};TableTools._aInstances=[];TableTools._aListeners=[];TableTools.fnGetMasters=function(){var e=[];for(var t=0,i=TableTools._aInstances.length;t<i;t++){if(TableTools._aInstances[t].s.master){e.push(TableTools._aInstances[t])}}return e};TableTools.fnGetInstance=function(e){if(typeof e!="object"){e=g.getElementById(e)}for(var t=0,i=TableTools._aInstances.length;t<i;t++){if(TableTools._aInstances[t].s.master&&TableTools._aInstances[t].dom.table==e){return TableTools._aInstances[t]}}return null};TableTools._fnEventListen=function(e,t,i){TableTools._aListeners.push({that:e,type:t,fn:i})};TableTools._fnEventDispatch=function(e,t,i,n){var r=TableTools._aListeners;for(var a=0,s=r.length;a<s;a++){if(e.dom.table==r[a].that.dom.table&&r[a].type==t){r[a].fn(i,n)}}};TableTools.buttonBase={sAction:"text",sTag:"default",sLinerTag:"default",sButtonClass:"DTTT_button_text",sButtonText:"Button text",sTitle:"",sToolTip:"",sCharSet:"utf8",bBomInc:false,sFileName:"*.csv",sFieldBoundary:"",sFieldSeperator:"\t",sNewLine:"auto",mColumns:"all",bHeader:true,bFooter:true,bOpenRows:false,bSelectedOnly:false,oSelectorOpts:i,fnMouseover:null,fnMouseout:null,fnClick:null,fnSelect:null,fnComplete:null,fnInit:null,fnCellRender:null};TableTools.BUTTONS={csv:_.extend({},TableTools.buttonBase,{sAction:"flash_save",sButtonClass:"DTTT_button_csv",sButtonText:"CSV",sFieldBoundary:'"',sFieldSeperator:",",fnClick:function(e,t,i){this.fnSetText(i,this.fnGetTableData(t))}}),xls:_.extend({},TableTools.buttonBase,{sAction:"flash_save",sCharSet:"utf16le",bBomInc:true,sButtonClass:"DTTT_button_xls",sButtonText:"Excel",fnClick:function(e,t,i){this.fnSetText(i,this.fnGetTableData(t))}}),copy:_.extend({},TableTools.buttonBase,{sAction:"flash_copy",sButtonClass:"DTTT_button_copy",sButtonText:"Copy",fnClick:function(e,t,i){this.fnSetText(i,this.fnGetTableData(t))},fnComplete:function(e,t,i,n){var r=n.split("\n").length;if(t.bHeader)r--;if(this.s.dt.nTFoot!==null&&t.bFooter)r--;var a=r==1?"":"s";this.fnInfo("<h6>Table copied</h6>"+"<p>Copied "+r+" row"+a+" to the clipboard.</p>",1500)}}),pdf:_.extend({},TableTools.buttonBase,{sAction:"flash_pdf",sNewLine:"\n",sFileName:"*.pdf",sButtonClass:"DTTT_button_pdf",sButtonText:"PDF",sPdfOrientation:"portrait",sPdfSize:"A4",sPdfMessage:"",fnClick:function(e,t,i){this.fnSetText(i,"title:"+this.fnGetTitle(t)+"\n"+"message:"+t.sPdfMessage+"\n"+"colWidth:"+this.fnCalcColRatios(t)+"\n"+"orientation:"+t.sPdfOrientation+"\n"+"size:"+t.sPdfSize+"\n"+"--/TableToolsOpts--\n"+this.fnGetTableData(t))}}),print:_.extend({},TableTools.buttonBase,{sInfo:"<h6>Print view</h6><p>Please use your browser's print function to "+"print this table. Press escape when finished.</p>",sMessage:null,bShowAll:true,sToolTip:"View print view",sButtonClass:"DTTT_button_print",sButtonText:"Print",fnClick:function(e,t){this.fnPrint(true,t)}}),text:_.extend({},TableTools.buttonBase),select:_.extend({},TableTools.buttonBase,{sButtonText:"Select button",fnSelect:function(e,t){if(this.fnGetSelected().length!==0){_(e).removeClass(this.classes.buttons.disabled)}else{_(e).addClass(this.classes.buttons.disabled)}},fnInit:function(e,t){_(e).addClass(this.classes.buttons.disabled)}}),select_single:_.extend({},TableTools.buttonBase,{sButtonText:"Select button",fnSelect:function(e,t){var i=this.fnGetSelected().length;if(i==1){_(e).removeClass(this.classes.buttons.disabled)}else{_(e).addClass(this.classes.buttons.disabled)}},fnInit:function(e,t){_(e).addClass(this.classes.buttons.disabled)}}),select_all:_.extend({},TableTools.buttonBase,{sButtonText:"Select all",fnClick:function(e,t){this.fnSelectAll()},fnSelect:function(e,t){if(this.fnGetSelected().length==this.s.dt.fnRecordsDisplay()){_(e).addClass(this.classes.buttons.disabled)}else{_(e).removeClass(this.classes.buttons.disabled)}}}),select_none:_.extend({},TableTools.buttonBase,{sButtonText:"Deselect all",fnClick:function(e,t){this.fnSelectNone()},fnSelect:function(e,t){if(this.fnGetSelected().length!==0){_(e).removeClass(this.classes.buttons.disabled)}else{_(e).addClass(this.classes.buttons.disabled)}},fnInit:function(e,t){_(e).addClass(this.classes.buttons.disabled)}}),ajax:_.extend({},TableTools.buttonBase,{sAjaxUrl:"/xhr.php",sButtonText:"Ajax button",fnClick:function(e,t){var i=this.fnGetTableData(t);_.ajax({url:t.sAjaxUrl,data:[{name:"tableData",value:i}],success:t.fnAjaxComplete,dataType:"json",type:"POST",cache:false,error:function(){alert("Error detected when sending table data to server")}})},fnAjaxComplete:function(e){alert("Ajax complete")}}),div:_.extend({},TableTools.buttonBase,{sAction:"div",sTag:"div",sButtonClass:"DTTT_nonbutton",sButtonText:"Text button"}),collection:_.extend({},TableTools.buttonBase,{sAction:"collection",sButtonClass:"DTTT_button_collection",sButtonText:"Collection",fnClick:function(e,t){this._fnCollectionShow(e,t)}})};TableTools.buttons=TableTools.BUTTONS;TableTools.classes={container:"DTTT_container",buttons:{normal:"DTTT_button",disabled:"DTTT_disabled"},collection:{container:"DTTT_collection",background:"DTTT_collection_background",buttons:{normal:"DTTT_button",disabled:"DTTT_disabled"}},select:{table:"DTTT_selectable",row:"DTTT_selected selected"},print:{body:"DTTT_Print",info:"DTTT_print_info",message:"DTTT_PrintMessage"}};TableTools.classes_themeroller={container:"DTTT_container ui-buttonset ui-buttonset-multi",buttons:{normal:"DTTT_button ui-button ui-state-default"},collection:{container:"DTTT_collection ui-buttonset ui-buttonset-multi"}};TableTools.DEFAULTS={sSwfPath:"../swf/copy_csv_xls_pdf.swf",sRowSelect:"none",sRowSelector:"tr",sSelectedClass:null,fnPreRowSelect:null,fnRowSelected:null,fnRowDeselected:null,aButtons:["copy","csv","xls","pdf","print"],oTags:{container:"div",button:"a",liner:"span",collection:{container:"div",button:"a",liner:"span"}}};TableTools.defaults=TableTools.DEFAULTS;TableTools.prototype.CLASS="TableTools";TableTools.version="2.2.3";if(_.fn.dataTable.Api){_.fn.dataTable.Api.register("tabletools()",function(){var e=null;if(this.context.length>0){e=TableTools.fnGetInstance(this.context[0].nTable)}return e})}if(typeof _.fn.dataTable=="function"&&typeof _.fn.dataTableExt.fnVersionCheck=="function"&&_.fn.dataTableExt.fnVersionCheck("1.9.0")){_.fn.dataTableExt.aoFeatures.push({fnInit:function(e){var t=e.oInit;var i=t?t.tableTools||t.oTableTools||{}:{};return new TableTools(e.oInstance,i).dom.container},cFeature:"T",sFeature:"TableTools"})}else{alert("Warning: TableTools requires DataTables 1.9.0 or newer - www.datatables.net/download")}_.fn.DataTable.TableTools=TableTools})(jQuery,o,l);if(typeof e.fn.dataTable=="function"&&typeof e.fn.dataTableExt.fnVersionCheck=="function"&&e.fn.dataTableExt.fnVersionCheck("1.9.0")){e.fn.dataTableExt.aoFeatures.push({fnInit:function(e){var t=typeof e.oInit.oTableTools!="undefined"?e.oInit.oTableTools:{};var i=new TableTools(e.oInstance,t);TableTools._aInstances.push(i);return i.dom.container},cFeature:"T",sFeature:"TableTools"})}else{alert("Warning: TableTools 2 requires DataTables 1.9.0 or newer - www.datatables.net/download")}e.fn.dataTable.TableTools=TableTools;e.fn.DataTable.TableTools=TableTools;return TableTools};if(typeof define==="function"&&define.amd){define(["jquery","datatables"],e)}else if(typeof exports==="object"){e(require("jquery"),require("datatables"))}else if(jQuery&&!jQuery.fn.dataTable.TableTools){e(jQuery,jQuery.fn.dataTable)}})(window,document);(function(D){D.fn.columnFilter=function(e){var h,x,C,T;var u="From {from} to {to}";var s=new Array;var d=new Array;var t=null;var M=function(){};function S(e,t,i,n,r){if(typeof t=="undefined")return new Array;if(typeof i=="undefined")i=true;if(typeof n=="undefined")n=true;if(typeof r=="undefined")r=true;var a;if(n==true)a=e.aiDisplay;else a=e.aiDisplayMaster;var s=new Array;for(var o=0,l=a.length;o<l;o++){var c=a[o];var u=_.fnGetData(c);var d=u[t];if(r==true&&d.length==0)continue;else if(i==true&&jQuery.inArray(d,s)>-1)continue;else s.push(d)}return s.sort()}function f(e){if(L.bUseColVis)return e;else return _.fnSettings().oApi._fnVisibleToColumnIndex(_.fnSettings(),e)}function o(n,r,a,e,s,t){var i="text_filter form-control";if(e)i="number_filter form-control";C=C.replace(/(^\s*)|(\s*$)/g,"");var o=n.fnSettings().aoPreSearchCols[x].sSearch;var l="search_init ";var c=C;if(o!=""&&o!="^"){if(e&&o.charAt(0)=="^")c=o.substr(1);else c=o;l=""}var u=D('<input type="text" class="'+l+i+'" value="'+c+'" rel="'+x+'"/>');if(t!=undefined&&t!=-1){u.attr("maxlength",t)}T.html(u);if(e)T.wrapInner('<span class="filter_column filter_number" />');else T.wrapInner('<span class="filter_column filter_text" />');h[x]=C;var d=x;if(e&&!n.fnSettings().oFeatures.bServerSide){u.keyup(function(){n.fnFilter("^"+this.value,f(d),true,false);M()})}else{u.keyup(function(){if(n.fnSettings().oFeatures.bServerSide&&s!=0){var e=n.fnSettings().aoPreSearchCols[d].sSearch;var t=D(this).data("dt-iLastFilterLength");if(typeof t=="undefined")t=0;var i=this.value.length;if(Math.abs(i-t)<s){return}else{D(this).data("dt-iLastFilterLength",i)}}n.fnFilter(this.value,f(d),r,a);M()})}u.focus(function(){if(D(this).hasClass("search_init")){D(this).removeClass("search_init");this.value=""}});u.blur(function(){if(this.value==""){D(this).addClass("search_init");this.value=h[d]}})}function l(s){T.html(i(0));var o=s.attr("id")+"_range_from_"+x;var e=D('<input type="text" class="number_range_filter form-control" id="'+o+'" rel="'+x+'"/>');T.append(e);T.append(i(1));var l=s.attr("id")+"_range_to_"+x;var t=D('<input type="text" class="number_range_filter form-control" id="'+l+'" rel="'+x+'"/>');T.append(t);T.append(i(2));T.wrapInner('<span class="filter_column filter_number_range form-control" />');var c=x;d.push(x);s.dataTableExt.afnFiltering.push(function(e,t,i){if(s.attr("id")!=e.sTableId)return true;if(document.getElementById(o)==null)return true;var n=document.getElementById(o).value*1;var r=document.getElementById(l).value*1;var a=t[f(c)]=="-"?0:t[f(c)]*1;if(n==""&&r==""){return true}else if(n==""&&a<=r){return true}else if(n<=a&&""==r){return true}else if(n<=a&&a<=r){return true}return false});D("#"+o+",#"+l,T).keyup(function(){var e=document.getElementById(o).value*1;var t=document.getElementById(l).value*1;if(e!=0&&t!=0&&e>t)return;s.fnDraw();M()})}function c(s){var e=u.split(/[}{]/);T.html("");var t=s.attr("id")+"_range_from_"+x;var o=D('<input type="text" class="date_range_filter form-control" id="'+t+'" rel="'+x+'"/>');o.datepicker();var i=s.attr("id")+"_range_to_"+x;var l=D('<input type="text" class="date_range_filter form-control" id="'+i+'" rel="'+x+'"/>');for(ti=0;ti<e.length;ti++){if(e[ti]==L.sDateFromToken){T.append(o)}else{if(e[ti]==L.sDateToToken){T.append(l)}else{T.append(e[ti])}}}T.wrapInner('<span class="filter_column filter_date_range" />');l.datepicker();var c=x;d.push(x);s.dataTableExt.afnFiltering.push(function(e,t,i){if(s.attr("id")!=e.sTableId)return true;var n=o.datepicker("getDate");var r=l.datepicker("getDate");if(n==null&&r==null){return true}var a=null;try{if(t[f(c)]==null||t[f(c)]=="")return false;a=D.datepicker.parseDate(D.datepicker.regional[""].dateFormat,t[f(c)])}catch(e){return false}if(a==null)return false;if(n==null&&a<=r){return true}else if(n<=a&&r==null){return true}else if(n<=a&&a<=r){return true}return false});D("#"+t+",#"+i,T).change(function(){s.fnDraw();M()})}function p(n,e,t,i,r,a,s,o){if(e==null)e=S(n.fnSettings(),t,true,false,true);var l=t;var c=n.fnSettings().aoPreSearchCols[x].sSearch;if(c==null||c=="")c=s;var u='<select class="search_init select_filter form-control" rel="'+x+'"><option value="" class="search_init">'+r+"</option>";if(o){u='<select class="search_init select_filter form-control" rel="'+x+'" multiple>'}var d=0;var h=e.length;for(d=0;d<h;d++){if(typeof e[d]!="object"){var f="";if(escape(e[d])==c||escape(e[d])==escape(c))f="selected ";u+="<option "+f+' value="'+escape(e[d])+'">'+e[d]+"</option>"}else{var f="";if(a){if(e[d].value==c)f="selected ";u+="<option "+f+'value="'+e[d].value+'">'+e[d].label+"</option>"}else{if(escape(e[d].value)==c)f="selected ";u+="<option "+f+'value="'+escape(e[d].value)+'">'+e[d].label+"</option>"}}}var p=D(u+"</select>");i.html(p);i.wrapInner('<span class="filter_column filter_select" />');if(o){p.change(function(){if(D(this).val()!=""){D(this).removeClass("search_init")}else{D(this).addClass("search_init")}var e=D(this).val();var i=[];if(e==null||e==[]){var t="^(.*)$"}else{D.each(e,function(e,t){i.push(m(t))});var t="^("+i.join("|")+")$"}n.fnFilter(t,l,true,false)})}else{p.change(function(){if(D(this).val()!=""){D(this).removeClass("search_init")}else{D(this).addClass("search_init")}if(a)n.fnFilter(D(this).val(),t,a);else n.fnFilter(unescape(D(this).val()),t);M()});if(c!=null&&c!="")n.fnFilter(unescape(c),t)}}function g(r,a,s,o,l){var e=r.fnSettings();if((a==null||typeof a=="function")&&e.sAjaxSource!=""&&!e.oFeatures.bServerSide){e.aoDrawCallback.push({fn:function(t,i,n){return function(e){if(e.iDraw==2&&e.sAjaxSource!=null&&e.sAjaxSource!=""&&!e.oFeatures.bServerSide){return p(r,a&&a(e.aoData,e),f(t),i,n,s,o,l)}}}(x,T,C),sName:"column_filter_"+x})}p(r,typeof a=="function"?null:a,f(x),T,C,s,o,l)}function m(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function v(e){var t=x;var i='<div class="dropdown select_filter form-control"><a class="dropdown-toggle" data-toggle="dropdown" href="#">'+C+'<b class="caret"></b></a><ul class="dropdown-menu" role="menu"><li data-value=""><a>Show All</a></li>',n,r=e.length;for(n=0;n<r;n++){i+='<li data-value="'+e[n]+'"><a>'+e[n]+"</a></li>"}var a=D(i+"</ul></div>");T.html(a);T.wrapInner('<span class="filterColumn filter_select" />');a.find("li").click(function(){_.fnFilter(D(this).data("value"),t)})}function y(e,t){if(t==null)t=S(e.fnSettings(),x,true,true,true);var r=x;var i="",n,a=t.length;var s=C.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("£","STERL").replace("@","AT").replace(/\s/g,"_");s=s.replace(/[^a-zA-Z 0-9]+/g,"");var o=C;if(L.sFilterButtonText!=null||L.sFilterButtonText!=undefined){o=L.sFilterButtonText}var l=10;var c=12;var u=Math.floor(a/c);if(a%c>0){u=u+1}var d=100/u-2;var h=l*u;if(u==1){d=20}var f='<div style="float:left; min-width: '+d+'%; " >';var p="</div>";var g=e.attr("id")+s;var m="chkBtnOpen"+g;var v=g+"-flt-toggle";i+='<button id="'+m+'" class="checkbox_filter btn btn-default" > '+o+"</button>";i+='<div id="'+v+'" '+'title="'+C+'" '+'rel="'+x+'" '+'class="toggle-check ui-widget-content ui-corner-all"  style="width: '+h+'%; " >';i+=f;for(n=0;n<a;n++){if(n%c==0&&n!=0){i+=p+f}var y=t[n];var _=t[n];if(typeof t[n]=="object"){y=t[n].label;_=t[n].value}i+='<input class="search_init checkbox_filter btn btn-default" type="checkbox" id= "'+g+"_cb_"+_+'" name= "'+s+'" value="'+_+'" >'+y+"<br/>";var b=D(i);T.html(b);T.wrapInner('<span class="filter_column filter_checkbox" />');b.change(function(){var t="";var i="|";var n=D('input:checkbox[name="'+s+'"]:checked').size();D('input:checkbox[name="'+s+'"]:checked').each(function(e){if(e==0&&n==1||e!=0&&e==n-1){i=""}t=t.replace(/^\s+|\s+$/g,"");t=t+D(this).val()+i;i="|"});if(t!=""){D('input:checkbox[name="'+s+'"]').removeClass("search_init")}else{D('input:checkbox[name="'+s+'"]').addClass("search_init")}e.fnFilter(t,r,true,false);M()})}D("#"+m).button();D("#"+v).dialog({autoOpen:false,hide:"blind",buttons:[{text:"Reset",click:function(){D('input:checkbox[name="'+s+'"]:checked').each(function(e){D(this).attr("checked",false);D(this).addClass("search_init")});e.fnFilter("",r,true,false);M();return false}},{text:"Close",click:function(){D(this).dialog("close")}}]});D("#"+m).click(function(){D("#"+v).dialog("open");var e=D(this);D("#"+v).dialog("widget").position({my:"top",at:"bottom",of:e});return false});var w=M;M=function(){var e=D("#"+m);D("#"+v).dialog("widget").position({my:"top",at:"bottom",of:e});w()}}function i(e){switch(e){case 0:return u.substring(0,u.indexOf("{from}"));case 1:return u.substring(u.indexOf("{from}")+6,u.indexOf("{to}"));default:return u.substring(u.indexOf("{to}")+4)}}var _=this;var n={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}",sDateFromToken:"from",sDateToToken:"to"};var L=D.extend(n,e);return this.each(function(){if(!_.fnSettings().oFeatures.bFilter)return;h=new Array;var e=_.fnSettings().aoFooter[0];var t=_.fnSettings().nTFoot;var i="tr";if(L.sPlaceHolder=="head:after"){var n=D("tr:first",_.fnSettings().nTHead).detach();if(_.fnSettings().bSortCellsTop){n.prependTo(D(_.fnSettings().nTHead));e=_.fnSettings().aoHeader[1]}else{n.appendTo(D(_.fnSettings().nTHead));e=_.fnSettings().aoHeader[0]}i="tr:last";t=_.fnSettings().nTHead}else if(L.sPlaceHolder=="head:before"){if(_.fnSettings().bSortCellsTop){var n=D("tr:first",_.fnSettings().nTHead).detach();n.appendTo(D(_.fnSettings().nTHead));e=_.fnSettings().aoHeader[1]}else{e=_.fnSettings().aoHeader[0]}i="tr:first";t=_.fnSettings().nTHead}D(e).each(function(e){x=e;var t={type:"text",bRegex:false,bSmart:true,iMaxLenght:-1,iFilterLength:0};if(L.aoColumns!=null){if(L.aoColumns.length<x||L.aoColumns[x]==null)return;t=L.aoColumns[x]}C=D(D(this)[0].cell).text();if(t.sSelector==null){T=D(D(this)[0].cell)}else{T=D(t.sSelector);if(T.length==0)T=D(D(this)[0].cell)}if(t!=null){if(t.sRangeFormat!=null)u=t.sRangeFormat;else u=L.sRangeFormat;switch(t.type){case"null":break;case"number":o(_,true,false,true,t.iFilterLength,t.iMaxLenght);break;case"select":if(t.bRegex!=true)t.bRegex=false;g(_,t.values,t.bRegex,t.selected,t.multiple);break;case"number-range":l(_);break;case"date-range":c(_);break;case"checkbox":y(_,t.values);break;case"twitter-dropdown":case"dropdown":v(t.values);break;case"text":default:bRegex=t.bRegex==null?false:t.bRegex;bSmart=t.bSmart==null?false:t.bSmart;o(_,bRegex,bSmart,false,t.iFilterLength,t.iMaxLenght);break}}});for(j=0;j<d.length;j++){var r=function(){var e=_.attr("id");return D("#"+e+"_range_from_"+d[j]).val()+L.sRangeSeparator+D("#"+e+"_range_to_"+d[j]).val()};s.push(r)}if(_.fnSettings().oFeatures.bServerSide){var a=_.fnSettings().fnServerData;_.fnSettings().fnServerData=function(t,i,n){for(j=0;j<d.length;j++){var e=d[j];for(k=0;k<i.length;k++){if(i[k].name=="sSearch_"+e)i[k].value=s[j]()}}i.push({name:"sRangeSeparator",value:L.sRangeSeparator});if(a!=null){try{a(t,i,n,_.fnSettings())}catch(e){a(t,i,n)}}else{D.getJSON(t,i,function(e){n(e)})}}}})}})(jQuery);(function(e,p,u){var t=function(f,e){"use strict";var a=function(e,t){if(!this.CLASS||this.CLASS!="ColVis"){alert("Warning: ColVis must be initialised with the keyword 'new'")}if(typeof t=="undefined"){t={}}if(f.fn.dataTable.camelToHungarian){f.fn.dataTable.camelToHungarian(a.defaults,t)}this.s={dt:null,oInit:t,hidden:true,abOriginal:[]};this.dom={wrapper:null,button:null,collection:null,background:null,catcher:null,buttons:[],groupButtons:[],restore:null};a.aInstances.push(this);this.s.dt=f.fn.dataTable.Api?new f.fn.dataTable.Api(e).settings()[0]:e;this._fnConstruct(t);return this};a.prototype={button:function(){return this.dom.wrapper},fnRebuild:function(){this.rebuild()},rebuild:function(){for(var e=this.dom.buttons.length-1;e>=0;e--){this.dom.collection.removeChild(this.dom.buttons[e])}this.dom.buttons.splice(0,this.dom.buttons.length);if(this.dom.restore){this.dom.restore.parentNode(this.dom.restore)}this._fnAddGroups();this._fnAddButtons();this._fnDrawCallback()},_fnConstruct:function(e){this._fnApplyCustomisation(e);var r=this;var a,s;this.dom.wrapper=p.createElement("div");this.dom.wrapper.className="ColVis";this.dom.button=f("<button />",{class:!this.s.dt.bJUI?"ColVis_Button ColVis_MasterButton":"ColVis_Button ColVis_MasterButton ui-button ui-state-default"}).append("<span>"+this.s.buttonText+"</span>").bind(this.s.activate=="mouseover"?"mouseover":"click",function(e){e.preventDefault();r._fnCollectionShow()}).appendTo(this.dom.wrapper)[0];this.dom.catcher=this._fnDomCatcher();this.dom.collection=this._fnDomCollection();this.dom.background=this._fnDomBackground();this._fnAddGroups();this._fnAddButtons();for(a=0,s=this.s.dt.aoColumns.length;a<s;a++){this.s.abOriginal.push(this.s.dt.aoColumns[a].bVisible)}this.s.dt.aoDrawCallback.push({fn:function(){r._fnDrawCallback.call(r)},sName:"ColVis"});f(this.s.dt.oInstance).bind("column-reorder",function(e,t,i){for(a=0,s=r.s.aiExclude.length;a<s;a++){r.s.aiExclude[a]=i.aiInvertMapping[r.s.aiExclude[a]]}var n=r.s.abOriginal.splice(i.iFrom,1)[0];r.s.abOriginal.splice(i.iTo,0,n);r.fnRebuild()});this._fnDrawCallback()},_fnApplyCustomisation:function(e){f.extend(true,this.s,a.defaults,e);if(!this.s.showAll&&this.s.bShowAll){this.s.showAll=this.s.sShowAll}if(!this.s.restore&&this.s.bRestore){this.s.restore=this.s.sRestore}var t=this.s.groups;var i=this.s.aoGroups;if(t){for(var n=0,r=t.length;n<r;n++){if(t[n].title){i[n].sTitle=t[n].title}if(t[n].columns){i[n].aiColumns=t[n].columns}}}},_fnDrawCallback:function(){var n=this.s.dt.aoColumns;var e=this.dom.buttons;var t=this.s.aoGroups;var i;for(var r=0,a=e.length;r<a;r++){i=e[r];if(i.__columnIdx!==u){f("input",i).prop("checked",n[i.__columnIdx].bVisible)}}var s=function(e){for(var t=0,i=e.length;t<i;t++){if(n[e[t]].bVisible===false){return false}}return true};var o=function(e){for(var t=0,i=e.length;t<i;t++){if(n[e[t]].bVisible===true){return false}}return true};for(var l=0,c=t.length;l<c;l++){if(s(t[l].aiColumns)){f("input",this.dom.groupButtons[l]).prop("checked",true);f("input",this.dom.groupButtons[l]).prop("indeterminate",false)}else if(o(t[l].aiColumns)){f("input",this.dom.groupButtons[l]).prop("checked",false);f("input",this.dom.groupButtons[l]).prop("indeterminate",false)}else{f("input",this.dom.groupButtons[l]).prop("indeterminate",true)}}},_fnAddGroups:function(){var e;if(typeof this.s.aoGroups!="undefined"){for(var t=0,i=this.s.aoGroups.length;t<i;t++){e=this._fnDomGroupButton(t);this.dom.groupButtons.push(e);this.dom.buttons.push(e);this.dom.collection.appendChild(e)}}},_fnAddButtons:function(){var e,r=this.s.dt.aoColumns;if(f.inArray("all",this.s.aiExclude)===-1){for(var t=0,i=r.length;t<i;t++){if(f.inArray(t,this.s.aiExclude)===-1){e=this._fnDomColumnButton(t);e.__columnIdx=t;this.dom.buttons.push(e)}}}if(this.s.order==="alpha"){this.dom.buttons.sort(function(e,t){var i=r[e.__columnIdx].sTitle;var n=r[t.__columnIdx].sTitle;return i===n?0:i<n?-1:1})}if(this.s.restore){e=this._fnDomRestoreButton();e.className+=" ColVis_Restore";this.dom.buttons.push(e)}if(this.s.showAll){e=this._fnDomShowXButton(this.s.showAll,true);e.className+=" ColVis_ShowAll";this.dom.buttons.push(e)}if(this.s.showNone){e=this._fnDomShowXButton(this.s.showNone,false);e.className+=" ColVis_ShowNone";this.dom.buttons.push(e)}f(this.dom.collection).append(this.dom.buttons)},_fnDomRestoreButton:function(){var n=this,e=this.s.dt;return f('<li class="ColVis_Special '+(e.bJUI?"ui-button ui-state-default":"")+'">'+this.s.restore+"</li>").click(function(e){for(var t=0,i=n.s.abOriginal.length;t<i;t++){n.s.dt.oInstance.fnSetColumnVis(t,n.s.abOriginal[t],false)}n._fnAdjustOpenRows();n.s.dt.oInstance.fnAdjustColumnSizing(false);n.s.dt.oInstance.fnDraw(false)})[0]},_fnDomShowXButton:function(e,n){var r=this,t=this.s.dt;return f('<li class="ColVis_Special '+(t.bJUI?"ui-button ui-state-default":"")+'">'+e+"</li>").click(function(e){for(var t=0,i=r.s.abOriginal.length;t<i;t++){if(r.s.aiExclude.indexOf(t)===-1){r.s.dt.oInstance.fnSetColumnVis(t,n,false)}}r._fnAdjustOpenRows();r.s.dt.oInstance.fnAdjustColumnSizing(false);r.s.dt.oInstance.fnDraw(false)})[0]},_fnDomGroupButton:function(e){var n=this,t=this.s.dt,r=this.s.aoGroups[e];return f('<li class="ColVis_Special '+(t.bJUI?"ui-button ui-state-default":"")+'">'+"<label>"+'<input type="checkbox" />'+"<span>"+r.sTitle+"</span>"+"</label>"+"</li>").click(function(e){var t=!f("input",this).is(":checked");if(e.target.nodeName.toLowerCase()!=="li"){t=!t}for(var i=0;i<r.aiColumns.length;i++){n.s.dt.oInstance.fnSetColumnVis(r.aiColumns[i],t)}})[0]},_fnDomColumnButton:function(n){var r=this,e=this.s.dt.aoColumns[n],a=this.s.dt;var t=this.s.fnLabel===null?e.sTitle:this.s.fnLabel(n,e.sTitle,e.nTh);return f("<li "+(a.bJUI?'class="ui-button ui-state-default"':"")+">"+"<label>"+'<input type="checkbox" />'+"<span>"+t+"</span>"+"</label>"+"</li>").click(function(e){var t=!f("input",this).is(":checked");if(e.target.nodeName.toLowerCase()!=="li"){t=!t}var i=f.fn.dataTableExt.iApiIndex;f.fn.dataTableExt.iApiIndex=r._fnDataTablesApiIndex.call(r);if(a.oFeatures.bServerSide){r.s.dt.oInstance.fnSetColumnVis(n,t,false);r.s.dt.oInstance.fnAdjustColumnSizing(false);if(a.oScroll.sX!==""||a.oScroll.sY!==""){r.s.dt.oInstance.oApi._fnScrollDraw(r.s.dt)}r._fnDrawCallback()}else{r.s.dt.oInstance.fnSetColumnVis(n,t)}f.fn.dataTableExt.iApiIndex=i;if(e.target.nodeName.toLowerCase()==="input"&&r.s.fnStateChange!==null){r.s.fnStateChange.call(r,n,t)}})[0]},_fnDataTablesApiIndex:function(){for(var e=0,t=this.s.dt.oInstance.length;e<t;e++){if(this.s.dt.oInstance[e]==this.s.dt.nTable){return e}}return 0},_fnDomCollection:function(){return f("<ul />",{class:!this.s.dt.bJUI?"ColVis_collection":"ColVis_collection ui-buttonset ui-buttonset-multi"}).css({display:"none",opacity:0,position:!this.s.bCssPosition?"absolute":""})[0]},_fnDomCatcher:function(){var e=this,t=p.createElement("div");t.className="ColVis_catcher";f(t).click(function(){e._fnCollectionHide.call(e,null,null)});return t},_fnDomBackground:function(){var e=this;var t=f("<div></div>").addClass("ColVis_collectionBackground").css("opacity",0).click(function(){e._fnCollectionHide.call(e,null,null)});if(this.s.activate=="mouseover"){t.mouseover(function(){e.s.overcollection=false;e._fnCollectionHide.call(e,null,null)})}return t[0]},_fnCollectionShow:function(){var e=this,t,i,n;var r=f(this.dom.button).offset();var a=this.dom.collection;var s=this.dom.background;var o=parseInt(r.left,10);var l=parseInt(r.top+f(this.dom.button).outerHeight(),10);if(!this.s.bCssPosition){a.style.top=l+"px";a.style.left=o+"px"}f(a).css({display:"block",opacity:0});s.style.bottom="0px";s.style.right="0px";var c=this.dom.catcher.style;c.height=f(this.dom.button).outerHeight()+"px";c.width=f(this.dom.button).outerWidth()+"px";c.top=r.top+"px";c.left=o+"px";p.body.appendChild(s);p.body.appendChild(a);p.body.appendChild(this.dom.catcher);f(a).animate({opacity:1},e.s.iOverlayFade);f(s).animate({opacity:.1},e.s.iOverlayFade,"linear",function(){if(f.browser&&f.browser.msie&&f.browser.version=="6.0"){e._fnDrawCallback()}});if(!this.s.bCssPosition){n=this.s.sAlign=="left"?o:o-f(a).outerWidth()+f(this.dom.button).outerWidth();a.style.left=n+"px";var u=f(a).outerWidth();var d=f(a).outerHeight();var h=f(p).width();if(n+u>h){a.style.left=h-u+"px"}}this.s.hidden=false},_fnCollectionHide:function(){var t=this;if(!this.s.hidden&&this.dom.collection!==null){this.s.hidden=true;f(this.dom.collection).animate({opacity:0},t.s.iOverlayFade,function(e){this.style.display="none"});f(this.dom.background).animate({opacity:0},t.s.iOverlayFade,function(e){p.body.removeChild(t.dom.background);p.body.removeChild(t.dom.catcher)})}},_fnAdjustOpenRows:function(){var e=this.s.dt.aoOpenRows;var t=this.s.dt.oApi._fnVisbleColumns(this.s.dt);for(var i=0,n=e.length;i<n;i++){e[i].nTr.getElementsByTagName("td")[0].colSpan=t}}};a.fnRebuild=function(e){var t=null;if(typeof e!="undefined"){t=e.fnSettings().nTable}for(var i=0,n=a.aInstances.length;i<n;i++){if(typeof e=="undefined"||t==a.aInstances[i].s.dt.nTable){a.aInstances[i].fnRebuild()}}};a.defaults={active:"click",buttonText:"Show / hide columns",aiExclude:[],bRestore:false,sRestore:"Restore original",bShowAll:false,sShowAll:"Show All",sAlign:"left",fnStateChange:null,iOverlayFade:500,fnLabel:null,bCssPosition:false,aoGroups:[],order:"column"};a.aInstances=[];a.prototype.CLASS="ColVis";a.VERSION="1.1.1";a.prototype.VERSION=a.VERSION;if(typeof f.fn.dataTable=="function"&&typeof f.fn.dataTableExt.fnVersionCheck=="function"&&f.fn.dataTableExt.fnVersionCheck("1.7.0")){f.fn.dataTableExt.aoFeatures.push({fnInit:function(e){var t=e.oInit;var i=new a(e,t.colVis||t.oColVis||{});return i.button()},cFeature:"C",sFeature:"ColVis"})}else{alert("Warning: ColVis requires DataTables 1.7 or greater - www.datatables.net/download")}f.fn.dataTable.ColVis=a;f.fn.DataTable.ColVis=a;return a};if(typeof define==="function"&&define.amd){define(["jquery","datatables"],t)}else if(typeof exports==="object"){t(require("jquery"),require("datatables"))}else if(jQuery&&!jQuery.fn.dataTable.ColVis){t(jQuery,jQuery.fn.dataTable)}})(window,document);(function(e,o,l){var t=function(_,e){"use strict";_.fn.dataTableExt.oApi.fnColResize=function(e,t){var i=_.fn.dataTable.Api?true:false;_(e.oInstance).trigger("column-resize",[e,{iCol:t}])};var r=function(e,t){var i;if(_.fn.dataTable.Api){i=new _.fn.dataTable.Api(e).settings()[0]}else if(e.fnSettings){i=e.fnSettings()}else if(typeof e==="string"){if(_.fn.dataTable.fnIsDataTable(_(e)[0])){i=_(e).eq(0).dataTable().fnSettings()}}else if(e.nodeName&&e.nodeName.toLowerCase()==="table"){if(_.fn.dataTable.fnIsDataTable(e.nodeName)){i=_(e.nodeName).dataTable().fnSettings()}}else if(e instanceof jQuery){if(_.fn.dataTable.fnIsDataTable(e[0])){i=e.eq(0).dataTable().fnSettings()}}else{i=e}if(_.fn.dataTable.camelToHungarian){_.fn.dataTable.camelToHungarian(r.defaults,t||{})}this.s={dt:null,init:_.extend(true,{},r.defaults,t),mouse:{startX:-1,startY:-1,targetIndex:-1,targetColumn:-1,neighbourIndex:-1,neighbourColumn:-1},isMousedown:false};this.dom={resizeCol:null,resizeColNeighbour:null,restoreEvents:[]};this.s.dt=i.oInstance.fnSettings();this.s.dt._colResize=this;this._fnConstruct();i.oApi._fnCallbackReg(i,"aoDestroyCallback",_.proxy(this._fnDestroy,this),"ColResize");return this};r.prototype={fnReset:function(){var e=[];for(var t=0,i=this.s.dt.aoColumns.length;t<i;t++){this.s.dt.aoColumns[t].width=this.s.dt.aoColumns[t]._ColResize_iOrigWidth}this.s.dt.adjust().draw();return this},_fnConstruct:function(){var i=this;var e=i.s.dt.aoColumns.length;var t;i._fnSetupMouseListeners();for(t=0;t<e;t++){this.s.dt.aoColumns[t]._ColResize_iOrigWidth=this.s.dt.aoColumns[t].width}this._fnSetColumnIndexes();this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(e,t){i._fnStateSave.call(i,t)},"ColResize_State");this._fnStateLoad()},_fnStateSave:function(i){this.s.dt.aoColumns.forEach(function(e,t){i.columns[t].width=e.sWidthOrig})},_fnStateLoad:function(){var n=this,e=this.s.dt.oLoadedState;if(e&&e.columns){var t=e.columns,i=this.s.dt.aoColumns;if(t.length>0&&t.length===i.length){t.forEach(function(e,t){var i=n.s.dt.aoColumns[t];if(e.width){i.sWidthOrig=i.sWidth=e.width}})}}},_fnDelayEvents:function(i,n,r,a){var s=this;var e=_._data(_(n).get(0),"events");_.each(e,function(e,t){if(e==r){_.each(t,function(e,t){if(t){if(a){s.dom.restoreEvents.push({until:i,obj:n,type:t.type,namespace:t.namespace,handler:t.handler});if(t.namespace==a){_(n).off(r+"."+a)}}else{s.dom.restoreEvents.push({until:i,obj:n,type:t.type,namespace:null,handler:t.handler});_(n).off(r)}}})}})},_fnRestoreEvents:function(e){var t=this;var i;for(i=t.dom.restoreEvents.length;i--;){if(t.dom.restoreEvents[i].until==l||t.dom.restoreEvents[i].until==null||t.dom.restoreEvents[i].until==e){if(t.dom.restoreEvents[i].namespace){_(t.dom.restoreEvents[i].obj).off(t.dom.restoreEvents[i].type+"."+t.dom.restoreEvents[i].namespace).on(t.dom.restoreEvents[i].type+"."+t.dom.restoreEvents[i].namespace,t.dom.restoreEvents[i].handler);t.dom.restoreEvents.splice(i,1)}else{_(t.dom.restoreEvents[i].obj).off(t.dom.restoreEvents[i].type).on(t.dom.restoreEvents[i].type,t.dom.restoreEvents[i].handler);t.dom.restoreEvents.splice(i,1)}}}},_fnSetupMouseListeners:function(){var t=this;_(t.s.dt.nTableWrapper).off("mouseenter.ColResize").on("mouseenter.ColResize","th",function(e){e.preventDefault();t._fnMouseEnter.call(t,e,this)});_(t.s.dt.nTableWrapper).off("mouseleave.ColResize").on("mouseleave.ColResize","th",function(e){e.preventDefault();t._fnMouseLeave.call(t,e,this)})},_fnMouseListener:function(e,t){var i=this;_(t).off("mouseenter.ColResize").on("mouseenter.ColResize",function(e){e.preventDefault();i._fnMouseEnter.call(i,e,t)});_(t).off("mouseleave.ColResize").on("mouseleave.ColResize",function(e){e.preventDefault();i._fnMouseLeave.call(i,e,t)})},_fnMouseEnter:function(e,t){var i=this;if(!i.s.isMousedown){_(t).off("mousemove.ColResizeHandle").on("mousemove.ColResizeHandle",function(e){e.preventDefault();i._fnResizeHandleCheck.call(i,e,t)})}},_fnMouseLeave:function(e,t){_(t).off("mousemove.ColResizeHandle")},_fnMouseDown:function(e,t){var i=this;i.s.isMousedown=true;var n=_(e.target).closest("th, td");var r=n.offset();this.s.mouse.startX=e.pageX;this.s.mouse.startY=e.pageY;var a=i.dom.resizeCol[0].cellIndex;if(i.dom.resizeColNeighbour[0]===l){var s=0}else{var s=i.dom.resizeColNeighbour[0].cellIndex}if(a===l){return}this.s.mouse.targetIndex=a;this.s.mouse.targetColumn=this.s.dt.aoColumns[a];this.s.mouse.neighbourIndex=s;this.s.mouse.neighbourColumn=this.s.dt.aoColumns[s];_(o).off("mousemove.ColResize").on("mousemove.ColResize",function(e){i._fnMouseMove.call(i,e)}).off("mouseup.ColResize").on("mouseup.ColResize",function(e){i._fnMouseUp.call(i,e)})},_fnMouseMove:function(e){var t=this;var i=_(t.s.mouse.targetColumn.nTh).offset();var n=e.pageX-i.left;var r=n;var a=_(t.s.mouse.targetColumn.nTh).outerWidth()-n-1;var s=e.pageX-t.s.mouse.startX;var o=Math.max(parseInt(_(t.s.mouse.targetColumn.nTh).css("min-width")),10);var l=_(t.s.mouse.targetColumn.nTh).width();if(s>0&&a<=0||s<0&&a>=0){if(!t.s.init.tableWidthFixed){var c=Math.max(o,l+s);var u=c-l;var d=parseInt(t.dom.resizeCol.attr("data-column-index"));t.s.mouse.targetColumn.sWidthOrig=t.s.mouse.targetColumn.sWidth=t.s.mouse.targetColumn.width=c+"px";var h=_(t.s.dt.nTableWrapper).find("th[data-column-index='"+d+"']");h.parents("table").each(function(){if(!_(this).parent().hasClass("DTFC_LeftBodyLiner")){var e=_(this).width()+u;_(this).width(e)}else{var e=_(t.s.dt.nTableWrapper).find(".DTFC_LeftHeadWrapper").children("table").width();_(this).parents(".DTFC_LeftWrapper").width(e);_(this).parent().width(e+15);_(this).width(e)}});h.width(t.s.mouse.targetColumn.width)}else{if(t.s.mouse.neighbourColumn){var f=Math.max(parseInt(_(t.s.mouse.neighbourColumn.nTh).css("min-width")),10);var p=_(t.s.mouse.neighbourColumn.nTh).width();var c=Math.max(o,l+s);var g=Math.max(f,p-s);var u=c-l;var m=g-p;var d=parseInt(t.dom.resizeCol.attr("data-column-index"));var v=parseInt(t.dom.resizeColNeighbour.attr("data-column-index"));t.s.mouse.neighbourColumn.sWidthOrig=t.s.mouse.neighbourColumn.sWidth=t.s.mouse.neighbourColumn.width=g+"px";t.s.mouse.targetColumn.sWidthOrig=t.s.mouse.targetColumn.sWidth=t.s.mouse.targetColumn.width=c+"px";var y=_(t.s.dt.nTableWrapper).find("th[data-column-index='"+v+"']");var h=_(t.s.dt.nTableWrapper).find("th[data-column-index='"+d+"']");if(s>0){y.width(t.s.mouse.neighbourColumn.width);h.width(t.s.mouse.targetColumn.width)}else{h.width(t.s.mouse.targetColumn.width);y.width(t.s.mouse.neighbourColumn.width)}}}}t.s.mouse.startX=e.pageX},_fnResizeHandleCheck:function(e,t){var i=this;var n=_(t).offset();var r=e.pageX-n.left;var a=e.pageY-n.top;var s=r;var o=_(t).outerWidth()-r-1;var l=this.s.init.handleWidth/2;var c=s<l;var u=o<l;if(_(t).prev("th").length==0){if(this.s.init.rtl)u=false;else c=false}if(_(t).next("th").length==0&&this.s.init.tableWidthFixed){if(this.s.init.rtl)c=false;else u=false}var d=c||u;if(i.s.init.rtl){if(c){i.dom.resizeCol=_(t);i.dom.resizeColNeighbour=_(t).next()}else if(u){i.dom.resizeCol=_(t).prev();i.dom.resizeColNeighbour=_(t)}}else{if(u){i.dom.resizeCol=_(t);i.dom.resizeColNeighbour=_(t).next()}else if(c){i.dom.resizeCol=_(t).prev();i.dom.resizeColNeighbour=_(t)}}if(this.s.init.tableWidthFixed)d&=this.s.init.exclude.indexOf(parseInt(_(i.dom.resizeCol).attr("data-column-index")))==-1&&this.s.init.exclude.indexOf(parseInt(_(i.dom.resizeColNeighbour).attr("data-column-index")))==-1;else d&=this.s.init.exclude.indexOf(parseInt(_(i.dom.resizeCol).attr("data-column-index")))==-1;_(t).off("mousedown.ColResize");if(d){_(t).css("cursor","ew-resize");i._fnDelayEvents(null,t,"mousedown","ColReorder");i._fnDelayEvents("click",t,"click","DT");_(t).off("mousedown.ColResize").on("mousedown.ColResize",function(e){e.preventDefault();i._fnMouseDown.call(i,e,t)}).off("click.ColResize").on("click.ColResize",function(e){i._fnClick.call(i,e)})}else{_(t).css("cursor","pointer");_(t).off("mousedown.ColResize click.ColResize");i._fnRestoreEvents();if(!i.s.isMousedown)this._fnRestoreEvents("click")}},_fnClick:function(e){var t=this;t.s.isMousedown=false;e.stopImmediatePropagation()},_fnMouseUp:function(e){var t=this;t.s.isMousedown=false;t.s.mouse.targetColumn.width=t.dom.resizeCol.width();_(o).off("mousemove.ColResize mouseup.ColResize");if(t.s.init.adjustAfterResize){this.s.dt.oInstance.fnAdjustColumnSizing()}var i=_(t.s.dt.nTableWrapper).find(".DTFC_LeftWrapper");var n=i.width();i.children(".DTFC_LeftHeadWrapper").children("table").width(n);if(t.s.init.resizeCallback){t.s.init.resizeCallback.call(t,t.s.mouse.targetColumn)}},_fnDestroy:function(){var e,t;for(e=0,t=this.s.dt.aoDrawCallback.length;e<t;e++){if(this.s.dt.aoDrawCallback[e].sName==="ColResize_Pre"){this.s.dt.aoDrawCallback.splice(e,1);break}}_(this.s.dt.nTHead).find("*").off(".ColResize");_.each(this.s.dt.aoColumns,function(e,t){_(t.nTh).removeAttr("data-column-index")});this.s.dt._colResize=null;this.s=null},_fnSetColumnIndexes:function(){_.each(this.s.dt.aoColumns,function(e,t){_(t.nTh).attr("data-column-index",e)})}};r.defaults={resizeCallback:null,exclude:[],tableWidthFixed:true,handleWidth:10,rtl:false,adjustAfterResize:true};r.version="0.0.10";_.fn.dataTable.ColResize=r;_.fn.DataTable.ColResize=r;if(typeof _.fn.dataTable=="function"&&typeof _.fn.dataTableExt.fnVersionCheck=="function"&&_.fn.dataTableExt.fnVersionCheck("1.9.3")){_.fn.dataTableExt.aoFeatures.push({fnInit:function(e){var t=e.oInstance;if(!e._colResize){var i=e.oInit;var n=i.colResize||i.oColResize||{};new r(e,n)}else{t.oApi._fnLog(e,1,"ColResize attempted to initialise twice. Ignoring second")}return null},cFeature:"Z",sFeature:"ColResize"})}else{alert("Warning: ColResize requires DataTables 1.9.3 or greater - www.datatables.net/download")}if(_.fn.dataTable.Api){_.fn.dataTable.Api.register("colResize.reset()",function(){return this.iterator("table",function(e){e._colResize.fnReset()})})}return r};if(typeof define==="function"&&define.amd){define(["jquery","datatables"],t)}else if(typeof exports==="object"){t(require("jquery"),require("datatables"))}else if(jQuery&&!jQuery.fn.dataTable.ColResize){t(jQuery,jQuery.fn.dataTable)}})(window,document);$.fn.dataTableExt.oPagination.input={fnInit:function(i,e,n){var r=document.createElement("span");var a=document.createElement("span");var s=document.createElement("span");var o=document.createElement("span");var t=document.createElement("input");var l=document.createElement("span");var c=document.createElement("span");r.innerHTML=i.oLanguage.oPaginate.sFirst;a.innerHTML=i.oLanguage.oPaginate.sPrevious;s.innerHTML=i.oLanguage.oPaginate.sNext;o.innerHTML=i.oLanguage.oPaginate.sLast;r.className="paginate_button first disabled";a.className="paginate_button previous disabled";s.className="paginate_button next";o.className="paginate_button last";c.className="paginate_of";l.className="paginate_page";t.className="paginate_input";if(i.sTableId!==""){e.setAttribute("id",i.sTableId+"_paginate");a.setAttribute("id",i.sTableId+"_previous");a.setAttribute("id",i.sTableId+"_previous");s.setAttribute("id",i.sTableId+"_next");o.setAttribute("id",i.sTableId+"_last")}t.type="text";l.innerHTML="Page ";e.appendChild(r);e.appendChild(a);e.appendChild(l);e.appendChild(t);e.appendChild(c);e.appendChild(s);e.appendChild(o);$(r).click(function(){var e=Math.ceil(i._iDisplayStart/i._iDisplayLength)+1;if(e!=1){i.oApi._fnPageChange(i,"first");n(i);$(r).addClass("disabled");$(a).addClass("disabled");$(s).removeClass("disabled");$(o).removeClass("disabled")}});$(a).click(function(){var e=Math.ceil(i._iDisplayStart/i._iDisplayLength)+1;if(e!=1){i.oApi._fnPageChange(i,"previous");n(i);if(e==2){$(r).addClass("disabled");$(a).addClass("disabled")}$(s).removeClass("disabled");$(o).removeClass("disabled")}});$(s).click(function(){var e=Math.ceil(i._iDisplayStart/i._iDisplayLength)+1;if(e!=Math.ceil(i.fnRecordsDisplay()/i._iDisplayLength)){i.oApi._fnPageChange(i,"next");n(i);if(e==Math.ceil((i.fnRecordsDisplay()-1)/i._iDisplayLength)-1){$(s).addClass("disabled");$(o).addClass("disabled")}$(r).removeClass("disabled");$(a).removeClass("disabled")}});$(o).click(function(){var e=Math.ceil(i._iDisplayStart/i._iDisplayLength)+1;if(e!=Math.ceil(i.fnRecordsDisplay()/i._iDisplayLength)){i.oApi._fnPageChange(i,"last");n(i);$(r).removeClass("disabled");$(a).removeClass("disabled");$(s).addClass("disabled");$(o).addClass("disabled")}});$(t).keyup(function(e){if(e.which==38||e.which==39){this.value++}else if((e.which==37||e.which==40)&&this.value>1){this.value--}if(this.value===""||this.value.match(/[^0-9]/)){this.value=this.value.replace(/[^\d]/g,"");return}var t=i._iDisplayLength*(this.value-1);if(t<0){t=0}if(t>i.fnRecordsDisplay()){t=(Math.ceil((i.fnRecordsDisplay()-1)/i._iDisplayLength)-1)*i._iDisplayLength}if(t===0){$(r).addClass("disabled");$(a).addClass("disabled");$(s).removeClass("disabled");$(o).removeClass("disabled")}else if(t==(Math.ceil((i.fnRecordsDisplay()-1)/i._iDisplayLength)-1)*i._iDisplayLength){$(s).addClass("disabled");$(o).addClass("disabled");$(r).removeClass("disabled");$(a).removeClass("disabled")}else{$(r).removeClass("disabled");$(a).removeClass("disabled");$(s).removeClass("disabled");$(o).removeClass("disabled")}i._iDisplayStart=t;n(i)});$("span",e).bind("mousedown",function(){return false});$("span",e).bind("selectstart",function(){return false});var u=Math.ceil(i.fnRecordsDisplay()/i._iDisplayLength);if(u<=1){$(e).hide()}},fnUpdate:function(e,t){if(!e.aanFeatures.p){return}var i=Math.ceil(e.fnRecordsDisplay()/e._iDisplayLength);var n=Math.ceil(e._iDisplayStart/e._iDisplayLength)+1;var r=e.aanFeatures.p;if(i<=1){$(r).hide()}else{for(var a=0,s=r.length;a<s;a++){var o=r[a].getElementsByTagName("span");var l=r[a].getElementsByTagName("input");o[3].innerHTML=" of "+i;l[0].value=n}}}};(function(c,r){"use strict";var a={ajax:{type:"POST",url:null},ajaxData:{},perPage:10,page:1,startPropName:"page",perPagePropName:"perpage",orderByPropName:"order_by",totalCoutPropName:"total",orginalOrderBy:null,iconsForPaginate:false,searching:false,unSelect:false,info:false,resizeColumns:false,orderColumns:false,dom:"lfrtip",skipInitAjaxCall:false,responsive:true,rowSelectable:false,pagingSelectList:false,rowSelectableOpts:{singleRowSelect:false,useShift:true,useCtrl:true},getDataFunction:null,getDataFunctionContext:null,getDataCallback:null,language:{processing:"<i class='fa fa-refresh gc-grid-load fa-spin'></i>"},draw:0,triggerDraw:true,wrapperClass:"gc-datagrid",tableClasses:["table","table-striped","table-hover","dt-responsive"]},s=function e(t,i,n,r){i=o.call(this,i);if(this.options.skipInitAjaxCall===true&&this.options.draw===0){this.options.draw++;return}else{r.jqXHR=c.ajax({type:r.ajax.type,url:t||r.ajax.url,data:i}).then(c.proxy(function(e){if(e.result&&e.result=="no"){giscloud.ui.alert.red().show(e.msg,1e4);this.trigger(c.Event(this.EVENTS[9]+"."+this.eventNamespace),{errorMsg:e.msg});return}if(e.result==="no"){this.container.parents(".dataTables_wrapper").find(".gc-grid-load").remove();return}e.recordsTotal=e[this.options.totalCoutPropName];e.recordsDisplay=e.data.length;e.recordsFiltered=e[this.options.totalCoutPropName];e.draw=this.options.draw;e.displayLength=e.data.length;n(e);d.apply(this,[null,r,e]);if(this.options.height){this.height(this.options.height,false,true)}},this),function(e,t,i){giscloud.ui.redAlert("Problem with data mapping",3e3);throw{error:t,data:i}})}},o=function e(t){var i=this,n=this.options,r=this.dataTable?this.dataTable.page.info().page:0,a=c.map(t,function(e){var t={};switch(e.name){case"start":t.name=n.startPropName;t.value=r+1;break;case"length":t.name=n.perPagePropName;t.value=e.value?e.value:n.perPage;break;case"order":t.name=n.orderByPropName;t.value=e.value.length>0?e.value:n.orginalOrderBy;break;case"draw":i.options.draw=e.value;break}return c.isEmptyObject(t)?null:t});c.each(i.options.ajaxData||{},function(e,t){var i={name:e,value:t},n;n=c.map(a,function(e){if(i.name==e.name){return true}})[0]||false;if(n===false){a.push(i)}});this.trigger(c.Event(this.EVENTS[10]+"."+this.eventNamespace),[a]);return a},l=function e(l){return function e(t,i,n,r){var a=l.options.getDataFunction,s=l.options.getDataFunctionContext||l,o=a.call(s,l);if(!c.isFunction(o.state)){o=c.Deferred().resolve(o)}o.done(c.proxy(function(e){c.extend(e,{recordsTotal:e.total,recordsDisplay:e.data.length,recordsFiltered:e.total,draw:r.iDraw,displayLength:e.data.length});n(e)},this))}},u=function e(t){var i=c(t.currentTarget),n=function e(){var t={jqSelectedEls:this.container.find("tr.selected"),jqSelectedEl:i,data:this.dataTable.row(i.get(0)).data(),datagrid:this};t.allSelectedData=c.map(this.container.find("tr.selected"),c.proxy(function(e){return this.dataTable.row(e).data()},this));return t},r,a;if(i.hasClass("child")){return}if(i.hasClass("selected")&&this.options.unSelect===true){i.removeClass("selected");r=n.call(this);this.trigger(c.Event(this.EVENTS[1]+"."+this.eventNamespace),r)}else{a=this.container.find("tr.selected");if(this.options.rowSelectableOpts.singleRowSelect===true){a.removeClass("selected")}else{if(t.ctrlKey!==this.options.rowSelectableOpts.useCtrl&&t.shiftKey!==this.options.rowSelectableOpts.useShift){a.removeClass("selected")}if(t.shiftKey===this.options.rowSelectableOpts.useShift){if(a.nextAll().filter(i).length>0){a.last().nextUntil(i).addClass("selected")}else{i.first().nextUntil(a).addClass("selected")}}}i.addClass("selected");r=n.call(this);this.trigger(c.Event(this.EVENTS[0]+"."+this.eventNamespace),r);i=null}},d=function e(t,i,n){var r={settings:i,data:n};this.trigger(c.Event(this.EVENTS[2]+"."+this.eventNamespace),r)},h=function e(t){var i={jqEl:c(t.currentTarget),data:this.dataTable.row(t.currentTarget).data()};if(i.jqEl.hasClass("child")){return}i.jqEl.addClass("selected");this.trigger(c.Event(this.EVENTS[3]+"."+this.eventNamespace),i)},f=function e(){if(this.options.iconsForPaginate){this.container.parents(".dataTables_wrapper").find(".dataTables_paginate").addClass("icons");this.container.parents(".dataTables_wrapper").find(".dataTables_paginate").find(".first, .previous, .next, .last").text("")}if(this.fnSettings._iRecordsTotal>this.fnSettings._iDisplayLength){this.container.parents(".dataTables_wrapper").find(".dataTables_paginate").show()}},p=function e(){var t=this.dataTable.columns()[0],i=c(this.fnSettings.nTableWrapper),n=c(this.fnSettings.nScrollHead).find(".dataTables_scrollHeadInner"),r,a;this.trigger(c.Event(this.EVENTS[5]+"."+this.eventNamespace),this);if(this.options.height){this.height(this.options.height,false,true)}f.apply(this);if(this.options.resizeColumns===true&&this.options.scrollX){this.container.css("width","auto");n.css("width","auto");n.find("table.table").css("width","auto");this.dataTableObj._fnCalculateColumnWidths(this.fnSettings);c.map(t,c.proxy(function(e){r=this.fnSettings.aoColumns[e];a=i.find("table.dataTable thead tr th:nth-child("+(e+1)+"), "+"table.dataTable tfoot tr th:nth-child("+(e+1)+")");if(this.dataTable.column(e).visible()&&r.sWidth){a.width(r.sWidth)}},this))}this.container.parents(".dataTables_wrapper").find("input.paginate_input").bindFirst("keyup",function(e){if(e.which==38||e.which==39||e.which==37||e.which==40){e.stopImmediatePropagation()}});this.container.closest("."+this.options.wrapperClass).css("height","auto")},g=function e(){var t=this.dataTable.page.info().pages+"",i=this.container.parents(".dataTables_wrapper").find(".dataTables_paginate");if(this.options.pagingSelectList===false){this.container.parents(".dataTables_wrapper").find(".dataTables_length").hide()}if(this.options.triggerDraw===true){this.trigger(c.Event(this.EVENTS[5]+"."+this.eventNamespace),this)}if(this.options.triggerDraw===true){this.trigger(c.Event(this.EVENTS[7]+"."+this.eventNamespace),this)}this.options.triggerDraw=true;if(this.options.scrollY!==undefined&&this.options.scrollY!=="0px"){c(this.fnSettings.nScrollBody).height(this.options.scrollY)}this.container.parents(".dataTables_wrapper").find("input.paginate_input").attr("size",t.length);f.apply(this)},m=function e(){if(this.options.responsive===true){this.dataTable.responsive.rebuild();this.dataTable.responsive.recalc()}},v=function e(t){this.trigger(c.Event(this.EVENTS[8]+"."+this.eventNamespace),{datagrid:this,columnElement:t.target,columnIndex:c(t.target).attr("data-column-index")})},y=function e(){var t={class:this.options.wrapperClass};if(window.navigator.userAgent.indexOf("MSIE")>-1&&this.options.rowSelectable){c.extend(t,{onselectstart:"return false"})}return c("<div>",t)},_=function e(){this.trigger(c.Event(this.EVENTS[6]+"."+this.eventNamespace),{datagrid:this,page:this.dataTable.page()})};giscloud.ui.Datagrid=function e(i,n){this.EVENTS=["row-select","row-unselect","data-loaded","row-dblclick","column-data-edit-done","initial-done","page-change","draw-done","header-click","error-loading-data","before-data-loading"];this.eventNamespace="gc-datagrid";this.dataTable=null;this.fnSettings=null;this.container=null;this.colReorder=null;this.initialize=function e(){var t={};if(c.isPlainObject(n)){this.options=c.extend(true,{},a,n)}else if(c.isPlainObject(i)){this.options=c.extend(true,{},a,i)}else{this.options=c.extend(true,{},a)}if(c.isPlainObject(i)){this.container=c(this.options.container)}else{this.container=c(i)}if(this.container===null||!this.container.length){throw"giscloud.ui.Datagrid: invalid container"}if(this.options.url){this.options=c.extend(this.options,{processing:true,serverSide:this.options.serverSide||false,ajax:{url:this.options.url,type:this.options.ajaxType||a.ajax.type,data:c.proxy(function(){return this.options.ajaxData},this)}})}else{delete this.options.ajax}if(this.options.paging&&this.options.perPage){this.options=c.extend(this.options,{pageLength:this.options.perPage||a.perPage});t[this.options.perPagePropName]=this.options.perPage;t[this.options.startPropName]=this.options.page}if(this.options.responsive&&this.options.resizeColumns&&!r.isMobileBrowser){this.options.responsive=false}if(this.options.responsive===false){c.grep(this.options.tableClasses,function(e){return e!=="dt-responsive"})}if(c.isFunction(this.options.getDataCallback)){this.options.fnServerData=this.options.getDataCallback}else if(c.isFunction(this.options.getDataFunction)){this.options.fnServerData=l(this)}else{this.options.fnServerData=c.proxy(s,this)}if(this.options.resizeColumns===true){this.options.dom="Z"+this.options.dom;c.extend(this.options,{scrollX:"100%",colResize:{tableWidthFixed:false,adjustAfterResize:false}});this.container.css("margin","0px")}if(this.options.orderColumns===true){this.options.dom="R"+this.options.dom;this.colReorder=new c.fn.dataTable.ColReorder(this.dataTable)}if(this.options.height){this.options.scrollY="0px";this.options.scrollCollapse=true}if(this.options.orginalOrderBy){t[this.options.orderByPropName]=this.options.orginalOrderBy}this.options.ajaxData=c.extend(this.options.ajaxData,t);this.container.addClass(this.options.tableClasses.join(" "));this.container.wrap(c.proxy(y,this));if(this.options.height){this.container.closest("."+this.options.wrapperClass).height(this.options.height)}r.addEventsInterface(this,this.container);this.dataTable=this.container.DataTable(this.options);this.dataTableObj=this.container.dataTable();this.fnSettings=this.dataTableObj.fnSettings();if(this.options.rowSelectable===true){this.container.closest("."+this.options.wrapperClass).addClass("selectable");this.container.find("tbody").on("click","tr",c.proxy(u,this));if(r.isMobileBrowser){this.container.find("tbody").on("doubletap","tr",c.proxy(h,this))}else{this.container.find("tbody").on("dblclick","tr",c.proxy(h,this))}}c(this.fnSettings.nTableWrapper).on("click","thead th",c.proxy(v,this));this.dataTable.on("xhr.dt",c.proxy(d,this));this.dataTable.on("init.dt",c.proxy(p,this));this.dataTable.on("page.dt",c.proxy(_,this));this.dataTable.on("draw.dt",c.proxy(g,this));if(this.options.ajax===undefined||this.options.ajax.url==null){this.container.trigger("init.dt",[this.fnSettings,{}])}return this};return this.initialize()};giscloud.ui.Datagrid.prototype={refreshData:function e(t,i){if(t){c.extend(this.options.ajaxData,t)}this.dataTable.ajax.reload(null,i);return this},selectAll:function e(){var t={};t.jqEls=this.container.find("tr").addClass("selected");t.allSelectedData=c.map(t.jqEls,c.proxy(function(e){return this.dataTable.row(e).data()},this));return t},unselectAll:function e(){this.container.find("tr.selected").removeClass("selected");return this},toggleSelectAll:function e(){var t;if(this.container.find("tr.selected").length>0){t=this.unselectAll()}else{t=this.selectAll()}return t},select:function e(t){var i={data:[],jqEls:null};if(t===undefined){i.jqEls=this.container.find("tr.selected");i.data=c.map(i.jqEls,c.proxy(function(e){return this.dataTable.row(e).data()},this))}else{i.jqEls=this.container.find("tbody tr:eq("+t+")").trigger("click");i.data=c.map(i.jqEls,c.proxy(function(e){return this.dataTable.row(e).data()},this))}return i},getSelected:function e(t){var i={data:[],jqEls:null},n,r;if(t!==undefined){n=this.dataTable.column(t).dataSrc();if(this.container.find("tr.selected").length>0){r={};r[n]=this.dataTable.cell(this.container.find("tr.selected"),t).data();i.data.push(r)}i.jqEls=c(this.dataTable.cell(this.container.find("tr.selected"),0).node())}else{i.jqEls=this.container.find("tr.selected");i.data=c.map(i.jqEls,c.proxy(function(e){return this.dataTable.row(e).data()},this))}return i},filterView:function e(t){this.dataTable.search(t).draw();return this},searchData:function e(i){var n,t;t=this.dataTable.rows().eq(0).filter(c.proxy(function(t){n=this.dataTable.columns().eq(0).filter(c.proxy(function(e){return this.dataTable.rows().cell(t,e).data()===i?true:false},this));return n.length===0?false:true},this));return this.dataTable.rows(t).data()},editInline:function e(t,o){var l=t,i;if(this.container.has(t)===false||t.get(0).tagName!=="TD"){throw"giscloud.ui.Datagrid: element is not a child of datatable or tag is not TD"}function n(e,t,i){var n,r=t,a,s;if(r===undefined){this.refreshData(null,false);return}s=this.dataTable.cell(l.get(0));if(o){l.data("editInPlace",false)}n={jqEl:l,newValue:r,orgValue:i,rowData:this.dataTable.row(s.index().row).data()};a=c.Event(this.EVENTS[4]);this.trigger(a,n);if(a.result===false){r=s.render("display")}else{s.data(r)}return r}if(l.data("editInPlace")===undefined){i=l.editInPlace({delegate:{shouldCloseEditInPlace:function(e){e.find("input").val(giscloud.xssSafe(e.find("input").val()));return true}},callback:c.proxy(n,this),bg_over:"",bg_out:"",preinit:function(){return l.data("editInPlace")}})}else{l.data("editInPlace",true);i=l}l.on("focusout",n.bind(this));l.trigger("click");return i},finishEditInline:function e(t){t.data("editInPlace",false);if(t!==undefined){t.trigger("focusout")}else{this.container.find("input.inplace_value").trigger("focusout")}return this},setData:function e(t){this.dataTableObj.fnClearTable();this.addData(t);this.draw();return this},addData:function e(t){this.dataTableObj.fnAddData(t);this.dataTableObj.fnDraw();m.apply(this)},pageIndex:function e(t){if(this.options.paging===false){throw"giscloud.ui.Datagrid: no pagination is defined"}if(t===undefined){t=this.dataTable.page.info().page}else{this.dataTableObj.fnPageChange(t)}return t},resetColumnSize:function e(){var t=c(this.fnSettings.nScrollHead).find(".dataTables_scrollHeadInner");if(this.options.scrollX){this.container.css("width","auto");t.css("width","auto");t.find("table.table").css("width","auto")}this.dataTable.columns.adjust().draw(false)},draw:function e(t){if(t){this.options.triggerDraw=t}this.dataTable.draw(false);return this},height:function e(t,i,n){var r=t,a;if(r===undefined){return this.options.scrollY}else{this.options.height=r;if(n===true){if(c(this.fnSettings.nTableWrapper).find(".dataTables_paginate:visible").length>0){r=r-c(this.fnSettings.nTableWrapper).find(".dataTables_paginate").outerHeight(true)}r=r-c(this.fnSettings.nTableWrapper).find(".dataTables_scrollHead").outerHeight(true);r=r-c(this.fnSettings.nTableWrapper).find(".ColVis").outerHeight(true)}this.fnSettings.oScroll.sY=r+"px";this.options.scrollY=r+"px";c(this.fnSettings.nScrollBody).height(r);this.fnSettings.bAjaxDataGet=false;a=this.fnSettings.oScroll.bCollapse=this.options.scrollX&&this.options.scrollY?false:this.fnSettings.oScroll.bCollapse;this.draw(i);m.apply(this);this.fnSettings.oScroll.bCollapse=a;this.fnSettings.bAjaxDataGet=true}return this},width:function e(t,i){if(t!==undefined){this.dataTableObj.width(t);if(i!==false){this.dataTable.columns.adjust()}}return this.dataTableObj.width()},processing:function e(t){if(t==="show"){c(this.fnSettings.nTableWrapper).find(".dataTables_processing").show()}else{c(this.fnSettings.nTableWrapper).find(".dataTables_processing").hide()}return this},getColumnObject:function e(t){return c.grep(this.fnSettings.aoColumns,function(e){return e.idx===t})},clearSort:function e(){this.fnSettings.aaSorting=[];this.fnSettings.aiDisplay.sort(function(e,t){return e-t});this.fnSettings.aiDisplayMaster.sort(function(e,t){return e-t});this.fnSettings.oApi._fnReDraw(this.fnSettings);return this},destroy:function e(t){this.dataTable.destroy(t)}};c.fn.DataTable.ext.errMode="throw";c.fn.bindFirst=function(e,t){var i,n;this.on(e,t);this.each(function(){i=c._data(this,"events")[e.split(".")[0]];n=i.pop();i.splice(0,0,n)});return this}})(giscloud.exposeJQuery(),giscloud.common());(function(m,e){"use strict";var n={viewer:giscloud.ui.map,infotool:null,activeLayerId:null,orderBy:null,setActiveLayerText:"Please set active layer first.",addionalRestParams:{filter_by_expression:true,format:true},useViewerForSelection:false,datagridOpts:{serverSide:true,paging:true,perPage:10,orderColumns:false,lengthChange:false,deferLoading:null,scrollY:"0px",ordering:false,aaSorting:[],pagingSelectList:false,processing:true,scrollCollapse:true,rowSelectable:true,getDataCallback:null,language:{processing:"<p class='gc-grid-load'>Loading...</p>"},rowSelectableOpts:{singleRowSelect:false}}},v=function e(t){throw t||"Error has occurred"},l=function e(t,i,n,r){var a=w.apply(this,[r.sTableId]),s=this.options.activeLayerId,o=this.options.tableName,l=this.options.datasourceId,c=r.iDraw,u=L.apply(this,[a.id]),d={perPage:this.options.datagridOpts.perPage,page:null},h,f="",p;if(o!=null){s=o}if(l!=null){s=l}if(s===null||s===giscloud.ui.FeatureDatagrid.activeLayerConstant.ALL){s=a.id}p=x.apply(this,[s]);d.page=p.dataTable.page()+1;this.trigger(m.Event(this.EVENTS[2]+"."+this.eventNamespace),{layer:a,page:d.page,object:this});if(this.options.addionalRestParams&&m.isPlainObject(this.options.addionalRestParams)){d=m.extend(d,this.options.addionalRestParams)}if(u!=null){d=m.extend(d,{order_by:u})}if(this.options.datagridOpts.ordering){h=m.grep(i,function(e){return e.name==="order"})[0];if(h){m.each(h.value,function(e,t){if(e>0){f+=","}var i=p.getColumnObject(t.column)[0].name;i=i.toLowerCase()=="fid"?"__id":i;f+=i+":"+t.dir})}if(f){d.order_by=f}}var g={oSettings:r,draw:c,fnCallback:n,layer:a,params:d};if(o!=null){giscloud.tables.rows.list(o,d).fail(v).done(m.proxy(b,this,g))}else if(l!=null){giscloud.datasources.data.list(l,d).fail(v).done(m.proxy(b,this,g))}else{y({layerId:s,params:d,callback:m.proxy(_,this,g)})}},y=function e(t){if(t.layerId){giscloud.features.byLayer(t.layerId,t.params).fail(v).done(t.callback)}else if(t.tableName){giscloud.tables.rows.list(t.tableName,t.params).fail(v).done(t.callback)}else if(t.datasourceId){giscloud.datasources.data.list(t.datasourceId,t.params).fail(v).done(t.callback)}},_=function e(t,i,n){var r=h.apply(this,[t.oSettings.sTableId]),a={};r.currentFeatures=i;a.data=C.apply(this,[i]);a=m.extend(a,{recordsTotal:n,recordsDisplay:a.data.length,recordsFiltered:n,draw:t.draw,displayLength:a.data.length});this.trigger(m.Event(this.EVENTS[3]+"."+this.eventNamespace),{layer:t.layer,features:r.currentFeatures,page:t.params.page,object:this});t.fnCallback(a);T.apply(this)},b=function(e,t,i){var n=h.apply(this,[e.oSettings.sTableId]),r={};n.currentFeatures=t.data;i=t.total;r.data=t.data;r=m.extend(r,{recordsTotal:i,recordsDisplay:r.length,recordsFiltered:i,draw:e.draw,displayLength:r.length});this.trigger(m.Event(this.EVENTS[3]+"."+this.eventNamespace),{layer:e.layer,features:n.currentFeatures,page:e.params.page,object:this});e.fnCallback(r);T.apply(this)},o=function e(){if(this.container.find(".tabPanel").is(":visible")===false){this.container.find(".tabPanel").show()}else{this.container.find(".tabPanel").hide()}},r=function e(){var i,t,n=this,r=null,a=1,s={perPage:this.options.datagridOpts.perPage,page:a};if(this.options.addionalRestParams&&m.isPlainObject(this.options.addionalRestParams)){s=m.extend(s,this.options.addionalRestParams)}this.container.find(".tabPanel").remove();this.container.removeClass("manual-layer-selection");this.container.find(".manual-layer-selection-text").remove();if(this.options.addPullTab){m("body").append(this.template.pulltab);this.template.pulltab.append(this.template.pullControls);this.template.pullControls.append(this.template.pulltabIcons);this.container.find(".tabPanel").hide();this.container.addClass("datagrid-drawer");this.container.on("size.gc-datagrid-drawer",m.proxy(o,this)).on("hide.gc-datagrid-drawer",m.proxy(o,this)).on("show.gc-datagrid-drawer",m.proxy(o,this)).on("size.gc-datagrid-drawer",m.proxy(T,this));giscloud.ui.datagridDrawer.init(false,{leaveMapAlone:false,viewer:this.options.viewer,datagridPad:this.container})}if(this.options.tableName!==null&&this.options.tableName!==undefined&&typeof this.options.tableName=="string"){i={id:this.options.tableName,name:"[dummy layer name]"};r=L.apply(n,[i.id]);if(n.options.orderBy!==null&&r!==null){s=m.extend(s,{order_by:r})}y({tableName:this.options.tableName,params:s,callback:m.proxy(function(e,t){this.trigger(m.Event(this.EVENTS[3]+"."+this.eventNamespace),{layer:i,features:e.data,page:a,object:n});p.apply(this,[e.data,M.apply(this,[e]),i,e.total])},this)})}else if(this.options.datasourceId!==null&&this.options.datasourceId!==undefined&&typeof(this.options.datasourceId*1)=="number"){i={id:this.options.datasourceId,name:"[dummy layer name]"};r=L.apply(n,[i.id]);if(n.options.orderBy!==null&&r!==null){s=m.extend(s,{order_by:r})}y({datasourceId:this.options.datasourceId,params:s,callback:m.proxy(function(e,t){this.trigger(m.Event(this.EVENTS[3]+"."+this.eventNamespace),{layer:i,features:e.data,page:a,object:n});p.apply(this,[e.data,M.apply(this,[e]),i,e.total])},this)})}else if(this.options.activeLayerId!==null&&typeof this.options.activeLayerId==="string"&&this.options.activeLayerId.toLowerCase()===giscloud.ui.FeatureDatagrid.activeLayerConstant.MANUAL){p.apply(this,[])}else if(this.options.activeLayerId!==null&&!isNaN(Number(this.options.activeLayerId))){i=this.options.viewer?this.options.viewer.layerById(this.options.activeLayerId):{id:this.options.activeLayerId,name:"[dummy layer name]"};this.trigger(m.Event(this.EVENTS[2]+"."+this.eventNamespace),{layer:i,page:a,object:this});r=L.apply(n,[i.id]);if(n.options.orderBy!==null&&r!==null){s=m.extend(s,{order_by:r})}y({layerId:this.options.activeLayerId,params:s,callback:m.proxy(function(e,t){this.trigger(m.Event(this.EVENTS[3]+"."+this.eventNamespace),{layer:i,features:e,page:a,object:n});p.apply(this,[C.apply(this,[e]),k.apply(this,[e]),i,t])},this)})}else if(this.options.activeLayerId!=null&&this.options.activeLayerId.toLowerCase()===giscloud.ui.FeatureDatagrid.activeLayerConstant.ALL||this.options.activeLayerId===null){this.container.append(this.template.tabPanel.clone());this.container.find(".tabPanel").append(this.template.ulContainer.clone());this.container.find(".tabPanel").append(this.template.tabContent.clone());this.container.on("click","a[data-toggle='tab']",m.proxy(D,this));t=d.apply(this);m.each(t,function(e,t){r=L.apply(n,[t.id]);if(n.options.orderBy!==null&&r!==null){s=m.extend(s,{order_by:r})}else{delete s.order_by}n.trigger(m.Event(n.EVENTS[2]+"."+n.eventNamespace),{layer:i,page:a,object:n});giscloud.features.byLayer(t.id,s).fail(v).done(m.proxy(function(e,t){i=this;n.trigger(m.Event(n.EVENTS[3]+"."+n.eventNamespace),{layer:i,features:e,page:a,object:n});g.apply(n,[e,i,t])},this))})}else{throw"giscloud.ui.FeatureDatagrid: activeLayerId property value unsupported."}},c=function e(t,i){var n=i.datagrid.dataTableObj.fnSettings().sTableId,r=w.apply(this,[n]),a=h.apply(this,[n]),s=null;m.each(a.currentFeatures,function(e,t){if(t.id===i.data.FID){s=t}});if(s!==null&&r!==null&&this.options.viewer){this.options.viewer.bounds(s.bounds);this.viewerSelection.clear();this.viewerSelection.add(s.id,r.id,null,true);this.viewerSelection.highlightSelected()}this.trigger(m.Event(this.EVENTS[0]+"."+this.eventNamespace),{layer:r,feature:s,data:s.data,object:this})},u=function e(t,i){var n=i.datagrid.dataTableObj.fnSettings().sTableId,r=w.apply(this,[n]),a=m.extend({layer:r,object:this},i);this.trigger(m.Event(this.EVENTS[4]+"."+this.eventNamespace),a)},d=function e(){var t=m.grep(this.options.viewer.layers,function(e){return e.sourceType&&e.sourceType.toUpperCase()!=="TILE"});return t},w=function e(i){var n=null;m.each(this.components,function(e,t){if(t.datagrid.fnSettings.sTableId===i){n=t.layer}});return n},h=function e(i){var n=null;m.each(this.components,function(e,t){if(t.datagrid.fnSettings.sTableId===i){n=t}});return n},x=function e(i){var n=null;m.each(this.components,function(e,t){if(t.layer.id===i){n=t.datagrid}});return n},f=function e(){return new RegExp(/[^a-zA-Z\d]/g)},p=function e(t,i,n,r){var a=this.template.datagrid.clone(),s=null,o=giscloud.uuid();if(n!==undefined){s=n.name.replace(f(),"-"),o="gc-dg"+s+"-"+n.id;a.attr("id",o);this.container.append(a);S.apply(this,[t,i,n,o,r])}else{this.container.addClass("manual-layer-selection");this.container.append(this.template.selectLayer.clone().text(this.options.setActiveLayerText))}},g=function e(t,i,n){var r=this.template.liItem.clone(),a=this.template.aItem.clone(),s=this.template.tabPane.clone(),o=this.template.datagrid.clone(),l=i.name.replace(f(),"-"),c="gc-dg"+l+"-"+i.id;r.addClass(l);a.text(i.name).attr("href","#"+l+"-"+i.id).attr("layerid",i.id);r.append(a);if(this.container.find("ul.gc-featuregrid-tabs li").length===0){r.addClass("active");s.addClass("active in active")}o.attr("id",c);s.attr("id",l+"-"+i.id).append(o);this.container.find("ul.gc-featuregrid-tabs").append(r);this.container.find(".tab-content").append(s);S.apply(this,[t,i,c,n])},C=function e(t){var i=[];m.each(t,function(e,t){i.push(m.extend(t.data,{ID:t.id}))});return i},T=function e(){var t=this.container.height()-this.container.find(".gc-featuregrid-tabs").outerHeight(true)-this.container.find(".datagrid-pulltab").outerHeight(true);this.height(t);return t},k=function e(t){var n=[];if(!t||!t.length){return}if(t[0].meta&&t[0].meta.columns){m.each(t[0].meta.columns,function(e,t){var i={title:t.alias||t.field,data:t.alias||t.field,name:t.field,type:t.datatype,sDefaultContent:""};n.push(i)})}else{m.each(t[0].data,function(e){var t={title:e,name:e,data:e,sDefaultContent:""};n.push(t)});n.push({data:"FID",title:"FID",class:"hidden",name:"FID",sDefaultContent:""})}return n},M=function(e){var i=[];m.each(e.data[0],function(e){if(m.inArray(e,["wkb_geometry","__created","__modified","__owner"])>-1){return}var t={title:e,name:e,data:e,sDefaultContent:""};i.push(t)});i.push({data:"FID",title:"FID",class:"hidden",name:"FID",sDefaultContent:""});return i},S=function e(t,i,n,r,a){var s,o;if(!t||t.length===0){this.container.find("#"+r).parent(".tab-pane").addClass("no-data").append(this.template.noData.clone());console.warn("no features for layer "+n.name+" ["+n.id+"]");return}s={columns:i,data:t,deferLoading:a,height:T.apply(this),getDataCallback:m.proxy(l,this)};s=m.extend(this.options.datagridOpts,s);o=new giscloud.ui.Datagrid("#"+r,s);o.on("row-select."+o.eventNamespace,m.proxy(c,this));o.on("header-click."+o.eventNamespace,m.proxy(u,this));this.components.push({datagrid:o,currentFeatures:t,layer:n})},L=function e(i){var n=null,t=this.options.orderBy;if(m.type(t)==="string"){n=this.options.orderBy}else if(m.isArray(this.options.orderBy)===true||m.isPlainObject(this.options.orderBy)===true){if(!m.isArray(this.options.orderBy)){t=[t]}m.each(t,function(e,t){if(!t.orderByLayerId){throw"specific LayerId for specific orderBy is not defined"}if(t.orderByLayerId===i){if(!t.orderByExpression){throw"specific orderByExpression for specific layerid is not defined"}n=t.orderByExpression}})}return n},D=function e(t){var i=m(t.target),n=this.container.find("ul.gc-featuregrid-tabs"),r=i.attr("href");if(i.parent("li").hasClass("active")){return}n.find("li.active").toggleClass("active");i.parent("li").toggleClass("active");this.container.find(".tab-pane.active").toggleClass("active");this.container.find(r).toggleClass("active");m.each(this.components,function(e,t){if(t.datagrid.container.is(":visible")){t.datagrid.resetColumnSize()}});T.apply(this)},a=function e(){if(this.options.useViewerForSelection===true){this.viewerSelection=this.options.viewer.selection}else{this.viewerSelection=new giscloud.ViewerSelection(this.options.viewer)}},t=function e(){},s=function e(){this.options.infotool=giscloud.ui.defaultTools.info({viewer:this.options.viewer}).activate()},j=function e(){this.options.viewer.bind("featureClick",m.proxy(t,this))};giscloud.ui.FeatureDatagrid=function(t,i){this.components=[];this.viewerSelection=null;this.container=null;this.eventNamespace="gc-feature-datagrid",this.EVENTS=["row-select","header-click","reload-before","reload-after","header-click"];this.template={selectLayer:m("<p>",{class:"manual-layer-selection-text"}),ulContainer:m("<ulBinds an event handler.>",{class:"nav nav-tabs gc-featuregrid-tabs"}),liItem:m("<li>",{class:"feat-grid-item"}),aItem:m("<a>",{href:"#","data-toggle":"tab"}),tabPanel:m("<div>",{class:"tabPanel"}),tabPane:m("<div>",{class:"tab-pane fade"}),datagrid:m("<table>"),tabContent:m("<div>",{class:"tab-content"}),pulltab:m("<div>",{class:"datagrid-pulltab hidden-xs non-mobile ui-draggable gc-featuregrid"}),pullControls:m("<div>",{class:"drawer-controls"}),pulltabIcons:[m("<i>",{class:"hidden-mobile drag-handle glyphicon glyphicon-th",title:"Drag to open/close"}),m("<i>",{class:"visible-mobile open-icon  glyphicon glyphicon-arrow-up",title:"Open"}),m("<i>",{class:"hidden-mobile toggle-icon glyphicon glyphicon-arrow-up",title:"Close"}),m("<i>",{class:"visible-mobile close-icon glyphicon glyphicon-arrow-down",title:"Close"})],noData:m("<p>",{class:"no-data-text",text:"No data found"})};this.initialize=function e(){if(m.isPlainObject(t)){this.options=m.extend(true,{},n,t)}else{this.options=i||{};this.options.selector=t;this.options=m.extend(true,{},n,i)}if(m.isPlainObject(t)){this.container=t}else{this.container=m(t)}this.container.addClass("gc-featuregrid");if(this.options.viewer){this.options.viewer.loading.done(m.proxy(a,this)).fail(v);this.options.viewer.loading.done(m.proxy(j,this)).fail(v);this.options.viewer.loading.done(m.proxy(r,this)).fail(v);if(!this.options.infotool){this.options.viewer.loading.done(m.proxy(s,this)).fail(v)}}else{m.proxy(r,this)()}};return this.initialize()};giscloud.ui.FeatureDatagrid.prototype={height:function e(i){if(i===undefined){return this.container.height()}else{m.each(this.components,function(e,t){if(t.datagrid.container.is(":visible")){t.datagrid.height(i,false,true)}})}},setHeight:function e(t){this.height(t)},getSelected:function e(i){if(!i){console.warn("You must specify 'gridId' param.");return}var n=null;m.each(this.components,function(e,t){if(t.layer.id===i){n=t}});return n?n.datagrid.getSelected():null},getActiveLayer:function e(){return viewer.layerById(this.options.activeLayerId)},getActiveLayerId:function e(){return this.options.activeLayerId},setActiveLayerId:function e(t){var i;if(m.isNumeric(t)===false&&t!==giscloud.ui.FeatureDatagrid.activeLayerConstant.MANUAL&&t!==giscloud.ui.FeatureDatagrid.activeLayerConstant.ALL){throw"giscloud.ui.FeatureDatagrid: layerid or featuregrid constants is not passed."}this.options.activeLayerId=t;m.each(this.components,m.proxy(function(e,t){i=t.datagrid.container;t.datagrid.destroy(true)},this));this.components=m.grep(this.components,function(e){return i!==e.datagrid.container});r.apply(this);return this},redrawComponent:function e(){m.each(this.components,m.proxy(function(e,t){t.datagrid.destroy(true)},this));this.components=[];this.container.find("ul.gc-featuregrid-tabs").empty();this.container.find(".tab-content").empty();r.apply(this);return this},setActiveLayer:function e(t){if(t.id===undefined&&t!==giscloud.ui.FeatureDatagrid.activeLayerConstant.MANUAL&&t!==giscloud.ui.FeatureDatagrid.activeLayerConstant.ALL){throw"giscloud.ui.FeatureDatagrid: layer object or featuregrid constants is not passed."}return this.setActiveLayerId(t.id||t)},refreshData:function e(t,i){var n;if(t){n=x.apply(this,[t]);n.refreshData()}else{m.each(this.components,m.proxy(function(e,t){t.datagrid.refreshData(null,i)},this))}return this},getOrderBy:function e(t){var i=this.options.orderBy;if(t){i=L.apply(this,[t])}return i},setOrderBy:function e(t,i){var n=false,r=this.options.orderBy,a;if(m.type(t)==="string"){this.options.orderBy=t}else if(m.isArray(t)===true||m.isPlainObject(t)===true){if(!m.isArray(t)){t=[t]}if(!m.isArray(r)){r=[r]}m.each(t,m.proxy(function(e,t){a=t;m.each(r,function(e,t){if(t.orderByLayerId===a.orderByLayerId){t.orderByExpression=a.orderByExpression;n=true}});if(!n){r.push(a)}},this))}if(i){this.refreshData()}return this}};function i(e){return e.container}e.addEventsInterface(giscloud.ui.FeatureDatagrid.prototype,i);giscloud.ui.FeatureDatagrid.activeLayerConstant={};giscloud.ui.FeatureDatagrid.activeLayerConstant.MANUAL="manual";giscloud.ui.FeatureDatagrid.activeLayerConstant.ALL="all"})(giscloud.exposeJQuery(),giscloud.common());(function(p,l){"use strict";var c={container:null,datasources:{types:null,options:null},actions:[],filter:true,modal:{width:800,overlay:false,escClose:true,draggable:true,privateButtons:true,buttons:[{class:"btn btn-default gc-datasourcebrowser-cancel-button",html:l.__("Cancel")},{class:"btn btn-primary gc-datasourcebrowser-ok-button",html:l.__("OK")}]},datagrid:{serverSide:true,paging:true,perPage:10,orderColumns:false,lengthChange:false,deferLoading:null,scrollY:370,ordering:false,aaSorting:[],resizeColumns:false,pagingSelectList:false,processing:true,scrollCollapse:true,rowSelectable:true,getDataCallback:null,rowSelectableOpts:{singleRowSelect:false},columns:[{data:"id",title:"ID",name:"id"},{data:"name",title:"Name",name:"name"},{data:"type",title:"Type",name:"type"}]}};function g(n,r,a){p.each(a.data,function(i,e){var t=p.grep(e.options||[],n);p.each(t,function(e,t){a.data[i][t.option_name]=t.option_value});p.each(r,function(e,t){if(a.data[i][t]==null){a.data[i][t]=null}})});return a}function u(f){return function e(t){var i,n,r,a,s,o,l,c,u,d,h={perPage:t.options.perPage,page:t.dataTable?t.dataTable.page()+1:1};if(f.options.datasources&&f.options.datasources.types){if(!p.isArray(f.options.datasources.types)){i=[f.options.datasources.types]}else{i=f.options.datasources.types}h.type=i.join(",")}if(f.options.datasources&&f.options.datasources.options&&f.options.datasources.options.length){h.expand="options"}if(f.filter&&f.filter.value){l=f.filter.index;c=f.filter.type;u=f.filter.field;d=f.filter.value;if(c==="custom"){o=f.filter.options.columns[l].data;h=p.extend({},h,o.call(f,d))}else if(c==="option"){h.where_option=u+"="+d}else{if(u==="type"){h.query=giscloud.datasources.typeNameToTypeCode(d)}else{h.query=d.replace(/\s+/g,"%")}h.query_on=u}}if(f.options.rest){p.each(f.options.rest,function(e,t){if(h[e]==null){h[e]=t}})}r=giscloud.datasources.list(h);if(h.expand==="options"){if(!p.isArray(f.options.datasources.options)){s=f.options.datasources.options;a=function e(t){return t.option_name===s};n=[f.options.datasources.options]}else if(f.options.datasources.options.length===1){s=f.options.datasources.options[0];a=function e(t){return t.option_name===s};n=f.options.datasources.options}else{s=new RegExp("^("+f.options.datasources.options.join("|")+")$");a=function e(t){return s.test(t.option_name)};n=f.options.datasources.options}r=r.then(p.proxy(g,this,a,n))}r=r.then(function e(i){p.each(i.data,function(e,t){if("type"in t){i.data[e].type=giscloud.datasources.typeCodeToTypeName(t.type)}});return i});return r}}function d(e){var t;if(!e.options.datasources||!e.options.datasources.options){return(e.options||c).datagrid.columns}if(typeof e.options.datasources.options==="string"){t=[e.options.datasources.options]}else{t=e.options.datasources.options}return(e.options||c).datagrid.columns.concat(p.map(t,function(e){return{data:e,title:e,name:e}}))}function i(e,t){var i=p(t.target).data("action"),n,r;t.preventDefault();if(!i||!p.isFunction(i.action)){return}n=i.context||window;if(i.params!=null){if(p.isArray(i.params)){r=[e].concat(r)}else{r=[e,r]}}else{r=[e]}i.action.apply(n,r)}function h(e,t){return p("<a/>",{href:"#",click:p.proxy(i,e,e),text:t.title||t.name||"&nbsp;",class:"btn btn-default gc-datasourcebrowser-action-button"}).prepend(t.icon&&p("<i/>",{class:t.icon})).data("action",t)}function f(e,t,i){if(i.which===13){v(e,t)}}function m(e,t){if(t.container.data("gc-datasourcebrowser-result")){e.resolve(t.selected())}else{e.reject()}t.destroy()}function v(e,t){t.container.data("gc-datasourcebrowser-result",true);if(t.modal){t.modal("hide")}}function y(e,t){if(t.modal){t.modal("hide")}}function _(e){e.datagrid.dataTable.page(0);e.refresh()}function e(e){return e.container}function s(e){e.stopPropagation();p(e.target).change()}function o(e){e.stopPropagation()}function b(e,t){var i=t.container.find(".gc-datasourcebrowser-filter-input").val(),n=t.container.find(".gc-datasourcebrowser-filter-select").val().split(":"),r=(t.value||"")!==i;t.value=i;t.type=n[0],t.field=n[1];t.index=t.container.find(".gc-datasourcebrowser-filter-select option:selected").data("index");if(r||i&&r){t.refresh()}}function w(e){return{selected:e[0].name,columns:p.map(e,function e(t){return{type:t.type||"field",name:t.data||t.name,title:t.title||t.name}})}}function x(e,t){var i,n,r,a=this;if(!e.options.filter){return null}if(!p.isPlainObject(e.options.filter)){this.options=w(e.options.datagrid.columns)}else{this.options=p.extend(true,{},e.options.filter)}if(!t){this.container=p("<div/>",{class:"form-inline gc-datasourcebrowser-filter-container"})}else{this.container=p(t).addClass("gc-datasourcebrowser-filter-container")}i=p("<input/>",{type:"text",placeholder:l.__("Filter"),class:"form-control gc-datasourcebrowser-filter-input",change:l.debounce(b,500,this,this),keydown:s,keypress:o,keyup:o}).appendTo(this.container);n=p("<select/>",{class:"form-control gc-datasourcebrowser-filter-select",change:function e(){var t=Array.prototype.slice.apply(arguments).concat(a);b.apply(a,t)}}).appendTo(this.container);n.append(p.map(this.options.columns,function e(t,i){var n=(t.type||"field")+":"+t.name,r=!!(t.selected||t.name===a.options.selected);return p("<option>",{value:n,text:t.title||t.name}).data("index",i).prop("selected",r)}));if(n.find("option:selected").length===0){if(this.options.selected){n.find("option[value$="+giscloud.escapeSelector(this.options.selected)+"]").prop("selected",true)}else{n.find("option").first().prop("selected",true)}}if(this.options.defaultValue!=null){i.val(this.options.defaultValue);this.value=this.options.defaultValue;r=n.find("option:selected").val();r=r.split&&r.split(":");if(r){this.type=r[0];this.field=r[1]}}}x.prototype={refresh:function e(){var t=p.Event("filterChange.gc-datasourcebrowser",{field:this.field,type:this.fieldType,value:this.value,filter:this});this.trigger(t)},destroy:function e(){if(this.container){this.container.empty();this.container=null}this.field=null;this.fieldType=null;this.value=null;this.options=null}};l.addEventsInterface(x.prototype,e);giscloud.ui.DatasourceBrowser=function e(t,i){var n,r,a=c.modal.buttons,s=c.datagrid.columns,o=p.extend(true,{},c);delete o.modal.buttons;delete o.datagrid.columns;if(!(this instanceof giscloud.ui.DatasourceBrowser)){return new giscloud.ui.DatasourceBrowser(t,i)}n=new p.Deferred;p.extend(this,n.promise());if(p.isPlainObject(i)){this.options=p.extend(true,{},o,i)}else if(p.isPlainObject(t)){this.options=p.extend(true,{},o,t)}else{this.options=o}if(!this.options.modal.buttons){this.options.modal.buttons=a}if(!this.options.datagrid.columns){this.options.datagrid.columns=s}if(p.isPlainObject(t)){if(this.options.container){this.container=p(this.options.container);if(this.container===null||!this.container.length){throw"giscloud.ui.DatasourceBrowser: invalid container"}}}else{if(t!=null){this.container=p(t);if(this.container===null||!this.container.length){throw"giscloud.ui.DatasourceBrowser: invalid container"}}}if(this.container==null){this.options.modal.title=this.options.title||l.__("Datasources");r=giscloud.ui.modal(this.options.modal);this.container=r.find(".modal-body");this.modal=p.proxy(r.modal,r);r.on("hide.bs.modal",p.proxy(m,window,n,this)).on("keydown",p.proxy(f,window,n,this)).on("click",".gc-datasourcebrowser-ok-button",p.proxy(v,window,n,this)).on("click",".gc-datasourcebrowser-cancel-button",p.proxy(y,window,n,this))}this.container.addClass("gc-datasourcebrowser-container");this.datagridContainer=p("<div/>",{class:"gc-datasourcebrowser-datagrid-container"});this.datagridTable=p("<table/>",{class:"gc-datasourcebrowser-datagrid-table"}).appendTo(this.datagridContainer);this.datagridContainer.append(this.datagridTable);this.container.append(this.datagridContainer);this.filterContainer=p("<div/>",{class:"form-inline"});this.filter=new x(this,this.filterContainer);if(this.filter){this.filter.on("filterChange.gc-datasourcebrowser",p.proxy(_,window,this))}else{this.filterContainer.hide()}this.options.datagrid.getDataFunction=u(this);this.options.datagrid.columns=d(this);this.datagrid=new giscloud.ui.Datagrid(this.datagridTable,this.options.datagrid);this.datagrid.on("row-dblclick.gc-datagrid",l.debounce(function e(t,i,n,r){v(n,r)},300,window,[n,this]));this.filterContainer.appendTo(this.datagridContainer.find(".dataTables_wrapper"));this.actionsContainer=p("<div/>",{class:"gc-datasourcebrowser-actions-container"});this.actionsContainer.append(p.map(this.options.actions||[],p.proxy(h,this,this)));this.container.prepend(this.actionsContainer);return this};giscloud.ui.DatasourceBrowser.defaultOptions=c;giscloud.ui.DatasourceBrowser.prototype={destroy:function e(){if(this.filter){this.filter.destroy();this.filter=null}if(this.datagrid){this.datagrid.destroy(this.datagridTable[0]);this.datagrid=null;this.datagridTable=null;this.datagridContainer=null}if(this.container){this.container.removeClass("gc-datasourcebrowser-container").empty();this.container=null}return this},close:function e(){this.container.on("hide.bs.modal",p.proxy(this.destroy,this));this.modal("hide")},refresh:function e(){if(!this.datagrid){throw"Not yet initialized."}this.datagrid.draw();return this},selected:function e(){return this.datagrid.getSelected().data}};l.addEventsInterface(giscloud.ui.DatasourceBrowser.prototype,e)})(giscloud.exposeJQuery(),giscloud.common());(function(i,n){"use strict";var r={container:null,autoAddLayer:false,modal:{url:"/filemanager/form_upload",overlay:false,allowHide:true,escClose:true,closeButton:true,draggable:true}},a,s,o,l,c={},u=false;function d(){var r=formManager.get("uploadform")?formManager.get("uploadform").options.data.uploadDir:"/";i("#fileupload").fileupload({formData:{uploadDir:r},singleFileUploads:true,url:fno.liveSite+"upload",autoUpload:true}).bind("fileuploadstart",function(){s=[];o=[];l={}}).bind("fileuploadstop",function(){var e=i.map(o,function e(t){return i.isArray(t)?i.map(t,e):t});giscloud.ui.upload.trigger("completedAll.gc-ui-upload",[s,e])}).bind("fileuploadadd",function(){if(c.options.autoAddLayer&&gcproject.hasOpenProject()){i("#fileupload").fileupload({formData:{map_id:currentMapID,uploadDir:giscloud.ui.upload.options.uploadDir}})}i(".fileupload-buttonbar .start, .fileupload-buttonbar .cancel").show()}).bind("fileuploaddone",function(e,t){var i,n=t.result.files&&t.result.files.length?t.result.files[0]:null;u=false;i=l[n.name];if(i){return}l[n.name]=e.timeStamp;if(n){n.extension=n.name.substr(n.name.lastIndexOf(".")+1);n.path=r;s.push(n);giscloud.log.push("filemanager_upload",{filename:n.name,source:t.formData.uploadDir,draganddrop:t.result.layers?"yes":"no"});if(t.result.layers){o.push(t.result.layers)}}giscloud.ui.upload.trigger("completed.gc-ui-upload",t.result.files)}).bind("fileuploadprogress",function(){u=true});i(".fileupload-buttonbar .start, .fileupload-buttonbar .cancel").hide();i(".fileupload-buttonbar .cancel").click(function(){i(".fileupload-buttonbar .start, .fileupload-buttonbar .cancel").hide()});i("#fileupload").fileupload("option","redirect",window.location.href.replace(/\/[^\/]*$/,"/cors/result.html?%s"))}function t(){i("#fileupload .files").empty();i(".fileupload-buttonbar .start, .fileupload-buttonbar .cancel").hide()}function e(){return c.container}c=giscloud.ui.upload={initialize:function(e){var t;if(this.initialized){return giscloud.ui.upload}if(i.isPlainObject(e)){c.options=i.extend(true,{},r,e)}else{c.options=i.extend(true,{},r)}c.options.uploadDir=c.options.uploadDir||"/";i(".gc-uploadform-container").remove();a=new n.uploadOverlay(i("body"));if(window.formManager&&formManager.open){giscloud.ui.upload.form=formManager.open({show:false,overlay:false,closeButton:true,closeButtonCallback:"giscloud.ui.upload.hide();",bootstrap:true,draggable:true,fid:"uploadform",width:"auto",height:"auto",allowHide:true,phoneFullSc:true,title:gclang.js.uploadnewto+" '"+c.options.uploadDir+"'",url:fno.liveSite+"filemanager/form_upload",data:{currentDir:"",uploadDir:c.options.uploadDir},buttons:[{click:"giscloud.ui.upload.hide();",html:n.__("Close")}]}).hide();t=giscloud.ui.upload.form.container;c.container=t;c.modal=i.proxy(t.modal,t);t.on("loaded",i.proxy(d,c))}else{console.warn("Not implemented yet")}c.container.addClass("gc-uploadform-container");this.initialized=true;return giscloud.ui.upload},path:function(e){i("#fileupload").fileupload({formData:{uploadDir:e}});giscloud.ui.upload.form.setTitle(gclang.js.uploadnewto+" '"+e+"'")},enabled:function(){var e=!fno.gcinit_auth.logged||!(fno.app_instance_type==="mapeditor");return!e},dragAndDropActive:function(){return this.enabled()&&a.support()},accept:function(e){a.accept(e)},message:function(e){a.setMessage(e)},isVisible:function(){var e=formManager.get("uploadform");return e&&e.state==="maximized"},show:function(e){if(!c.container){return}formManager.show("uploadform");if(!u){t()}if(e&&e.uploadDir){giscloud.ui.upload.path(e.uploadDir)}giscloud.ui.upload.modal("show");return giscloud.ui.upload},hide:function(){if(!c.container){return}if(a)a.hide();formManager.hide("uploadform");return giscloud.ui.upload}};giscloud.ui.upload.defaultOptions=r;n.addEventsInterface(giscloud.ui.upload,e,"gc-upload")})(giscloud.exposeJQuery(),giscloud.common());(function(a,s,e,o){e.uploadOverlay=function(t){var r=this,i,n=true;this.init=function(e){if(!r.support())return false;i=["Drop your files to upload to GIS Cloud"];if(s(".gc-drag-n-drop-strip").length==0){s("<div class='gc-drag-n-drop-strip gc-drag-n-drop-strip-top' ></div>").appendTo(t);s("<div class='gc-drag-n-drop-strip gc-drag-n-drop-strip-bottom' ></div>").appendTo(t);s("<div class='gc-drag-n-drop-strip gc-drag-n-drop-strip-left' ></div>").appendTo(t);s("<div class='gc-drag-n-drop-strip gc-drag-n-drop-strip-right' ></div>").appendTo(t)}t.bind({dragover:function(e){r.dropZoneEnter(e);return false},dragleave:function(e){r.dropZoneLeave(e)},dragend:function(e){r.dropZoneLeave(e,true);return false},drop:function(e){r.hide()}})};this.setMessage=function(e){i[0]=e};this.support=function(){var e=!giscloud.ui.upload.enabled()||user.options.DRAG_AND_DROP!==o&&user.options.DRAG_AND_DROP==0;return!e&&!!a.FormData&&"upload"in new XMLHttpRequest};this.accept=function(e){n=e};this.dragContainsFile=function(e){if(e&&e.originalEvent.dataTransfer.types){for(var t=0;t<e.originalEvent.dataTransfer.types.length;t++){if(e.originalEvent.dataTransfer.types[t]=="Files"){return true}}}return false};this.dropZoneEnter=function(e){if(a.checkIfUserExceedsStorageLimits&&a.checkIfUserExceedsStorageLimits()){return s("#showStorageForbiddenMsg").length===0?a.showStorageForbiddenMsg():null}if(!this.dragContainsFile(e)||giscloud.ui.edit.isActive()){return}t.trigger("dropzoneenter",[e]);if(n){r.wasOpen=formManager.isSourceBrowserOpen();giscloud.ui.upload.initialize().show();this.dropZoneGreen()}else{this.dropZoneRed()}this.show();giscloud.ui.alert.show(i[0])};this.dropZoneLeave=function(e,t,i){if(!t&&!r.dragContainsFile(e)){return}if(t||e.originalEvent.screenX==0&&e.originalEvent.screenY==0){var n=formManager.isSourceBrowserOpen();if(!n||r.wasOpen)giscloud.ui.upload.hide();s(".gc-drag-n-drop-strip").removeClass("hover");if(!i)giscloud.ui.alert.hide()}};this.dropZoneRed=function(e,t){s(".gc-drag-n-drop-strip").addClass("red");giscloud.ui.alert.color("red")};this.dropZoneGreen=function(e,t){s(".gc-drag-n-drop-strip").removeClass("red");giscloud.ui.alert.color("green")};this.show=function(e){s(".gc-drag-n-drop-strip").addClass("hover")};this.hide=function(){s(".gc-drag-n-drop-strip").removeClass("hover");giscloud.ui.alert.hide()};this.init()}})(window,giscloud.exposeJQuery(),giscloud.common());(function(window,$,common,undefined){giscloud.help=function(){if(giscloud.help.def)return showHelp(giscloud.help.def.giscloud);return""};giscloud.help.ignore=[];giscloud.help.category=[];giscloud.help.objects=[];giscloud.help.namespaces={};function findCategory(e){var t=giscloud.help.category;for(var i in t){if(!t.hasOwnProperty(i))continue;if(i.indexOf("*")>0){var n=new RegExp(i);if(e.match(n)){return t[i]}}}if(t[e])return t[e]}var classes=[];function listApi(root,parent){var objects=giscloud.help.objects;var ignore=giscloud.help.ignore;var namespaces=giscloud.help.namespaces;var category=giscloud.help.category;var output={};output.category=findCategory(root);try{eval('var desc = giscloud.help.def["'+root+'"].desc');output.desc=desc}catch(e){}try{eval('var fiddle = giscloud.help.def["'+root+'"].fiddle');if(fiddle)output.fiddle=fiddle}catch(e){}try{eval('var disabled = giscloud.help.def["'+root+'"].disabled');if(disabled)output.disabled=true}catch(e){}if(!output.desc){output.desc=""}var s=[];var def=[];var types=[];var property_ref=[];var ns;try{ns=eval(root)}catch(e){return""}var nextlevel=[];var methods=[];var methods_map={};var properties=[];var properties_map=[];var events={};try{eval("var _example = giscloud.help.def['"+root+"']._example");output._example=_example}catch(e){}for(var j=1;j<10;j++){try{eval("var _example"+j+" = giscloud.help.def['"+root+"']._example"+j);eval("output._example"+j+" = _example"+j)}catch(e){}}try{eval("var events = giscloud.help.def['"+root+"']._events");if(events){output._events=events}}catch(e){console.log(e)}for(var l=1;l<20;l++){try{eval("var events"+l+" = giscloud.help.def['"+root+"']._events"+l);eval("output._events"+l+" = events"+l)}catch(e){console.log(e)}}for(var i in ns){if(!ns.hasOwnProperty(i))continue;if(typeof ns[i]=="function"){if(i[0]===i[0].toUpperCase()){if(ignore[root+"."+i])continue;classes.push({ref:ns[i],name:root+"."+i});s.push(root+"."+i);def[root+"."+i]=[];if(objects[root+"."+i]){obj=objects[root+"."+i]}else{try{obj=new ns[i]({})}catch(e){console.log("error ",root+"."+i)}}for(var p in obj){def[root+"."+i].push(p);types[root+"."+i+"."+p]={type:typeof obj[p],ref:obj[p]}}def[root+"."+i].sort()}}}s.sort();for(var i=0;i<s.length;i++){var name=s[i];var name_def='["'+name.substr(0,name.lastIndexOf("."))+'"]'+name.substr(name.lastIndexOf("."));var cl={class:name};var p=def[s[i]];try{eval("var desc = giscloud.help.def"+name_def+".desc");cl.desc=desc}catch(e){}try{eval("var fiddle = giscloud.help.def"+name_def+".fiddle");if(fiddle)cl.fiddle=fiddle}catch(e){}try{eval("var disabled = giscloud.help.def"+name_def+".disabled");if(disabled)cl.disabled=true}catch(e){}if(!cl.desc){cl.desc=""}cl.category=findCategory(name);try{eval("var _example = giscloud.help.def"+name_def+"._example");cl._example=_example}catch(e){}for(var j=1;j<10;j++){try{eval("var _example"+j+" = giscloud.help.def"+name_def+"._example"+j);eval("cl._example"+j+" = _example"+j)}catch(e){}}try{eval("var events = giscloud.help.def"+name_def+"._events");if(events){cl._events=events}}catch(e){console.log(e)}for(var l=1;l<20;l++){try{eval("var events"+l+" = giscloud.help.def"+name_def+"._events"+l);eval("cl._events"+l+" = events"+l)}catch(e){console.log(e)}}cl._constructor={params:"",usage:"",desc:""};try{eval("var _constructor = giscloud.help.def"+name_def+"._constructor");if(_constructor.params)cl._constructor.params=_constructor.params;if(_constructor.usage)cl._constructor.usage=_constructor.usage;if(_constructor.desc)cl._constructor.desc=_constructor.desc;if(_constructor.fiddle)cl._constructor.fiddle=_constructor.fiddle;if(_constructor.disabled)cl._constructor.disabled=_constructor.disabled}catch(e){}for(var j=0;j<p.length;j++){if(types[s[i]+"."+p[j]].type=="function"){if(ignore[s[i]+"."+p[j]])continue;var m={};try{eval("var desc = giscloud.help.def"+name_def+"._methods."+p[j]);m.params=desc.params;m.returns=desc.returns;m.desc=desc.desc;if(desc.fiddle)m.fiddle=desc.fiddle;if(desc.disabled)m.disabled=desc.disabled}catch(e){m.params="";m.returns="";m.desc=""}if(!cl._methods)cl._methods={};cl._methods[p[j]]=m}}for(var j=0;j<p.length;j++){if(types[s[i]+"."+p[j]].type!="function"){if(ignore[s[i]+"."+p[j]])continue;var type=types[s[i]+"."+p[j]];var property={ref:type.ref};try{eval("var desc = giscloud.help.def"+name_def+"._properties."+p[j]);property.type=desc.type;property.desc=desc.desc;if(desc.fiddle)property.fiddle=desc.fiddle;if(desc.disabled)property.disabled=desc.disabled}catch(e){property.type="";property.desc=""}if(!cl._properties)cl._properties={};cl._properties[p[j]]=property}}output[name.substr(name.lastIndexOf(".")+1)]=cl}for(var i in ns){if(!ns.hasOwnProperty(i))continue;if(typeof ns[i]=="function"){if(i[0]!=i[0].toUpperCase()){if(ignore[root+"."+i])continue;m={};try{eval('var desc = giscloud.help.def["'+root+'"]._methods.'+i);m.params=desc.params;m.returns=desc.returns;m.desc=desc.desc;if(desc.fiddle)m.fiddle=desc.fiddle;if(desc.disabled)m.disabled=desc.disabled}catch(e){m.params="";m.returns="";m.desc=""}methods_map[i]=m;methods.push(i)}}else if(giscloud.help.include_namespace[root+"."+i]){if(ignore[root+"."+i])continue;nextlevel.push(root+"."+i)}else{if(ignore[root+"."+i]||ignore[root+"._properties"])continue;var property={};try{eval('var desc = giscloud.help.def["'+root+'"]._properties.'+i);property.type=desc.type;property.desc=desc.desc;if(desc.fiddle)property.fiddle=desc.fiddle;if(desc.disabled)property.disabled=desc.disabled}catch(e){property.type="";property.desc=""}properties_map[i]=property;properties.push(i)}}namespaces[root]=output;nextlevel.sort();for(var i=0;i<nextlevel.length;i++){listApi(nextlevel[i],output)}methods.sort();properties.sort();if(methods.length>0){output._methods={};for(var i=0;i<methods.length;i++){output._methods[methods[i]]=methods_map[methods[i]]}}if(properties.length>0){output._properties={};for(var i=0;i<properties.length;i++){output._properties[properties[i]]=properties_map[properties[i]]}}}function generateCharSpace(e,t){var i="";for(var n=0;n<t;n++)i+=e;return i}function makeMultiLine(e,t,i){var n="";var r=e;var a=0;while(r.length+a>t){while(e.length+a>t){e=e.substr(0,e.lastIndexOf(" "))}if(n){n+="\n"+generateCharSpace(" ",i+3)}n+=e;r=r.substr(e.length);e=r;a=i}if(n){n+="\n"+generateCharSpace(" ",i+3)}n+=r;return n}function formatMethod(e,t,i,n){var r=t.params||"";var a=t.desc||"";var s="\t"+e+generateCharSpace(" ",i-e.length)+r+generateCharSpace(" ",n-r.length)+a;return makeMultiLine(s,100,i+n)+"\n"+generateCharSpace(" ",4)+generateCharSpace("-",100)+"\n"}function showHelp(e){var t="\n";if(e._example){t+="Example:\n\n";t+=e._example;t+="\n"}if(e._methods){t+="Methods:\n\n";var i=0;var n=0;for(var r in e._methods){if(r.length>i)i=r.length;if(e._methods[r].params&&e._methods[r].params.length>n)n=e._methods[r].params.length}i+=3;n+=3;for(var r in e._methods){t+=formatMethod(r,e._methods[r],i,n)}}var a="";for(var r in e){if(r[0]!="_"&&r[0]===r[0].toUpperCase()){if(!a){a+="Classes:\n\n"}a+="\t"+r+"\n"}}t+=a;return t}function findHelpItem(root,ns,n){if(n>5)return;for(var i in root){if(!root.hasOwnProperty(i))continue;if(i[0]=="_"||i=="category")continue;if(root[i]._methods&&ns+i!="giscloud"){var obj="";if(root[i]["class"])obj='["'+ns.substr(0,ns.length-1)+'"].'+i;else obj='["'+ns+i+'"]';try{eval(ns+i+".help = function() { return showHelp(giscloud.help.def"+obj+"); }")}catch(e){}}var t=typeof root[i];var k=n;if(!k)k=0;findHelpItem(root[i],ns+i+".",k+1)}}function findClassType(e){for(var t=0;t<classes.length;t++){if(e instanceof classes[t].ref){return classes[t].name}}return null}giscloud.help.load=function(){giscloud.includeJs("/assets/api/1/help.def.js",function(){findHelpItem(giscloud.help.def,"")})};giscloud.help.write=function(format){giscloud.includeJs("/assets/api/1/help.def.js",function(){giscloud.help.init();listApi("giscloud");for(var i in giscloud.help.namespaces){var ns=giscloud.help.namespaces[i];for(var p in ns._properties){eval("var property = "+i+"."+p+";");var type=findClassType(property);if(type)ns._properties[p].type=type}for(var k in ns){if(!ns[k]||!ns[k]["class"])continue;var cl=ns[k];for(var p in cl._properties){var type=typeof cl._properties[p].ref;if(type!="undefined"){var gc_type=findClassType(cl._properties[p].ref);if(gc_type){cl._properties[p].type=gc_type}else{type=type[0].toUpperCase()+type.slice(1);cl._properties[p].type=type}}delete cl._properties[p].ref}}}var url;if(format=="markdown"||format=="md"){url="/modules_gc/utils/write-jsapi-docs-md.php"}else{url="/modules_gc/utils/write-jsapi-docs.php"}jQuery.ajax({type:"POST",url:url,processData:false,contentType:"application/json",data:JSON.stringify(giscloud.help.namespaces),dataType:"json",success:function(e){if(e&&e.msg)console.error("error!",e.msg);else console.log("done!")}})})};giscloud.help.stats=function(){giscloud.includeJs("/assets/api/1/help.def.js",function(){var e=0;var t=0;var i=0;var n=0;for(var r in giscloud.help.def){var a=giscloud.help.def[r];if(a._methods){for(var s in a._methods){var o=a._methods[s];e++;if(o.desc)t++;else console.log("method",s)}}if(a._properties){for(var s in a._properties){var o=a._properties[s];i++;if(o.desc)n++;else console.log("property",s)}}for(var l in a){if(!a[l]["class"])continue;for(var s in a[l]._methods){var o=a[l]._methods[s];e++;if(o.desc)t++;else console.log("method",l,s)}for(var s in a[l]._properties){var o=a[l]._properties[s];i++;if(o.desc)n++;else console.log("property",l,s)}}}console.log("Total methods: "+e+" (defined "+t+", "+Math.round(t/e*100)+"%)");console.log("Total properties: "+i+" (defined "+n+", "+Math.round(n/i*100)+"%)")})};giscloud.help.init=function(){var e=giscloud.help.ignore=[];var t=giscloud.help.category=[];var i=giscloud.help.objects=[];var n=giscloud.help.include_namespace={};giscloud.help.namespaces={};classes=[];n["giscloud"]=1;n["giscloud.address"]=1;n["giscloud.addressmodels"]=1;n["giscloud.bookmarks"]=1;n["giscloud.datasources"]=1;n["giscloud.datasources.wms"]=1;n["giscloud.date"]=1;n["giscloud.features"]=1;n["giscloud.formats"]=1;n["giscloud.formats.exportFormats"]=1;n["giscloud.formats.renderFormats"]=1;n["giscloud.forms"]=1;n["giscloud.geometry"]=1;n["giscloud.geoutils"]=1;n["giscloud.keys"]=1;n["giscloud.resources"]=1;n["giscloud.layers"]=1;n["giscloud.layers.attributeOps"]=1;n["giscloud.maps"]=1;n["giscloud.oauth2"]=1;n["giscloud.options"]=1;n["giscloud.permissions"]=1;n["giscloud.proxy"]=1;n["giscloud.rest"]=1;n["giscloud.search"]=1;n["giscloud.spatialrelationship"]=1;n["giscloud.tables"]=1;n["giscloud.tables.rows"]=1;n["giscloud.tasks"]=1;n["giscloud.ui"]=1;n["giscloud.ui.alert"]=1;n["giscloud.ui.columns"]=1;n["giscloud.ui.dataGrid"]=1;n["giscloud.ui.edit"]=1;n["giscloud.ui.layerList"]=1;n["giscloud.ui.selectExtent"]=1;n["giscloud.userOptions"]=1;n["giscloud.ui.defaultTools"]=1;n["giscloud.ui.customForm"]=1;n["giscloud.ui.search"]=1;n["giscloud.users"]=1;n["giscloud.files"]=1;e["giscloud.Html5Map"]=1;e["giscloud.Events"]=1;e["giscloud.ui.Datagrid"]=1;e["giscloud.ui.DatasourceBrowser"]=1;e["giscloud.ui.FILESilterBuilder"]=1;e["giscloud.ui.FilterBuilder"]=1;e["giscloud.ui.FilterBuilderManager"]=1;e["giscloud.ui.LayerFilterForm"]=1;e["giscloud.Html5MapSetSelection"]=1;e["giscloud.help.write"]=1;e["giscloud.wms"]=1;e["giscloud.datasources.apollo"]=1;e["giscloud.ui.apollo"]=1;e["giscloud.html5ResetLoaders"]=1;e["giscloud.Html5MapRefreshUrls"]=1;e["giscloud.gravatar"]=1;e["giscloud.ddupload"]=1;e["giscloud.construct"]=1;e["giscloud.contextMenu"]=1;e["giscloud.log"]=1;e["giscloud.logDeferredResults"]=1;e["giscloud.md5"]=1;e["giscloud.Layer.offscale"]=1;e["giscloud.Layer.onscale"]=1;e["giscloud.Layer.grp"]=1;e["giscloud.Layer.raster"]=1;e["giscloud.Layer.textfield"]=1;e["giscloud.Layer.label"]=1;e["giscloud.Layer.label_placement"]=1;e["giscloud.Map.mobileacess"]=1;e["giscloud.Query.actions"]=1;e["giscloud.Query.table"]=1;e["giscloud.ViewerLayer.instance"]=1;e["giscloud.address"]=1;e["giscloud.addressmodels"]=1;e["giscloud.oauth2.uriMismatch"]=1;e["giscloud.rest"]=1;e["giscloud.ui.ProjectionPicker"]=1;e["giscloud.ui.ProjectionPicker.init"]=1;e["giscloud.ui.ProjectionPicker.options"]=1;e["giscloud.ui.customForm.beforeOpen"]=1;e["giscloud.ui.Options"]=1;e["giscloud.ui.Options.init"]=1;e["giscloud.ui.Options.addbt"]=1;e["giscloud.ui.Options.inpdiv"]=1;e["giscloud.ui.Options.keyinp"]=1;e["giscloud.ui.Options.keylabel"]=1;e["giscloud.ui.Options.template"]=1;e["giscloud.ui.Options.ulcont"]=1;e["giscloud.ui.Options.valinp"]=1;e["giscloud.ui.Options.vallabel"]=1;e["giscloud.ui.Options.restOptions"]=1;e["giscloud.ui.Panel"]=1;e["giscloud.ui.Window"]=1;e["giscloud.ui.Search"]=1;e["giscloud.ui.alert"]=1;e["giscloud.ui.columns"]=1;e["giscloud.ui.customForm"]=1;e["giscloud.ui.dataGrid"]=1;e["giscloud.ui.edit"]=1;e["giscloud.ui.search"]=1;e["giscloud.ui.selectExtent"]=1;e["giscloud.ui.LayerList"]=1;e["giscloud.userOptions"]=1;e["giscloud.tasks"]=1;e["giscloud.Task"]=1;e["giscloud.Color.lab"]=1;e["giscloud.__googleMapsApiLoadedGeocoder"]=1;e["giscloud.cards"]=1;e["giscloud.coupons"]=1;e["giscloud.organization"]=1;e["giscloud.dashboard"]=1;e["giscloud.Color.lab"]=1;e["giscloud.options"]=1;e["giscloud.User"]=1;e["giscloud.Html5SendRequest"]=1;e["giscloud._properties"]=1;e["giscloud.File"]=1;e["giscloud.Post"]=1;e["giscloud.Resource"]=1;e["giscloud.Stream"]=1;e["giscloud.Vehicle"]=1;e["giscloud.FuelReading"]=1;t["giscloud.Graphic.*"]=t["giscloud.Map"]=t["giscloud.Layer"]=t["giscloud.Viewer"]=t["giscloud.ViewerLayer"]=t["giscloud.ViewerSelection"]=t["giscloud.Feature"]=t["giscloud.FlagMarker"]=t["giscloud.Marker"]=t["giscloud.LabelMarker"]="map";t["giscloud.Task"]=t["giscloud.tasks"]=t["giscloud.forms"]=t["giscloud.Query"]=t["giscloud.search"]=t["giscloud.tables"]=t["giscloud.tables.rows"]=t["giscloud.maps"]=t["giscloud.layers"]=t["giscloud.features"]=t["giscloud.users"]="resources";t["giscloud.datasources"]="datasources";t["giscloud.ui.map.*"]="ui.map";t["giscloud.ui.*"]="ui";t["giscloud.spatialrelationship"]=t["giscloud.geoutils"]=t["giscloud.Bounds"]=t["giscloud.Geometry"]=t["giscloud.LonLat"]=t["giscloud.geometry.*"]="geometry";t["giscloud.datasources.*"]=t["giscloud.wms.*"]="datasources";t["giscloud.keys"]=t["giscloud.oauth2"]=t["giscloud.resources"]=t["giscloud.permissions.*"]="users";i["giscloud.Graphic"]=new giscloud.Graphic(giscloud.ui.map);i["giscloud.Color"]=new giscloud.Color;i["giscloud.Queue"]=new giscloud.Queue([]);i["giscloud.GraphicFeature"]=new giscloud.GraphicFeature(new giscloud.geometry.Point);i["giscloud.ui.Options"]=new giscloud.ui.Options(document,{},{});i["giscloud.ViewerSelection"]=new giscloud.ViewerSelection(giscloud.ui.map);i["giscloud.Layer"]=new giscloud.Layer({alpha:100,bounds:new giscloud.Bounds,created:new Date,encoding:"enc",exportable:true,label:" ",lock:true});i["giscloud.LonLat"]=new giscloud.LonLat(0,0);{var r=new fnLayer;r.source={};r.id="layer0";i["giscloud.ViewerLayer"]=new giscloud.ViewerLayer(r)}i["giscloud.Promise"]=new giscloud.Promise;i["giscloud.ui.LayerList"]=new giscloud.ui.LayerList(giscloud.ui.map,"layerlist",true);i["giscloud.ui.Panel"]=new giscloud.ui.Panel({id:"info_panel",type:"vertical",position:"right",push:false,open:true,content:"<div id='infotable' ></div>"})}})(window,giscloud.exposeJQuery());delete giscloud.common;if(giscloud.proj4){giscloud.proj4.defs("EPSG:3410","+proj=cea +lon_0=0 +lat_ts=30 +x_0=0 +y_0=0 +a=6371228 +b=6371228 +units=m +no_defs")}})(window);